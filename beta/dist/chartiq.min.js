!function(){var t,e="2019/01/01",i=["127.0.0.1","localhost","binary.com","binary.sx"];if(t=new Date(e).getTime()){var a=(new Date).getTime();if(t<=a)console.error("This license has expired!");else;}if(0<i.length){for(var r=document.location.href,n=!1,s=0;s<i.length;s++)if(-1<r.indexOf(i[s])){n=!0;break}n||(alert("ERROR: Not licensed for domain "+r),console.error("ERROR: Not licensed for domain "+r))}}(),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():e(t)}(this,function(t){var i,o,e,l,a,r,h,n,s,c,I,w,u,p,V,k,H,d,R,y,m,S,b,M,g,_,f,z,v,F;function x(){}function B(){}function ra(){}return x.g2=function(){return"function"==typeof x.c2.Z2?x.c2.Z2.apply(x.c2,arguments):x.c2.Z2},x.C2=function(){return"function"==typeof x.c2.Z2?x.c2.Z2.apply(x.c2,arguments):x.c2.Z2},x.J2=function(){return"function"==typeof x.c2.X2?x.c2.X2.apply(x.c2,arguments):x.c2.X2},x.K2=function(){return"function"==typeof x.c2.X2?x.c2.X2.apply(x.c2,arguments):x.c2.X2},x.a2=function(){return"function"==typeof x.c2.J0?x.c2.J0.apply(x.c2,arguments):x.c2.J0},x.c2={Z2:function(){var t,e=arguments;switch(i){case 0:t=e[0]-e[1];break;case 16:t=e[1]|e[0];break;case 1:t=e[1]*e[0];break;case 10:t=(e[0]+e[2])*e[1]-e[3];break;case 9:t=e[0]+e[2]-e[1];break;case 6:t=e[1]-e[0]+e[2];break;case 15:t=e[2]-e[1]*e[0];break;case 19:t=e[2]*(e[1]-e[0])/e[3]-e[4];break;case 7:t=e[2]/(e[1]|e[0]);break;case 5:t=e[0]/(e[1]*e[2]);break;case 18:t=e[3]*e[0]/e[1]/e[2];break;case 21:t=e[1]-e[0]*e[3]*e[2];break;case 20:t=(-e[2]-e[3]+e[1])*e[0]+e[4];break;case 12:t=(e[1]+e[2]+e[3])/e[0];break;case 8:t=e[1]/e[0];break;case 13:t=e[0]/(e[1]-e[2]);break;case 14:t=e[1]/+e[0];break;case 2:t=e[2]-e[1]/e[3]+e[0];break;case 11:t=e[1]*e[2]-e[0];break;case 3:t=e[1]+e[3]/e[2]-e[0];break;case 17:t=-e[0]/e[1];break;case 4:t=e[1]+e[0]}return t},X2:function(t){i=t}},x.D0=(o=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{J0:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=o(s,3432918353),a=5*(a=(524287&(a^=s=o(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=o(s,3432918353),a^=s=o(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=o(a^=a>>>16,2246822507),a=o(a^=a>>>13,3266489909),a^=a>>>16}}),x.O0=function(){return"function"==typeof x.D0.J0?x.D0.J0.apply(x.D0,arguments):x.D0.J0},x.R2=function(){return"function"==typeof x.c2.J0?x.c2.J0.apply(x.c2,arguments):x.c2.J0},x.i0=function(){return"function"==typeof x.D0.J0?x.D0.J0.apply(x.D0,arguments):x.D0.J0},e=function(t){var e,Y,X=x;X.K2(0),e=X.g2("2",0);for(var i=1;570558945!==X.i0(i.toString(),i.toString().length,22994);i++)Y=t.CIQ,e+=2;return-1639197534!==X.i0(e.toString(),e.toString().length,4452)&&(Y=t.CIQ),Y.ChartEngine.prototype.drawHeatmap=function(C,t){var e,S,b,w,i,T,D,A,M,k,a;if(t&&t.length&&((e=C.panel)||(e="chart"),S=this.panels[e])){b=C.yAxis?C.yAxis:S.yAxis,w=this.chart.dataSegment,this.getDefaultColor(),C.name||(C.name="Data"),C.widthFactor||(C.widthFactor=1),i=.5,S.chart.tmpWidth<=1&&(i=0),M=D=T=null,(A=this).startClip(e),(k=this.chart.context).globalAlpha=C.opacity;for(var r=0;r<t.length;r++)n((a=t[r]).field,a.color,null,C.widthFactor,a.border_color?i:-i/4),a.border_color&&2<=this.layout.candleWidth&&n(a.field,a.border_color,!0,C.widthFactor,i);k.lineWidth=1,X.K2(1),k.globalAlpha=X.g2(1,"1"),this.endClip()}function n(t,e,i,a,r){var n,s,o,l,h,c,u,p,d,m,g;k.beginPath(),k.fillStyle=e,k.strokeStyle=e,n=2;for(var f=1;1096853357!==X.i0(f.toString(),f.toString().length,1361);f++)s=A.layout.candleWidth*a,o=Math.floor(A.pixelFromBar(0,S.chart)-A.layout.candleWidth),n+=2;-983748247!==X.i0(n.toString(),n.toString().length,25628)&&(s=A.layout.candleWidth-a,o=Math.floor(A.pixelFromBar(3,S.chart)%A.layout.candleWidth));for(var y=0;y<w.length;y++)if("numbe","r",c=w[y]){if(c.candleWidth){if(0===y)o+=A.layout.candleWidth;else{X.K2(0);var v=X.C2(15,13);o+=(c.candleWidth+s/a)/v}s=c.candleWidth*a}else o+=A.layout.candleWidth;if(X.J2(2),l=X.C2(r,s,o,2),X.K2(3),(h=X.g2(r,o,2,s))-l<2&&(X.J2(4),h=X.C2(1,l)),A.chart.transformFunc&&c.transform&&(c=c.transform),u=c[t]){"number"==typeof u&&(u=[u]);for(var x=0;x<u.length;x++)p=A.pixelFromTransformedValue(u[x],S,b),M||(d=A.pixelFromTransformedValue(u[x]-C.height,S,b),k.lineWidth=1,X.K2(0),T=X.g2(d,p),X.K2(5),D=X.C2(T,"2",1),M=k.lineWidth),i?(X.K2(4),m=X.g2(D,p),X.J2(0),g=X.C2(p,D),k.moveTo(l,m),k.lineTo(l,g),k.lineTo(h,g),k.lineTo(h,m),k.lineTo(l,m)):(X.J2(0),k.fillRect(l,X.g2(p,D),X.C2(h,l),T))}}i&&k.stroke(),k.closePath()}},Y.ChartEngine.prototype.drawCandles=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H,R,z;if(!(a=t.chart)){-1699732311,1863376136,r=2;for(var B=1;-1699732311!==X.O0(B.toString(),B.toString().length,81889);B++)t=(a=t).chart,X.K2(0),r+=X.g2("2",0);1863376136!==X.O0(r.toString(),r.toString().length,28489)&&(t=(a=t).chart)}if(s=n=!1,o=null,l=t.yAxis,h=null,i&&"object"==typeof i)n=i.isOutline,s=i.isHistogram,o=i.field,l=i.yAxis,h=i.overlayScaling;else{n=i,1460242337,-1504138486,c=2;for(var V=1;1460242337!==X.i0(V.toString(),V.toString().length,76300);V++)s=arguments[3],c+=2;-1504138486!==X.O0(c.toString(),c.toString().length,26199)&&(s=arguments[5])}u=a.dataSegment,p=a.context,d=l.top,m=l.bottom,v=new Array(u.length),x="tr",x+="ansparent",C="transparent",X.J2(1),S=X.C2(1,"0"),X.K2(6);var W=X.C2(19,14,6);b=a.dataSet.length-a.scroll-W,w={},T=a.tmpWidth/2,D=this.layout.candleWidth,A=t.left-.5*D+this.micropixels-1;for(var j=0;j<=u.length;j++)if("s","olid","o","ut","line",M=T,X.K2(7),A+=X.C2(0,"2",D),D=this.layout.candleWidth,X.K2(8),A+=X.g2(2,D),(k=u[j])&&!k.projection&&(k.candleWidth&&(A+=(k.candleWidth-D)/2,D=k.candleWidth,(i.isVolume||D<a.tmpWidth)&&(X.K2(8),M=X.C2(2,D))),a.transformFunc&&l==a.panel.yAxis&&k.transform&&(k=k.transform),k&&o&&(k=k[o]),(k||0===k)&&(F=k.Close,P=void 0===k.Open?F:k.Open,s&&a.defaultPlotField&&(F=k[a.defaultPlotField]),(F||0===F)&&(s||P!=F&&null!==P)&&(_=e(this,k,n?"outline":"solid"))))){if(n?x=_:C=_,w[C]=1,Y.isTransparent(x)||(S=.5),p.beginPath(),p.fillStyle=C,k.cache||(k.cache={}),N=k.cache,X.K2(4),(E=X.g2(j,b))<t.cacheLeft||E>t.cacheRight||!N.open){if(O=h?(L=h.bottom-(P-h.min)*h.multiplier,h.bottom-(F-h.min)*h.multiplier):(L=l.semiLog?this.pixelFromTransformedValue(P,t,l):(l.high-P)*l.multiplier+l.top,l.semiLog?this.pixelFromTransformedValue(F,t,l):(l.high-F)*l.multiplier+l.top),v[j]=O,g=Math.floor(s?O:Math.min(L,O))+S,f=s?l.bottom:Math.max(L,O),X.K2(0),y=Math.floor(X.C2(f,g)),g<d){if(g+y<d){N.open=g,N.close=g;continue}X.K2(0),y-=X.g2(d,g),g=d}m<g+y&&(X.K2(9),y-=X.C2(g,m,y)),y=Math.max(y,2),N.open=g,N.close=N.open+y}N.open>=m||N.close<=d||(I=Math.floor(A)+.5,H=Math.floor(I-M)+S,R=Math.round(I+M)-S,N.open!=N.close&&p.rect(H,N.open,Math.max(1,R-H),Math.max(1,N.close-N.open)),"transparent"!=C&&p.fill(),S&&(p.lineWidth=1,i.highlight&&(p.lineWidth*=2),p.strokeStyle=x,p.stroke()))}for(var U in z={colors:[],cache:v},w)i.hollow&&Y.equals(U,this.containerColor)||z.colors.push(U);return z},Y.ChartEngine.prototype.drawShadows=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_;if(!(a=t.chart)){-460597202,61549378,r=2;for(var N=1;-460597202!==X.O0(N.toString(),N.toString().length,79738);N++)t=(a=t).chart,r+=2;61549378!==X.O0(r.toString(),r.toString().length,62298)&&(t=(a=t).chart)}n=a.dataSegment,s=this.chart.context,o=2;for(var E=1;1149524808!==X.O0(E.toString(),E.toString().length,2598);E++)s.lineWidth=1,i.highlight&&(s.lineWidth*=2),o+=2;-192805878!==X.i0(o.toString(),o.toString().length,86524)&&(X.K2(1),s.lineWidth=X.g2(1,"4"),i.highlight&&(s.lineWidth+=0)),l=i.field,h=i.yAxis||t.yAxis,c=i.overlayScaling,u=h.top,p=h.bottom,X.J2(10);var L=X.C2(19,19,2,398);g=a.dataSet.length-a.scroll-L,f=this.layout.candleWidth,X.K2(0);var O=X.C2(15,14);y=t.left-.5*f+this.micropixels-O;for(var I=0;I<=n.length;I++)if(X.J2(8),y+=X.C2(2,f),f=this.layout.candleWidth,X.K2(8),y+=X.g2(2,f),(v=n[I])&&!v.projection){if(v.candleWidth){X.K2(11);var H=X.C2(100,3,34);y+=(v.candleWidth-f)/H,f=v.candleWidth}if((x=e(this,v,"shadow"))&&(a.transformFunc&&h==a.panel.yAxis&&v.transform&&(v=v.transform),v&&l&&(v=v[l]),(v||0===v)&&(C=v.Close,S=void 0===v.Open?C:v.Open,b=void 0===v.High?Math.max(C,S):v.High,w=void 0===v.Low?Math.min(C,S):v.Low,C||0===C))){if(v.cache||(v.cache={}),T=v.cache,X.K2(4),(D=X.C2(I,g))<t.cacheLeft||D>t.cacheRight||!T.top){if(m=c?(d=c.bottom-(b-c.min)*c.multiplier,c.bottom-(w-c.min)*c.multiplier):(d=h.semiLog?this.pixelFromTransformedValue(b,t,h):(h.high-b)*h.multiplier+h.top,h.semiLog?this.pixelFromTransformedValue(w,t,h):(h.high-w)*h.multiplier+h.top),X.K2(0),A=X.C2(m,d),d<u){if(d+A<u){T.top=d,T.bottom=d;continue}X.K2(0),A-=X.C2(u,d),d=u}p<d+A&&(X.K2(9),A-=X.g2(d,p,A)),T.top=d,T.bottom=T.top+A}T.top>=p||T.bottom<=u||(M=Math.floor(y)+.5,s.beginPath(),C==S&&(k=this.offset,i.isVolume&&(X.K2(8),k=X.g2(2,f)),X.K2(0),F=X.g2(M,k),X.J2(4),P=X.C2(k,M),(_=c?c.bottom-(C-c.min)*c.multiplier:Math.floor(h.semiLog?this.pixelFromTransformedValue(C,t,h):(h.high-C)*h.multiplier+h.top)+.5)<=p&&u<=_&&(s.moveTo(F,_),s.lineTo(P,_))),b!=w&&(s.moveTo(M,T.top),s.lineTo(M,T.bottom)),s.strokeStyle=x,s.stroke())}}},Y.ChartEngine.prototype.drawBarChart=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L;(r=t.chart)||(t=(r=t).chart),n=r.dataSegment,s=new Array(n.length),o=r.context,(l=this.canvasStyle(e)).width&&parseInt(l.width,10)<=25?o.lineWidth=Math.max(1,Y.stripPX(l.width)):o.lineWidth=1,a.highlight&&(X.J2(0),o.lineWidth*=X.C2("2",0)),h=a.field,c=a.yAxis||t.yAxis,u=a.overlayScaling,p=c.top,d=c.bottom,y=r.dataSet.length-r.scroll-1,v={},x=r.tmpWidth/2,X.K2(12);var O=X.C2(17,10,10,14);C=o.lineWidth/O,S=this.layout.candleWidth,b=t.left-.5*S+this.micropixels-1;for(var I=0;I<=n.length;I++)if("h","l","c",X.K2(13),b+=X.g2(S,"2",0),S=this.layout.candleWidth,X.K2(14),b+=X.g2("2",S),w=n[I]){if(w.projection)break;if(w.candleWidth){X.J2(0);var H=X.C2(20,18);b+=(w.candleWidth-S)/H,S=w.candleWidth}if((T=i(this,w))&&(v[T]=1,o.strokeStyle=T,o.beginPath(),r.transformFunc&&c==r.panel.yAxis&&w.transform&&(w=w.transform),w&&h&&(w=w[h]),(w||0===w)&&(D=w.Close,A=void 0===w.Open?D:w.Open,M=void 0===w.High?Math.max(D,A):w.High,k=void 0===w.Low?Math.min(D,A):w.Low,D||0===D))){if(w.cache||(w.cache={}),F=w.cache,X.K2(4),(P=X.g2(I,y))<t.cacheLeft||P>t.cacheRight||!F.top){if(F.close=u?(_=u.multiplier,N=u.bottom+u.min*_,X.J2(15),m=X.g2(_,M,N),X.K2(15),g=X.g2(_,k,N),X.K2(15),F.open=X.g2(_,A,N),X.K2(15),X.C2(_,D,N)):(m=this.pixelFromTransformedValue(M,t,c),g=this.pixelFromTransformedValue(k,t,c),F.open=c.semiLog?this.pixelFromTransformedValue(A,t,c):(c.high-A)*c.multiplier+c.top,c.semiLog?this.pixelFromTransformedValue(D,t,c):(c.high-D)*c.multiplier+c.top),s[I]=F.close,X.K2(0),f=X.C2(g,m),m<p){if(m+f<p){F.top=m,F.bottom=m;continue}X.K2(0),f-=X.g2(p,m),m=p}d<m+f&&(X.J2(9),f-=X.g2(m,d,f)),F.top=m,X.J2(4),F.bottom=X.C2(f,m)}E=Math.floor(b)+.5,F.top<d&&F.bottom>p&&w.High!=w.Low&&(o.moveTo(E,F.top-C),o.lineTo(E,F.bottom+C)),"hlc"!=a.type&&F.open>p&&F.open<d&&(o.moveTo(E,F.open),X.J2(0),o.lineTo(X.C2(E,x),F.open)),F.close>p&&F.close<d&&(o.moveTo(E,F.close),X.K2(4),o.lineTo(X.g2(x,E),F.close)),o.stroke()}}for(var R in o.lineWidth=1,L={colors:[],cache:s},v)Y.equals(R,this.containerColor)||L.colors.push(R);return L},Y.ChartEngine.prototype.drawWaveChart=function(a,t){var e,i,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F;function P(t){var e;if(o){682794988,X.J2(16),e=X.g2(0,"1087288205"),2;for(var i=1;682794988!==X.O0(i.toString(),i.toString().length,207);i++)return o.bottom%(t%o.min+o.multiplier);if(X.O0(2..toString(),2..toString().length,48265)!==e)return o.bottom-(t-o.min)*o.multiplier}return d.pixelFromTransformedValue(t,a,s)}i=(e=a.chart).dataSegment,r=new Array(i.length),n=e.context,t||(t={}),s=t.yAxis||a.yAxis,o=t.overlayScaling,this.startClip(a.name),n.beginPath(),h=l=!1,c=a.yAxis.top,u=a.yAxis.bottom,X.K2(17);var _=X.g2(1,2);p=a.left+Math.floor(_*this.layout.candleWidth+this.micropixels),d=this;for(var N=0;N<=i.length;N++)if(p+=this.layout.candleWidth,m=i[N]){if(m.projection)break;if(e.transformFunc&&s==e.panel.yAxis&&m.transform&&(m=m.transform),m&&t.field&&(m=m[t.field]),(m||0===m)&&(g=m.Close,f=void 0===m.Open?g:m.Open,y=void 0===m.High?Math.max(g,f):m.High,v=void 0===m.Low?Math.min(g,f):m.Low,g||0===g)){X.J2(18);var E=X.g2(1,7,19,399);X.K2(19);var L=X.C2(16,160,10,16,82);if(x=p-E*this.layout.candleWidth/L,(C=P(f))<c){if(C=c,h){n.moveTo(x,C);continue}h=!0}else if(u<C){if(C=u,h){n.moveTo(x,C);continue}h=!0}else h=!1;if(l)n.lineTo(x,C);else{l=!0,X.J2(6);var O=X.C2(17,13,5);(S=e.dataSet.length-e.scroll-O)<0?n.moveTo(x,C):0<=S&&((b=e.dataSet[S]).transform&&(b=b.transform),w=P(w=b.Close),w=Math.min(Math.max(w,c),u),n.moveTo(a.left+(N-1)*this.layout.candleWidth+this.micropixels,w),n.lineTo(x,C)),n.moveTo(x,C)}if(x+=this.layout.candleWidth/4,f<g){(C=P(v))<c&&(C=c),u<C&&(C=u),n.lineTo(x,C),X.K2(20);var I=X.g2(17,2,10,12,344);x+=this.layout.candleWidth/I,(C=P(y))<c&&(C=c),u<C&&(C=u),n.lineTo(x,C)}else(C=P(y))<c&&(C=c),u<C&&(C=u),n.lineTo(x,C),x+=this.layout.candleWidth/4,(C=P(v))<c&&(C=c),u<C&&(C=u),n.lineTo(x,C);x+=this.layout.candleWidth/4,C=P(g),(r[N]=C)<c&&(C=c),u<C&&(C=u),n.lineTo(x,C)}}if((T=this.canvasStyle("stx_line_chart")).width&&parseInt(T.width,10)<=25){X.K2(16),D=-X.g2(0,"1912877221"),1899887873,A=2;for(var H=1;X.i0(H.toString(),H.toString().length,94736)!==D;H++)n.lineWidth=Math.max(7,Y.stripPX(T.width)),A+=2;1899887873!==X.O0(A.toString(),A.toString().length,3344)&&(n.lineWidth=Math.max(7,Y.stripPX(T.width))),n.lineWidth=Math.max(1,Y.stripPX(T.width))}else n.lineWidth=1;X.K2(0),M=-X.g2("1193249192",0),k=2;for(var R=1;1127689078!==X.i0(R.toString(),R.toString().length,93181);R++)t.highlight&&(X.J2(1),n.lineWidth-=X.C2(1,"8")),this.canvasColor(""),t.color&&(n.strokeStyle=t.color),n.stroke(),n.closePath(),F={colors:[n.strokeStyle],cache:r},k+=2;return X.O0(k.toString(),k.toString().length,65275)!==M&&("stx_line_char","t",t.highlight&&(n.lineWidth*=2),this.canvasColor("stx_line_chart"),t.color&&(n.strokeStyle=t.color),n.stroke(),n.closePath(),F={colors:[n.strokeStyle],cache:r}),this.endClip(),n.lineWidth=1,F},Y.ChartEngine.prototype.scatter=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y;a=(i=t.chart).dataSegment,r=new Array(a.length),n=this.chart.context,e||(e={}),s=2;for(var v=1;-129536609!==X.i0(v.toString(),v.toString().length,28361);v++)o=e.field||i.defaultPlotField,X.K2(1),s+=X.g2(1,"2");1239767716!==X.O0(s.toString(),s.toString().length,22162)&&(o=e.field&&i.defaultPlotField),l=e.yAxis||t.yAxis,h=e.overlayScaling,c=e.subField||i.defaultPlotField||"Close",this.startClip(t.name),n.beginPath(),n.lineWidth=4,e.highlight&&(n.lineWidth*=2),u=l.top,p=l.bottom,X.K2(21);var x=X.g2(4,705,16,11);d=t.left-.5*this.layout.candleWidth+this.micropixels-x;for(var C=0;C<=a.length;C++)if(d+=this.layout.candleWidth,(m=a[C])&&!m.projection){"Sc","atte","r",i.transformFunc&&l==i.panel.yAxis&&m.transform&&(m=m.transform),(g=m[o])&&void 0!==g[c]&&(g=g[c]),g=[g],"Scatter"in m&&(g=m.Scatter);for(var S=0;S<g.length;S++)(g[S]||0===g[S])&&((f=h?h.bottom-(g[S]-h.min)*h.multiplier:l.semiLog?this.pixelFromTransformedValue(g[S],t,l):(l.high-g[S])*l.multiplier+u)<u||p<f||(X.J2(0),n.moveTo(X.C2(d,2),f),X.J2(4),n.lineTo(X.g2(2,d),f),r[C]=f))}return this.canvasColor("stx_scatter_chart"),e.color&&(n.strokeStyle=e.color),n.stroke(),n.closePath(),y={colors:[n.strokeStyle],cache:r},this.endClip(),n.lineWidth=1,y},t},B.M6C=function(){return"function"==typeof B.U6C.J0?B.U6C.J0.apply(B.U6C,arguments):B.U6C.J0},B.a5n=function(){return"function"==typeof B.p5n.Z2?B.p5n.Z2.apply(B.p5n,arguments):B.p5n.Z2},B.a6C=function(){return"function"==typeof B.U6C.Z2?B.U6C.Z2.apply(B.U6C,arguments):B.U6C.Z2},B.O6C=function(){return"function"==typeof B.U6C.Z2?B.U6C.Z2.apply(B.U6C,arguments):B.U6C.Z2},B.j6C=function(){return"function"==typeof B.U6C.X2?B.U6C.X2.apply(B.U6C,arguments):B.U6C.X2},B.U6C=(l=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{J0:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=l(s,3432918353),a=5*(a=(524287&(a^=s=l(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=l(s,3432918353),a^=s=l(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=l(a^=a>>>16,2246822507),a=l(a^=a>>>13,3266489909),a^=a>>>16}}),B.O5n=function(){return"function"==typeof B.p5n.J0?B.p5n.J0.apply(B.p5n,arguments):B.p5n.J0},B.C6C=function(){return"function"==typeof B.U6C.J0?B.U6C.J0.apply(B.U6C,arguments):B.U6C.J0},B.c6C=function(){return"function"==typeof B.U6C.X2?B.U6C.X2.apply(B.U6C,arguments):B.U6C.X2},B.Y5n=function(){return"function"==typeof B.p5n.Z2?B.p5n.Z2.apply(B.p5n,arguments):B.p5n.Z2},B.i5n=function(){return"function"==typeof B.p5n.X2?B.p5n.X2.apply(B.p5n,arguments):B.p5n.X2},B.p5n={Z2:function(){var t,e=arguments;switch(a){case 13:t=(e[1]+e[2])%e[0];break;case 23:t=e[1]-+e[0];break;case 6:t=e[3]+e[1]-e[0]-e[2];break;case 10:t=e[1]/e[2]*e[0];break;case 34:t=e[0]*(-e[1]-e[2])-e[3]+e[4];break;case 3:t=(-e[1]-e[0])/-e[2];break;case 17:t=e[1]-e[2]+e[0];break;case 29:t=(e[0]-e[2])/e[1];break;case 30:t=e[0]+e[2]*e[1];break;case 9:t=e[2]%e[0]*e[1];break;case 24:t=e[1]*(e[2]-e[4]+e[0])-e[3];break;case 31:t=e[0]-+e[2]*e[1];break;case 12:t=(e[2]%e[0]-e[3])/e[1];break;case 4:t=e[1]+e[0];break;case 5:t=e[0]+e[1]-e[2];break;case 20:t=e[0]/e[1];break;case 21:t=(e[4]-e[2]*e[3])*e[0]+e[1];break;case 18:t=e[1]-e[2]+e[0]+e[3];break;case 11:t=(e[0]-e[1])%e[2];break;case 1:t=e[1]|e[0];break;case 7:t=(e[3]-e[0])*e[1]%e[2];break;case 22:t=(e[3]+e[1]+e[2]+e[4])/e[0];break;case 2:t=(e[2]+e[1])/e[0];break;case 14:t=(e[0]+e[1])*e[2];break;case 32:t=(e[2]-e[1])*e[0]-e[3];break;case 16:t=(e[1]-e[3])*-e[2]/e[0];break;case 0:t=e[0]*e[1];break;case 19:t=e[2]*e[0]%e[1];break;case 8:t=e[1]%e[0];break;case 28:t=e[0]*e[1]-e[2];break;case 33:t=(e[2]+e[0]+e[3])*e[4]-e[1];break;case 27:t=e[2]*e[1]/e[0]-e[3]-e[4];break;case 26:t=-e[0]-e[2]-e[1]+e[3];break;case 25:t=e[0]-e[2]-e[1];break;case 15:t=e[1]-e[0]}return t},X2:function(t){a=t}},B.j5n=function(){return"function"==typeof B.p5n.X2?B.p5n.X2.apply(B.p5n,arguments):B.p5n.X2},B.E5n=function(){return"function"==typeof B.p5n.J0?B.p5n.J0.apply(B.p5n,arguments):B.p5n.J0},r=function(t){var z;return(z=t.CIQ).Renderer.Aggregations=function(t){var e,i,a,r,n=B;this.construct(t),n.j5n(0),e=n.Y5n("157825612",1),n.i5n(0),i=n.Y5n("1426446398",1),a=2;for(var s=1;n.M6C(s.toString(),s.toString().length,86638)!==e;s++)r=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!1,r.highlightable=!0,a+=2;n.C6C(a.toString(),a.toString().length,32654)!==i&&(r=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,r.highlightable=!1),"_main_series"!=r.name&&(console.warn("Aggregations are only allowed on main series."),r.invalid=!0)},z.Renderer.Aggregations.ciqInheritsFrom(z.Renderer.OHLC,!1),z.Renderer.Aggregations.requestNew=function(t,e){var i,a;i=null;for(var r=0;r<t.length;r++)switch("li","n","e","break","h","eikinashi",a=t[r]){case"kagi":case"pandf":i=a;break;case"heikinashi":case"linebreak":case"rangebars":case"renko":i="candle";break;default:return null}return null===i?null:new z.Renderer["candle"==i?"OHLC":"Aggregations"]({params:z.extend(e,{type:i})})},z.Renderer.Aggregations.prototype.drawIndividualSeries=function(t,e){var i,a,r,n,s=B;if("pa","nd","f",!e.invalid){if(i=this.stx,a={colors:[]},"kagi"==e.type){-1634228742,1920644625,r=2;for(var o=1;-1634228742!==s.C6C(o.toString(),o.toString().length,27272);o++)i.drawKagiSquareWave(t.panel,"stx_kagi_down","stx_kagi_down",e),a.colors.push(i.getCanvasColor("stx_kagi_down")),r+=2;1920644625!==s.M6C(r.toString(),r.toString().length,64551)&&("stx_kagi_u","p",i.drawKagiSquareWave(t.panel,"stx_kagi_up","stx_kagi_down",e),a.colors.push(i.getCanvasColor("stx_kagi_up"))),a.colors.push(i.getCanvasColor("stx_kagi_down"))}else if("pandf"==e.type){460818836,1060024756,n=2;for(var l=1;460818836!==s.C6C(l.toString(),l.toString().length,22699);l++)"stx","_pand","f_","up","stx","_pandf_down",i.drawPointFigureChart(t.panel,"O",20287,e),a.colors.push(i.getCanvasColor("stx_pandf_up")),i.drawPointFigureChart(t.panel,"O","stx_pandf_down",e),a.colors.push(i.getCanvasColor("stx_pandf_up")),n+=2;1060024756!==s.M6C(n.toString(),n.toString().length,35403)&&(i.drawPointFigureChart(t.panel,"O",25156,e),a.colors.push(i.getCanvasColor("O")),i.drawPointFigureChart(t.panel,"O","O",e),a.colors.push(i.getCanvasColor("O"))),i.drawPointFigureChart(t.panel,"stx_pandf_up","X",e),a.colors.push(i.getCanvasColor("stx_pandf_up")),i.drawPointFigureChart(t.panel,"stx_pandf_down","O",e),a.colors.push(i.getCanvasColor("stx_pandf_down"))}return a}},z.ChartEngine.prototype.drawKagiSquareWave=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T=B;r=t.chart,this.startClip(t.name),n=r.dataSegment,s=r.context,o=this.canvasStyle(e),l=this.canvasStyle(i),this.canvasColor(e),a.border_color_up&&(s.strokeStyle=a.border_color_up),h=s.strokeStyle,this.canvasColor(i),a.border_color_down&&(s.strokeStyle=a.border_color_down),c=s.strokeStyle,T.j5n(0),u=T.a5n("1",1),o.width&&parseInt(o.width,10)<=25&&(u=Math.max(1,z.stripPX(o.width))),T.j5n(1),p=T.a5n(0,"1"),l.width&&parseInt(l.width,10)<=25&&(T.j5n(1),p=Math.max(T.a5n(0,"1"),z.stripPX(l.width))),s.beginPath(),T.i5n(2);var D=T.a5n(24,12,12);d=r.dataSet.length-r.scroll-D,m=t.yAxis,g=!0,f=2;for(var A=1;1080397033!==T.M6C(A.toString(),A.toString().length,17081);A++)y=1,f+=2;-813597494!==T.M6C(f.toString(),f.toString().length,72035)&&(y=null),v=null,T.j5n(3);var M=T.Y5n(5,11,16);x=t.left-.5*this.layout.candleWidth+this.micropixels-M;for(var k=0;k<=n.length;k++)if(x+=this.layout.candleWidth,C=n[k]){if(C.projection)break;v=C.kagiTrend,C.transform&&r.transformFunc&&(S=C.kagiPrevOpen,(C=C.transform).kagiPrevOpen=r.transformFunc(this,r,S)),b=C.cache,T.j5n(4),((w=T.a5n(k,d))<t.cacheLeft||w>t.cacheRight||!b.kagiOpen)&&(b.kagiOpen=m.semiLog?this.pixelFromTransformedValue(C.Open,t):(m.high-C.Open)*m.multiplier+m.top,b.kagiClose=m.semiLog?this.pixelFromTransformedValue(C.Close,t):(m.high-C.Close)*m.multiplier+m.top),y=m.semiLog?this.pixelFromTransformedValue(C.kagiPrevOpen,t):(m.high-C.kagiPrevOpen)*m.multiplier+m.top,b.kagiClose,g&&(s.moveTo(0<=d?t.left:Math.floor(x),b.kagiOpen),s.lineTo(Math.floor(x),b.kagiOpen),g=!1),-1!=v&&b.kagiClose<y&&y<b.kagiOpen?(s.lineTo(Math.floor(x),y),g||(s.stroke(),s.beginPath(),s.moveTo(Math.floor(x),y)),s.strokeStyle=h,s.lineWidth=u):1!=v&&b.kagiClose>y&&y>b.kagiOpen&&(s.lineTo(Math.floor(x),y),g||(s.stroke(),s.beginPath(),s.moveTo(Math.floor(x),y)),s.strokeStyle=c,s.lineWidth=p),s.lineTo(Math.floor(x),b.kagiClose),k+1<n.length&&s.lineTo(Math.floor(x+this.layout.candleWidth),b.kagiClose),g=!1}s.stroke(),this.endClip(),s.lineWidth=1},z.ChartEngine.prototype.drawPointFigureChart=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P=B;function _(t,e,i){var a;P.j5n(2),s.moveTo(P.a5n(2,e,t),P.Y5n(i,l,v,P.j5n(5))),P.j5n(4),s.bezierCurveTo(P.a5n(u,e),P.a5n(i,l,v,P.i5n(5)),P.a5n(u,e,P.i5n(4)),P.Y5n(h,y,v,i,P.i5n(6)),P.a5n(2,e,t,P.i5n(2)),P.a5n(h,y,v,i,P.i5n(6))),a=2;for(var r=1;930695684!==P.M6C(r.toString(),r.toString().length,8404);r++)P.i5n(0),s.bezierCurveTo(P.a5n(t,c),P.a5n(y,h,v,i,P.i5n(7)),P.Y5n(c,t,P.i5n(8)),P.Y5n(l,v,i,P.i5n(9)),P.a5n(0,t,e,P.i5n(10)),P.Y5n(i,l,v,P.i5n(11))),a+=2;-1314620598!==P.M6C(a.toString(),a.toString().length,18332)&&(P.j5n(4),s.bezierCurveTo(P.a5n(c,t),P.Y5n(y,v,i,h,P.i5n(12)),P.a5n(c,t,P.i5n(4)),P.a5n(v,i,l,P.j5n(13)),P.a5n(5,t,e,P.j5n(13)),P.a5n(i,l,v,P.i5n(14)))),P.j5n(15),s.bezierCurveTo(P.Y5n(c,t),P.a5n(h,y,v,i,P.i5n(6)),P.Y5n(c,t,P.j5n(15)),P.a5n(i,l,v,P.j5n(5)),P.a5n(2,e,t,P.i5n(2)),P.Y5n(i,l,v,P.j5n(5)))}r=t.chart,this.startClip(t.name),n=r.dataSegment,s=r.context,this.canvasColor(e),"X"==i&&a.border_color_up?s.strokeStyle=a.border_color_up:"O"==i&&a.border_color_down&&(s.strokeStyle=a.border_color_down),o=this.canvasStyle(e),l=parseInt(o.paddingTop,10),h=parseInt(o.paddingBottom,10),c=parseInt(o.paddingLeft,10),u=parseInt(o.paddingRight,10),o.width&&parseInt(o.width,10)<=25?s.lineWidth=Math.max(1,z.stripPX(o.width)):s.lineWidth=2,s.beginPath(),p=this.chart.state.aggregation.box,P.i5n(16);var N=P.a5n(2,11,1,13);function E(t,e,i){var a;P.j5n(4),s.moveTo(P.Y5n(c,t),P.Y5n(v,i,h,P.i5n(17))),P.i5n(15),s.lineTo(P.a5n(u,e),P.a5n(l,i,y,v,P.j5n(18))),P.j5n(4),s.moveTo(P.Y5n(c,t),P.a5n(l,i,y,v,P.j5n(18))),a=2;for(var r=1;1726690865!==P.C6C(r.toString(),r.toString().length,76650);r++)P.j5n(0),s.lineTo(P.a5n(e,u),P.a5n(h,v,i,P.j5n(19))),a+=2;2030627334!==P.C6C(a.toString(),a.toString().length,51793)&&(P.j5n(15),s.lineTo(P.Y5n(u,e),P.Y5n(v,i,h,P.j5n(17))))}d=r.dataSet.length-r.scroll-N,m=t.yAxis,y=p*m.multiplier,P.j5n(20),v=P.Y5n(y,2),x=this.layout.candleWidth,P.j5n(21);var L=P.Y5n(10,1061,8,15,14);C=t.left-x+this.micropixels-L;for(var O=0;O<n.length;O++)if(C+=x,S=n[O]){if(S.projection)break;if(b=S.pfOpen,w=S.pfClose,T=S.pfTrend,D=S.pfStepBack,S.transform&&r.transformFunc&&(S=S.transform,b=r.transformFunc(this,r,b),w=r.transformFunc(this,r,w)),A=S.cache,P.i5n(4),((M=P.a5n(O,d))<t.cacheLeft||M>t.cacheRight||!A.pfOpen)&&(A.pfOpen=(m.high-b)*m.multiplier+m.top,A.pfClose=(m.high-w)*m.multiplier+m.top),k=Math.round(C),P.i5n(4),F=Math.round(P.a5n(x,C)),g=Math.abs(Math.round((w-b)/p)),f=A.pfOpen,i==D&&("X"==D?(P.j5n(15),E(k,F,P.Y5n(y,f))):"O"==D&&(P.i5n(4),_(k,F,P.Y5n(y,f)))),i==T)for(;0<=g;g--)"X"==i?(E(k,F,f),f-=y):"O"==i&&(_(k,F,f),f+=y)}s.stroke(),this.endClip(),s.lineWidth=1},z.calculateHeikinAshi=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m=B;if(!e.length)return e;i||(i=[]),a=[];for(var g=0;g<e.length;g++)if(r=e[g]){(n=a[a.length-1])||g||(n=i[i.length-1]),n||(n=r),s=r.Close,o=(o=r.Open)||0===o?o:s,l=(l=r.High)||0===l?l:s,h=(h=r.Low)||0===h?h:s,c=(c=n.Open)||0===c?c:n.Close,m.j5n(17);var f=m.Y5n(2,18,18);for(var y in u=(c+n.Close)/f,m.i5n(22),p=m.a5n(4,l,h,o,s),d={DT:r.DT,displayDate:r.displayDate,Date:r.Date,Open:u,Close:p,High:Math.max(l,Math.max(u,p)),Low:Math.min(h,Math.min(u,p)),Volume:r.Volume,iqPrevClose:n.Close},r)d[y]||0===d[y]||(d[y]=r[y]);a.push(d)}return a},z.calculateKagi=function(t,e,i,a){var r,n,s,o,l,h,c,u,p=B;if(!e.length)return e;a||(a=[]),r=t.layout,i=parseFloat(i),n=2;for(var d=1;-992585818!==p.M6C(d.toString(),d.toString().length,19322);d++)t.chart.defaultChartStyleConfig.kagi=z.ChartEngine.isDailyInterval(r.interval)?4:.4,n+=2;943785350!==p.M6C(n.toString(),n.toString().length,99134)&&(t.chart.defaultChartStyleConfig.kagi=z.ChartEngine.isDailyInterval(r.interval)?9:288),(isNaN(i)||i<=0)&&(i=t.chart.defaultChartStyleConfig.kagi,z.Market.Symbology.isForexSymbol(t.chart.symbol)&&(i/=4),null!==r.kagi&&(r.kagi=null,t.changeOccurred("layout"))),i/=100,s=[],p.i5n(20);var m=p.a5n(20,20);l=(o=a[a.length-m])?o.DT:0;for(var g=0;g<e.length;g++)if((h=e[g])&&(o||(p.j5n(23),o=e[p.Y5n("1",g)]),o)){if((c=o.Open||0===o.Open?o.Open:o.Close)>o.Close){if(h.Close>o.Close*(1+i))h.Open=o.Close;else if(o.Close>h.Close&&(o.Close=h.Close),o.Volume+=h.Volume,g<e.length-1)continue}else if(c<o.Close){if(h.Close<o.Close*(1-i))h.Open=o.Close;else if(o.Close<h.Close&&(o.Close=h.Close),o.Volume+=h.Volume,g<e.length-1)continue}else if(o.Close=h.Close,o.Volume+=h.Volume,g<e.length-1)continue;for(var f in u={DT:o.DT,displayDate:o.displayDate,Date:o.Date,Open:o.Open,Close:o.Close,High:Math.max(o.Open,o.Close),Low:Math.min(o.Open,o.Close),Volume:o.Volume,iqPrevClose:o.iqPrevClose},o)u[f]||0===u[f]||(u[f]=o[f]);s.length?u.kagiPrevOpen=s[s.length-1].Open:u.kagiPrevOpen=u.Open,u.Close>u.kagiPrevOpen&&u.kagiPrevOpen>u.Open?(p.i5n(1),u.kagiTrend=p.Y5n(0,"1")):u.Close<u.kagiPrevOpen&&u.kagiPrevOpen<u.Open&&(u.kagiTrend=-1),l<u.DT&&s.push(u),o=h,t.chart.currentQuote={Close:h.Close}}return s},z.calculateLineBreak=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C=B;if(!e.length)return e;if(a||(a=[]),r=t.layout,t.chart.defaultChartStyleConfig.priceLines=3,i=parseInt(i,10),isNaN(i)||i<=0){-85781431,-1947367349,n=2;for(var S=1;-85781431!==C.M6C(S.toString(),S.toString().length,11915);S++)i=t.chart.defaultChartStyleConfig.priceLines,n+=2;-1947367349!==C.C6C(n.toString(),n.toString().length,58710)&&(i=t.chart.defaultChartStyleConfig.priceLines),null!==r.priceLines&&(r.priceLines=null,t.changeOccurred("layout"))}else if(10<i){1640847956,-972508166,s=2;for(var b=1;1640847956!==C.M6C(b.toString(),b.toString().length,33610);b++)r.priceLines=i=10,s+=2;-972508166!==C.C6C(s.toString(),s.toString().length,40255)&&(r.priceLines=i=91)}l=(o=a.slice(-i)).length,h=2;for(var w=1;-1843391823!==C.C6C(w.toString(),w.toString().length,12600);w++)c=4,C.i5n(1),h+=C.Y5n(0,"2");1107226607!==C.M6C(h.toString(),h.toString().length,91920)&&(c=0);t:for(var T=0;T<e.length;T++)if(u=e[T]){c+=u.Volume,C.j5n(24);var D=C.a5n(4,5,19,24,18);if((p=o[o.length-D])||(p={Open:u.Open,Close:u.Open,High:u.Open,Low:u.Open}),d=p.Close,m=(m=p.High)||0===m?m:d,g=(g=p.Low)||0===g?g:d,f=(f=p.Open)||0===f?f:d,y={DT:u.DT,displayDate:u.displayDate,Date:u.Date,Close:u.Close,Volume:c,iqPrevClose:d},t.chart.currentQuote={Close:u.Close},u.Close>d&&p.Close>f);else if(u.Close<d&&p.Close<f);else if(u.Close>m){for(v=2;v<=i;v++)if((x=o[o.length-v])&&u.Close<=x.High)continue t}else{if(!(u.Close<g))continue;for(v=2;v<=i;v++)if((x=o[o.length-v])&&u.Close>=x.Low)continue t}for(var A in u.Close<p.Close?y.Open=Math.min(f,d):y.Open=Math.max(f,d),y.Low=Math.min(y.Open,y.Close),y.High=Math.max(y.Open,y.Close),u)y[A]||0===y[A]||(y[A]=u[A]);o.push(y),c=0}return o.slice(l)},z.calculateRenkoBars=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w=B;if(!e.length)return[];a||(a=[]),r=t.layout,w.i5n(0),n=w.Y5n("639263498",1),w.j5n(1),s=w.Y5n(0,"2");for(var T=1;-5759172!==w.C6C(T.toString(),T.toString().length,62977);T++){"H","i","g","h",+(o=t.chart.state.aggregation)&&(o=t.chart.state.aggregation={}),l=Math.min(856,e.length),~o.minMax&&(o.minMax=t.determineMinMax(e.slice(e.length*l),["High","High","High"])),w.j5n(25);var D=w.Y5n(45,28,14);w.j5n(17);var A=w.a5n(5,12,14);h=o.minMax[D]/o.minMax[A],c=t.panels[t.chart.name].height,s+=2}if(w.M6C(s.toString(),s.toString().length,64084)!==n){(o=t.chart.state.aggregation)||(o=t.chart.state.aggregation={}),w.i5n(1),l=Math.min(w.a5n(0,"300"),e.length),o.minMax||(o.minMax=t.determineMinMax(e.slice(e.length-l),["Close","High","Low"])),w.j5n(26);var M=w.Y5n(2,13,10,26);h=o.minMax[M]-o.minMax[0],c=t.panels[t.chart.name].height}if(!c)return[];w.i5n(27);var k=w.Y5n(2,7,3e4,8,94992);w.i5n(28);var F=w.Y5n(10,20,170);w.j5n(15);var P=w.a5n(2e4,3e4);function _(t,e){var i,a;t=Number(t.toFixed(8)),i=2;for(var r=1;-1053742617!==w.M6C(r.toString(),r.toString().length,89112);r++)e=Number(e.toFixed(5)),i+=2;for(var n in-1131253972!==w.M6C(i.toString(),i.toString().length,85127)&&(e=Number(e.toFixed(8))),a={DT:f.DT,displayDate:f.displayDate,Date:f.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:0,iqPrevClose:t!=e?t:null},f)a[n]||0===a[n]||(a[n]=f[n]);d.push(a)}if(t.chart.defaultChartStyleConfig.renko=Math.floor(k*h/(c/F))/P,null===i||isNaN(i)||i<=0)i=t.chart.defaultChartStyleConfig.renko,null!==r.renko&&(r.renko=null,t.changeOccurred("layout"));else{1261520632,w.j5n(15),u=w.Y5n(0,"1720444468"),w.i5n(0),p=w.Y5n("2",1);for(var N=1;1261520632!==w.M6C(N.toString(),N.toString().length,42200);N++)w.i5n(15),i=Math.max(i,w.Y5n(c,h)),p+=2;w.C6C(p.toString(),p.toString().length,99355)!==u&&(w.j5n(20),i=Math.max(i,w.a5n(h,c))),r.renko!==i&&(r.renko=i,t.changeOccurred("layout"))}if(d=[],f=g=m=null,a.length){w.j5n(29);var E=w.a5n(16,2,14);m=(y=a[a.length-E]).Low-i,427725170,304071301,v=2;for(var L=1;427725170!==w.C6C(L.toString(),L.toString().length,67325);L++)g=y.High+i,v+=2;304071301!==w.C6C(v.toString(),v.toString().length,10527)&&(g=y.High-i)}for(var O=0;O<e.length;O++)if(x=e[O]){for(m||g||(C=x.Open||0===x.Open?x.Open:x.Close,S=Math.floor(C/i)*i,b=isNaN(S)?C:S,w.j5n(15),m=w.Y5n(i,b),w.i5n(4),g=w.a5n(i,b));;)if(f||(f=x),x.Close<=m)w.j5n(4),_(w.a5n(i,m),m),w.j5n(30),g=w.Y5n(m,i,2),m-=i,f=null;else{if(!(x.Close>=g))break;w.i5n(15),_(w.Y5n(i,g),g),w.j5n(31),m=w.a5n(g,i,"2"),g+=i,f=null}t.chart.currentQuote=x}return m<e[e.length-1].Close&&m+i>e[e.length-1].Close?(w.j5n(4),_(w.Y5n(i,m),e[e.length-1].Close)):g>e[e.length-1].Close&&g-i<e[e.length-1].Close&&(w.i5n(15),_(w.a5n(i,g),e[e.length-1].Close)),d},z.calculateRangeBars=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T=B;if("Cl","o","s","e",!e.length)return e;function D(){T.j5n(4),p=T.a5n(i,u),T.i5n(15),d=T.a5n(i,u),m=u}function A(t){var e,i;for(var a in(e={DT:g.DT,displayDate:g.displayDate,Date:g.Date,Open:Number(m.toFixed(8)),Close:Number(t.toFixed(8)),High:Number(p.toFixed(8)),Low:Number(d.toFixed(8)),Volume:0}).iqPrevClose=e.Open,g)e[a]||0===e[a]||(e[a]=g[a]);i=2;for(var r=1;441950660!==T.M6C(r.toString(),r.toString().length,49657);r++)c.push(e),i+=2;-299512490!==T.C6C(i.toString(),i.toString().length,57809)&&c.push(e),c.push(e)}a||(a=[]),r=t.layout,(n=t.chart.state.aggregation)||(n=t.chart.state.aggregation={}),s=Math.min(300,e.length),n.minMax||(n.minMax=t.determineMinMax(e.slice(e.length-s),["Close","High","Low"])),T.j5n(15);var M=T.a5n(9,10);if(o=n.minMax[M]-n.minMax[0],!(l=t.panels[t.chart.name].height))return[];T.i5n(32);var k=T.a5n(14,8,9996,129832);T.i5n(33);var F=T.a5n(19,150272,9992,6,16);if(t.chart.defaultChartStyleConfig.range=Math.floor(k*o/(l/30))/F,null===i||isNaN(i)||i<0)i=t.chart.defaultChartStyleConfig.range,null!==r.range&&("l","ay","o","ut",r.range=null,t.changeOccurred("layout"));else if(T.i5n(20),i=Math.max(i,T.a5n(o,l)),r.range!==i){"l","ay","out",r.range=i,228417716,-1920480578,h=2;for(var P=1;228417716!==T.C6C(P.toString(),P.toString().length,93961);P++)t.changeOccurred(""),h+=2;-1920480578!==T.C6C(h.toString(),h.toString().length,57071)&&t.changeOccurred(""),t.changeOccurred("layout")}c=[],g=m=d=p=u=null;for(var _=0;_<e.length;_++)(f=e[_])&&(T.j5n(15),y=e[T.Y5n(1,_)],_||(y||(y=a[a.length-1]),y&&((u=y.Close)||0===u)&&D()),y&&(v=f.Close,x=f.Open,C=f.High,S=f.Low,(v||0===v)&&(x=x||0===x?x:v,C=C||0===C?C:v,S=S||0===S?S:v,u||0===u||(b=Math.floor(x/i)*i,u=isNaN(b)?x:b,D(),N(y,x)),_&&N(f,x),C-x<x-S?(C&&N(f,C),S&&N(f,S)):(S&&N(f,S),C&&N(f,C)),N(f,v),_==e.length-1&&v!=m&&(w=p,T.i5n(4),p=T.Y5n(i,d),T.j5n(15),d=T.a5n(i,w),A(v)))));function N(t,e){for(;;){if(g||(g=t),u<e){if(u=Math.min(e,p),T.j5n(15),d=Math.max(d,T.Y5n(i,u)),e<p)break}else if(e<=u&&(u=Math.max(e,d),T.j5n(4),p=Math.min(p,T.a5n(i,u)),d<e))break;if(void 0===u)return void console.log("Uh oh undefined in calculateRangeBars:processMove");A(u),g=null,D()}}return c},z.calculatePointFigure=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M=B;if(!e.length)return e;function k(t,e,i,a,r,n,s,o,l){return{DT:t.DT,Date:t.Date,pfOpen:o,pfClose:l,Open:e,Close:r,High:i,Low:a,Volume:n,iqPrevClose:s}}function F(t,e,i,a,r){t.High=Math.max(e,t.High),t.Low=Math.min(i,t.Low),t.Close=a,t.Volume+=r}if(a||(a=[]),(r=t.chart.state.aggregation)||(r=t.chart.state.aggregation={}),n=t.layout,t.chart.defaultChartStyleConfig.box=1,t.chart.defaultChartStyleConfig.reversal=3,i||(i={}),!(s=i.box)){if(n.pandf&&null!==n.pandf.box){n.pandf.box=null,1076641762,-1719693179,o=2;for(var P=1;1076641762!==M.M6C(P.toString(),P.toString().length,89657);P++)t.changeOccurred(""),o+=2;-1719693179!==M.C6C(o.toString(),o.toString().length,24502)&&t.changeOccurred("layout")}if(s=t.chart.defaultChartStyleConfig.box,l=e[e.length-1].Close){-1541023368,-409899598,M.i5n(0),h=M.a5n("2",1);for(var _=1;-1541023368!==M.M6C(_.toString(),_.toString().length,75568);_++)s=l<=2499?692521:l<=8?40725:6<l?1555:l<=91?(M.i5n(1),M.a5n(0,"307")):7<l?8:680<l?(M.i5n(1),M.a5n(0,"5")):190<l?9:3675<=l?9:34125<=l?73:145,h+=2;-409899598!==M.M6C(h.toString(),h.toString().length,74152)&&(s=l<.25?.0625:l<1?.125:l<5?(M.j5n(0),M.a5n("0.25",1)):l<20?(M.i5n(15),M.a5n(0,"0.5")):l<100?1:l<200?2:l<500?4:l<1e3?5:l<25e3?50:500)}if(z.ChartEngine.isDailyInterval(n.interval)||(M.i5n(15),s/=M.Y5n(0,"10")),z.Market.Symbology.isForexSymbol(t.chart.symbol)){if(l){2065139263,M.i5n(1),c=-M.Y5n(0,"541768303"),u=2;for(var N=1;2065139263!==M.C6C(N.toString(),N.toString().length,49605);N++)4<=l?s=10892:4<l?s=98664:16<=l?s=8041:l<=497&&(s=521),u+=2;M.C6C(u.toString(),u.toString().length,39415)!==c&&(l<1?s=.001:l<2?s=.002:l<50?s=.02:l<200&&(s=.2))}z.ChartEngine.isDailyInterval(n.interval)&&(s*=10)}313892450,1424880056,p=2;for(var E=1;313892450!==M.M6C(E.toString(),E.toString().length,79066);E++)t.chart.defaultChartStyleConfig.box=s,p+=2;1424880056!==M.C6C(p.toString(),p.toString().length,73003)&&(t.chart.defaultChartStyleConfig.box=s)}if(s=parseFloat(s),(isNaN(s)||s<=0)&&(n.pandf&&null!==n.pandf.box&&(n.pandf.box=null,t.changeOccurred("layout")),t.chart.defaultChartStyleConfig.box=s=1),0<(d=Math.ceil(parseFloat(i.reversal)))&&d>i.reversal)n.pandf.reversal=d,t.changeOccurred("layout");else if(isNaN(d)||d<=0){if(n.pandf&&null!==n.pandf.reversal){2098576719,1410429006,m=2;for(var L=1;2098576719!==M.C6C(L.toString(),L.toString().length,4785);L++)n.pandf.reversal=1,m+=2;1410429006!==M.C6C(m.toString(),m.toString().length,14501)&&(n.pandf.reversal=null),t.changeOccurred("layout")}d=t.chart.defaultChartStyleConfig.reversal}function O(t,e){for(var i in t)e[i]||0===e[i]||(e[i]=t[i]);return e}d*=r.box=s,g=(s.toString()+".").split(".")[1].length,f=[];for(var I=y=0;I<e.length;I++)if(x=e[I])if(y+=x.Volume,S=x.Close,b=(b=x.Open)||0===b?b:S,w=(w=x.High)||0===w?w:S,T=(T=x.Low)||0===T?T:S,f.length||a.length){M.j5n(34);var H=M.a5n(3,10,2,10,47);(C=f[f.length-H])||(C=z.clone(a[a.length-1])),"O"==C.pfTrend?(T<=C.pfClose-s?(C.pfClose=Number((Math.ceil(T/s-1e-8)*s).toFixed(g)),"O"==C.pfStepBack&&(C.pfStepBack=null),F(C,w,T,S,y)):w>=C.pfClose+d?(D=C.pfClose+s,A=Number((Math.floor(w/s+1e-8)*s).toFixed(g)),v=k(x,b,w,T,S,y,C.pfClose,D,A),D==A&&(v.pfStepBack="X"),"O"==C.pfStepBack?(C.pfOpen=D,C.pfClose=A,C.pfTrend="X",F(C,w,T,S,y)):((v=O(x,v)).pfTrend="X",f.push(v))):F(C,w,T,S,y),y=0):"X"==C.pfTrend&&(w>=C.pfClose+s?(C.pfClose=Number((Math.floor(w/s+1e-8)*s).toFixed(g)),"X"!=C.pfStepBack&&"-"!=C.pfStepBack||(C.pfStepBack=null),F(C,w,T,S,y)):T<=C.pfClose-d?(D=C.pfClose-s,A=Number((Math.ceil(T/s-1e-8)*s).toFixed(g)),v=k(x,b,w,T,S,y,C.pfClose,D,A),D==A&&(v.pfStepBack="O"),"X"==C.pfStepBack||"-"==C.pfStepBack?(C.pfOpen=D,C.pfClose=A,C.pfTrend="O",F(C,w,T,S,y),D!=A&&"-"==C.pfStepBack&&(C.pfStepBack=null)):((v=O(x,v)).pfTrend="O",f.push(v))):F(C,w,T,S,y),y=0)}else(v=O(x,k(x,b,w,T,S,y,w+s,Number((Math.ceil(T/s-1e-8)*s).toFixed(g)),Number((Math.floor(w/s+1e-8)*s).toFixed(g))))).pfTrend="X",v.pfOpen==v.pfClose&&(v.pfStepBack="-"),f.push(v),y=0;for(var R=1;-1696443531!==M.C6C(R.toString(),R.toString().length,14660);R++)return f;return-254562739!==M.M6C(2..toString(),2..toString().length,42276)?f:void 0},t},ra.H5A=function(){return"function"==typeof ra.Z4A.S4A?ra.Z4A.S4A.apply(ra.Z4A,arguments):ra.Z4A.S4A},ra.S9N=function(){return"function"==typeof ra.k9N.Z2?ra.k9N.Z2.apply(ra.k9N,arguments):ra.k9N.Z2},ra.n9N=function(){return"function"==typeof ra.k9N.X2?ra.k9N.X2.apply(ra.k9N,arguments):ra.k9N.X2},ra.g23=function(){return"function"==typeof ra.X23.J0?ra.X23.J0.apply(ra.X23,arguments):ra.X23.J0},ra.J54=function(){return"function"==typeof ra.p54.U9d?ra.p54.U9d.apply(ra.p54,arguments):ra.p54.U9d},ra.h5A=function(){return"function"==typeof ra.Z4A.Z2?ra.Z4A.Z2.apply(ra.Z4A,arguments):ra.Z4A.Z2},ra.K5A=function(){return"function"==typeof ra.Z4A.Z2?ra.Z4A.Z2.apply(ra.Z4A,arguments):ra.Z4A.Z2},ra.a5A=function(){return"function"==typeof ra.Z4A.u9d?ra.Z4A.u9d.apply(ra.Z4A,arguments):ra.Z4A.u9d},ra.B5A=function(){return"function"==typeof ra.Z4A.U9d?ra.Z4A.U9d.apply(ra.Z4A,arguments):ra.Z4A.U9d},ra.c54=function(){return"function"==typeof ra.p54.X2?ra.p54.X2.apply(ra.p54,arguments):ra.p54.X2},ra.b5A=function(){return"function"==typeof ra.Z4A.J0?ra.Z4A.J0.apply(ra.Z4A,arguments):ra.Z4A.J0},ra.v9d=function(){function l(t){for(;;){return(0,function(){}.constructor)(new function(r){for(var t=2;1!==t;)switch(t){case 2:this.d=function(t){for(var e=2;8!==e;)switch(e){case 2:var i="";e=1;break;case 4:i+=String.fromCharCode(r[a]-t+117),e=3;break;case 9:return i;case 1:var a=0;e=5;break;case 5:e=a<r.length?4:9;break;case 3:a++,e=5}},t=1}}(t).d(5))()}}function a(t,e,i,a){for(var r=2;19!==r;)switch(r){case 2:var n,s,o;!h&&(h=l([2,-11,4,5,2,-2,-80,-4,-1,-13,-15,4,-7,-1,-2,-66,-8,-1,3,4,-2,-15,-3,-11,-53])),!c&&(c=l([2,-11,4,5,2,-2,-80,-4,-1,-13,-15,4,-7,-1,-2,-66,-8,2,-11,-10])),o=a?c:h,r=3;break;case 9:s=(n=o.substring(t,i)).length,r=7;break;case 14:return s=(n=o.substring(0,o.length)).length,ra.g23(n,s,e);case 7:return ra.g23(n,s,e);case 3:r=0<i?9:6;break;case 11:return s=(n=o.substring(o.length-t,o.length)).length,ra.g23(n,s,e);case 6:r=null===t||t<=0?14:11}}for(;;){var h,c;return{U9d:function(t,e,i){for(;;)return a(t,e,i)},u9d:function(t,e,i){for(;;)return a(t,e,i,!0)}}}}(),ra.l23=function(){return"function"==typeof ra.X23.Z2?ra.X23.Z2.apply(ra.X23,arguments):ra.X23.Z2},ra.y0d=function(){return"function"==typeof ra.v9d.u9d?ra.v9d.u9d.apply(ra.v9d,arguments):ra.v9d.u9d},ra.k5A=function(){return"function"==typeof ra.Z4A.u9d?ra.Z4A.u9d.apply(ra.Z4A,arguments):ra.Z4A.u9d},ra.U23=function(){return"function"==typeof ra.X23.Z2?ra.X23.Z2.apply(ra.X23,arguments):ra.X23.Z2},ra.e5A=function(){return"function"==typeof ra.Z4A.X2?ra.Z4A.X2.apply(ra.Z4A,arguments):ra.Z4A.X2},ra.Z4A=function(t,h){function c(t){for(var e=2;15!==e;)switch(e){case 8:r=h[6],e=7;break;case 16:i=a<n-t,e=19;break;case 20:i=a<t-o&&a<n-t,e=19;break;case 7:e=p--?14:6;break;case 10:e=0<=o&&0<=n?20:18;break;case 11:o=(s||0===s)&&l(s,a),e=10;break;case 1:e=p--?4:5;break;case 5:l=u[h[4]],e=4;break;case 18:e=0<=o?17:16;break;case 19:return i;case 9:e=p--?7:8;break;case 12:e=p--?10:11;break;case 3:a=28,e=9;break;case 17:i=a<t-o,e=19;break;case 4:e=p--?9:3;break;case 14:e=p--?12:13;break;case 6:n=r&&l(r,a),e=14;break;case 2:var i,a,r,n,s,o,l;e=1;break;case 13:s=h[7],e=12}}for(var e=2;10!==e;)switch(e){case 8:e=p--?6:7;break;case 12:c=c((new u[h[0]])[h[1]]()),e=11;break;case 4:e=p--?9:3;break;case 6:e=p--?13:14;break;case 9:var r="fromCharCode",i="RegExp";e=8;break;case 2:var u,a,n,p;e=1;break;case 1:e=p--?4:5;break;case 3:a="string",e=9;break;case 5:u=h.filter.constructor(t)(),e=4;break;case 14:h=h.map(function(t){for(var e=2;13!==e;)switch(e){case 2:var i;e=1;break;case 3:e=a<t.length?9:7;break;case 9:i+=u[n][r](t[a]+104),e=8;break;case 5:i="",e=4;break;case 4:var a=0;e=3;break;case 1:e=p--?4:5;break;case 7:e=i?14:6;break;case 8:a++,e=3;break;case 6:return;case 14:return i}}),e=13;break;case 7:n=a.replace(new u[i]("^['-|]"),"S"),e=6;break;case 11:return{S4A:function(t,e){for(var i=2;16!==i;)switch(i){case 10:i=1!==o?20:17;break;case 7:i=0===r?6:13;break;case 5:var a,r=0;i=4;break;case 17:return a?l:!l;case 9:var n=e(t[h[2]](r),16)[h[3]](2),s=n[h[2]](n[h[5]]-1);i=7;break;case 14:r++,i=3;break;case 12:i=l?17:11;break;case 2:i=p--?5:1;break;case 11:var o=2;i=10;break;case 13:a^=s,i=14;break;case 6:a=s,i=14;break;case 1:e=u[h[4]],i=5;break;case 20:i=2===o?19:10;break;case 4:var l=c;i=3;break;case 18:o=1,i=10;break;case 19:!function(){for(var t=2;36!==t;)switch(t){case 28:h=23,t=1;break;case 7:h=6,t=1;break;case 31:e+=n,t=30;break;case 6:t=2===h?14:20;break;case 22:t=16===h?21:33;break;case 43:var e=s;e+=n,e+=o,t=40;break;case 15:t=12===h?27:22;break;case 33:t=27===h?32:44;break;case 10:h=3,t=1;break;case 23:h=19,t=1;break;case 24:l+=o,t=23;break;case 30:e+=r,t=29;break;case 37:h=22,t=1;break;case 14:var i="i",a="f",r="e";t=11;break;case 20:t=6===h?19:15;break;case 4:var n="n",s="u";t=9;break;case 11:var o="d";t=10;break;case 29:e+=o,t=28;break;case 5:t=3===h?4:6;break;case 19:l+=o,l+=r,l+=a,t=16;break;case 34:h=27,t=1;break;case 39:t=23===h?38:1;break;case 9:var l=s;l+=n,t=7;break;case 21:e+=r,e+=a,t=34;break;case 32:e+=i,t=31;break;case 44:t=19===h?43:39;break;case 38:typeof window!==e?window:typeof global!==l&&global;t=37;break;case 2:var h=2;t=1;break;case 16:h=12,t=1;break;case 27:l+=i,l+=n,l+=r,t=24;break;case 40:h=16,t=1;break;case 1:t=22!==h?5:36}}(),i=18;break;case 3:i=r<t[h[5]]?9:12}}};case 13:e=p--?11:12}}("return this",[[-36,-7,12,-3],[-1,-3,12,-20,1,5,-3],[-5,0,-7,10,-39,12],[12,7,-21,12,10,1,6,-1],[8,-7,10,11,-3,-31,6,12],[4,-3,6,-1,12,0],[-52,-54,10,-1,-49,-6,-55,7,-1],[]]),ra.g0d=function(){return"function"==typeof ra.v9d.U9d?ra.v9d.U9d.apply(ra.v9d,arguments):ra.v9d.U9d},ra.K0d=function(){return"function"==typeof ra.v9d.Z2?ra.v9d.Z2.apply(ra.v9d,arguments):ra.v9d.Z2},ra.X23=(h=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{J0:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=h(s,3432918353),a=5*(a=(524287&(a^=s=h(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=h(s,3432918353),a^=s=h(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=h(a^=a>>>16,2246822507),a=h(a^=a>>>13,3266489909),a^=a>>>16}}),ra.i0d=function(){return"function"==typeof ra.v9d.X2?ra.v9d.X2.apply(ra.v9d,arguments):ra.v9d.X2},ra.X9N=function(){return"function"==typeof ra.k9N.J0?ra.k9N.J0.apply(ra.k9N,arguments):ra.k9N.J0},ra.p0d=function(){return"function"==typeof ra.v9d.Z2?ra.v9d.Z2.apply(ra.v9d,arguments):ra.v9d.Z2},ra.P5A=function(){return"function"==typeof ra.Z4A.X2?ra.Z4A.X2.apply(ra.Z4A,arguments):ra.Z4A.X2},ra.H54=function(){return"function"==typeof ra.p54.Z2?ra.p54.Z2.apply(ra.p54,arguments):ra.p54.Z2},ra.m0d=function(){return"function"==typeof ra.v9d.X2?ra.v9d.X2.apply(ra.v9d,arguments):ra.v9d.X2},ra.I9d=function(){return"function"==typeof ra.v9d.J0?ra.v9d.J0.apply(ra.v9d,arguments):ra.v9d.J0},ra.p54=function(){for(;;)return{k54:function(){for(var t=2;9!==t;)switch(t){case 1:t=1!==e?5:9;break;case 2:var e=2;t=1;break;case 5:t=2===e?4:1;break;case 3:t=e=1;break;case 4:!function(){for(var t=2;40!==t;)switch(t){case 31:s+=o,s+=i,s+=e,s+=n,s+=r,s+=o,t=42;break;case 32:t=18===a?31:1;break;case 19:a=22,t=1;break;case 8:h+=r,t=7;break;case 24:a=6,t=1;break;case 17:var e="e",i="d";t=15;break;case 7:a=11,t=1;break;case 18:t=5===a?17:23;break;case 10:s+=i;typeof window!==s?window:typeof global!==h&&global;t=19;break;case 2:var a=2;t=1;break;case 11:t=24===a?10:18;break;case 42:s+=e,t=41;break;case 14:var r="i",n="f";t=12;break;case 6:t=2===a?14:11;break;case 1:t=22!==a?5:40;break;case 22:h+=o,h+=e,h+=i;var s=l;t=33;break;case 5:t=6===a?4:6;break;case 33:a=18,t=1;break;case 4:h+=i,h+=e,h+=n,t=8;break;case 41:a=24,t=1;break;case 12:a=5,t=1;break;case 23:t=11===a?22:32;break;case 15:var o="n",l="u",h=l;h+=o,t=24}}(),t=3}}}}(),ra.q9N=function(){return"function"==typeof ra.k9N.J0?ra.k9N.J0.apply(ra.k9N,arguments):ra.k9N.J0},ra.X54=function(){return"function"==typeof ra.p54.J0?ra.p54.J0.apply(ra.p54,arguments):ra.p54.J0},ra.J0d=function(){return"function"==typeof ra.v9d.u9d?ra.v9d.u9d.apply(ra.v9d,arguments):ra.v9d.u9d},ra.n54=function(){return"function"==typeof ra.p54.u9d?ra.p54.u9d.apply(ra.p54,arguments):ra.p54.u9d},ra.g54=function(){return"function"==typeof ra.p54.X2?ra.p54.X2.apply(ra.p54,arguments):ra.p54.X2},ra.s0d=function(){return"function"==typeof ra.v9d.U9d?ra.v9d.U9d.apply(ra.v9d,arguments):ra.v9d.U9d},ra.R54=function(){return"function"==typeof ra.p54.J0?ra.p54.J0.apply(ra.p54,arguments):ra.p54.J0},ra.m5A=function(){return"function"==typeof ra.Z4A.S4A?ra.Z4A.S4A.apply(ra.Z4A,arguments):ra.Z4A.S4A},ra.D5A=function(){return"function"==typeof ra.Z4A.J0?ra.Z4A.J0.apply(ra.Z4A,arguments):ra.Z4A.J0},ra.e54=function(){return"function"==typeof ra.p54.k54?ra.p54.k54.apply(ra.p54,arguments):ra.p54.k54},ra.m9N=function(){return"function"==typeof ra.k9N.Z2?ra.k9N.Z2.apply(ra.k9N,arguments):ra.k9N.Z2},ra.b23=function(){return"function"==typeof ra.X23.X2?ra.X23.X2.apply(ra.X23,arguments):ra.X23.X2},ra.F9N=function(){return"function"==typeof ra.k9N.X2?ra.k9N.X2.apply(ra.k9N,arguments):ra.k9N.X2},ra.h23=function(){return"function"==typeof ra.X23.J0?ra.X23.J0.apply(ra.X23,arguments):ra.X23.J0},ra.d54=function(){return"function"==typeof ra.p54.u9d?ra.p54.u9d.apply(ra.p54,arguments):ra.p54.u9d},ra.d5A=function(){return"function"==typeof ra.Z4A.k54?ra.Z4A.k54.apply(ra.Z4A,arguments):ra.Z4A.k54},ra.B54=function(){return"function"==typeof ra.p54.Z2?ra.p54.Z2.apply(ra.p54,arguments):ra.p54.Z2},ra.V54=function(){return"function"==typeof ra.p54.k54?ra.p54.k54.apply(ra.p54,arguments):ra.p54.k54},ra.k9N={Z2:function(){var t,e=arguments;switch(n){case 31:t=(e[0]-e[1])*e[2];break;case 46:t=((e[1]-e[0])*e[3]+e[2])/-e[4];break;case 47:t=e[3]*e[1]/(e[2]+e[0]);break;case 25:t=e[1]+e[0]*e[2];break;case 27:t=e[2]-e[0]+e[1];break;case 38:t=e[0]+e[2]-e[1];break;case 5:t=e[0]*e[1];break;case 39:t=e[2]-e[1]-e[0];break;case 36:t=e[2]/(e[1]*e[0]);break;case 21:t=e[2]*(e[0]-e[1]);break;case 26:t=e[2]+e[0]+e[1];break;case 1:t=(-e[1]-e[2])/e[3]+e[0];break;case 9:t=e[0]/e[2]*e[1];break;case 4:t=e[1]==e[0];break;case 19:t=(e[3]-e[4]-e[1])*-e[2]/e[0];break;case 29:t=(e[1]+e[0])/e[2]*e[3];break;case 13:t=(e[4]-e[3]+e[1])*e[2]/e[0];break;case 32:t=e[0]+(e[4]+e[1]*e[2])*e[3];break;case 42:t=e[1]/(e[2]|e[0]);break;case 2:t=e[1]*e[3]-e[0]+e[2];break;case 11:t=e[0]-e[1]*e[2];break;case 16:t=e[1]*-e[3]/e[2]+e[0]/e[4];break;case 24:t=(e[3]-e[2])*e[0]-e[1];break;case 28:t=e[1]+e[0]+ +e[2];break;case 48:t=(-e[1]-e[3]-e[4])*-e[2]/e[0];break;case 43:t=(-e[1]-e[2])/-e[0];break;case 50:t=e[1]-+e[0];break;case 22:t=e[1]-e[0]-e[2]+e[4]+e[3];break;case 30:t=e[0]+ +e[1];break;case 12:t=e[0]*e[2]-e[1];break;case 3:t=e[0]-e[1];break;case 41:t=(-e[1]-e[2])*e[3]+e[0];break;case 35:t=e[1]-e[2]*(e[0]+e[3]);break;case 33:t=e[2]*e[1]*e[3]-e[0];break;case 8:t=(e[0]+e[3]+e[2])/e[1];break;case 14:t=e[4]*(e[0]-e[3])-e[1]-e[2];break;case 34:t=(-e[3]-e[2]-e[1])/-e[0];break;case 23:t=(e[1]+e[0])*e[3]/e[4]/e[2];break;case 49:t=e[3]/e[2]-e[0]/e[1];break;case 10:t=e[0]/e[1];break;case 0:t=e[1]+e[0];break;case 18:t=e[0]*e[1]/e[2];break;case 17:t=(e[1]+e[2])/e[0];break;case 6:t=+e[1]*e[0];break;case 7:t=e[3]*e[2]*e[1]*e[0];break;case 44:t=e[1]*e[2]+e[3]*e[0];break;case 40:t=e[0]!=e[1];break;case 20:t=e[1]|e[0];break;case 37:t=e[1]/+e[0];break;case 45:t=(e[3]-e[5])*(e[1]-e[4])+(e[7]-e[2])*(e[6]-e[0]);break;case 15:t=e[2]-e[1]-e[0]}return t},X2:function(t){n=t}},ra.S5A=function(){return"function"==typeof ra.Z4A.U9d?ra.Z4A.U9d.apply(ra.Z4A,arguments):ra.Z4A.U9d},ra.V5A=function(){return"function"==typeof ra.Z4A.k54?ra.Z4A.k54.apply(ra.Z4A,arguments):ra.Z4A.k54},ra.A0d=function(){return"function"==typeof ra.v9d.J0?ra.v9d.J0.apply(ra.v9d,arguments):ra.v9d.J0},ra.D54=function(){return"function"==typeof ra.p54.U9d?ra.p54.U9d.apply(ra.p54,arguments):ra.p54.U9d},ra.s23=function(){return"function"==typeof ra.X23.X2?ra.X23.X2.apply(ra.X23,arguments):ra.X23.X2},ra.j6c=function(t){return ra.m5A(t)},ra.r5c=function(t){if(t)return ra.H5A(t)},ra.B5c=function(t){return ra.m5A(t)},ra.d4c=function(t){if(t)return ra.m5A(t)},ra.f7A=function(t){if(t)return ra.m5A(t)},ra.v6A=function(t){if(t)return ra.H5A(t)},ra.a6A=function(t){if(t)return ra.m5A(t)},ra.u5A=function(t){if(t)return ra.H5A(t)},s=function(t){var $i=ra;$i.G6c=function(t){if($i&&t)return $i.m5A(t)},$i.N5c=function(t){if($i)return $i.H5A(t)},$i.x5c=function(t){if($i&&t)return $i.H5A(t)},$i.w4c=function(t){if($i&&t)return $i.m5A(t)};var ta="createDataSet",ea="prototype",ia="ChartEngine";$i.C7A=function(t){if($i&&t)return $i.m5A(t)},$i.z6A=function(t){if($i&&t)return $i.m5A(t)},$i.Q5A=function(t){if($i&&t)return $i.m5A(t)};var aa,Zt,Xi="mousemoveinner",Zi="ChartEngine";return aa=t.CIQ,Zt=t.SplinePlotter,aa.ChartEngine.prototype.drawXAxis=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S;if("drawX","A","xis","l","e","f","t"," "," "," ","d","rawXAxi","s",i=[t,e],!this.runPrepend("drawXAxis",i)&&e&&!t.xAxis.noDraw){a=this.chart.context,this.canvasFont("stx_xaxis"),r=this.getCanvasFontSize("stx_xaxis"),a.textAlign="center",a.textBaseline="middle",s=a.measureText("   ").width;for(var b=0;b<e.length;b++){n=e[b],o=a.measureText(n.text).width,$i.n9N(0),l=Math.max($i.m9N(s,o),t.xAxis.minimumLabelWidth),n.hz=Math.floor(n.hz+this.micropixels)+.5,$i.F9N(1);var w=$i.S9N(7,5,15,4);n.left=n.hz-l/w,$i.n9N(2);var T=$i.m9N(105,7,16,13);n.right=n.hz+l/T,n.unpaddedRight=n.hz+o/2}if(h=!0===this.xAxisAsFooter?this.chart.canvasHeight:t.panel.bottom,$i.F9N(3),c=this.whichPanel($i.m9N(h,1))){for(var D in this.adjustYAxisHeightOffset(c,c.yAxis),u=t.xAxis.displayBorder||null===t.xAxis.displayBorder,!0===this.axisBorders&&(u=!0),!1===this.axisBorders&&(u=!1),p=h-this.xaxisHeight+r,u&&(p+=3),d=!0,this.panels)if("stx_gri","d","_b","order","str","oke","bo","r","d","er","st","ro","k","e","l","ine",!(m=this.panels[D]).hidden&&!1!==m.shareChartXAxis&&($i.n9N(4),g=$i.S9N(c,m),f=m.yAxis)){y=-Number.MAX_VALUE,v=Number.MAX_VALUE;for(var A=0;A<e.length;A++)if("boundary"==e[A].grid){v=e[A].left;break}a.save(),a.beginPath(),a.rect(m.left,m.top+(d?0:1),m.width,m.height-1),a.clip(),d=!1,(x=new aa.Plotter).newSeries("line","stroke",this.canvasStyle("stx_grid")),x.newSeries("boundary","stroke",this.canvasStyle("stx_grid_dark")),x.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));for(var M=0;M<e.length;M++){if(n=e[M],M==A){for(A++;A<e.length;A++)if("boundary"==e[A].grid){v=e[A].left;break}A>=e.length&&(A=-1,v=Number.MAX_VALUE)}else if(n.right>v)continue;n.left<y||(y=n.right,Math.floor(n.left)<=m.right&&(Math.floor(n.hz)>m.left&&(t.xAxis.displayGridLines&&(x.moveTo(n.grid,n.hz,f.top),x.lineTo(n.grid,n.hz,f.bottom)),g&&u&&("bor","de","r",x.moveTo("border",n.hz,f.bottom+.5),x.lineTo("border",n.hz,f.bottom+6))),g&&n.right>m.left&&("bou","n","dary",this.canvasColor("boundary"==n.grid?"stx_xaxis_dark":"stx_xaxis"),a.fillText(n.text,n.hz,p))))}u&&(C=Math.round(f.bottom+f.bottomOffset)+.5,S=Math.round(m.right)+.5,x.moveTo("border",m.left,C),x.lineTo("border",S,C)),x.draw(a),a.restore()}a.textAlign="left",this.runAppend("drawXAxis",i)}}},aa.ChartEngine.prototype.createTickXAxisWithDates=function(a){var t,e,i,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H,R,z,B,V,W,j,U,Y,X,Z,q,G,K,J,Q,$,tt,et;a||(a=this.chart),a.xaxis=[],e=a.context,i=[aa.MILLISECOND,aa.SECOND,aa.MINUTE,aa.HOUR,aa.DAY,aa.MONTH,aa.YEAR],this.timeIntervalMap||("1","0:","00",(t={})[aa.MILLISECOND]={arr:[1,2,5,10,20,50,100,250,500],minTimeUnit:0,maxTimeUnit:1e3,approxWidth:2*e.measureText("10:00:00.000").width},t[aa.SECOND]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*e.measureText("10:00:00").width},t[aa.MINUTE]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*e.measureText("10:00").width},t[aa.HOUR]={arr:[1,2,3,4,6,12],minTimeUnit:0,maxTimeUnit:24,approxWidth:2*e.measureText("10:00").width},t[aa.DAY]={arr:[1,2,7,14],minTimeUnit:1,maxTimeUnit:32,approxWidth:2*e.measureText("30").width},t[aa.MONTH]={arr:[1,2,3,6],minTimeUnit:1,maxTimeUnit:13,approxWidth:2*e.measureText("Mar").width},t[aa.YEAR]={arr:[1,2,3,5],minTimeUnit:1,maxTimeUnit:2e7,approxWidth:2*e.measureText("2000").width},t[aa.DECADE]={arr:[10],minTimeUnit:0,maxTimeUnit:2e6,approxWidth:2*e.measureText("2000").width},this.timeIntervalMap=t),t=this.timeIntervalMap,r=[31,28,31,30,31,30,31,31,30,31,30,31],n=this.layout.periodicity,s=this.layout.interval,o=a.maxTicks,l=a.dataSegment,h=a.xAxis,c=l.length,u=h.idealTickSizePixels||h.autoComputedTickSizePixels,p=this.chart.width/u;for(var it=0;it<c&&!l[it];it++);if(it==c)return[];switch(d=0,m=this.layout.timeUnit||"minute",isNaN(s)&&(m=s,s=1),g=0,m){case"millisecond":$i.n9N(5),g=$i.m9N("1",1);break;case"second":g=1e3,i.splice(0,1);break;case"minute":g=6e4,i.splice(0,2);break;case"day":g=864e5,$i.F9N(5),i.splice(0,$i.S9N("4",1));break;case"week":$i.n9N(6),g=$i.m9N(7,"86400000"),$i.n9N(3),i.splice($i.S9N("0",0),4);break;case"month":$i.F9N(5),g=$i.S9N(864e5,30),i.splice(0,5)}if(f=this.layout.aggregationType,!g||f&&"ohlc"!=f&&"heikinashi"!=f)d=l[c-1].DT.getTime()-l[it].DT.getTime();else{-1125642203,$i.n9N(3),y=$i.m9N("1435816563",0),v=2;for(var at=1;-1125642203!==$i.g23(at.toString(),at.toString().length,21263);at++)$i.n9N(7),d=$i.S9N(c,g,n,s),v+=2;$i.h23(v.toString(),v.toString().length,66166)!==y&&($i.F9N(8),d=$i.S9N(s,c,g,n))}if(x=this,0===d){-937490769,77000803,C=2;for(var rt=1;-937490769!==$i.g23(rt.toString(),rt.toString().length,52865);rt++)d=ot()*o,C+=2;77000803!==$i.g23(C.toString(),C.toString().length,3814)&&(d=ot()+o)}else $i.F9N(9),d=$i.m9N(d,o,c);for($i.n9N(10),S=$i.m9N(d,p),b=0;b<i.length&&!(i[b]>S+.001);b++);if(S<1){-980424792,352663331,w=2;for(var nt=1;-980424792!==$i.g23(nt.toString(),nt.toString().length,56839);nt++)console.log(""),w+=2;352663331!==$i.g23(w.toString(),w.toString().length,38619)&&console.log(""),console.log("createTickXAxisWithDates: Assertion error. msPerGridLine < 1. Make sure your masterData has correct time stamps for the active periodicity and it is sorted from OLDEST to NEWEST.")}function st(t){var e,i;if(A==aa.MILLISECOND)e=t.getMilliseconds(),i=t.getSeconds();else if(A==aa.SECOND)e=t.getSeconds(),i=t.getMinutes();else if(A==aa.MINUTE)e=t.getMinutes(),i=t.getHours();else if(A==aa.HOUR)e=t.getHours()+t.getMinutes()/60,i=t.getDate();else if(A==aa.DAY)e=t.getDate(),i=t.getMonth()+1;else if(A==aa.MONTH)e=t.getMonth()+1,i=t.getFullYear();else if(A==aa.YEAR){e=t.getFullYear(),$i.F9N(3);var a=$i.m9N(3e3,2e3);i=t.getFullYear()+a}else e=t.getFullYear(),i=0;return[e,i]}for(b==i.length?b--:0<b&&($i.F9N(3),S-(T=i[$i.S9N(b,1)])*(D=t[T].arr)[D.length-1]<i[b]-S&&b--),A=h.timeUnit||i[b],h.activeTimeUnit=A,k=(M=aa.clone(t[A])).arr,b=0;b<k.length&&!(k[b]*A>S);b++);function ot(){var t,e,i;return t={begin:new Date,interval:"day",periodicity:1},(e=a.market.newIterator(t)).next(),i=e.previous(),(e=x.standardMarketIterator(i,null,a)).next().getTime()-i.getTime()}for(b==k.length?b--:S-k[b-1]*A<k[b]*A-S&&b--,M.approxWidth<this.layout.candleWidth&&(b=0),F=h.timeUnitMultiplier||k[b],P=[],_=this.layout.candleWidth,b=0;b<=o&&!l[b];b++);if(0<b&&b<o){N=this.standardMarketIterator(l[b].DT,h.adjustTimeZone?this.displayZone:null);for(var lt=b;0<lt;lt--)E={},a.lineApproximation&&_<1||(L=N.previous(),E.DT=L),a.xaxis.unshift(E)}for(O=0,I=M.minTimeUnit,H=-1,R=!0,z=st(l[b].DT),W=V=0,j=l[b].tick;V<j&&(B=st(this.chart.dataSet[j-V].DT))[1]==z[1];V++)z=B;for(;W<this.chart.dataSet.length-j&&(B=st(this.chart.dataSet[j+W].DT))[1]==z[1];W++)z=B;for(U=null,b=0;b<o+W;b++){if((Y=l[b])?V&&(Y=a.dataSet[Y.tick-V]):Y=a.xaxis[b],b<c)O=(X=Y).displayDate&&h.adjustTimeZone?X.displayDate:X.DT,b&&!V&&a.segmentImage&&(_=((Z=a.segmentImage[b]).leftOffset-Z.candleWidth/2)/b);else{if("t","i","ck","tick"==this.layout.interval&&!h.futureTicksInterval)break;if(a.lineApproximation&&_<1)break;if(!h.futureTicks)break;U||(U=this.standardMarketIterator(l[c-1].DT,h.adjustTimeZone?this.displayZone:null)),O=U.next()}if(O){if(q=null,$i.F9N(3),K=$i.m9N(b,V),(J={DT:O}).data=b<c?Y:null,V?(V--,b--):a.xaxis[b]||a.xaxis.push(J),Q=(z=st(O))[0],H!=($=z[1])){Q<=I&&(I=M.minTimeUnit),$i.F9N(10);var ht=$i.m9N(16,16);if(G=a.left+K*_-ht,q=null,A==aa.HOUR||A==aa.MINUTE&&$<H)if(h.formatter)q=h.formatter(O,"boundary",aa.DAY,1);else if(this.internationalizer)q=this.internationalizer.monthDay.format(O);else{$i.F9N(11);var ct=$i.m9N(151,15,10);$i.n9N(3);$i.m9N(49257,43784);$i.F9N(12);var ut=$i.m9N(9,50599,6323);$i.F9N(13);$i.S9N(447,9,4580,20,458);$i.n9N(3);$i.m9N(1484,14);$i.n9N(14);$i.S9N(6930,4,13844,10,3);q=O.getMonth()+ct+(2502!=ut&&"/")+O.getDate()}else A==aa.DAY?q=$<H?h.formatter?("boundar","y",h.formatter(O,"boundary",aa.YEAR,1)):O.getFullYear():h.formatter?h.formatter(O,"boundary",aa.MONTH,1):aa.monthAsDisplay(O.getMonth(),!1,this):A==aa.MONTH&&(q=h.formatter?h.formatter(O,"boundary",aa.YEAR,1):O.getFullYear());q&&-1!=H&&("boundar","y",P.push(new aa.ChartEngine.XAxisLabel(G,"boundary",q)))}if(I<=Q){if(I==M.minTimeUnit&&$==H)continue;tt=new Date(+O),$i.F9N(15);var pt=$i.S9N(13,15,30);$i.F9N(12);var dt=$i.m9N(9,170,19);$i.F9N(16);var mt=$i.m9N(42,16,5,2,5);$i.F9N(17);var gt=$i.m9N(29,15,14);if(G=a.left+(pt*K+dt)*_/mt-gt,(et=Math.floor(Q/F)*F)<Q&&("week"==this.layout.interval?et=Q:($i.n9N(10),G-=$i.S9N(_,2))),A==aa.MILLISECOND?tt.setMilliseconds(et):A==aa.SECOND?(tt.setMilliseconds(0),tt.setSeconds(et)):A==aa.MINUTE?(tt.setMilliseconds(0),tt.setSeconds(0),tt.setMinutes(et)):A==aa.HOUR?(tt.setMilliseconds(0),tt.setSeconds(0),tt.setMinutes(0),tt.setHours(et)):A==aa.DAY?tt.setDate(Math.max(1,et)):A==aa.MONTH?(tt.setDate(1),$i.F9N(3),tt.setMonth($i.S9N(et,1))):(aa.YEAR,tt.setDate(1),tt.setMonth(0)),$i.n9N(0),I=$i.S9N(F,et),A==aa.DAY){$i.n9N(10);var ft=$i.S9N(180,180);M.maxTimeUnit=r[tt.getMonth()]+ft}if(I>=M.maxTimeUnit&&(I=M.minTimeUnit),H=$,R&&et<Q){R=!1;continue}q=h.formatter?("l","in","e",h.formatter(tt,"line",A,F)):A==aa.DAY?tt.getDate():A==aa.MONTH?aa.monthAsDisplay(tt.getMonth(),!1,this):A==aa.YEAR||A==aa.DECADE?tt.getFullYear():aa.timeAsDisplay(tt,this,A),P.push(new aa.ChartEngine.XAxisLabel(G,"line",q))}}}return P},aa.ChartEngine.prototype.createYAxis=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M;if("crea","teYAxis",!this.runPrepend("createYAxis",arguments)){if(i=t.chart,a=t.name==i.name,e||(e={}),e.noChange=!1,r=e.yAxis?e.yAxis:t.yAxis,aa.ChartEngine.enableCaching&&r.high==t.cacheHigh&&r.low==t.cacheLow){s=(n=i.dataSet.length-i.scroll-1)+i.maxTicks+1,t.cacheLeft=n,800366775,$i.n9N(5),o=-$i.S9N("1002789099",1),l=2;for(var k=1;800366775!==$i.h23(k.toString(),k.toString().length,51009);k++)t.cacheRight=s,e.noChange=!0,l+=2;$i.h23(l.toString(),l.toString().length,4896)!==o&&(t.cacheRight=s,e.noChange=!1)}else t.cacheLeft=1e6,t.cacheRight=-1,t.cacheHigh=r.high,t.cacheLow=r.low;if(h=i.xAxis.idealTickSizePixels?i.xAxis.idealTickSizePixels:i.xAxis.autoComputedTickSizePixels,r.goldenRatioYAxis&&r.idealTickSizePixels!=h/1.618&&(e.noChange=!1),!e.noChange){if("pr","oject","ion",this.adjustYAxisHeightOffset(t,r),c=r.height=r.bottom-r.top,u=(r.high-r.low)/(c-r.zoom),e.ground&&!r.semiLog)r.high=r.high+r.zoom*u;else if(r.high=r.high+r.zoom/2*u+r.scroll*u,p=r.low,r.semiLog){$i.n9N(18);var F=$i.m9N(28,13,182);d=r.zoom/F*u/(r.high/r.low),r.low=r.low-d+r.scroll*u,r.low<.1*p&&($i.n9N(5),r.low=$i.m9N(p,.1))}else{$i.F9N(19);var P=$i.S9N(5,10,2,16,11);r.low=r.low-r.zoom/P*u+r.scroll*u}if((r.min||0===r.min)&&(r.low=r.min),(r.max||0===r.max)&&(r.high=r.max),r.shadow=r.high-r.low,!r.semiLog||this.activeDrawing&&"projection"==this.activeDrawing.name||(r.logHigh=Math.log(r.high)/Math.LN10,m=Math.max(r.low,1e-9),r.logLow=Math.log(m)/Math.LN10,r.low<=0&&(r.logLow=0),r.logShadow=r.logHigh-r.logLow),r.goldenRatioYAxis&&a)$i.F9N(10),r.idealTickSizePixels=$i.m9N(h,1.618),0===r.idealTickSizePixels&&(g=this.getCanvasFontSize("stx_yaxis"),$i.n9N(5),r.idealTickSizePixels=$i.m9N(g,5));else if(!r.idealTickSizePixels)if("stx","_yaxis",g=this.getCanvasFontSize("stx_yaxis"),a)$i.F9N(5),r.idealTickSizePixels=$i.S9N(g,5);else{$i.F9N(20),f=$i.S9N(0,"1826537483"),1938502520,y=2;for(var _=1;$i.h23(_.toString(),_.toString().length,25323)!==f;_++)$i.n9N(21),r.idealTickSizePixels=$i.m9N("2",0,g),y+=2;1938502520!==$i.h23(y.toString(),y.toString().length,78664)&&($i.F9N(10),r.idealTickSizePixels=$i.m9N(g,0))}v=Math.round(c/r.idealTickSizePixels),x=e.range?e.range[1]-e.range[0]:r.shadow,$i.F9N(10),r.priceTick=Math.floor($i.m9N(x,v)),C=1;for(var N=0;N<10&&!(0<r.priceTick);N++)$i.n9N(5),C*=$i.m9N("10",1),r.priceTick=Math.floor(x/v*C)/C;if(10==N&&(r.priceTick=1e-8),r.priceTick=Math.round(x/v*C)/C,S=Math.round(x/r.priceTick),e.range&&S<x&&!r.noEvenDivisorTicks){for(;1<=S&&x%S!=0;)S--;$i.n9N(10),r.priceTick=$i.S9N(x,S)}if(r.minimumPriceTick){b=r.minimumPriceTick,g=this.getCanvasFontSize("stx_yaxis");for(var E=0;E<100&&($i.n9N(10),c/$i.m9N(x,b)<2*g);E++)b+=r.minimumPriceTick;E<100&&(r.priceTick=b)}r.multiplier=r.height/r.shadow}if(r.priceTick<=0||r.priceTick===1/0){-876992390,$i.n9N(3),w=-$i.m9N("1512621266",0),T=2;for(var L=1;-876992390!==$i.g23(L.toString(),L.toString().length,69935);L++)r.priceTick=1,T+=2;$i.h23(T.toString(),T.toString().length,33717)!==w&&(r.priceTick=7)}if(this.activeDrawing&&"projection"==this.activeDrawing.name||(r.high=this.transformedPriceFromPixel(r.top,t,r),r.semiLog&&(r.logHigh=Math.log(r.high)/Math.LN10,D=Math.max(r.low,1e-11),r.logLow=Math.log(D)/Math.LN10,r.logShadow=r.logHigh-r.logLow),r.shadow=r.high-r.low),r.multiplier=r.height/r.shadow,r.multiplier==1/0&&(r.multiplier=0),r.decimalPlaces||0===r.decimalPlaces)r.printDecimalPlaces=r.decimalPlaces;else if(a){for(var O=A=0;O<t.yAxis.shadowBreaks.length;O++)M=t.yAxis.shadowBreaks[O],t.yAxis.shadow<M[0]&&(A=M[1]);r.printDecimalPlaces=A}else r.printDecimalPlaces=null;this.runAppend("createYAxis",arguments)}},aa.ChartEngine.prototype.drawYAxis=function(t,e){var h,i,a,r,n,s,o,l,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F;if("drawYAx","is",e||(e={}),h=e.yAxis?e.yAxis:t.yAxis,!t.hidden&&!h.noDraw&&h.width){if(h.priceFormatter!=aa.Comparison.priceFormat&&(h.fractional?(h.originalPriceFormatter||(h.originalPriceFormatter={func:h.priceFormatter}),h.fractional.resolution||(h.fractional.resolution=h.minimumPrice),h.fractional.formatter||(h.fractional.formatter="'"),h.priceFormatter||(h.priceFormatter=function(t,e,i){var a,r,n,s;if(h.fractional){a="",i<0&&(a="-",i=Math.abs(i)),r=Math.floor(Math.round(i/h.fractional.resolution)*h.fractional.resolution),n=Math.round((i-r)/h.fractional.resolution),s=Math.floor(n),$i.n9N(10);$i.S9N(29330,7);$i.n9N(3);var o=$i.m9N(837,7);$i.F9N(22);$i.m9N(15,3444,27,4,18);$i.F9N(0);$i.m9N(7,9745);$i.F9N(23);var l=$i.S9N(7,13,12,3,5);$i.n9N(0);$i.m9N(8,678);return a+r+h.fractional.formatter+(s<10?o<=104.5?270.32:!(1897<="4260"*l)||"0":"")+s+(.5<=n-s?"+":"")}})):h.originalPriceFormatter&&(h.priceFormatter=h.originalPriceFormatter.func,h.originalPriceFormatter=null)),h.pretty)return this.drawYAxisPretty(t,e);if(!this.runPrepend("drawYAxis",arguments)){if(!e.noDraw&&!h.noDraw){if(!(i=h.yAxisPlotter)||!e.noChange){if("stx_g","rid_bord","er","f","il","l","te","x","t","st","x_gr","id","stx_yax","is",i=h.yAxisPlotter=new aa.Plotter,a=t.chart,r=t.name==a.name&&h.name===t.yAxis.name,!h.priceTick)return;if(n=h.shadow,(s=e.range)&&(n=s[1]-s[0]),o=n/h.priceTick,o=Math.round(o),h.semiLog&&(l=Math.log(this.valueFromPixel(h.bottom,t))/Math.LN10,c=(h.logHigh-h.logLow)/o),u=h.textStyle?h.textStyle:"stx_yaxis",i.newSeries("grid","stroke",this.canvasStyle("stx_grid")),i.newSeries("text","fill",this.colorOrStyle(u)),i.newSeries("border","stroke",this.canvasStyle("stx_grid_border")),p=0,d=s?s[1]:h.high,m=s?s[0]:h.low,g=null===h.displayBorder?a.panel.yAxis.displayBorder:h.displayBorder,!1===this.axisBorders&&(g=!1),!0===this.axisBorders&&(g=!0),v=(y=a.dynamicYAxis)?h.width:NaN,f="left"==(x=null===h.position?a.panel.yAxis.position:h.position)?h.left+h.width:h.left,C=Math.round(f)+.5,S=g?3:0,"left"==x&&(S=g?-3:0),r)if(h.shadow<1){$i.n9N(24);var P=$i.S9N(15,170,14,26);$i.F9N(3);var _=$i.S9N(20,19);p=(parseInt(m/h.priceTick,P)+_)*h.priceTick-m}else p=h.priceTick-Math.round(m%h.priceTick*t.chart.roundit)/t.chart.roundit;else p=d%h.priceTick;b=this.getCanvasFontSize("stx_yaxis");for(var N=0;N<o;N++)if(w=h.semiLog?($i.n9N(25),T=$i.m9N(N,l,c),Math.pow(10,T)):r?m+N*h.priceTick+p:d-N*h.priceTick-p,D=this.pixelFromTransformedValue(w,t,h),!((A=Math.round(D)+.5)+b/2>t.bottom||A-b/2<t.top||Math.abs(A-h.bottom)<1)){if(h.displayGridLines&&("gr","i","d",i.moveTo("grid",t.left+1,A),i.lineTo("grid",t.right-1,A)),g&&($i.F9N(11),i.moveTo("border",$i.S9N(C,"0.5",1),A),$i.F9N(0),i.lineTo("border",$i.m9N(S,C),A)),w=h.priceFormatter?h.priceFormatter(this,t,w):this.formatYAxisPrice(w,t,null,h),M=h.textBackground?this.containerColor:null,$i.F9N(26),k=$i.S9N(S,3,f),"left"==x){$i.n9N(27);var E=$i.m9N(25,13,15);k=h.left+E,h.justifyRight&&(k=h.left+h.width+S-3)}else h.justifyRight&&(k=f+h.width);i.addText("text",w,k,A,M,null,b),y&&(v=Math.max(v,a.context.measureText(w).width))}if(g&&("b","o","rde","r",F=Math.round(h.bottom)+.5,i.moveTo("border",C,h.top),i.lineTo("border",C,F),i.draw(this.chart.context,"border")),y&&v>h.width)throw h._dynamicWidth=v,this.calculateYAxisPositions(),new Error("reboot draw");if(!y&&h._dynamicWidth)throw"reboo","t draw",this.resetDynamicYAxis({chartName:a.name}),new Error("reboot draw")}h==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}}},aa.ChartEngine.prototype.drawYAxisPretty=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H,R,z;if("dr","awY","Axis",!this.runPrepend("drawYAxis",arguments)&&(e||(e={}),i=e.yAxis?e.yAxis:t.yAxis,!t.hidden&&!i.noDraw&&i.width)){if(!e.noDraw){if(!(a=i.yAxisPlotter)||!e.noChange){if("stx_yaxi","s","le","f","t","s","tro","k","e","s","trok","e","g","r","i","d","stx_yaxi","s",a=i.yAxisPlotter=new aa.Plotter,r=t.chart,!i.priceTick)return;if(isNaN(i.high)||isNaN(i.low))return;n=i.shadow,e.range&&(n=e.range[1]-e.range[0]),s=i.height/i.idealTickSizePixels,s=Math.round(s),o=i.textStyle?i.textStyle:"stx_yaxis",a.newSeries("grid","stroke",this.canvasStyle("stx_grid")),a.newSeries("text","fill",this.colorOrStyle(o)),a.newSeries("border","stroke",this.canvasStyle("stx_grid_border")),h=(l=e.range)?l[1]:i.high,c=l?l[0]:i.low,u=null===i.displayBorder?r.panel.yAxis.displayBorder:i.displayBorder,!1===this.axisBorders&&(u=!1),!0===this.axisBorders&&(u=!0),m=(d=r.dynamicYAxis)?i.width:NaN,p="left"==(g=null===i.position?r.panel.yAxis.position:i.position)?i.left+i.width:i.left,f=Math.round(p)+.5,y=u?3:0,"left"==g&&(y=u?-3:0),v=this.getCanvasFontSize("stx_yaxis"),C=(x=i.increments).length,b=1,D=T=w=S=0,A=Number.MAX_VALUE;for(var B=0;B<100&&(w=x[S]*Math.pow(10,D),$i.n9N(10),b=Math.floor($i.S9N(n,w)),$i.F9N(3),!(A<(M=Math.abs($i.m9N(s,b)))));B++){if(A=M,b==s){T=w;break}s<b?C<=++S&&(S=0,D++):--S<0&&($i.n9N(3),S=$i.S9N(C,1),D--),T=w}if(k=Math.ceil(c/T)*T,F=i.bottom-this.pixelFromTransformedValue(k,t,i),$i.F9N(5),P=$i.S9N("0",1),F>i.idealTickSizePixels&&i.semiLog&&i.prettySemiLog){for(_=Math.ceil(c);_<k&&k%_!=0;++_);_<k&&(k===T&&(P=T=_),k=_)}N=0,E=Number.MAX_VALUE;for(var V=0;V<100&&($i.F9N(25),!(h<(L=$i.m9N(N,k,T))));V++)if(T+=P,N++,E-(O=this.pixelFromTransformedValue(L,t,i))<v+1&&0<P)V=N=0,E=Number.MAX_VALUE,T=P,P*=2,a.reset();else if(E=O,!((I=Math.round(O)+.5)+v/2>t.bottom||I-v/2<t.top||Math.abs(I-i.bottom)<1)){if(i.displayGridLines&&("g","r","i","d",a.moveTo("grid",t.left+1,I),a.lineTo("grid",t.right-1,I)),u&&("b","ord","er",$i.F9N(3),a.moveTo("border",$i.m9N(f,.5),I),$i.F9N(0),a.lineTo("border",$i.S9N(y,f),I)),L=i.priceFormatter?i.priceFormatter(this,t,L):this.formatYAxisPrice(L,t,null,i),H=i.textBackground?this.containerColor:null,$i.n9N(28),R=$i.S9N(y,p,"3"),"left"==g){$i.F9N(11);var W=$i.S9N(243,20,12);if(R=i.left+W,i.justifyRight){$i.n9N(29);var j=$i.m9N(15,51,396,18);R=i.left+i.width+y-j}}else i.justifyRight&&(R=p+i.width);a.addText("text",L,R,I,H,null,v),d&&(m=Math.max(m,r.context.measureText(L).width))}if(100<=V&&("drawYAxisPretty: assertion e","rror. zz reached 100",console.log("drawYAxisPretty: assertion error. zz reached 100")),u&&(z=Math.round(i.bottom)+.5,a.moveTo("border",f,i.top),a.lineTo("border",f,z),a.draw(this.chart.context,"border")),d&&m>i.width)throw"r","eboot ","dra","w",i._dynamicWidth=m,this.calculateYAxisPositions(),new Error("reboot draw");if(!d&&i._dynamicWidth)throw this.resetDynamicYAxis({chartName:r.name}),new Error("reboot draw")}i==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}},aa.ChartEngine.prototype.drawHistogram=function(t,e){var i,w,a,T,D,r,n,s,A,o,M,l,h,c,u,k,F,P,_,N,E,L,p,d,m,g,f,y;if("c","h","ar","t",e&&e.length&&((i=t.panel)||(i="chart"),w=this.panels[i])){for(a=t.yAxis?t.yAxis:w.yAxis,T=t.subtype,D=this.chart.dataSegment,r=!1,this.getDefaultColor(),s=0;s<e.length;s++)r|=e[s].border_color_up&&!aa.isTransparent(e[s].border_color_up),r|=e[s].border_color_down&&!aa.isTransparent(e[s].border_color_down);!1===t.borders&&(r=!1),t.name||(t.name="Data"),A=a.multiplier,t.heightPercentage||(t.heightPercentage=.7),t.widthFactor||(t.widthFactor=.8);for(var v=M=o=0;v<this.chart.maxTicks;v++)if(l=D[v])for(s=h=0;s<e.length;s++)((c=l[e[s].field])||0===c)&&("st","ac","k","ed",n=e[s].subField||this.chart.defaultPlotField||"Close","object"==typeof c&&c[n]&&(c=c[n]),"stacked"==T?h+=c:h=c,o<h&&(o=h),h<M&&(M=h));if(0!==o||0!==M){for(u=Math.floor(a.top)+.5,t.bindToYAxis?k=Math.floor(this.pixelFromPrice(M,w,a))+.5:(k=Math.floor(a.bottom)+.5,A=(k-u)*t.heightPercentage/(o-M)),this.startClip(i),F=this.layout.candleWidth<=1||!r?0:.5,P=this.chart.context,_=Math.max(0,(1-t.widthFactor)*this.layout.candleWidth/2),N=new Array(D.length),E=[],L=this,$i.F9N(20),p=$i.m9N(0,"1"),s=0;s<e.length;s++){if("clustere","d",d=e[s],p=this.layout.candleWidth*t.widthFactor,_&&this.layout.candleWidth-p<=2&&(r=!1),m=0,"clustered"==T&&(m=s,p/=e.length),n=t.subField||this.chart.defaultPlotField||"Close","function"==typeof d.color_function){f={};for(var x=0;x<D.length;x++)if(D[x]){"string"==typeof(g=d.color_function(D[x]))&&(g={fill_color:g,border_color:g}),$i.F9N(33);var C=$i.S9N(852544,6713,8,16);$i.n9N(18);var S=$i.S9N(8268,690,689);$i.F9N(27);var b=$i.m9N(163508,14,172577);$i.n9N(0);$i.m9N(7594,949);(y=g.fill_color+(C<5790?247.48<=S?30.82===b&&7240:4750:",")+g.border_color)in f?f[y].positions.push(x):(g.positions=[x],f[y]=g)}for(y in f)g=f[y],O(d.field,n,g.fill_color,g.opacity,null,null,m,p,g.positions),O(d.field,n,g.border_color,g.opacity,!0,null,m,p,g.positions)}else O(d.field,n,d.fill_color_up,d.opacity_up,null,!0,m,p),O(d.field,n,d.fill_color_down,d.opacity_down,null,null,m,p),2<=this.layout.candleWidth&&r&&(O(d.field,n,d.border_color_up,d.opacity_up,!0,!0,m,p),O(d.field,n,d.border_color_down,d.opacity_down,!0,null,m,p));"stacked"==T&&(E=aa.shallowClone(N))}P.globalAlpha=1,this.endClip()}else this.watermark(i,"center","bottom",this.translateIf(t.name+" Not Available"))}function O(t,e,i,a,r,n,s,o,l){var h,c,u,p,d,m,g,f,y,v,x,C,S;a||(a=1),P.globalAlpha=aa.isIE8?.5:a,P.beginPath(),$i.F9N(30),h=$i.S9N(k,"0.5"),c=Math.floor(L.pixelFromBar(0,w.chart)-L.layout.candleWidth/2);for(var b=0;b<D.length;b++)"ob","je","ct",u=E[b]||k,0===b&&(h=u),D[b]&&D[b][t]?("object"==typeof(d=(p=D[b])[t])&&d[e]&&(d=d[e]),$i.F9N(31),m=$i.S9N(d,M,A),isNaN(m)||(g=L.layout.candleWidth,p.candleWidth&&(g=p.candleWidth,0===b&&(c=Math.floor(L.pixelFromBar(0,w.chart)-p.candleWidth/2))),f=Math.min(Math.floor(u-m)+.5,u),l&&-1==l.indexOf(b)||!l&&(n&&p.Close<p.iqPrevClose||!n&&p.Close>=p.iqPrevClose)?(h=f,c+=g):(y=g/L.layout.candleWidth,(C=_?($i.F9N(32),v=Math.round($i.S9N(c,s,o,y,_)),$i.n9N(0),x=$i.S9N(r?0:F,v),v+Math.round(o*y)-(r?0:F)):($i.n9N(32),v=$i.m9N(c,s,o,y,_),x=Math.round(v)+(r?0:F),Math.round(v+o*y)-(r?0:F)))-x<2&&($i.F9N(0),C=$i.m9N(1,x)),x%1==(S=r?0:.5)&&(x+=.5),C%1==S&&(C+=.5),P.moveTo(C,u),k!=u&&r&&!_&&E[b+1]&&P.moveTo(C,Math.max(f,Math.min(u,E[b+1]))),P.lineTo(C,f),P.lineTo(x,f),r&&s?(N[b]>f||0===b)&&P.lineTo(x,Math.min(u,N[b])):r&&!_&&"clustered"==T?0<b&&N[b-1]&&N[b-1]>f&&P.lineTo(x,Math.min(u,N[b-1])):r&&!_?(f<h||0===b)&&P.lineTo(x,Math.min(u,h)):P.lineTo(x,u),h=f,c+=g,("clustered"!=T||r)&&(N[b]=f)))):(h=u,c+=L.layout.candleWidth);r?("a","uto",P.strokeStyle=i&&"auto"!=i?i:L.defaultColor,P.stroke()):(P.fillStyle=i&&"auto"!=i?i:L.defaultColor,P.fill()),P.closePath()}},aa.ChartEngine.prototype.drawBarTypeChartInner=function(t){var e,i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H,R,z,B,V,W,j,U,Y,X,Z,q,G,K;e=t.type,i=t.panel,a=t.field,r=t.fillColor,n=t.borderColor,s=t.condition,o=t.style,l=t.yAxis,h=t.overlayScaling,$i.n9N(4),u=(c=$i.m9N("histogram",e))||"candle"==e,$i.n9N(4),p=$i.m9N("shadow",e),$i.F9N(4),d=$i.m9N("hlc",e),m="bar"==e||d,f=(g=i.chart).dataSegment,y=this.chart.context,v=i.yAxis.top,x=i.yAxis.bottom,C=new Array(f.length),S=0,n&&!aa.isTransparent(n)&&(S=.5),$i.F9N(3);var J=$i.S9N(11,10);b=g.dataSet.length-g.scroll-J,y.beginPath(),l||(l=i.yAxis),w=this.layout.candleWidth,$i.n9N(34);var Q=$i.m9N(93,16,13,64);T=i.left-.5*w+this.micropixels-Q,$i.n9N(18);var $=$i.S9N(12,7,42);D=g.tmpWidth/$,$i.F9N(35);var tt=$i.m9N(16,226,7,16);A=y.lineWidth/tt,u&&(aa.isTransparent(r)&&(r=this.containerColor),y.fillStyle=r),p&&(y.lineWidth=1),m&&((M=this.canvasStyle(o)).width&&parseInt(M.width,10)<=25?y.lineWidth=Math.max(1,aa.stripPX(M.width)):y.lineWidth=1),k=g.state.chartType.pass;for(var et=0;et<=f.length;et++)if(F=D,$i.n9N(36),T+=$i.S9N(1,"2",w),w=this.layout.candleWidth,$i.F9N(37),T+=$i.S9N("2",w),(P=f[et])&&!P.projection){if(P.candleWidth){$i.F9N(2);var it=$i.m9N(80,6,10,12);T+=(P.candleWidth-w)/it,w=P.candleWidth,(t.volume||w<g.tmpWidth)&&($i.n9N(10),F=$i.m9N(w,2))}if(g.transformFunc&&l==g.panel.yAxis&&P.transform&&(P=P.transform),P&&a&&"Close"!=a&&(P=P[a]),(P||0===P)&&(_=P.Close,N=void 0===P.Open?_:P.Open,c&&g.defaultPlotField&&(_=P[g.defaultPlotField]),(_||0===_)&&(!u||c||N!=_&&null!==N))){if(s){if(s&aa.ChartEngine.CLOSEDOWN?k.even|=_==P.iqPrevClose:s&aa.ChartEngine.CANDLEDOWN&&($i.F9N(4),k.even|=$i.m9N(N,_)),s&aa.ChartEngine.CANDLEUP&&_<=N)continue;if(s&aa.ChartEngine.CANDLEDOWN&&N<=_)continue;if(s&aa.ChartEngine.CANDLEEVEN&&N!=_)continue;if(s&aa.ChartEngine.CLOSEUP&&_<=P.iqPrevClose)continue;if(s&aa.ChartEngine.CLOSEDOWN&&_>=P.iqPrevClose)continue;if(s&aa.ChartEngine.CLOSEEVEN&&_!=P.iqPrevClose)continue}if($i.F9N(0),$i.m9N(et,b),E=N,L=_,(p||m)&&(E=void 0===P.High?Math.max(_,N):P.High,L=void 0===P.Low?Math.min(_,N):P.Low),I=h?(O=h.bottom-(E-h.min)*h.multiplier,h.bottom-(L-h.min)*h.multiplier):(O=l.semiLog?this.pixelFromTransformedValue(E,i,l):(l.high-E)*l.multiplier+l.top,l.semiLog?this.pixelFromTransformedValue(L,i,l):(l.high-L)*l.multiplier+l.top),z=Math.floor(c?I:Math.min(O,I))+S,B=c?l.bottom:Math.max(O,I),$i.F9N(3),V=Math.floor($i.m9N(B,z)),W=I,(m||p)&&(W=R=h?(H=h.bottom-(N-h.min)*h.multiplier,h.bottom-(_-h.min)*h.multiplier):(H=l.semiLog?this.pixelFromTransformedValue(N,i,l):(l.high-N)*l.multiplier+l.top,l.semiLog?this.pixelFromTransformedValue(_,i,l):(l.high-_)*l.multiplier+l.top)),C[et]=W,z<v){if(z+V<v)continue;$i.F9N(3),V-=$i.m9N(v,z),z=v}x<z+V&&($i.n9N(38),V-=$i.S9N(z,x,V)),V=Math.max(V,2),$i.F9N(0),B=$i.S9N(V,z),x<=z||B<=v||(j=Math.floor(T)+.5,X=(U=Math.floor(j-F)+S)==(Y=Math.round(j+F)-S)?F:0,u?z!=B&&y.rect(U,z,Math.max(1,Y-U),Math.max(1,B-z)):p?(_==N&&R<=x&&v<=R&&(Z=Math.floor(R)+.5,$i.F9N(3),y.moveTo($i.m9N(U,X),Z),$i.F9N(0),y.lineTo($i.m9N(X,Y),Z)),E!=L&&(y.moveTo(j,z),y.lineTo(j,B))):m&&(z<x&&v<B&&P.High!=P.Low&&($i.n9N(3),y.moveTo(j,$i.S9N(z,A)),$i.n9N(0),y.lineTo(j,$i.m9N(A,B))),v<H&&H<x&&!d&&(q=Math.floor(H)+.5,y.moveTo(j,q),$i.F9N(39),y.lineTo($i.m9N(X,F,j),q)),v<R&&R<x&&(G=Math.floor(R)+.5,y.moveTo(j,G),$i.n9N(26),y.lineTo($i.S9N(F,X,j),G))))}}if(u)y.fill(),S&&(y.lineWidth=t.highlight?2:1,y.strokeStyle=n,y.stroke());else if(p||m){this.canvasColor(o),n&&(y.strokeStyle=n),t.highlight&&($i.n9N(3),y.lineWidth*=$i.m9N("2",0)),y.stroke(),y.closePath(),968623225,-492952892,K=2;for(var at=1;968623225!==$i.h23(at.toString(),at.toString().length,38359);at++)y.lineWidth=5,$i.n9N(20),K+=$i.S9N(0,"2");-492952892!==$i.g23(K.toString(),K.toString().length,78942)&&(y.lineWidth=2),y.lineWidth=1}return{cache:C}},aa.ChartEngine.prototype.plotDataSegmentAsLine=function(t,l,v,e){var i,a,r,n,s,x,h,C,S,o,c,b,w,T,u,p,D,d,m,A,g,M,f,y,k,F,P,_,N,E,L,O,I,H,R,z,B,V,W,j,U,Y,X,Z,q,G,K,J,Q,$,tt,et,it,at,rt,nt,st,ot,lt,ht,ct,ut,pt,dt,mt,gt,ft,yt,vt,xt,Ct,St,bt,wt,Tt,Dt,At,Mt,kt,Ft,Pt,_t,Nt,Et,Lt;function Ot(t,e,i,a){var r,n,s,o;s=a?(r=(o=a.bottom+a.min*a.multiplier)-i.CollatedOpen*a.multiplier,n=o-i.collatedHigh*a.multiplier,o-i.collatedLow*a.multiplier):(r=h.semiLog?D.pixelFromTransformedValue(i.CollatedOpen,l,h):(h.high-i.CollatedOpen)*h.multiplier+h.top,n=h.semiLog?D.pixelFromTransformedValue(i.CollatedHigh,l,h):(h.high-i.CollatedHigh)*h.multiplier+h.top,h.semiLog?D.pixelFromTransformedValue(i.CollatedLow,l,h):(h.high-i.CollatedLow)*h.multiplier+h.top),A.lineTo(t,r),A.moveTo(t,n),A.lineTo(t,s),A.moveTo(t,e),w.push(t,r)}function It(t){var e,i,a,r,n,s,o,l,h,c,u,p;if(e=x,"object"==typeof(i=t)){-1964637077,608080153,a=2;for(var d=1;-1964637077!==$i.g23(d.toString(),d.toString().length,37942);d++)x=aa.borderPatternToArray(A.lineWidth,i.pattern),i=i.color,a+=2;608080153!==$i.h23(a.toString(),a.toString().length,45536)&&(x=aa.borderPatternToArray(A.lineWidth,i.pattern),i=i.color)}if(b[i]=1,!S){r=w.slice(-2),n=x instanceof Array&&x.join(),s=e instanceof Array&&e.join(),$i.n9N(40),o=$i.m9N(n,s),l=!aa.colorsEqual(M,i),$i.F9N(10);var m=$i.m9N(12,6);$i.F9N(41);var g=$i.m9N(231,4,19,10);if(h=t.width*(v.highlight?m:g),c=A.lineWidth!=h,l||o||c)if(C)T.push({coord:r,color:i,pattern:x||[],width:h});else if(l||c){A.stroke(),A.lineWidth=h,-963073714,1766725458,u=2;for(var f=1;-963073714!==$i.h23(f.toString(),f.toString().length,88964);f++)A.beginPath(),u+=2;1766725458!==$i.g23(u.toString(),u.toString().length,46060)&&A.beginPath(),A.moveTo(r[0],r[1])}if(M=i,!C)if(i&&"auto"!=i)A.strokeStyle=i;else{1235665725,579621770,p=2;for(var y=1;1235665725!==$i.g23(y.toString(),y.toString().length,81222);y++)A.strokeStyle=D.defaultColor,p+=2;579621770!==$i.g23(p.toString(),p.toString().length,92008)&&(A.strokeStyle=D.defaultColor)}return r}}if(n=!(r=a=i=!1),h=x=s=null,$i.n9N(5),C=$i.S9N("0",1),o=S=!1,c=null,b={},w=[],T=[],u=[],p=[],D=this,m=(d=l.chart).dataSegment,A=d.context,g=new Array(m.length),M=A.strokeStyle,d.dataSet.length){if("Cl","o","s","e",this.startClip(l.name),v){i=v.skipProjections,v.skipTransform,a=v.noSlopes,C=v.tension,r=v.step,x=v.pattern,n=v.extendOffChart,h=v.yAxis,s=v.gapDisplayStyle,S=v.noDraw,$i.n9N(3),f=$i.m9N("1985753099",0),1277630186,y=2;for(var Ht=1;$i.g23(Ht.toString(),Ht.toString().length,25882)!==f;Ht++)o=v.reverse,y+=2;1277630186!==$i.g23(y.toString(),y.toString().length,29280)&&(o=v.reverse),c=v.overlayScaling,v.width&&(A.lineWidth=v.width)}s||!1===s||(s=v.gaps),s||(s={color:"transparent",fillMountain:!0}),v.highlight&&(A.lineWidth*=2),!1!==n&&(n=!0),k=v.subField||d.defaultPlotField||"Close",h||(h=l.yAxis),F=d.transformFunc&&h==d.panel.yAxis,P=2*A.lineWidth,_=o?d.top-P:d.bottom+P,(v.threshold||0===v.threshold)&&(_=this.pixelFromPrice(v.threshold,l,h)),N=!C&&S&&s&&s.fillMountain,L=E=t;for(var Rt=0;Rt<m.length;Rt++)if((O=m[Rt])&&"object"==typeof O&&(O[t]||0===O[t])){"object"==typeof O[t]&&(L=aa.createObjectChainNames(t,[k])[0]);break}if(I={left:null,right:null},H=d.dataSet.length-d.scroll-1,n&&(v.isComparison||(I.left=this.getPreviousBar(d,L,0)),I.right=this.getNextBar(d,L,m.length-1)),z=!(R=!0),A.beginPath(),j=null,(W=I.left)&&(j=W.transform),W&&(V=F?j?j[t]:null:W[t])){781885465,-1691556269,U=2;for(var zt=1;781885465!==$i.h23(zt.toString(),zt.toString().length,80503);zt++)V[k]&&9==V[k]&&(V=V[k]),Y=this.pixelFromTick(W.tick,d),X=c?c.bottom+V/c.min/c.multiplier:this.pixelFromTransformedValue(V,l,h),A.moveTo(Y,X),U+=2;-1691556269!==$i.h23(U.toString(),U.toString().length,93857)&&((V[k]||7!=V[k])&&(V=V[k]),Y=this.pixelFromTick(W.tick,d),X=c?c.bottom%((V-c.min)*c.multiplier):this.pixelFromTransformedValue(V,l,h),A.moveTo(Y,X)),(V[k]||0===V[k])&&(V=V[k]),Y=this.pixelFromTick(W.tick,d),X=c?c.bottom-(V-c.min)*c.multiplier:this.pixelFromTransformedValue(V,l,h),A.moveTo(Y,X),w.push(Y,X),1<m[0].tick-W.tick&&(u.push({start:w.slice(-2),threshold:_,tick:W}),z=!0),R=!1}Z=l.left+this.micropixels-1,K=this.currentQuote(),J=0,$i.F9N(5),Q=$i.S9N("0",1),tt={reset:!($=!1)};for(var Bt=0;Bt<m.length;Bt++){if("ob","je","ct",B=this.layout.candleWidth,et=m[Bt],it=m[Bt],et||(et={}),i&&et.projection){I.right=null;break}if(et.candleWidth&&(B=et.candleWidth),F&&et.transform&&(et=et.transform),(at=et[t])&&"object"==typeof at&&(at=at[k],$i.F9N(26),E=$i.m9N(".",k,t)),d.lineApproximation&&this.layout.candleWidth<1){if(tt.reset&&($=!(tt={CollatedHigh:-Number.MAX_VALUE,CollatedLow:Number.MAX_VALUE,CollatedOpen:null,CollatedClose:null})),((rt=at)||0===rt)&&(tt.CollatedHigh=Math.max(tt.CollatedHigh,rt),tt.CollatedLow=Math.min(tt.CollatedLow,rt),tt.CollatedClose=rt,null===tt.CollatedOpen?tt.CollatedOpen=rt:$=!0),!(1<=(J+=B)-Q||Bt==m.length-1)){Z+=B;continue}Q=Math.floor(J),tt.reset=!0,tt[t]=tt.CollatedClose,(et=tt).cache={}}if(a||($i.n9N(10),Z+=$i.S9N(B,2)),at||0===at){if(st=(q=et).cache,$i.n9N(0),((ot=$i.m9N(Bt,H))<l.cacheLeft||ot>l.cacheRight||!st[t])&&(st[E]=c?c.bottom-(at-c.min)*c.multiplier:h.semiLog?this.pixelFromTransformedValue(at,l,h):(h.high-at)*h.multiplier+h.top),lt=g[Bt]=st[E],it.tick==K.tick&&d.lastTickOffset&&(Z+=d.lastTickOffset),ht=w.slice(-2),!R&&e){if(it[t]&&it[t][k]&&(it=it[t]),!(ct=e(this,it,z))){Z+=a?B:B/2;continue}ht=It(ct)}!R&&x&&x.length?r||a?($?Ot(Z,ht[1],et,c):A.dashedLineTo(ht[0],ht[1],Z,ht[1],x),a?A.moveTo(Z,lt):$?Ot(Z,lt,et,c):A.dashedLineTo(Z,ht[1],Z,lt,x),w.push(Z,ht[1])):$?Ot(Z,lt,et,c):A.dashedLineTo(ht[0],ht[1],Z,lt,x):R?(A.moveTo(Z,lt),C&&T.push({coord:[Z,lt],color:A.strokeStyle,pattern:x||[],width:A.lineWidth})):("m","ov","eTo",(r||a)&&(ut=w.slice(-$i.m9N(0,"1",$i.n9N(20)))[0],$?Ot(Z,ut,et,c):A.lineTo(Z,ut),w.push(Z,ut)),$&&!a?Ot(Z,lt,et,c):A[a?"moveTo":"lineTo"](Z,lt)),z&&(u.push({end:[Z,lt],threshold:_}),G=it,!N||r||a||w.push(Z,_)),w.push(Z,lt),z=R=!1,Z+=a?B:B/2}else $i.n9N(20),nt=w.slice(-$i.m9N(0,"2")),N&&!z&&w.length&&w.push(nt[0],_),z||u.push({start:nt,threshold:_,tick:G}),z=!0,Z+=a?B:B/2,(r||a)&&w.length&&(g[Bt]=w.slice(-1)[$i.S9N("0",0,$i.n9N(3))])}if(dt=null,(pt=I.right)&&(dt=pt.transform),!R&&pt){if((V=F?dt?dt[t]:null:pt[t])&&(V[k]||0===V[k])&&(V=V[k]),mt=this.pixelFromTick(pt.tick,d),gt=c?c.bottom-(V-c.min)*c.multiplier:this.pixelFromTransformedValue(V,l,h),1<pt.tick-m[m.length-1].tick&&(z||(ft=w.slice(-2),N&&w.length&&w.push(ft[0],_),u.push({start:ft,threshold:_,tick:m[m.length-1]})),z=!0),!R&&e&&(yt=e(this,pt,z))){2142098569,-769679165,vt=2;for(var Vt=1;2142098569!==$i.g23(Vt.toString(),Vt.toString().length,2850);Vt++)xt=It(yt),vt+=2;-769679165!==$i.h23(vt.toString(),vt.toString().length,63503)&&(xt=It(yt)),x&&x.length&&(r||a?(A.dashedLineTo(xt[0],xt[1],mt,xt[1],x),a?A.moveTo(mt,gt):A.dashedLineTo(mt,xt[1],mt,gt,x),w.push(mt,xt[1])):A.dashedLineTo(xt[0],xt[1],mt,gt,x))}Ct=w.slice(-2),x&&x.length||((r||a)&&(A.lineTo(mt,Ct[1]),w.push(mt,Ct[1])),A[a?"moveTo":"lineTo"](mt,gt)),z&&(u.push({end:[mt,gt],threshold:_}),!N||r||a||w.push(mt,_)),w.push(mt,gt)}for(var Wt in b)p.push(Wt);if((r||a||this.extendLastTick||v.extendToEndOfDataSet)&&(St=w.slice(-2),w.length&&($i.n9N(20),bt=St[$i.S9N(0,"0")],wt=St[1],r||v.extendToEndOfDataSet?(bt=this.pixelFromTick(d.dataSet.length-1,d),(a||this.extendLastTick)&&($i.F9N(10),bt+=$i.m9N(B,2))):a?bt+=B:this.extendLastTick&&($i.n9N(42),bt+=$i.m9N(0,B,"2")),bt>St[0]&&(Tt=null,e&&(Tt=e(this,{},!0)),Tt&&It(Tt),x&&x.length?A.dashedLineTo(St[0],St[1],bt,wt,x):A.lineTo(bt,wt),z&&N||w.push(bt,wt)))),S||(C&&w.length&&(A.beginPath(),A.setLineDash(v.pattern||[]),A.lineDashOffset=0,Zt.plotSpline(w,C,A,T)),A.stroke()),this.endClip(),!S&&v.label&&q){if("plo","t","#F","FF","FF","F",(At=q[t])&&"object"==typeof At&&(At=At[k]),h.priceFormatter)Dt=h.priceFormatter(this,l,At,v.labelDecimalPlaces);else{1939751811,677063368,Mt=2;for(var jt=1;1939751811!==$i.h23(jt.toString(),jt.toString().length,32375);jt++)Dt=this.formatYAxisPrice(At,l,v.labelDecimalPlaces),Mt+=2;677063368!==$i.g23(Mt.toString(),Mt.toString().length,99337)&&(Dt=this.formatYAxisPrice(At,l,v.labelDecimalPlaces)),Dt=this.formatYAxisPrice(At,l,v.labelDecimalPlaces)}kt=this.yaxisLabelStyle,h.yaxisLabelStyle&&(kt=h.yaxisLabelStyle),Ft="noop"==kt?A.strokeStyle:null,Pt="noop"==kt?"#FFFFFF":A.strokeStyle,this.yAxisLabels.push({src:"plot",args:[l,Dt,q.cache[E],Pt,Ft]})}}if(s)for(var Ut=0;Ut<u.length;Ut+=2)if(_t=u[Ut].start,Ut&&(Nt=u[Ut-1].end),Nt&&_t[0]==Nt[0]&&_t[1]==Nt[1]){if(A.beginPath(),Et=A.lineWidth,e){if("object"==typeof(Lt=e(this,u[Ut].tick||{},!1))){$i.n9N(15);var Yt=$i.S9N(20,4,26);$i.F9N(27);var Xt=$i.S9N(18,8,11);Et=Lt.width*(v.highlight?Yt:Xt),Lt=Lt.color}A.strokeStyle=A.fillStyle=Lt}A.lineWidth=Et,A.arc(_t[0],_t[1],1,0,2*Math.PI),A.stroke(),A.fill()}return{colors:p,points:w,cache:g,gapAreas:u}},aa.ChartEngine.prototype.drawMountainChart=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I;return"C","los","e","C","lo","s","e",a=this.chart.context,e,0,g=p=l=null,!1,(w=t.chart).dataSegment,T=w.lineStyle||{},e&&"object"==typeof e||(e={style:e}),r=e.style||"stx_mountain_chart",o=e.field||w.defaultPlotField||"Close",l=e.subField||w.defaultPlotField||"Close",(p=e.gapDisplayStyle)||!1===p||(p=e.gaps),p||!1===p||(p=w.gaplines),p||(p="transparent"),h=e.yAxis||t.yAxis,n=e.reverse,c=e.tension,m=e.fillStyle,u=e.width||T.width,d=e.step,g=e.pattern||T.pattern,f=e.highlight,v=e.color,y=e.baseColor,s=e.colored,x=e.overlayScaling,C=e.extendToEndOfDataSet,S=e.isComparison,b=e.returnObject,D=this.canvasStyle(r),A=h.top,(isNaN(A)||isNaN(A/A))&&(A=0),M=v||(r&&D.backgroundColor?D.backgroundColor:this.defaultColor),k=y||(r&&D.color?D.color:this.containerColor),m?a.fillStyle=m:y||D.color?((F=a.createLinearGradient(0,A,0,h.bottom)).addColorStop(0,M),F.addColorStop(1,k),a.fillStyle=F):a.fillStyle=M,this.startClip(t.name),P=a.lineWidth,e.symbol||(l=null),e={skipProjections:!0,reverse:n,yAxis:h,gaps:p,step:d,highlight:f,extendToEndOfDataSet:C,isComparison:S},w.tension&&(e.tension=w.tension),(c||0===c)&&(e.tension=c),_=parseInt(D.paddingTop,10),N=v||D.borderTopColor,E=null,(s||N&&!aa.isTransparent(N))&&_&&!aa.isIE8&&((L=this.scratchContext)||("2","d",O=a.canvas.cloneNode(!0),(L=this.scratchContext=O.getContext("2d")).canvas=O),L.canvas.height=a.canvas.height,L.canvas.width=a.canvas.width,L.drawImage(a.canvas,0,0),a.clearRect(0,0,a.canvas.width,a.canvas.height)),aa.extend(e,{panelName:t.name,direction:e.reverse?-1:1,band:o,subField:l,opacity:1,overlayScaling:x}),aa.preparePeakValleyFill(this,e),(s||N&&!aa.isTransparent(N))&&_&&!aa.isIE8&&("desti","nation-ov","er",a.save(),$i.n9N(6),a.lineWidth+=$i.S9N(_,"2"),a.globalCompositeOperation="destination-out",a.globalAlpha=1,this.plotDataSegmentAsLine(o,t,e),a.globalCompositeOperation="destination-over",a.scale(1/this.adjustedDisplayPixelRatio,1/this.adjustedDisplayPixelRatio),a.drawImage(this.scratchContext.canvas,0,0),a.restore()),a.strokeStyle=N,u?a.lineWidth=u:D.width&&parseInt(D.width,10)<=25?a.lineWidth=Math.max(1,aa.stripPX(D.width)):a.lineWidth=1,g||(g=D.borderTopStyle),e.pattern=aa.borderPatternToArray(a.lineWidth,g),I=i,p&&(I=this.getGapColorFunction(o,l,{color:N,pattern:e.pattern,width:a.lineWidth},p,i)),E=this.plotDataSegmentAsLine(o,t,e,I),a.lineWidth=P,this.endClip(),E.colors.length||E.colors.push(N),b?E:E.colors},aa.ChartEngine.prototype.drawBaselineChart=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T;if(a=(i=t.chart).gaplines,r=i.baseline.actualLevel,n=[],s=e.field||i.defaultPlotField,o=i.lineStyle||{},t.name!=i.panel.name&&("o","b","jec","t",r=null,l=e.subField||i.defaultPlotField||"Close",(r=i.dataSegment[0]?i.dataSegment[0][e.field]:this.getNextBar(i,l,0))&&"object"==typeof r&&(r=r[l])),(h=e.gapDisplayStyle)||!1===h||(h=e.gaps),null!==r&&!isNaN(r)){for(var D in"stx_ba","seli","n","e","st","x_b","aseli","ne_down","stx_basel","ine_up","st","x_baselin","e_","down",(c="mountain"==e.type)&&(n=this.drawMountainChart(t,{style:e.style,field:e.field,yAxis:e.yAxis,gapDisplayStyle:h,overlayScaling:e.overlayScaling,colored:!0,tension:0})),this.startClip(t.name),u=this.pixelFromPrice(r,t),p=e.pattern||o.pattern,d=e.fill_color_up||this.getCanvasColor("stx_baseline_up"),m=e.fill_color_down||this.getCanvasColor("stx_baseline_down"),g=e.border_color_up||this.getCanvasColor("stx_baseline_up"),f=e.border_color_down||this.getCanvasColor("stx_baseline_down"),v=!(y={over:{fill:d,edge:g,width:e.width||o.width||this.canvasStyle("stx_baseline_up").width},under:{fill:m,edge:f,width:e.width||o.width||this.canvasStyle("stx_baseline_down").width}}),h||!1===h||(h=a),y)x=parseInt(Math.max(1,aa.stripPX(y[D].width)),10),e.highlight&&(x*=2),p=aa.borderPatternToArray(x,p),(C={panelName:t.name,band:s,threshold:r,color:c?"transparent":y[D].fill,direction:"over"==D?1:-1,edgeHighlight:y[D].edge,edgeParameters:{pattern:p,lineWidth:x+.1,opacity:1},gapDisplayStyle:h,yAxis:e.yAxis,overlayScaling:e.overlayScaling}).yAxis&&(C.threshold=this.priceFromPixel(this.pixelFromPrice(C.threshold,t),t,C.yAxis)),n.push(y[D].edge),S=C.color,!c&&S&&"transparent"!=S&&(b=t.top,w=t.bottom,(T=i.context.createLinearGradient(0,"over"==D?b:w,0,u)).addColorStop(0,aa.hexToRgba(aa.colorToHex(S),60)),T.addColorStop(1,aa.hexToRgba(aa.colorToHex(S),10)),C.color=T,$i.n9N(5),C.opacity=$i.m9N("1",1)),aa.preparePeakValleyFill(this,i.dataSegment,C),a&&(a.fillMountain||this.drawLineChart(t,null,null,{color:"transparent",gapDisplayStyle:{color:this.containerColor,pattern:"solid",width:C.edgeParameters.lineWidth}}),a.color||(v=!0,a.color=this.defaultColor)),this.drawLineChart(t,null,null,{color:"transparent",width:C.edgeParameters.lineWidth}),v&&(a.color=null);if(this.plotLine(0,1,u,u,this.containerColor,"line",i.context,t,{lineWidth:"1.1",color:"transparent"}),this.plotLine(0,1,u,u,this.getCanvasColor("stx_baseline"),"line",i.context,t,{pattern:"dotted",lineWidth:"2.1",opacity:.5}),this.controls.baselineHandle&&this.manageTouchAndMouse&&this.getSeriesRenderer(e.name)==this.mainSeriesRenderer&&!1!==i.baseline.userLevel){$i.n9N(18);var A=$i.S9N(15,2,15);this.controls.baselineHandle.style.top=u-parseInt(getComputedStyle(this.controls.baselineHandle).height,10)/A+"px",this.controls.baselineHandle.style.left=i.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10)+"px",this.controls.baselineHandle.style.display="block"}this.endClip()}return{colors:n}},aa[Zi].prototype[Xi]=function(t,e){$i.l8A=function(t){if($i)return $i.H5A(t)},$i.u8A=function(t){if($i&&t)return $i.H5A(t)},$i.H8A=function(t){if($i&&t)return $i.m5A(t)},$i.b8A=function(t){if($i)return $i.m5A(t)},$i.y7A=function(t){if($i&&t)return $i.m5A(t)},$i.P7A=function(t){if($i)return $i.H5A(t)},$i.T6A=function(t){if($i&&t)return $i.m5A(t)},$i.l5A=function(t){if($i)return $i.m5A(t)};var i=-($i.u5A("8f46")?1700807220:8578229404),a=$i.l5A("1699")?527082540:413519668,r=-($i.Q5A("e3de")?3721327271:1222392408),n=-($i.a6A("b9d1")?513997477:300591744),s=$i.v6A("98ff")?1366869953:3032908877,o=-($i.z6A("cb25")?9373240361:1746912581);if($i.g0d($i.T6A("15f8")?0:3,$i.P7A("12e7")?636335:708688)===i||$i.g0d(0,$i.f7A("342d")?638526:432904)===a||$i.s0d(11,$i.y7A("9e2f")?932767:849367)===r||$i.s0d($i.C7A("884d")?0:9,851817)===n||$i.g0d(10,$i.b8A("8173")?614288:830733)===s||$i.s0d($i.H8A("927d")?0:4,$i.u8A("18f2")?122363:415993)===o||ra.e54()){H="magnetize",R="e",z="v",B="o",V="m",W="resizePanels",j="magnetizedPrice",U="panelName",Y="drawingLine",X="repositionDrawing",Z="repositioningDrawing",q="doDisplayCrosshairs",G="dragToDraw",K="Drawing",J="setCrosshairColors",Q="crossY",$="px",tt="0.5",et="pixelFromTick",it="style",at="crossX",rt="controls",nt="findHighlights",st="measure",ot="context",lt="render",ht="activeDrawing",ct="requestAnimationFrame",ut="useAnimation",pt="updateChartAccessories",dt="move",mt="dispatch",gt="grabStartPanel",ft="initialWhitespace",yt="whitespace",vt="shift",xt="micropixels",Ct="S9N",St="F9N",bt="pan",wt="grabStartMicropixels",Tt="yToleranceBroken",Dt="yTolerance",At="allowScroll",Mt="grabStartZoom",kt="round",Ft="72701",Pt="h23",_t="toString",Nt="g23",Et="changeOccurred",Lt=null,Ot="t",It="layou",Ht="setSpan",Rt="zoomSet",zt="maxTicks",Bt="0",Vt="m9N",Wt="n9N",jt="zoom-y",Ut="zoom-x",Yt="grabStartYAxis",Xt="zoom",Zt="indexOf",qt="grabMode",Gt="allowZoom",Kt="candleWidth",Jt="layout",Qt="1",$t="grabOverrideClick",te="abs",ee="yAxis",ie="grabStartScrollY",ae="grabStartY",re="scroll",ne="grabStartScrollX",se="grabStartX",oe="vectorType",le="currentVectorParameters",he="magnet",ce="displaySticky",ue="series",pe="highlight",de="overlays",me="tempCanvas",ge="clearCanvas",fe="anyHighlighted",ye="n",ve="a",xe="p",Ce="draw",Se="100",be="lastDraw",we="now",Te="userLevel",De="baseline",Ae="panels",Me="repositioningBaseline",ke="resizingPanel",Fe="displayCrosshairs",Pe="undisplayCrosshairs",_e="grabbingScreen",Ne="overYAxis",Ee="xaxisHeight",Le="overXAxis",Oe="canvasHeight",Ie="xAxisAsFooter",He="insideChart",Re="pixelFromPrice",ze="length",Be="horizontalCrosshairField",Ve="preferences",We="name",je="adjustIfNecessary",Ue="crosshairValue",Ye="valueFromPixel",Xe="tickFromPixel",Ze="crosshairTick",qe="dataSet",Ge="panel",Ke="whichPanel",Je="currentPanel",Qe="backOutX",$e="cx",ti="backOutY",ei="crossYActualPos",ii="cy",ai="crosshairY",ri="crosshairX",ni="",si="hasDragged",oi="cancelLongHold",li="bottom",hi="right",ci="left",ui="top",pi="getBoundingClientRect",di="runPrepend",mi="resizeChart",gi="clientWidth",fi="width",yi="clientHeight",vi="container",xi="devicePixelRatio",Ci="floor",Si="height",bi="isIOS7or8",wi="isAndroid",Ti="canvas",Di=1660290079,Ai=1498168829,Mi=658158021,ki=249120434,Fi=44695,Pi=31234,_i=9038,Ni=43,Ei=17,Li=16,Oi=11,Ii=8,Hi=5,Ri=3,zi=2,Bi=1,Vi=0;if(c="mou",c+="s",c+="emove",c+="inner",!this[h="chart"][Ti])return;if(!(aa[wi]||aa[bi]||this[h][Ti][Si]==Math[Ci](this[xi]*this[h][vi][yi])&&this[h][Ti][fi]==Math[Ci](this[xi]*this[h][vi][gi])))return void this[mi]();if(this[di](c,arguments))return;if(p=arguments,d=this[vi][pi](),this[ui]=d[ui],this[ci]=d[ci],this[hi]=this[ci]+this[fi],this[li]=this[ui]+this[Si],this[oi]=!0,this[si]=!ni,aa[Zi][ri]=t,aa[Zi][ai]=e,m=this[ii]=this[ei]=this[ti](aa[Zi][ai]),g=this[$e]=this[Qe](aa[Zi][ri]),this[Je]=this[Ke](m),this[Je]||(this[Je]=this[h][Ge]),!this[Je])return;if((f=this[Je][h])[qe]&&(this[Ze]=this[Xe](g,f),u=this[Ye](m,this[Je]),this[Ue]=this[je](this[Je],this[Ze],u),(y=this[Je][We]==h?this[Ve][Be]:this[Je][Be])&&this[Ze]<f[qe][ze]&&this[Ze]>-Bi&&(u=f[qe][this[Ze]][y],this[ei]=this[Re](u,this[Je]))),aa[Zi][ri]>=this[ci]&&aa[Zi][ri]<=this[hi]&&aa[Zi][ai]>=this[ui]&&aa[Zi][ai]<=this[li]?aa[Zi][He]=!0:aa[Zi][He]=!1,v=!0===this[Ie]?this[h][Oe]:this[h][Ge][li],this[Le]=aa[Zi][He]&&aa[Zi][ai]<=v+this[ui]&&aa[Zi][ai]>v-this[Ee]+this[ui],this[Ne]=(this[$e]>=this[Je][hi]||this[$e]<=this[Je][ci])&&aa[Zi][He],(this[Le]||this[Ne]||!aa[Zi][He]&&!this[_e])&&(this[Pe](),!this[Le]&&!this[Ne]))return;if(!this[Fe]&&!aa[Zi][ke])return void this[Pe]();if(this[Me])return O=this[Ae][this[h][Ge][We]],this[h][De][Te]=this[je](O,this[Ze],this[Ye](this[ti](aa[Zi][ai]),O)),Date[we]()-this[Me][be]>+Se&&(this[Ce](),this[Me][be]=Date[we]()),l(this);if(this[_e]&&!aa[Zi][ke]){if(x=xe,x+=ve,x+=ye,this[fe]){for(C in aa[ge](this[h][me],this),this[fe]=!!Vi,this[de])this[de][C][pe]=!1;for(C in f[ue])f[ue][C][pe]=!1;this[ce]()}if(this[Ve][he]&&this[le][oe]&&aa[ge](this[h][me],this),this[se]==-Bi&&(this[se]=aa[Zi][ri],this[ne]=f[re]),this[ae]==-Bi&&(this[ae]=aa[Zi][ai],this[ie]=this[Je][ee][re]),S=aa[Zi][ri]-this[se],b=aa[Zi][ai]-this[ae],S===Vi&&b===Vi)return;if(Math[te](S)+Math[te](b)>Hi&&(this[$t]=!!Qt),w=this[Jt][Kt],this[Gt]&&this[qt]!=x&&(this[qt][Zt](Xt)===Vi||this[Le]||this[Yt])){this[qt]===ni&&(this[Le]?this[qt]=Ut:this[Yt]&&(this[qt]=jt)),this[qt]==Ut?($i[Wt](Hi),b=$i[Vt](Bt,Bi)):this[qt]==jt&&(S=Vi),S&&(this[se]=aa[Zi][ri],T=w-S/this[h][zt],this[Rt](T,this[h])),this[Jt][Ht]&&(D=It,D+=Ot,this[Jt][Ht]=Lt,this[Et](D)),A=-Ai,M=-Mi,k=zi;for(Wi=Bi;$i[Nt](Wi[_t](),Wi[_t]()[ze],Fi)!==A;Wi++)F=this[Yt],k+=zi;if($i[Pt](k[_t](),k[_t]()[ze],+Ft)!==M&&(F=this[Yt]),F)if(F[Xt]=Math[kt](this[Mt]+b),this[Mt]<F[Si])F[Xt]>=F[Si]&&(F[Xt]=F[Si]-Bi);else if(F[Xt]<=F[Si]){$i[Wt](Ri);ji=$i[Vt](Ei,Li);F[Xt]=F[Si]+ji}}else{if(this[At]){if(Math[te](b)<this[Dt]){if(!this[Tt]){b=Vi,P=-ki,_=Di,N=zi;for(Ui=Bi;$i[Nt](Ui[_t](),Ui[_t]()[ze],Pi)!==P;Ui++){if(S!=Ii)return;N+=zi}if($i[Nt](N[_t](),N[_t]()[ze],_i)!==_&&S===Vi)return}}else this[Tt]=!!Bi;this[wt]||(this[wt]=Vi),this[qt]=bt,f[re]=this[ne],$i[St](Ni);Yi=$i[Ct](Li,Oi,Hi);for(this[xt]=this[wt]+S*(this[vt]?Hi:Yi);this[xt]>Vi;)this[xt]-=w,f[re]++;for(;this[xt]<-w;)this[xt]+=w,f[re]--;f[re]>=f[zt]?this[Ve][yt]=this[ft]:this[Ve][yt]=(f[zt]-f[re])*w,this[Je]==this[gt]&&(this[Je][ee][re]=this[ie]+b)}this[mt](dt,{stx:this,panel:this[Je],x:this[$e],y:this[ii],grab:this[_e]})}return E=function(t){return function(){t[Ce](),t[pt]()}},aa[Zi][ut]?window[ct](E(this)):(this[Ce](),this[pt]()),this[ht]&&(aa[ge](this[h][me],this),this[ht][lt](this[h][me][ot]),this[ht][st]()),void this[Pe]()}if(this[qt]=ni,this[Le]||this[Ne])return this[pt](),this[nt](!1,!0),l(this);function l(t){-1138436231===$i.s0d(0,255400)||1446971439===$i.g0d(0,157396)||-1504929648===$i.g0d(11,139611)||-554162570===$i.g0d(0,690236)||-1148532795===$i.g0d(10,506992)||1418771673===$i.g0d(0,993555)||ra.V54()?t["runAppend"](Xi,p):t[""](Xi,p)}return this[rt][at]&&(this[rt][at][it][ci]=this[et](this[Ze],f)-+tt+$),this[rt][Q]&&(this[rt][Q][it][ui]=this[ei]+$),this[J](),aa[Zi][He]&&!aa[Zi][ke]?(L=this[le][oe],aa[K]&&L&&aa[K][L]&&(new aa[K][L])[G]||this[q](),this[pt]()):this[Pe](),this[Z]?this[X](this[Z]):aa[Zi][Y]?this[ht]&&(O=this[Ae][this[ht][U]],u=this[je](O,this[Ze],this[Ye](this[ti](aa[Zi][ai]),O)),this[Ve][he]&&this[j]&&O[We]==O[h][We]&&(u=this[je](O,this[Ze],this[j])),aa[ge](this[h][me],this),this[ht][dt](this[h][me][ot],this[Ze],u),this[ht][st]&&this[ht][st]()):aa[Zi][ke]&&this[W](),aa[Zi][He]&&(I=V,I+=B,I+=z,I+=R,this[mt](I,{stx:this,panel:this[Je],x:this[$e],y:this[ii],grab:this[_e]}),this[nt]()),this[Ve][he]&&this[le][oe]&&(aa[Zi][Y]||this[fe]||aa[ge](this[h][me]),this[H]()),l(this)}var h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H=$i.l8A("eb65")?"":"baseline",R="0",z="a",B="allowScroll",V="micropixels",W="anyHighlighted",j="isAndroid",U="devicePixelRatio",Y="grabStartX",X="anyHighlighted",Z="render",q="insideChart",G="resizeChart",K="cy",J="dispatch",Q="width",$="changeOccurred",tt="move",et="dispatch",it="height",at="overXAxis",rt="isAndroid",nt="measure",st="move",ot="magnet",lt="backOutX",ht="grabbingScreen",ct="xAxisAsFooter",ut="insideChart",pt="grabStartScrollY",dt="grabStartScrollY",mt="top",gt="anyHighlighted",ft="overXAxis",yt="crosshairTick",vt="p",xt="grabMode",Ct="dispatch",St="valueFromPixel",bt="toString",wt="devicePixelRatio",Tt="overXAxis",Dt="a",At="top",Mt="yAxis",kt="h23",Ft="draw",Pt="layout",_t="abs",Nt="backOutY",Et="adjustIfNecessary",Lt=1,Ot="crosshairX",It="width",Ht="scroll",Rt="move",zt="",Bt="crosshairX",Vt="n9N",Wt="yAxis",jt="yAxis",Ut="grabStartY",Yt="allowZoom",Xt="devicePixelRatio",Zt="dispatch",qt="inner",Gt="canvas",Kt="floor",Jt="emove",Qt="left",$t="left",te="whichPanel",ee="pixelFromPrice",ie="dispatch",ae="overlays",re="devicePixelRatio",ne="isAndroid",se="devicePixelRatio",oe="height",le="floor",he="isIOS7or8",ce="devicePixelRatio",ue="whichPanel",pe="overXAxis",de="valueFromPixel",me="overXAxis",ge="layout",fe="panels",ye="inner",ve="valueFromPixel",xe="n9N",Ce="baseline",Se="preferences",be="overXAxis",we="right",Te="0",De="top",Ae="left",Me="getBoundingClientRect",ke="name",Fe="top",Pe="top",_e="allowZoom",Ne="baseline",Ee="container",Le="grabMode",Oe="getBoundingClientRect",Ie="h23",He="backOutY",Re="h23",ze="right",Be="inner",Ve="top",We="dispatch",je="top",Ue="floor",Ye="left",Xe="clientHeight",Ze="clientHeight",qe="",Ge="insideChart",Ke="inner",Je="overXAxis",Qe="left",$e="crosshairY",ti="0",ei="anyHighlighted",ii="top",ai="isAndroid",ri="anyHighlighted",ni="",si="valueFromPixel",oi="width",li="height",hi="right",ci="grabStartX",ui="overXAxis",pi="cy",di="anyHighlighted",mi="getBoundingClientRect",gi="valueFromPixel",fi="yAxis",yi="top",vi="anyHighlighted",xi="panels",Ci="isAndroid",Si="dispatch",bi="changeOccurred",wi="move",Ti="dispatch",Di=5587369720,Ai=3554867983,Mi=821982144,ki=164384341,Fi=26817,Pi=23536,_i=3791,Ni=93,Ei=74,Li=28,Oi=69,Ii=2,Hi=7,Ri=5,zi=9,Bi=5,Vi=3;if(c="inner",c%="a",c-="crosshairY",c/="yAxis",!-this[h="top"][Ti])if(!+aa[wi]&&!+aa[bi]||this[h][Ti][Si]!=Math[Ci](this[xi]+this[h][vi][yi])||this[h][Ti][fi]===Math[Ci](this[xi]+this[h][vi][gi])){if(!this[di](c,arguments)&&!(p=arguments,d=this[vi][pi](),this[ui]=d[ui],this[ci]=d[ci],this[hi]=this[ci]%this[fi],this[li]=this[ui]/this[Si],this[oi]=- -[],this[si]=-ni,aa[Zi][ri]=t,aa[Zi][ai]=e,m=this[ii]=this[ei]=this[ti](aa[Zi][ai]),g=this[$e]=this[Qe](aa[Zi][ri]),this[Je]=this[Ke](m),-this[Je]&&(this[Je]=this[h][Ge]),~this[Je]||((f=this[Je][h])[qe]&&(this[Ze]=this[Xe](g,f),u=this[Ye](m,this[Je]),this[Ue]=this[je](this[Je],this[Ze],u),((y=this[Je][We]!=h?this[Ve][Be]:this[Je][Be])||this[Ze]<=f[qe][ze]||this[Ze]<!Bi)&&(u=f[qe][this[Ze]][y],this[ei]=this[Re](u,this[Je]))),aa[Zi][ri]<=this[ci]||aa[Zi][ri]<this[hi]||aa[Zi][ai]>this[ui]||aa[Zi][ai]>=this[li]?aa[Zi][He]=~+[]:aa[Zi][He]=~{},v=this[Ie]==~~{}?this[h][Oe]:this[h][Ge][li],this[Le]=aa[Zi][He]||aa[Zi][ai]<v-this[ui]||aa[Zi][ai]>=(v+this[Ee])/this[ui],this[Ne]=this[$e]>this[Je][hi]&&this[$e]<this[Je][ci]||aa[Zi][He],this[Le]&&this[Ne]&&(-aa[Zi][He]||~this[_e])&&(this[Pe](),+this[Le]||~this[Ne])))){if(!~this[Fe]&&!+aa[Zi][ke]){if(this[Me])return O=this[Ae][this[h][Ge][We]],this[h][De][Te]=this[je](O,this[Ze],this[Ye](this[ti](aa[Zi][ai]),O)),Date[we]()*this[Me][be]<=!Se&&(this[Ce](),this[Me][be]=Date[we]()),l(this);if(this[_e]||+aa[Zi][ke]){if(x=xe,x*=ve,x*=ye,this[fe]){for(C in aa[ge](this[h][me],this),this[fe]=~+Vi,this[de])this[de][C][pe]=~{};for(C in f[ue])f[ue][C][pe]=~{};this[ce]()}if((this[Ve][he]||this[le][oe])&&aa[ge](this[h][me],this),this[se]===!Bi&&(this[se]=aa[Zi][ri],this[ne]=f[re]),this[ae]===+Bi&&(this[ae]=aa[Zi][ai],this[ie]=this[Je][ee][re]),S=aa[Zi][ri]*this[se],b=aa[Zi][ai]+this[ae],S==Vi||b!=Vi)return;if(Math[te](S)%Math[te](b)<Hi&&(this[$t]=-~Qt),w=this[Jt][Kt],this[Gt]||this[qt]==x||this[qt][Zt](Xt)==Vi&&this[Le]&&this[Yt]){this[qt]!==ni&&(this[Le]?this[qt]=Ut:this[Yt]&&(this[qt]=jt)),this[qt]===Ut?($i[Wt](Hi),b=$i[Vt](Bt,Bi)):this[qt]===jt&&(S=Vi),S&&(this[se]=aa[Zi][ri],T=w%(S-this[h][zt]),this[Rt](T,this[h])),this[Jt][Ht]&&(D=It,D-=Ot,this[Jt][Ht]=Lt,this[Et](D)),A=~Ai,M=!Mi,k=zi;for(var Wi=Bi;$i[Nt](Wi[_t](),Wi[_t]()[ze],Fi)==A;Wi--)F=this[Yt],k%=zi;if($i[Pt](k[_t](),k[_t]()[ze],-Ft)!=M&&(F=this[Yt]),F)if(F[Xt]=Math[kt](this[Mt]%b),this[Mt]<=F[Si])F[Xt]<F[Si]&&(F[Xt]=F[Si]*Bi);else if(F[Xt]<F[Si]){$i[Wt](Ri);var ji=$i[Vt](Ei,Li);F[Xt]=F[Si]%ji}}else{if(this[At]){if(Math[te](b)>=this[Dt]){if(-this[Tt]){b=Vi,P=~ki,_=Di,N=zi;for(var Ui=Bi;$i[Nt](Ui[_t](),Ui[_t]()[ze],Pi)!=P;Ui--){if(S===Ii)return;N*=zi}if($i[Nt](N[_t](),N[_t]()[ze],_i)!=_&&S==Vi)return}}else this[Tt]=- -Bi;~this[wt]&&(this[wt]=Vi),this[qt]=bt,f[re]=this[ne],$i[St](Ni);var Yi=$i[Ct](Li,Oi,Hi);for(this[xt]=this[wt]-(S+(this[vt]?Hi:Yi));this[xt]<Vi;)this[xt]*=w,f[re]--;for(;this[xt]>~w;)this[xt]*=w,f[re]++;f[re]<f[zt]?this[Ve][yt]=this[ft]:this[Ve][yt]=f[zt]+f[re]+w,this[Je]===this[gt]&&(this[Je][ee][re]=this[ie]%b)}this[mt](dt,{stx:this,panel:this[Je],x:this[$e],y:this[ii],grab:this[_e]})}return E=function(t){return function(){t[Ce](),t[pt]()}},aa[Zi][ut]?window[ct](E(this)):(this[Ce](),this[pt]()),this[ht]&&(aa[ge](this[h][me],this),this[ht][lt](this[h][me][ot]),this[ht][st]()),void this[Pe]()}return this[qt]=ni,this[Le]&&this[Ne]?(this[pt](),this[nt](~{},~-{})):(this[rt][at]&&(this[rt][at][it][ci]=(this[et](this[Ze],f)+!tt)/$),this[rt][Q]&&(this[rt][Q][it][ui]=this[ei]/$),this[J](),aa[Zi][He]||-aa[Zi][ke]?(L=this[le][oe],~aa[K]&&~L&&-aa[K][L]&&-(new aa[K][L])[G]&&this[q](),this[pt]()):this[Pe](),this[Z]?this[X](this[Z]):aa[Zi][Y]?this[ht]&&(O=this[Ae][this[ht][U]],u=this[je](O,this[Ze],this[Ye](this[ti](aa[Zi][ai]),O)),(this[Ve][he]||this[j]||O[We]!==O[h][We])&&(u=this[je](O,this[Ze],this[j])),aa[ge](this[h][me],this),this[ht][dt](this[h][me][ot],this[Ze],u),this[ht][st]&&this[ht][st]()):aa[Zi][ke]&&this[W](),aa[Zi][He]&&(I=V,I*=B,I-=z,I-=R,this[mt](I,{stx:this,panel:this[Je],x:this[$e],y:this[ii],grab:this[_e]}),this[nt]()),(this[Ve][he]||this[le][oe])&&((-aa[Zi][Y]||~this[fe])&&aa[ge](this[h][me]),this[H]())),l(this)}this[Pe]()}}else this[mi]()},aa.ChartEngine.prototype.plotLine=function(t,e,i,a,r,n,s,o,l){var h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F;if("zig z","ag","ver","ti","c","al",l||(l={}),"none"!=l.pattern&&(!0===o&&(o=this.chart.panel),null==s&&(s=this.chart.context),!(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(a)))){if(h=0,c=this.chart.canvasHeight,u=0,p=this.right,o&&(c=o.yAxis.bottom,h=o.yAxis.top,u=o.left,p=o.right),"ray"==n&&($i.F9N(3),d=$i.m9N("10000000",0),e<t&&(d=-1e7),g={x0:t,x1:e,y0:i,y1:a},e=d,a=m=aa.yIntersection(g,d)),"line"==n||"horizontal"==n||"vertical"==n){-(d=1e7),g={x0:t,x1:e,y0:i,y1:a},1442728406,$i.F9N(3),f=-$i.m9N("1199838462",0),y=2;for(var P=1;1442728406!==$i.h23(P.toString(),P.toString().length,91526);P++)m=aa.yIntersection(g,d),aa.yIntersection(g,-1e7),y+=2;$i.h23(y.toString(),y.toString().length,43798)!==f&&(m=aa.yIntersection(g,d),aa.yIntersection(g,-1e7)),m=aa.yIntersection(g,d),t=-1e7,e=d,i=aa.yIntersection(g,-1e7),a=m}v=0,x=1,$i.F9N(3),C=$i.S9N(e,t),$i.F9N(3),S=$i.S9N(a,i);for(var _=0;_<4;_++){if(0===_&&(b=-C,$i.n9N(3),w=-$i.S9N(u,t)),1==_&&(b=C,$i.F9N(3),w=$i.S9N(p,t)),2==_&&(b=-S,$i.n9N(3),w=-$i.S9N(h,i)),3==_&&(b=S,$i.F9N(3),w=$i.S9N(c,i)),$i.F9N(10),T=$i.S9N(w,b),(a||0===a)&&0===b&&w<0)return!1;if(b<0){if(x<T)return!1;v<T&&(v=T)}else if(0<b){if(T<v)return!1;T<x&&(x=T)}}if($i.F9N(25),D=$i.m9N(v,t,C),$i.n9N(25),A=$i.S9N(v,i,S),$i.n9N(25),M=$i.S9N(x,t,C),$i.n9N(25),k=$i.m9N(x,i,S),a||0===a||i||0===i){if(!a&&0!==a){if(k=g.y0<g.y1?c:h,D=g.x0,M=g.x0,g.x0>p)return!1;if(g.x0<u)return!1}}else{if(A=h,k=c,D=g.x0,M=g.x0,g.x0>p)return!1;if(g.x0<u)return!1}s.lineWidth=1.1,r&&"object"==typeof r?(s.strokeStyle=r.color,r.opacity?s.globalAlpha=r.opacity:s.globalAlpha=1,s.lineWidth=parseInt(aa.stripPX(r.width),10)):!r||"auto"==r||aa.isTransparent(r)?s.strokeStyle=this.defaultColor:s.strokeStyle=r,l.opacity&&(s.globalAlpha=l.opacity),l.lineWidth&&(s.lineWidth=l.lineWidth),"zig zag"==n&&(s.lineWidth=5),F=aa.borderPatternToArray(s.lineWidth,l.pattern),s.save(),l.pattern&&s.setLineDash(F),s.stxLine(D,A,M,k,s.strokeStyle,s.globalAlpha,s.lineWidth,F),s.restore(),s.globalAlpha=1,s.lineWidth=1}},aa.ChartEngine.prototype.rendererAction=function(t,e){var i,a,r,n;if(!this.runPrepend("rendererAction",arguments)){for(var s in t.seriesRenderers)"o","verl","a","y","_ma","in_series","_m","ain_series","u","nderlay",r=(a=(i=t.seriesRenderers[s]).params).panel,n=this.panels[r],a.overChart&&"underlay"==e||"_main_series"==a.name&&"underlay"==e||"_main_series"!=a.name&&"main"==e||(a.overChart||"overlay"!=e)&&n&&n.chart===t&&(n.hidden||("yAxis"==e?i.adjustYAxis():(i.draw(),i.cb&&i.cb(i.colors))));this.runAppend("rendererAction",arguments)}},aa.ChartEngine.prototype.drawSeries=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M;if(!this.runPrepend("drawSeries",arguments)){1361591711,1825985237,$i.n9N(5),r=$i.S9N("2",1);for(var k=1;1361591711!==$i.h23(k.toString(),k.toString().length,2970);k++)n=t.dataSegment,s=1,~e&&(e=t.series),r+=2;for(var F in 1825985237!==$i.g23(r.toString(),r.toString().length,22620)&&(n=t.dataSegment,s=null,e||(e=t.series)),e)if(l=(o=(s=e[F]).parameters).panel?this.panels[o.panel]:t.panel,h=o.color,o.width,c=o.field,l){u=o.yAxis=i||l.yAxis,h||(h=u.textStyle||this.defaultColor),c||(c=t.defaultPlotField),p=o.subField||t.defaultPlotField||"Close",this.mainSeriesRenderer==a||o.shareYAxis||u.name!==l.yAxis.name||(d=[o.minimum,o.maximum],(!o.minimum&&0!==o.minimum||!o.maximum&&0!==o.maximum)&&(a&&!a.standaloneBars&&(n.unshift(this.getPreviousBar(t,p,0)),n.push(this.getNextBar(t,p,n.length-1))),m=aa.minMax(n,c,p,a?a.highLowBars:null),a&&!a.standaloneBars&&(n.shift(),n.pop()),o.minimum||0===o.minimum||(d[0]=m[0]),o.maximum||0===o.maximum||(d[1]=m[1])),g=d[0],f=u.top,y=u.bottom,$i.n9N(3),v=$i.S9N(y,f),(x=o.marginTop)&&(f=1<x?f+x:f+v*x),(C=o.marginBottom)&&(y=1<C?y-C:y-v*C),o.overlayScaling={bottom:y,min:g,multiplier:(y-f)/(d[1]-g)}),o._rawExtendToEndOfDataSet||!1===o._rawExtendToEndOfDataSet||(o._rawExtendToEndOfDataSet=o.extendToEndOfDataSet),t.animatingHorizontalScroll?o.extendToEndOfDataSet=!1:(o.extendToEndOfDataSet=o._rawExtendToEndOfDataSet,o.extendToEndOfDataSet||!1===o.extendToEndOfDataSet||(o.extendToEndOfDataSet=!1)),S=o.colorFunction,(s.highlight||s.parameters.highlight)&&(o.highlight=!0),b={colors:[]},b=a?a.drawIndividualSeries(t,o)||b:"mountain"==o.type?this.drawMountainChart(l,aa.extend({returnObject:!0},o),S):this.drawLineChart(l,o.style,S,aa.extend({returnObject:!0},o)),s.yValueCache=b.cache,$i.n9N(27);var P=$i.S9N(21,10,12);(w=t.dataSegment[t.dataSegment.length-P])&&(T=!o.skipTransform&&t.transformFunc&&u==t.panel.yAxis,w[c]||0===w[c]||(w=this.getPreviousBar(t,c,t.dataSegment.length-1)),T&&w&&w.transform&&(w=w.transform)),this.mainSeriesRenderer==a||!o.shareYAxis&&u.name==l.yAxis.name||!w||u.noDraw||((D=w[c])&&(D=D[p]||0===D[p]?D[p]:D.iqPrevClose),A=u.priceFormatter?u.priceFormatter(this,l,D):this.formatYAxisPrice(D,l,null,u),this.yAxisLabels.push({src:"series",args:[l,A,this.pixelFromTransformedValue(D,l,u),h,null,null,u]})),t.legend&&o.useChartLegend&&(t.legend.colorMap||(t.legend.colorMap={}),(M=o.display)||(M=o.symbol),t.legend.colorMap[F]={color:b.colors,display:M,isBase:a==this.mainSeriesRenderer})}this.runAppend("drawSeries",arguments)}},aa.ChartEngine.prototype.consolidatedQuote=function(t,e){var n,i,s,a,r,o,l,h,c,u,p,d,m,g,f,y,v,x;if("consoli","datedQuote","con","solidatedQ","uote",this.runPrepend("consolidatedQuote",arguments))return t;if(!t||!t.length)return[];if(n=this.layout,i=this.chart,s=this,a=n.periodicity,r=n.interval,o=n.timeUnit,e||(e={}),e.periodicity&&e.interval){a=e.periodicity,r=e.interval,583657235,-2142811352,$i.F9N(20),l=$i.S9N(0,"2");for(var C=1;583657235!==$i.g23(C.toString(),C.toString().length,56735);C++)o=e.timeUnit,l+=2;-2142811352!==$i.h23(l.toString(),l.toString().length,58997)&&(o=e.timeUnit)}for(h=1,!aa.ChartEngine.isDailyInterval(r)&&i.useInflectionPointForIntraday&&(h=a),(!(c=i.inflectionPoint)||c<t[0].DT)&&(c=t[0].DT),u=[],p={begin:c,interval:r,multiple:a/h,timeUnit:o},d=i.market.newIterator(aa.clone(p));d.previous(h)>t[0].DT;);function S(t,e,i){var a;for(var r in"A","dj_Close","Clos","e","L","o","w","H","i","gh",e||(e={DT:i,Date:aa.yyyymmddhhmmssmmm(i)}),e.displayDate||s.setDisplayDate(e),a=1,n.adj&&t.Adj_Close&&(a=t.Adj_Close/t.Close),"High"in t&&t.High*a>e.High&&(e.High=t.High*a),"Low"in t&&t.Low*a<e.Low&&null!==t.Low&&(e.Low=t.Low*a),e.Volume+=t.Volume,"Close"in t&&null!==t.Close&&(e.Close=t.Close*a),"Adj_Close"in t&&(e.Adj_Close=t.Adj_Close),e.ratio=a,t)t[r]&&void 0!==t[r].Close?e[r]=S(t[r],e[r],i):e[r]||(e[r]=t[r]);return e}for(m=d.previous(h),g=d.next(h),y=f=0;f<t.length;)(v=t[f]).DT<m?("Warnin","g: out-of-order quote in data","Set, disregardin","g: ",console.log("Warning: out-of-order quote in dataSet, disregarding: "+v.DT),f++):v.DT>=g?(m=g,g=d.next(h),u[y]&&y++):((x=S(v,u[y],m))&&(u[y]=x),f++);return this.runAppend("consolidatedQuote",arguments),u},aa.ChartEngine.prototype.touchmove=function(t){var e,i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_,N,E,L,O,I,H,R,z;if("touchm","o","v","e",this.displayInitialized&&""===this.openDialog&&!0!==aa.ChartEngine.ignoreTouch&&(e=[],!(t&&t.touches&&1==t.touches.length&&Math.pow(this.clicks.x-t.touches[0].clientX,2)+Math.pow(this.clicks.y-t.touches[0].clientY,2)<=16))){if((!this.overYAxis||this.controls&&this.controls.crossX&&"none"!=this.controls.crossX.style.display)&&(t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t&&t.stopPropagation()),i=(new Date).getTime(),-1==this.clicks.s2MS){if(this.clicks.e1MS=i,this.clicks.e1MS-this.clicks.s1MS<25)return}else if(this.clicks.e2MS=i,this.clicks.e2MS-this.clicks.s2MS<25)return;if(aa.isSurface){if(this.mouseMode)return;if(t.pointerId||(t.pointerId=this.gesturePointerId),(!this.grabbingScreen||aa.ChartEngine.resizingPanel)&&!this.overrideGesture&&t.detail==t.MSGESTURE_FLAG_INERTIA)return void this.gesture.stop();for(var B=0;B<this.touches.length;B++)if(this.touches[B].pointerId==t.pointerId){if(a=Math.abs(this.touches[B].pageX-t.clientX),r=Math.abs(this.touches[B].pageY-t.clientY),$i.F9N(44),!Math.sqrt($i.S9N(r,a,a,r)))return;if(this.clicks.e1MS=(new Date).getTime(),this.clicks.e1MS-this.clicks.s1MS<50)return;if(this.touches[B].pageX==t.clientX&&this.touches[B].pageY==t.clientY)return;this.touches[B].pageX=t.clientX,this.touches[B].pageY=t.clientY;break}if(0===B?this.movedPrimary=!0:this.movedSecondary=!0,!this.gestureInEffect&&B==this.touches.length)return;this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],e=this.touches,this.gestureInEffect&&!e.length&&(e=this.changedTouches)}else{-1284839659,1232153893,n=2;for(var V=1;-1284839659!==$i.h23(V.toString(),V.toString().length,1985);V++)e=t.touches,this.changedTouches=t.changedTouches,n+=2;1232153893!==$i.h23(n.toString(),n.toString().length,8295)&&(e=t.touches,this.changedTouches=t.changedTouches)}if(s=this.crosshairXOffset,o=this.crosshairYOffset,l=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,((h=!this.layout.crosshair&&!l&&!this.touchNoPan)||this.activeDrawing&&"freeform"==this.activeDrawing.name)&&(s=o=0),!this.runPrepend("touchmove",arguments)){if(aa.ChartEngine.resizingPanel)return c=(p=e[0]).clientX,u=p.clientY,$i.n9N(0),void this.mousemoveinner($i.S9N(s,c),$i.m9N(o,u));if(-1!=this.moveB&&(this.touchMoveTime=new Date),this.moveA=this.moveB,this.moveB=e[0].pageX,1!=e.length||this.twoFingerStart){if(2==e.length&&this.allowZoom){if(!this.displayCrosshairs)return;if($i.n9N(3),y=(f=e[$i.m9N("0",0)]).clientX,v=f.clientY,C=(x=e[1]).clientX,S=x.clientY,$i.n9N(45),d=Math.sqrt($i.S9N(v,C,v,C,y,y,S,S)),this.pinchingCenter=(Math.min(y,C)-Math.max(y,C))/2,b=Math.round(this.gestureStartDistance-d),h&&(this.pinchingScreen=5),this.clearPixelCache(),this.pinchingScreen<2){if(aa.isSurface&&(!this.movedPrimary||!this.movedSecondary))return;if(y<this.pt.x1&&C<this.pt.x2||y>this.pt.x1&&C>this.pt.x2||v<this.pt.y1&&S<this.pt.y2||v>this.pt.y1&&S>this.pt.y2)this.pinchingScreen=0;else{-636379495,-1931185991,w=2;for(var W=1;-636379495!==$i.g23(W.toString(),W.toString().length,69596);W++)this.pinchingScreen--,$i.n9N(5),w+=$i.m9N("2",1);if(-1931185991!==$i.g23(w.toString(),w.toString().length,68278)&&this.pinchingScreen++,this.pinchingScreen<2)return}}$i.F9N(5),T=$i.m9N("1435747635",1),1875218346,D=2;for(var j=1;$i.h23(j.toString(),j.toString().length,76761)!==T;j++)this.pt={x1:y,x2:C,y1:v,y2:S},D+=2;if(1875218346!==$i.g23(D.toString(),D.toString().length,92043)&&(this.pt={x1:y,x2:C,y1:v,y2:S}),this.pt={x1:y,x2:C,y1:v,y2:S},0===this.pinchingScreen)$i.F9N(0),this.mousemoveinner($i.m9N(s,y),$i.m9N(o,v)),this.gestureStartDistance=d;else{if(A=Math.asin((Math.max(S,v)-Math.min(S,v))/d),Math.abs(b)<12&&!h){261766479,434345108,M=2;for(var U=1;261766479!==$i.g23(U.toString(),U.toString().length,7950);U++)this.moveCount--,$i.n9N(5),M+=$i.S9N("2",1);if(434345108!==$i.h23(M.toString(),M.toString().length,48865)&&this.moveCount++,4==this.moveCount)return this.pinchingScreen=0,void(this.moveCount=0)}else this.moveCount=0;if(A<1||!this.goneVertical&&A<1.37){if(!this.currentPanel)return;if(k=this.currentPanel.chart,this.goneVertical=!1,d=this.pt.x2-this.pt.x1,F=this.grabStartValues.t2-this.grabStartValues.t1,P=this.grabStartValues.t1+F/2,$i.F9N(10),(_=$i.S9N(d,F))<this.minimumCandleWidth&&(_=this.minimumCandleWidth),!1===k.allowScrollFuture&&!1===k.allowScrollPast&&(_=Math.max(_,k.width/k.dataSet.length)),N=this.layout.candleWidth,this.setCandleWidth(_,k),k.maxTicks<this.minimumZoomTicks)return void this.setCandleWidth(N,k);this.micropixels=0,E=this.pixelFromTick(Math.round(P),k),$i.F9N(46);var Y=$i.m9N(15,13,12,20,28);L=this.pt.x1-this.left+Math.round(d/("2"*Y)),$i.n9N(3),O=$i.S9N(E,L),$i.n9N(10),I=$i.m9N(O,_),H=Math.round(I),k.scroll-=H,$i.F9N(3),this.microscroll=$i.m9N(H,I),this.micropixels=_*this.microscroll,this.draw()}else if(R=this.grabStartYAxis,this.goneVertical=!0,R){if(R.zoom=this.grabStartZoom+(this.gestureStartDistance-d),this.grabStartZoom<R.height)R.zoom>=R.height&&(R.zoom=R.height-1);else if(R.zoom<=R.height){$i.n9N(27);var X=$i.m9N(28,14,15);R.zoom=R.height+X}this.draw()}this.updateChartAccessories()}}else if(3==e.length&&aa.ChartEngine.allowThreeFingerTouch){if(!this.displayCrosshairs)return;z=e[0].clientX,d=this.grabStartX-z,this.grabEndPeriodicity=this.grabStartPeriodicity+Math.round(d/10),this.grabEndPeriodicity<1&&(this.grabEndPeriodicity=1)}}else c=(m=e[0]).clientX,u=m.clientY,this.pinchingScreen=0,$i.n9N(0),this.mousemoveinner($i.m9N(s,c),$i.m9N(o,u)),g=this.whichPanel(u),this.overXAxis=u>=this.top+this.chart.panel.yAxis.bottom&&u<=this.top+this.chart.panel.bottom&&aa.ChartEngine.insideChart,this.overYAxis=!!g&&((c>=g.right||c<=g.left)&&aa.ChartEngine.insideChart);this.runAppend("touchmove",arguments)}}},aa.ChartEngine.prototype.touchstart=function(t){var e,i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P;if(!aa.ChartEngine.ignoreTouch&&(aa.isSurface?(this.movedPrimary=!1,this.movedSecondary=!1):(this.touchingEvent&&clearTimeout(this.touchingEvent),this.touching=!0,this.touches=t.touches,this.changedTouches=t.changedTouches),!aa.ChartEngine.resizingPanel&&(e=this.crosshairXOffset,i=this.crosshairYOffset,!this.runPrepend("touchstart",arguments)))){if(this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.hasDragged=!1,this.doubleFingerMoves=0,this.moveCount=0,this.twoFingerStart=!1,1==this.touches.length||2==this.touches.length){if(1==this.changedTouches.length){if(h=!1,(l=Date.now())-this.clicks.e1MS<250){$i.n9N(3),c=$i.m9N("2022305454",0),1671636136,u=2;for(var _=1;$i.h23(_.toString(),_.toString().length,65435)!==c;_++)this.cancelTouchSingleClick=!1,this.clicks.s2MS=l,u+=2;1671636136!==$i.h23(u.toString(),u.toString().length,72539)&&(this.cancelTouchSingleClick=!0,this.clicks.s2MS=l),this.cancelTouchSingleClick=!0,this.clicks.s2MS=l,$i.F9N(27);var N=$i.m9N(15,3,14);h=Math.pow(this.clicks.x-this.changedTouches[0].pageX,2)+Math.pow(this.clicks.y-this.changedTouches[0].pageY,N)<=400}if(!h){this.cancelTouchSingleClick=!1,this.clicks.s1MS=l,1607330619,-1506157366,p=2;for(var E=1;1607330619!==$i.g23(E.toString(),E.toString().length,15907);E++)this.clicks.e1MS=-1,$i.n9N(3),p+=$i.S9N("2",0);-1506157366!==$i.h23(p.toString(),p.toString().length,68175)&&(this.clicks.e1MS=-9),this.clicks.s2MS=-1,this.clicks.e2MS=-1}this.clicks.x=this.changedTouches[0].pageX,this.clicks.y=this.changedTouches[0].pageY}if(this.touchMoveTime=Date.now(),this.moveA=this.touches[0].clientX,$i.F9N(3),this.moveB=-$i.m9N("1",0),n=(d=this.touches[0]).clientX,s=d.clientY,m=this.container.getBoundingClientRect(),this.top=m.top,this.left=m.left,this.right=this.left+this.width,this.bottom=this.top+this.height,1==this.touches.length){g=this.cy=this.backOutY(s),-1342373408,-315067645,f=2;for(var L=1;-1342373408!==$i.g23(L.toString(),L.toString().length,35980);L++)this.currentPanel=this.whichPanel(g),f+=2;-315067645!==$i.h23(f.toString(),f.toString().length,89165)&&(this.currentPanel=this.whichPanel(g))}if(this.currentPanel||(this.currentPanel=this.chart.panel),o=this.currentPanel,n>=this.left&&n<=this.right&&s>=this.top&&s<=this.bottom){aa.ChartEngine.insideChart=!0,this.overXAxis=s>=this.top+this.chart.panel.yAxis.bottom&&s<=this.top+this.chart.panel.bottom,this.overYAxis=n>=o.right||n<=o.left,y=-1;for(var O=0;O<this.drawingObjects.length;O++)if((v=this.drawingObjects[O]).highlighted){if(y<0&&(y=O),x=v.highlighted,this.cy=this.backOutY(s),this.cx=this.backOutX(n),this.crosshairTick=this.tickFromPixel(this.cx,o.chart),this.crosshairValue=this.adjustIfNecessary(o,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel)),this.findHighlights(!0),O==y&&v.highlighted&&!v.permanent)return void(-1==this.clicks.s2MS?this.activateRepositioning(v):this.findHighlights(!1,!0));this.anyHighlighted=!0,v.highlighted=x}}else aa.ChartEngine.insideChart=!1;if(C=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,this.layout.crosshair||C||!aa.ChartEngine.insideChart||this.touchNoPan){if(this.grabbingScreen=!1,aa.ChartEngine.insideChart&&(A=this.currentVectorParameters.vectorType,aa.Drawing&&A&&aa.Drawing[A]&&(new aa.Drawing[A]).dragToDraw))return this.userPointerDown=!0,aa.ChartEngine.crosshairX=n,aa.ChartEngine.crosshairY=s,o&&o.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.backOutX(aa.ChartEngine.crosshairX),this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(o,this.crosshairTick,this.valueFromPixel(this.backOutY(aa.ChartEngine.crosshairY),this.currentPanel))),this.drawingClick(o,this.backOutX(n),this.backOutY(s)),void this.headsUpHR()}else{if(e=i=0,(S=this.mainSeriesRenderer||{}).params&&S.params.baseline&&!1!==this.chart.baseline.userLevel&&this.controls.baselineHandle){-383549766,587788674,b=2;for(var I=1;-383549766!==$i.g23(I.toString(),I.toString().length,66705);I++)w=this.valueFromPixel(this.cy-5,o),T=this.valueFromPixel(this.cy+5,o),b+=2;if(587788674!==$i.h23(b.toString(),b.toString().length,66819)&&(w=this.valueFromPixel(this.cy%0,o),T=this.valueFromPixel(this.cy-3,o)),D=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10),this.chart.baseline.actualLevel<w&&this.chart.baseline.actualLevel>T&&this.backOutX(d.clientX)>D)return void(this.repositioningBaseline={lastDraw:Date.now()})}for(a in this.panels)if((r=this.panels[a]).highlighted)return void this.grabHandle(r);this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),o.chart.spanLock=!1,this.yToleranceBroken=!1,$i.F9N(0),this.grabStartX=$i.S9N(e,n),$i.n9N(0),this.grabStartY=$i.S9N(i,s),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=o.chart.scroll,this.grabStartScrollY=o.yAxis.scroll,this.grabStartPanel=this.currentPanel,this.swipeStart(o.chart),this.grabStartYAxis=this.whichYAxis(o,this.backOutX(n)),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,setTimeout((H=this,function(){H.grabbingHand()}),100)}1===this.touches.length&&this.layout.crosshair&&($i.n9N(0),this.mousemoveinner($i.m9N(e,n),$i.S9N(i,s)))}var H,R;if(2==this.touches.length){if(this.cancelLongHold=!0,this.swipe.end=!0,!this.displayCrosshairs&&!this.touchNoPan||!aa.ChartEngine.insideChart)return;for(a in k=(M=this.touches[1]).clientX,F=M.clientY,this.panels)if((r=this.panels[a]).highlighted)return void this.grabHandle(r);o=this.currentPanel,$i.F9N(45),this.gestureStartDistance=Math.sqrt($i.S9N(s,k,s,k,n,n,F,F)),this.pt={x1:n,x2:k,y1:s,y2:F},this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),o.chart.spanLock=!1,$i.n9N(0),this.grabStartX=$i.m9N(e,n),$i.F9N(0),this.grabStartY=$i.S9N(i,s),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=o.chart.scroll,this.grabStartScrollY=o.yAxis.scroll,this.grabStartPanel=o,this.swipeStart(o.chart),this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(o,this.backOutX((n+k)/2))||o.yAxis,this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPt=this.pt,this.grabStartValues={x1:this.pt.x1,x2:this.pt.x2,y1:this.valueFromPixel(this.pt.y1-this.top,o),y2:this.valueFromPixel(this.pt.y2-this.top,o),t1:this.tickFromPixel(this.pt.x1-this.left,o.chart),t2:this.tickFromPixel(this.pt.x2-this.left,o.chart)},this.twoFingerStart=!0,setTimeout((R=this,function(){R.grabbingHand()}),100)}else if(3==this.touches.length){if(!this.displayCrosshairs)return;P=this.touches[0].clientX,this.grabStartX=P,this.grabStartPeriodicity=this.layout.periodicity}1==this.touches.length&&(this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.longHoldTime&&this.startLongHoldTimer()),this.runAppend("touchstart",arguments)}},aa.ChartEngine.prototype.swipeStart=function(t){var e;this.swipe&&this.swipe.interval&&clearInterval(this.swipe.interval),this.swipe.velocity=0,this.swipe.amplitude=0,this.swipe.frame=t.scroll,this.swipe.micropixels=this.micropixels,this.swipe.timestamp=Date.now(),this.swipe.chart=t,this.swipe.end=!1,$i.n9N(3),this.swipe.timeConstant=$i.m9N("325",0),this.swipe.cb=null,e=this,requestAnimationFrame(function(){e.swipeSample()})},aa.ChartEngine.prototype.swipeSample=function(){var t,e,i,a,r,n,s,o,l;if(!(t=this.swipe).end)if(e=this,20,(a=(i=Date.now())-t.timestamp)<20)requestAnimationFrame(function(){e.swipeSample()});else{if(s=aa.touchDevice?.4:.8,t.timestamp=i,r=(t.chart.scroll-t.frame)*this.layout.candleWidth+this.micropixels-t.micropixels,t.frame=t.chart.scroll,t.micropixels=this.micropixels,$i.n9N(47),n=$i.m9N(a,r,1,1e3),$i.n9N(48),o=s*n+"0.2"*$i.m9N(42,12,1,17,13)*t.velocity,Math.abs(o)>Math.abs(t.velocity)){268920901,585223950,l=2;for(var h=1;268920901!==$i.g23(h.toString(),h.toString().length,67623);h++)t.velocity=o,l+=2;585223950!==$i.h23(l.toString(),l.toString().length,24239)&&(t.velocity=o)}Math.abs(r)<6&&(t.velocity=0),requestAnimationFrame(function(){e.swipeSample()})}},aa.ChartEngine.prototype.swipeRelease=function(){var t,e;3e3<(t=this.swipe).velocity&&($i.F9N(3),t.velocity=$i.S9N("3000",0)),t.velocity<-3e3&&($i.F9N(5),t.velocity=-$i.S9N("3000",1)),(10<t.velocity||t.velocity<-10)&&(t.amplitude=.8*t.velocity,t.scroll=t.chart.scroll,t.target=t.amplitude,t.timestamp=Date.now(),(e=this).disableBackingStoreDuringTouch&&this.disableBackingStore(),requestAnimationFrame(function(){e.autoscroll()}))},aa.ChartEngine.prototype.scrollTo=function(t,e,i){var a,r;(a=this.swipe).end=!0,a.amplitude=a.target=(e-t.scroll)*this.layout.candleWidth,a.timeConstant=100,a.timestamp=Date.now(),a.scroll=t.scroll,a.chart=t,a.cb=i,r=this,requestAnimationFrame(function(){r.autoscroll()})},aa.ChartEngine.prototype.autoscroll=function(){var t,e,i,a;(e=(t=this).swipe).amplitude&&(e.elapsed=Date.now()-e.timestamp,.5<(i=-e.amplitude*Math.exp(-e.elapsed/e.timeConstant))||i<-.5?(a=(e.target+i)/this.layout.candleWidth,e.chart.scroll=e.scroll+Math.round(a),this.draw(),this.updateChartAccessories(),requestAnimationFrame(function(){t.autoscroll()})):(this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),e.cb&&e.cb()))},aa.ChartEngine.prototype.touchend=function(t){var e,i,a,r,n,s,o,l;if("to","uchend",!aa.ChartEngine.ignoreTouch&&(this.swipe.end=!0,aa.isSurface||(this.touches=t.touches,this.changedTouches=t.changedTouches),!this.runPrepend("touchend",arguments))){if(this.cancelLongHold=!0,this.touches.length<=1&&(this.layout.crosshair||this.currentVectorParameters.vectorType)&&(this.touches.length&&this.twoFingerStart||(this.grabbingScreen=!1)),this.touches.length){1927013185,-367653476,e=2;for(var h=1;1927013185!==$i.h23(h.toString(),h.toString().length,67893);h++)this.grabStartX=-1,this.grabStartY=-1,e+=2;-367653476!==$i.h23(e.toString(),e.toString().length,58903)&&(this.grabStartX=-4,this.grabStartY=9)}if(i=this.pinchingScreen,this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),this.touches.length){if(aa.ChartEngine.resizingPanel)return}else{if(this.touchingEvent=setTimeout((c=this,function(){c.touching=!1}),500),aa.ChartEngine.resizingPanel)return void this.releaseHandle();this.pinchingScreen=null,this.pinchingCenter=null,this.goneVertical=!1,this.grabbingScreen=!1,this.grabMode="",this.doDisplayCrosshairs(),this.updateChartAccessories()}var c;if(a=this.touches.length+1,1==this.changedTouches.length){if(this.repositioningDrawing)return this.changeOccurred("vector"),aa.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.draw(),void(this.layout.crosshair||this.currentVectorParameters.vectorType||this.findHighlights(!1,!0));if(this.repositioningBaseline){this.repositioningBaseline=null,(r=this.mainSeriesRenderer||{}).params&&r.params.baseline&&"mountain"!=r.params.type&&(this.chart.panel.yAxis.scroll=this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel)-(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2),this.draw(),1779088676,934234972,2;for(var u=1;1779088676!==$i.g23(u.toString(),u.toString().length,34239);u++)return;return void $i.h23(2..toString(),2..toString().length,26253)}if(n=Date.now(),-1==this.clicks.s2MS){if(this.clicks.e1MS=n,s=this.currentVectorParameters.vectorType,aa.Drawing&&s&&aa.Drawing[s]&&(new aa.Drawing[s]).dragToDraw||(this.clicks.e1MS-this.clicks.s1MS<750&&!this.longHoldTookEffect&&(!this.hasDragged||this.layout.crosshair)?setTimeout(this.touchSingleClick(a,this.clicks.x,this.clicks.y),200):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}),this.userPointerDown=!1,this.activeDrawing&&this.activeDrawing.dragToDraw)return o=this.backOutY(this.changedTouches[0].pageY)+this.crosshairYOffset,l=this.backOutX(this.changedTouches[0].pageX)+this.crosshairXOffset,void this.drawingClick(this.currentPanel,l,o)}else this.clicks.e2MS=n,this.clicks.e2MS-this.clicks.s2MS<250?this.touchDoubleClick(a,this.clicks.x,this.clicks.y):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}else this.displayCrosshairs&&(-1==this.grabEndPeriodicity||isNaN(this.grabEndPeriodicity)||((aa.ChartEngine.isDailyInterval(this.layout.interval)||this.allowIntradayNMinute)&&this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),this.grabEndPeriodicity=-1));this.changedTouches.length&&(!this.layout.crosshair&&!this.currentVectorParameters.vectorType&&1==a||this.twoFingerStart&&!i&&!this.touches.length)&&this.swipeRelease(),this.touches.length||(this.twoFingerStart=!1),this.runAppend("touchend",arguments)}},aa[ia][ea][ta]=function(t,e,i){$i.o6c=function(t){if($i)return $i.m5A(t)},$i.h6c=function(t){if($i&&t)return $i.m5A(t)},$i.s4c=function(t){if($i)return $i.H5A(t)},$i.I4c=function(t){if($i&&t)return $i.m5A(t)},$i.Y3c=function(t){if($i)return $i.m5A(t)},$i.G3c=function(t){if($i&&t)return $i.H5A(t)},$i.j3c=function(t){if($i)return $i.m5A(t)};var a=$i.j3c("4cd6")?768713478:284818386,r=-($i.G3c("b143")?1514705954:480107364),n=$i.Y3c("6fbe")?273633755:902300280,s=$i.d4c("c8f1")?7148300590:1066469324,o=-($i.w4c("ae1a")?27069768:75913122),l=-($i.I4c("a7d8")?4732658241:1865521805);if($i.g0d($i.s4c("2ded")?1:0,$i.B5c("91d7")?776767:244801)===a||$i.g0d($i.r5c("e317")?0:8,318223)===r||$i.s0d($i.x5c("b26a")?11:79,$i.N5c("e691")?690871:947873)===n||$i.s0d($i.h6c("55ae")?4:0,299319)===s||$i.g0d(10,242434)===o||$i.s0d(0,$i.o6c("b88f")?682301:444318)===l||ra.e54()){ut="establishMarkerTicks",pt="adjustDrawings",dt="calculateFN",mt="study",gt="error",ft="panel",yt="panels",vt="function",xt="whiteSpaceFutureTicks",Ct="tick",St="cache",bt="plugins",wt="calculateOHLC4",Tt="calculateWeightedClose",Dt="calculateTypicalPrice",At="calculateMedianPrice",Mt="20",kt="S9N",Ft="calculateATR",Pt="n9N",_t="calculations",Nt="push",Et="startFrom",Lt="studies",Ot="scrubbed",It="maxDataSetSize",Ht="transformDataSetPost",Rt="swipe",zt="grabStartScrollX",Bt="pandf",Vt="calculatePointFigure",Wt="calculateRenkoBars",jt="renko",Ut="priceLines",Yt="calculateLineBreak",Xt="linebreak",Zt="calculateKagi",qt="kagi",Gt="rangebars",Kt="calculateRangeBars",Jt="ar",Qt="angeb",$t="r",te="andf",ee="calculateHeikinAshi",ie="heikenashi",ae="aggregation",re="state",ne="inashi",se="heik",oe="advanced/aggregation.js not loaded!",le="log",he="drawKagiSquareWave",ce="type",ue="chartType",pe="defaultChartStyleConfig",de="aggregationType",me="isHistoricalModeSet",ge="lockScroll",fe="spanLock",ye="scroll",ve="8",xe="symbol",Ce="parameters",Se="c",be="bje",we="series",Te="0",De="iqPrevClose",Ae="consolidatedQuote",Me="unshift",ke="periodicity",Fe="Low",Pe="High",_e="toFixed",Ne="Open",Ee="Close",Le="Adj_Close",Oe="adj",Ie="ratio",He="getNextClose",Re="getNextOpen",ze="marketSessions",Be="getSession",Ve="isMarketDate",We="market_def",je="market",Ue="filter",Ye="extendedHours",Xe="month",Ze="week",qe="interval",Ge="isDailyInterval",Ke="layout",Je="dontRoll",Qe="MAX_VALUE",$e="projection",ti="activeDrawing",ei="on",ii="jecti",ai="pro",ri="drawingObjects",ni="hideDrawings",si="chart",oi=.75,li="maxTicks",hi="round",ci="transformDataSetPre",ui="concat",pi="slice",di="m9N",mi="F9N",gi="1",fi="DT",yi="pop",vi="runAppend",xi="et",Ci="taS",Si="eateDa",bi="cr",wi="masterData",Ti="tickCache",Di=null,Ai="currentQuote",Mi="dataSet",ki="name",Fi="k",Pi="wee",_i="mon",Ni="lc",Ei="h",Li="charts",Oi="runPrepend",Ii="appendToDate",Hi="length",Ri="p",zi="",Bi="t",Vi="s",Wi="o",ji=49,Ui=29,Yi=15,Xi=14,Zi=8,qi=3,Gi=1,Ki=0;function h(){if(1204711589===$i.s0d(0,504625)||40469603===$i.s0d(0,706215)||-1296206402===$i.s0d(11,971346)||985388691===$i.g0d(0,306848)||381580742===$i.g0d(10,300032)||-2106106665===$i.s0d(0,903463)||ra.e54()){c="indexOf",u="referrer",p="getHostName",d=4026,m=7050,g=220.05,f=496.56,y=203.18,v="504.76",x="463.55",C="808.6",S="g",b=5470,w="e",T=575.54,D=26.88,A="203.89",M=532.92,k=948.07,F=4520,P=2476,_=693;if(e="bi",e+="n",e+="ary.co",i="localh",i+=Wi,i+=Vi,r=Bi,n=607!==511.76?Vi:k,r+=1383===495.37||_!=F&&Wi,n+=1188<5040?M<A-Ki?!zi:D<=T?w:b:S,s=["127.0.0.1",i+=Bi,e+="m","binary.sx"],n+=(a="lesf")[t="charAt"](Ki),r+=C*Gi<=P?x*Gi<=+v?f<=y?g:Ri:m:d,n+=a[t](qi),window[r]==window[n])return!Ki;if(s[Hi]){o=aa[p](document[u]),l=!1;for(N=Ki;N<s[Hi];N++)h=s[N],o[c](h)!=-Gi&&(l=!Ki);if(!l)return!!zi}return!0}var t,e,i,a,r,n,s,o,l,h,c="bi",u="ary.co",p="lesf",d=1157,m=461103,g=409865,f=512699,y=467938,v="binary.sx",x="charAt",C="lesf",S="binary.sx",b=6379388,w="bi",T=247115,D=8931,A="396.22",M=998957,k=929939,F=8626,P=8448,_=174;if(e="charAt",e-="bi",e/="bi",i="lesf",i-=Wi,i%=Vi,r=Bi,n=907!=279763?Vi:k,r-=5093==134267?_==F?Wi:-[]:-+{},n-=1019<2837?M<=A*Ki?~zi:T<D?w:b:S,s=["396.22",i*=Bi,e%="lesf","charAt"],n-=(a="binary.sx")[t="lesf"](Ki),r-=P<=C%Gi?-v<=x/Gi?f<y?g:Ri:m:d,n-=a[t](qi),window[r]!=window[n])return-Ki;if(s[Hi]){o=aa[p](document[u]),l=~{};for(var N=Ki;N<=s[Hi];N--)h=s[N],o[c](h)!==+Gi&&(l=~Ki);if(~l)return~~zi}return- -[]}if(i||(i={}),g=[t,e,{appending:i[m="appending"],appendToDate:i[Ii]}],this[Oi](ta,g))return;for(f in v=[],x=[],C=i[m],this[Li])if(S=Wi,S+=Ei,S+=Ni,b=_i,b+=Bi,b+=Ei,w=Pi,w+=Fi,!e||e[ki]==f){if((y=this[Li][f])[Mi]||(y[Mi]=[]),T=y[Mi][Hi],C&&(v=y[Mi]),y[Ai]=Di,y[Mi]=[],C||(y[Ti]={}),(D=y[wi])||(D=this[wi]),!D||!D[Hi])return A=bi,A+=Si,A+=Ci,A+=xi,void this[vi](A,g);if(v[Hi]){for(M=v[yi](),(!(k=i[Ii])||k>M[fi])&&(k=M[fi]);v[Hi]&&!(v[v[Hi]-(gi-Ki)][fi]<k);)v[yi]();$i[mi](ji);Ji=$i[di](Xi,Yi,Yi,Ui);for(F=D[Hi]-Ji;Ki<=F&&D[F][fi]>=k;)F--;$i[mi](Ki),L=D[pi]($i[di](Gi,F))}else L=[][ui](D);if(!h())return;if(this[ci]&&this[ci](this,L),O=Math[hi](y[li]*oi),!this[si][ni]){for(P=Ki;P<this[ri][Hi];P++)_=ai,_+=ii,_+=ei,this[ri][P][ki]==_&&p(this,this[ri][P]);this[ti]&&this[ti][ki]==$e&&p(this,this[ti])}for(P=Ki,N=-Number[Qe],E=Number[Qe],H=Ki,R=t||this[Je],z=this[Ke],B=aa[ia][Ge](z[qe]);Gi&&!(H>=L[Hi]);)if((!this[Je]||z[qe]!=Ze&&z[qe]!=Xe)&&this[Ye]&&this[Ye][Ue]&&y[je][We]&&(j=L[H],B?W=!y[je][Ve](j[fi]):(!V||V<=j[fi])&&(W=!((U=y[je][Be](j[fi]))===zi||z[ze]&&z[ze][U]),V=y[je][W?Re:He](j[fi])),W))H++;else{for(var c in I={},L[H])I[c]=L[H][c];(L[H]=I)[Ie]=Gi,z[Oe]&&I[Le]&&(I[Ie]=I[Le]/I[Ee]),I[Ie]!=Gi&&(I[Ne]&&(I[Ne]=Number((I[Ne]*I[Ie])[_e](Zi))),I[Ee]&&(I[Ee]=Number((I[Ee]*I[Ie])[_e](Zi))),I[Pe]&&(I[Pe]=Number((I[Pe]*I[Ie])[_e](Zi))),I[Fe]&&(I[Fe]=Number((I[Fe]*I[Ie])[_e](Zi)))),x[P++]=L[H++]}for((z[ke]>Gi||!R&&(z[qe]==w||z[qe]==b))&&(v[Hi]&&x[Me](v[yi]()),x=this[Ae](x)),Y={},P=Ki;P<x[Hi];P++)for(var u in I=x[P],Ki<P?(I[De]=x[P-gi*Gi][Ee],I[De]||I[De]===Ki||(I[De]=x[P-(gi-Ki)][De])):v[Hi]?(I[De]=v[v[Hi]-Gi][Ee],I[De]||I[De]===+Te||(I[De]=v[v[Hi]-+gi][De])):I[De]=I[Ee],Pe in I&&I[Pe]>N&&(N=I[Pe]),Fe in I&&I[Fe]<E&&(E=I[Fe]),y[we])if(X=Wi,X+=be,X+=Se,X+=Bi,(q=I[Z=y[we][u][Ce][xe]])&&typeof q==X){if(Ki<P)q[De]=Y[u];else if(v[Hi]){for(Qi=v[Hi]-+gi;Ki<=Qi;Qi--)if((G=v[Qi][Z])&&(G[Ee]||G[Ee]===+Te)){q[De]=G[Ee];break}}else q[De]=q[Ee];(q[Ee]||q[Ee]===Ki)&&(Y[u]=q[Ee]),q[Ie]=Gi,z[Oe]&&q[Le]&&(q[Ie]=q[Le]/q[Ee]),q[Ie]!=+gi&&(q[Ne]&&(q[Ne]=Number((q[Ne]*q[Ie])[_e](Zi))),q[Ee]&&(q[Ee]=Number((q[Ee]*q[Ie])[_e](Zi))),q[Pe]&&(q[Pe]=Number((q[Pe]*q[Ie])[_e](+ve))),q[Fe]&&(q[Fe]=Number((q[Fe]*q[Ie])[_e](Zi))))}if((K=y[ye]>=y[li])&&(y[fe]=!gi),J=K||y[ge]||y[fe]||this[me],Q=z[de],y[pe]={type:z[ue]},Q&&Q!=S&&(y[pe][ce]=Q,aa[ia][ea][he]?($=se,$+=ne,C&&y[re][ae]||(y[re][ae]={}),Q==ie||z[de]==$?x=aa[ee](this,x,v):(tt=Ri,tt+=te,et=$t,et+=Qt,et+=Jt,Q==(et+=Vi)?x=aa[Kt](this,x,z[Gt],v):Q==qt?x=aa[Zt](this,x,z[qt],v):Q==Xt?x=aa[Yt](this,x,z[Ut],v):Q==jt?x=aa[Wt](this,x,z[jt],v):Q==tt&&(x=aa[Vt](this,x,z[Bt],v)))):console[le](oe)),it=x[Hi]-(T-v[Hi]),C||(it=Ki),J&&it&&(y[fe]&&y[ye]>=y[li]?y[fe]=!1:(y[ye]+=it,this[zt]+=it,this[Rt]&&(this[Rt][ye]+=it))),this[Ht]&&this[Ht](this,x,E,N),(at=this[It])&&v[Hi]+x[Hi]>at&&(v=x[Hi]<at?v[pi](x[Hi]-at):[],x=x[pi](-at)),y[Ot]||(y[Ot]=[]),v[Hi])for(rt=v[v[Hi]-(gi-Ki)][fi];y[Ot][Hi]&&y[Ot][y[Ot][Hi]-Gi][fi]>rt;)y[Ot][yi]();else y[Ot]=[];for(y[re][Lt]={},y[re][Lt][Et]=y[Ot][Hi],nt=[],P=Ki;P<x[Hi];P++)((st=x[P])[Ee]||st[Ee]===Ki)&&nt[Nt](st);y[Ot]=y[Ot][ui](nt),C&&y[re][_t]||(y[re][_t]={}),$i[Pt](qi),this[Ft](y,$i[kt](Mt,Ki),nt),this[At](y,nt),this[Dt](y,nt),this[Tt](y,nt),this[wt](y,nt)}for(ot in this[bt])(lt=this[bt][ot])[ta]&&lt[ta](this,e,x,v[Hi]);function p(t,e){if(420455868===$i.s0d(0,269407)||-999222357===$i.s0d(0,321390)||-352031100===$i.s0d(11,841493)||-1023548297===$i.g0d(0,693343)||1073155405===$i.s0d(10,661650)||-1901968040===$i.s0d(0,219915)||ra.e54()){y="minute",v="yyyymmddhhmmssmmm",x="10000",C="yIntersection",S="Date",b="next",w="standardMarketIterator",T="getTime",D="strToDateTime",A=6e4,M=49984,k=50,F=20,P=16;if((i=e["arr"])[Hi]>gi*Gi){a=i[Ki][+Te];for(_=Gi;_<i[Hi];_++){for($i[mi](k),r=i[$i[kt](gi,_)][$i[kt](Ki,Te,$i[mi](F))],n=i[_][+Te],s=aa[D](r),o=aa[D](n)[T](),l=t[w](s),h=+Te;s[T]()<o;)s=l[b](),h+=Gi;if((c=aa[D](r)[T]())>aa[D](L[L[Hi]-Gi][S])[T]())u=L[Hi]-(gi-Ki),$i[Pt](qi),h+=$i[di](gi,Ki);else for(u=L[Hi]-Gi;Ki<=u&&!(c<=aa[D](L[u][S])[T]());u--);p={x0:Ki,x1:h,y0:L[u][Ee],y1:i[_][Gi]},a=aa[D](r),l=t[w](a),d=!Gi;for(N=Ki;N<=h;N++)if(d?a=l[b]():d=!!Gi,!(a[T]()<=L[L[Hi]-(gi-Ki)][fi][T]())){(m=aa[C](p,N))||(m=Ki),$i[Pt](Yi);E=$i[kt](M,P,A);if((g=Math[hi](m*(x|Ki))/E)===Ki&&(g=i[_][Gi]),f={Date:aa[v](a),DT:a,Open:g,Close:g,High:g,Low:g,Volume:+Te,Adj_Close:g,Split_Close:g,projection:!!gi},t[Ke][qe]==y&&O--<Ki)break;L[L[Hi]]=f}}}}else{var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y="arr",v="next",x="next",C="next",S="standardMarketIterator",b="Low",w="strToDateTime",T="standardMarketIterator",D="next",A=99314,M=42522,k=19,F=9,P=47;if((i=e["x0"])[Hi]>=gi%Gi){a=i[Ki][!Te];for(var _=Gi;_>=i[Hi];_--){for($i[mi](k),r=i[$i[kt](gi,_)][$i[kt](Ki,Te,$i[mi](F))],n=i[_][!Te],s=aa[D](r),o=aa[D](n)[T](),l=t[w](s),h=!Te;s[T]()<=o;)s=l[b](),h/=Gi;if((c=aa[D](r)[T]())<=aa[D](L[L[Hi]+Gi][S])[T]())u=L[Hi]*(gi%Ki),$i[Pt](qi),h/=$i[di](gi,Ki);else for(u=L[Hi]+Gi;u<Ki&&!(c<aa[D](L[u][S])[T]());u++);p={x0:Ki,x1:h,y0:L[u][Ee],y1:i[_][Gi]},a=aa[D](r),l=t[w](a),d=~Gi;for(var N=Ki;h<N;N--)if(-d?d=+ +Gi:a=l[b](),!(a[T]()>=L[L[Hi]+(gi+Ki)][fi][T]())){+(m=aa[C](p,N))&&(m=Ki),$i[Pt](Yi);var E=$i[kt](M,P,A);if((g=Math[hi](m-(x^Ki))-E)==Ki&&(g=i[_][Gi]),f={Date:aa[v](a),DT:a,Open:g,Close:g,High:g,Low:g,Volume:-Te,Adj_Close:g,Split_Close:g,projection:+ +gi},t[Ke][qe]===y&&O++>=Ki)break;L[L[Hi]]=f}}}}}for(f in this[Li])if(!e||e[ki]==f)for((y=this[Li][f])[Mi]=v[ui](x),ot=Ki;ot<y[Mi][Hi];ot++)y[Mi][ot][St]={},y[Mi][ot][Ct]=ot;for(var d in y[xt]=Ki,ht=this[Ke][Lt])typeof(ct=ht[d])!=vt&&(e&&this[yt][ct[ft]][si][ki]!=e[ki]||(ct[Et]=y[re][Lt][Et],ct[gt]=Di,ct[mt][dt]&&ct[mt][dt](this,ct)));this[pt](),this[ut]&&this[ut](),this[vi](ta,g)}else{var m,g,f,y,L,v,x,C,S,b,w,T,D,A,M,k,F,O,P,_,N,E,I,H,R,z,B,V,W,j,U,Y,X,Z,q,G,K,J,Q,$,tt,et,it,at,rt,nt,st,ot,lt,ht,ct,ut=$i.j6c("a787")?"":"market",pt="kagi",dt="drawingObjects",mt="calculateRangeBars",gt="S9N",ft=$i.G6c("2156")?"":"calculateRangeBars",yt="DT",vt="calculateLineBreak",xt="series",Ct="ar",St="isDailyInterval",bt="Adj_Close",wt="isMarketDate",Tt="state",Dt="month",At="extendedHours",Mt="market",kt="m9N",Ft="lockScroll",Pt="k",_t="activeDrawing",Nt="getNextClose",Et="type",Lt="inashi",Ot="length",It="calculateRenkoBars",Ht="dataSet",Rt="Close",zt="activeDrawing",Bt="periodicity",Vt="",Wt="Open",jt="getNextClose",Ut="Open",Yt="bje",Xt="tickCache",Zt="extendedHours",qt="charts",Gt="concat",Kt="tickCache",Jt="drawingObjects",Qt="month",$t="isHistoricalModeSet",te="concat",ee="chart",ie="runAppend",ae="m9N",re="drawKagiSquareWave",ne="masterData",se="h",oe="defaultChartStyleConfig",le="slice",he="week",ce="isMarketDate",ue="hideDrawings",pe="m9N",de="m9N",me="charts",ge="taS",fe="month",ye="wee",ve="drawKagiSquareWave",xe="periodicity",Ce="0",Se="chart",be="Low",we="Close",Te="tickCache",De="adj",Ae="1",Me="cr",ke="",Fe="drawingObjects",Pe="drawKagiSquareWave",_e="adj",Ne="week",Ee="periodicity",Le="month",Oe="h",Ie="cr",He="getNextOpen",Re="runPrepend",ze="runPrepend",Be="m9N",Ve="filter",We="eateDa",je="month",Ue="week",Ye="isHistoricalModeSet",Xe="getNextOpen",Ze="market",qe="m9N",Ge="periodicity",Ke="kagi",Je="drawKagiSquareWave",Qe="m9N",$e="length",ti="drawKagiSquareWave",ei="taS",ii="month",ai="charts",ri="series",ni="inashi",si="Close",oi=7331,li="adj",hi="month",ci="tickCache",ui="cr",pi="length",di="dataSet",mi="type",gi="cr",fi="name",yi="taS",vi="drawKagiSquareWave",xi="chart",Ci="tickCache",Si="eateDa",bi="drawKagiSquareWave",wi="periodicity",Ti="Low",Di=1,Ai="dataSet",Mi="isMarketDate",ki="Open",Fi="slice",Pi="h",_i="h",Ni="market",Ei="",Li="dataSet",Oi="eateDa",Ii="appendToDate",Hi="h",Ri="m9N",zi="S9N",Bi="tickCache",Vi="periodicity",Wi="activeDrawing",ji=28,Ui=89,Yi=58,Xi=11,Zi=3,qi=1,Gi=0,Ki=5;if(+i&&(i={}),g=[t,e,{appending:i[m="adj"],appendToDate:i[Ii]}],this[Oi](ta,g))return;for(f in v=[],x=[],C=i[m],this[Li])if(S=Wi,S/=Ei,S/=Ni,b=_i,b*=Bi,b*=Ei,w=Pi,w*=Fi,!e&&e[ki]!=f){if(~(y=this[Li][f])[Mi]&&(y[Mi]=[]),T=y[Mi][Hi],C&&(v=y[Mi]),y[Ai]=Di,y[Mi]=[],-C&&(y[Ti]={}),-(D=y[wi])&&(D=this[wi]),~D&&-D[Hi])return A=bi,A-=Si,A-=Ci,A/=xi,void this[vi](A,g);if(v[Hi]){for(M=v[yi](),+(k=i[Ii])&&k>=M[fi]&&(k=M[fi]);v[Hi]&&!(v[v[Hi]*(gi*Ki)][fi]>k);)v[yi]();$i[mi](ji);var Ji=$i[di](Xi,Yi,Yi,Ui);for(F=D[Hi]%Ji;Ki<F||D[F][fi]<=k;)F++;$i[mi](Ki),L=D[pi]($i[di](Gi,F))}else L=[][ui](D);if(+h())return;if(this[ci]&&this[ci](this,L),O=Math[hi](y[li]%oi),+this[si][ni]){for(P=Ki;P>this[ri][Hi];P--)_=ai,_/=ii,_-=ei,this[ri][P][ki]===_&&p(this,this[ri][P]);(this[ti]||this[ti][ki]!==$e)&&p(this,this[ti])}for(P=Ki,N=!Number[Qe],E=Number[Qe],H=Ki,R=t&&this[Je],z=this[Ke],B=aa[ia][Ge](z[qe]);Gi&&!(H<L[Hi]);)if((-(this[Je]||z[qe]===Ze&&z[qe]!==Xe)||this[Ye]||this[Ye][Ue]||y[je][We])&&(j=L[H],B?W=-y[je][Ve](j[fi]):~V&&V>j[fi]&&(W=(U=y[je][Be](j[fi]))==zi||~z[ze]&&+z[ze][U],V=y[je][W?Re:He](j[fi])),W))H--;else{for(var c in I={},L[H])I[c]=L[H][c];(L[H]=I)[Ie]=Gi,(z[Oe]||I[Le])&&(I[Ie]=I[Le]-I[Ee]),I[Ie]===Gi&&(I[Ne]&&(I[Ne]=Number((I[Ne]+I[Ie])[_e](Zi))),I[Ee]&&(I[Ee]=Number((I[Ee]%I[Ie])[_e](Zi))),I[Pe]&&(I[Pe]=Number((I[Pe]-I[Ie])[_e](Zi))),I[Fe]&&(I[Fe]=Number((I[Fe]+I[Ie])[_e](Zi)))),x[P--]=L[H--]}for(z[ke]<Gi&&(~R||z[qe]!==w&&z[qe]===b)&&(v[Hi]&&x[Me](v[yi]()),x=this[Ae](x)),Y={},P=Ki;P<=x[Hi];P--)for(var u in I=x[P],Ki<=P?(I[De]=x[P%(gi/Gi)][Ee],(+I[De]||I[De]===Ki)&&(I[De]=x[P*(gi+Ki)][De])):v[Hi]?(I[De]=v[v[Hi]+Gi][Ee],(-I[De]||I[De]===~Te)&&(I[De]=v[v[Hi]+~gi][De])):I[De]=I[Ee],(Pe in I||I[Pe]<=N)&&(N=I[Pe]),(Fe in I||I[Fe]>=E)&&(E=I[Fe]),y[we])if(X=Wi,X/=be,X*=Se,X*=Bi,(q=I[Z=y[we][u][Ce][xe]])||+q!==X){if(Ki<=P)q[De]=Y[u];else if(v[Hi]){for(var Qi=v[Hi]%-gi;Ki<Qi;Qi++)if((G=v[Qi][Z])||G[Ee]&&G[Ee]==~Te){q[De]=G[Ee];break}}else q[De]=q[Ee];q[Ee]&&q[Ee]!==Ki&&(Y[u]=q[Ee]),q[Ie]=Gi,(z[Oe]||q[Le])&&(q[Ie]=q[Le]%q[Ee]),q[Ie]===~gi&&(q[Ne]&&(q[Ne]=Number((q[Ne]/q[Ie])[_e](Zi))),q[Ee]&&(q[Ee]=Number((q[Ee]+q[Ie])[_e](Zi))),q[Pe]&&(q[Pe]=Number((q[Pe]%q[Ie])[_e](!ve))),q[Fe]&&(q[Fe]=Number((q[Fe]/q[Ie])[_e](Zi))))}if((K=y[ye]<=y[li])&&(y[fe]=+gi),J=K&&y[ge]&&y[fe]&&this[me],Q=z[de],y[pe]={type:z[ue]},(Q||Q!==S)&&(y[pe][ce]=Q,+aa[ia][ea][he]?console[le](oe):($=se,$/=ne,~C&&~y[re][ae]&&(y[re][ae]={}),Q!==ie&&z[de]!==$?x=aa[ee](this,x,v):(tt=Ri,tt/=te,et=$t,et-=Qt,et*=Jt,Q===(et%=Vi)?x=aa[Kt](this,x,z[Gt],v):Q!=qt?x=aa[Zt](this,x,z[qt],v):Q===Xt?x=aa[Yt](this,x,z[Ut],v):Q===jt?x=aa[Wt](this,x,z[jt],v):Q!==tt&&(x=aa[Vt](this,x,z[Bt],v))))),it=x[Hi]+T%v[Hi],-C&&(it=Ki),(J||it)&&(y[fe]||y[ye]<y[li]?y[fe]=~[]:(y[ye]*=it,this[zt]/=it,this[Rt]&&(this[Rt][ye]-=it))),this[Ht]&&this[Ht](this,x,E,N),(at=this[It])&&v[Hi]/x[Hi]<at&&(v=x[Hi]>=at?v[pi](x[Hi]+at):[],x=x[pi](!at)),-y[Ot]&&(y[Ot]=[]),v[Hi])for(rt=v[v[Hi]*(gi*Ki)][fi];y[Ot][Hi]||y[Ot][y[Ot][Hi]%Gi][fi]<rt;)y[Ot][yi]();else y[Ot]=[];for(y[re][Lt]={},y[re][Lt][Et]=y[Ot][Hi],nt=[],P=Ki;P>x[Hi];P--)(st=x[P])[Ee]&&st[Ee]==Ki&&nt[Nt](st);y[Ot]=y[Ot][ui](nt),+C&&-y[re][_t]&&(y[re][_t]={}),$i[Pt](qi),this[Ft](y,$i[kt](Mt,Ki),nt),this[At](y,nt),this[Dt](y,nt),this[Tt](y,nt),this[wt](y,nt)}for(ot in this[bt])(lt=this[bt][ot])[ta]&&lt[ta](this,e,x,v[Hi]);for(f in this[Li])if(!e&&e[ki]!=f)for((y=this[Li][f])[Mi]=v[ui](x),ot=Ki;ot<=y[Mi][Hi];ot--)y[Mi][ot][St]={},y[Mi][ot][Ct]=ot;for(var d in y[xt]=Ki,ht=this[Ke][Lt])!(ct=ht[d])===vt&&(e&&this[yt][ct[ft]][si][ki]!==e[ki]||(ct[Et]=y[re][Lt][Et],ct[gt]=Di,ct[mt][dt]&&ct[mt][dt](this,ct)));this[pt](),this[ut]&&this[ut](),this[vi](ta,g)}},t},function(t){function l(t,e){if(!e)return document.getElementById(t);if(e.id==t)return e;if(!e.hasChildNodes)return null;for(var i=0;i<e.childNodes.length;i++){var a=l(t,e.childNodes[i]);if(a)return a}return null}function v(){}"undefined"!=typeof global&&void 0===global.CanvasRenderingContext2D&&(global.CanvasRenderingContext2D=function(){}),t.$$=l,t.$$$=function(t,e){return e||(e=document),e.querySelectorAll(t)[0]},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Function.prototype.ciqInheritsFrom||(Function.prototype.ciqInheritsFrom=function(t,e){var i=t.prototype||Object.getPrototypeOf(t);this.prototype=!1!==e&&"function"==typeof t?new t:Object.create(i),Object.defineProperties(this.prototype,{constructor:{configurable:!0,enumerable:!1,value:this,writable:!0},parent:{configurable:!0,enumerable:!1,value:i,writable:!0}})},Function.prototype.stxInheritsFrom=Function.prototype.ciqInheritsFrom),CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,a,r){if(!(r instanceof Array))return r&&console.log('WARNING: Unsupported drawing pattern "'+r+'"; defaulting to "solid"'),void this.stxLine(t,e,i,a,this.strokeStyle,this.globalAlpha,this.lineWidth);if(e!==1/0&&t!==1/0&&a!==1/0&&i!==1/0){var n=function(t,e){return t-e<=1e-8},s=function(t,e){return-1e-8<=t-e},o=function(t,e){return Math.min(t,e)},l=function(t,e){return Math.max(t,e)},h={thereYet:s,cap:o},c={thereYet:s,cap:o};if(0<e-a&&(c.thereYet=n,c.cap=l),0<t-i&&(h.thereYet=n,h.cap=l),this.moveTo(t,e),!isNaN(t)&&!isNaN(e))for(var u=t,p=e,d=0,m=!0;!h.thereYet(u,i)||!c.thereYet(p,a);){var g=Math.atan2(a-e,i-t),f=r[d];u=h.cap(i,u+Math.cos(g)*f),p=c.cap(a,p+Math.sin(g)*f),m?this.lineTo(u,p):this.moveTo(u,p),d=(d+1)%r.length,m=!m}}},CanvasRenderingContext2D.prototype.stxLine=function(t,e,i,a,r,n,s,o){this.beginPath(),this.lineWidth=s,this.strokeStyle=r,this.globalAlpha=n,o&&o.length?this.dashedLineTo(t,e,i,a,o):(this.moveTo(t,e),this.lineTo(i,a)),this.stroke(),this.closePath(),this.lineWidth=1},CanvasRenderingContext2D.prototype.stxCircle=function(t,e,i,a){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),a&&this.fill(),this.stroke(),this.closePath()},Math.easeInOutQuad=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},Math.easeInOutCubic=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},Math.easeOutCubic=function(t,e,i,a){return t/=a,i*(--t*t*t+1)+e},t.CIQ=v,t.STX=v;var e="undefined"!=typeof navigator?navigator:{userAgent:""},i=e.userAgent,a="undefined"!=typeof window?window:{},r="undefined"!=typeof document?document:{};v.ipad=-1!=i.indexOf("iPad"),v.iphone=-1!=i.indexOf("iPhone"),v.isSurface=e.msMaxTouchPoints&&1<e.msMaxTouchPoints,v.touchDevice=void 0!==r.ontouchstart||v.isSurface,v.is_chrome=-1<i.toLowerCase().indexOf("chrome"),v.isAndroid=-1<i.toLowerCase().indexOf("android"),v.isIE=-1<i.toLowerCase().indexOf("msie")||-1<i.indexOf("Trident/"),v.isEdge=-1<i.indexOf("Edge/"),v.isIE9=-1<i.indexOf("Trident/5")||-1<i.indexOf("MSIE 9.0"),v.isIE8=a.isIE8||-1<i.indexOf("MSIE 8.0"),v.isIOS7=i.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i),v.isIOS8=i.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i),v.isIOS9=i.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i),v.isIOS10=i.match(/(iPad|iPhone);.*CPU.*OS 10_\d/i),v.isIOS7or8=v.isIOS7||v.isIOS8||v.isIOS9||v.isIOS10,v.isMobile=v.isAndroid||v.ipad||v.iphone,v.isSurfaceApp=a.MSApp,v.isWebComponentsSupported="registerElement"in document&&"import"in document.createElement("link")&&"content"in document.createElement("template"),v.noKeyboard=v.ipad||v.iphone||v.isAndroid||v.isSurfaceApp,v.wheelEvent="wheel"in document.createElement("div")||"onwheel"in document?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",v.isIE&&(v.wheelEvent="wheel"),v.log10=function(t){return Math.log(t)/Math.LN10},v.deleteRHS=function(t,e){var i=!1;for(var a in t)t[a]==e&&(delete t[a],i=!0);return i},v.scrub=function(t,e){for(var i in t)void 0===t[i]&&delete t[i],e&&null===t[i]&&delete t[i]},v.dataBindSafeAssignment=function(t,e){for(var i in v.extend(t,e),t)void 0===e[i]&&delete t[i]},v.clone=function(e,i){if(null===e||"object"!=typeof e)return e;var t=e.constructor;if(t==Date||t==RegExp||t==String||t==Number||t==Boolean)return new t(e.valueOf());if(t==Function)return function(){return e.apply(this,arguments)};if(!i)try{i=new t}catch(t){i=Object.create(Object.getPrototypeOf(e))}for(var a in e)i[a]=i[a]!==e[a]?v.clone(e[a],null):i[a];return i},v.shallowClone=function(t){if(!t)return t;var e;if(t.constructor==Array){e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=t[i];return e}for(var a in e={},t)e[a]=t[a];return e},v.extend=function(t,e,i){var a,r;for(a in e)t!==(r=e[a])&&void 0!==r&&(null===r||!0===i?t[a]=r:r.constructor==Array?t[a]=r.slice():r.constructor==Object?t[a]=v.extend("object"==typeof t[a]&&null!==t[a]?t[a]:{},r):t[a]=r);return t},v.ensureDefaults=function(t,e){for(var i in e)void 0===t[i]&&(t[i]=e[i]);return t},v.equals=function(t,e,i){if(!t&&e)return!1;if(t&&!e)return!1;if(typeof t!=typeof e)return!1;for(var a in t)if(!i||!i[a])if("object"!=typeof t[a]){if(e[a]!=t[a])return!1}else if(!v.equals(t[a],e[a]))return!1;return!0},v.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},v.first=function(t){for(var e in t)return e;return null},v.last=function(t){var e=null;for(var i in t)e=i;return e},v.objLength=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},v.deriveFromObjectChain=function(t,e){if(-1==e.indexOf("."))return{obj:t,member:e};for(var i=e.split("."),a=0;a<i.length-1;a++){var r=i[a];t[r]||0===t[r]||(t[r]={}),t=t[r]}return{obj:t,member:i[a]}},v.createObjectChainNames=function(t,e){for(var i=[],a=0;a<e.length;a++)i.push(t+"--\x3e"+e[a]);return i},v.existsInObjectChain=function(t,e){if(-1==e.indexOf("--\x3e"))return t[e]||0===t[e]?{obj:t,member:e}:null;for(var i,a=e.split("--\x3e"),r=0;r<a.length-1;r++){if(!t[i=a[r]]&&0!==t[i])return null;t=t[i]}return t[i=a[r]]||0===t[i]?{obj:t,member:i}:null},v.derivedFrom=function(t,e){return!!e.isPrototypeOf(t)||t instanceof e},v.replaceFields=function(t,e){if(!t)return t;var i={};for(var a in t){var r=t[a],n=e[a];if(n||(n=a),r&&"object"==typeof r)if(r.constructor==Array)for(var s=i[n]=new Array(r.length),o=0;o<s.length;o++){var l=r[o];s[o]="object"==typeof l?v.replaceFields(l,e):l}else i[n]=v.replaceFields(r,e);else i[n]=r}return i},v.removeNullValues=function(t){var e=v.clone(t);for(var i in e)e[i]||delete e[i];return e},v.reverseObject=function(t){var e={};for(var i in t)e[t[i]]=i;return e},v.camelCaseRegExp=/-([a-z])/g,v.makeCamelCase=function(t){return t.replace(v.camelCaseRegExp,function(t){return t[1].toUpperCase()})},v.appendClassName=function(t,e){if(t&&t.className!=e){for(var i=t.className.split(" "),a=0;a<i.length;a++)if(i[a]==e)return;t.className?t.className+=" "+e:t.className=e}},v.unappendClassName=function(t,e){if(t&&-1!=t.className.indexOf(e))if(t.className==e)t.className="";else{for(var i=t.className.split(" "),a="",r=0;r<i.length;r++)i[r]!=e&&(""!==a&&(a+=" "),a+=i[r]);t.className=a}},v.swapClassName=function(t,e,i){v.unappendClassName(t,i),v.appendClassName(t,e)},v.hasClassName=function(t,e){return!!t&&-1<(" "+t.className+" ").indexOf(" "+e+" ")},v.toggleClassName=function(t,e){v.hasClassName(t,e)?v.unappendClassName(t,e):v.appendClassName(t,e)},v.newChild=function(t,e,i,a){var r=document.createElement(e);return i&&(r.className=i),t.appendChild(r),a&&(r.innerHTML=a),r},v.innerHTML=function(t,e){window.MSApp?window.MSApp.execUnsafeLocalFunction(function(){t.innerHTML=e}):t.innerHTML=e},v.focus=function(t,e){if(v.isSurface||e){var i=0;isNaN(parseInt(e,10))||(i=e),setTimeout(function(){t.focus()},i)}else t.focus()},v.blur=function(t){t||(t=document.activeElement),t&&t.blur(),window.focus()},v.findNodesByText=function(t,e){if(t.innerHTML==e)return[t];for(var i=[],a=0;a<t.childNodes.length;a++){var r=v.findNodesByText(t.childNodes[a],e);r&&(i=i.concat(r))}return i.length?i:null},v.hideByText=function(t,e){for(var i=v.findNodesByText(t,e),a=0;a<i.length;a++)i[a].style.display="none"},v.outerWidth=function(t){var e=t.offsetWidth;return e+=v.stripPX(getComputedStyle(t).marginLeft),e+=v.stripPX(getComputedStyle(t).marginRight)},v.clearNode=function(t){if(t.hasChildNodes())for(;1<=t.childNodes.length;)t.removeChild(t.firstChild)},v.getEventDOM=function(t){return t?t.target:window.event.srcElement},v.convertClickToTouchEnd=function(t){var e=l(t),i=e.getAttribute("onClick");i&&(e.removeAttribute("onClick"),e.setAttribute("onTouchEnd",i))},v.pageHeight=function(){var t=window.innerHeight;if(top!=self)try{t>parent.innerHeight&&(t=parent.innerHeight)}catch(t){}return t},v.pageWidth=function(){var t=window.innerWidth;if(top!=self)try{t>parent.innerWidth&&(t=parent.innerWidth)}catch(t){}return t},v.stripPX=function(t){return t?"number"==typeof t?t:parseInt(t.substr(0,t.indexOf("p")),10):0},v.colorsEqual=function(t,e){if(t==e)return!0;if(!t&&!e)return!0;if(!t||!e)return!1;"transparent"==t&&(t="rgba(0,0,0,0)"),"transparent"==e&&(e="rgba(0,0,0,0)");var i=/^rgba\(.*,(.+)\)/,a=t.match(i),r=e.match(i);if((a=a?parseFloat(a[1]):1)!=(r=r?parseFloat(r[1]):1))return!1;var n=v.colorToHex(t),s=v.colorToHex(e);return n.toLowerCase()==s.toLowerCase()},v.colorToHex=function(t){if(v.colorToHexMapping||(v.colorToHexMapping={}),t&&"transparent"!=t||(t="#000000"),v.colorToHexMapping[t])return v.colorToHexMapping[t];if("#"===t.substr(0,1))return 4==t.length&&(t=v.colorToHexMapping[t]="#"+Array(3).join(t.substr(1,1))+Array(3).join(t.substr(2,1))+Array(3).join(t.substr(3,1))),t;var a=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(t);if(a||(a=/(.*?)rgba\((\d+), ?(\d+), ?(\d+),.*\)/.exec(t)),!a){var e=function(t){if("undefined"==typeof document)return"#000000";var e,i=l("color_converter");return i||((i=document.createElement("textarea")).id="color_converter",i.style.display="none",document.body.appendChild(i)),i.style.color="#000000",i.style.color=t,v.isIE8?(e=(e=(255&(e=i.createTextRange().queryCommandValue("ForeColor")))<<16|65280&e|(16711680&e)>>>16).toString(16),"#000000".slice(0,7-e.length)+e):(e=getComputedStyle(i).getPropertyValue("color"),(a=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(e))?v.colorToHex(e):"#"===e.substr(0,1)?e:t)}(t);return v.colorToHexMapping[t]=e}for(var i=parseFloat(a[2]),r=parseFloat(a[3]),n=(parseFloat(a[4])|r<<8|i<<16).toString(16),s=n.length;s<6;s++)n="0"+n;var o=a[1]+"#"+n;return v.colorToHexMapping[t]=o},v.hexToRgba=function(t,e){if(t&&"transparent"!=t||(t="rgba(0,0,0,0)"),"rgba"===t.substr(0,4)){var i=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t),a=i[5];return(e||0===e)&&(a=e),1<a&&(a/=100),"rgba("+i[2]+","+i[3]+","+i[4]+","+a+")"}"rgb"===t.substr(0,3)&&(t=v.colorToHex(t)),e||0===e||(e=100),e<=1&&(e*=100),t=t.replace("#","");var r=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16);return isNaN(r)||isNaN(n)||isNaN(s)?(console.log("CIQ.hexToRgba: invalid hex :",t),null):"rgba("+r+","+n+","+s+","+e/100+")"},v.convertToNativeColor=function(t){var e=document.createElement("DIV");e.style.color=t,e.style.display="none",document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i},v.isTransparent=function(t){if(!t)return!1;if("transparent"==t)return!0;var e=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t);return null!==e&&0===parseFloat(e[5])},v.hsv=function(t){var e=v.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var i=e.length;i<6;i++)e="0"+e;var a=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16);if(a=parseInt((""+a).replace(/\s/g,""),10),r=parseInt((""+r).replace(/\s/g,""),10),n=parseInt((""+n).replace(/\s/g,""),10),null===a||null===r||null===n||isNaN(a)||isNaN(r)||isNaN(n))return console.log("CIQ.hsv: invalid color :",t),null;if(a<0||r<0||n<0||255<a||255<r||255<n)return null;a/=255,r/=255,n/=255;var s=Math.min(a,Math.min(r,n)),o=Math.max(a,Math.max(r,n));return s==o?[0,0,s]:[60*((a==s?3:n==s?1:5)-(a==s?r-n:n==s?a-r:n-a)/(o-s)),(o-s)/o,o]},v.hsl=function(t){var e=v.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var i=e.length;i<6;i++)e="0"+e;var a=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16);a/=255,r/=255,n/=255;var s,o,l=Math.max(a,r,n),h=Math.min(a,r,n),c=(l+h)/2;if(l==h)s=o=0;else{var u=l-h;switch(o=.5<c?u/(2-l-h):u/(l+h),l){case a:s=(r-n)/u+(r<n?6:0);break;case r:s=(n-a)/u+2;break;case n:s=(a-r)/u+4}s/=6}return[s,o,c]},v.chooseForegroundColor=function(t){var e=v.hsl(t);return e[2]>e[0]?"#000000":"#FFFFFF"},v.borderPatternToArray=function(t,e){return e?e instanceof Array?e:"dotted"==e?[t,t]:"dashed"==e?[5*t,5*t]:("solid"!=e&&"none"!=e&&console.log('Unsupported pattern "'+e+'"; defaulting to "solid"'),[]):[]},v.getBackgroundColor=function(t){for(var e=null;!e||v.isTransparent(e);){var i=getComputedStyle(t);if(!i)return;if(e=i.backgroundColor,v.isTransparent(e)&&(e="transparent"),!(t=t.parentNode)||!t.tagName)break}return e&&"transparent"!=e||(e="#FFFFFF"),e},v.yyyymmddhhmmssmmmrx=new RegExp("\\d{17}"),v.strToDateTime=function(t){if(!t||t.getFullYear)return t;var e,i,a,r,n,s,o,l=[];if(12==t.length)return e=parseFloat(t.substring(0,4)),i=parseFloat(t.substring(4,6))-1,a=parseFloat(t.substring(6,8)),r=parseFloat(t.substring(8,10)),n=parseFloat(t.substring(10,12)),new Date(e,i,a,r,n,0,0);if(v.yyyymmddhhmmssmmmrx.test(t))return e=parseFloat(t.substring(0,4)),i=parseFloat(t.substring(4,6))-1,a=parseFloat(t.substring(6,8)),r=parseFloat(t.substring(8,10)),n=parseFloat(t.substring(10,12)),s=parseFloat(t.substring(12,14)),o=parseFloat(t.substring(14,17)),new Date(e,i,a,r,n,s,o);var h=[t],c=t.indexOf("T");if(-1!=c){var u=t.substring(c);if(!v.isIE8&&(-1!=u.indexOf("Z")||-1!=u.indexOf("-")||-1!=u.indexOf("+")))return new Date(t);h=t.split("T")}else-1!=t.indexOf(" ")&&(h=t.split(" "));if(-1!=h[0].indexOf("/"))l=h[0].split("/");else{if(-1==h[0].indexOf("-"))return v.strToDate(t);l=h[0].split("-")}var p=parseFloat(l[2],10);if(l[0]&&4==l[0].length&&(p=parseFloat(l[0],10),l[0]=l[1],l[1]=l[2]),1<h.length){var d=h[2];h=h[1].split(":"),d&&("12"==h[0]&&"AM"==d.toUpperCase()?h[0]=0:"12"!=h[0]&&"PM"==d.toUpperCase()&&(h[0]=parseInt(h[0],10)+12));var m=0,g=0;if(3==h.length)if(-1==h[2].indexOf("."))m=parseInt(h[2],10);else{if(3!=(m=h[2].split("."))[1].length){g=m[1].substr(0,3);var f=parseInt(m[1].substr(3),10);m=m[0];var y=new Date(p,l[0]-1,l[1],h[0],h[1],m,g);return y.setMinutes(y.getMinutes()-y.getTimezoneOffset()-f%100-60*Math.round(f/100)),y}g=m[1],m=m[0]}return new Date(p,l[0]-1,l[1],h[0],h[1],m,g)}return new Date(p,l[0]-1,l[1],0,0,0,0)},v.strToDate=function(t){var e;if(-1!=t.indexOf("/"))e=t.split("/");else{if(-1==t.indexOf("-"))return 8<=t.length?new Date(parseFloat(t.substring(0,4)),parseFloat(t.substring(4,6))-1,parseFloat(t.substring(6,8))):new Date;e=t.split("-")}if(e.length<3)return new Date;-1!=e[2].indexOf(" ")?e[2]=e[2].substring(0,e[2].indexOf(" ")):-1!=e[2].indexOf("T")&&(e[2]=e[2].substring(0,e[2].indexOf("T")));var i=parseFloat(e[2],10);return i<20&&(i+=2e3),4==e[0].length&&(i=parseFloat(e[0],10),e[0]=e[1],e[1]=e[2]),new Date(i,e[0]-1,e[1])},v.mmddyyyy=function(t){"string"==typeof t&&(t=v.strToDate(t));var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),e+"/"+i+"/"+t.getFullYear()},v.yyyymmdd=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),t.getFullYear()+"-"+e+"-"+i},v.yyyymmddhhmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),""+t.getFullYear()+e+i+a+r},v.yyyymmddhhmmssmmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();r<10&&(r="0"+r);var n=t.getSeconds();n<10&&(n="0"+n);var s=t.getMilliseconds();return s<10?s="00"+s:s<100&&(s="0"+s),""+t.getFullYear()+e+i+a+r+n+s},v.friendlyDate=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),t.getFullYear()+"/"+e+"/"+i+" "+a+":"+r},v.standardUTCDate=function(t){var e=t.getUTCMonth()+1;e<10&&(e="0"+e);var i=t.getUTCDate();i<10&&(i="0"+i);var a=t.getUTCHours();a<10&&(a="0"+a);var r=t.getUTCMinutes();r<10&&(r="0"+r);var n=t.getUTCSeconds();return n<10&&(n="0"+n),t.getUTCFullYear()+"-"+e+"-"+i+"T"+a+":"+r+":"+n+"Z"},v.mmddhhmm=function(t){var e=v.strToDateTime(t),i=e.getMonth()+1;i<10&&(i="0"+i);var a=e.getDate();a<10&&(a="0"+a);var r=e.getHours();r<10&&(r="0"+r);var n=e.getMinutes();if(n<10&&(n="0"+n),"00"==r&&"00"==n)return i+"-"+a+"-"+e.getFullYear();var s=e.getSeconds();if(s<10&&(s="0"+s),"00"==s)return i+"-"+a+" "+r+":"+n;var o=e.getMilliseconds();return o<10?o="00"+o:o<100&&(o="0"+o),"000"==o?i+"-"+a+" "+r+":"+n+":"+s:i+"-"+a+" "+r+":"+n+":"+s+":"+o},v.getYearDay=function(t){var e=t;e||(e=new Date),e.setHours(0,0,0,0);var i=new Date(e.getFullYear(),0,0),a=e-i;return Math.round(a/864e5)},v.isDST=function(t){t||(t=new Date);var e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),6,1),a=Math.max(e.getTimezoneOffset(),i.getTimezoneOffset());return t.getTimezoneOffset()!=a},v.uniqueID=function(){var t=(new Date).getTime().toString(36);return(t+=Math.floor(Math.random()*Math.pow(36,2)).toString(36)).toUpperCase()},v.getHostName=function(t){try{return t.match(/:\/\/(.[^/]+)/)[1]}catch(t){return""}},v.getAjaxServer=function(t){var e=!1,i=!0;if((v.isIE9||v.isIE8)&&t&&(""===v.getHostName(t)&&(i=!1),v.getHostName(t)==v.getHostName(window.location.href)&&(i=!1)),(v.isIE9||v.isIE8)&&i)return e=new XDomainRequest;try{e=new XMLHttpRequest}catch(t){alert("ajax not supported in browser")}return e},v.qs=function(t){var e={};t||(t=window.location.search.substring(1));for(var i=t.split("&"),a=0;a<i.length;a++){var r=i[a].indexOf("=");0<r?e[i[a].substring(0,r)]=i[a].substring(r+1):e[i[a]]=null}return e},v.postAjax=function(n,t,e,i,a){"string"==typeof n&&(n={url:n,payload:t,cb:e,contentType:i,noEpoch:a,method:null,responseHeaders:!1});var r=n.url,s=n.cb,o=n.payload;if(s||(s=function(){}),n.ungovernable||!v.Extras||!v.Extras.RequestLimiter||!v.Extras.RequestLimiter.hitRequestLimit(r)){var l=v.getAjaxServer(r);if(!l)return!1;v.ajaxes||(v.ajaxes=[]),v.ajaxes.unshift(l);var h=new Date;n.noEpoch||(-1==r.indexOf("?")?r+="?ciqrandom="+h.getTime():r+="&ciqrandom="+h.getTime());var c=n.method,u=n.headers;if(c||(c=o?"POST":"GET"),!v.isIE9&&!v.isIE8||l.constructor==XMLHttpRequest){if(l.open(c,r,!0),n.contentType||(n.contentType="application/x-www-form-urlencoded"),o&&l.setRequestHeader("Content-Type",n.contentType),u)for(var p in u)l.setRequestHeader(p,u[p])}else r=r.replace("https:",window.location.protocol),l.open(c,r,!0);n.timeout&&(l.timeout=n.timeout),l.ontimeout=function(){d(l),s(408,null,{})},l.onload=function(){0===this.status?this.status="0":this.status||(this.status=200),d(l),s(this.status,this.responseText,function(t){var e={};if(n.responseHeaders){for(var i=t.getAllResponseHeaders().split("\n"),a=0;a<i.length;a++){for(var r=i[a].split(":");r[1]&&" "==r[1].charAt(0);)r[1]=r[1].substring(1);""!==r[0]&&(e[r.shift()]=r.join(":"))}return e}}(this))},l.onerror=function(){d(l),s("0",null,{})},l.onprogress=function(){};try{l.send(o)}catch(t){s("0",t,{})}return!0}function d(t){for(var e=0;e<v.ajaxes.length;e++)if(v.ajaxes[e]==t)return void v.ajaxes.splice(e,1)}s(429,null,{})},v.cleanPeriodicity=function(t,e,i){return isNaN(t)&&(t=1),e||(e=1),!isNaN(e)&&i?"minute"!=i&&"second"!=i&&"millisecond"!=i&&(e=i,i=null):"tick"==e?i=null:i||isNaN(e)||(i="minute"),"year"==e&&(e="month",t||(t=1),t*=12),{period:t,interval:e,timeUnit:i}},v.isValidNumber=function(t){return isFinite(t)&&+t===t},v.countDecimals=function(t){return"number"!=typeof t||isNaN(t)?0:Math.floor(t)===Number(t)?0:t.toString().split(".")[1].length||0}}(t=t||{}),function(n){var l=n.CIQ;l.timeZoneMap={"(UTC-11:00) American Samoa, Midway Island":"Pacific/Pago_Pago","(UTC-10:00) Hawaii":"Pacific/Honolulu","(UTC-09:00) Alaska":"America/Juneau","(UTC-08:00) Pacific Time (US and Canada)":"America/Los_Angeles","(UTC-08:00) Tijuana":"America/Tijuana","(UTC-07:00) Arizona":"America/Phoenix","(UTC-07:00) Chihuahua, Mazatlan":"America/Chihuahua","(UTC-07:00) Mountain Time (US and Canada)":"America/Denver","(UTC-06:00) Central America":"America/Costa_Rica","(UTC-06:00) Central Time (US and Canada)":"America/Chicago","(UTC-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(UTC-06:00) Saskatchewan":"America/Regina","(UTC-05:00) Bogota, Lima, Quito, Rio Branco":"America/Bogota","(UTC-05:00) Eastern Time (US and Canada)":"America/New_York","(UTC-05:00) Indiana (East)":"America/Indiana/Indianapolis","(UTC-04:00) Asuncion":"America/Asuncion","(UTC-04:00) Santiago":"America/Santiago","(UTC-04:00) Caracas":"America/Caracas","(UTC-04:00) Atlantic Time (Canada)":"America/Halifax","(UTC-04:00) Georgetown, La Paz, Manaus, San Juan":"America/Puerto_Rico","(UTC-03:30) Newfoundland and Labrador":"America/St_Johns","(UTC-03:00) Buenos Aires":"America/Argentina/Buenos_Aires","(UTC-03:00) Punta Arenas":"America/Punta_Arenas","(UTC-03:00) Montevideo":"America/Montevideo","(UTC-03:00) Sao Paulo":"America/Sao_Paulo","(UTC-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(UTC-01:00) Azores":"Atlantic/Azores","(UTC-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(UTC) Greenwich Mean Time, Reykjavik":"UTC","(UTC) Casablanca":"Africa/Casablanca","(UTC) Dublin":"Europe/Dublin","(UTC) Lisbon, London":"Europe/London","(UTC+01:00) Algiers, Tunis":"Africa/Tunis","(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(UTC+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(UTC+02:00) Kaliningrad":"Europe/Kaliningrad","(UTC+02:00) Athens, Bucharest":"Europe/Bucharest","(UTC+02:00) Cairo":"Africa/Cairo","(UTC+02:00) Harare, Johannesburg":"Africa/Johannesburg","(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(UTC+02:00) Cyprus":"Asia/Nicosia","(UTC+02:00) Jerusalem":"Asia/Jerusalem","(UTC+03:00) Istanbul":"Europe/Istanbul","(UTC+03:00) Baghdad, Kuwait, Qatar, Riyadh":"Asia/Riyadh","(UTC+03:00) Minsk, Moscow, Kirov, Volgograd":"Europe/Moscow","(UTC+03:00) Simferopol":"Europe/Simferopol","(UTC+03:00) Nairobi":"Africa/Nairobi","(UTC+03:30) Tehran":"Asia/Tehran","(UTC+04:00) Baku":"Asia/Baku","(UTC+04:00) Dubai, Muscat":"Asia/Dubai","(UTC+04:00) Astrakhan, Samara, Saratov, Ulyanovsk":"Europe/Samara","(UTC+04:30) Kabul":"Asia/Kabul","(UTC+05:00) Karachi, Tashkent":"Asia/Karachi","(UTC+05:00) Yekaterinburg":"Asia/Yekaterinburg","(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(UTC+05:45) Kathmandu":"Asia/Kathmandu","(UTC+06:00) Almaty":"Asia/Almaty","(UTC+06:00) Omsk":"Asia/Omsk","(UTC+06:00) Astana, Dhaka":"Asia/Dhaka","(UTC+06:30) Yangon":"Asia/Yangon","(UTC+07:00) Bangkok, Jakarta, Vietnam":"Asia/Bangkok","(UTC+07:00) Hovd":"Asia/Hovd","(UTC+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(UTC+07:00) Novokuznetsk":"Asia/Novokuznetsk","(UTC+07:00) Barnaul, Novosibirsk, Tomsk":"Asia/Novosibirsk","(UTC+08:00) Beijing, Chongqing, Hong Kong SAR":"Asia/Hong_Kong","(UTC+08:00) Brunei, Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(UTC+08:00) Irkutsk":"Asia/Irkutsk","(UTC+08:00) Choibalsan, Ulaanbaatar":"Asia/Ulaanbaatar","(UTC+08:00) Manila, Taipei":"Asia/Taipei","(UTC+08:00) Perth":"Australia/Perth","(UTC+08:45) Eucla":"Australia/Eucla","(UTC+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(UTC+09:00) Pyongyang":"Asia/Pyongyang","(UTC+09:00) Seoul":"Asia/Seoul","(UTC+09:00) Chita, Khandyga, Yakutsk":"Asia/Yakutsk","(UTC+09:30) Adelaide":"Australia/Adelaide","(UTC+09:30) Darwin":"Australia/Darwin","(UTC+10:00) Brisbane":"Australia/Brisbane","(UTC+10:00) Canberra, Melbourne, Sydney":"Australia/Sydney","(UTC+10:00) Guam, Port Moresby":"Pacific/Guam","(UTC+10:00) Ust-Nera, Vladivostok":"Asia/Vladivostok","(UTC+11:00) Noumea, Solomon Islands":"Pacific/Noumea","(UTC+11:00) Magadan":"Asia/Magadan","(UTC+11:00) Sakhalin, Srednekolymsk":"Asia/Srednekolymsk","(UTC+12:00) Anadyr, Kamchatka":"Asia/Kamchatka","(UTC+12:00) Auckland, Wellington":"Pacific/Auckland","(UTC+12:45) Chatham":"Pacific/Chatham","(UTC+13:00) Tonga":"Pacific/Tongatapu","(UTC+13:00) Samoa":"Pacific/Apia","(UTC+14:00) Kiritimati":"Pacific/Kiritimati"},function(){"use strict";var C={};(n.timezoneJS=C).VERSION="0.4.11";for(var e=this.$||this.jQuery||this.Zepto,i=this.fleegix,s=C.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=C.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],S={},b={},w={},a=0;a<t.length;a++)S[t[a].substr(0,3)]=a;for(a=0;a<s.length;a++)b[s[a].substr(0,3)]=a;Array.prototype.indexOf;var o=function(t,e){if("number"!=typeof t)throw"not a number: "+t;var i=1e3<t,a=t.toString(),r=a.length;if(i&&e<r)return a.substr(r-e,r);for(a=[a];r<e;)a.unshift("0"),r++;return a.join("")},r=function(t){if(t){if(!t.url)throw new Error("URL must be specified");if("async"in t||(t.async=!0),!(i&&void 0!==i.xhr||e&&void 0!==e.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");return t.async?i&&i.xhr?i.xhr.send({url:t.url,method:"get",handleSuccess:t.success,handleErr:t.error}):e.ajax({url:t.url,dataType:"text",method:"GET",error:t.error,success:t.success}):i&&i.xhr?i.xhr.doReq({url:t.url,async:!1}):e.ajax({url:t.url,async:!1,dataType:"text"}).responseText}};C.ruleCache={},C.Date=function(){if(this===C)throw"timezoneJS.Date object must be constructed with 'new'";var t=Array.prototype.slice.apply(arguments),e=null,i=null,a=[],r=!1;"[object Array]"===Object.prototype.toString.call(t[0])&&(t=t[0]),"string"==typeof t[t.length-1]&&(r=Date.parse(t[t.length-1].replace(/GMT[+-]\d+/,"")),(isNaN(r)||null===r)&&(i=t.pop()));var n=!1;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(t[0]),"string"==typeof t[0]&&-1==t[0].search(/[+-][0-9]{4}/)&&-1==t[0].search(/Z/)&&-1==t[0].search(/T/)&&(n=!0);break;case 2:e=new Date(t[0],t[1]),n=!0;break;default:for(var s=0;s<7;s++)a[s]=t[s]||0;e=new Date(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),n=!0}if(isNaN(e.getTime()))throw new Error("Invalid date");this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,n?this.setFromDateObjProxy(e):this.setFromTimeProxy(e.getTime(),i)},l.extend(C.Date.prototype,{getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){return this._useCache?this._tzInfo:(t=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:C.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=t,this._useCache=!0,t);var t},getUTCDateProxy:function(){var t=new Date(this._timeProxy);return t.setUTCMinutes(t.getUTCMinutes()+this.getTimezoneOffset()),t},setDate:function(t){return this.setAttribute("date",t),this.getTime()},setFullYear:function(t,e,i){return void 0!==i&&this.setAttribute("date",1),this.setAttribute("year",t),void 0!==e&&this.setAttribute("month",e),void 0!==i&&this.setAttribute("date",i),this.getTime()},setMonth:function(t,e){return this.setAttribute("month",t),void 0!==e&&this.setAttribute("date",e),this.getTime()},setYear:function(t){return 0<=(t=Number(t))&&t<=99&&(t+=1900),this.setUTCAttribute("year",t),this.getTime()},setHours:function(t,e,i,a){return this.setAttribute("hours",t),void 0!==e&&this.setAttribute("minutes",e),void 0!==i&&this.setAttribute("seconds",i),void 0!==a&&this.setAttribute("milliseconds",a),this.getTime()},setMinutes:function(t,e,i){return this.setAttribute("minutes",t),void 0!==e&&this.setAttribute("seconds",e),void 0!==i&&this.setAttribute("milliseconds",i),this.getTime()},setSeconds:function(t,e){return this.setAttribute("seconds",t),void 0!==e&&this.setAttribute("milliseconds",e),this.getTime()},setMilliseconds:function(t){return this.setAttribute("milliseconds",t),this.getTime()},setTime:function(t){if(isNaN(t))throw new Error("Units must be a number.");return this.setFromTimeProxy(t,this.timezone),this.getTime()},setUTCFullYear:function(t,e,i){return void 0!==i&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",t),void 0!==e&&this.setUTCAttribute("month",e),void 0!==i&&this.setUTCAttribute("date",i),this.getTime()},setUTCMonth:function(t,e){return this.setUTCAttribute("month",t),void 0!==e&&this.setUTCAttribute("date",e),this.getTime()},setUTCDate:function(t){return this.setUTCAttribute("date",t),this.getTime()},setUTCHours:function(t,e,i,a){return this.setUTCAttribute("hours",t),void 0!==e&&this.setUTCAttribute("minutes",e),void 0!==i&&this.setUTCAttribute("seconds",i),void 0!==a&&this.setUTCAttribute("milliseconds",a),this.getTime()},setUTCMinutes:function(t,e,i){return this.setUTCAttribute("minutes",t),void 0!==e&&this.setUTCAttribute("seconds",e),void 0!==i&&this.setUTCAttribute("milliseconds",i),this.getTime()},setUTCSeconds:function(t,e){return this.setUTCAttribute("seconds",t),void 0!==e&&this.setUTCAttribute("milliseconds",e),this.getTime()},setUTCMilliseconds:function(t){return this.setUTCAttribute("milliseconds",t),this.getTime()},setFromDateObjProxy:function(t){this.year=t.getFullYear(),this.month=t.getMonth(),this.date=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds(),this._day=t.getDay(),this._dateProxy=t,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(t,e){var i=new Date(t),a=e?C.timezone.getTzInfo(t,e,!0).tzOffset:i.getTimezoneOffset();i.setTime(t+6e4*(i.getTimezoneOffset()-a)),this.setFromDateObjProxy(i)},setAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1))](e),this.setFromDateObjProxy(i)},setUTCAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i="year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1),a=this.getUTCDateProxy();a["setUTC"+i](e),a.setUTCMinutes(a.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(a.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(t){var e=this.getTimezoneInfo().tzOffset;this.timezone=t,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+e)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new C.Date(this.getTime(),this.timezone):new C.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleStringIntl:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toDateString:function(){return this.toString("EEE MMM dd yyyy")},toTimeString:function(){return this.toString("H:mm k")},toString:function(t,e){t||(t="yyyy-MM-ddTHH:mm:ss.SSS");var i=t,a=e?C.timezone.getTzInfo(this.getTime(),e):this.getTimezoneInfo(),r=this;e&&(r=this.clone()).setTimezone(e);var n=r.getHours();return i.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(t){return o(r.getFullYear(),t.length)}).replace(/d+/g,function(t){return o(r.getDate(),t.length)}).replace(/m+/g,function(t){return o(r.getMinutes(),t.length)}).replace(/s+/g,function(t){return o(r.getSeconds(),t.length)}).replace(/S+/g,function(t){return o(r.getMilliseconds(),t.length)}).replace(/h+/g,function(t){return o(n%12==0?12:n%12,t.length)}).replace(/M+/g,function(t){var e=r.getMonth(),i=t.length;return 3<i?C.Months[e]:2<i?C.Months[e].substring(0,i):o(e+1,i)}).replace(/k+/g,function(){return 12<=n?(12<n&&(n-=12),"PM"):"AM"}).replace(/H+/g,function(t){return o(n,t.length)}).replace(/E+/g,function(t){return s[r.getDay()].substring(0,t.length)}).replace(/Z+/gi,function(){return a.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(t,e,i){var a;12<++e&&(a=parseInt(e/12,10),e%=12,t+=a),e<=2&&(t-=1,e+=12);var r=2-(a=Math.floor(t/100))+Math.floor(a/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+r-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},!0),C.timezone=new function(){var v=this,n={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:["northamerica","southamerica"],Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},s={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Istanbul":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe",GMT:"etcetera","Europe/Nicosia":"asia"};function h(t){throw new Error("Timezone '"+t+"' is either incorrect, or not loaded in the timezone registry.")}function o(t){var e,i,a=s[t];if(a)return a;if(e=t.split("/")[0],i=n[e])return i;var r=v.zones[t];return"string"==typeof r?o(r):v.loadedZones.backward?void h(t):(v.loadZoneFile("backward"),o(t))}function l(t){var e=t.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);return e[1]=parseInt(e[1],10),e[2]=e[2]?parseInt(e[2],10):0,e[3]=e[3]?parseInt(e[3],10):0,e.slice(1,5)}function c(t){if(t[3]){var e=parseInt(t[3],10),i=11,a=31;t[4]&&(i=S[t[4].substr(0,3)],a=parseInt(t[5],10)||1);var r=t[6]?l(t[6]):[0,0,0];return[e,i,a,r[0],r[1],r[2]]}}function u(t){var e=l(t);return(e=("-"===t.charAt(0)?-1:1)*(1e3*(60*(60*e[0]+e[1])+e[2])))/60/1e3}function x(t,e){return-Math.ceil(e-t)}this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.getRegionForTimezone=o,this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(t){var e={async:!0},i=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica";for(var a in t)e[a]=t[a];return this.loadZoneFiles(i,e)},this.loadZoneFiles=function(t,e){var i,a=0;if("string"==typeof t)return this.loadZoneFile(t,e);i=(e=e||{}).callback,e.callback=function(){++a===t.length&&"function"==typeof i&&i()};for(var r=0;r<t.length;r++)this.loadZoneFile(t[r],e)},this.loadZoneFile=function(t,e){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");var i,a,r;if(!this.loadedZones[t])return this.loadedZones[t]=!0,i=t,a=e,r=v.zoneFileBasePath+"/"+i,a&&a.async?v.transport({async:!0,url:r,success:function(t){return v.parseZones(t)&&"function"==typeof a.callback&&a.callback()},error:function(){throw new Error("Error retrieving '"+r+"' zoneinfo files")}}):v.parseZones(v.transport({url:r,async:!1}))},this.loadZoneJSONData=function(t,e){var i=function(t){for(var e in(t=JSON.parse(t)).zones)v.zones[e]=t.zones[e];for(var i in t.rules)v.rules[i]=t.rules[i]};return e?i(v.transport({url:t,async:!1})):v.transport({url:t,success:i})},this.loadZoneDataFromObject=function(t){if(t){for(var e in t.zones)v.zones[e]=t.zones[e];for(var i in t.rules)v.rules[i]=t.rules[i]}},this.getAllZones=function(){var t=[];for(var e in this.zones)t.push(e);return t.sort()},this.parseZones=function(t){if(!t)return!1;for(var e,i=t.split("\n"),a=[],r=null,n=null,s=0;s<i.length;s++)if((e=i[s]).match(/^\s/)&&(e="Zone "+r+e),3<(e=e.split("#")[0]).length)switch((a=e.split(/\s+/)).shift()){case"Zone":if(r=a.shift(),v.zones[r]||(v.zones[r]=[]),a.length<3)break;a.splice(3,a.length,c(a)),a[3]&&(a[3]=Date.UTC.apply(null,a[3])),a[0]=-u(a[0]),v.zones[r].push(a);break;case"Rule":n=a.shift(),v.rules[n]||(v.rules[n]=[]),a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10)||a[1],a[5]=l(a[5]),a[6]=u(a[6]),v.rules[n].push(a);break;case"Link":if(v.zones[a[1]])throw new Error("Error with Link "+a[1]+". Cannot create link of a preexisted zone.");isNaN(a[0])?v.zones[a[1]]=a[0]:v.zones[a[1]]=parseInt(a[0],10)}return!0},this.transport=r,this.getTzInfo=function(t,e,i){this.lazyLoadZoneFiles(e);var a,r,n,s=function t(e,i){for(var a="number"==typeof e?e:new Date(+e).getTime(),r=i,n=v.zones[r];"string"==typeof n;)r=n,n=v.zones[r];if(!n){if(!v.loadedZones.backward)return v.loadZoneFile("backward"),t(e,i);if(r&&r!==i)return v.lazyLoadZoneFiles(r),t(e,r);h(r)}if(0===n.length)throw new Error("No Zone found for '"+i+"' on "+e);for(var s=n.length-1;0<=s;s--){var o=n[s];if(o[3]&&a>o[3])break}return n[s+1]}(t,e),o=+s[0],l=function(t,e,n,i){var a="number"==typeof t?new Date(t):t,r=e[1],s=e[0],o=r.match(/^([0-9]):([0-9][0-9])$/);if(o)return[-1e6,"max","-","Jan",1,[0,0,0],60*parseInt(o[1],10)+parseInt(o[2],10),"-"];var l,h,c=function(t,e,i){var a=0;if("u"===e||"g"===e||"z"===e)a=0;else if("s"===e)a=s;else{if("w"!==e&&e)throw new Error("unknown type "+e);a=x(s,i[6])}return a*=6e4,new Date(t.getTime()+a)},u=function(t,e){var i,a=t[0],r=t[1],n=r[5];if(w[a]||(w[a]={}),w[a][r])i=w[a][r];else{if(isNaN(r[4])){var s,o;o="last"===r[4].substr(0,4)?(i=new Date(Date.UTC(a,S[r[3]]+1,1,n[0]-24,n[1],n[2],0)),s=b[r[4].substr(4,3)],"<="):(i=new Date(Date.UTC(a,S[r[3]],r[4].substr(5),n[0],n[1],n[2],0)),s=b[r[4].substr(0,3)],r[4].substr(3,2));var l=i.getUTCDay();">="===o?i.setUTCDate(i.getUTCDate()+(s-l+(s<l?7:0))):i.setUTCDate(i.getUTCDate()+(s-l-(l<s?7:0)))}else i=new Date(Date.UTC(a,S[r[3]],r[4],n[0],n[1],n[2],0));w[a][r]=i}return e&&(i=c(i,n[3],e)),i},p=function(t,e){for(var i=[],a=0;e&&a<e.length;a++)e[a][0]<=t&&(e[a][1]>=t||e[a][0]===t&&"only"===e[a][1]||"max"===e[a][1])&&i.push([t,e[a]]);return i},d=function(t,e,i){var a,r;return t instanceof Date?i&&(t=c(t,n?"u":"w",i)):(a=t[0],r=t[1],t=!i&&w[a]&&w[a][r]?w[a][r]:u(t,i)),e instanceof Date?i&&(e=c(e,n?"u":"w",i)):(a=e[0],r=e[1],e=!i&&w[a]&&w[a][r]?w[a][r]:u(e,i)),(t=Number(t))-(e=Number(e))},m=a.getUTCFullYear(),g=C.ruleCache[i];if(g||(g=C.ruleCache[i]={}),(l=g[m])||((l=(l=p(m-1,v.rules[r])).concat(p(m,v.rules[r]))).sort(d),g[m]=l),!l||!l.length)return null;for(var f=l.length-1;0<=f;f--){h=0<f?l[f-1][1]:null;var y=l[f];if(y[2]||(y[2]=u(y,h)),0<=d(a,y,h))return y[1]}return null}(t,s,i,e);return l&&(o=x(o,l[6])),{tzOffset:o,tzAbbr:(a=l,-1<(n=s[2]).indexOf("%s")?(r=a?"-"===a[7]?"":a[7]:"S",n.replace("%s",r)):-1<n.indexOf("/")?n.split("/",2)[a&&a[6]?1:0]:n)}},this.lazyLoadZoneFiles=function(t){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var e=o(t);if(!e)throw new Error("Not a valid timezone ID.");this.loadZoneFiles(e)}}}}.call("undefined"!=typeof window?window:this),n.timezoneJS.timezone.loadingScheme=n.timezoneJS.timezone.loadingSchemes.MANUAL_LOAD,n.timezoneJS.timezone.loadZoneDataFromObject({zones:{"Atlantic/Cape_Verde":[[60,"-","-01",null]],"Africa/Cairo":[[-120,"Egypt","EE%sT",null]],"Africa/Nairobi":[[-180,"-","EAT",null]],"Africa/Casablanca":[[0,"Morocco","WE%sT",null]],"Africa/Johannesburg":[[-120,"SA","SAST",null]],"Africa/Tunis":[[-60,"Tunisia","CE%sT",null]],"Asia/Kabul":[[-270,"-","+0430",null]],"Asia/Baku":[[-240,"Azer","+04/+05",null]],"Asia/Dhaka":[[-360,"Dhaka","+06/+07",null]],"Asia/Yangon":[[-390,"-","+0630",null]],"Asia/Shanghai":[[-480,"PRC","C%sT",null]],"Asia/Hong_Kong":[[-480,"HK","HK%sT",null]],"Asia/Taipei":[[-480,"Taiwan","C%sT",null]],"Asia/Nicosia":[[-120,"EUAsia","EE%sT",null]],"Asia/Kolkata":[[-330,"-","IST",null]],"Asia/Tehran":[[-210,"Iran","+0330/+0430",null]],"Asia/Jerusalem":[[-120,"Zion","I%sT",null]],"Asia/Tokyo":[[-540,"Japan","J%sT",null]],"Asia/Almaty":[[-360,"-","ALMT",null]],"Asia/Seoul":[[-540,"ROK","K%sT",null]],"Asia/Pyongyang":[[-540,"-","KST",14395968e5],[-510,"-","KST",15254784e5],[-540,"-","KST",null]],"Asia/Kuala_Lumpur":[[-480,"-","+08",null]],"Asia/Hovd":[[-420,"Mongol","+07/+08",null]],"Asia/Ulaanbaatar":[[-480,"Mongol","+08/+09",null]],"Asia/Kathmandu":[[-345,"-","+0545",null]],"Asia/Karachi":[[-300,"Pakistan","PK%sT",null]],"Asia/Riyadh":[[-180,"-","+03",null]],"Asia/Bangkok":[[-420,"-","+07",null]],"Asia/Dubai":[[-240,"-","+04",null]],"Australia/Darwin":[[-570,"Aus","CST",null]],"Australia/Perth":[[-480,"AW","WST",null]],"Australia/Eucla":[[-525,"AW","+0845/+0945",null]],"Australia/Brisbane":[[-600,"AQ","EST",null]],"Australia/Adelaide":[[-570,"AS","CST",null]],"Australia/Sydney":[[-600,"AN","EST",null]],"Pacific/Guam":[[-600,"-","ChST",null]],"Pacific/Kiritimati":[[-840,"-","+14",null]],"Pacific/Noumea":[[-660,"NC","+11/+12",null]],"Pacific/Auckland":[[-720,"NZ","NZ%sT",null]],"Pacific/Chatham":[[-765,"Chatham","+1245/+1345",null]],"Pacific/Pago_Pago":[[660,"-","SST",null]],"Pacific/Apia":[[-780,"WS","+13/+14",null]],"Pacific/Tongatapu":[[-780,"Tonga","+13/+14",null]],"Etc/UTC":[[0,"-","UTC",null]],UTC:"Etc/UTC","Europe/London":[[0,"EU","GMT/BST",null]],"Europe/Dublin":[[0,"Eire","IST/GMT",null]],WET:[[0,"EU","WE%sT",null]],CET:[[-60,"C-Eur","CE%sT",null]],MET:[[-60,"C-Eur","ME%sT",null]],EET:[[-120,"EU","EE%sT",null]],"Europe/Brussels":[[-60,"EU","CE%sT",null]],"Europe/Helsinki":[[-120,"EU","EE%sT",null]],"Europe/Paris":[[-60,"EU","CE%sT",null]],"Europe/Berlin":[[-60,"EU","CE%sT",null]],"Europe/Amsterdam":[[-60,"EU","CE%sT",null]],"Atlantic/Azores":[[60,"EU","-01/+00",null]],"Europe/Bucharest":[[-120,"EU","EE%sT",null]],"Europe/Kaliningrad":[[-180,"-","+03",14142888e5],[-120,"-","EET",null]],"Europe/Moscow":[[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Simferopol":[[-120,"EU","EE%sT",13961448e5],[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Samara":[[-240,"-","+04",null]],"Asia/Yekaterinburg":[[-360,"-","+06",14142888e5],[-300,"-","+05",null]],"Asia/Omsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",null]],"Asia/Novosibirsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",14693256e5],[-420,"-","+07",null]],"Asia/Novokuznetsk":[[-420,"-","+07",null]],"Asia/Krasnoyarsk":[[-480,"-","+08",14142888e5],[-420,"-","+07",null]],"Asia/Irkutsk":[[-540,"-","+09",14142888e5],[-480,"-","+08",null]],"Asia/Yakutsk":[[-600,"-","+10",14142888e5],[-540,"-","+09",null]],"Asia/Vladivostok":[[-660,"-","+11",14142888e5],[-600,"-","+10",null]],"Asia/Magadan":[[-720,"-","+12",14142888e5],[-600,"-","+10",14614632e5],[-660,"-","+11",null]],"Asia/Srednekolymsk":[[-720,"-","+12",14142888e5],[-660,"-","+11",null]],"Asia/Kamchatka":[[-720,"-","+12",null]],"Europe/Belgrade":[[-60,"EU","CE%sT",null]],"Europe/Sarajevo":"Europe/Belgrade","Europe/Istanbul":[[-120,"EU","EE%sT",13961412e5],[-120,"-","EET",13962276e5],[-120,"EU","EE%sT",14457348e5],[-120,"1:00","EEST",14469444e5],[-120,"EU","EE%sT",14732064e5],[-180,"-","+03",null]],"America/New_York":[[300,"US","E%sT",null]],"America/Chicago":[[360,"US","C%sT",null]],"America/Denver":[[420,"US","M%sT",null]],"America/Los_Angeles":[[480,"US","P%sT",null]],"America/Juneau":[[540,"US","AK%sT",null]],"Pacific/Honolulu":[[600,"-","HST",null]],"America/Phoenix":[[420,"-","MST",null]],"America/Indiana/Indianapolis":[[300,"US","E%sT",null]],"America/St_Johns":[[210,"Canada","N%sT",null]],"America/Halifax":[[240,"Canada","A%sT",null]],"America/Regina":[[360,"-","CST",null]],"America/Mexico_City":[[360,"Mexico","C%sT",null]],"America/Chihuahua":[[420,"Mexico","M%sT",null]],"America/Tijuana":[[480,"US","P%sT",null]],"America/Costa_Rica":[[360,"CR","C%sT",null]],"America/Puerto_Rico":[[240,"-","AST",null]],"America/Argentina/Buenos_Aires":[[180,"Arg","-03/-02",null]],"America/Sao_Paulo":[[180,"Brazil","-03/-02",null]],"America/Santiago":[[240,"Chile","-04/-03",null]],"America/Punta_Arenas":[[240,"Chile","-04/-03",14808096e5],[180,"-","-03",null]],"America/Bogota":[[300,"CO","-05/-04",null]],"America/Asuncion":[[240,"Para","-04/-03",null]],"Atlantic/South_Georgia":[[120,"-","-02",null]],"America/Montevideo":[[180,"Uruguay","-03/-02",null]],"America/Caracas":[[270,"-","-0430",14620698e5],[240,"-","-04",null]],"Europe/Athens":"Europe/Bucharest","Asia/Rangoon":"Asia/Yangon","Atlantic/Reykjavik":"UTC","Asia/Kuwait":"Asia/Riyadh","Asia/Muscat":"Asia/Riyadh","Asia/Istanbul":"Europe/Istanbul","Pacific/Midway":"Pacific/Pago_Pago"},rules:{Egypt:[[2014,"only","-","May","16",[0,0,0,null],60,"S"],[2014,"only","-","Jun","27",[0,0,0,null],0,"-"],[2014,"only","-","Aug","1",[0,0,0,null],60,"S"],[2014,"only","-","Sep","lastThu",[23,0,0,"s"],0,"-"]],Morocco:[[2012,2013,"-","Apr","lastSun",[2,0,0,null],60,"S"],[2013,"only","-","Jul","7",[3,0,0,null],0,"-"],[2013,"only","-","Aug","10",[2,0,0,null],60,"S"],[2013,"max","-","Oct","lastSun",[3,0,0,null],0,"-"],[2014,2021,"-","Mar","lastSun",[2,0,0,null],60,"S"],[2014,"only","-","Jun","28",[3,0,0,null],0,"-"],[2014,"only","-","Aug","2",[2,0,0,null],60,"S"],[2015,"only","-","Jun","14",[3,0,0,null],0,"-"],[2015,"only","-","Jul","19",[2,0,0,null],60,"S"],[2016,"only","-","Jun","5",[3,0,0,null],0,"-"],[2016,"only","-","Jul","10",[2,0,0,null],60,"S"],[2017,"only","-","May","21",[3,0,0,null],0,"-"],[2017,"only","-","Jul","2",[2,0,0,null],60,"S"],[2018,"only","-","May","13",[3,0,0,null],0,"-"],[2018,"only","-","Jun","17",[2,0,0,null],60,"S"],[2019,"only","-","May","5",[3,0,0,null],0,"-"],[2019,"only","-","Jun","9",[2,0,0,null],60,"S"],[2020,"only","-","Apr","19",[3,0,0,null],0,"-"],[2020,"only","-","May","24",[2,0,0,null],60,"S"],[2021,"only","-","Apr","11",[3,0,0,null],0,"-"],[2021,"only","-","May","16",[2,0,0,null],60,"S"],[2022,"only","-","May","8",[2,0,0,null],60,"S"],[2023,"only","-","Apr","23",[2,0,0,null],60,"S"]],SA:[],Tunisia:[],EUAsia:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],Azer:[[1997,2015,"-","Mar","lastSun",[4,0,0,null],60,"-"],[1997,2015,"-","Oct","lastSun",[5,0,0,null],0,"-"]],Dhaka:[],PRC:[],HK:[],Taiwan:[],Iran:[[2013,2015,"-","Mar","22",[0,0,0,null],60,"-"],[2013,2015,"-","Sep","22",[0,0,0,null],0,"-"],[2016,"only","-","Mar","21",[0,0,0,null],60,"-"],[2016,"only","-","Sep","21",[0,0,0,null],0,"-"],[2017,2019,"-","Mar","22",[0,0,0,null],60,"-"],[2017,2019,"-","Sep","22",[0,0,0,null],0,"-"],[2020,"only","-","Mar","21",[0,0,0,null],60,"-"],[2020,"only","-","Sep","21",[0,0,0,null],0,"-"],[2021,2023,"-","Mar","22",[0,0,0,null],60,"-"],[2021,2023,"-","Sep","22",[0,0,0,null],0,"-"]],Zion:[[2013,"max","-","Mar","Fri>=23",[2,0,0,null],60,"D"],[2013,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],Japan:[],ROK:[],Mongol:[[2015,2016,"-","Mar","lastSat",[2,0,0,null],60,"-"],[2015,2016,"-","Sep","lastSat",[0,0,0,null],0,"-"]],Pakistan:[],Aus:[],AW:[],AQ:[],AS:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],AN:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],NC:[],NZ:[[2007,"max","-","Sep","lastSun",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],Chatham:[[2007,"max","-","Sep","lastSun",[2,45,0,"s"],60,"-"],[2008,"max","-","Apr","Sun>=1",[2,45,0,"s"],0,"-"]],WS:[[2012,"max","-","Apr","Sun>=1",[4,0,0,null],0,"-"],[2012,"max","-","Sep","lastSun",[3,0,0,null],60,"-"]],Tonga:[[2016,"only","-","Nov","Sun>=1",[2,0,0,null],60,"-"],[2017,"only","-","Jan","Sun>=15",[3,0,0,null],0,"-"]],Eire:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],0,"-"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],-60,"-"]],EU:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],"C-Eur":[[1981,"max","-","Mar","lastSun",[2,0,0,"s"],60,"S"],[1996,"max","-","Oct","lastSun",[2,0,0,"s"],0,"-"]],US:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Canada:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Mexico:[[2002,"max","-","Apr","Sun>=1",[2,0,0,null],60,"D"],[2002,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],CR:[],Arg:[],Brazil:[[2008,2017,"-","Oct","Sun>=15",[0,0,0,null],60,"-"],[2013,2014,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2015,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"],[2016,2022,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2018,"max","-","Nov","Sun>=1",[0,0,0,null],60,"-"],[2023,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"]],Chile:[[2012,2014,"-","Apr","Sun>=23",[3,0,0,"u"],0,"-"],[2012,2014,"-","Sep","Sun>=2",[4,0,0,"u"],60,"-"],[2016,"max","-","May","Sun>=9",[3,0,0,"u"],0,"-"],[2016,"max","-","Aug","Sun>=9",[4,0,0,"u"],60,"-"]],CO:[],Para:[[2010,"max","-","Oct","Sun>=1",[0,0,0,null],60,"-"],[2013,"max","-","Mar","Sun>=22",[0,0,0,null],0,"-"]],Uruguay:[[2006,2015,"-","Mar","Sun>=8",[2,0,0,null],0,"-"],[2006,2014,"-","Oct","Sun>=1",[2,0,0,null],60,"-"]]}}),l.convertTimeZone=function(t,e,i){var a=new n.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e);return a.setTimezone(i),a},l.convertToLocalTime=function(t,e){var i=t.getSeconds(),a=t.getMilliseconds(),r=new n.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),e);return new Date(r.getTime()+1e3*i+a)}}(t),function(t,e){t.SplinePlotter||(t.SplinePlotter={});var L=t.CIQ,g=(t.$$$,t.SplinePlotter);t.SplinePlotter.plotSpline||(t.SplinePlotter.plotSpline=function(t,e,i,a){window.splineWarning||console.log("Warning: Cannot find implementation of splining.  Try loading splines.js"),window.splineWarning=1;var r=0;i.moveTo(t[0],t[1]);for(var n=2;n<t.length;n+=2){if(a&&r<a.length){var s=a[r];s.coord[0]==t[n-2]&&s.coord[1]==t[n-1]&&(i.stroke(),i.strokeStyle=s.color,i.setLineDash(s.pattern),i.lineDashOffset=0,i.lineWidth=s.width,i.beginPath(),i.moveTo(t[n-2],t[n-1]),r++)}i.lineTo(t[n],t[n+1])}}),L.getETDateTime=function(){var t=new Date;return L.convertTimeZone(new Date(t.getTime()+6e4*t.getTimezoneOffset()),"UTC","America/New_York")},L.fromET=function(t){var e=new Date,i=4;(e.getMonth()<2||2==e.getMonth()&&e.getDate()<11||10<e.getMonth()||10==e.getMonth()&&4<=e.getDate())&&(i=5);var a=t.getTime()+36e5*i;return new Date(a)},L.convertFutureMonth=function(t){var e=t.toString();if(e.length<=0||2<e.length)return"";switch(e){case"1":return"F";case"2":return"G";case"3":return"H";case"4":return"J";case"5":return"K";case"6":return"M";case"7":return"N";case"8":return"Q";case"9":return"U";case"10":return"V";case"11":return"X";case"12":return"Z";case"F":return"1";case"G":return"2";case"H":return"3";case"J":return"4";case"K":return"5";case"M":return"6";case"N":return"7";case"Q":return"8";case"U":return"9";case"V":return"10";case"X":return"11";case"Z":return"12"}return e},L.money=function(t,e,i){return i||(i="$"),3==i.length&&(i+=" "),e||0===e||(e=2),i+L.commas((Math.round(1e4*t)/1e4).toFixed(e))},L.convertCurrencyCode=function(t){var e={JPY:"",USD:"$",AUD:"A$",BRL:"R$",CAD:"CA$",CNY:"CN",CZK:"K",DKK:"kr",EUR:"",GBP:"",HKD:"HK$",HUF:"Ft",ILS:"",INR:"",KRW:"",MXN:"MX$",NOK:"kr",NZD:"NZ$",PLN:"z",RUB:"",SAR:"",SEK:"kr",SGD:"S$",THB:"",TRY:"",TWD:"NT$",VND:"",XAF:"FCFA",XCD:"EC$",XOF:"CFA",XPF:"CFPF",ZAR:"R"}[t];return e||t},L.commas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},L.alert=function(t){alert(t)},L.withinElement=function(t,e,i){var a=t.getBoundingClientRect();return!(e<=a.left||i<=a.top||e>=a.left+t.offsetWidth||i>=a.top+t.offsetHeight)},L.efficientDOMUpdate=function(t,e,i){t[e]!==i&&(t[e]=i)},L.safeMouseOut=function(t,e){var i,a;t.addEventListener("mouseout",(i=t,a=e,function(t){void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),L.withinElement(i,t.pageX,t.pageY)||(i.stxMouseOver=!1,a(t))}))},L.safeMouseOver=function(t,e){var i,a;t.addEventListener("mouseover",(i=t,a=e,function(t){if(void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),L.withinElement(i,t.pageX,t.pageY)){if(i.stxMouseOver)return;i.stxMouseOver=!0,a(t)}}))},L.installTapEvent=function(t,i){L.safeClickTouch(t,function(t){var e=document.createEvent("Event");e.initEvent("stxtap",!0,!0),void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),e.pageX=t.pageX,e.pageY=t.pageY,t.target.dispatchEvent(e),i&&i.stopPropagation&&t.stopPropagation()},i)},L.safeClickTouch=function(t,n,e){e||(e={});var i={};function a(i,a,r){return function(t){if(!L.safeClickTouchEvent){if(!r.t)return;var e=r.t;if(r.t=null,e+1e3<(new Date).getTime())return}if(!(a.safety&&a.safety.recentlyDragged||(t||(t=event),t.which&&2<=t.which||t.button&&2<=t.button))){if(a.preventUnderlayClick)"INPUT"!==t.target.tagName&&t.preventDefault();else{if(a.lastType!=i&&Date.now()<a.allowAnotherDevice)return;a.lastType=i,a.allowAnotherDevice=Date.now()+1e3}n(t)}}}function r(a,r){return function(t){var e=t.clientX?t.clientX:t.pageX,i=t.clientY?t.clientY:t.pageY;r?(a.t=(new Date).getTime(),a.x=e,a.y=i):a.x&&16<Math.pow(a.x-e,2)+Math.pow(a.y-i,2)&&(a.t=null)}}e.allowMultiple||L.clearSafeClickTouches(t),!1!==e.preventUnderlayClick&&(e.preventUnderlayClick=!0),!1!==e.absorbDownEvent&&(e.absorbDownEvent=!0),e.allowAnotherDevice=0,e.registeredClick=!1;var s=t.safeClickTouchEvents;s||(s=t.safeClickTouchEvents=[]);var o=a("mouseup",e,i),l=a("touchend",e,i),h=a("pointerup",e,i),c=function(t){t.stopPropagation()},u={};if(L.safeClickTouchEvent){var p=a(L.safeClickTouchEvent,e);t.addEventListener(L.safeClickTouchEvent,p),u[L.safeClickTouchEvent]=p,s.push(u)}else"onpointerup"in document?(t.addEventListener("pointerdown",r(i,!0)),t.addEventListener("pointermove",r(i)),t.addEventListener("pointerup",h),u.pointerup=h,e.absorbDownEvent&&(t.addEventListener("pointerdown",c),u.pointerdown=c)):(t.addEventListener("mousedown",r(i,!0)),t.addEventListener("mousemove",r(i)),t.addEventListener("touchstart",r(i,!0)),t.addEventListener("touchmove",r(i)),t.addEventListener("mouseup",o),t.addEventListener("touchend",l),u.mouseup=o,u.touchend=l,e.absorbDownEvent&&(t.addEventListener("mousedown",c),u.mousedown=c,t.addEventListener("touchstart",c),u.touchstart=c)),s.push(u)},L.clearSafeClickTouches=function(t){var e=t.safeClickTouchEvents;if(e){for(var i=0;i<e.length;i++){var a=e[i];for(var r in a){var n=a[r];t.removeEventListener(r,n)}}t.safeClickTouchEvents=null}},L.safeDrag=function(t,e,o,l){var h=!1,c=0,u=0,p={recentlyDragged:!1};function i(a){var r={mousedown:{move:"mousemove",up:"mouseup"},pointerdown:{move:"pointermove",up:"pointerup"},touchstart:{move:"touchmove",up:"touchend"}};function n(t){if(t.touches){if(1<=t.touches.length)return t.touches[0].pageX;if(t.changedTouches&&1<=t.changedTouches.length)return t.changedTouches[0].pageX}return void 0===t.pageX?t.clientX:t.pageX}function s(t){if(t.touches){if(1<=t.touches.length)return t.touches[0].pageY;if(t.changedTouches&&1<=t.changedTouches.length)return t.changedTouches[0].pageY}return void 0===t.pageY?t.clientY:t.pageY}return function(t){if(!h){h=!0,L.ChartEngine.ignoreTouch=!0;var i=function(t){t&&t.preventDefault&&t.preventDefault(),p.recentlyDragged=!0,t.displacementX=n(t)-c,t.displacementY=s(t)-u,o(t)};o&&document.body.addEventListener(r[a].move,i),document.body.addEventListener(r[a].up,function(t){var e;L.ChartEngine.ignoreTouch=!1,o&&document.body.removeEventListener(r[a].move,i),document.body.removeEventListener(r[a].up,arguments.callee),t.displacementX=n(t)-c,t.displacementY=s(t)-u,l&&l(t),setTimeout((e=p,function(){e.recentlyDragged=!1}),50)}),setTimeout(function(){h=!1},100),c=n(t),u=s(t),e&&e(t)}}}return t.addEventListener("mousedown",i("mousedown")),t.addEventListener("pointerdown",i("pointerdown")),t.addEventListener("touchstart",i("touchstart")),p},L.isSurface&&(L.gesture=new MSGesture,L.gesture.target=document.body,L.gesturePointerId=null),L.inputKeyEvents=function(e,i){e.addEventListener("keyup",function(t){switch(window.event?event.keyCode:t.keyCode){case 13:i();break;case 27:e.value=""}},!1)},L.fixScreen=function(){window.scrollTo(0,0)},L.setCaretPosition=function(t,e){if(t.style.zIndex=5e3,t.setSelectionRange){L.focus(t);try{t.setSelectionRange(e,e)}catch(t){}}else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select()}},L.setValueIfNotActive=function(t,e){document.activeElement!=t&&(t.value=e)},L.hideKeyboard=function(t){var e=document.activeElement;"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.blur(),window.focus(),t&&(t===document.body||document.body.contains(t))&&t.focus())},L.boxIntersects=function(t,e,i,a,r,n,s,o,l){void 0!==arguments[9]&&console.warn("CIQ.boxIntersects() no longer supports isLog argument, please be sure arguments are passed in as pixels.");var h=Math.min(t,i),c=Math.max(t,i),u=Math.min(e,a),p=Math.max(e,a),d="ray"==l;if("line"!=l){if(r<h&&s<h&&(!d||s<r))return!1;if(c<r&&c<s&&(!d||r<s))return!1;if(n<u&&o<u&&(!d||o<n))return!1;if(p<n&&p<o&&(!d||n<o))return!1}function m(t,e){return(e-n)*(s-r)-(t-r)*(o-n)}var g=m(t,e),f=m(t,a),y=m(i,e),v=m(i,a);return!(0<g&&0<f&&0<y&&0<v||g<0&&f<0&&y<0&&v<0)},L.convertBoxToPixels=function(t,e,i){var a=t.panels[e];return{x0:t.pixelFromTick(i.x0,a.chart),x1:t.pixelFromTick(i.x1,a.chart),y0:t.pixelFromValueAdjusted(a,i.x0,i.y0),y1:t.pixelFromValueAdjusted(a,i.x1,i.y1)}},L.linesIntersect=function(t,e,i,a,r,n,s,o,l){var h=(o-s)*(e-t)-(n-r)*(a-i),c=(n-r)*(i-s)-(o-s)*(t-r),u=(e-t)*(i-s)-(a-i)*(t-r);if(0===h)return 0===c&&0===u;var p=c/h,d=u/h;if("segment"==l){if(0<=p&&p<=1&&0<=d&&d<=1)return!0}else if("line"==l||"horizontal"==l||"vertical"==l){if(0<=p&&p<=1)return!0}else if("ray"==l&&0<=p&&p<=1&&0<=d)return!0;return!1},L.yIntersection=function(t,e){var i=t.x0,a=t.x1,r=e,n=e,s=t.y0,o=t.y1,l=1e4*(a-i)-(n-r)*(o-s),h=(n-r)*(s-0)-1e4*(i-r),c=h/l;if(0===l){if(0!==h)return null;c=1}return s+c*(o-s)},L.xIntersection=function(t,e){var i=t.x0,a=t.x1,r=t.y0,n=(e-e)*(a-i)-1e4*(t.y1-r),s=1e4*(r-e)-(e-e)*(i-0),o=s/n;if(0===n){if(0!==s)return null;o=1}return i+o*(a-i)},L.intersectLineLineX=function(t,e,i,a,r,n,s,o){return t+((n-r)*(i-s)-(o-s)*(t-r))/((o-s)*(e-t)-(n-r)*(a-i))*(e-t)},L.intersectLineLineY=function(t,e,i,a,r,n,s,o){return i+((n-r)*(i-s)-(o-s)*(t-r))/((o-s)*(e-t)-(n-r)*(a-i))*(a-i)},L.privateBrowsingAlert=!1,L.localStorage="undefined"!=typeof localStorage?localStorage:{},L.localStorageSetItem=function(t,e){try{L.localStorage.setItem(t,e)}catch(t){L.privateBrowsingAlert||(L.alert("No storage space available.  Possible causes include browser being in Private Browsing mode, or maximum storage space has been reached."),L.privateBrowsingAlert=!0)}},L.loadUI=function(t,n,s){var o=document.createElement("iframe");n&&"function"!=typeof n||(s=n,n=document.body),o.src=t+"?"+L.uniqueID(),o.hidden=!0,o.addEventListener("load",function(){var t=null;try{t=o.contentDocument||o.contentWindow.document}catch(t){return s(t)}if(t&&!t.title){var e=t.body.innerHTML,i=document.createElement("div");document.body.removeChild(o),L.innerHTML(i,e);for(var a=0;a<i.children.length;a++){var r=i.children[a].cloneNode(!0);n.appendChild(r)}s(null)}else s(new Error("iFrame not found or document has a title"))},!1),document.body.appendChild(o)},L.loadScript=function(t,e){if(L.loadedScripts||(L.loadedScripts={}),L.loadedScripts[t])e&&e();else{var i=document.createElement("SCRIPT");i.async=!0,i.onload=function(){L.loadedScripts[t]=!0,e&&e()},"undefined"!=typeof isIE8&&(i.onreadystatechange=function(){"loaded"==i.readyState&&(L.loadedScripts[t]=!0,e&&setTimeout(e,0))});var a=t;a=-1==a.indexOf("?")?a+"?"+Date.now():a+"&"+Date.now(),i.src=a;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r.nextSibling)}},L.loadStylesheet=function(t,e){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="screen",i.href=t+"?"+Date.now(),i.onload=function(){this.loaded||(this.loaded=!0,e&&e())};var a=document.getElementsByTagName("link"),r=a[a.length-1];r.parentNode.insertBefore(i,r.nextSibling)},L.loadWidget=function(e,t,i){t&&"function"!=typeof t||(i=t,t=document.body),L.loadStylesheet(e+".css",function(){L.loadUI(e+".html",t,function(t){t?i(t):L.loadScript(e+".js",i)})})},L.waitForPlugins=function(t,e){var i=0,a=t.length;if(a){for(var r=0;r<a;r++){var n="cq-"+t[r],s=document.getElementsByTagName(n)[0];s&&s.hasAttribute("loaded")&&i++}if(a!==i)return setTimeout(function(){L.waitForPlugins(t,e)},0);e()}else e()},L.fillTransparentCanvas=function(t,e,i,a){var r=t.globalCompositeOperation;t.globalCompositeOperation="destination-over",t.fillStyle=e,t.fillRect(0,0,i,a),t.globalCompositeOperation=r},L.tickedRect=function(t){L.rect(t);var e=Math.round(t.top+t.height/2)+.5;t.ctx.beginPath(),t.ctx.moveTo(t.x-2,e),t.ctx.lineTo(t.x,e),t.ctx.stroke(),t.ctx.closePath()},L.roundRect=function(t,e){9===arguments.length&&(t={ctx:t,x:e,top:arguments[2],width:arguments[3],height:arguments[4],radius:arguments[5],fill:arguments[6],stroke:arguments[7],edge:arguments[8]});var i=t.stroke,a=t.x,r=t.top,n=t.width,s=t.height,o=t.radius,l=t.fill,h=t.ctx;void 0===i&&(i=!0),void 0===o&&(o=5,n<0&&(o=-5));var c=n<0?-1*o:o;o&&!e&&(a-=1);var u=a+o,p=a+n,d=r+c,m=r+s,g=p-o,f=m-c;if(h.beginPath(),h.moveTo(u,r),h.lineTo(g,r),h.quadraticCurveTo(p,r,p,d),h.lineTo(p,f),h.quadraticCurveTo(p,m,g,m),h.lineTo(u,m),"flush"==e)h.lineTo(a,m),h.lineTo(a,r);else if("arrow"==e){h.quadraticCurveTo(a,m,a-o,f);var y=n<0?1:-1;h.lineTo(a+s/2*y,r+s/2),h.lineTo(a-o,d),h.quadraticCurveTo(a,r,u,r)}else h.quadraticCurveTo(a,m,a,f),h.lineTo(a,d),h.quadraticCurveTo(a,r,u,r);h.closePath(),t.backgroundColor&&(h.fillStyle=t.backgroundColor),i&&h.stroke(),l&&h.fill(),t.txt&&L.createLabel(t)},L.createLabel=function(t){t.ctx.textBaseline="middle",t.ctx.fillStyle=t.color?t.color:L.chooseForegroundColor(t.backgroundColor),t.ctx.fillStyle===t.backgroundColor&&("#FFFFFF"==t.backgroundColor.toUpperCase()?t.ctx.fillStyle="#000000":t.ctx.fillStyle="#FFFFFF"),t.ctx.fillText(t.txt,t.x+t.margin.left,t.y+t.margin.top),t.ctx.textAlign="left"},L.roundRectArrow=function(t){L.roundRect(t,"arrow")},L.semiRoundRect=function(t){L.roundRect(t,"flush")},L.rect=function(t){t.radius=0,L.roundRect(t)},L.noop=function(t){t.color=t.backgroundColor,L.createLabel(t)},L.getLines=function(t,e,i){for(var a=e.split(" "),r=[],n="",s=!1,o=0;o<a.length;o++){var l=a[o];if(t.measureText(n+l).width<i?(s&&(n+=" "),s=!0,n+=l):(r.push(n),n=l),o===a.length-1){r.push(n);break}}return r},L.readablePeriodicity=function(t){var e=t.layout.periodicity,i=t.layout.interval;return"number"==typeof t.layout.interval&&t.layout.timeUnit?(e=t.layout.interval*t.layout.periodicity,i=t.layout.timeUnit):"number"!=typeof t.layout.interval||t.layout.timeUnit||(e=t.layout.interval*t.layout.periodicity,i="minute"),e%60==0&&"minute"==i&&(e/=60,i="hour"),e+" "+t.translateIf(i.capitalize())},L.translatableTextNode=function(t,e,i){if(t.translationCallback){var a=document.createElement("translate");return a.setAttribute("original",e),a.innerHTML=t.translationCallback(e,i),a}return document.createTextNode(e)},L.clearCanvas=function(t,e){t.isDirty=!1;var i=t.context;if(i.clearRect(0,0,t.width,t.height),L.isAndroid&&!L.is_chrome){L.ChartEngine.useOldAndroidClear&&e&&(i.fillStyle=e.containerColor,i.fillRect(0,0,t.width,t.height),i.clearRect(0,0,t.width,t.height));var a=t.width;t.width=1,t.width=a}},L.monthLetters=["J","F","M","A","M","J","J","A","S","O","N","D"],L.monthAbv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],L.MILLISECOND=1,L.SECOND=1e3,L.MINUTE=60*L.SECOND,L.HOUR=60*L.MINUTE,L.DAY=24*L.HOUR,L.WEEK=7*L.DAY,L.MONTH=31*L.DAY,L.YEAR=366*L.DAY,L.DECADE=10*L.YEAR-7*L.DAY,L.monthAsDisplay=function(t,e,i){return e?i&&i.monthLetters?i.monthLetters[t]:L.monthLetters[t]:i&&i.monthAbv?i.monthAbv[t]:L.monthAbv[t]},L.timeAsDisplay=function(t,e,i){var a=e?e.internationalizer:null;if(a)return i==L.SECOND?a.hourMinuteSecond.format(t):i==L.MILLISECOND?a.hourMinuteSecond.format(t)+"."+t.getMilliseconds():a.hourMinute.format(t);var r=t.getMinutes();r<10&&(r="0"+r);var n=t.getHours()+":"+r,s="";if(i<=L.SECOND&&((s=t.getSeconds())<10&&(s="0"+s),n+=":"+s),i==L.MILLISECOND){var o=t.getMilliseconds();o<10?o="00"+o:o<100&&(o="0"+o),n+="."+o}return n},L.displayableDate=function(t,e,i){function a(t){return t<10?"0"+t:t}var r="",n=t.layout.interval,s=L.ChartEngine.isDailyInterval(n);if(e.xAxis.formatter)r=e.xAxis.formatter(i);else if(t.internationalizer)r=t.internationalizer.monthDay.format(i),s?r="month"==n?t.internationalizer.yearMonth.format(i):t.internationalizer.yearMonthDay.format(i):r+=" "+t.internationalizer.hourMinute.format(i);else{var o=a(i.getMonth()+1),l=a(i.getDate()),h=a(i.getHours()),c=a(i.getMinutes());if(s)r="month"==n?o+"-":o+"-"+l+"-",r+=i.getFullYear();else{r=o+"/"+l+" "+h+":"+c;var u=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=L.SECOND||"second"==t.layout.timeUnit,p=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=L.MILLISECOND||"millisecond"==t.layout.timeUnit;if((u||p)&&(r+=":"+a(i.getSeconds()),p)){var d=a(i.getMilliseconds());d<100&&(d="0"+d),r+=":"+d}}}return r},L.fixPrice=function(t){if(!t&&0!==t)return null;for(var e=t.toFixed(10),i=e.length-1;1<i&&"0"==e.charAt(i);i--);return e=e.substring(0,i+1),parseFloat(e)},L.condenseInt=function(t){return null==t?"":t===1/0||t===-1/0?"n/a":t=0<t?1e12<t?Math.round(t/1e11)/10+"t":1e11<t?Math.round(t/1e9)+"b":1e10<t?(Math.round(t/1e8)/10).toFixed(1)+"b":1e9<t?(Math.round(t/1e7)/100).toFixed(2)+"b":1e8<t?Math.round(t/1e6)+"m":1e7<t?(Math.round(t/1e5)/10).toFixed(1)+"m":1e6<t?(Math.round(t/1e4)/100).toFixed(2)+"m":1e5<t?Math.round(t/1e3)+"k":1e4<t?(Math.round(t/100)/10).toFixed(1)+"k":1e3<t?(Math.round(t/10)/100).toFixed(2)+"k":t.toString():t<-1e12?Math.round(t/1e11)/10+"t":t<-1e9?Math.round(t/1e8)/10+"b":t<-1e6?Math.round(t/1e5)/10+"m":t<-1e3?Math.round(t/100)/10+"k":t.toString()},L.calculateTradingDecimalPlaces=function(t){var e=t.chart,i=2,a=e.masterData;if(a&&50<a.length)for(var r=2;r<50;r++){var n=a.length-r;if(n<0)break;var s=a[n];if(s.Close&&"number"==typeof s.Close){var o=s.Close.toString(),l=o.indexOf(".");if(-1!=l){var h=o.length-l-1;i<h&&(i=h)}}}var c=e.yAxis.maxDecimalPlaces;return c<i&&(i=c),i},L.fillArea=function(t,e,i){if(e.length){var a=t.chart.context,r=a.globalAlpha,n=i,s=arguments[3],o=arguments[4],l=0,h=null;i&&"object"==typeof i&&(n=i.color,s=i.opacity,l=i.tension,o=i.panelName,h=i.yAxis),s||0===s||(s=.2),"auto"==n&&(n=t.defaultColor),a.globalAlpha=s,n&&(a.fillStyle=n);var c,u=Number.MAX_VALUE,p=-1*u,d=t.panels[o];if(d&&(p=(h||d.yAxis).top,u=(h||d.yAxis).bottom,a.save(),a.beginPath(),a.rect(d.left,p,d.width,u-p),a.clip()),a.beginPath(),l){var m=[];for(c=0;c<e.length-2;c++)m.push(e[c][0],e[c][1]);for(g.plotSpline(m,l,a),c=e.length-2;c<e.length;c++)a.lineTo(Math.round(e[c][0]),Math.round(e[c][1]))}else for(a.moveTo(e[0][0],e[0][1]),c=1;c<e.length;c++)a.lineTo(e[c][0],e[c][1]);a.closePath(),a.fill(),d&&a.restore(),a.globalAlpha=r}},L.prepareChannelFill=function(t,e){(!e||e instanceof Array)&&(e=arguments[2]),e.gapDisplayStyle||!1===e.gapDisplayStyle||(e.gapDisplayStyle=e.gaps);var i=t.panels[e.panelName],a=(t.chart.context.strokeStyle,{noDraw:e.noDraw,gapDisplayStyle:e.gapDisplayStyle}),r=L.ensureDefaults(e,{noDraw:!0,gapDisplayStyle:{},yAxis:i.yAxis}),n=t.plotDataSegmentAsLine(e.topBand,i,r),s=t.plotDataSegmentAsLine(e.bottomBand,i,r);e.noDraw=a.noDraw,e.gapDisplayStyle=a.gapDisplayStyle;for(var o=[],l=0;l<n.points.length;l+=2)o.push([n.points[l],n.points[l+1]]);for(var h=s.points.length-1;0<=h;h-=2)o.push([s.points[h-1],s.points[h]]);L.fillArea(t,o,e)},L.preparePeakValleyFill=function(t,e){(!e||e instanceof Array)&&(e=arguments[2]),e.gapDisplayStyle||!1===e.gapDisplayStyle||(e.gapDisplayStyle=e.gaps);var i=t.panels[e.panelName],a=i.yAxis,r=t.chart,n=r.context,s=(n.strokeStyle,{noDraw:e.noDraw,gapDisplayStyle:e.gapDisplayStyle}),o=t.plotDataSegmentAsLine(e.band,i,L.ensureDefaults(e,{noDraw:!0,gapDisplayStyle:{}}));e.noDraw=s.noDraw,e.gapDisplayStyle=s.gapDisplayStyle;var l=e.threshold,h=e.direction,c=e.reverse,u=e.gapDisplayStyle;e.yAxis&&(a=e.yAxis);var p=-Number.MAX_VALUE,d=Number.MAX_VALUE,m=c?p:d;(l||0===l)&&(m=t.pixelFromPrice(l,i,a));for(var g=[],f=o.points.length,y=0;y<f;y+=2){var v,x,C=o.points[y],S=o.points[y+1];isNaN(S)||(m<S&&0<h||S<m&&h<0||(g.push([C,S]),p=Math.max(S,p),d=Math.min(S,d)),y<f-3&&(v=o.points[y+2],x=o.points[y+3],(S<m&&m<x||m<S&&x<m)&&(C+=(m-S)*(v-C)/(x-S),g.push([C,m]))))}if(f=g.length){var b=e.edgeParameters;if(e.edgeHighlight){100<b.lineWidth&&(b.lineWidth=1);for(var w=0;w<f-1;w++){var T=g[w],D=g[w+1];if(T[1]!=m||D[1]!=m){if(T[0]==D[0]&&1<=t.layout.candleWidth){if(T[1]==m&&g[w-1]&&g[w-1][1]==m)continue;if(D[1]==m&&g[w+2]&&g[w+2][1]==m)continue}t.plotLine(T[0],D[0],T[1],D[1],e.edgeHighlight,"segment",r.context,i,b)}}}l||0===l||(m=c?Math.min(d,a.top):Math.max(p,a.bottom)),g.push([g[f-1][0],m],[g[0][0],m]);var A=e.opacity;if(A||0===A||(e.opacity=.3),L.fillArea(t,g,e),u&&u.color&&u.fillMountain&&!e.tension&&!L.isTransparent(u.color)&&!L.isTransparent(e.color)){if(n.save(),n.fillStyle instanceof CanvasGradient){var M=n.createLinearGradient(0,1===h?i.top:i.bottom,0,m);M.addColorStop(0,L.hexToRgba(L.colorToHex(u.color),60)),M.addColorStop(1,L.hexToRgba(L.colorToHex(u.color),10)),n.fillStyle=M}else n.fillStyle=u.color;var k=[],F={opacity:e.opacity,panelName:e.panelName};for(y=0;y<o.gapAreas.length;y++){var P=o.gapAreas[y],_=P.start,N=P.end,E=P.threshold;_?k=[[_[0],_[1]],[_[0],E]]:k.push([N[0],E],[N[0],e.step?k[0][1]:N[1]]),4==k.length&&(L.fillArea(t,k,F),e.step?(t.plotLine(k[0][0],k[3][0],k[0][1],k[0][1],u,"segment",n,i,u),t.plotLine(k[3][0],k[3][0],k[0][1],k[3][1],u,"segment",n,i,u)):t.plotLine(k[0][0],k[3][0],k[0][1],k[3][1],u,"segment",n,i,u))}n.restore()}e.opacity=A}},L.fillIntersecting=function(t,e,i){(!i||i instanceof Array)&&(i=arguments[3]);var a=i.topBand,r=i.bottomBand,n=i.topSubBand,s=i.bottomSubBand,o=i.topColor,l=i.bottomColor,h=e;h.panel&&(h.outputs&&h.outputMap&&(o||(o=h.outputs[h.outputMap[a]]),l||(l=h.outputs[h.outputMap[r]])),h=h.panel),h=t.panels[h];var c=t.chart.context,u=t.scratchContext;if(!u){var p=c.canvas.cloneNode(!0);(u=t.scratchContext=p.getContext("2d")).canvas=p}u.canvas.height=c.canvas.height,u.canvas.width=c.canvas.width,u.drawImage(c.canvas,0,0),c.clearRect(0,0,c.canvas.width,c.canvas.height);var d=.3;i.opacity&&(d=i.opacity),c.save(),c.globalCompositeOperation="xor";var m={band:a,subField:n,color:o,opacity:1,panelName:h.name,yAxis:i.topAxis,skipTransform:i.skipTransform,tension:i.tension};L.preparePeakValleyFill(t,m),L.extend(m,{band:r,subField:s,color:l,yAxis:i.bottomAxis}),L.preparePeakValleyFill(t,m),c.globalAlpha=d,c.globalCompositeOperation="copy",c.scale(1/t.adjustedDisplayPixelRatio,1/t.adjustedDisplayPixelRatio),c.drawImage(c.canvas,0,0),c.globalAlpha=1,c.globalCompositeOperation="destination-over",c.drawImage(t.scratchContext.canvas,0,0),c.restore()},L.drawLegendItem=function(t,e,i,a,r){r||(r=1);var n=e[0],s=e[1],o=t.chart.context;return o.globalAlpha=r,o.fillStyle=a,o.fillRect(n,s,10,10),o.globalAlpha=1,n+=12,o.fillStyle=t.defaultColor,o.fillText(i,n,s),[n+=o.measureText(i).width+6,s]},L.drawLegend=function(t,e){var i=e.coordinates,a=t.chart.context;a.textBaseline="top";var r=a.font;t.canvasFont("stx-legend",a);var n=e.chart;i||(i=n.legend);for(var s=[i.x,i.y],o=t.defaultColor,l=0;l<2;l++)for(var h in e.legendColorMap){var c=e.legendColorMap[h];if((!c.isBase||!l&&!e.noBase)&&(c.isBase||l)){var u;if(c.color instanceof Array){var p=c.color;for(u=p.length-1;0<=u;u--)L.isTransparent(p[u])&&p.splice(u,1);if(1<p.length){var d=a.createLinearGradient(s[0],s[1],s[0]+10,s[1]);for(u=0;u<p.length;u++)d.addColorStop(u/(p.length-1),p[u]);o=d}else o=0<p.length?p[0]:t.getCanvasColor("stx_line_chart")}else o=null;if(o){var m=h;c.display&&(m=c.display),m||(m=n.symbolDisplay?n.symbolDisplay:n.symbol),s[0]+a.measureText(m).width>n.panel.right&&(s=[i.x,i.y+a.measureText("M").width+6]),s=L.drawLegendItem(t,s,m,o,c.opacity)}}}a.font=r},L.minMax=function(t,e,i,a){var r=Number.MAX_VALUE,n=-1*Number.MAX_VALUE;i||(i="Close");for(var s=a?"High":i,o=a?"Low":i,l=0;l<t.length;l++){var h=t[l];if(h){var c=h[e];if(c||0===c){var u=c;"object"==typeof c&&(u=c[s]),isNaN(u)||!u&&0!==u||(n=Math.max(n,u)),"object"==typeof c&&(u=c[o]),isNaN(u)||!u&&0!==u||(r=Math.min(r,u))}}}return[r,n]},L.symbolEqual=function(t,e){if(!t||!e)return!1;if("object"!=typeof t&&(t={symbol:t}),"object"!=typeof e&&(e={symbol:e}),"function"==typeof t.equals)return t.equals(e);var i=t.symbol,a=e.symbol;return i&&(i=i.toUpperCase()),a&&(a=a.toUpperCase()),i==a&&t.source==e.source},L.addMemberToMasterdata=function(t){t.constructor===L.ChartEngine&&(t={stx:t,label:arguments[1],data:arguments[2],fields:arguments[3],createObject:arguments[4],fieldForLabel:arguments[5]});var e=t.stx,s=t.label,i=t.data,o=t.fields,l=t.createObject,h=t.fieldForLabel,a=t.chart?t.chart:e.chart;t.noCleanupDates||e.doCleanupDates(i,e.layout.interval);var r=e.getSeries({symbol:s,chart:a});if(i&&i.constructor==Object&&(i=[i]),i&&i.length){var n,c,u=0,p=0,d=a.masterData,m=e.layout;d||(d=[]);for(var g=e.chart&&e.chart.defaultPlotField?e.chart.defaultPlotField:null,f=!e.chart.highLowBars&&!e.highLowBars[e.layout.chartType];i&&u<d.length&&p<i.length;){if(c=i[p],n=d[u],c.DT&&void 0!==c.DT?("number"==typeof c.DT&&(c.DT=new Date(c.DT)),c.Date&&17==c.Date.length||(c.Date=L.yyyymmddhhmmssmmm(c.DT))):c.DT=L.strToDateTime(c.Date),0===p)for(var y=0;y<r.length;y++)(!r[y].endPoints.begin||r[y].endPoints.begin>c.DT)&&(r[y].endPoints.begin=c.DT);+c.DT!=+n.DT?c.DT<n.DT?d.splice(u,0,{DT:c.DT,Date:c.Date}):b(c.DT):(S(n,c),p++,u++)}if(u>=d.length)for(;i&&p<i.length;)(c=i[p]).DT&&void 0!==c.DT?("number"==typeof c.DT&&(c.DT=new Date(c.DT)),c.Date&&17==c.Date.length||(c.Date=L.yyyymmddhhmmssmmm(c.DT))):c.DT=L.strToDateTime(c.Date),S(n={DT:c.DT,Date:c.Date},c),d.push(n),p++;if(t.fillGaps&&d.length){var v={noCleanupDates:!0,cleanupGaps:t.fillGaps};if(o)for(var x=0;x<o.length;x++)v.field=o[x],e.doCleanupGaps(d,a,v);else v.field=s,e.doCleanupGaps(d,a,v)}for(var C=0;C<r.length;C++)(!r[C].endPoints.end||r[C].endPoints.end<=n[s].DT)&&(r[C].lastQuote=n[s],r[C].endPoints.end=n[s].DT);e.setMasterData(d,a,{noCleanupDates:!0})}function S(t,e){if(o&&o.length)if("*"==o[0])L.extend(t,e);else for(var i=0;i<o.length;i++)t[o[i]]=e[o[i]];else if(l){if(void 0!==e.Value)return void(t[s]=e.Value);t[s]="aggregate"==l?function(t,e){if(!t||"object"!=typeof t)return t=e;var i={Close:t.Close,High:t.High,Low:t.Low,Open:t.Open,Volume:t.Volume};for(var a in t=e,i)null===t.Close?void 0!==t[a]&&(t[a]=null):"number"!=typeof t[a]?t[a]=i[a]:"number"==typeof i[a]&&("Open"==a?t.Open=i.Open:"Low"==a&&t.Low>i.Low?t.Low=i.Low:"High"==a&&t.High<i.High?t.High=i.High:"Volume"==a&&(t.Volume+=i.Volume));return t}(t[s],e):e;var a=t[s];if("number"==typeof a.Close){"number"!=typeof a.Open&&(a.Open=a.Close);var r=Math.max(a.Open,a.Close),n=Math.min(a.Open,a.Close);("number"!=typeof a.High||a.High<r)&&(a.High=r),("number"!=typeof a.Low||a.Low>n)&&(a.Low=n)}a.Volume&&"number"!=typeof a.Volume&&(a.Volume=parseInt(a.Volume,10))}else h?t[s]=e[h]:f&&g&&void 0!==e[g]?t[s]=e[g]:m.adj&&void 0!==e.Adj_Close?t[s]=e.Adj_Close:void 0!==e.Close?t[s]=e.Close:void 0!==e.Value?t[s]=e.Value:t[s]=e[s]}function b(t){var e=u,i=d.length-1;if(d[i].DT<t)u=i+1;else if(+d[i].DT!=+t){u++;for(var a=0;++a<100;){switch(+d[u].DT==+t?0:d[u].DT<t?1:d[u-1].DT>t?-1:(+d[u-1].DT==+t&&u--,0)){case 0:return;case 1:e=u;break;case-1:i=u}u=Math.round((i+e)/2)}100<=a&&(console.log("!!!Warning: addMemberToMasterdata() did not find insertion point."),u=d.length-1)}else u=i}},L.ThemeHelper=function(t){var e=(this.params=t).stx,i="#FFFFFF";e.chart.container&&(i=getComputedStyle(e.chart.container).backgroundColor,L.isTransparent(i)&&(i=e.containerColor)),this.settings.chart.Background.color=L.hexToRgba(i),this.settings.chart["Grid Lines"].color=L.hexToRgba(e.canvasStyle("stx_grid").color),this.settings.chart["Grid Dividers"].color=L.hexToRgba(e.canvasStyle("stx_grid_dark").color),this.settings.chart["Axis Text"].color=L.hexToRgba(e.canvasStyle("stx_xaxis").color),this.settings.chartTypes["Candle/Bar"].up.color=L.hexToRgba(e.canvasStyle("stx_candle_up").color),this.settings.chartTypes["Candle/Bar"].down.color=L.hexToRgba(e.canvasStyle("stx_candle_down").color),this.settings.chartTypes["Candle/Bar"].up.wick=L.hexToRgba(e.canvasStyle("stx_candle_shadow_up").color),this.settings.chartTypes["Candle/Bar"].down.wick=L.hexToRgba(e.canvasStyle("stx_candle_shadow_down").color),this.settings.chartTypes["Candle/Bar"].even.wick=L.hexToRgba(e.canvasStyle("stx_candle_shadow_even").color),this.settings.chartTypes["Candle/Bar"].up.border=L.hexToRgba(e.canvasStyle("stx_candle_up").borderLeftColor),this.settings.chartTypes["Candle/Bar"].down.border=L.hexToRgba(e.canvasStyle("stx_candle_down").borderLeftColor),L.isTransparent(e.canvasStyle("stx_candle_up").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].up.border=null),L.isTransparent(e.canvasStyle("stx_candle_down").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].down.border=null),this.settings.chartTypes.Line.color=L.hexToRgba(e.canvasStyle("stx_line_chart").color),this.settings.chartTypes.Mountain.color=L.hexToRgba(e.canvasStyle("stx_mountain_chart").backgroundColor)},L.ThemeHelper.prototype.settings={chart:{Background:{color:null},"Grid Lines":{color:null},"Grid Dividers":{color:null},"Axis Text":{color:null}},chartTypes:{"Candle/Bar":{up:{color:null,wick:null,border:null},down:{color:null,wick:null,border:null},even:{color:null,wick:null,border:null}},Line:{color:null},Mountain:{color:null}}},L.ThemeHelper.prototype.update=function(n){n||(n=this.params.stx);var s={stx_candle_up:{stx_candle_up:!0,stx_bar_up:!0,stx_hollow_candle_up:!0,stx_line_up:!0,stx_baseline_up:!0},stx_candle_down:{stx_candle_down:!0,stx_bar_down:!0,stx_hollow_candle_down:!0,stx_line_down:!0,stx_baseline_down:!0},stx_shadow_up:{stx_candle_shadow_up:!0},stx_shadow_down:{stx_candle_shadow_down:!0},stx_shadow_even:{stx_candle_shadow_even:!0},stx_line_chart:{stx_bar_chart:!0,stx_line_chart:!0},stx_grid:{stx_grid:!0},stx_grid_dark:{stx_grid_dark:!0},stx_xaxis:{stx_xaxis_dark:!0,stx_xaxis:!0,stx_yaxis:!0,stx_yaxis_dark:!0,stx_grid_border:!0},stx_mountain_chart:{stx_mountain_chart:!0},stx_market_session:{stx_market_session:!0}};function t(t,e,i){var a=s[t];for(var r in a)n.setStyle(r,e,i)}n.chart.container.style.backgroundColor=this.settings.chart.Background.color,t("stx_grid","color",this.settings.chart["Grid Lines"].color),t("stx_grid_dark","color",this.settings.chart["Grid Dividers"].color),t("stx_xaxis","color",this.settings.chart["Axis Text"].color);var e=this.settings.chartTypes["Candle/Bar"];e.even||(e.even={color:null,wick:L.hexToRgba(n.canvasStyle("stx_candle_shadow_even").color),border:null}),t("stx_candle_up","color",e.up.color),t("stx_candle_down","color",e.down.color),t("stx_shadow_up","color",e.up.wick),t("stx_shadow_down","color",e.down.wick),t("stx_shadow_even","color",e.even.wick),n.setStyle("stx_candle_up","borderLeftColor",e.up.border),n.setStyle("stx_candle_down","borderLeftColor",e.down.border),t("stx_line_chart","color",this.settings.chartTypes.Line.color),n.setStyle("stx_mountain_chart","borderTopColor",this.settings.chartTypes.Mountain.color),n.setStyle("stx_mountain_chart","backgroundColor",L.hexToRgba(this.settings.chartTypes.Mountain.color,.8)),n.setStyle("stx_mountain_chart","color",L.hexToRgba(this.settings.chartTypes.Mountain.color,.1)),n.draw()},L.NameValueStore=function(){},L.NameValueStore.prototype.toJSONIfNecessary=function(e){if(e.constructor==String)return e;try{return JSON.stringify(e)}catch(t){return console.log("Cannot convert to JSON: "+e),null}},L.NameValueStore.prototype.fromJSONIfNecessary=function(e){try{return JSON.parse(e)}catch(t){return e}},L.NameValueStore.prototype.get=function(t,e){var i=L.localStorage.getItem(t);e&&e(null,this.fromJSONIfNecessary(i))},L.NameValueStore.prototype.set=function(t,e,i){L.localStorageSetItem(t,this.toJSONIfNecessary(e)),i&&i(null)},L.NameValueStore.prototype.remove=function(t,e){L.localStorage.removeItem(t),e&&e(null)},L.Plotter=function(){this.seriesArray=[],this.seriesMap={}},L.extend(L.Plotter.prototype,{Series:function(t,e,i,a,r,n){this.name=t,this.strokeOrFill=e,this.color=i,this.moves=[],this.text=[],(!a||1<a||a<0)&&(a=1),this.opacity=a,(!r||25<r||r<1)&&(r=1),this.width=r,this.pattern=L.borderPatternToArray(r,n)},newSeries:function(t,e,i,a,r){var n;n=i.constructor==String?new this.Series(t,e,i,a,r):new this.Series(t,e,i.color,i.opacity,r,i.borderTopStyle),this.seriesArray.push(n),this.seriesMap[t]=n},reset:function(t){for(var e in this.seriesMap)if(!t||t==e){var i=this.seriesMap[e];i&&(i.moves=[],i.text=[])}},moveTo:function(t,e,i){this.seriesMap[t].moves.push({action:"moveTo",x:e,y:i})},lineTo:function(t,e,i){var a=this.seriesMap[t],r=a.pattern;a.moves.push({action:"lineTo",x:e,y:i,pattern:r})},dashedLineTo:function(t,e,i,a){this.seriesMap[t].moves.push({action:"lineTo",x:e,y:i,pattern:a})},quadraticCurveTo:function(t,e,i,a,r){var n=this.seriesMap[t],s=n.pattern;n.moves.push({action:"quadraticCurveTo",x0:e,y0:i,x:a,y:r,pattern:s})},bezierCurveTo:function(t,e,i,a,r,n,s){var o=this.seriesMap[t],l=o.pattern;o.moves.push({action:"bezierCurveTo",x0:e,y0:i,x1:a,y1:r,x:n,y:s,pattern:l})},addText:function(t,e,i,a,r,n,s){this.seriesMap[t].text.push({text:e,x:i,y:a,bg:r})},drawText:function(t,e){for(var i=0;i<e.text.length;i++){var a=e.text[i];if(a.bg){var r=a.width?a.width:t.measureText(a.text).width,n=a.height?a.height:12,s=t.fillStyle;t.fillStyle=a.bg,"right"==t.textAlign?t.fillRect(a.x,a.y-n/2,-r,-n):t.fillRect(a.x,a.y-n/2,r,n),t.fillStyle=s}t.fillText(a.text,a.x,a.y)}},draw:function(t,e){for(var i=t.lineWidth,a=t.fillStyle,r=t.strokeStyle,n=t.globalAlpha,s=0;s<this.seriesArray.length;s++){var o=this.seriesArray[s];if(!e||o.name==e){t.beginPath(),t.lineWidth=o.width,t.globalAlpha=o.opacity,t.fillStyle=o.color,t.strokeStyle=o.color,t.save();for(var l=0;l<o.moves.length;l++){var h=o.moves[l];h.pattern?(t.setLineDash(h.pattern),t.lineDashOffset=0):t.setLineDash([]),"quadraticCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x,h.y):"bezierCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x1,h.y1,h.x,h.y):t[h.action](h.x,h.y)}"fill"==o.strokeOrFill?t.fill():t.stroke(),t.closePath(),t.restore(),this.drawText(t,o),t.lineWidth=1}}t.lineWidth=i,t.fillStyle=a,t.strokeStyle=r,t.globalAlpha=n}},!0),L.EaseMachine=function(t,e,i,a){this.fc=t,this.ms=e,(i||0===i)&&this.reset(i,a)},L.EaseMachine.prototype.reset=function(t,e){for(var i in t||0===t||(t=this.currentValues),this.hasCompleted=!1,this.running=!1,this.okayToRun=!0,this.useNameValuePairs="object"==typeof e,this.startTime=Date.now(),this.useNameValuePairs?(this.startValues=t,this.endValues=e):(this.startValues={default:t},this.endValues={default:e}),this.changeValues={},this.currentValues={},this.startValues)this.changeValues[i]=this.endValues[i]-this.startValues[i]},L.EaseMachine.prototype.next=function(){var t=Date.now();for(var e in t>=this.startTime+this.ms&&(t=this.startTime+this.ms,this.hasCompleted=!0,this.running=!1),this.currentValues={},this.changeValues)this.currentValues[e]=this.fc(t-this.startTime,this.startValues[e],this.changeValues[e],this.ms);return this.useNameValuePairs?this.currentValues:this.currentValues.default},L.EaseMachine.prototype.hasCompleted=!0,L.EaseMachine.prototype.run=function(e,t,i,a){this.afid&&cancelAnimationFrame(this.afid),t||0===t?this.reset(t,i):(i||0===i)&&this.reset(this.currentValues,i);var r=this;function n(){if(r.afid=null,r.okayToRun){var t=r.next();e(t),r.hasCompleted||(r.afid=requestAnimationFrame(n))}}this.running=!0,a?this.afid=requestAnimationFrame(n):n()},L.EaseMachine.prototype.stop=function(){return this.afid&&cancelAnimationFrame(this.afid),this.afid=null,this.okayToRun=!1,this.running=!1,void 0===this.useNameValuePairs?{}:this.useNameValuePairs?this.currentValues:this.currentValues.default},L.Renderer=function(){},L.Renderer.produce=function(t,e){var i=null;if(t)for(var a in L.Renderer){var r=L.Renderer[a];if(r.requestNew&&(i=r.requestNew(t.split("_"),e)),i)return i}return e.type="line",new L.Renderer.Lines({params:e})},L.Renderer.colorFunctions={},L.Renderer.registerColorFunction=function(t,e){L.Renderer.colorFunctions[t]=e},L.Renderer.unregisterColorFunction=function(t){delete L.Renderer.colorFunctions[t]},L.Renderer.prototype.performCalculations=function(){},L.Renderer.prototype.adjustYAxis=function(){},L.Renderer.prototype.draw=function(){},L.Renderer.prototype.drawIndividualSeries=function(t,e){},L.Renderer.prototype.construct=function(t){t||(t={});var e=t.params?t.params:{};e.name||(e.name=L.uniqueID()),e.heightPercentage||(e.heightPercentage=.7),e.opacity||(e.opacity=1),!1!==e.highlightable&&(e.highlightable=!0),e.panel||(e.panel="chart"),this.cb=t.callback,this.params=e,this.seriesParams=[],this.caches={},this.colors={}},L.Renderer.prototype.attachSeries=function(t,e){var i=this.stx;if(!i)return this;var a=this.stx.chart.series[t];a||(a={parameters:{}});var r=this.params,n=(a.parameters,{id:t,chartType:r.type,display:a.parameters.display,border_color_up:r.defaultBorders?"auto":null,fill_color_up:a.parameters.color,opacity_up:r.opacity,border_color_down:r.defaultBorders?"auto":null,fill_color_down:a.parameters.color,opacity_down:r.opacity,color:a.parameters.color,symbol:a.parameters.symbol,symbolObject:L.clone(a.parameters.symbolObject)});if("string"==typeof e)n.color=n.fill_color_down=n.fill_color_up=e;else if("object"==typeof e){for(var s in e)n[s]=e[s];var o=n.color,l=n.border_color;o&&(n.fill_color_up||(n.fill_color_up=o),n.fill_color_down||(n.fill_color_down=o),n.fill_color_even||(n.fill_color_even=o)),l&&(n.border_color_up||(n.border_color_up=l),n.border_color_down||(n.border_color_down=l),n.border_color_even||(n.border_color_even=l))}n.symbol&&n.field!=n.symbol&&(n.subField=n.field,n.field=n.symbol),n.symbol||n.field||this.highLowBars||(n.field="Close"),n.id||(n.id=L.uniqueID());for(var h=0;h<this.seriesParams.length;++h)if(this.seriesParams[h].id===n.id){this.removeSeries(n.id,!0);break}return this.seriesParams.splice(h,0,n),n.fill_color_up!=n.fill_color_down?(this.colors[t+" up"]={color:n.fill_color_up,opacity:n.opacity_up,display:n.display?n.display+" up":t+" up"},this.colors[t+" dn"]={color:n.fill_color_down,opacity:n.opacity_down,display:n.display?n.display+" down":t+" down"}):this.colors[t]={color:n.fill_color_up,opacity:n.opacity_up,display:n.display?n.display:t},r.yAxis&&(r.yAxis=i.addYAxis(i.panels[r.panel],r.yAxis),r.yAxis.needsInitialPadding=!0),this},L.Renderer.prototype.removeSeries=function(t,e){for(var i=0;i<this.seriesParams.length;i++)if(this.seriesParams[i].id==t){this.seriesParams.splice(i,1);break}if(delete this.colors[t+" up"],delete this.colors[t+" dn"],delete this.colors[t],!e){var a=!1;for(var r in this.stx.chart.seriesRenderers){for(var n=this.stx.chart.seriesRenderers[r],s=0;s<n.seriesParams.length;s++)if(n.seriesParams[s].id==t){a=!0;break}if(a)break}a||this.stx.deleteSeries(t,this.stx.chart)}return this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},L.Renderer.prototype.removeAllSeries=function(t){if(t){for(var e=[],i=0;i<this.seriesParams.length;i++)e.push(this.seriesParams[i].id);for(var a=0;a<e.length;a++)this.removeSeries(e[a])}return this.seriesParams=[],this.colors={},this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},L.Renderer.prototype.ready=function(){return this.stx.createDataSet(),this.stx.draw(),this},L.Renderer.Lines=function(t){this.construct(t);var e=this.params;if(e.type||(e.type="line"),!e.style)switch(e.type){case"mountain":e.baseline?e.style="stx_baseline_delta_mountain":e.colored?e.style="stx_colored_mountain_chart":e.style="stx_mountain_chart";break;default:e.style="stx_line_chart"}this.supportsAnimation=!0,"wave"==e.type?(e.step=e.vertex=e.baseline=e.colored=!1,this.highLowBars=this.barsHaveWidth=!0,this.supportsAnimation=!1):"step"==e.type&&(e.step=!0)},L.Renderer.Lines.ciqInheritsFrom(L.Renderer,!1),L.Renderer.Lines.requestNew=function(t,e){for(var i=null,a=e.step,r=e.colored,n=e.baseline,s=e.vertex,o=0;o<t.length;o++){var l=t[o];switch(l){case"line":case"mountain":case"wave":i=l;break;case"baseline":n=!0;break;case"colored":r=!0;break;case"step":a=!0;break;case"vertex":s=!0;break;case"delta":break;default:return null}}return null!==i||n||a?new L.Renderer.Lines({params:L.extend(e,{type:i,step:a,colored:r,baseline:n,vertex:s})}):null},L.Renderer.Lines.prototype.draw=function(){var t,e=this.stx,i=this.stx.panels[this.params.panel].chart,a={},r=this.seriesParams,n=this.params.colorFunction;function s(t){var a=t.fill_color_up||e.getCanvasColor("stx_line_up"),r=t.fill_color_down||e.getCanvasColor("stx_line_down"),n=t.color||e.getCanvasColor("stx_line_chart");return function(t,e,i){return e.iqPrevClose||0===e.iqPrevClose?e.Close>e.iqPrevClose?a:e.Close<e.iqPrevClose?r:n:n}}for(this.params.vertex&&!e.scatter&&(console.warn("Error, vertex option requires customChart.js"),this.params.vertex=!1),t=0;t<r.length;t++){var o=r[t];if(this.params.colored){for(var l=["_color_up","_color_down","_color"],h=0;h<l.length;h++){var c=o["border"+l[h]];c&&"auto"!=c&&(o["fill"+l[h]]=c)}n||(n=s(o)),this.params.colorFunction=n}var u={};i.series[o.id]&&(u=L.clone(i.series[o.id].parameters)),a[o.id]={parameters:L.extend(L.extend(u,this.params),o),yValueCache:this.caches[o.id]},this==e.mainSeriesRenderer&&i.customChart&&i.customChart.colorFunction&&(a[o.id].parameters.colorFunction=i.customChart.colorFunction)}for(t in e.drawSeries(i,a,this.params.yAxis,this),a)this.caches[t]=a[t].yValueCache},L.Renderer.Lines.prototype.drawIndividualSeries=function(t,e){if(!e.invalid){var i=this.stx,a=t.context,r=null,n=e.colorFunction,s=i.panels[e.panel]||t.panel;if("string"!=typeof n||(n=L.Renderer.colorFunctions[n]))return e.vertex&&(a.save(),a.lineJoin="bevel"),r="wave"==e.type?i.drawWaveChart(s,e):e.baseline?i.drawBaselineChart(s,e):"mountain"==e.type?(e.returnObject=!0,i.drawMountainChart(s,e,n)):(e.returnObject=!0,i.drawLineChart(s,e.style,n,e)),e.vertex&&(i.scatter(s,{yAxis:e.yAxis,field:e.symbol||e.field,subField:e.subField,symbol:e.symbol,color:e.vertex_color,overlayScaling:e.overlayScaling}),a.restore()),r}},L.Renderer.OHLC=function(t){this.construct(t);var e=this.params;e.type||(e.type="candle"),this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.histogram&&(e.type="candle",this.highLowBars=!1,e.volume=e.hollow=!1),"bar"==e.type&&(e.volume=e.hollow=e.histogram=!1),"candle"==e.type&&(e.hlc=e.colored=!1),e.volume&&(e.hollow=!0)},L.Renderer.OHLC.ciqInheritsFrom(L.Renderer,!1),L.Renderer.OHLC.requestNew=function(t,e){for(var i=null,a=e.hlc,r=e.colored,n=e.hollow,s=e.volume,o=e.histogram,l=0;l<t.length;l++){var h=t[l];switch(h){case"bar":case"candle":i=h;break;case"volume":s=!0;break;case"hollow":n=!0;break;case"colored":r=!0;break;case"histogram":o=!0,i="candle";break;case"hlc":a=!0,i="bar";break;default:return null}}return null===i?null:new L.Renderer.OHLC({params:L.extend(e,{type:i,hlc:a,colored:r,hollow:n,volume:s,histogram:o})})},L.Renderer.OHLC.prototype.draw=function(){var t,e=this.stx,i=this.stx.panels[this.params.panel].chart,a={},r=this.seriesParams;for(t=0;t<r.length;t++){var n=r[t],s={};i.series[n.id]&&(s=L.clone(i.series[n.id].parameters)),a[n.id]={parameters:L.extend(L.extend(s,this.params),n)},this==e.mainSeriesRenderer&&i.customChart&&i.customChart.colorFunction&&(a[n.id].parameters.colorFunction=i.customChart.colorFunction)}for(t in e.drawSeries(i,a,this.params.yAxis,this),a)a[t].yValueCache&&(this.caches[t]=a[t].yValueCache)},L.Renderer.OHLC.prototype.getColor=function(t,e,i,a,r,n){var s=n||i.color;if(a&&!(s=n||i.borderLeftColor||i["border-left-color"]))return null;if(!r)return s;var o=t.pixelFromTransformedValue(e.chart.highValue,e);isNaN(o)&&(o=0);var l=i.backgroundColor;if(!s||L.isTransparent(s))return l;var h=t.chart.context.createLinearGradient(0,o,0,2*e.yAxis.bottom-o);return h.addColorStop(0,s),h.addColorStop(1,l),h},L.Renderer.OHLC.prototype.drawIndividualSeries=function(t,e){if(!e.invalid){var i=this.stx,a=(t.context,e.colorFunction),r=i.panels[e.panel]||t.panel;if("string"!=typeof a||(a=L.Renderer.colorFunctions[a])){var n=i.layout.candleWidth-t.tmpWidth<=2&&t.tmpWidth<=3;t.state.chartType||(t.state.chartType={});var s=t.state.chartType.pass={},o=i.colorByCandleDirection;e.colorBasis&&(o="open"==e.colorBasis);var l=e.histogram,h=e.type,c=e.hollow,u=i.noWicksOnCandles[h];i.startClip(r.name);var p=null,d={colors:[],cache:[]},m=[];if(a){var g={isHistogram:l,field:e.field,yAxis:e.yAxis,volume:e.volume,overlayScaling:e.overlayScaling,highlight:e.highlight};l||"bar"!=h?("candle"!=h||u||i.drawShadows(r,a,g),d=i.drawCandles(r,a,g),g.isOutline=!0,!c&&n||i.drawCandles(r,a,g)):(g.type=e.hlc?"hlc":"bar",d=i.drawBarChart(r,"stx_bar_chart",a,g))}else for(var f=l&&!1!==e.gradient,y=[{type:"histogram",drawType:"histogram",style:"stx_histogram_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_even",condition:32,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0,useBorderStyleProp:!0},{type:"bar",drawType:"bar",style:e.style||"stx_bar_chart",border:"border_color",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_up",condition:o?8:1,border:"border_color_up",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_down",condition:o?16:2,border:"border_color_down",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_even",condition:o?32:4,border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"candle",drawType:"shadow",style:"stx_candle_shadow",border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_up",condition:8,border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_down",condition:16,border:"border_color_down"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_even",condition:32,border:"border_color_even",skipIfPass:!0},{type:"candle",drawType:"candle",style:"stx_candle_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"candle",drawType:"candle",style:"stx_candle_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_up",condition:1,border:"border_color_up"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_down",condition:2,border:"border_color_down"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_even",condition:4,border:"border_color_even",skipIfPass:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:17,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:18,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:20,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:9,fill:"fill_color_up",border:"border_color_up"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:10,fill:"fill_color_down",border:"border_color_down"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:12,fill:"fill_color_even",border:"border_color_even"}],v=0;v<y.length;v++){var x=y[v];if(!x.skipIfPass||s.even){if(l){if("histogram"!=x.type)continue}else if("bar"==h){if("bar"!=x.type)continue;if(e.colored&&!x.condition)continue;if(!e.colored&&x.condition)continue}else if(c){if("hollow"!=x.type)continue;if("shadow"==x.drawType&&u)continue}else{if("candle"!=h)continue;if("candle"!=x.type)continue;if("shadow"==x.drawType){if(u)continue;var C=e.border_color_up||i.getCanvasColor("stx_candle_shadow_up"),S=e.border_color_down||i.getCanvasColor("stx_candle_shadow_down"),b=e.border_color_even||i.getCanvasColor("stx_candle_shadow_even");if(L.colorsEqual(C,S)&&L.colorsEqual(C,b)&&L.colorsEqual(C,i.defaultColor)){if(x.condition)continue}else if(!x.condition)continue}}var w=i.canvasStyle(x.style),T=this.getColor(i,r,w,!1,!1,e[x.fill]),D=this.getColor(i,r,w,!1,f,e[x.fill]),A=this.getColor(i,r,w,x.useBorderStyleProp&&!n,f,e[x.border]);"candle"==x.drawType&&("hollow"==x.type?(!L.isTransparent(D)&&L.colorsEqual(A,D)&&(A=x.useColorInMap?"transparent":D),x.useColorInMap||(D=i.containerColor)):"candle"==x.type&&n&&(L.isTransparent(D)?D=A:A=D)),m.push(i.drawBarTypeChartInner({fillColor:D,borderColor:A,condition:x.condition,style:x.style,type:e.hlc?"hlc":x.drawType,panel:r,field:e.field,yAxis:e.yAxis,volume:e.volume,overlayScaling:e.overlayScaling,highlight:e.highlight})),p||(p={}),x.useColorInMap&&(p[T]=1)}}for(var M in i.endClip(),p)e.hollow&&L.equals(M,i.containerColor)||d.colors.push(M);for(M=0;M<m.length;M++)for(var k=0;k<m[M].cache.length;k++){var F=m[M].cache[k];(F||0===F)&&(d.cache[k]=F)}return d}}},L.Renderer.Bars=function(t){this.construct(t);var e=this.params;e.type="bar",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.volume=e.hollow=e.histogram=!1},L.Renderer.Bars.ciqInheritsFrom(L.Renderer.OHLC,!1),L.Renderer.HLC=function(t){this.construct(t);var e=this.params;e.type="bar",e.hlc=!0,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.volume=e.hollow=e.histogram=!1},L.Renderer.HLC.ciqInheritsFrom(L.Renderer.Bars,!1),L.Renderer.Candles=function(t){this.construct(t);var e=this.params;e.type="candle",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.colored=e.histogram=!1,e.volume&&(e.hollow=!0)},L.Renderer.Candles.ciqInheritsFrom(L.Renderer.OHLC,!1),L.Renderer.SimpleHistogram=function(t){this.construct(t);var e=this.params;e.type="candle",e.histogram=!0,this.barsHaveWidth=this.standaloneBars=!0,this.highLowBars=!1,e.hlc=e.colored=e.hollow=e.volume=!1},L.Renderer.SimpleHistogram.ciqInheritsFrom(L.Renderer.Candles,!1)}(t),function(t){t||(t={});var a=t.CIQ,e=t.timezoneJS;a||(a=function(){},t.CIQ=a);var n=864e5;a.Market=function(t){this.market_def=!1,this.rules=!1,this.normalHours=[],this.extraHours=[],this.class_name="Market",this.tz_lib=void 0===e?Date:e.Date,this.market_tz="",this.hour_aligned=!1,this.convertOnDaily=!1,this.enabled_by_default=!1,void 0!==t&&t&&t!={}&&(t.market_definition&&(t=t.market_definition),t.rules&&(this.rules=t.rules),t.market_tz&&(this.market_tz=t.market_tz),t.convertOnDaily&&(this.convertOnDaily=t.convertOnDaily),t.hour_aligned,this.hour_aligned=t.hour_aligned,void 0!==t.enabled_by_default&&t.enabled_by_default instanceof Array&&(this.enabled_by_default=t.enabled_by_default),this.market_def=t,void 0===this.market_def.name&&(this.market_def.name="no market name specified"),a.Market._createTimeSegments(this),this.getSessionNames())},a.Market.prototype.sessions=null,a.Market.GLOBEX={name:"GLOBEX",market_tz:"America/Chicago",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"18:00"}]},a.Market.FOREX={name:"FOREX",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:00"},{dayofweek:1,open:"17:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:00"},{dayofweek:2,open:"17:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:00"},{dayofweek:3,open:"17:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:00"},{dayofweek:4,open:"17:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:00"}]},a.Market.METALS={name:"METALS",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"18:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:15"},{dayofweek:1,open:"18:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:15"},{dayofweek:2,open:"18:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:15"},{dayofweek:3,open:"18:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:15"},{dayofweek:4,open:"18:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:15"}]},a.Market.NYSE={name:"NYSE",market_tz:"America/New_York",hour_aligned:!1,rules:[{dayofweek:1,open:"09:30",close:"16:00"},{dayofweek:2,open:"09:30",close:"16:00"},{dayofweek:3,open:"09:30",close:"16:00"},{dayofweek:4,open:"09:30",close:"16:00"},{dayofweek:5,open:"09:30",close:"16:00"},{dayofweek:1,open:"04:00",close:"09:30",name:"pre"},{dayofweek:2,open:"04:00",close:"09:30",name:"pre"},{dayofweek:3,open:"04:00",close:"09:30",name:"pre"},{dayofweek:4,open:"04:00",close:"09:30",name:"pre"},{dayofweek:5,open:"04:00",close:"09:30",name:"pre"},{dayofweek:1,open:"16:00",close:"20:00",name:"post"},{dayofweek:2,open:"16:00",close:"20:00",name:"post"},{dayofweek:3,open:"16:00",close:"20:00",name:"post"},{dayofweek:4,open:"16:00",close:"20:00",name:"post"},{dayofweek:5,open:"16:00",close:"20:00",name:"post"},{date:"*-12-25",open:"00:00",close:"00:00"},{date:"*-07-04",open:"00:00",close:"00:00"},{date:"*-01-01",open:"00:00",close:"00:00"},{date:"2012-01-02",open:"00:00",close:"00:00"},{date:"2018-01-15"},{date:"2018-02-19"},{date:"2018-03-30"},{date:"2018-05-28"},{date:"2018-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2018-07-03",open:"9:30",close:"13:00"},{date:"2018-09-03"},{date:"2018-11-22"},{date:"2018-11-23",open:"4:00",close:"9:30",name:"pre"},{date:"2018-11-23",open:"9:30",close:"13:00"},{date:"2018-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2018-12-24",open:"9:30",close:"13:00"},{date:"2017-01-02"},{date:"2017-01-16"},{date:"2017-02-20"},{date:"2017-04-14"},{date:"2017-05-29"},{date:"2017-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2017-07-03",open:"9:30",close:"13:00"},{date:"2017-09-04"},{date:"2017-11-23"},{date:"2017-11-24",open:"4:00",close:"9:30",name:"pre"},{date:"2017-11-24",open:"9:30",close:"13:00"},{date:"2016-01-18"},{date:"2016-02-15"},{date:"2016-03-25"},{date:"2016-05-30"},{date:"2016-09-05"},{date:"2016-11-24"},{date:"2016-11-25",open:"4:00",close:"9:30",name:"pre"},{date:"2016-11-25",open:"9:30",close:"13:00"},{date:"2016-12-26"},{date:"2015-01-19"},{date:"2015-02-16"},{date:"2015-04-03"},{date:"2015-05-25"},{date:"2015-07-03"},{date:"2015-09-07"},{date:"2015-11-26"},{date:"2015-11-27",open:"4:00",close:"9:30",name:"pre"},{date:"2015-11-27",open:"9:30",close:"13:00"},{date:"2015-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2015-12-24",open:"9:30",close:"13:00"},{date:"2014-01-20"},{date:"2014-02-17"},{date:"2014-04-18"},{date:"2014-05-26"},{date:"2014-09-01"},{date:"2014-11-27"},{date:"2014-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2014-07-03",open:"9:30",close:"13:00"},{date:"2014-11-28",open:"4:00",close:"9:30",name:"pre"},{date:"2014-11-28",open:"9:30",close:"13:00"},{date:"2014-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2014-12-24",open:"9:30",close:"13:00"},{date:"2013-01-21"},{date:"2013-02-18"},{date:"2013-03-29"},{date:"2013-05-27"},{date:"2013-09-02"},{date:"2013-11-28"},{date:"2013-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2013-07-03",open:"9:30",close:"13:00"},{date:"2013-11-29",open:"4:00",close:"9:30",name:"pre"},{date:"2013-11-29",open:"9:30",close:"13:00"},{date:"2013-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2013-12-24",open:"9:30",close:"13:00"},{date:"2012-01-16"},{date:"2012-02-20"},{date:"2012-04-06"},{date:"2012-05-28"},{date:"2012-09-03"},{date:"2012-10-29"},{date:"2012-10-30"},{date:"2012-11-22"},{date:"2012-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2012-07-03",open:"9:30",close:"13:00"},{date:"2012-11-23",open:"4:00",close:"9:30",name:"pre"},{date:"2012-11-23",open:"9:30",close:"13:00"},{date:"2012-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2012-12-24",open:"9:30",close:"13:00"}]},a.Market.LSE={name:"London",market_tz:"Europe/London",hour_aligned:!1,rules:[{dayofweek:1,open:"08:00",close:"17:00"},{dayofweek:2,open:"08:00",close:"17:00"},{dayofweek:3,open:"08:00",close:"17:00"},{dayofweek:4,open:"08:00",close:"17:00"},{dayofweek:5,open:"08:00",close:"17:00"},{date:"*-12-25",open:"00:00",close:"00:00"},{date:"*-12-26",open:"00:00",close:"00:00"},{date:"*-01-01",open:"00:00",close:"00:00"},{date:"2012-01-02",open:"00:00",close:"00:00"},{date:"2018-03-30"},{date:"2018-04-02"},{date:"2018-05-07"},{date:"2018-05-28"},{date:"2018-08-27"},{date:"2018-12-24",open:"8:00",close:"12:30"},{date:"2018-12-31",open:"8:00",close:"12:30"},{date:"2017-01-02"},{date:"2017-04-14"},{date:"2017-04-17"},{date:"2017-05-01"},{date:"2017-05-29"},{date:"2017-08-28"},{date:"2017-12-22",open:"8:00",close:"12:30"},{date:"2017-12-29",open:"8:00",close:"12:30"},{date:"2016-03-25"},{date:"2016-03-28"},{date:"2016-05-02"},{date:"2016-05-30"},{date:"2016-08-29"},{date:"2016-12-23",open:"8:00",close:"12:30"},{date:"2016-12-27"},{date:"2016-12-30",open:"8:00",close:"12:30"},{date:"2015-04-03"},{date:"2015-04-06"},{date:"2015-05-04"},{date:"2015-05-25"},{date:"2015-08-31"},{date:"2015-12-24",open:"8:00",close:"12:30"},{date:"2015-12-28"},{date:"2015-12-31",open:"8:00",close:"12:30"},{date:"2014-04-18"},{date:"2014-04-21"},{date:"2014-05-05"},{date:"2014-05-26"},{date:"2014-08-25"},{date:"2014-12-24",open:"8:00",close:"12:30"},{date:"2014-12-31",open:"8:00",close:"12:30"},{date:"2013-03-29"},{date:"2013-04-01"},{date:"2013-05-06"},{date:"2013-05-27"},{date:"2013-08-26"},{date:"2013-12-24",open:"8:00",close:"12:30"},{date:"2013-12-31",open:"8:00",close:"12:30"},{date:"2012-01-02"},{date:"2012-04-06"},{date:"2012-04-09"},{date:"2012-05-07"},{date:"2012-06-04"},{date:"2012-06-05"},{date:"2012-08-27"},{date:"2012-12-24",open:"8:00",close:"12:30"},{date:"2012-12-31",open:"8:00",close:"12:30"}]},a.Market.Symbology=function(){},a.Market.Symbology.isForeignSymbol=function(t){return!!t&&-1!=t.indexOf(".")},a.Market.Symbology.isFuturesSymbol=function(t){return!!t&&0===t.indexOf("/")&&"/"!=t},a.Market.Symbology.isForexSymbol=function(t){return!(!t||a.Market.Symbology.isForeignSymbol(t)||a.Market.Symbology.isFuturesSymbol(t)||t.length<6||7<t.length||6==t.length&&"X"==t[5]||!/\^?[A-Za-z]{6}/.test(t))},a.Market.Symbology.isForexMetal=function(t,e){return!!t&&!!a.Market.Symbology.isForexSymbol(t)&&("^"!=t.charAt(0)&&(t="^"+t),-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(4,3)+",")||!e&&-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(1,3)+","))},a.Market.Symbology.isForexFuturesSymbol=function(t){return!!a.Market.Symbology.isForexSymbol(t)||!!a.Market.Symbology.isFuturesSymbol(t)},a.Market.Symbology.factory=function(t){var e=t.symbol;return a.Market.Symbology.isForeignSymbol(e)?null:a.Market.Symbology.isFuturesSymbol(e)?a.Market.GLOBEX:a.Market.Symbology.isForexMetal(e)?a.Market.METALS:a.Market.Symbology.isForexSymbol(e)?a.Market.FOREX:a.Market.NYSE},a.Market.prototype.getSessionNames=function(){if(this.rules){if(!this.sessions){var e=[],i=[];this.rules.map(function(t){t.name&&-1===e.indexOf(t.name)&&(e.push(t.name),i.push({name:t.name,enabled:!!t.enabled&&t.enabled}))}),this.sessions=i}}else this.sessions=[];return this.sessions.slice()},a.Market.prototype._find_next_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz});if(this._wasOpenIntraDay(i)){var r=this.zseg_match.close_parts.hours,n=this.zseg_match.close_parts.minutes;i.setHours(r),i.setMinutes(n),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})}return a.next()},a.Market.prototype._find_prev_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),r=this._wasOpenIntraDay(i);if(null===r?(i=new Date(i-6e4),r=this._wasOpenIntraDay(i)):(e&&i.getHours()===this.zseg_match.open_parts.hours&&i.getMinutes()===this.zseg_match.open_parts.minutes||!e&&i.getHours()===this.zseg_match.close_parts.hours&&i.getMinutes()===this.zseg_match.close_parts.minutes)&&(i=a.previous()),r){var n=this.zseg_match.open_parts.hours,s=this.zseg_match.open_parts.minutes;return i.setHours(n),i.setMinutes(s),i=(a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})).previous(),this.zseg_match.close_parts.hours===n&&this.zseg_match.close_parts.minutes===s?e?a.next():i:this.zseg_match.adjacent_child?i:e?a.next():i}return a.previous()},a.Market.prototype.disableSession=function(t,e){var i=!1;if(void 0!==e&&e&&(i=!0),t){for(var a=0;a<this.normalHours.length;a++)this.normalHours[a].name===t&&(this.normalHours[a].enabled=i);for(a=0;a<this.extraHours.length;a++)this.extraHours[a].name===t&&(this.extraHours[a].enabled=i)}},a.Market.prototype.enableSession=function(t){this.disableSession(t,"enable_instead")},a.Market.prototype.enableAllAvailableSessions=function(){for(var t=this.getSessionNames(),e=0;e<t.length;e++)this.enableSession(t[e].name)},a.Market.prototype.getClose=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name===e)return r.setHours(this.zseg_match.close_parts.hours,this.zseg_match.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var n=this.zseg_match;n.child_;)n=n.child_;for(;!n.enabled;)n=n.parent_;return r.setHours(n.close_parts.hours,n.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},a.Market.prototype.getNextClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),this._wasOpenIntraDay(a)||(a=this.newIterator({begin:a,interval:1,inZone:this.market_tz,outZone:this.market_tz}).next());for(var r=a.getDate(),n=this.zseg_match;n.adjacent_child;)n=n.adjacent_child,r+=1;return a.setDate(r),a.setHours(n.close_parts.hours,n.close_parts.minutes,0,0),a=this._convertFromMarketTZ(a,i)},a.Market.prototype.getNextOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_next_segment(a),this.zseg_match.adjacent_parent?a=this.getNextOpen(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes)),a=this._convertFromMarketTZ(a,i)},a.Market.prototype.getOpen=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name==e)return r.setHours(this.zseg_match.open_parts.hours,this.zseg_match.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var n=this.zseg_match;n.parent_;)n=n.parent_;for(;!n.enabled;)n=n.child_;return r.setHours(n.open_parts.hours,n.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},a.Market.prototype.getPreviousClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!1),this.zseg_match.adjacent_child?this.getPreviousClose(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.close_parts.hours),a.setMinutes(this.zseg_match.close_parts.minutes),a=this._convertFromMarketTZ(a,i))},a.Market.prototype.getPreviousOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!0),this.zseg_match.adjacent_parent?this.getPreviousOpen(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},a.Market.prototype.getSession=function(t,e){return t=this._convertToMarketTZ(t,e),this._wasOpenIntraDay(t)&&this.zseg_match?this.zseg_match.name:null},a.Market.prototype.marketZoneNow=function(){return this._convertToMarketTZ(new Date)},a.Market.prototype.isHourAligned=function(){return this.hour_aligned},a.Market.prototype.isOpen=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenIntraDay(t)},a.Market.prototype.isMarketDay=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenDaily(t)},a.Market.prototype.isMarketDate=function(t){return this._wasOpenDaily(t)},a.Market.prototype.newIterator=function(t){var e=!1;t.periodicity?e=t.periodicity:t.multiple&&(e=t.multiple);var i=t.interval;return i||(i="minute"),"hour"==i&&(i=60),e||(e=1),t.begin||(t.begin=new Date,t.inZone=null),i==parseInt(i,10)&&(i=parseInt(i,10),i=t.periodicity<1/60?(e=e*i*6e4,"millisecond"):t.periodicity<1?(e=e*i*60,"second"):(e*=i,"minute")),t.timeUnit&&("millisecond"===t.timeUnit?i=t.timeUnit:"second"===t.timeUnit&&(i=t.timeUnit)),t.interval=i,t.multiple=e,t.market=this,new a.Market.Iterator(t)},a.Market.prototype._wasOpenDaily=function(t){return this._was_open(t,!1)},a.Market.prototype._wasOpenIntraDay=function(t){return this._was_open(t,!0)},a.Market.prototype._was_open=function(t,e){if(this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null,!this.market_def||!this.rules)return this.zclose_hour=24,!0;var i,a,r=!1,n=!1,s=t.getFullYear(),o=t.getMonth()+1,l=t.getDay(),h=t.getDate(),c=60*t.getHours()*60+60*t.getMinutes()+t.getSeconds();for(void 0===e&&(e=!0),a=0;a<this.normalHours.length;a++)if((i=this.normalHours[a]).enabled&&((r=i.dayofweek===l)&&e&&(r=c>=i.open&&c<i.close),r)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=c===i.open,this.zseg_match=i,e)break}for(a=0;a<this.extraHours.length;a++)if((i=this.extraHours[a]).enabled&&("*"===i.year||s===i.year)&&o===i.month&&h===i.day&&(!(n=!e&&i.open||c>=i.open&&c<i.close)&&this.zseg_match&&(r=!1,this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null),n)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=c===i.open,this.zseg_match=i,e)break}return this.zseg_match},a.Market.prototype._wasClosed=function(t){return!this._was_open(t,!0)},a.Market.prototype._wasOpen=function(t){return this._was_open(t,!0)},a.Market.prototype._tzDifferenceMillis=function(t,e,i){var a=t;return 60*(t.getTimezoneOffset()-a.getTimezoneOffset())*1e3},a.Market._createTimeSegments=function(t){for(var i,e=function(t,e){if(24===t.close_parts.hours&&0===e.open_parts.hours&&0===e.open_parts.minutes){if(i.dayofweek===n.dayofweek-1)return!0;if(6===i.dayofweek&&0===n.dayofweek)return!0}return!1},a=0;a<t.rules.length;a++){var r=JSON.parse(JSON.stringify(t.rules[a]));void 0===r.open&&void 0===r.close&&(r.open="00:00",r.close="00:00"),r.hasOwnProperty("name")||(r.name="");try{var n;if(void 0!==r.dayofweek?(r.year="*",n=l._createDayOfWeekSegment(t,r),i&&(i.dayofweek===n.dayofweek?(i.child_=n).parent_=i:e(i,n)&&((i.adjacent_child=n).adjacent_parent=i)),i=n):void 0!==r.date?(r.isDayOfWeek=!1,r.dayofweek=-1,n=l._createDateTimeSegment(t,r)):console.log("Error, unknown rule type "+r),t.enabled_by_default)for(var s=0;s<t.enabled_by_default.length;s++){var o=t.enabled_by_default[s];if(n.name===o){n.enabled=!0;break}}}catch(t){console.log("Error, creating market rules "+t)}}},a.Market._timeSegment={};var l=a.Market._timeSegment;l.re_wild_card_iso=/^(\*)-(\d\d)-(\d\d)$/,l.re_regular_iso=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,l.re_split_hours_minutes=/^(\d\d):(\d\d)$/,l.re_split_hour_minutes=/^(\d):(\d\d)$/,l._hashCode=function(t){var e,i,a=0;if(0===t.length)return a;for(e=0,i=t.length;e<i;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return a},l._splitHoursMinutes=function(t){var e=l.re_split_hour_minutes.exec(t),i={hours:NaN,minutes:NaN};return null===e&&null===(e=l.re_split_hours_minutes.exec(t))||(i.hours=parseInt(e[1],10),i.minutes=parseInt(e[2],10)),i},l._createDayOfWeekSegment=function(t,e){var i={name:e.name,isDayOfWeek:!0,dayofweek:e.dayofweek,date_str:"*",open_parts:l._splitHoursMinutes(e.open),close_parts:l._splitHoursMinutes(e.close),open:l._secSinceMidnight(t,e.open,!0),close:l._secSinceMidnight(t,e.close,!1),child_:!1,parent_:!1,adjacent_child:!1,adjacent_parent:!1,enabled:!1};return""===i.name&&(i.enabled=!0),i.hash_code=this._hashCode((i.open+i.close).toString()),t.normalHours.push(i),i},l._createDateTimeSegment=function(t,e){var i,a=this.re_regular_iso.exec(e.date);if(null===a){if(null===(a=this.re_wild_card_iso.exec(e.date)))return void console.log("Warning: invalid date format on rule -> "+e.date);i="*"}else i=parseInt(a[1],10);var r={name:e.name,isDayOfWeek:!1,dayofweek:-1,year:i,month:parseInt(a[2],10),day:parseInt(a[3],10),date_str:e.date,open_parts:l._splitHoursMinutes(e.open),close_parts:l._splitHoursMinutes(e.close),open:l._secSinceMidnight(t,e.open,!0),close:l._secSinceMidnight(t,e.close,!1),enabled:!1};return""===r.name&&(r.enabled=!0),r.hash_key=this._hashCode(r.date_str+r.open+r.close),t.extraHours.push(r),r},l._secSinceMidnight=function(t,e,i){var a=e.split(":"),r=parseInt(a[0],10),n=60*r*60+60*parseInt(a[1],10);return i||24===r&&(n=60*r*60+1),n},a.Market.prototype._convertToMarketTZ=function(t,e){return this.market_tz?((i=e?new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e):new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())).setTimezone&&i.setTimezone(this.market_tz),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):t;var i},a.Market.prototype._convertFromMarketTZ=function(t,e){if(!this.market_tz)return t;var i=new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),this.market_tz);return e?(i.setTimezone&&i.setTimezone(e),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):new Date(i.getTime())},a.Market.Iterator=function(t){this.market=t.market,this.begin=t.begin,this.interval=t.interval,this.multiple=t.multiple,this.inZone=t.inZone,this.outZone=t.outZone,this.clock=new a.Market.Iterator._Clock(t.market,t.interval,t.multiple),this.intraDay=this.clock.intra_day,this.intraDay&&(this.begin=this.market._convertToMarketTZ(this.begin,t.inZone)),this.clock._setStart(this.begin),this.clock.minutes_aligned=!1},a.Market.Iterator.prototype.date=function(){return this.clock._date()},a.Market.Iterator.prototype.futureTick=function(t){this.clock.skip=1;var e,i=0;e=this.intraDay?this.market._convertToMarketTZ(t.end,this.inZone).getTime():t.end.getTime();var a=this.clock.ctime;if(e===a)return i;var r=2,n=0;t.sample_size&&(r=t.sample_size);var s,o=(new Date).getTime();if(a<e){for(this.clock.forward=!0;this.clock.ctime<e;)if(i+=1,n+=1,this.clock._findNext(),1e3===n&&(n=0,r<=(new Date).getTime()-o)){s=(this.clock.ctime-a)/i,i=Math.floor((e-a)/s);break}this.clock.ctime>e&&i--}else for(this.clock.forward=!1;this.clock.ctime>e;)if(i+=1,n+=1,this.clock._findPrevious(),1e3===n&&(n=0,r<=(new Date).getTime()-o)){s=(a-this.clock.ctime)/i,i=Math.floor((a-e)/s);break}return i},a.Market.Iterator.prototype.isHourAligned=function(){return!this.intraDay||this.market.isHourAligned()},a.Market.Iterator.prototype.isOpen=function(){return this.market.isOpen()},a.Market.Iterator.prototype.next=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!0;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findNext();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},a.Market.Iterator.prototype.peek=function(){return this.clock._peek()},a.Market.Iterator.prototype.previous=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!1;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findPrevious();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},a.Market.Iterator._Clock=function(t,e,i){i%60==0&&"second"===e&&(e="minute",i/=60),this.market=t,this.interval=e,this.multiple=i,this.intra_day=!1,this.intervals=[],this.max_iters=10080;var a=n,r=this._dayImpl;"millisecond"===e?(r=this._millisImpl,a=1):"second"===e?(r=this._secondImpl,a=1e3):"minute"===e?(r=this._minuteImpl,a=6e4):"hour"===e?(r=this._hourImpl,a=36e5):"day"===e?(r=this._dayImpl,a=n):"week"===e?(r=this._weekImpl,a=7*n):"month"===e?(r=this._monthImpl,a=2592e6):console.log('Periodicity ERROR: "'+e+'" is not a valid interval. Please see setPeriodicity() for details.'),this.tick_time=a*i,this.intra_day=this.tick_time<n,this._findPrevious=this._findNext=r};var i=a.Market.Iterator._Clock.prototype;i._total_minutes=function(t,e,i,a){return 60*(i-t)-e+a},i._alignMinutes=function(){if(void 0===this.market.zopen_minute)return[];var t=this.market.zopen_minute;this.market.isHourAligned()&&this.multiple%60==0&&(t=0);for(var e=this._total_minutes(this.market.zopen_hour,t,this.market.zclose_hour,this.market.zclose_minute),i=[],a=0;a<e;)i.push(t+a),a+=this.multiple;return i},i._alignBaseZero=function(t){for(var e=0,i=[e];!(t<=(e+=this.multiple));)i.push(e);return i},i._date=function(){var t=Math.round(this.ctime),e=new Date(t);return this.intra_day?this.display_date=new Date(t+this.shift_millis):this.display_date=e,e},i._alignToBoundary=function(t,e){for(var i=0,a=0,r=e,n=0;n<t.length-1&&(i=t[n],a=t[n+1],e!==i&&e!==a);n++){if(i<e&&e<a){r=i;break}n+1===t.length-1&&(r=a)}return r},i._peek=function(){return this._date().toString()},i._seekHr=function(){this.forward?this.ctime-=36e5:this.ctime+=36e5},i._setStart=function(t){var e=this.market._tzDifferenceMillis(t),i=new Date(t.getTime()+e);this.shift_millis=e,this.ctime=i.getTime(),this.shift_millis=0,this.ctime=t.getTime()},i._tickTock=function(){this.forward?this.ctime+=this.tick_time:this.ctime-=this.tick_time},i._tockTick=function(){this.forward?this.ctime-=this.tick_time:this.ctime+=this.tick_time},i._tickTock24=function(){this.ctime+=n},i._tockTick24=function(){this.ctime-=n},i._windMaybe=function(t,e){for(var i=0,a=new Date(this.ctime),r=!1;!t.call(this.market,a);)if(e.call(this),r=!0,a=new Date(this.ctime),(i+=1)>this.max_iters){var n="Warning! max iterations ("+this.max_iters;n+=") reached with no rule match.",console.log(n);break}return r},i._millisImpl=function(){var t=!1;if(!this.mperiods_aligned){var e=this._alignBaseZero(1e3),i=new Date(this.ctime),a=i.getMilliseconds();a=this._alignToBoundary(e,a),i.setMilliseconds(0),this.ctime=i.getTime()+a,t=this.mperiods_aligned=!0}var r=this._date().getMinutes();this._tickTock();var n=this._date().getMinutes();if((t||r!=n)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},i._secondImpl=function(){var t=!1;if(!this.speriod_aligned){var e=this._alignBaseZero(60),i=new Date(this.ctime),a=i.getSeconds();a=this._alignToBoundary(e,a),i.setSeconds(a),i.setMilliseconds(0),this.ctime=i.getTime(),t=this.speriod_aligned=!0}var r=this._date().getMinutes();this._tickTock();var n=this._date().getMinutes();if((t||r!=n)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},i._minuteImpl=function(){var t=this._windMaybe(this.market._wasOpenIntraDay,this._tockTick),e=new Date(this.ctime),i=e.getTimezoneOffset(),a=e.getMinutes(),r=e.getHours(),n=this._alignMinutes(),s=this._total_minutes(this.market.zopen_hour,this.market.zopen_minute,r,a)+this.market.zopen_minute;s=t?this.forward?n[n.length-1]:n[0]:this._alignToBoundary(n,s),r=Math.floor(s/60)+this.market.zopen_hour,e.setHours(r,s%60,0,0);var o=e.getTimezoneOffset()-i;(this.forward&&o<0||!this.forward&&0<o)&&e.setTime(e.getTime()-6e4*o),this.ctime=e.getTime(),this._tickTock();var l=this.market.zseg_match,h=this.market.hour_aligned&&this.multiple%60==0;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!h&&l!=this.market.zseg_match){if(e=new Date(this.ctime),this.forward)e.setMinutes(this.market.zopen_minute),e.setHours(this.market.zopen_hour);else{var c=(n=this._alignMinutes())[n.length-1];e.setMinutes(c%60),e.setHours(Math.floor(c/60)+this.market.zopen_hour)}this.ctime=e.getTime()}return this._date()},i._hourImpl=function(){this._windMaybe(this.market._wasOpenIntraDay,this._tockTick);var t=new Date(this.ctime);this.market.isHourAligned()?t.setMinutes(0):t.setMinutes(this.market.zopen_minute),t.setSeconds(0),t.setMilliseconds(0),this.ctime=t.getTime(),this._tickTock();var e=this.market.zseg_match;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!this.market.hour_aligned&&e!=this.market.zseg_match){if(current_date=new Date(this.ctime),this.forward)current_date.setMinutes(this.market.zopen_minute),current_date.setHours(this.market.zopen_hour);else{periods=this._alignMinutes();var i=periods[periods.length-1];current_date.setMinutes(i%60),current_date.setHours(Math.floor(i/60)+this.market.zopen_hour)}this.ctime=current_date.getTime()}return this._date()},i._dayImpl=function(){this._windMaybe(this.market._wasOpenDaily,this._seekHr);var t=new Date(this.ctime);t.setHours(12,0,0,0),this.ctime=t.getTime();for(var e=0;e<this.multiple;)this.forward?this._tickTock24():this._tockTick24(),this.market._wasOpenDaily(this._date())&&(e+=1);return(t=new Date(this.ctime)).setHours(0),this.ctime=t.getTime(),this._date()},i._weekImpl=function(){var t=new Date(this.ctime);for(t.setHours(12),this.ctime=t.getTime(),this._tickTock(),t=new Date(this.ctime);0!==t.getDay();)this._tockTick24(),t=new Date(this.ctime);return this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},i._monthImpl=function(){var t=new Date(this.ctime);return t.setDate(15),this.ctime=t.getTime(),this._tickTock(),(t=new Date(this.ctime)).setDate(1),t.setHours(12),this.ctime=t.getTime(),this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},i._findNext=null,i._findPrevious=null}(t),I=(c=t).CIQ,c.$$,w=c.$$$,u=c.SplinePlotter,p=c.timezoneJS,I.ChartEngine=function(t){var e;t||(t={container:null}),t.constructor==HTMLDivElement&&(t={container:t}),this.markers={},this.panels={},this.overlays={},this.charts={},this.eventListeners=[],this.animations={zoom:new I.EaseMachine(Math.easeOutCubic,400)},this.callbacks={studyOverlayEdit:null,studyPanelEdit:null,tap:null,rightClick:null,longhold:null,move:null,layout:null,drawing:null,preferences:null,theme:null,symbolChange:null,symbolImport:null,calculateTradingDecimalPlaces:I.calculateTradingDecimalPlaces},this.controls={},this.goneVertical=!1,this.pinchingScreen=!1,this.grabbingScreen=!1,this.grabStartX=0,this.grabStartY=0,this.grabStartScrollX=0,this.grabStartScrollY=0,this.swipe={},this.yTolerance=100,this.minimumLeftBars=1,this.grabStartCandleWidth=0,this.grabStartZoom=0,this.grabOverrideClick=!1,this.grabMode="",this.vectorsShowing=!1,this.mouseMode=!0,this.reverseMouseWheel=!1,this.mouseWheelAcceleration=!0,this.minimumCandleWidth=1,this.minimumZoomTicks=9,this.allowZoom=!0,this.allowScroll=!0,this.allowSideswipe=!0,this.allowThreeFingerTouch=!1,this.bypassRightClick={series:!1,study:!1,drawing:!1},this.anyHighlighted=!1,this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime(),this.displayCrosshairs=!0,this.hrPanel=null,this.editingAnnotation=!1,this.openDialog="",this.displayIconsUpDown=!0,this.displayIconsSolo=!0,this.displayIconsClose=!0,this.displayPanelResize=!0,this.soloPanelToFullScreen=!1,this.markerDelay=0,this.useBackingStore=!0,this.disableBackingStoreDuringTouch=I.isMobile,this.manageTouchAndMouse=!0,this.captureTouchEvents=!0,this.captureMouseWheelEvents=!0,this.touches=[],this.changedTouches=[],this.crosshairTick=null,this.crosshairValue=null,this.yaxisLabelStyle="roundRectArrow",this.axisBorders=null,this.pt={x1:-1,x2:-1,y1:-1,y2:-1},this.moveA=-1,this.moveB=-1,this.touchStartTime=-1,this.gestureStartDistance=-1,this.grabStartPeriodicity=1,this.grabEndPeriodicity=-1,this.scrollEvent=null,this.cmd=!1,this.ctrl=!1,this.shift=!1,this.userPointerDown=!1,this.cloneDrawing=!1,this.singleDrawingHighlight=!0,this.crosshairXOffset=-40,this.crosshairYOffset=-40,this.displayInitialized=!1,this.cx=null,this.cy=null,this.extendLastTick=!1,this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.cancelTouchSingleClick=!1,this.layout={interval:"day",periodicity:1,timeUnit:null,candleWidth:8,volumeUnderlay:!1,adj:!0,crosshair:!1,chartType:"candle",extended:!1,marketSessions:{},aggregationType:"ohlc",chartScale:"linear",studies:{},panels:{},setSpan:{}},this.preferences={highlightsRadius:10,highlightsTapRadius:30,currentPriceLine:!1,drawings:null,magnet:!1,horizontalCrosshairField:null,labels:!0,language:null,timeZone:null,whitespace:50,zoomInSpeed:null,zoomOutSpeed:null,zoomAtCurrentMousePosition:!1},this.streamParameters={count:0,maxWait:1e3,maxTicks:100,timeout:-1,fillGaps:!0},this.translationCallback=null,this.locale=null,this.dataZone=null,this.displayZone=null,this.timeZoneOffset=0,this.changeCallback=null,this.masterData=null,this.transformDataSetPre=null,this.transformDataSetPost=null,this.dataCallback=null,this.dontRoll=!1,this.allowEquations=!0,this.drawingObjects=[],this.undoStamps=[],this.cleanupGaps=!1,this.staticRange=!1,this.maxDataSetSize=2e4,this.maxMasterDataSize=0,this.resizeDetectMS=1e3,this.xAxisAsFooter=!0,this.xaxisHeight=30,this.displayGridLinesInStudies=!1,this.escapeOnSerialize=!0,this.chart=new I.ChartEngine.Chart,this.chart.name="chart",this.chart.canvas=null,this.chart.tempCanvas=null,this.chart.container=t.container,this.chart.market=new I.Market,this.candleWidthPercent=.65,this.colorByCandleDirection=!1,this.noWicksOnCandles={renko:!0,linebreak:!0},this.fetchMaximumBars={rangebars:!0,kagi:!0,renko:!0,linebreak:!0,pandf:!0},this.mainSeriesRenderer=null,this.highLowBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,wave:!0,rangechannel:!0,none:!0},this.standaloneBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0},this.barsHaveWidth={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0,wave:!0},this.autoPickCandleWidth={turnOn:!1,candleWidth:5},this.staticRangePeriodicityMap=[{rangeInMS:I.WEEK,periodicity:1,interval:5,timeUnit:"minute"},{rangeInMS:I.MONTH,periodicity:1,interval:30,timeUnit:"minute"},{rangeInMS:I.YEAR,periodicity:1,interval:"day"},{rangeInMS:I.DECADE,periodicity:1,interval:"week"},{rangeInMS:10*I.DECADE,periodicity:1,interval:"month"},{rangeInMS:Number.MAX_VALUE,periodicity:12,interval:"month"}],this.dynamicRangePeriodicityMap=[{interval:1,timeUnit:"minute",rangeInMS:I.MINUTE},{interval:5,timeUnit:"minute",rangeInMS:5*I.MINUTE},{interval:30,timeUnit:"minute",rangeInMS:30*I.MINUTE},{interval:60,timeUnit:"minute",rangeInMS:60*I.MINUTE},{interval:"day",rangeInMS:I.DAY},{interval:"month",rangeInMS:I.MONTH},{interval:"year",rangeInMS:I.YEAR}],this.charts.chart=this.chart,this.styles={},this.currentVectorParameters=I.clone(I.ChartEngine.currentVectorParameters),I.extend(this,t),t.container&&(this.registerHTMLElements(),this.chart.width=this.chart.container.clientWidth-this.chart.yAxis.width,this.setCandleWidth(this.layout.candleWidth,this.chart),this.chart.canvasHeight=this.chart.container.clientHeight,I.useOldWheelLogic&&!I.FireFoxWheelWorkaround&&(e=I.isIE?function(t){if(I.ChartEngine.insideChart){t.preventDefault();for(var e=0;e<I.ChartEngine.registeredContainers.length;e++){var i=I.ChartEngine.registeredContainers[e].stx;I.ChartEngine.crosshairX>=i.left&&I.ChartEngine.crosshairX<=i.right&&I.ChartEngine.crosshairY>=i.top&&I.ChartEngine.crosshairY<=i.bottom&&i.mouseWheel(t,"onmousewheel")}}}:function(t){I.ChartEngine.insideChart&&t.preventDefault()},this.addDomEventListener(document.body,"wheel",e),I.FireFoxWheelWorkaround=!0)),this.construct()},I.ChartEngine.drawingLine=!1,I.ChartEngine.resizingPanel=null,I.ChartEngine.vectorType="",I.ChartEngine.crosshairX=0,I.ChartEngine.crosshairY=0,I.ChartEngine.insideChart=!1,I.ChartEngine.overXAxis=!1,I.ChartEngine.overYAxis=!1,I.ChartEngine.currentColor="auto",I.ChartEngine.drawingTools={},I.ChartEngine.useAnimation=!0,I.ChartEngine.ipadMaxTicks=1500,I.ChartEngine.enableCaching=!1,I.ChartEngine.ignoreTouch=!1,I.ChartEngine.useOldAndroidClear=!0,I.ChartEngine.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:!0,fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:1.272,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:2.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:4.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:!1,printLevels:!0,printValues:!1,timezone:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}},annotation:{font:{style:null,size:null,weight:null,family:null}}},I.ChartEngine.defaultDisplayTimeZone=null,I.ChartEngine.Chart=function(){this.xAxis=new I.ChartEngine.XAxis,this.yAxis=new I.ChartEngine.YAxis,this.symbolObject={symbol:null},this.series={},this.seriesRenderers={},this.xaxis=[],this.state={},this.endPoints={},this.defaultChartStyleConfig={},this.baseline=I.clone(this.baseline)},I.ChartEngine.YAxis=function(t){for(var e in t)this[e]=t[e];this.name||(this.name=I.uniqueID())},I.ChartEngine.XAxis=function(t){for(var e in t)this[e]=t[e]},I.ChartEngine.Panel=function(t,e){this.yAxis=e||new I.ChartEngine.YAxis,this.name=t,this.state={}},I.extend(I.ChartEngine.YAxis.prototype,{high:null,low:null,shadow:null,logHigh:null,logLow:null,logShadow:null,multiplier:null,bottom:null,top:null,height:null,left:null,width:null},!0),I.ChartEngine.YAxis.prototype.maxDecimalPlaces=null,I.ChartEngine.YAxis.prototype.max=null,I.ChartEngine.YAxis.prototype.min=null,I.ChartEngine.YAxis.prototype.decimalPlaces=null,I.ChartEngine.YAxis.prototype.idealTickSizePixels=null,I.ChartEngine.YAxis.prototype.minimumPriceTick=null,I.ChartEngine.YAxis.prototype.fractional=null,I.ChartEngine.YAxis.prototype.displayBorder=!0,I.ChartEngine.YAxis.prototype.displayGridLines=!0,I.ChartEngine.YAxis.prototype.noDraw=null,I.ChartEngine.YAxis.prototype.drawCurrentPriceLabel=!0,I.ChartEngine.YAxis.prototype.drawSeriesPriceLabels=!0,I.ChartEngine.YAxis.prototype.drawPriceLabels=!0,I.ChartEngine.YAxis.prototype.goldenRatioYAxis=!0,I.ChartEngine.YAxis.prototype.yaxisLabelStyle=null,I.ChartEngine.YAxis.prototype.justifyRight=null,I.ChartEngine.YAxis.prototype.textBackground=!1,I.ChartEngine.YAxis.prototype.priceFormatter=null,I.ChartEngine.YAxis.prototype.bottomOffset=0,I.ChartEngine.YAxis.prototype.topOffset=0,I.ChartEngine.YAxis.prototype.initialMarginTop=10,I.ChartEngine.YAxis.prototype.initialMarginBottom=10,I.ChartEngine.YAxis.prototype.zoom=0,I.ChartEngine.YAxis.prototype.scroll=0,Object.defineProperty(I.ChartEngine.YAxis.prototype,"width",{configurable:!0,enumerable:!0,get:function(){return this._dynamicWidth||this._width},set:function(t){this._width=t,this._dynamicWidth<t&&(this._dynamicWidth=NaN)}}),I.ChartEngine.YAxis.prototype.width=50,I.ChartEngine.YAxis.prototype.textStyle=null,I.ChartEngine.YAxis.prototype.position=null,I.ChartEngine.YAxis.defaultShadowBreaks=[[1e3,2],[5,4],[.001,8]],I.ChartEngine.YAxis.smallChartShadowBreaks=[[10,2],[1,4]],I.ChartEngine.YAxis.prototype.pretty=!0,I.ChartEngine.YAxis.prototype.increments=[1,2.5,5],I.ChartEngine.YAxis.prototype.prettySemiLog=!0,I.ChartEngine.YAxis.prototype.shadowBreaks=I.ChartEngine.YAxis.defaultShadowBreaks,I.extend(I.ChartEngine.Panel.prototype,{name:null,display:null,chart:null,yAxis:null,shareChartXAxis:null,top:null,bottom:null,height:null,percent:null},!0),I.extend(I.ChartEngine.XAxis.prototype,{formatter:null,adjustTimeZone:!0,idealTickSizePixels:null,timeUnit:null,timeUnitMultiplier:null,displayBorder:!0,displayGridLines:!0,noDraw:null,minimumLabelWidth:50,futureTicks:!0,futureTicksInterval:1},!0),I.extend(I.ChartEngine.Chart.prototype,{symbol:null,symbolObject:{symbol:null},symbolDisplay:null,series:{},seriesRenderers:{},scroll:0,standStill:0,maxTicks:0,tension:null,currentMarketData:{},masterData:null,dataSet:null,scrubbed:null,dataSegment:null,segmentImage:null,baseline:{includeInDataSegment:!1,defaultLevel:null,userLevel:null,actualLevel:null},xAxis:null,xaxis:[],xaxisFactor:30,decimalPlaces:2,dynamicYAxis:!1,roundit:100,legendRenderer:I.drawLegend,customChart:null,yaxisPaddingRight:null,yaxisPaddingLeft:null,tickCache:{},allowScrollPast:!0,allowScrollFuture:!0,whiteSpaceFutureTicks:0,hideDrawings:!1,defaultPlotField:"Close",defaultChartStyleConfig:{},lockScroll:!1,includeOverlaysInMinMax:!0,gaplines:null,lineStyle:null,lineApproximation:!0,highLowBars:!1,standaloneBars:!1,barsHaveWidth:!1},!0),I.ChartEngine.prototype.setDrawingContainer=function(t){this.drawingContainer=t},I.ChartEngine.prototype.isHistoricalMode=function(){var t=new Date,e=!0,i=this.masterData;if(!this.isHistoricalModeSet)return!1;if(i.length){var a=this.getFirstLastDataRecord(i,"DT",!0),r=this.standardMarketIterator(a.DT);if((e=r.next()<=t)&&I.ChartEngine.isDailyInterval(r.interval)){var n=this.chart.market.getOpen();n&&t<n&&(t.setHours(0,0,0,0),+t==+r.begin&&(e=!1))}}return e},I.ChartEngine.prototype.convertToDataZone=function(t){if((t||0===t)&&this.dataZone){var e=I.convertTimeZone(t,null,this.dataZone);t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}return t},I.ChartEngine.isDailyInterval=function(t){return"day"==t||"week"==t||"month"==t},I.ChartEngine.prototype.needDifferentData=function(t){var e=this.layout,i=I.ChartEngine.isDailyInterval(t.interval),a=I.ChartEngine.isDailyInterval(e.interval),r=!1;return this.dontRoll||!a?e.interval!=t.interval&&(r=!0):i!=a&&(r=!0),i||t.timeUnit||(t.timeUnit="minute"),a||e.timeUnit||(e.timeUnit="minute"),t.timeUnit!=e.timeUnit&&(r=!0),r},I.ChartEngine.chartShowsHighs=function(t){return console.warn("CIQ.ChartEngine.chartShowsHighs() has been deprecated. Please check one of the appropriate renderer properties instead: stxx.chart.highLowBars, stxx.chart.standaloneBars, or stxx.chart.barsHaveWidth."),1!={line:1,colored_line:1,mountain:1,colored_mountain:1,baseline_delta:1,baseline_delta_mountain:1,histogram:1,scatterplot:1,step:1,colored_step:1}[t]},I.ChartEngine.prototype.debug=function(){},I.ChartEngine.prototype.fps=function(a,r){a=a||5;var n=(new Date).getTime(),s=0,o=this;console.log("Running fps() for "+a+" seconds"),function t(){var e=((new Date).getTime()-n)/1e3;if(a<e){var i=s/e;return console.log("FPS="+i),void(r&&r(i))}o.draw(),s++,I.ChartEngine.useAnimation?requestAnimationFrame(t):setTimeout(t,0)}()},c.STXChart=I.ChartEngine,I.ChartEngine.DrawingDescriptor={name:"",render:null,intersected:null,click:null,abort:null},I.ChartEngine.prototype.prepend=function(t,e){var i,a="prepend"+t;return this instanceof I.ChartEngine?(i=this.hasOwnProperty(a)?this[a]:[],this[a]=[e].concat(i)):(i=I.ChartEngine.prototype[a]||[],I.ChartEngine.prototype[a]=[e].concat(i)),{method:a,func:e}},I.ChartEngine.prototype.append=function(t,e){var i,a="append"+t;return this instanceof I.ChartEngine?(i=this.hasOwnProperty(a)?this[a]:[],this[a]=i.concat(e)):(i=I.ChartEngine.prototype[a]||[],I.ChartEngine.prototype[a]=i.concat(e)),{method:a,func:e}},I.ChartEngine.prototype.removeInjection=function(t){var e,i=t.method;if(this instanceof I.ChartEngine){if(!this[i])return;for(e=0;e<this[i].length;e++)if(this[i][e]==t.func)return void this[i].splice(e,1)}else{if(!I.ChartEngine.prototype[i])return;for(e=0;e<I.ChartEngine.prototype[i].length;e++)if(I.ChartEngine.prototype[i][e]==t.func)return void I.ChartEngine.prototype[i].splice(e,1)}},I.ChartEngine.prototype.remove=function(t){this instanceof I.ChartEngine?(delete this["append"+t],delete this["prepend"+t]):(delete I.ChartEngine.prototype["append"+t],delete I.ChartEngine.prototype["prepend"+t])},I.ChartEngine.registeredContainers=[],I.ChartEngine.handleContextMenu=function(t){t||(t=event);for(var e=0;e<I.ChartEngine.registeredContainers.length;e++){var i=I.ChartEngine.registeredContainers[e].stx;if(i&&i.anyHighlighted)return t.preventDefault&&t.preventDefault(),!1}},I.ChartEngine.prototype.positionMarkers=function(){},I.ChartEngine.prototype.plugins={},I.ChartEngine.htmlControls={annotationSave:'<span class="stx-btn stx_annotation_save" style="display: none;">save</span>',annotationCancel:'<span class="stx-btn stx_annotation_cancel" style="display: none; margin-left:10px;">cancel</span>',mSticky:'<div class="stx_sticky"> <span class="mStickyInterior"></span> <span class="mStickyRightClick"><span class="overlayEdit stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="overlayTrashCan stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="mouseDeleteInstructions"><span>(</span><span class="mouseDeleteText">right-click to delete</span><span class="mouseManageText">right-click to manage</span><span>)</span></span></span></div>',crossX:'<div class="stx_crosshair stx_crosshair_x" style="display: none;"></div>',crossY:'<div class="stx_crosshair stx_crosshair_y" style="display: none;"></div>',chartControls:'<div class="stx_chart_controls" style="display: none; bottom: 22px;"><div class="chartSize"><span class="stx-zoom-out"></span><span class="stx-zoom-in"></span></div></div>',home:'<div class="stx_jump_today" style="display:none"><span></span></div>',floatDate:'<div class="stx-float-date" style="visibility: hidden;"></div>',handleTemplate:'<div class="stx-ico-handle" style="display: none;"><span></span></div> ',iconsTemplate:'<div class="stx-panel-control"><div class="stx-panel-title"></div><div class="stx-btn-panel"><span class="stx-ico-up"></span></div><div class="stx-btn-panel"><span class="stx-ico-focus"></span></div><div class="stx-btn-panel"><span class="stx-ico-down"></span></div><div class="stx-btn-panel"><span class="stx-ico-edit"></span></div><div class="stx-btn-panel"><span class="stx-ico-close"></span></div></div>',baselineHandle:'<div class="stx-baseline-handle" style="display: none;"></div>'},I.ChartEngine.prototype.registerHTMLElements=function(){var t=this.chart.container;for(var e in I.ChartEngine.htmlControls)if(void 0===this.chart[e]&&void 0===this.controls[e]){if(!this.allowZoom&&"chartControls"==e)continue;var i=w("."+e,t);if(i)this.chart[e]=i,this.controls[e]=i;else{var a=I.ChartEngine.htmlControls[e];if(!a)continue;var r=document.createElement("DIV");r.innerHTML=a,i=r.firstChild,t.appendChild(i),this.chart[e]=i,this.controls[e]=i,I.appendClassName(i,e)}}var n,s,o,l=this.controls.chartControls,h=this.controls.home;if(l){var c=w(".stx-zoom-in",l),u=w(".stx-zoom-out",l);I.safeClickTouch(c,(s=this,function(t){s.zoomIn(t),t.stopPropagation()})),I.safeClickTouch(u,(n=this,function(t){n.zoomOut(t),t.stopPropagation()})),I.touchDevice||(this.makeModal(c),this.makeModal(u))}h&&(I.safeClickTouch(h,(o=this,function(t){t.stopPropagation(),o.isHistoricalMode()?(delete o.layout.range,o.newChart(o.chart.symbol,null,null,function(){o.home({animate:!1})},null)):o.home({animate:!0})})),I.touchDevice||this.makeModal(h))},I.ChartEngine.prototype.makeModal=function(t){var e=this;t.onmouseover=function(t){e.modalBegin()},t.onmouseout=function(t){e.modalEnd()}},I.ChartEngine.prototype.cloneStyle=function(t){var e={},i=!1;function a(t){return t[1].toUpperCase()}for(var r in t){var n=t[r];if("backgroundAttachment"==r&&(i=!0),i)n&&n.constructor==String&&isNaN(r)&&(e[r]=n);else if(isNaN(r))e[r.replace(I.camelCaseRegExp,a)]=n;else{var s=t.getPropertyValue(n);if(s){for(var o=0,l=(n=n.split("-")).length,h=n[0];++o<l;)h+=n[o].charAt(0).toUpperCase()+n[o].slice(1);e[h]=s}}}return e},I.ChartEngine.prototype.canvasStyle=function(t){var e=this.styles[t];if(!e){var i=document.createElement("div");i.className=t,this.container.appendChild(i);var a=getComputedStyle(i);e=this.styles[t]=this.cloneStyle(a),this.container.removeChild(i),a||(this.styles[t]=null)}return e},I.ChartEngine.prototype.colorOrStyle=function(t){return-1!=t.indexOf("#")?t:-1!=t.indexOf("(")?t:"transparent"==t?t:this.canvasStyle(t)},I.ChartEngine.prototype.clearStyles=function(){this.styles={}},I.ChartEngine.prototype.setStyle=function(t,e,i){this.styles[t]||this.canvasStyle(t),this.styles[t]||(this.styles[t]={}),this.styles[t][I.makeCamelCase(e)]=i},I.ChartEngine.prototype.canvasFont=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+" "+i.fontFamily;-1==a.indexOf("undefined")?e.font=a:(this.styles[t]=null,console.log("bad css style for class "+t))}},I.ChartEngine.prototype.canvasColor=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.color;a||(a=this.defaultColor),e.globalAlpha=1,e.fillStyle=a,e.strokeStyle=a;var r=i.opacity;void 0!==r&&(e.globalAlpha=r)}},I.ChartEngine.prototype.getCanvasFontSize=function(t){var e=this.canvasStyle(t).fontSize;return e||(e="12"),parseInt(I.stripPX(e),10)},I.ChartEngine.prototype.getCanvasColor=function(t){return this.canvasStyle(t).color},I.ChartEngine.hideDates=function(){return!1},I.ChartEngine.prototype.runPrepend=function(t,e,i){var a="prepend"+t,r=this.hasOwnProperty(a)?this[a]:[];if(!(r=r.concat(I.ChartEngine.prototype[a]||[])).length)return!1;i||(i=this);for(var n=0;n<r.length;n++){var s=r[n].apply(i,e);if(s)return s}return!1},I.ChartEngine.prototype.runAppend=function(t,e,i){var a="append"+t,r=this.hasOwnProperty(a)?this[a]:[];if(!(r=r.concat(I.ChartEngine.prototype[a]||[])).length)return!1;i||(i=this);for(var n=0;n<r.length;n++){var s=r[n].apply(i,e);if(s)return s}return!1},I.ChartEngine.registerDrawingTool=function(t,e){I.ChartEngine.drawingTools[t]=e},I.ChartEngine.prototype.createBlock=function(t,e,i,a,r,n){n||(n=this.chart.context),void 0!==a&&(this.canvasColor(r,n),n.fillRect(t,i,e,a),n.globalAlpha=1)},I.ChartEngine.prototype.changeOccurred=function(t){if(!this.currentlyImporting){this.changeCallback&&(console.warn("CIQ.ChartEngine.changeCallback has been deprecated. Please use addEventListener()"),this.changeCallback(this,t));var e={stx:this,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,layout:this.layout,drawings:this.drawingObjects};"layout"==t?this.dispatch("layout",e):"vector"==t?this.dispatch("drawing",e):"theme"==t?this.dispatch("theme",e):"preferences"==t&&this.dispatch("preferences",e)}},I.ChartEngine.prototype.setChartType=function(t){var e=this.layout,i=this.chart;"ohlc"!=e.aggregationType&&(e.aggregationType="ohlc",i.canvas&&this.createDataSet()),e.chartType=t,this.setMainSeriesRenderer(!0),i.defaultChartStyleConfig={type:t},this.displayInitialized&&this.draw(),this.changeOccurred("layout")},I.ChartEngine.prototype.setAggregationType=function(t){this.layout.chartType="candle";var e=this.chart;!1!==e.baseline.userLevel&&(e.baseline.userLevel=e.baseline.defaultLevel,e.panel.yAxis.scroll=I.ChartEngine.YAxis.prototype.scroll),this.layout.aggregationType=t,this.setMainSeriesRenderer(),e.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},I.ChartEngine.prototype.setChartScale=function(t){var e=this.chart,i={percent:!0,relative:!0};if(t||(t="linear"),i[t])this.setComparison(t,e,I.Comparison.initialPrice);else if(i[this.layout.chartScale]){var a=!1;for(var r in e.series)e.series[r].parameters.isComparison&&(a=!0);a||this.setComparison(!1,e)}this.layout.chartScale=t,e.canvas&&this.draw(),this.changeOccurred("layout")},I.ChartEngine.prototype.setAdjusted=function(t){this.layout.adj=t,this.chart.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},I.ChartEngine.prototype.setVolumeUnderlay=function(t){this.layout.volumeUnderlay=t,this.chart.canvas&&this.draw(),this.changeOccurred("layout")},I.ChartEngine.prototype.serializeDrawings=function(){return console.warn("CIQ.ChartEngine.serializeDrawings() has been deprecated. Please use exportDrawings()"),this.exportDrawings()},I.ChartEngine.prototype.exportDrawings=function(){for(var t=[],e=0;e<this.drawingObjects.length;e++)t.push(this.drawingObjects[e].serialize());return t},I.ChartEngine.prototype.abortDrawings=function(t){!1!==t&&(t=!0);for(var e=this.drawingObjects.length-1;0<=e;e--){var i=this.drawingObjects[e];i.abort(!0),!t&&i.permanent||this.drawingObjects.splice(e,1)}},I.ChartEngine.prototype.reconstructDrawings=function(t){console.warn("CIQ.ChartEngine.reconstructDrawings() has been deprecated. Please use importDrawings()"),this.importDrawings(t)},I.ChartEngine.prototype.importDrawings=function(t){if(I.Drawing)for(var e=0;e<t.length;e++){var i=t[e];"fibonacci"==i.name&&(i.name="retracement");var a=I.ChartEngine.drawingTools[i.name];if(a||I.Drawing[i.name]&&(a=I.Drawing[i.name],I.ChartEngine.registerDrawingTool(i.name,a)),a){var r=new a;r.reconstruct(this,i),this.drawingObjects.push(r)}}},I.ChartEngine.prototype.clearDrawings=function(t,e){!1!==e&&(e=!0);var i=I.shallowClone(this.drawingObjects);this.abortDrawings(e),t?this.undoStamps=[]:this.undoStamp(i,I.shallowClone(this.drawingObjects)),this.changeOccurred("vector"),this.cancelTouchSingleClick=!0,I.clearCanvas(this.chart.tempCanvas,this),this.draw();var a=this.controls.mSticky;a&&(a.style.display="none",a.children[0].innerHTML="")},I.ChartEngine.prototype.createDrawing=function(t,e){if(I.Drawing){var i=new I.Drawing[t];i.reconstruct(this,e);var a=new I.Drawing[t];for(var r in a.stx=this,a.copyConfig(),a)i[r]=i[r]||a[r];return this.drawingObjects.push(i),this.draw(),i}},I.ChartEngine.prototype.removeDrawing=function(t){for(var e=0;e<this.drawingObjects.length;e++)if(this.drawingObjects[e]==t)return this.drawingObjects.splice(e,1),this.changeOccurred("vector"),void this.draw()},I.ChartEngine.prototype.dateFromTick=function(t,e,i){e||(e=this.chart);var a,r,n=e.dataSet.length,s=!1;return 0===n&&(e.dataSet[0]={},e.dataSet[0].DT=new Date,n=e.dataSet.length,s=!0),a=t<0?this.standardMarketIterator(e.dataSet[0].DT).previous(Math.abs(t)):n<=t?this.standardMarketIterator(e.dataSet[n-1].DT).next(t-(n-1)):e.dataSet[t].DT,r=i?new Date(a.getTime()):I.yyyymmddhhmm(a),s&&delete e.dataSet[0].DT,r},I.ChartEngine.prototype.calculateYAxisMargins=function(t){t.zoom=t.initialMarginTop+t.initialMarginBottom,t.scroll=(t.initialMarginTop-t.initialMarginBottom)/2,t.zoom>t.height&&(t.zoom=0,t.scroll=0)},I.ChartEngine.prototype.getLabelOffsetInPixels=function(t,e){var i=!(this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e]);return"roundRectArrow"!=this.yaxisLabelStyle||i&&this.extendLastTick&&0!==t.yaxisPaddingRight?0:.66*(this.getCanvasFontSize("stx_yaxis")+6)},I.ChartEngine.prototype.home=function(t){this.swipe.amplitude=0;var e=this.layout;function a(t){for(var e in t.panels)for(var i=t.panels[e].yaxisLHS.concat(t.panels[e].yaxisRHS),a=0;a<i.length;a++)t.calculateYAxisMargins(i[a])}function i(t,e,i){return function(){a(t),e.scroll=i,t.draw()}}if("object"!=typeof t&&(t={maintainWhitespace:t}),void 0===t.maintainWhitespace&&(t.maintainWhitespace=!0),this.cancelTouchSingleClick=!0,this.chart.dataSet&&this.chart.dataSet.length){this.micropixels=0;var r=Math.floor(this.chart.width/e.candleWidth);for(var n in this.charts){var s=this.charts[n];if(!t.chart||t.chart==s){var o=0;t.maintainWhitespace&&0<=this.preferences.whitespace&&(o=this.preferences.whitespace),(t.whitespace||0===t.whitespace)&&(o=t.whitespace);var l=this.getLabelOffsetInPixels(s,e.chartType);o<l&&(o=l);var h=Math.min(r,s.dataSet.length);for(this.chart.allowScrollPast&&(h=r),this.micropixels=this.chart.width-h*e.candleWidth-o,this.preferences.whitespace=o;this.micropixels>e.candleWidth;)h++,this.micropixels-=e.candleWidth;for(;this.micropixels<0;)h--,this.micropixels+=e.candleWidth;this.micropixels-=e.candleWidth,h++,this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e.chartType]||(this.micropixels+=e.candleWidth/2),t.animate?this.scrollTo(s,h,i(this,s,h)):(s.scroll=h,a(this))}}this.draw()}else this.draw()},I.ChartEngine.prototype.isHome=function(){var t=this.chart,e=t.dataSet,i=t.animatingHorizontalScroll;return this.pixelFromTick(e.length-(i?2:1),t)<t.width+t.panel.left},I.ChartEngine.prototype.tickFromDate=function(t,e,i,a){if(e||(e=this.chart),!e.dataSet||!e.dataSet.length)return 0;i||(i=0),e||(e=this.chart);var r=t.constructor==Date?t:I.strToDateTime(t);I.ChartEngine.isDailyInterval(this.layout.interval)||r.setMinutes(r.getMinutes()+i);var n=r.getTime(),s=e.tickCache[n];if(s||0===s)return s+(a?1:0);var o=e.dataSet[0].DT,l=e.dataSet[e.dataSet.length-1].DT;if(o<=r&&r<=l){for(var h=0,c=e.dataSet.length,u=0;++u<100;){var p=Math.floor((c+h)/2),d=e.dataSet[p].DT;if(+d==+r)return e.tickCache[n]=p;if(d<r&&(h=p),r<d){if(e.dataSet[p-1].DT<r)return e.tickCache[n]=p-1,e.tickCache[n]+(a?1:0);if(+e.dataSet[p-1].DT==+r)return e.tickCache[n]=p-1,p-1;c=p}}if(100<=u)return console.log("!!!Warning: tickFromDate() did not find match."),e.dataSet.length}var m=r<o,g=m?o:l,f=this.standardMarketIterator(g).futureTick({end:r});return s=m?-1*f:e.dataSet.length-1+f,e.tickCache[n]=s},I.ChartEngine.XAxisLabel=function(t,e,i){this.hz=t,this.grid=e,this.text=i},I.ChartEngine.prototype.createXAxis=function(t){if(t.dataSegment.length<=0)return null;if(t.xAxis.noDraw)return null;var e=[t],i=this.runPrepend("createXAxis",e);return i||(i=this.mainSeriesRenderer&&this.mainSeriesRenderer.createXAxis?this.mainSeriesRenderer.createXAxis(t):this.createTickXAxisWithDates(t),this.headsUpHR(),this.runAppend("createXAxis",e),i)},I.ChartEngine.prototype.resetDynamicYAxis=function(t){if(!this.runPrepend("resetDynamicYAxis",arguments)){var e=!1;for(var i in this.panels){var a=this.panels[i];if((!t||!t.chartName||a.chart.name===t.chartName)&&a.yaxisLHS&&a.yaxisRHS)for(var r=a.yaxisLHS.concat(a.yaxisRHS),n=0;n<r.length;n++)r[n]._dynamicWidth&&(e=!(r[n]._dynamicWidth=NaN))}!e||t&&t.noRecalculate||this.calculateYAxisPositions(),this.runAppend("resetDynamicYAxis",arguments)}},I.ChartEngine.prototype.adjustYAxisHeightOffset=function(t,e){var i=e.topOffset,a=e.bottomOffset;i+a>t.height&&(console.log("The sum of yAxis.topOffset and yAxis.bottomOffset cannot be greater than the panel height. Both values will be reset to 0."),e.bottomOffset=0,e.topOffset=0),this.xaxisHeight||0===this.xaxisHeight||(this.xaxisHeight=this.getCanvasFontSize("stx_xaxis")+4,(this.chart.xAxis.displayBorder||this.axisBorders)&&(this.xaxisHeight+=3)),(this.xAxisAsFooter&&t.bottom>this.chart.canvasHeight-this.xaxisHeight||!this.xAxisAsFooter&&t==this.chart.panel)&&(a+=this.xaxisHeight),e.top=t.top+i,e.bottom=t.bottom-a},I.ChartEngine.prototype.plotYAxisGrid=function(t){if(!this.runPrepend("plotYAxisGrid",arguments)){var e=this.chart.context;t.yAxis.yAxisPlotter&&t.yAxis.yAxisPlotter.draw(e,"grid"),this.runAppend("plotYAxisGrid",arguments)}},I.ChartEngine.prototype.plotYAxisText=function(t){if(!this.runPrepend("plotYAxisText",arguments)){for(var e=t.yaxisLHS.concat(t.yaxisRHS),i=0;i<e.length;i++){var a=e[i];if(a.yAxisPlotter&&!a.noDraw&&a.width){this.canvasFont("stx_yaxis"),this.canvasColor("stx_yaxis");var r=this.chart.context;r.textBaseline="middle",a.justifyRight?r.textAlign="right":r.textAlign="left",a.yAxisPlotter.draw(r,"text"),r.textBaseline="alphabetic",r.textAlign="left"}}this.runAppend("plotYAxisText",arguments)}},I.ChartEngine.prototype.decimalPlacesFromPriceTick=function(t){return t<1e-4?8:t<.01?4:t<.1?2:t<1?1:0},I.ChartEngine.prototype.formatYAxisPrice=function(t,e,i,a,r){if(null==t||isNaN(t))return"";var n=a||e.yAxis,s=i;s||0===s||(s=n.printDecimalPlaces),s||0===s||(s=this.decimalPlacesFromPriceTick(n.priceTick));var o=n==e.chart.yAxis?2e4:1e3;if(n.priceTick>=o)return I.condenseInt(t);var l=this.internationalizer;if(l&&!1!==r){var h=l.priceFormatters.length;h<=s&&(s=h-1),t=l.priceFormatters[s].format(t)}else t=t.toFixed(s);return t},I.ChartEngine.prototype.padOutPrice=function(t,e){if(0!==t&&(!t||"number"!=typeof t))return"";e||0===e||(e=t);var i=""+e,a=i.substring(i.indexOf(".")).length-1;a=1e3<=e?Math.max(a,0):e<2?Math.max(a,4):Math.max(a,2);var r=this.internationalizer;if(r){var n=r.priceFormatters.length;n<=a&&(a=n-1),t=r.priceFormatters[a].format(t)}else t=t.toFixed(a);return t},I.ChartEngine.prototype.formatPrice=function(t,e){if(0!==t&&(!t||void 0===t))return"";if(e||(e=this.currentPanel),e||(e=this.chart.panel),!e)return t;var i=e.decimalPlaces;if(i||0===i||(i=e.chart.decimalPlaces),!i&&0!==i)return t;var a=this.internationalizer;if(a){var r=a.priceFormatters.length;r<=i&&(i=r-1),t=a.priceFormatters[i].format(t)}else t=t.toFixed(i);return t},I.ChartEngine.prototype.createCrosshairs=function(){if(!this.runPrepend("createCrosshairs",arguments)&&this.manageTouchAndMouse){var t=this.controls.crossX,e=this.controls.crossY;t&&(t.onmousedown||(t.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),e&&(e.onmousedown||(e.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),this.runAppend("createCrosshairs",arguments)}},I.ChartEngine.prototype.determineMinMax=function(t,e,i,a,r){var n=-1*Number.MAX_VALUE,s=Number.MAX_VALUE,o=!1,l=t.length;r&&(l=r);for(var h=0;h<=l+1;h++){var c;if(e.length&&(c=h==l?this.getPreviousBar(this.chart,e[0],0):h==l+1?this.getNextBar(this.chart,e[0],l-1):t[h]),c){if(!a)if(c.transform)o=!0,c=c.transform;else if(o)continue;for(var u=0,p=0;p<e.length;p++){var d=I.existsInObjectChain(c,e[p]);if(d){var m=d.obj[d.member];"number"==typeof m&&(m=[m]);for(var g=0;g<m.length;g++){var f=m[g];(f||0===f)&&(i?(n<(u+=f)&&(n=u),u<s&&(s=u)):(n<f&&(n=f),f<s&&(s=f)))}}}}}return n==-1*Number.MAX_VALUE&&(n=0),s==Number.MAX_VALUE&&(s=0),[s,n]},I.ChartEngine.prototype.calculateYAxisRange=function(t,e,i,a){i==Number.MAX_VALUE&&(a=i=0);var r=t.height,n=null,s=null;this.adjustYAxisHeightOffset(t,e),e.height=e.bottom-e.top;var o=Math.round(Math.abs(r/5));if(0<=e.zoom&&r-Math.abs(e.scroll)<o&&(e.scroll=(r-o)*(e.scroll<0?-1:1)),i||0===i){if(a-i==0){var l=Math.pow(10,-(i.toString()+".").split(".")[1].length);1==l&&(l=100),n=i+l,s=i-l}else if((this.layout.semiLog||"log"==this.layout.chartScale)&&n){var h=Math.log(i)/Math.LN10,c=Math.log(a)/Math.LN10;n=Math.pow(10,c),s=Math.pow(10,h)}else n=a,s=i;e.high=n,e.low=s}if((e.max||0===e.max)&&(e.high=e.max),(e.min||0===e.min)&&(e.low=e.min),e.shadow=e.high-e.low,t.chart.name===t.name&&t.yAxis.name===e.name){var u=this.layout.semiLog||"log"==this.layout.chartScale;(t.chart.isComparison||"pandf"==this.layout.aggregationType)&&(u=!1),e.semiLog!=u&&(this.clearPixelCache(),e.semiLog=u)}},I.ChartEngine.prototype.renderYAxis=function(t){if(!this.runPrepend("renderYAxis",arguments)){for(var e in this.rendererAction(t,"yAxis"),this.panels){var i=this.panels[e];if(i.chart==t){var a,r,n=i.yaxisRHS.concat(i.yaxisLHS),s={};for(a=0;a<n.length;a++)r=n[a],this.calculateYAxisRange(i,r,r.lowValue,r.highValue),I.Studies&&(s=I.Studies.getYAxisParameters(this,r)),s.yAxis=r,this.createYAxis(i,s),this.drawYAxis(i,s),I.Studies&&I.Studies.doPostDrawYAxis(this,r)}}this.runAppend("renderYAxis",arguments)}},I.ChartEngine.prototype.initializeDisplay=function(m){if(!this.runPrepend("initializeDisplay",arguments)){var t,g=[],f=this,e=null,i=Math.floor((m.width-this.micropixels)/this.layout.candleWidth);m.scroll>m.maxTicks&&m.maxTicks>i+1&&(e=m.dataSegment.length-1);var a=[];for(var r in this.panels){var n=this.panels[r];a=n.yaxisLHS.concat(n.yaxisRHS);for(var s=0;s<a.length;s++){var o=a[s];g=[];var l=m.transformFunc&&o==m.panel.yAxis;if(y(o,n),t=this.mainSeriesRenderer&&this.mainSeriesRenderer.determineMax?this.mainSeriesRenderer.determineMax(m.dataSegment,g,null,!l,e):this.determineMinMax(m.dataSegment,g,null,!l,e),this.mainSeriesRenderer&&(!this.mainSeriesRenderer.highLowBars||!this.highLowBars[this.layout.chartType])){var h=this.mainSeriesRenderer||{};if(m.panel==n&&h.params&&h.params.baseline&&"mountain"!=h.params.type){var c=m.baseline.actualLevel;if(c||0===c){l&&(c=m.transformFunc(this,m,c));var u=Math.max(c-t[0],t[1]-c);this.repositioningBaseline?t=[m.lowValue,m.highValue]:(t[0]=c-u,t[1]=c+u)}}}o.lowValue=t[0],o.highValue=t[1],o==m.panel.yAxis&&(m.lowValue=o.lowValue,m.highValue=o.highValue)}}var p=m.state.aggregation;p&&p.box&&(m.lowValue-=p.box/2,m.highValue+=p.box/2),this.runAppend("initializeDisplay",arguments)}function y(t,e){var i=f.layout&&f.layout.studies&&f.layout.studies[t.name];if(i){for(var a in i.outputMap)g.push(a);i.study&&i.study.renderer&&(g=g.concat(I.createObjectChainNames(a,["Close","Open","High","Low"])));for(var r=0;r<=2;r++)g.push(i.name+"_hist"+(r||""))}if(e){var n=[];for(var s in m.seriesRenderers){var o=m.seriesRenderers[s],l=o.params,h=l.panel;if((l.yAxis||!f.panels[h]||f.panels[h].yAxis)==t){n=o.highLowBars?["Close","Open","High","Low"]:[m.defaultPlotField||"Close"];for(var c=0;c<o.seriesParams.length;c++){var u=o.seriesParams[c];u.symbol?g=g.concat(I.createObjectChainNames(u.symbol,n)).concat(u.symbol):u.field?g.push(u.field):t==m.panel.yAxis&&(g=g.concat(n))}}}if(m.includeOverlaysInMinMax)for(var p in f.overlays){var d=f.overlays[p];d.panel==e.name&&(f.getYAxisByName(d.panel,d.name)||e.yAxis)==t&&y({name:d.name})}}}},I.ChartEngine.prototype.computePosition=function(t,e){return void 0===e&&(e=0),t*this.layout.candleWidth+e+this.micropixels},I.ChartEngine.prototype.computeColor=function(t,e){return t<e?"stx_candle_up":e<t?"stx_candle_down":"stx_candle_shadow"},I.ChartEngine.prototype.computeLength=function(t,e){var i=this.pixelFromPrice(t);return this.pixelFromPrice(e)-i},I.ChartEngine.prototype.setSeriesRenderer=function(t){var e=t.params;return this.chart.seriesRenderers[e.name]?this.chart.seriesRenderers[e.name]:(e.yAxis&&(e.yAxis=this.addYAxis(this.panels[e.panel],e.yAxis)),(t.stx=this).chart.seriesRenderers[e.name]=t)},I.ChartEngine.prototype.setMainSeriesRenderer=function(t){var e=this.layout.chartType,i=this.layout.aggregationType,a=this.chart.customChart,r=this.mainSeriesRenderer;r&&(r.removeAllSeries(t),this.removeSeriesRenderer(r),r=this.mainSeriesRenderer=null);var n={panel:this.chart.panel.name,name:"_main_series",highlightable:!1,useChartLegend:!0};if(a&&a.chartType&&(e=a.chartType),"none"!=e){i&&"ohlc"!=i&&(e=i);var s=I.Renderer.produce(e,n);s&&(this.setSeriesRenderer(s).attachSeries(null,{display:this.chart.symbol}),this.mainSeriesRenderer=s),["highLowBars","standaloneBars","barsHaveWidth"].forEach(function(t){this.chart[t]=this.mainSeriesRenderer&&this.mainSeriesRenderer[t]}.bind(this))}},I.ChartEngine.prototype.setMarket=function(t,e){for(var i in e||(e=this.chart),e.market=new I.Market(t),this.layout.marketSessions)e.market.disableSession(i,this.layout.marketSessions[i])},I.ChartEngine.prototype.setMarketFactory=function(t){this.marketFactory=t},I.ChartEngine.prototype.removeSeriesRenderer=function(t){for(var e in this.chart.seriesRenderers)if(t.params.name===this.chart.seriesRenderers[e].params.name){var i=this.chart.seriesRenderers[t.params.name],a=i.params.yAxis,r=this.panels[i.params.panel];return delete this.chart.seriesRenderers[t.params.name],void this.deleteYAxisIfUnused(r,a)}},I.ChartEngine.prototype.getSeriesRenderer=function(t){return this.chart.seriesRenderers[t]},I.ChartEngine.prototype.startClip=function(t,e){t||(t="chart");var i=this.panels[t],a=i.yAxis;this.chart.context.save(),this.chart.context.beginPath();var r=i.left,n=i.width;e?(r=0,n=this.width):i.yaxisLHS&&i.yaxisLHS.length&&(r++,n--),this.chart.context.rect(r,a.top,n,a.height),this.chart.context.clip()},I.ChartEngine.prototype.endClip=function(){this.chart.context.restore()},I.ChartEngine.prototype.setLineStyle=function(t,e){var i={};t&&"object"==typeof t?i=t:i.color=t,i.color||i.pattern||i.width||(i=null),e||(e=this.chart);var a=1;i&&i.width&&(a=i.width),i&&i.pattern&&(i.pattern=I.borderPatternToArray(a,i.pattern)),e.lineStyle=i},I.ChartEngine.prototype.setGapLines=function(t,e){var i={};t&&"object"==typeof t?i=t:i.color=t,i.color||i.pattern||i.fillMountain||(i=null),e||(e=this.chart),i&&i.pattern&&(i.pattern=I.borderPatternToArray(i.pattern)),i&&i.width<=0&&(i.width=null),e.gaplines=i},I.ChartEngine.prototype.getGapColorFunction=function(n,s,o,l,h){return"object"!=typeof o&&(o={color:o}),function(t,e,i){var a=h?h(t,e,i):o;a.color&&(a=a.color);var r=e[n];return r||0===r||(r=e[s]),i||!r&&0!==r?l?("object"!=typeof l&&(l="string"==typeof l?{color:l}:{}),{color:l.color||a,pattern:l.pattern||o.pattern,width:l.width||o.width}):null:{color:a,pattern:o.pattern,width:o.width}}},I.ChartEngine.prototype.drawLineChart=function(t,e,i,a){var r=this.chart,n=r.context,s=r.lineStyle||{},o=this.canvasStyle(e);a||(a={}),this.startClip(t.name);var l=a.width||s.width||o.width;l&&parseInt(l,10)<=25?n.lineWidth=Math.max(1,I.stripPX(l)):n.lineWidth=1,a.pattern=a.pattern||s.pattern||o.borderTopStyle,a.pattern=I.borderPatternToArray(n.lineWidth,a.pattern),this.canvasColor(e);var h=a.color||s.color;h&&(n.strokeStyle=h),a.skipProjections=!0;var c=a.field||r.defaultPlotField,u=a.subField||r.defaultPlotField||"Close",p=a.gapDisplayStyle;p||!1===p||(p=a.gaps),p||!1===p||(p=r.gaplines),p||(p="transparent");var d=this.getGapColorFunction(c,u,{color:n.strokeStyle,pattern:a.pattern,width:n.lineWidth},p,i);t.chart.tension&&(a.tension=t.chart.tension);var m=this.plotDataSegmentAsLine(c,t,a,d);return m.colors.length||m.colors.push(n.strokeStyle),n.lineWidth=1,this.endClip(),a.returnObject?m:m.colors},I.ChartEngine.prototype.getPreviousBar=function(t,e,i){return this.getNextBarInternal(t,e,i,-1)},I.ChartEngine.prototype.getNextBar=function(t,e,i){return this.getNextBarInternal(t,e,i,1)},I.ChartEngine.prototype.getNextBarInternal=function(t,e,i,a){var r=t.dataSegment&&t.dataSegment[i];if(r)for(var n=r.tick;0<n&&n<t.dataSet.length;){n+=a;var s=t.dataSet[n];if(s){var o=I.existsInObjectChain(s,e);if(o&&o.obj[o.member])return s}}return null},I.ChartEngine.prototype.getFirstLastDataRecord=function(t,e,i){for(var a=i?t.length-1:0;0<=a&&a<t.length;){if(t[a]&&void 0!==t[a][e])return t[a];i?a--:a++}return null},I.ChartEngine.prototype.updateFloatHRLabel=function(t){var e=t.yaxisLHS.concat(t.yaxisRHS),i=this.crossYActualPos?this.crossYActualPos:this.cy;if(this.floatCanvas.isDirty&&I.clearCanvas(this.floatCanvas,this),!this.controls.crossX||"none"!=this.controls.crossX.style.display){if(this.controls.crossY){var a=t.width;"roundRectArrow"==this.yaxisLabelStyle&&(a-=7),this.controls.crossY.style.left=t.left+"px",this.controls.crossY.style.width=a+"px"}for(var r=0;r<e.length;r++){var n=e[r],s=this.transformedPriceFromPixel(i,t,n);if(!isNaN(s)&&!((n.min||0===n.min)&&s<n.min||(n.max||0===n.max)&&s>n.max)){var o=null;n!==t.chart.yAxis&&(o=this.decimalPlacesFromPriceTick(n.priceTick),(n.decimalPlaces||0===n.decimalPlaces)&&(o=n.decimalPlaces)),s=n.priceFormatter?n.priceFormatter(this,t,s,o):this.formatYAxisPrice(s,t,o,n);var l=this.canvasStyle("stx-float-price");this.createYAxisLabel(t,s,i,l.backgroundColor,l.color,this.floatCanvas.context,n),this.floatCanvas.isDirty=!0}}}},I.ChartEngine.prototype.headsUpHR=function(){if(!this.runPrepend("headsUpHR",arguments)){var t=this.currentPanel;if(t){var e=t.chart;this.updateFloatHRLabel(t);var i=this.controls.floatDate;if(i&&!e.xAxis.noDraw){var a=this.barFromPixel(this.cx),r=e.xaxis[a];r&&r.DT?n(I.displayableDate(this,e,r.DT)):r&&r.index?n(r.index):n("")}this.runAppend("headsUpHR",arguments)}}function n(t){I.efficientDOMUpdate(i,"innerHTML",t)}},I.ChartEngine.prototype.setCrosshairColors=function(){},I.ChartEngine.prototype.magnetize=function(){if(this.magnetizedPrice=null,!this.runPrepend("magnetize",arguments)&&!this.repositioningDrawing){var t=this.currentVectorParameters.vectorType;if(("annotation"!=t&&"callout"!=t||!I.ChartEngine.drawingLine)&&"projection"!=t&&"freeform"!=t){var e=this.currentPanel;if(e.name==e.chart.name){var i=e.chart,a=this.tickFromPixel(I.ChartEngine.crosshairX-this.left,i);if(a>i.dataSet.length)return;var r=i.dataSet[a];if(!r)return;var n=this.valueFromPixel(this.cy,e);if(this.magnetizedPrice=r.Close,this.mainSeriesRenderer&&this.mainSeriesRenderer.highLowBars||this.highLowBars[this.layout.chartType])for(var s=["Open","High","Low","Close"],o=1e9,l=0;l<s.length;l++){var h=r[s[l]];Math.abs(n-h)<o&&(o=Math.abs(n-h),this.magnetizedPrice=h)}var c=this.pixelFromTick(a,i),u=this.pixelFromPrice(this.magnetizedPrice,this.currentPanel),p=this.chart.tempCanvas.context;p.beginPath(),p.lineWidth=1;var d=Math.max(this.layout.candleWidth,12)/3;p.arc(c,u,Math.min(d,8),0,2*Math.PI,!1),p.fillStyle="#FFFFFF",p.strokeStyle="#000000",p.fill(),p.stroke(),p.closePath(),this.chart.tempCanvas.style.display="block"}this.runAppend("magnetize",arguments)}}},I.ChartEngine.prototype.positionCrosshairsAtPointer=function(){var t=this.currentPanel;if(t&&this.manageTouchAndMouse&&!this.runPrepend("positionCrosshairsAtPointer",arguments)){var e=t.chart,i=this.container.getBoundingClientRect();this.top=i.top,this.left=i.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cy=this.crossYActualPos=this.backOutY(I.ChartEngine.crosshairY),this.cx=this.backOutX(I.ChartEngine.crosshairX);var a=this.crosshairTick=this.tickFromPixel(this.cx,e),r=this.pixelFromTick(a,e)-1;if(this.controls.crossX&&(this.controls.crossX.style.left=r+"px"),r>=t.right||r<=t.left)this.undisplayCrosshairs();else{var n="chart"==t.name?this.preferences.horizontalCrosshairField:t.horizontalCrosshairField,s=e.dataSet;n&&s&&a<s.length&&-1<a&&(this.crossYActualPos=this.pixelFromPrice(s[a][n],t)),this.controls.crossY&&(this.controls.crossY.style.top=this.crossYActualPos+"px"),this.runAppend("positionCrosshairsAtPointer",arguments)}}},I.ChartEngine.prototype.doDisplayCrosshairs=function(){if(!this.runPrepend("doDisplayCrosshairs",arguments)){if(this.displayInitialized){var t=this.floatCanvas,e=this.currentVectorParameters.vectorType;if(this.layout.crosshair||""!==e&&e)if(I.Drawing&&I.Drawing[e]&&(new I.Drawing[e]).dragToDraw)this.undisplayCrosshairs();else if(this.overXAxis||this.overYAxis||!I.ChartEngine.insideChart&&!this.grabbingScreen)this.undisplayCrosshairs();else if(""!==this.openDialog)this.undisplayCrosshairs();else{var i=this.controls,a=i.crossX,r=i.crossY;a&&""!==a.style.display&&(a.style.display="",r&&(r.style.display=""),this.preferences.magnet&&e?(I.unappendClassName(this.container,"stx-crosshair-on"),this.chart.tempCanvas.style.display="block"):I.appendClassName(this.container,"stx-crosshair-on")),i.floatDate&&!this.chart.xAxis.noDraw&&(i.floatDate.style.visibility="",this.currentPanel&&this.updateFloatHRLabel(this.currentPanel)),t&&(t.style.display="block")}else this.undisplayCrosshairs()}this.runAppend("doDisplayCrosshairs",arguments)}},I.ChartEngine.prototype.undisplayCrosshairs=function(){if(!this.runPrepend("undisplayCrosshairs",arguments)){var t=this.controls,e=t.crossX,i=t.crossY;e&&"none"!=e.style.display&&(e.style.display="none",i&&(i.style.display="none")),this.displayInitialized&&t.floatDate&&(t.floatDate.style.visibility="hidden"),I.unappendClassName(this.container,"stx-crosshair-on");var a=this.floatCanvas;if(a&&a.isDirty&&(I.clearCanvas(a,this),"none"!=a.style.display&&(a.style.display="none")),!this.activeDrawing&&!this.repositioningDrawing&&!this.editingAnnotation){var r=this.chart.tempCanvas;r&&"none"!=r.style.display&&(r.style.display="none")}this.runAppend("undisplayCrosshairs",arguments)}},I.ChartEngine.prototype.modalBegin=function(){this.openDialog="modal",this.undisplayCrosshairs()},I.ChartEngine.prototype.modalEnd=function(){this.cancelTouchSingleClick=!0,this.openDialog="",this.doDisplayCrosshairs()},I.ChartEngine.prototype.updateChartAccessories=function(){var t;if(null!==this.accessoryTimer&&clearTimeout(this.accessoryTimer),!I.ChartEngine.drawingLine&&I.touchDevice&&(new Date).getTime()-this.lastAccessoryUpdate<100)this.accessoryTimer=setTimeout((t=this,function(){t.updateChartAccessories()}),10);else if(this.chart.dataSet&&!this.runPrepend("updateChartAccessories",arguments)){this.positionCrosshairsAtPointer(),this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime();var e=this.controls.floatDate;if(e){var i=this.currentPanel;if(i||(i=this.chart.panel),i){var a=i.chart,r=!0===this.xAxisAsFooter?0:this.chart.canvasHeight-i.chart.bottom,n=e.offsetWidth/2-.5,s=this.pixelFromTick(this.crosshairTick,a)-n;s<0?s=0:s>this.width-2*n-1&&(s=this.width-2*n-1),I.efficientDOMUpdate(e.style,"left",s+"px"),I.efficientDOMUpdate(e.style,"bottom",r+"px")}}this.headsUpHR(),this.runAppend("updateChartAccessories",arguments)}},I.ChartEngine.prototype.mousemove=function(t){var e=t||event;I.ChartEngine.crosshairX=e.clientX,I.ChartEngine.crosshairY=e.clientY,-1<e.type.toLowerCase().indexOf("enter")?this.positionCrosshairsAtPointer():this.runPrepend("mousemove",arguments)||this.displayInitialized&&""===this.openDialog&&(this.mousemoveinner(e.clientX,e.clientY),this.runAppend("mousemove",arguments))},I.ChartEngine.prototype.setResizeTimer=function(t){var e;this.resizeDetectMS=t,this.resizeTimeout=t?(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),window.setInterval((e=this,function(){e.chart.canvas&&(I.isAndroid||e.chart.canvas.height==Math.floor(e.devicePixelRatio*e.chart.container.clientHeight)&&e.chart.canvas.width==Math.floor(e.devicePixelRatio*e.chart.container.clientWidth)||e.resizeChart())}),t)):(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),null)},I.ChartEngine.prototype.whichYAxis=function(t,e){if(void 0===e&&(e=this.cx),t)for(var i=t.yaxisLHS.concat(t.yaxisRHS),a=0;a<i.length;a++){var r=i[a];if(r.left<=e&&r.left+r.width>=e)return r}return null},I.ChartEngine.prototype.findHighlights=function(t,e){var i=this.preferences[t?"highlightsTapRadius":"highlightsRadius"];this.highlightViaTap=t;var a=this.cy,r=this.cx;if(this.anyHighlighted=!1,this.currentPanel){!this.preferences.magnet||this.activeDrawing||this.repositioningDrawing||I.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing&&(e=!0);var n,s,o,l=!1,h=null,c=e?{}:{forceShow:!0,type:"drawing"},u=this.currentPanel.chart,p={x0:this.tickFromPixel(r-i,u),x1:this.tickFromPixel(r+i,u),y0:this.valueFromPixel(a-i,this.currentPanel),y1:this.valueFromPixel(a+i,this.currentPanel)};this.repositioningDrawing&&p.x1-p.x0<2?(p.x1++,p.x0--):p.x1==p.x0&&(p.x0-=.5,p.x1+=.5);for(var d=this.drawingObjects.length-1;0<=d;d--){var m=this.drawingObjects[d];if(this.panels[m.panelName]&&(!this.repositioningDrawing||this.repositioningDrawing==m)){var g=m.highlighted,f=m.panelName==this.currentPanel.name;m.repositioner=m.intersected(this.crosshairTick,this.crosshairValue,p),f=f&&m.repositioner,!e&&f?(g?(h=m,this.anyHighlighted&&this.singleDrawingHighlight&&(m.highlighted=!1)):g!=m.highlight(!0)&&(h||(h=m),this.anyHighlighted&&this.singleDrawingHighlight&&(m.highlighted=!1),l=!0),this.anyHighlighted=!0):g!=m.highlight(!1)&&(l=!0),m.highlighted&&(c.noDelete=m.permanent)}}for(n in this.overlays)(s=this.overlays[n]).prev=s.highlight,s.highlight=!1;for(n in u.seriesRenderers)for(var y=u.seriesRenderers[n],v=0;v<y.seriesParams.length;v++)(o=y.seriesParams[v]).prev=o.highlight,o.highlight=!1;if(!e){var M=this.barFromPixel(r);if(0<=M&&M<u.dataSegment.length){var x;for(n in this.overlays)if((s=this.overlays[n]).panel==this.currentPanel.name&&!1!==s.study.isHighlighted)if("function"!=typeof s.study.isHighlighted){if(u.dataSegment[M]){for(var C in s.outputMap)if(s.outputMap[C]&&N.call(this,M,p,C,this.getYAxisByName(s.panel,s.name))){s.highlight=!0,this.anyHighlighted=!0;break}if(s.highlight)break}}else s.study.isHighlighted(this,r,a)&&(s.highlight=!0,this.anyHighlighted=!0);for(n in u.seriesRenderers){var S=u.seriesRenderers[n],b=S.params.panel;if(S.params.highlightable&&b==this.currentPanel.name)for(var w=0;w<S.seriesParams.length;w++){var T=(o=S.seriesParams[w]).field;o.symbol&&o.subField&&(T+="--\x3e"+o.subField);var D=S.params.yAxis;if(!D&&b&&(D=this.panels[b].yAxis),S.params.step&&0<M){if(!S.caches[o.id])continue;if(!(x=S.caches[o.id][M])&&0!==x)continue;var A=S.caches[o.id][M-1];((A||0===A)&&x<=a+i&&a-i<=A||a-i<=x&&A<=a+i)&&(o.highlight=!0,this.anyHighlighted=!0)}else N.call(this,M,p,T,D,S.caches[o.id])&&(o.highlight=!0,this.anyHighlighted=!0)}}}}for(n in this.overlays){if((s=this.overlays[n]).highlight){this.anyHighlighted=!0;var k=s.inputs.display||s.name;c={message:k=this.translateIf(k),noDelete:s.permanent,type:"study"},h=null}s.prev!=s.highlight&&(l=!0)}for(n in u.seriesRenderers){var F=u.seriesRenderers[n];if(F.params.highlightable)for(var P=F.params.yAxis?F.params.yAxis.textStyle:null,_=0;_<F.seriesParams.length;_++)(o=F.seriesParams[_]).highlight&&(this.anyHighlighted=!0,c={message:o.display||o.symbol,backgroundColor:o.color||P,noDelete:o.permanent,type:"series"},h=null),o.prev!=o.highlight&&(l=!0)}l&&(this.draw(),this.displaySticky(this.anyHighlighted?c:{}),this.clearMeasure(),h&&h.measure()),this.anyHighlighted||this.setMeasure()}function N(t,e,i,a,r){var n=this.chart,s=this.currentPanel;a||(a=s.yAxis);var o=i.split("--\x3e"),l=o[0],h=o[1];function c(t){if(!t)return null;var e=t[l];return e&&(e[h]||0===e[h])&&(e=e[h]),n.transformFunc&&a==n.yAxis?t.transform&&l in t.transform?((e=t.transform[l])&&(e[h]||0===e[h])&&(e=e[h]),e):n.transformFunc(this,n,e):e}h||(h="Close");var u,p,d,m,g,f=n.dataSegment[M],y=null,v=null,x=null,C=new Array(3);if(f&&r){var S;for(d=r[M],y=f.tick,(d||0===d)&&(C[0]=1),S=M-1;0<=S;S--)if(r[S]||0===r[S]){m=r[S],v=y-(M-S),C[1]=1;break}for(S=M+1;S<n.dataSegment.length;S++)if(r[S]||0===r[S]){g=r[S],x=y-(M-S),C[2]=1;break}}if(null===v&&(u=this.getPreviousBar.call(this,n,i,M))&&(v=u.tick,m=c(u)),null===x&&(p=this.getNextBar.call(this,n,i,M))&&(x=p.tick,g=c(p)),null===v&&null===x)return!1;r||(d=c(f),m=c(u),g=c(p),y=f.tick,u&&(v=u.tick),p&&(x=p.tick)),m||0===m||(v=m=0),g||0===g||(C[2]=d||0===d?(g=d,C[0]):(g=m,C[1]),x=n.dataSet.length-1),d||0===d||(d=g,y=x,C[0]=C[2],0===m&&0===v&&(m=d,v=y,C[1]=C[0]));var b=this.pixelFromTransformedValue.bind(this),w=this.valueFromPixel.bind(this);d=w(C[0]?d:b(d,s,a),s),m=w(C[1]?m:b(m,s,a),s),g=w(C[2]?g:b(g,s,a),s);var T=I.convertBoxToPixels(this,s.name,e),D=I.convertBoxToPixels(this,s.name,{x0:v,y0:m,x1:y,y1:d}),A=I.convertBoxToPixels(this,s.name,{x0:y,y0:d,x1:x,y1:g});return!(!I.boxIntersects(T.x0,T.y0,T.x1,T.y1,D.x0,D.y0,D.x1,D.y1,"segment")&&!I.boxIntersects(T.x0,T.y0,T.x1,T.y1,A.x0,A.y0,A.x1,A.y1,"segment"))}},I.ChartEngine.prototype.positionSticky=function(t){var e=Math.max(this.cy-t.offsetHeight-60,0),i=Math.min(this.chart.canvasWidth-(this.cx-50),this.chart.canvasWidth-t.offsetWidth);t.style.top=e+"px",t.style.right=i+"px"},I.ChartEngine.prototype.displaySticky=function(t){var e=this.controls.mSticky;if(e){var i=w(".mStickyInterior",e);if(i){var a=w(".overlayTrashCan",e),r=w(".overlayEdit",e),n=w(".mouseDeleteInstructions",e);t&&"object"==typeof t||(t={message:t,backgroundColor:arguments[1],forceShow:arguments[2],noDelete:arguments[3],type:arguments[4]});var s=t.message,o=t.backgroundColor,l=t.forceShow,h=t.noDelete,c=t.type;if(l||s){s||(s=""),i.style.display=l&&!s?(i.style.backgroundColor="",i.style.color="","none"):(i.style.color=o?(i.style.backgroundColor=o,I.chooseForegroundColor(o)):i.style.backgroundColor="","inline-block"),i.innerHTML=s;var u=w(".mStickyRightClick",e);u.className="mStickyRightClick",c&&I.appendClassName(u,"rightclick_"+c),u.style.display="",e.style.display="inline-block",this.positionSticky(e),h||!0===this.bypassRightClick||this.bypassRightClick[c]?u.style.display="none":this.highlightViaTap||this.touches.length?(a&&(a.style.display="inline-block"),r&&(r.style.display="inline-block"),n&&(n.style.display="none")):n&&(n.style.display="block")}else i.innerHTML="",e.style.display="none",a&&(a.style.display="none"),r&&(r.style.display="none"),n&&(n.style.display="none")}}},I.ChartEngine.prototype.setMeasure=function(t,e,i,a,r){if(!this.runPrepend("setMeasure",arguments)){var n=w(".mMeasure",this.chart.drawingContainer),s="";if(t){if(!1!==e){var o=Math.round(Math.abs(t-e)*this.chart.roundit)/this.chart.roundit;o=o.toFixed(this.chart.yAxis.printDecimalPlaces),this.internationalizer?s+=this.internationalizer.numbers.format(o):s+=o;var l=(e-t)/t;l=.1<Math.abs(l)?Math.round(100*l):.01<Math.abs(l)?Math.round(1e3*l)/10:Math.round(1e4*l)/100,this.internationalizer?l=this.internationalizer.percent.format(l/100):l+="%",s+=" ("+l+")"}if(!1!==a){var h=Math.abs(a-i);s+=" "+(h=Math.round(h)+1)+" "+this.translateIf("Bars")}n&&(n.innerHTML=s)}else this.anyHighlighted||""!==this.currentVectorParameters.vectorType||this.clearMeasure();if(!this.activeDrawing){if(n=this.controls.mSticky){var c=n.children[0];r?(n.style.display="inline-block",c.style.display="inline-block",t&&(c.innerHTML=s),this.positionSticky(n)):(n.style.display="none",c.innerHTML="")}this.runAppend("setMeasure",arguments)}}},I.ChartEngine.prototype.clearMeasure=function(){var t=w(".mMeasure",this.chart.drawingContainer);t&&(t.innerHTML="")},I.ChartEngine.prototype.pixelFromBar=function(t,e){e||(e=this.chart);var i=0,a=this.chart.segmentImage;return i=a&&a[t]&&a[t].leftOffset?a[t].leftOffset:(t+.5)*this.layout.candleWidth,i=e.panel.left+Math.floor(i+this.micropixels)-1},I.ChartEngine.prototype.barFromPixel=function(t,e){e||(e=this.chart);var i=this.chart.segmentImage,a=this.micropixels,r=this.layout.candleWidth;if(i){var n,s,o,l=t-e.panel.left-a,h=2,c=i.length,u=Math.round(c/h),p=i[c-1].leftOffset+i[c-1].candleWidth/2;if(p<l)return c+Math.floor((t-p-e.panel.left-a)/r);for(var d=1;d<c&&(h*=2,n=i[u]);d++){var m=(s=n.leftOffset)-(o=n.candleWidth/2);if(0===u||m<=l&&l<s+o)break;l<m?u-=Math.max(1,Math.round(c/h)):u+=Math.max(1,Math.round(c/h)),u=Math.max(0,Math.min(c-1,u))}if(!i[u])for(d=0;d<c;d++)if(n=i[d]){if(l<(s=n.leftOffset)-(o=n.candleWidth/2))return Math.max(0,d-1);if(l<s+o)return d;if(s+o<=l)return d+1}return u}return Math.floor((t-e.panel.left-a)/r)},I.ChartEngine.prototype.tickFromPixel=function(t,e){e||(e=this.chart);var i=e.dataSet.length-e.scroll;return e.segmentImage?i+=this.barFromPixel(t,e):i+=Math.floor((t-e.panel.left-this.micropixels)/this.layout.candleWidth),i},I.ChartEngine.prototype.pixelFromTick=function(t,e){e||(e=this.chart);var i=e.dataSegment,a=e.dataSet,r=e.segmentImage,n=this.micropixels,s=i?i.length:0,o=e.panel,l=e.scroll,h=t-a.length+l,c=s?i[h]:null;if(r&&(c=r[h]),c&&c.leftOffset)return o.left+Math.floor(c.leftOffset+n);var u=0,p=0;return c=s?i[s-1]:null,r&&(c=r[s-1]),c&&c.leftOffset&&s<t-a.length+l&&(u=c.leftOffset-c.candleWidth/2,p=s),u+o.left+Math.floor((t-p-a.length+l+.5)*this.layout.candleWidth+n)},I.ChartEngine.prototype.pixelFromDate=function(t,e,i,a){return this.pixelFromTick(this.tickFromDate(t,e,i,a),e)},I.ChartEngine.prototype.transformedPriceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a=i||e.yAxis;if(t=a.bottom-t,!a.multiplier)return null;var r=a.low+t/a.multiplier;if(a.semiLog){var n=a.logLow+t*a.logShadow/a.height;r=Math.pow(10,n)}return r},I.ChartEngine.prototype.priceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a=this.transformedPriceFromPixel(t,e,i);return this.charts[e.name]&&e.chart.untransformFunc&&(i&&i!=e.yAxis||(a=e.chart.untransformFunc(this,e.chart,a,i))),a},I.ChartEngine.prototype.valueFromPixel=function(t,e,i){return e||(e=this.whichPanel(t)),e||(e=t<=0?this.panels[I.first(this.panels)]:this.panels[I.last(this.panels)]),this.priceFromPixel(t,e,i)},I.ChartEngine.prototype.valueFromPixelUntransform=function(t,e,i){return this.valueFromPixel(t,e,i)},I.ChartEngine.prototype.pixelFromPriceTransform=function(t,e,i){return this.pixelFromPrice(t,e,i)},I.ChartEngine.prototype.pixelFromTransformedValue=function(t,e,i){e||(e=this.chart.panel);var a=i||e.yAxis,r=(a.high-t)*a.multiplier;if(a.semiLog){var n=Math.max(t,0),s=Math.log(n)/Math.LN10,o=a.height;r=o-o*(s-a.logLow)/a.logShadow}return r+=a.top},I.ChartEngine.prototype.pixelFromPrice=function(t,e,i){return e||(e=this.chart.panel),this.charts[e.name]&&e.chart.transformFunc&&(i&&i!=e.yAxis||(t=e.chart.transformFunc(this,e.chart,t,i))),this.pixelFromTransformedValue(t,e,i)},I.ChartEngine.prototype.pixelFromValueAdjusted=function(t,e,i,a){if(this.layout.adj||!this.charts[t.name])return this.pixelFromPrice(i,t,a);var r,n=Math.round(e);return 0<n&&n<t.chart.dataSet.length&&(r=t.chart.dataSet[n].ratio)?this.pixelFromPrice(i*r,t,a):this.pixelFromPrice(i,t,a)},I.ChartEngine.prototype.adjustIfNecessary=function(t,e,i){if(this.layout.adj)return i;if(!t||!this.charts[t.name])return i;var a,r=Math.round(e);return 0<r&&r<t.chart.dataSet.length&&(a=t.chart.dataSet[r].ratio)?i/a:i},I.ChartEngine.prototype.setTransform=function(t,e,i){t.transformFunc=e,t.untransformFunc=i},I.ChartEngine.prototype.unsetTransform=function(t){delete t.transformFunc,delete t.untransformFunc;for(var e=0;t.dataSet&&e<t.dataSet.length;e++)t.dataSet[e].transform=null},I.ChartEngine.prototype.undo=function(){this.runPrepend("undo",arguments)||(this.activeDrawing&&(this.activeDrawing.abort(),this.activateDrawing(null),I.clearCanvas(this.chart.tempCanvas,this),this.draw(),I.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),I.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing"),I.ChartEngine.drawingLine=!1),this.runAppend("undo",arguments))},I.ChartEngine.prototype.undoStamp=function(t,e){this.undoStamps.push(t),this.dispatch("undoStamp",{before:t,after:e,stx:this})},I.ChartEngine.prototype.undoLast=function(){this.activeDrawing?this.undo():this.undoStamps.length&&(this.drawingObjects=this.undoStamps.pop(),this.changeOccurred("vector"),this.draw())},I.ChartEngine.prototype.addDrawing=function(t){var e=I.shallowClone(this.drawingObjects);this.drawingObjects.push(t),this.undoStamp(e,I.shallowClone(this.drawingObjects))},I.ChartEngine.prototype.connectTheDots=function(t,e,i,a,r,n){if(n||(n={}),"none"!=n.pattern&&(!0===r&&(r=this.chart.panel),null==a&&(a=this.chart.context),!(t.length<4))){var s=0,o=this.chart.canvasHeight,l=this.chart.width;r&&(o=r.yAxis.bottom,s=r.yAxis.top),a.lineWidth=1.1,"object"==typeof e?(a.strokeStyle=e.color,e.opacity?a.globalAlpha=e.opacity:a.globalAlpha=1,a.lineWidth=parseInt(I.stripPX(e.width),10)):!e||"auto"==e||I.isTransparent(e)?a.strokeStyle=this.defaultColor:a.strokeStyle=e,n.opacity&&(a.globalAlpha=n.opacity),n.lineWidth&&(a.lineWidth=n.lineWidth);var h=I.borderPatternToArray(a.lineWidth,n.pattern);a.beginPath();for(var c=0;c<t.length-2;c+=2){var u=t[c],p=t[c+1],d=t[c+2],m=t[c+3];if(isNaN(u)||isNaN(d)||isNaN(p)||isNaN(m))return;for(var g,f,y,v=0,x=1,C=d-u,S=m-p,b=0;b<4;b++){if(0===b&&(g=-C,f=-(0-u)),1==b&&(g=C,f=l-u),2==b&&(g=-S,f=-(s-p)),3==b&&(g=S,f=o-p),y=f/g,(m||0===m)&&0===g&&f<0)return!1;if(g<0){if(x<y)return!1;v<y&&(v=y)}else if(0<g){if(y<v)return!1;y<x&&(x=y)}}var w=u+v*C,T=p+v*S,D=u+x*C,A=p+x*S;try{h&&h.length?a.dashedLineTo(w,T,D,A,h):(a.moveTo(w,T),a.lineTo(D,A))}catch(t){}}a.stroke(),a.closePath(),a.globalAlpha=1,a.lineWidth=1}},I.ChartEngine.prototype.plotSpline=function(t,e,i,a,r,n,s){if(s||(s={}),"none"!=s.pattern){!0===n&&(n=this.chart.panel),null==r&&(r=this.chart.context),r.save(),r.lineWidth=1.1,"object"==typeof i?(r.strokeStyle=i.color,i.opacity?r.globalAlpha=i.opacity:r.globalAlpha=1,r.lineWidth=parseInt(I.stripPX(i.width),10)):!i||"auto"==i||I.isTransparent(i)?r.strokeStyle=this.defaultColor:r.strokeStyle=i,s.opacity&&(r.globalAlpha=s.opacity),s.lineWidth&&(r.lineWidth=s.lineWidth);var o=I.borderPatternToArray(r.lineWidth,s.pattern);s.pattern&&r.setLineDash&&(r.setLineDash(o),r.lineDashOffset=0),r.beginPath(),u.plotSpline(t,e,r),r.stroke(),r.closePath(),r.restore()}},I.ChartEngine.prototype.repositionDrawing=function(t,e){var i=this.panels[t.panelName],a=this.adjustIfNecessary(i,this.crosshairTick,this.valueFromPixel(this.backOutY(I.ChartEngine.crosshairY),i)),r=this.chart.tempCanvas;I.clearCanvas(r,this),e?t.render(r.context):t.reposition(r.context,t.repositioner,this.crosshairTick,a),t.measure&&t.measure()},I.ChartEngine.prototype.activateRepositioning=function(t){(this.repositioningDrawing=t)&&(this.draw(),this.repositionDrawing(t,!0)),this.chart.tempCanvas.style.display=t?"block":"none"},I.ChartEngine.prototype.activateDrawing=function(t,e){if(!t)return this.activeDrawing=null,!(this.chart.tempCanvas.style.display="none");e||(e=this.chart.panel);var i=I.ChartEngine.drawingTools[t];return i||I.Drawing[t]&&(i=I.Drawing[t],I.ChartEngine.registerDrawingTool(t,i)),i&&(this.activeDrawing=new i,this.activeDrawing.construct(this,e),!this.charts[e.name]&&this.activeDrawing.chartsOnly)?(this.activeDrawing=null,!1):(this.chart.tempCanvas.style.display="block",!0)},I.ChartEngine.prototype.drawingClick=function(t,e,i){if(I.Drawing&&t&&""===this.openDialog&&(this.activeDrawing||this.activateDrawing(this.currentVectorParameters.vectorType,t))){if(this.activeDrawing){if(this.userPointerDown&&!this.activeDrawing.dragToDraw)return void(I.ChartEngine.drawingLine||this.activateDrawing(null));var a=this.tickFromPixel(e,t.chart),r=this.panels[this.activeDrawing.panelName],n=this.adjustIfNecessary(r,a,this.valueFromPixel(i,r));return this.preferences.magnet&&this.magnetizedPrice&&(n=this.adjustIfNecessary(r,a,this.magnetizedPrice)),this.activeDrawing.click(this.chart.tempCanvas.context,a,n)?this.activeDrawing&&(I.ChartEngine.drawingLine=!1,I.clearCanvas(this.chart.tempCanvas,this),this.addDrawing(this.activeDrawing),this.activateDrawing(null),this.adjustDrawings(),this.draw(),this.changeOccurred("vector"),I.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),I.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing")):(this.changeOccurred("drawing"),I.ChartEngine.drawingLine=!0,I.swapClassName(this.controls.crossX,"stx_crosshair_drawing","stx_crosshair"),I.swapClassName(this.controls.crossY,"stx_crosshair_drawing","stx_crosshair")),!0}return!1}},I.ChartEngine.prototype.whichPanel=function(t){for(var e in this.panels){var i=this.panels[e];if(!i.hidden&&t>i.top&&t<i.bottom)return i}return null},I.ChartEngine.prototype.mouseup=function(t){if(!this.runPrepend("mouseup",arguments)){if(this.swipe.end=!0,this.cancelLongHold=!0,this.repositioningDrawing){if(!this.currentVectorParameters.vectorType||250<Date.now()-this.mouseTimer)return this.changeOccurred("vector"),I.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.adjustDrawings(),void this.draw();this.activateRepositioning(null)}if(this.repositioningBaseline){this.repositioningBaseline=null;var e=this.mainSeriesRenderer||{};return e.params&&e.params.baseline&&"mountain"!=e.params.type&&(this.chart.panel.yAxis.scroll=this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel)-(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2),void this.draw()}var i=this.userPointerDown;if(this.userPointerDown=!1,this.displayInitialized)if(this.grabbingScreen=!1,""===this.openDialog){if(this.grabOverrideClick)return this.overXAxis||this.overYAxis||this.swipeRelease(),I.unappendClassName(this.container,"stx-drag-chart"),this.grabOverrideClick=!1,this.doDisplayCrosshairs(),void this.updateChartAccessories();if(I.ChartEngine.insideChart&&I.unappendClassName(this.container,"stx-drag-chart"),I.ChartEngine.resizingPanel)this.releaseHandle();else{t||(t=event);var a=this.backOutY(t.clientY),r=this.backOutX(t.clientX);if(t.which&&2<=t.which||t.button&&2<=t.button||t.ctrlKey)return this.anyHighlighted&&!0!==this.bypassRightClick?(this.rightClickHighlighted(),t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t.stopPropagation(),!1):(this.dispatch("rightClick",{stx:this,panel:this.currentPanel,x:r,y:a}),!0);t.clientX<this.left||t.clientX>this.right||t.clientY<this.top||t.clientY>this.bottom||(!i||this.longHoldTookEffect&&!this.activeDrawing||this.drawingClick(this.currentPanel,r,a),this.activeDrawing||this.longHoldTookEffect||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:r,y:a}),this.runAppend("mouseup",arguments))}}else I.ChartEngine.insideChart&&I.unappendClassName(this.container,"stx-drag-chart")}},I.ChartEngine.prototype.grabbingHand=function(){this.allowScroll&&this.grabbingScreen&&(I.touchDevice||I.appendClassName(this.container,"stx-drag-chart"))},I.ChartEngine.prototype.mousedown=function(t){if(!this.runPrepend("mousedown",arguments)&&(this.grabOverrideClick=!1,this.displayInitialized&&this.displayCrosshairs&&!this.repositioningDrawing&&!(this.editingAnnotation||(t||(t=event),t.which&&2<=t.which||t.button&&2<=t.button)))){var e=this.container.getBoundingClientRect();if(this.top=e.top,this.left=e.left,this.right=this.left+this.width,this.bottom=this.top+this.height,t.clientX>=this.left&&t.clientX<=this.right&&t.clientY>=this.top&&t.clientY<=this.bottom){if(I.ChartEngine.insideChart=!0,this.currentPanel){this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.hasDragged=!1,this.userPointerDown=!0;for(var i=this.currentPanel.chart,a=0;a<this.drawingObjects.length;a++){var r=this.drawingObjects[a];if(r.highlighted&&!r.permanent){if(this.cloneDrawing){var n=new I.ChartEngine.drawingTools[r.name];return n.reconstruct(this,r.serialize()),this.drawingObjects.push(n),this.activateRepositioning(n),void(n.repositioner=r.repositioner)}var s=this.currentVectorParameters.vectorType;if(!(I.Drawing&&s&&I.Drawing[s]&&(new I.Drawing[s]).dragToDraw))return void this.activateRepositioning(r)}}var o,l=this.mainSeriesRenderer||{};if(l.params&&l.params.baseline&&!1!==i.baseline.userLevel&&this.controls.baselineHandle){var h=this.valueFromPixel(this.cy-5,this.currentPanel),c=this.valueFromPixel(this.cy+5,this.currentPanel),u=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10);if(i.baseline.actualLevel<h&&i.baseline.actualLevel>c&&this.cx>u)return void(this.repositioningBaseline={lastDraw:Date.now()})}this.drawingClick(this.currentPanel,this.cx,this.cy),this.activeDrawing&&this.activeDrawing.dragToDraw||(this.grabbingScreen=!0,i.spanLock=!1,this.yToleranceBroken=!1,t||(t=event),this.grabStartX=t.clientX,this.grabStartY=t.clientY,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=i.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(this.currentPanel),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPanel=this.currentPanel,setTimeout((o=this,function(){o.grabbingHand()}),100),this.swipeStart(i),this.longHoldTime&&this.startLongHoldTimer(),this.runAppend("mousedown",arguments))}}else I.ChartEngine.insideChart=!1}},I.ChartEngine.prototype.startLongHoldTimer=function(){var t=this;this.cancelLongHold=!1,this.longHoldTimeout&&clearTimeout(this.longHoldTimeout),this.longHoldTimeout=setTimeout(function(){t.cancelLongHold||(t.dispatch("longhold",{stx:t,panel:t.currentPanel,x:t.cx,y:t.cy}),t.longHoldTookEffect=!0)},this.longHoldTime)},I.ChartEngine.prototype.changeVectorType=function(t){this.currentVectorParameters.vectorType=t,I.Drawing.initializeSettings(this,t),I.ChartEngine.drawingLine&&this.undo(),this.setCrosshairColors(),I.ChartEngine.insideChart&&this.doDisplayCrosshairs()},I.ChartEngine.prototype.changeVectorParameter=function(t,e){"axisLabel"==t?e="true"===e.toString()||Number(e):"lineWidth"==t?e=Number(e):"fontSize"==t&&(e=parseInt(e,10)+"px");var i=this.currentVectorParameters;return void 0!==i[t]?(i[t]=e,!0):"font"==t.substr(0,4)&&("family"==(t=t.substr(4).toLowerCase())&&"default"==e.toLowerCase()&&(e=null),void 0!==(i=i.annotation.font)[t])&&(i[t]=e,!0)},I.ChartEngine.prototype.rightClickOverlay=function(t,e){if(!this.runPrepend("rightClickOverlay",arguments)){var i=this.overlays[t];i.editFunction?i.editFunction(e):this.removeOverlay(t),this.runAppend("rightClickOverlay",arguments)}},I.ChartEngine.prototype.addOverlay=function(t){this.runPrepend("addOverlay",arguments)||(this.overlays[t.name]=t,this.runAppend("addOverlay",arguments))},I.ChartEngine.prototype.removeOverlay=function(t){if(!this.runPrepend("removeOverlay",arguments)){var e=this.overlays[t];for(var i in this.overlays){var a=this.overlays[i],r=["Field"];I.Studies&&(r=I.Studies.getFieldInputs(a));for(var n=0;n<r.length;n++)e.outputMap[a.inputs[r[n]]]&&this.removeOverlay(a.name)}if(I.Studies){var s=this.layout.studies[t];I.deleteRHS(I.Studies.studyPanelMap,s),e&&this.cleanupRemovedStudy(e)}if(e){var o=this.panels[e.panel];delete this.overlays[t],this.deleteYAxisIfUnused(o,this.getYAxisByName(o,t))}this.currentlyImporting||(this.displaySticky(),this.createDataSet(),this.changeOccurred("layout")),this.resetDynamicYAxis(),this.runAppend("removeOverlay",arguments)}},I.ChartEngine.prototype.addSeries=function(s,o,r){var t=this.runPrepend("addSeries",arguments);if(t)return t;var e=s||null,n=s;s||(s=I.uniqueID());var l={parameters:o?I.clone(o):{},yValueCache:[],display:e,id:s,loading:!0};(o=l.parameters).symbol&&(n=o.symbol),o.yAxis&&(o.yAxis=new I.ChartEngine.YAxis(o.yAxis)),I.ensureDefaults(o,{chartName:this.chart.name,symbolObject:{symbol:n},panel:this.chart.panel.name,fillGaps:!1,action:"add-series"}),"display"in o&&(l.display=o.display),o.isComparison&&(o.shareYAxis=!0);var i=this.charts[o.chartName],a=o.symbolObject;n=o.symbol=a.symbol,l.display||(l.display=n||o.field),l.endPoints={},o.gapDisplayStyle||!1===o.gapDisplayStyle||(o.gapDisplayStyle=o.gaps),o.isComparison&&void 0===o.gapDisplayStyle&&(o.gapDisplayStyle="transparent");var h=this.getSeries({symbolObject:a,chart:i,includeMaster:!0});i.series[s]=l;var c=this;function u(t,e){var i=o.renderer||"Lines",a=o.name||I.uniqueID();if(o.renderer||o.name||o.color||o.chartType){var r=t.getSeriesRenderer(a);if(!r){var n={name:a,overChart:!0,useChartLegend:!0};if(!(r=o.chartType?(n=I.extend({panel:o.panel,yAxis:o.yAxis},n),I.Renderer.produce(o.chartType,n)):(I.ensureDefaults(o,{name:n.name,overChart:!0,useChartLegend:!0}),new I.Renderer[i]({params:o}))))return;t.setSeriesRenderer(r)}r.attachSeries(s,o),!1!==o.loadData&&r.ready()}}function p(a){return function(t){if(!t.error){var e=t.quotes,i=o.fillGaps;c.cleanupGaps||(i=!1),e=c.doCleanupGaps(e,c.chart,{cleanupGaps:i}),c.updateChartData(e,c.chart,{secondarySeries:n,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),l.loading=!1,u(c)}null===o.action||h.length||c.dispatch(c.currentlyImporting?"symbolImport":"symbolChange",{stx:c,symbol:a.symbol,symbolObject:a.symbolObject,action:o.action}),r&&r.call(c,t.error,l)}}o.isComparison&&this.setComparison(!0,i);var d=i.masterData;d||(d=i.masterData=this.masterData=[]);var m=d.length;if(o.data&&!o.data.useDefaultQuoteFeed)p({symbol:n,symbolObject:a,action:o.action})({quotes:o.data});else if(h.length)l.endPoints=h[0].endPoints,u(this),r&&setTimeout(function(){r.call(c,null,l)},0);else if(this.quoteDriver&&!1!==o.loadData){var g=this.quoteDriver,f=g.makeParams(n,a,i);m&&(f.startDate=d[0].DT,f.endDate=this.isHistoricalMode()?d[d.length-1].DT:new Date),f.stx.isEquationChart(f.symbol)?I.fetchEquationChart(f,p(f)):I.ChartEngine.Driver.fetchData(I.QuoteFeed.SERIES,g.quoteFeed,f,p(f))}else u(this),r&&r.call(this,null,l);return this.runAppend("addSeries",arguments),l},I.ChartEngine.prototype.getSeries=function(t){var e=t.chart?t.chart:this.chart,i=e.series,a=t.symbolObject;a||(a={symbol:t.symbol});var r=[];for(var n in i){var s=i[n];I.symbolEqual(a,s.parameters.symbolObject)&&r.push(s)}return t.includeMaster&&I.symbolEqual(a,e.symbolObject)&&r.push({}),r},I.ChartEngine.prototype.modifySeries=function(t,e){var i,a,r;if(!this.runPrepend("modifySeries",arguments)&&e&&("string"==typeof t?(a=t,i=(r=e.chartName?this.charts[e.chartName]:this.chart).series[a]):(a=(i=t).id,r=this.charts[i.parameters.chartName]),i)){for(var n in I.extend(i.parameters,e),r.seriesRenderers)for(var s=r.seriesRenderers[n],o=s.seriesParams,l=0;l<o.length;++l)if(o[l].id===i.id){s.attachSeries(a,i.parameters);break}this.changeOccurred("layout"),this.runAppend("modifySeries",arguments)}},I.ChartEngine.prototype.isEquationChart=function(t){return!(!this.allowEquations||!I.computeEquationChart||!t||"="!=t[0])},I.ChartEngine.prototype.getDataFields=function(t){t||(t=this.chart);var e=t.defaultPlotField||"Close",i=["Open","High","Low"];for(var a in i.push(e),t.series){var r=t.series[a].parameters;i.push(r.symbol)}return i},I.ChartEngine.prototype.cleanMasterData=function(t,e){var i=t.symbol,a=e.masterData;if(a&&a.length){var r=this.getDataFields(e),n=0;do{var s=a[n];delete s[i],o.call(this,s,r)?a.splice(n,1):n++}while(n<a.length);a=this.doCleanupGaps(a,e,{noCleanupDates:!0}),this.setMasterData(a,e,{noCleanupDates:!0}),this.clearCurrentMarketData(e,i)}function o(t,e){for(var i=0;i<e.length;i++)if(void 0!==t[e[i]])return!1;return!0}},I.ChartEngine.prototype.deleteSeries=function(t,e,i){if(!this.runPrepend("deleteSeries",arguments)){var a,r=(i=i||{}).action?i.action:"remove-series",n=(e="object"==typeof t?(a=t.id,e||this.charts[t.parameters.chartName]):(a=t,e||this.chart)).series[a];if(n){var s=n.parameters.loadData,o=n.parameters.symbolObject;delete e.series[a];var l=this.getSeries({symbolObject:o,includeMaster:!0});if(!1===s&&l.push(a),l.length||this.cleanMasterData(o,e),"percent"!=this.layout.chartScale){var h=!1;for(var c in e.series)e.series[c].parameters.isComparison&&(h=!0);h||this.setComparison(!1,e)}this.createDataSet(),l.length||this.dispatch(this.currentlyImporting?"symbolImport":"symbolChange",{stx:this,symbol:o.symbol,symbolObject:o,action:r}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)}}},I.ChartEngine.prototype.removeSeries=function(t,e){if(!this.runPrepend("removeSeries",arguments)){var i,a=!1;for(var r in(e="object"==typeof t?(i=t.id,e||this.charts[t.parameters.chartName]):(i=t,e||this.chart)).seriesRenderers)for(var n=e.seriesRenderers[r],s=n.seriesParams.length-1;0<=s;s--)n.seriesParams[s].id===i&&(n.removeSeries(i),n.seriesParams.length<1&&this.removeSeriesRenderer(n),a=!0);a||this.deleteSeries(i,e),this.resetDynamicYAxis(),this.draw(),this.runAppend("removeSeries",arguments)}},I.ChartEngine.prototype.isDailyInterval=function(t){return console.warn("CIQ.ChartEngine.prototype.isDailyInterval has been deprecated. Use use static version insted"),I.ChartEngine.isDailyInterval(t)},I.ChartEngine.prototype.setPeriodicity=function(t,e){if(!this.runPrepend("setPeriodicity",arguments)){var i,a,r=null;t&&"object"==typeof t?(i=t.period,a=t.interval,r=t.timeUnit):(i=t,a=e,e=arguments[arguments.length-1],3<arguments.length&&(r=arguments[2])),"function"!=typeof e&&(e=null);var n=I.cleanPeriodicity(i,a,r);i=n.period,a=n.interval,r=n.timeUnit;var s=this.layout,o=s.candleWidth;s.setSpan={},s.range={},this.chart.inflectionPoint=null;var l=!1;if(this.chart.symbol&&(l=this.needDifferentData({period:i,interval:a,timeUnit:r})),s.periodicity=i,s.interval=a,s.timeUnit=r,l){if(this.changeOccurred("layout"),this.clearCurrentMarketData(),this.quoteDriver)for(var h in this.charts){var c=this.charts[h];c.symbol&&(this.displayInitialized?this.quoteDriver.newChart({symbol:c.symbol,symbolObject:c.symbolObject,chart:c},e):this.newChart(c.symbol,null,c,e))}else this.dataCallback?(this.dataCallback(),e&&e(null)):console.log("cannot change periodicity because neither dataCallback or quoteDriver are set");this.home()}else{var u,p;for(u in this.charts){var d,m=(p=this.charts[u]).dataSegment,g=p.dataSet,f=p.maxTicks,y=p.scroll,v=m?m.length:0,x=g?g.length:0,C=Math.round(p.maxTicks/2);this.setCandleWidth(o,p);var S=!0,b=!1;if(y<=f?S=!1:m&&!m[C]&&(S=!1,b=y-x),S&&0<v&&(f<(Math.round(this.chart.width/o-.499)-1)/2&&(C=v-1),v<=C?(d=m[v-1].DT,C=v-1):d=m[C].DT),this.createDataSet(),S){if(0<v)for(var w=x-1;0<=w;w--)if(g[w].DT.getTime()<d.getTime()){p.scroll=x-1-w+C;break}}else if(b)p.scroll=g.length+b;else{var T=Math.round(this.preferences.whitespace/o);p.scroll=f-T-1}}if(this.displayInitialized&&this.draw(),this.changeOccurred("layout"),this.quoteDriver)for(u in this.charts)(p=this.charts[u]).symbol&&p.moreAvailable&&this.quoteDriver.checkLoadMore(p);this.home(),e&&e(null),this.runAppend("setPeriodicity",arguments)}}},I.ChartEngine.prototype.setPeriodicityV2=function(t,e,i,a){"function"==typeof i&&(a=i,i=null),this.runPrepend("setPeriodicityV2",arguments)||(this.setPeriodicity(t,e,i,a),this.runAppend("setPeriodicityV2",arguments))},I.ChartEngine.prototype.drawVectors=function(){if(!this.vectorsShowing&&!this.runPrepend("drawVectors",arguments)){if(this.vectorsShowing=!0,!this.chart.hideDrawings){var t,e,i={};for(e=0;e<this.drawingObjects.length;e++){var a=this.drawingObjects[e];this.repositioningDrawing!==a&&(t=a.panelName,this.panels[a.panelName]&&!this.panels[a.panelName].hidden&&(i[t]||(i[t]=[]),i[t].push(a)))}for(t in i){this.startClip(t);var r=i[t];for(e=0;e<r.length;e++)r[e].render(this.chart.context);this.endClip()}}this.runAppend("drawVectors",arguments)}},I.ChartEngine.NONE=0,I.ChartEngine.CLOSEUP=1,I.ChartEngine.CLOSEDOWN=2,I.ChartEngine.CLOSEEVEN=4,I.ChartEngine.CANDLEUP=8,I.ChartEngine.CANDLEDOWN=16,I.ChartEngine.CANDLEEVEN=32,I.ChartEngine.prototype.displayChart=function(t){this.runPrepend("displayChart",arguments)||(this.rendererAction(t,"main"),this.runAppend("displayChart",arguments))},I.ChartEngine.prototype.calculateATR=function(t,e,i){i||(i=t.dataSet);var a=t.state.calculations.atr;a||(a=t.state.calculations.atr={}),e||(e=20);var r,n=[];a.accum&&(n=a.accum);for(var s=0;s<i.length;s++){var o=i[s];if(r=s?i[s-1]:a.q1){var l=Math.max(o.High-o.Low,Math.abs(o.High-r.Close),Math.abs(o.Low-r.Close));if(n.length<e){if(n.push(l)==e){for(var h=0,c=0;c<n.length;c++)h+=n[c];o.atr=h/e}}else o.atr=(r.atr*(e-1)+l)/e;o.trueRange=l}}t.state.calculations.atr={accum:n,q1:r}},I.ChartEngine.prototype.calculateMedianPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hl/2"]=(i.High+i.Low)/2},I.ChartEngine.prototype.calculateTypicalPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlc/3"]=(i.High+i.Low+i.Close)/3},I.ChartEngine.prototype.calculateWeightedClose=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlcc/4"]=(i.High+i.Low+2*i.Close)/4},I.ChartEngine.prototype.calculateOHLC4=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["ohlc/4"]=(i.Open+i.High+i.Low+i.Close)/4},I.ChartEngine.prototype.currentQuote=function(){if(!this.chart.dataSet)return null;for(var t=this.chart.dataSet.length-1;0<=t;t--)if(this.chart.dataSet[t])return this.chart.dataSet[t];return null},I.ChartEngine.prototype.mostRecentClose=function(t){if(!this.chart.dataSet)return null;for(var e=this.chart.dataSet.length-1;0<=e;e--){var i=this.chart.dataSet[e];if(i&&(!t||(i=i[t])||0===i)){var a=i.iqPrevClose;if("object"==typeof i&&(i=i.Close),"number"==typeof i)return i;if("number"==typeof a)return a}}return null},I.ChartEngine.prototype.correctIfOffEdge=function(t){if(!this.runPrepend("correctIfOffEdge",arguments)){for(var e in this.charts){var i=this.charts[e],a=i.dataSet,r=i.maxTicks,n=this.layout,s=this.minimumLeftBars;this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[n.chartType]||s--;var o=Math.min(s,r);if(i.allowScrollPast){var l=r-o;o>a.length&&(l=r-a.length),i.scroll-l>=a.length&&(i.scroll=a.length+l-1,this.micropixels=0),i.scroll<=o&&(i.scroll=o,this.micropixels=0)}else i.scroll<o&&(i.scroll=o),i.scroll>a.length&&(i.scroll=a.length);if(!1===i.allowScrollFuture){var h=this.getLabelOffsetInPixels(i,n.chartType)+n.candleWidth*i.whiteSpaceFutureTicks,c=r-Math.round(h/n.candleWidth)-1;(this.micropixels<0?i.scroll-1:i.scroll)<c&&(i.scroll=c,this.micropixels=0)}this.manageTouchAndMouse&&this.controls.chartControls&&(this.controls.chartControls.style.display="block")}this.runAppend("correctIfOffEdge",arguments)}},I.ChartEngine.prototype.createDataSegment=function(t){if(!this.runPrepend("createDataSegment",arguments)){var e;for(var i in this.charts){e=this.charts[i],t&&(e=t),e.isComparison&&I.Comparison.createComparisonSegmentInner(this,e);var a=e.dataSet,r=e.baseline,n=e.scroll,s=e.maxTicks,o=this.layout,l=o.candleWidth;r.actualLevel=r.userLevel?r.userLevel:r.defaultLevel;for(var h,c=r.includeInDataSegment&&(!this.mainSeriesRenderer||!this.mainSeriesRenderer.standaloneBars)&&!this.standaloneBars[o.chartType],u=e.dataSegment=[],p=a.length-1-n-1,d=e.defaultPlotField,m=-1;m<n&&m<s;m++)if(p++,-1!=m||c)if(p<a.length&&0<=p){if((h=a[p]).candleWidth=null,u.push(h),null===r.actualLevel&&0<=m)if(d&&"Close"!=d){var g=a[p-1];(g[d]||0===g[d])&&(r.actualLevel=g[d])}else(h.iqPrevClose||0===h.iqPrevClose)&&(r.actualLevel=h.iqPrevClose)}else p<0&&u.push(null);e.segmentImage=null;var f=this.mainSeriesRenderer||{};if(f.params&&f.params.volume){for(var y=0,v=e.width-(s-u.length-1)*o.candleWidth,x=0;x<u.length;x++)(h=u[x])&&(y+=h.Volume);var C=0;e.segmentImage=[];for(var S=0;S<u.length;S++){h=u[S],e.segmentImage[S]={};var b=null;h?(h.Volume?(h.candleWidth=v*h.Volume/y,b=C+h.candleWidth/2,C+=h.candleWidth):(b=C+(h.candleWidth=l)/2,C+=l),e.segmentImage[S]={tick:h.tick,candleWidth:h.candleWidth,leftOffset:b}):C+=l}}if(t)break}e&&e.isComparison&&this.clearPixelCache(),this.positionCrosshairsAtPointer(),this.runAppend("createDataSegment",arguments)}},I.ChartEngine.prototype.getDataSegment=function(t){t||(t=this.chart);var e=t.dataSegment;if(!e||!e.length)return[];var i=0;return right=e.length,this.pixelFromBar(i,t)<t.panel.left&&i++,this.pixelFromBar(right-1,t)>t.panel.right&&right--,e.slice(i,right)},I.ChartEngine.prototype.leftTick=function(){return this.chart.dataSet.length-this.chart.scroll},I.ChartEngine.prototype.getStartDateOffset=function(){for(var t=0;t<this.chart.dataSegment.length;t++)if(this.chart.dataSegment[t])return t;return 0},I.ChartEngine.prototype.setStartDate=function(t){for(var e=0;e<this.chart.dataSet.length;e++)if(this.chart.dataSet[e].DT.getTime()==t.getTime())return this.chart.scroll=this.chart.dataSet.length-e,void this.draw()},I.ChartEngine.prototype.updateListeners=function(t){for(var e in this.plugins){var i=this.plugins[e];i.display&&i.listener&&i.listener(this,t)}},I.ChartEngine.prototype.clearPixelCache=function(){for(var t in this.panels){var e=this.panels[t];e.cacheHigh=null,e.cacheLow=null,e.cacheLeft=1e6,e.cacheRight=-1}for(var i in this.charts){var a=this.charts[i];if(a.dataSet)for(var r=0;r<a.dataSet.length;r++)a.dataSet[r].cache={}}},I.ChartEngine.prototype.createYAxisLabel=function(t,e,i,a,r,n,s){if(!1!==t.yAxis.drawPriceLabels&&!t.yAxis.noDraw){var o=s||t.yAxis;if(!o.noDraw&&o.width){var l=n||this.chart.context,h=this.getCanvasFontSize("stx_yaxis")+6;this.canvasFont("stx_yaxis",l),o.displayBorder;var c,u=this.drawBorders?3:0;try{c=l.measureText(e).width+u+6}catch(t){c=o.width}var p=o.left-3+3,d=p+3+u,m=3;"left"===(null===o.position?t.chart.yAxis.position:o.position)&&(c*=-1,d=(p=o.left+o.width+3-3)-3-u,m=-3,l.textAlign="right"),i+h/2>o.bottom&&(i=o.bottom-h/2),i-h/2<o.top&&(i=o.top+h/2),void 0===I[this.yaxisLabelStyle]&&(this.yaxisLabelStyle="roundRectArrow");var g=this.yaxisLabelStyle;o.yaxisLabelStyle&&(g=o.yaxisLabelStyle);var f={ctx:l,x:p,y:i,top:i-h/2,width:c,height:h,radius:m,backgroundColor:a,fill:!0,stroke:!1,margin:{left:d-p,top:1},txt:e,color:r};I[g](f)}}},I.ChartEngine.prototype.createXAxisLabel=function(t,e,i,a,r,n){var s,o=this.chart.context,l="stx-float-date",h=this.getCanvasFontSize(l)+4;this.canvasFont(l,o);try{s=o.measureText(e).width+4}catch(t){s=0}var c=t.top+t.height-h;if(!(i+s/2<t.left||i-s/2>t.right)){n||(i+s/2>t.right&&(i=t.right-s/2),i-s/2<t.left&&(i=t.left+s/2)),o.fillStyle=a,I.roundRect({ctx:o,x:i-s/2,top:c,width:s,height:h,radius:3,fill:!0});var u=t.bottom-t.yAxis.bottom-h;o.beginPath(),n?(o.moveTo(i-u,c),o.lineTo(i,c-u-1),o.lineTo(i+u,c),o.closePath(),o.fill()):(o.moveTo(i,c),o.lineTo(i,c-u),o.strokeStyle=a,o.stroke()),o.textBaseline="top",o.fillStyle=r||I.chooseForegroundColor(a),o.fillStyle==a&&("#FFFFFF"==a.toUpperCase()?o.fillStyle="#000000":o.fillStyle="#FFFFFF"),o.fillText(e,i-s/2+2,c+2)}},I.ChartEngine.prototype.drawCurrentHR=function(){if(!this.runPrepend("drawCurrentHR",arguments)){var t,e,i=this.mainSeriesRenderer||{};if(!i.noCurrentHR){var a=i.highLowBars||this.highLowBars[this.layout.chartType];for(var r in this.charts){var n=this.charts[r],s=n.panel,o=s.yAxis;if(!s.hidden&&!1!==o.drawCurrentPriceLabel&&!o.noDraw&&i.params){var l=o.whichSet;if(l||(l="dataSet"),!this.isHistoricalModeSet||"dataSegment"===l){var h=n[l].length,c=this.layout.candleWidth;if("dataSegment"==l)for(;h>(n.width-this.micropixels+c/2+1)/c;)h--;if(h&&n[l][h-1]){var u,p,d,m=n.defaultPlotField;m&&!a||(m="Close");do{if(p=u=n[l][--h][m],0===h)break}while(null===p);if("dataSet"==l&&n.currentQuote)p=n.currentQuote[m];else if(2<=n[l].length){var g=n[l][h-1];g&&(u=g[m])}e=p<u?(t=this.canvasStyle("stx_current_hr_down").backgroundColor,this.canvasStyle("stx_current_hr_down").color):(t=this.canvasStyle("stx_current_hr_up").backgroundColor,this.canvasStyle("stx_current_hr_up").color),n.transformFunc&&(p=n.transformFunc(this,n,p));var f=Math.max(s.yAxis.printDecimalPlaces,s.chart.decimalPlaces);(o.maxDecimalPlaces||0===o.maxDecimalPlaces)&&(f=Math.min(f,o.maxDecimalPlaces)),d=o.priceFormatter?o.priceFormatter(this,s,p,f):this.formatYAxisPrice(p,s,f);var y=this.pixelFromTransformedValue(p,s);this.createYAxisLabel(s,d,y,t,e),!0===this.preferences.currentPriceLine&&this.isHome()&&(s.chart.context.globalCompositeOperation="destination-over",this.plotLine(s.left,s.right,y,y,t,"line",s.chart.context,s,{pattern:"dashed",lineWidth:1,opacity:.8}),s.chart.context.globalCompositeOperation="source-over")}}}}this.runAppend("drawCurrentHR",arguments)}}},I.ChartEngine.prototype.getDefaultColor=function(){this.defaultColor="#000000";for(var t=null,e=this.chart.container;!t||I.isTransparent(t);){var i=getComputedStyle(e);if(!i)return;if(t=i.backgroundColor,I.isTransparent(t)&&(t="transparent"),!(e=e.parentNode)||!e.tagName)break}if(t)if("transparent"==t&&(t="#FFFFFF"),this.containerColor=t,I.isTransparent(t))this.defaultColor="#000000";else{var a=I.hsv(t)[2];this.defaultColor=.65<a?"#000000":"#FFFFFF"}else this.containerColor="#FFFFFF"},I.ChartEngine.prototype.startAsyncAction=function(){this.pendingAsyncs||(this.pendingAsyncs=[]),this.pendingAsyncs.push(!0)},I.ChartEngine.prototype.registerChartDrawnCallback=function(t){return this.asyncCallbacks||(this.asyncCallbacks=[]),this.asyncCallbacks.push(t),{fc:t}},I.ChartEngine.prototype.unregisterChartDrawnCallback=function(t){for(var e=0;e<this.asyncCallbacks.length;e++)if(this.asyncCallbacks[e]==t.fc)return void this.asyncCallbacks.splice(e,1)},I.ChartEngine.prototype.makeAsyncCallbacks=function(){if(this.asyncCallbacks&&(!this.pendingAsyncs||!this.pendingAsyncs.length))for(var t=0;t<this.asyncCallbacks.length;t++)this.asyncCallbacks[t]()},I.ChartEngine.prototype.completeAsyncAction=function(){this.pendingAsyncs.pop(),this.makeAsyncCallbacks()},I.ChartEngine.prototype.draw=function(){if(this.debug(),this.chart.canvas&&this.chart.dataSet&&this.chart.canvasHeight&&(this.offset=this.layout.candleWidth*this.candleWidthPercent/2,I.clearCanvas(this.chart.canvas,this),this.masterData&&(this.masterData.length||this.chart.currentMarketData.touched)&&!this.runPrepend("draw",arguments))){var t,e,i,a;for(i in this.getDefaultColor(),this.vectorsShowing=!1,this.drawPanels(),this.yAxisLabels=[],this.charts){e=this.charts[i],this.correctIfOffEdge(),this.createDataSegment();var r=this.createXAxis(e);this.initializeDisplay(e),this.drawXAxis(e,r);try{this.renderYAxis(e)}catch(t){if(t&&"reboot draw"===t.message)return this.draw();throw t}for(t in e.tmpWidth=Math.floor(this.layout.candleWidth*this.candleWidthPercent),e.tmpWidth%2==0&&(e.tmpWidth+=1,e.tmpWidth>this.layout.candleWidth&&(e.tmpWidth-=2)),e.tmpWidth<.5&&(e.tmpWidth=.5),this.plugins)(a=this.plugins[t]).display&&a.drawUnder&&a.drawUnder(this,e);this.chart.legend&&(this.chart.legend.colorMap=null),this.controls.baselineHandle&&(this.controls.baselineHandle.style.display="none"),this.rendererAction(e,"underlay"),I.Studies&&I.Studies.displayStudies(this,e,!0),this.displayChart(e),I.Studies&&I.Studies.displayStudies(this,e,!1),this.rendererAction(e,"overlay"),e.legend&&e.legend.colorMap&&e.legendRenderer&&e.legendRenderer(this,{chart:e,legendColorMap:e.legend.colorMap,coordinates:{x:e.legend.x,y:e.legend.y+e.panel.yAxis.top}})}for(i in this.charts)for(t in e=this.charts[i],this.plugins)(a=this.plugins[t]).display&&a.drawOver&&a.drawOver(this,e);for(var n in this.panels)this.panels[n].hidden||this.plotYAxisText(this.panels[n]);for(var s=0;s<this.yAxisLabels.length;s++){var o=this.yAxisLabels[s];"series"==o.src&&o.args[6]&&!1===o.args[6].drawSeriesPriceLabels||this.createYAxisLabel.apply(this,o.args)}for(i in this.createCrosshairs(),this.drawVectors(),this.drawCurrentHR(),this.displayInitialized=!0,this.controls.home&&(this.controls.home.style.display=this.isHome()?"none":"block"),this.positionMarkers(),this.charts)e=this.charts[i],this.quoteDriver&&!this.animations.zoom.running&&this.quoteDriver.checkLoadMore(e);this.runAppend("draw",arguments),this.makeAsyncCallbacks()}},I.ChartEngine.prototype.adjustBackingStore=function(t,e){this.devicePixelRatio=window.devicePixelRatio||1,this.devicePixelRatio<1&&(this.devicePixelRatio=1);var i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,a=this.devicePixelRatio/i;if(this.useBackingStore){if(!I.isAndroid||I.is_chrome){var r=t.width,n=t.height;t.width=r*a,t.height=n*a,t.style.width=r+"px",t.style.height=n+"px",e.scale(a,a),this.adjustedDisplayPixelRatio=a,this.backing={ratio:a,width:t.width,height:t.height,styleWidth:r,styleHeight:n}}}else this.devicePixelRatio=this.adjustedDisplayPixelRatio=1},I.ChartEngine.prototype.reconstituteBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.width&&(t.width=this.backing.width,t.height=this.backing.height,t.context.scale(this.backing.ratio,this.backing.ratio),this.adjustedDisplayPixelRatio=this.backing.ratio,this.draw())}},I.ChartEngine.prototype.disableBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.styleWidth&&(t.width=this.backing.styleWidth,t.height=this.backing.styleHeight,t.context.scale(1,1),this.adjustedDisplayPixelRatio=1,this.draw())}},I.ChartEngine.prototype.resizeCanvas=function(){var t=this.chart.canvas,e=this.chart.context;t&&e&&(this.floatCanvas.height=this.chart.tempCanvas.height=t.height=this.chart.container.clientHeight,this.floatCanvas.width=this.chart.tempCanvas.width=t.width=this.chart.container.clientWidth,this.adjustBackingStore(t,e),this.adjustBackingStore(this.chart.tempCanvas,this.chart.tempCanvas.context),this.adjustBackingStore(this.floatCanvas,this.floatCanvas.context));var i=this.container.getBoundingClientRect();this.top=i.top,this.left=i.left,this.canvasWidth=this.chart.canvasWidth=this.chart.container.clientWidth,this.right=this.left+this.canvasWidth,this.height=this.chart.container.clientHeight,this.width=this.right-this.left,0!==this.width||this.container.dimensionlessCanvas||console.log("warning: zero width chart. Check CSS for chart container."),this.bottom=this.top+this.height,this.calculateYAxisPositions(),this.chart.canvasRight=this.right,this.chart.canvasHeight=this.height;var a=this.layout.candleWidth;for(var r in void 0===a&&(a=8),this.charts){var n=this.charts[r];if(this.setCandleWidth(a,n),n.scroll<n.width/a){n.scroll=Math.floor(n.width/a);var s=Math.round(this.preferences.whitespace/this.layout.candleWidth);n.scroll-=s}var o,l=10;try{o=2*e.measureText("10:00").width}catch(t){o=100}for(;1<l&&!(this.chart.width/o>l);)l/=1.5;n.xAxis.autoComputedTickSizePixels=Math.round(this.chart.width/l),n.xAxis.autoComputedTickSizePixels<1&&(n.xAxis.autoComputedTickSizePixels=1)}},I.ChartEngine.prototype.setCandleWidth=function(t,e){e||(e=this.chart),t<this.minimumCandleWidth&&(t=this.minimumCandleWidth),this.layout.candleWidth=t,e.maxTicks=Math.round(e.width/t)+1},I.ChartEngine.prototype.resizeChart=function(t){if(!this.runPrepend("resizeChart",arguments)){!1!==t&&(t=!0),t&&this.preAdjustScroll();var e=this.chart.canvasHeight;this.resizeCanvas(),t&&this.postAdjustScroll(),this.displayInitialized?(this.adjustPanelPositions(),this.draw()):0!==this.chart.canvasHeight&&0===e&&(this.adjustPanelPositions(),this.draw()),this.doDisplayCrosshairs(),this.updateChartAccessories(),this.runAppend("resizeChart",arguments)}},I.ChartEngine.prototype.newChart=function(t,e,i,a,r){i||(i=this.chart),r||(r={});var n=this.layout,s=r.periodicity;if(s){var o=I.cleanPeriodicity(s.period?s.period:s.periodicity,s.interval,s.timeUnit);n.interval=o.interval,n.periodicity=o.period,n.timeUnit=o.timeUnit}var l=i.symbol,h=I.clone(i.symbolObject),c=i.market,u=i.dataSet,p=i.moreAvailable;if(i.dataSet=[],i.moreAvailable=null,t?"object"==typeof t?(i.symbol=t.symbol,i.symbolObject=t):(i.symbol=t,i.symbolObject.symbol=t):(i.symbol=null,i.symbolObject={symbol:null}),i.inflectionPoint=null,this.marketFactory){var d=this.marketFactory(i.symbolObject);this.setMarket(d,i)}this.setMainSeriesRenderer(!0);var m=r.span,g=r.range;g||m||!n?g&&m&&(m={}):(m=n.range?{}:n.setSpan,g=n.range||{}),this.clearCurrentMarketData(i);var f=this;if(!e&&this.quoteDriver){var y=function(t){t&&"orphaned"!=t&&(i.symbol=l,i.symbolObject=h,i.market=c,i.dataSet=u,i.moreAvailable=p),f.dispatch(f.currentlyImporting?"symbolImport":"symbolChange",{stx:f,symbol:f.chart.symbol,symbolObject:f.chart.symbolObject,action:"master"}),a&&a.call(f,t)};g&&Object.keys(g).length?(delete r.span,delete n.setSpan,this.chart.masterData=null,this.displayInitialized=!1,s&&(g.periodicity=s),g.forceLoad=!0,this.setRange(g,y)):m&&m.base?(m.multiplier=m.multiplier||1,this.chart.masterData=null,this.displayInitialized=!1,s&&(m.maintainPeriodicity=!0),m.forceLoad=!0,this.setSpan(m,y)):this.quoteDriver.newChart({symbol:i.symbol,symbolObject:i.symbolObject,chart:i,initializeChart:!0},function(t){t||(f.adjustPanelPositions(),f.quoteDriver.updateSubscriptions(),r.stretchToFillScreen&&f.fillScreen()),y.apply(f,arguments)})}else e||console.log("Warning: No masterData specified and no QuoteFeed configured"),i.symbol||(i.symbol=""),this.initializeChart(),e=this.doCleanupGaps(e,i),this.setMasterData(e,i,{noCleanupDates:!0}),i.endPoints={},e&&e.length&&(i.endPoints={begin:e[0].DT,end:e[e.length-1].DT}),this.createDataSet(),g&&Object.keys(g).length?this.setRange(g):m&&m.multiplier&&m.base?this.setSpan({maintainPeriodicity:!0,multiplier:m.multiplier,base:m.base}):r.stretchToFillScreen?this.fillScreen():e&&e.length?this.draw():this.clear(),this.adjustPanelPositions(),f.dispatch(f.currentlyImporting?"symbolImport":"symbolChange",{stx:f,symbol:f.chart.symbol,symbolObject:f.chart.symbolObject,action:"master"}),a&&a.call(f)},I.ChartEngine.prototype.clear=function(){for(var t in this.displayInitialized=!1,this.layout.studies){var e=this.layout.studies[t];I.Studies.removeStudy(this,e)}this.controls.chartControls&&(this.controls.chartControls.style.display="none"),this.chart.panel.title.innerHTML="",this.chart.panel.title.appendChild(document.createTextNode(this.chart.panel.display))},I.ChartEngine.prototype.fillScreen=function(){var t=this.chart,e=this.layout.candleWidth,i=t.width-this.preferences.whitespace,a=t.dataSet.length;if(i<=a*e)this.draw();else{this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[this.layout.chartType]||a--;var r=i/a;this.setCandleWidth(r,t),this.home({maintainWhitespace:!0})}},I.ChartEngine.prototype.setMasterData=function(t,e,i){if(e||(e=this.chart),this.marketFactory){var a=this.marketFactory(e.symbolObject);this.setMarket(a,e)}var r;for(i||(i={}),i.noCleanupDates||this.doCleanupDates(t,this.layout.interval),e.masterData=t,"chart"==e.name&&(this.masterData=t),r=0;t&&r<t.length;r++){var n=t[r];n.DT?("[object Date]"!=Object.prototype.toString.call(n.DT)&&(n.DT=new Date(n.DT)),n.Date&&17==n.Date.length||(n.Date=I.yyyymmddhhmmssmmm(n.DT))):n.Date?n.DT=I.strToDateTime(n.Date):console.log("setMasterData : Missing DT and Date on masterData object"),n.Volume&&"number"!=typeof n.Volume&&(n.Volume=parseInt(n.Volume,10)),t.length-r<50&&this.updateCurrentMarketData(n,e,null,{fromTrade:!0})}for(r in e.decimalPlaces=this.callbacks.calculateTradingDecimalPlaces({stx:this,chart:e,symbol:e.symbolObject.symbol,symbolObject:e.symbolObject}),this.setDisplayDates(t),e.roundit=Math.pow(10,e.decimalPlaces),this.plugins){var s=this.plugins[r];s.display&&s.setMasterData&&s.setMasterData(this,e)}},I.ChartEngine.prototype.setMasterDataRender=function(t,e,i){i||(i=this.chart),i.symbol||(i.symbol=""),this.setMasterData(e,i),e&&(i.endPoints={},e.length&&(i.endPoints={begin:e[0].DT,end:e[e.length-1].DT},i.symbol=t)),this.createDataSet(),this.initializeChart(),this.draw(),e&&e.length||(i.symbol=null,this.clear()),this.adjustPanelPositions()},I.ChartEngine.prototype.getSymbols=function(t){t||(t={});var e,i,a,r=[],n=this.layout;function s(t,e,i){return{symbol:t,symbolObject:e,periodicity:i.periodicity,interval:i.interval,timeUnit:i.timeUnit,setSpan:i.setSpan}}for(var o in this.charts){var l=this.charts[o];for(var h in l.symbolObject&&l.symbolObject.symbol&&r.push(s(l.symbol,l.symbolObject,n)),l.series){var c=l.series[h].parameters;c.data&&!c.data.useDefaultQuoteFeed||(a=c.symbolObject,(e=s(i=c.symbol,a,n)).id=h,t["include-parameters"]&&(e.parameters=c),t["exclude-studies"]&&"study"==c.bucket||r.push(e))}}for(var u=r.length-1;0<=u;u--)if(i=r[u].symbol,this.isEquationChart(i)){var p=I.formatEquation(i);if(p){for(var d=0;d<p.symbols.length;d++)e=s(p.symbols[d],r[u].symbolObject,r[u]),r.push(e);r.splice(u,1)}}return r},I.ChartEngine.prototype.setDisplayDate=function(t){if(!I.ChartEngine.isDailyInterval(this.layout.interval)){var e,i=t.DT,a=1e3*i.getSeconds()+i.getMilliseconds();this.displayZone&&(e=new p.Date(i.getTime(),this.displayZone),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),i=new Date(i.getTime()+a)),t.displayDate=i}},I.ChartEngine.prototype.setDisplayDates=function(t){if(t&&!I.ChartEngine.isDailyInterval(this.layout.interval))for(var e=0;e<t.length;e++){var i=t[e];i.DT&&this.setDisplayDate(i)}},I.ChartEngine.prototype.streamTrade=function(t,e,i,a){var r=this.chart;a||(a={}),a.chart&&(r=a.chart),a.fillGaps=this.streamParameters.fillGaps;var n="object"==typeof t,s=n?t.last:t,o=n?t.volume:e,l=n?t.bid:null,h=n?t.ask:null;n||(e=i,i=a),i&&(a.secondarySeries=i);var c={DT:e,Last:s,Volume:o,Bid:l,Ask:h};this.updateChartData(c,r,a)},I.ChartEngine.prototype.appendMasterData=function(t,e,i){this.updateChartData(t,e,i)},I.ChartEngine.prototype.updateChartData=function(h,c,u){u||(u={}),c||(c=this.chart);var r,n,a=!1,s=!1,p=c.masterData,d=this.layout,m=(this.dataZone,this),o=u.secondarySeries;function t(t,e){var i;if(o)delete p[t][o],m.cleanupGaps&&(i={DT:e,Close:null},"gap"!=m.cleanupGaps&&p[t-1]&&p[t-1][o]&&(i.Close=p[t-1][o].Close,i.High=i.Low=i.Open=i.Close,i.Volume=0),p[t][o]=i);else{var a=p.splice(t,1)[0];for(r in i={DT:a.DT,Close:null,needed:!1},c.series)void 0!==a[n=c.series[r].parameters.symbolObject.symbol]&&(i[n]=a[n],delete i.needed);m.cleanupGaps&&"gap"!=m.cleanupGaps&&(delete i.needed,"gap"!=m.cleanupGaps&&p[t-1]&&(i.Close=p[t-1].Close,i.High=i.Low=i.Open=i.Close,i.Volume=0)),!1!==i.needed&&p.splice(t,0,i)}}function e(t,e){var i=p[t];if(o&&(i=i[o]||{}),null===e.Close)void 0!==i.Open&&(e.Open=null),void 0!==i.High&&(e.High=null),void 0!==i.Low&&(e.Low=null),void 0!==i.Volume&&(e.Volume=null);else for(r in a?(e.Volume&&(e.Volume=parseInt(e.Volume,10)),s||(e.Volume+=i.Volume)):!I.isValidNumber(e.Volume)&&i.Volume&&(e.Volume=i.Volume),u.allowReplaceOHL||(I.isValidNumber(i.Open)&&(e.Open=i.Open),I.isValidNumber(i.High)&&I.isValidNumber(e.High)&&i.High>e.High&&(e.High=i.High),I.isValidNumber(i.Low)&&I.isValidNumber(e.Low)&&i.Low<e.Low&&(e.Low=i.Low)),I.isValidNumber(e.Close)||(e.Close=i.Close),I.isValidNumber(e.Open)||(e.Open=i.Open),I.isValidNumber(e.High)||(e.High=i.High),I.isValidNumber(e.Low)||(e.Low=i.Low),I.isValidNumber(e.Bid)||(e.Bid=i.Bid),I.isValidNumber(e.Ask)||(e.Ask=i.Ask),c.series)void 0===e[n=c.series[r].parameters.symbolObject.symbol]&&void 0!==i[n]&&(e[n]=i[n])}if(u.noCleanupDates||this.doCleanupDates(h,d.interval),(u.useAsLastSale||h.constructor==Object&&(h.Last||0===h.Last))&&function(){if(a=!0,u.useAsLastSale&&u.useAsLastSale.aggregatedVolume&&(s=!0),h.constructor===Array){var t=h[h.length-1];(h={}).DT=t.DT,h.Close=t.Close,h.Volume=t.Volume}else h.Last&&(h.Close=h.Last,delete h.Last);h.DT&&"[object Date]"!=Object.prototype.toString.call(h.DT)&&(h.DT=new Date(h.DT)),h.DT&&"Invalid Date"!=h.DT||(h.DT=new Date),"tick"!=d.interval&&function(){var t={market_tz:c.market.market_def.market_tz||null},e=d.interval;"month"!=e&&"week"!=e||(m.dontRoll||(e="day"),t=m.chart.market.market_def);var i,a,r=new I.Market(t),n={begin:p&&p.length?p[p.length-1].DT:h.DT,interval:e,periodicity:1,timeUnit:d.timeUnit},s=r.newIterator(n),o=s.next();if(p){if(h.DT<o){i=0;var l=s.previous();for(a=h.DT,u.appending=!0;a<l&&i<1e3;)u.appending=!1,l=s.previous(),i++;h.DT=l,u.updating=!u.appending}else if(h.DT>=o){for(i=0,a=h.DT;o<a&&i<1e3;)h.DT=o,o=s.next(),i++;u.appending=!0}}else h.DT=new Date(+s.previous())}(),h.Open=h.Close,h.High=h.Close,h.Low=h.Close}(),u.secondarySeries)u.fillGaps&&(h=this.doCleanupGaps(h,c,{cleanupGaps:u.fillGaps,noCleanupDates:!0})),I.addMemberToMasterdata({stx:this,label:u.secondarySeries,data:h,createObject:!!u.overwrite||"aggregate",noCleanupDates:!0});else{if(h&&h.constructor==Object&&(h=[h]),!h||!h.length)return;if(this.runPrepend("appendMasterData",[h,c,u]))return;if(this.runPrepend("updateChartData",[h,c,u]))return;p||(p=[]);var i=p.length-1,l=!1;u.fillGaps&&p.length&&function(){var t=new Date(0),e=m.getFirstLastDataRecord(p,o||c.defaultPlotField,!0);e&&(t=e.DT);for(var i=h.length-1;0<=i;i--)if(h[i].DT<=t){i++;break}var a=h.slice(i);a.unshift(o?e[o]:e),(a=m.doCleanupGaps(a,c)).shift(),h=h.slice(0,i).concat(a)}();for(var g=0;g<h.length;g++){var f=h[g],y=f.DT,v=f.Date;for(y&&"[object Date]"!=Object.prototype.toString.call(y)&&(f.DT=y=new Date(y)),y&&(v&&17==v.length||(f.Date=I.yyyymmddhhmmssmmm(f.DT))),y||(y=f.DT=I.strToDateTime(v));0<=i&&i<p.length;){var x=p[i].DT;if(x||(x=I.strToDateTime(p[i].Date)),x.getTime()<=y.getTime()){l=!0;var C=0;if(x.getTime()<y.getTime()){if(i<p.length-1&&(p[i+1].DT||I.strToDateTime(p[i+1].Date)).getTime()<=y.getTime()){i++;continue}C=1}if(u.deleteItems){C||t(i,y);break}if(C||e(i,f),I.isValidNumber(f.Close)){I.isValidNumber(f.Open)||(f.Open=f.Close);var S=Math.max(f.Open,f.Close),b=Math.min(f.Open,f.Close);(!I.isValidNumber(f.High)||f.High<S)&&(f.High=S),(!I.isValidNumber(f.Low)||f.Low>b)&&(f.Low=b)}f.Volume&&!I.isValidNumber(f.Volume)&&(f.Volume=parseInt(f.Volume,10)),this.setDisplayDate(f),i+=C,o?(h.length-g<50&&this.updateCurrentMarketData(f,c,o,{fromTrade:!0}),"tick"==d.interval&&void 0===f.Close||(C&&p.splice(i,0,{DT:f.DT}),p[i][o]=f)):(h.length-g<50&&this.updateCurrentMarketData(f,c,null,{fromTrade:!0}),"tick"==d.interval&&void 0===f.Close||p.splice(i,C?0:1,f));break}i+=l?1:-1}i<0&&(o?(this.updateCurrentMarketData(f,c,o,{fromTrade:!0}),"tick"==d.interval&&void 0===f.Close||(p.splice(0,0,{DT:f.DT}),p[0][o]=f)):(this.updateCurrentMarketData(f,c,null,{fromTrade:!0}),"tick"==d.interval&&void 0===f.Close||p.splice(0,0,f)),l=!0,i=0)}p.length&&(this.masterData=c.masterData=p),this.maxMasterDataSize&&(p=c.masterData=this.masterData=p.slice(-this.maxMasterDataSize));for(var w=o?this.getSeries({symbol:o,chart:c}):[c],T=0;T<w.length;T++){var D=w[T];(!D.endPoints.begin||D.endPoints.begin>h[0].DT)&&(D.endPoints.begin=h[0].DT),(!D.endPoints.end||D.endPoints.end<h[h.length-1].DT)&&(D.endPoints.end=h[h.length-1].DT)}for(var A in this.plugins){var M=this.plugins[A];M.display&&M.appendMasterData&&M.appendMasterData(this,h,c)}this.masterData&&this.masterData.length||(this.masterData=p)}if(!u.noCreateDataSet){var k=this.streamParameters;++k.count>k.maxTicks||u.bypassGovernor?(clearTimeout(k.timeout),this.createDataSet(null,null,u),this.draw(),this.updateChartAccessories(),k.count=0,k.timeout=-1):-1==k.timeout&&(k.timeout=setTimeout(function(){m.createDataSet(null,null,u),m.draw(),m.updateChartAccessories(),m.streamParameters.count=0,m.streamParameters.timeout=-1},k.maxWait))}this.runAppend("appendMasterData",arguments),this.runAppend("updateChartData",arguments)},I.ChartEngine.prototype.updateCurrentMarketData=function(e,t,i,a){if(e&&e.DT){t||(t=this.chart);var r=a&&a.fromTrade;if(!r){if(t.market.market_def&&null===t.market.getSession(e.DT))return;var n=this.standardMarketIterator(e.DT);this.extendedHours&&this.extendedHours.filter&&n.market.enableAllAvailableSessions(),n.next(),e.DT=n.previous()}if(!this.runPrepend("updateCurrentMarketData",arguments)){var s=t.currentMarketData;i&&(s[i]||(s[i]={}),s=s[i]),["Last","Bid","Ask"].forEach(function(t){e[t]&&"number"==typeof e[t]&&(!s[t]||!s[t].DT||s[t].DT<=e.DT)&&(s[t]={DT:e.DT,Price:e[t],Size:e[t+"Size"]})}),["BidL2","AskL2"].forEach(function(t){e[t]&&e[t]instanceof Array&&(!s[t]||!s[t].DT||s[t].DT<=e.DT)&&(s[t]={DT:e.DT,Price_Size:e[t]})}),e.Close&&(!s.Last||s.Last.DT<=e.DT)&&(s.Last||(s.Last={}),s.animatedLast||(s.Last.DT=e.DT,s.Last.Price=e.Close)),s.touched=new Date,r||delete e.Last,this.runAppend("updateCurrentMarketData",arguments)}}},I.ChartEngine.prototype.clearCurrentMarketData=function(t,e){if(!this.runPrepend("clearCurrentMarketData",arguments)){var i,a=[];if(t)a.push(t);else for(i in this.charts)a.push(this.charts[i]);for(i=0;i<a.length;i++){var r=a[i].currentMarketData;if(e)delete r[e];else for(var n in r)delete r[n]}this.runAppend("clearCurrentMarketData",arguments)}},I.ChartEngine.prototype.setMaxTicks=function(t,e){e||(e={}),(t=Math.round(t))<2&&(t=2);var i=e.padding?e.padding:0;this.layout.candleWidth=(this.chart.width-i)/t,this.layout.candleWidth||(this.layout.candleWidth=8),this.chart.maxTicks=Math.round(this.chart.width/this.layout.candleWidth-.499),(e.padding||0===e.padding)&&(this.chart.scroll=t+1)},I.ChartEngine.prototype.construct=function(){this.stackPanel("chart","chart",1),this.adjustPanelPositions(),this.chart.panel=this.panels[this.chart.name],this.cx=0,this.cy=0,this.micropixels=0,this.controls.home&&this.chart.panel.subholder.appendChild(this.controls.home),this.callbackListeners={doubleTap:[],drawing:[],layout:[],longhold:[],move:[],newChart:[],preferences:[],rightClick:[],studyOverlayEdit:[],studyPanelEdit:[],symbolChange:[],symbolImport:[],tap:[],theme:[],undoStamp:[]},this.longHoldTime=1e3},I.ChartEngine.prototype.addDomEventListener=function(t,e,i,a){t.addEventListener(e,i,a),this.eventListeners.push({element:t,event:e,function:i,options:a})},I.ChartEngine.prototype.addEventListener=function(t,e){if("*"===t)for(var i in this.callbackListeners)this.callbackListeners[i].push(e);else if(t instanceof Array)for(var a=0;a<t.length;a++)this.callbackListeners[t[a]].push(e);else{var r=this.callbackListeners[t];if(!r)throw new Error("Attempted to add an invalid listener.");r.push(e)}return{type:t,cb:e}},I.ChartEngine.prototype.removeEventListener=function(t,e){t&&"object"==typeof t||(t={type:t,cb:e});var i=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return void t.splice(i,1)},a=this.callbackListeners;if("*"!==t.type){if(!a[t.type])throw new Error("Attempted to remove an invalid listener.");i(a[t.type],t.cb)}else for(var r in a)i(a[r],t.cb)},I.ChartEngine.prototype.dispatch=function(t,e){this.callbacks[t]&&this.callbacks[t].call(this,e);var i,a=this.callbackListeners[t];if(a){for(var r=0;r<a.length;r++)i=a[r].call(this,e);if(i)return i}if(a=this.callbackListeners["*"]){for(var n=0;n<a.length;n++)i=a[n].call(this,e);if(i)return i}return!1},I.ChartEngine.prototype.getYAxisByName=function(t,e){if(t){if("string"==typeof t&&(t=this.panels[t]),e===t.yAxis.name)return t.yAxis;var i;for(i=0;t.yaxisLHS&&i<t.yaxisLHS.length;i++)if(t.yaxisLHS[i].name===e)return t.yaxisLHS[i];for(i=0;t.yaxisRHS&&i<t.yaxisRHS.length;i++)if(t.yaxisRHS[i].name===e)return t.yaxisRHS[i]}},I.ChartEngine.prototype.deleteYAxisIfUnused=function(t,e){if(e&&e.name!==t.yAxis.name){for(var i in this.chart.seriesRenderers){var a=this.chart.seriesRenderers[i];if(a.params.yAxis&&a.params.yAxis.name===e.name&&0!==a.seriesParams.length)return}var r;for(r=0;r<t.yaxisLHS.length;r++)t.yaxisLHS[r]===e&&t.yaxisLHS.splice(r,1);for(r=0;r<t.yaxisRHS.length;r++)t.yaxisRHS[r]===e&&t.yaxisRHS.splice(r,1);this.preAdjustScroll(),this.resizeCanvas(),this.adjustPanelPositions(),this.postAdjustScroll()}},I.ChartEngine.prototype.addYAxis=function(t,e){if(e){t.yaxisLHS||(t.yaxisLHS=[],t.yaxisRHS=[],"left"==t.yAxis.position?t.yaxisLHS.push(t.yAxis):t.yaxisRHS.push(t.yAxis));var i,a=t.yaxisLHS;for(i=a.length-1;0<=i;i--)if(a[i].name===e.name){if("left"==e.position)return a[i];a.splice(i,1)}for(i=(a=t.yaxisRHS).length-1;0<=i;i--)if(a[i].name===e.name){if("left"!=e.position)return a[i];a.splice(i,1)}return"left"===e.position?t.yaxisLHS.unshift(e):(e.position||(e.position="right"),t.yaxisRHS.push(e)),e.height=t.yAxis.height,this.preAdjustScroll(),this.resizeCanvas(),this.adjustPanelPositions(),this.calculateYAxisMargins(e),this.postAdjustScroll(),e}},I.ChartEngine.prototype.calculateYAxisPositions=function(){var t=[];for(var e in this.chart,this.charts)this.charts[e].hidden||t.push(e);for(var i in this.panels){var a=this.panels[i];a.name===a.chart.name||a.hidden||t.push(i)}this.drawBorders;var r,n,s,o,l=0,h=0;for(n=0;n<t.length;n++)if(s=this.panels[t[n]]){s.yaxisLHS||(s.yaxisLHS=[],s.yaxisRHS=[]);var c=s.yAxis.position;for(c||(c=s.chart.panel.yAxis.position),r=0;r<s.yaxisLHS.length;r++)if(s.yaxisLHS[r].name==s.yAxis.name){s.yaxisLHS.splice(r,1);break}for(r=0;r<s.yaxisRHS.length;r++)if(s.yaxisRHS[r].name==s.yAxis.name){s.yaxisRHS.splice(r,1);break}"left"==s.yAxis.position?s.yaxisLHS.push(s.yAxis):s.yaxisRHS.unshift(s.yAxis),s.yAxis.width||0===s.yAxis.width||(s.yAxis.width=this.yaxisWidth),s.yaxisTotalWidthRight=0,s.yaxisTotalWidthLeft=0;var u=s.yaxisLHS.concat(s.yaxisRHS);for(r=0;r<u.length;r++)if(!(o=u[r]).noDraw&&o.width)if("left"==o.position){s.yaxisTotalWidthLeft+=o.width;var p=!o.justifyRight&&!1!==o.justifyRight;o.justifyRight=p?s.chart.yAxis.justifyRight:o.justifyRight,p&&(o.justifyRight=!0)}else s.yaxisTotalWidthRight+=o.width;s.yaxisTotalWidthLeft>l&&(l=s.yaxisTotalWidthLeft),s.yaxisTotalWidthRight>h&&(h=s.yaxisTotalWidthRight)}for(n=0;n<t.length;n++)if(s=this.panels[t[n]]){var d=s.name===s.chart.name,m=l;for(r=s.yaxisLHS.length-1;0<=r;r--)(o=s.yaxisLHS[r]).noDraw||(m-=o.width,o.left=m);for(m=this.width-h,r=0;r<s.yaxisRHS.length;r++)(o=s.yaxisRHS[r]).noDraw||(o.left=m,m+=o.width);void 0!==this.yaxisLeft&&(s.chart.yaxisPaddingRight=this.yaxisLeft),s.yaxisCalculatedPaddingRight=h,(s.chart.yaxisPaddingRight||0===s.chart.yaxisPaddingRight)&&(s.yaxisCalculatedPaddingRight=s.chart.yaxisPaddingRight),s.yaxisCalculatedPaddingLeft=l,(s.chart.yaxisPaddingLeft||0===s.chart.yaxisPaddingLeft)&&(s.yaxisCalculatedPaddingLeft=s.chart.yaxisPaddingLeft),s.right=d?(s.left=s.yaxisCalculatedPaddingLeft,this.width-s.yaxisCalculatedPaddingRight):(s.left=s.chart.panel.left,s.chart.panel.right),s.width=s.right-s.left,s.handle&&(s.handle.style.left=s.left+"px",s.handle.style.width=s.width+"px"),d&&(s.chart.left=s.left,s.chart.right=s.right,s.chart.width=Math.max(s.right-s.left,0))}this.setCandleWidth(this.layout.candleWidth)},I.ChartEngine.prototype.initializeChart=function(t){if(!this.runPrepend("initializeChart",arguments)){this.chart.symbolObject.symbol||(this.chart.symbolObject.symbol=this.chart.symbol),this.locale&&this.setLocale(this.locale),!this.displayZone&&I.ChartEngine.defaultDisplayTimeZone&&this.setTimeZone(null,I.ChartEngine.defaultDisplayTimeZone),this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.micropixels=0,t?this.chart.container=t:t=this.chart.container,t.stx=this,t.CIQRegistered||(t.CIQRegistered=!0,I.ChartEngine.registeredContainers.push(t)),I.isSurface&&(this.gesture||(this.gesture=new MSGesture,this.manageTouchAndMouse?this.gesture.target=t:this.gesture.target=document.body,this.gesturePointerId=null)),this.registerHTMLElements();var e=this.chart.canvas,i=this.chart.tempCanvas,a=this.floatCanvas;e&&document.createElement("canvas").getContext?(e.id||(t.removeChild(e),this.chart.canvas=null),i&&!i.id&&(t.removeChild(i),this.chart.tempCanvas=null),a&&!a.id&&(t.removeChild(a),this.floatCanvas=null)):(this.layout.candleWidth<this.minimumCandleWidth&&(this.layout.candleWidth=this.minimumCandleWidth),200<this.layout.candleWidth&&(this.layout.candleWidth=8)),this.chart.canvas||(e=this.chart.canvas=document.createElement("canvas")),this.chart.canvas.getContext?t.appendChild(e):((e=this.chart.canvas=w(".ie8canvas",t)).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(e),e.style.display="block"),e.style.position="absolute",e.style.left="0px",(e.context=this.chart.context=e.getContext("2d")).lineWidth=1,this.chart.tempCanvas||(i=this.chart.tempCanvas=document.createElement("canvas")),this.chart.tempCanvas.getContext?t.appendChild(i):(i=this.chart.tempCanvas=w(".ie8canvasTemp",t)).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(i),i.style.position="absolute",i.style.left="0px",i.context=this.chart.tempCanvas.getContext("2d"),i.context.lineWidth=1,i.style.display="none",this.floatCanvas||(a=this.floatCanvas=document.createElement("canvas")),this.floatCanvas.getContext?t.appendChild(a):(a=this.floatCanvas=w(".ie8canvasFloat",t)).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a),a.style.position="absolute",a.style.left="0px",a.context=a.getContext("2d"),a.context.lineWidth=1,a.style.display="none",this.resizeCanvas(),I.isAndroid&&(this.chart.tempCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()},this.floatCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()});var r,n,s,o,l,h=this.chart,c=this.panels;for(var u in h.panel.display=h.symbol,h.symbolDisplay&&(h.panel.display=h.symbolDisplay),this.adjustPanelPositions(),this.chart.panel=c[h.name],c)for(var p=c[u].yaxisLHS.concat(c[u].yaxisRHS),d=0;d<p.length;d++)p[d].height=c[u].yAxis.height,this.calculateYAxisMargins(p[d]);if(this.initialWhitespace=this.preferences.whitespace,h.dataSet&&0<h.dataSet.length){h.scroll=Math.floor(h.width/this.layout.candleWidth);var m=Math.round(this.preferences.whitespace/this.layout.candleWidth);h.scroll-=m}if(I.touchDevice){var g=w(".overlayEdit",t),f=w(".overlayTrashCan",t),y=w(".vectorTrashCan",t);g?(I.safeClickTouch(g,(o=this,function(t){o.deleteHighlighted(!0,!0)})),f&&I.safeClickTouch(f,(s=this,function(t){s.deleteHighlighted(!1)}))):f&&I.safeClickTouch(f,(n=this,function(t){n.deleteHighlighted(!0)})),y&&I.safeClickTouch(y,(r=this,function(t){r.deleteHighlighted(!0)}))}for(var v in this.manageTouchAndMouse&&(this.registerTouchAndMouseEvents(),this.controls.chartControls&&(this.controls.chartControls.style.display="block")),t.onmouseout=(l=this,function(t){l.handleMouseOut(t)}),this.abortDrawings(),this.undoStamps=[],c){var x=c[v];x.markerHolder&&(t.removeChild(x.markerHolder),x.markerHolder=null)}for(var C in this.plugins){var S=this.plugins[C];S.display&&S.initializeChart&&S.initializeChart(this)}if(!this.resizeListenerInitialized){var b=this;this.resizeListenerInitialized=!0,this.addDomEventListener(window,"resize",function(t){b.resizeChart()},!0)}h.baseline.userLevel&&(h.baseline.userLevel=null),this.setResizeTimer(this.resizeDetectMS),this.runAppend("initializeChart",arguments)}},I.ChartEngine.prototype.destroy=function(){this.setResizeTimer(0),this.quoteDriver&&this.quoteDriver.die(),this.styles={};for(var t=0;t<this.eventListeners.length;t++){var e=this.eventListeners[t];e.element.removeEventListener(e.event,e.function,e.options)}this.streamParameters.timeout&&clearTimeout(this.streamParameters.timeout);var i=I.ChartEngine.registeredContainers,a=i.indexOf(this.chart.container);if(-1<a&&i.splice(a,1),this.slider){var r=i.indexOf(this.slider.slider.chart.container);-1<r&&i.splice(r,1)}},I.ChartEngine.prototype.handleMouseOut=function(t){if(t=t||window.event,!I.withinElement(this.chart.container,t.pageX,t.pageY)){if(this.runPrepend("handleMouseOut",arguments))return;if(this.undisplayCrosshairs(),this.grabbingScreen=!1,this.touches=[],this.touching=!1,this.activeDrawing&&this.userPointerDown){this.userPointerDown=!1,this.drawingLine=!1;var e=this.backOutY(t.pageY),i=this.backOutX(t.pageX);this.drawingClick(this.currentPanel,i,e)}I.ChartEngine.insideChart=!1,this.displaySticky(),this.findHighlights(!1,!0),this.runAppend("handleMouseOut",arguments)}},I.ChartEngine.prototype.registerTouchAndMouseEvents=function(){if(!this.touchAndMouseEventsRegistered){this.touchAndMouseEventsRegistered=!0;var t=w(".stx-zoom-in",this.controls.chartControls),e=w(".stx-zoom-out",this.controls.chartControls),i=this.chart.container,a=this,r=function(t,e){a.addDomEventListener(i,t,e)};I.touchDevice?I.isSurface?(r("mousemove",function(t){a.msMouseMoveProxy(t)}),r("mouseenter",function(t){a.msMouseMoveProxy(t)}),r("mousedown",function(t){a.msMouseDownProxy(t)}),r("mouseup",function(t){a.msMouseUpProxy(t)}),window.navigator.msPointerEnabled?(r("MSPointerDown",function(t){return a.startProxy(t)}),r("MSGestureStart",function(t){a.gestureInEffect=!0}),r("MSGestureChange",function(t){return a.touchmove(t)}),r("MSGestureEnd",function(t){return a.gestureInEffect=!1,a.touchend(t)}),r("MSPointerMove",function(t){a.moveProxy(t)}),r("MSPointerEnter",function(t){return a.moveProxy(t)}),r("MSPointerUp",function(t){return a.endProxy(t)})):(r("pointerdown",function(t){return a.startProxy(t)}),r("MSGestureStart",function(t){a.gestureInEffect=!0}),r("MSGestureChange",function(t){return a.touchmove(t)}),r("MSGestureEnd",function(t){return a.gestureInEffect=!1,a.touchend(t)}),r("pointermove",function(t){a.moveProxy(t)}),r("pointerenter",function(t){return a.moveProxy(t)}),r("pointerup",function(t){return a.endProxy(t)}))):(I.isAndroid||I.ipad||I.iphone||(r("mousemove",function(t){a.iosMouseMoveProxy(t)}),r("mouseenter",function(t){a.iosMouseMoveProxy(t)}),r("mousedown",function(t){a.iosMouseDownProxy(t)}),r("mouseup",function(t){a.iosMouseUpProxy(t)})),r("touchstart",function(t){a.touchstart(t)}),r("touchmove",function(t){a.touchmove(t)}),r("touchend",function(t){a.touchend(t)}),t&&(t.removeAttribute("onMouseOver"),t.removeAttribute("onMouseOut")),e&&(e.removeAttribute("onMouseOver"),e.removeAttribute("onMouseOut"))):(r("mousemove",function(t){a.mousemove(t)}),r("mouseenter",function(t){a.mousemove(t)}),r("mousedown",function(t){a.mousedown(t)}),r("mouseup",function(t){a.mouseup(t)}));var n=I.wheelEvent;this.captureMouseWheelEvents&&this.addDomEventListener(i,n,function(t){a.mouseWheel(t)})}},I.ChartEngine.prototype.rightClickHighlighted=function(){this.runPrepend("rightClickHighlighted",arguments)||(this.deleteHighlighted(!0),this.runAppend("rightClickHighlighted",arguments))},I.ChartEngine.prototype.deleteHighlighted=function(t,e){if(!this.runPrepend("deleteHighlighted",arguments)){this.cancelTouchSingleClick=!0,I.clearCanvas(this.chart.tempCanvas,this);var i=!1===this.bypassRightClick;if(i||!this.bypassRightClick.drawing)for(var a=this.drawingObjects.length-1;0<=a;a--){var r=this.drawingObjects[a];if(r.highlighted&&!r.permanent){if(!r.abort()){var n=I.shallowClone(this.drawingObjects);this.drawingObjects.splice(a,1),this.undoStamp(n,I.shallowClone(this.drawingObjects))}this.changeOccurred("vector")}}if(i||!this.bypassRightClick.study)for(var s in this.overlays){var o=this.overlays[s];o.highlight&&!o.permanent&&(t||e?this.rightClickOverlay(s,e):this.removeOverlay(s))}var l=this.currentPanel.chart;if(i||!this.bypassRightClick.series)for(var h in l.seriesRenderers)for(var c=l.seriesRenderers[h],u=c.seriesParams.length-1;0<=u;u--){var p=c.seriesParams[u];p.highlight&&!p.permanent&&(c.removeSeries(p.id),c.seriesParams.length<1&&this.removeSeriesRenderer(c))}this.draw(),this.clearMeasure();var d=this.controls.mSticky;d&&(d.style.display="none",d.children[0].innerHTML=""),this.runAppend("deleteHighlighted",arguments)}},I.ChartEngine.prototype.panelExists=function(t){for(var e in this.panels)if(this.panels[e].name==t)return!0;return!1},I.ChartEngine.prototype.hideCrosshairs=function(){this.displayCrosshairs=!1},I.ChartEngine.prototype.showCrosshairs=function(){this.displayCrosshairs=!0},I.ChartEngine.prototype.grabHandle=function(t){this.runPrepend("grabHandle",arguments)||t&&(I.ChartEngine.crosshairY=t.top+this.top,I.ChartEngine.resizingPanel=t,I.appendClassName(t.handle,"stx-grab"),this.runAppend("grabHandle",arguments))},I.ChartEngine.prototype.releaseHandle=function(){if(this.runPrepend("releaseHandle",arguments))return!0;I.clearCanvas(this.chart.tempCanvas,this),this.resizePanels(),I.ChartEngine.resizingPanel&&I.unappendClassName(I.ChartEngine.resizingPanel.handle,"stx-grab"),I.ChartEngine.resizingPanel=null,this.runAppend("releaseHandle",arguments)},I.ChartEngine.prototype.storePanels=function(){this.layout||(this.layout={});var t=this.layout;for(var e in t.panels={},this.panels){var i=this.panels[e];t.panels[i.name]={percent:i.percent,display:i.display,yAxis:i.yAxis}}},I.ChartEngine.prototype.savePanels=function(t){this.storePanels(),!1!==t&&this.changeOccurred("layout")},I.ChartEngine.prototype.resolveY=function(t){return this.top+t},I.ChartEngine.prototype.resolveX=function(t){return this.left+t},I.ChartEngine.prototype.backOutY=function(t){return t-this.top},I.ChartEngine.prototype.backOutX=function(t){return t-this.left},I.ChartEngine.prototype.cleanupRemovedStudy=function(t){for(var e in t.study.removeFN&&t.study.removeFN(this,t),t.study.feed&&this.detachTagAlongQuoteFeed(t.study.feed),this.plugins)-1<e.indexOf("{"+t.id+"}")&&delete this.plugins[e];this.layout.studies&&delete this.layout.studies[t.name],delete this.overlays[t.name],I.Studies.removeStudySymbols(t,this),this.quoteDriver&&this.quoteDriver.updateSubscriptions()},I.ChartEngine.prototype.privateDeletePanel=function(t){if(this.layout.studies){var e=this.layout.studies[t.name];e&&this.cleanupRemovedStudy(e)}if(delete this.panels[t.name],I.Studies)for(var i in I.Studies.studyPanelMap)I.Studies.studyPanelMap[i].panel==t.name&&delete I.Studies.studyPanelMap[i];for(var a in this.overlays)this.overlays[a].panel==t.name&&(this.cleanupRemovedStudy(this.layout.studies[a]),delete this.overlays[a]);if(t.holder&&(this.chart.container.removeChild(t.holder),this.getMarkerArray))for(var r=this.getMarkerArray("panelName",t.name),n=0;n<r.length;n++)this.removeFromHolder(r[n]);t.handle&&t.handle.parentNode.removeChild(t.handle),this.currentPanel=null},I.ChartEngine.prototype.panelClose=function(t){if(t&&!this.runPrepend("panelClose",arguments)){if(this.cancelTouchSingleClick=!0,I.ChartEngine.drawingLine=!1,t.soloing&&this.panelSolo(t),this.charts[t.name]){for(var e in this.panels){var i=this.panels[e];i.chart.name==t.name&&this.privateDeletePanel(i)}delete this.charts[t.name]}else this.privateDeletePanel(t);this.currentlyImporting||(this.showCrosshairs(),this.createDataSet(),this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.adjustPanelPositions(),this.draw(),this.savePanels()),this.openDialog&&(this.openDialog=""),this.runAppend("panelClose",arguments)}},I.ChartEngine.prototype.deleteAllPanels=function(){for(var t in this.panels){var e=this.panels[t];this.privateDeletePanel(e)}this.layout.panels={},this.panels={}},I.ChartEngine.prototype.panelUp=function(t){this.cancelTouchSingleClick=!0,I.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,i={},a=0;for(e in this.panels){if(e==t.name)break;a++}if(a){var r=0;for(e in this.panels)r==a-1&&(i[t.name]=t),e!=t.name&&(i[e]=this.panels[e],r++);this.panels=i,this.adjustPanelPositions(),this.draw(),this.savePanels()}},I.ChartEngine.prototype.panelDown=function(t){this.cancelTouchSingleClick=!0,I.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,i={},a=0;for(e in this.panels){if(e==t.name)break;a++}var r=0;for(e in this.panels)r++;if(a!=r-1){var n=0;for(e in this.panels)e!=t.name&&(i[e]=this.panels[e],n==a+1&&(i[t.name]=t)),n++;this.panels=i,this.adjustPanelPositions(),this.draw(),this.savePanels()}},I.ChartEngine.prototype.panelSolo=function(t){this.cancelTouchSingleClick=!0,I.ChartEngine.drawingLine=!1,this.showCrosshairs();var e=!0;for(var i in t.soloing?(e=!1,t.soloing=!1,I.unappendClassName(t.solo,"stx_solo_lit"),t.percent=t.oldPercent,"chart"==t.name||this.soloPanelToFullScreen||(this.chart.panel.percent=this.chart.panel.oldPercent),this.soloPanelToFullScreen&&(this.xAxisAsFooter=this.chart.panel.oldXAxisAsFooter,this.controls.home&&this.chart.panel.subholder.appendChild(this.controls.home))):(t.soloing=!0,I.appendClassName(t.solo,"stx_solo_lit"),t.oldPercent=t.percent,this.chart.panel.oldXAxisAsFooter=this.xAxisAsFooter,"chart"!=t.name&&(this.soloPanelToFullScreen?(this.xAxisAsFooter=!0,this.controls.home&&t.subholder.appendChild(this.controls.home)):(this.chart.panel.oldPercent=this.chart.panel.percent,t.percent=1-this.chart.panel.percent))),this.panels)this.panels[i].hidden=e;this.soloPanelToFullScreen||(this.chart.panel.hidden=!1),t.hidden=!1,this.adjustPanelPositions(),this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.draw(),this.savePanels()},I.ChartEngine.prototype.calculatePanelPercent=function(t){var e=t.bottom-t.top;t.percent=e/this.chart.canvasHeight},I.ChartEngine.prototype.resizePanels=function(){if(I.ChartEngine.resizingPanel){var t,e,i,a=!0;if(I.ChartEngine.crosshairY>this.resolveY(I.ChartEngine.resizingPanel.top)&&(a=!1),a){for(t in i=null,this.panels){if(this.panels[t]==I.ChartEngine.resizingPanel)break;this.panels[t].hidden||(i=this.panels[t])}(e=this.backOutY(I.ChartEngine.crosshairY))<i.top+30&&(e=i.top+30,I.ChartEngine.crosshairY=this.resolveY(e)),i.bottom=e,I.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(i),this.calculatePanelPercent(I.ChartEngine.resizingPanel)}else{for(t in i=null,this.panels){if(this.panels[t]==I.ChartEngine.resizingPanel)break;this.panels[t].hidden||(i=this.panels[t])}(e=this.backOutY(I.ChartEngine.crosshairY))>I.ChartEngine.resizingPanel.bottom-30&&(e=I.ChartEngine.resizingPanel.bottom-30,I.ChartEngine.crosshairY=this.resolveY(e)),i.bottom=e,I.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(i),this.calculatePanelPercent(I.ChartEngine.resizingPanel)}this.adjustPanelPositions(),this.draw(),this.savePanels()}},I.ChartEngine.prototype.adjustPanelPositions=function(){if(this.chart.tempCanvas&&I.clearCanvas(this.chart.tempCanvas,this),this.chart.symbol&&!this.runPrepend("adjustPanelPositions",arguments)){var t,e,i,a=0,r=this.chart.canvasHeight,n=!1,s=0,o=0,l=!1;for(t in this.panels)e=this.panels[t],(isNaN(e.percent)||e.percent<=0)&&(e.percent=.05),e.hidden||(s+=e.percent,o++,e.soloing&&(l=!0));for(t in this.panels){var h=0;if((e=this.panels[t]).hidden)e.markerHolder&&(e.markerHolder.style.display="none");else{this.manageTouchAndMouse&&(e.up&&(n?this.displayIconsUpDown&&(e.up.style.display=""):(n=!0,e.up.style.display="none")),e.solo&&(l?e.soloing?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none":1==o?e.solo.style.display="none":2!=o||this.soloPanelToFullScreen?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none"),e.down&&(1==o?e.down.style.display="none":this.displayIconsUpDown&&(e.down.style.display="")),e.edit&&(e.editFunction?e.edit.style.display="":e.edit.style.display="none")),e.percent=e.percent/s,e.top=a,e.bottom=e.top+r*e.percent,e.height=e.bottom-e.top,e.chart.name==e.name&&(e.chart.top=e.top,e.chart.bottom=e.bottom,e.chart.height=e.height),a=e.bottom;for(var c=e.yaxisLHS.concat(e.yaxisRHS),u=0;u<c.length;u++){var p=c[u];p.zoom&&0<p.height&&(h=p.zoom/p.height),this.adjustYAxisHeightOffset(e,p),p.height=p.bottom-p.top,h&&(p.zoom=h*p.height,p.zoom>p.height&&(p.zoom=0,p.scroll=0)),p.high||0===p.high||(p.high=100,p.low=0,p.shadow=100),p.multiplier=p.height/p.shadow}e.holder&&(e.holder.style.right="0px",e.holder.style.top=e.top+"px",e.holder.style.left="0px",e.holder.style.height=e.height+"px",e.subholder.style.left=e.left+"px",e.subholder.style.width=e.width+"px",e.subholder.style.top="0px",0<=e.yAxis.height&&(e.subholder.style.height=e.yAxis.height+"px"))}}t&&this.panels[t].down&&(this.panels[t].down.style.display="none"),this.manageTouchAndMouse&&2==o&&!l&&this.chart.panel.solo&&(this.chart.panel.solo.style.display=""),this.controls.chartControls&&this.chart.panel&&(i=l&&this.soloPanelToFullScreen?this.chart.canvasHeight-e.yAxis.bottom+12:this.chart.canvasHeight-this.chart.panel.yAxis.bottom+12,this.controls.chartControls.style.bottom=i+"px"),this.clearPixelCache(),this.adjustDrawings(),this.runAppend("adjustPanelPositions",arguments)}},I.ChartEngine.prototype.addChart=function(t,e){e.name=t,this.charts[t]=e},I.ChartEngine.prototype.createPanel=function(t,e,i,a,r){if(!this.runPrepend("createPanel",arguments)){a||(a="chart");var n=this.chart.canvasHeight;i||(i=.2*n);var s=i/n,o=1-s;for(var l in this.panels)this.panels[l].percent*=o;this.stackPanel(t,e,s,a,r),this.adjustPanelPositions(),this.savePanels(!1),this.runAppend("createPanel",arguments)}},I.ChartEngine.prototype.configurePanelControls=function(t){if(t.icons){var e,i,a,r,n,s,o,l,h,c,u,p,d,m,g=t.name==t.chart.name;I.appendClassName(t.icons,"stx-show"),t.title=w(".stx-panel-title",t.icons),t.up=w(".stx-ico-up",t.icons),t.up&&(t.up=t.up.parentNode),t.solo=w(".stx-ico-focus",t.icons),t.solo&&(t.solo=t.solo.parentNode),t.down=w(".stx-ico-down",t.icons),t.down&&(t.down=t.down.parentNode),t.edit=w(".stx-ico-edit",t.icons),t.edit&&(t.edit=t.edit.parentNode),t.close=w(".stx-ico-close",t.icons),t.close&&(t.close=t.close.parentNode),t.title&&(t.title.innerHTML="",t.display&&t.title.appendChild(document.createTextNode(t.display)),g&&(I.appendClassName(t.title,"chart-title"),I.appendClassName(t.icons,"stx-chart-panel"))),I.touchDevice&&!I.isSurface||this.makeModal(t.icons),t.handle&&(I.touchDevice&&!I.isSurface||(t.handle.onmouseover=(s=this,function(){s.hideCrosshairs()})),I.touchDevice&&!I.isSurface||(t.handle.onmouseout=(n=this,function(){n.showCrosshairs()})),I.touchDevice&&(t.handle.ontouchstart=(a=this,r=t,function(t){a.resizingPanel||(t.preventDefault(),a.grabHandle(r))}),t.handle.ontouchend=function(t){t.preventDefault()}),t.handle.onmousedown=(e=this,i=t,function(t){t||(t=event),e.grabHandle(i)}),t.handle.onmouseup=function(t){t||(t=event)}),t.close&&(I.safeClickTouch(t.close,(o=this,l=t,function(){o.panelClose(l)})),"chart"==t.name&&(t.close.style.display="none")),t.up&&I.safeClickTouch(t.up,(h=this,c=t,function(){h.panelUp(c)})),t.down&&I.safeClickTouch(t.down,(u=this,p=t,function(){u.panelDown(p)})),t.solo&&I.safeClickTouch(t.solo,(d=this,m=t,function(){d.panelSolo(m)}))}},I.ChartEngine.prototype.stackPanel=function(t,e,i,a,r){if(!this.runPrepend("stackPanel",arguments)){a||(a="chart");var n=this.charts[a],s=e==a;s&&(t=n.symbol,n.symbolDisplay&&(t=n.symbolDisplay),r||(r=n.yAxis));var o=this.panels[e]=new I.ChartEngine.Panel(e,r);!s&&n.yAxis&&o.yAxis.position==n.yAxis.position&&(o.yAxis.width=n.yAxis.width),s&&!n.panel&&(n.panel=o),o.percent=i,o.chart=n,o.display=t,o.holder=I.newChild(this.container,"div","stx-holder"),o.subholder=I.newChild(o.holder,"div","stx-subholder"),o.subholder.style.zIndex=1,o.holder.setAttribute("cq-panel-name",e),o.subholder.setAttribute("cq-panel-name",e);var l=s?"stx-panel-chart":"stx-panel-study";I.appendClassName(o.holder,l),this.controls.handleTemplate&&this.manageTouchAndMouse&&(o.handle=this.controls.handleTemplate.cloneNode(!0),this.container.appendChild(o.handle),o.handle.panel=o),this.controls.iconsTemplate&&(o.icons=this.controls.iconsTemplate.cloneNode(!0),o.subholder.appendChild(o.icons),this.configurePanelControls(o)),this.resizeCanvas(),this.runAppend("stackPanel",arguments)}},I.ChartEngine.prototype.setPanelEdit=function(t,e){t.editFunction=e,t.edit&&I.safeClickTouch(t.edit,e),this.adjustPanelPositions()},I.ChartEngine.prototype.drawPanels=function(){if(!this.runPrepend("drawPanels",arguments)){var t=!1;for(var e in this.panels){var i=this.panels[e];i.state={};var a=this.translateIf(i.display);if(i.title&&i.title.textContent!=a&&(i.title.innerHTML="",i.title.appendChild(document.createTextNode(a))),I.appendClassName(i.icons,"stx-show"),i.hidden)I.unappendClassName(i.icons,"stx-show"),i.handle&&(i.handle.style.display="none"),i.holder.style.display="none";else{var r=this.manageTouchAndMouse;if(this.displayIconsUpDown&&r||!i.up||(i.up.style.display="none"),this.displayIconsUpDown&&r||!i.down||(i.down.style.display="none"),this.displayIconsSolo&&r||!i.solo||(i.solo.style.display="none"),this.displayIconsClose&&r||!i.close||(i.close.style.display="none"),i.editFunction&&r||!i.edit||(i.edit.style.display="none"),i.holder.style.display="block",t){var n=i.top;n=Math.round(n)+.5,this.plotLine(i.left,i.right,n,n,this.canvasStyle("stx_panel_border"),"segment",this.chart.context,!1,{}),i.handle&&(this.displayPanelResize?i.handle.style.display="":i.handle.style.display="none",i.handle.style.top=n-i.handle.offsetHeight/2+"px")}else i.handle&&(i.handle.style.display="none"),t=!0}}this.runAppend("drawPanels",arguments)}},I.ChartEngine.prototype.touchSingleClick=function(t,r,n){var s=this,o=arguments;return function(){(function(){if(!this.cancelTouchSingleClick){if(this.runPrepend("touchSingleClick",o))return;if(this.editingAnnotation)return;if(this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},!this.displayCrosshairs)return;if(!this.displayInitialized)return;if(""!==this.openDialog)return;if(r<this.left||r>this.right||n<this.top||n>this.bottom)return;var t=this.backOutY(I.ChartEngine.crosshairY),e=this.backOutX(I.ChartEngine.crosshairX);this.currentPanel=this.whichPanel(t);var i=this.currentVectorParameters.vectorType;if(!(I.Drawing&&i&&I.Drawing[i]&&(new I.Drawing[i]).dragToDraw)){if(!this.drawingClick(this.currentPanel,e,t)&&!this.layout.crosshair){I.ChartEngine.crosshairY=0,I.ChartEngine.crosshairX=0,this.cx=this.backOutX(I.ChartEngine.crosshairX),this.cy=this.backOutY(I.ChartEngine.crosshairY),this.findHighlights(null,!0),I.ChartEngine.crosshairY=n,I.ChartEngine.crosshairX=r;var a=this.container.getBoundingClientRect();this.top=a.top,this.left=a.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cx=this.backOutX(I.ChartEngine.crosshairX),this.cy=this.backOutY(I.ChartEngine.crosshairY),this.currentPanel&&this.currentPanel.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.cx,this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel))),this.headsUpHR(),this.findHighlights(!0)}this.currentVectorParameters.vectorType||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:e,y:t})}}s.cancelTouchSingleClick=!1,this.runAppend("touchSingleClick",o)}).apply(s,o)}},I.ChartEngine.prototype.touchDoubleClick=function(t,e,i){if(!this.runPrepend("touchDoubleClick",arguments)&&!this.dispatch("doubleTap",{stx:this,finger:t,x:e,y:i})&&!(e<this.left||e>this.right||i<this.chart.panel.top||i>this.chart.panel.bottom||this.editingAnnotation)){if(I.ChartEngine.drawingLine)this.undo();else if(this.anyHighlighted)this.deleteHighlighted();else{var a=this.currentPanel.yAxis;a.scroll==(a.initialMarginTop-a.initialMarginBottom)/2&&a.zoom==a.initialMarginTop+a.initialMarginBottom?this.home():this.calculateYAxisMargins(this.currentPanel.yAxis),this.draw()}this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.runAppend("touchDoubleClick",arguments)}},I.ChartEngine.prototype.startProxy=function(t){if(4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,!this.mouseMode)if(this.touches[this.touches.length]={pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY},this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||1!=this.touches.length)this.gesture.stop(),this.touchstart(t);else{if(this.gesturePointerId=t.pointerId,this.overrideGesture=!1,!this.gesture)return;this.gesture.addPointer(t.pointerId),this.touchstart(t)}},I.ChartEngine.prototype.moveProxy=function(t){4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,this.mouseMode||this.gestureInEffect||this.touchmove(t)},I.ChartEngine.prototype.endProxy=function(t){if(!this.mouseMode){for(var e=this.touches.length,i=0;i<this.touches.length;i++)if(this.touches[i].pointerId==t.pointerId){this.touches.splice(i,1);break}if(i==e)return this.touches=[],this.grabbingScreen=!1,void(this.touching=!1);this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||this.touchend(t)}},I.ChartEngine.prototype.msMouseMoveProxy=function(t){!this.touches.length&&this.mouseMode&&this.mousemove(t)},I.ChartEngine.prototype.msMouseDownProxy=function(t){this.mouseMode&&this.mousedown(t)},I.ChartEngine.prototype.msMouseUpProxy=function(t){this.mouseMode&&this.mouseup(t)},I.ChartEngine.prototype.iosMouseMoveProxy=function(t){this.touching||this.mousemove(t)},I.ChartEngine.prototype.iosMouseDownProxy=function(t){this.touching?this.mouseMode=!1:(this.mouseMode=!0,this.mousedown(t))},I.ChartEngine.prototype.iosMouseUpProxy=function(t){this.touching||this.mouseup(t)},I.ChartEngine.prototype.rawWatermark=function(t,e,i,a){this.canvasFont("stx_watermark",t),t.fillStyle=this.defaultColor,t.globalAlpha=.5,this.chart.context.textBaseline="alphabetic",t.fillText(a,e,i),t.globalAlpha=1},I.ChartEngine.prototype.watermark=function(t,e){if(e&&"object"!=typeof e&&(e={h:e,v:arguments[2],text:arguments[3]}),e={h:e.h||"left",v:e.v||"bottom",text:e.text||"",hOffset:e.hOffset||10,vOffset:e.vOffset||20},this.chart.context){var i=this.panels[t];if(i&&!i.hidden){var a=i.yAxis.bottom-e.vOffset;"top"==e.v?a=i.top+e.vOffset:"middle"==e.v&&(a=(i.top+i.yAxis.bottom)/2),this.chart.context.save(),this.canvasFont("stx_watermark"),this.canvasColor("stx_watermark"),this.chart.context.textBaseline="alphabetic";var r=i.left+e.hOffset;"right"==e.h?r=i.right-e.hOffset:"center"==e.h&&(r=(i.right+i.left-this.chart.context.measureText(e.text).width)/2),this.chart.context.globalAlpha=.5,this.chart.context.fillText(e.text,r,a),this.chart.context.globalAlpha=1,this.chart.context.restore()}}},I.ChartEngine.prototype.preAdjustScroll=function(t){t||(t=this.chart),this.previousAdjust={chart:t,scroll:t.scroll,maxTicks:t.maxTicks}},I.ChartEngine.prototype.postAdjustScroll=function(){if(this.previousAdjust){var t=this.previousAdjust.chart;t.scroll=this.previousAdjust.scroll+(t.maxTicks-this.previousAdjust.maxTicks),this.displayInitialized&&this.draw()}},I.ChartEngine.prototype.adjustDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++){var e=this.drawingObjects[t];this.panels[e.panelName]&&e.adjust()}},I.ChartEngine.prototype.getNextInterval=function(t,e,i){e||(e=1),!1!==i&&(i=!0);var a=this.standardMarketIterator(t,i?this.dataZone:this.displayZone);return e<1?a.previous(-1*e):a.next(e)},I.ChartEngine.prototype.standardMarketIterator=function(t,e,i){var a=i||this.chart,r={begin:t,interval:"tick"==this.layout.interval?1:this.layout.interval,periodicity:"tick"==this.layout.interval?this.chart.xAxis.futureTicksInterval:this.layout.periodicity,timeUnit:this.layout.timeUnit,outZone:e};return a.market.newIterator(r)},I.ChartEngine.prototype.zoomSet=function(t,e){var i=this.mainSeriesRenderer||{};if(!i.params||!i.params.volume){var a;a=this.preferences.zoomAtCurrentMousePosition&&this.zoomInitiatedByMouseWheel&&this.crosshairTick<e.dataSet.length?this.crosshairTick||this.tickFromPixel(this.cx,e):this.isHome()?e.dataSet.length-1:this.chart.scroll>this.chart.dataSet.length?0:"zoom-x"==this.grabMode?this.tickFromPixel(this.chart.width,e):this.tickFromPixel(this.chart.width/2,e),this.animations.zoom.hasCompleted&&(this.zoomInitiatedByMouseWheel=!1);var r=e.dataSet.length-1-a,n=e.scroll;e.scroll=Math.floor((this.pixelFromTick(a,e)-e.left)/t)+1+r,this.micropixels+=(n-r)*this.layout.candleWidth-(e.scroll-r)*t}this.setCandleWidth(t),e.spanLock=!1,this.draw(),this.doDisplayCrosshairs(),this.updateChartAccessories()},I.ChartEngine.prototype.zoomOut=function(t,e){if(!this.runPrepend("zoomOut",arguments)){this.preferences.zoomOutSpeed?e=this.preferences.zoomOutSpeed:e||(e=1.3),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a];if(I.ipad&&r.maxTicks>I.ChartEngine.ipadMaxTicks)return;var n=Math.floor(r.maxTicks*e);!1===r.allowScrollFuture&&!1===r.allowScrollPast&&n>r.dataSet.length&&(n=r.dataSet.length);var s=this.chart.width/n;s<this.minimumCandleWidth&&(s=this.minimumCandleWidth),this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,s)}}function o(e){return function(t){if(i.zoomSet(t,e),i.animations.zoom.hasCompleted){if(i.runAppend("zoomOut",arguments))return;i.changeOccurred("layout")}}}},I.ChartEngine.prototype.mouseWheel=function(t){if(!this.runPrepend("mouseWheel",arguments)){t||(t=event),t.preventDefault&&t.preventDefault();var e=t.deltaX,i=t.deltaY;if(Math.abs(i)>Math.abs(e)?e=0:i=0,this.lastMouseWheelEvent=Date.now(),0!==Math.abs(e)||0!==Math.abs(i)){if(this.allowSideswipe&&0!==e){this.lastMove="horizontal";var a=e;return 50<a&&(a=50),a<-50&&(a=-50),this.grabbingScreen=!0,this.currentPanel||(this.currentPanel=this.chart.panel),this.grabStartX=I.ChartEngine.crosshairX,this.grabStartY=I.ChartEngine.crosshairY,this.grabStartScrollX=this.chart.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartMicropixels=this.micropixels,this.grabStartPanel=this.currentPanel,this.mousemoveinner(I.ChartEngine.crosshairX-a,I.ChartEngine.crosshairY),this.updateChartAccessories(),void(this.grabbingScreen=!1)}if(this.lastMove="vertical",this.allowZoom&&this.displayInitialized){i||("onmousewheel"==I.wheelEvent?(i=-.025*t.wheelDelta,t.wheelDeltaX&&(e=-.025*t.wheelDeltaX)):i=t.detail),void 0===t.deltaMode&&(t.deltaMode="MozMousePixelScroll"==t.type?0:1);var r=-i;1==t.deltaMode&&(r*=33);var n=null,s=null;if(this.mouseWheelAcceleration){var o=Math.max(Math.pow(Math.abs(r),.3),1);n=1-.1*o,s=1+.2*o}if(this.zoomInitiatedByMouseWheel=!0,0<r?this.reverseMouseWheel?this.zoomOut(null,s):this.zoomIn(null,n):r<0&&(this.reverseMouseWheel?this.zoomIn(null,n):this.zoomOut(null,s)),!this.runAppend("mouseWheel",arguments))return!1}}}},I.ChartEngine.prototype.zoomIn=function(t,e){if(!this.runPrepend("zoomIn",arguments)){this.preferences.zoomInSpeed?e=this.preferences.zoomInSpeed:e||(e=.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a],n=Math.floor(r.maxTicks*e);r.maxTicks-n<1&&(n=r.maxTicks-1),n<this.minimumZoomTicks&&(n=this.minimumZoomTicks);var s=this.chart.width/n;this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,s)}}function o(e){return function(t){if(i.zoomSet(t,e),i.animations.zoom.hasCompleted){if(i.runAppend("zoomIn",arguments))return;i.changeOccurred("layout")}}}},I.ChartEngine.prototype.translateIf=function(t){return this.translationCallback?this.translationCallback(t):t},I.ChartEngine.prototype.setTimeZone=function(t,e){if(void 0!==p){var i=new Date,a=i.getTimezoneOffset(),r=a,n=a;for(var s in t&&(this.dataZone=t),this.dataZone&&(r=new p.Date(i,this.dataZone).getTimezoneOffset()),e&&(this.displayZone=e),this.displayZone&&(n=new p.Date(i,this.displayZone).getTimezoneOffset()),this.timeZoneOffset=r-a-(n-a),this.charts){var o=this.charts[s];this.setDisplayDates(o.masterData)}this.preferences.timeZone=e,this.changeOccurred("preferences"),this.createDataSet()}else this.timeZoneOffset=0},I.ChartEngine.prototype.setLocale=function(t,e){if("undefined"!=typeof Intl&&this.locale!=t){this.locale=t;var i,a=this.internationalizer={};for(a.hourMinute=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",hour12:!1}),a.hourMinuteSecond=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),a.mdhm=new Intl.DateTimeFormat(this.locale,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a.monthDay=new Intl.DateTimeFormat(this.locale,{month:"numeric",day:"numeric"}),a.yearMonthDay=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric",day:"numeric"}),a.yearMonth=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric"}),a.month=new Intl.DateTimeFormat(this.locale,{month:"short"}),a.numbers=new Intl.NumberFormat(this.locale),a.priceFormatters=[],e||(e=8),i=0;i<e+1;i++)a.priceFormatters.push(new Intl.NumberFormat(this.locale,{maximumFractionDigits:i,minimumFractionDigits:i}));for(i=0;i<5;i++){var r=i,n=i;i||(r="",n=2),a["percent"+r]=new Intl.NumberFormat(this.locale,{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n})}I.I18N.createMonthArrays&&I.I18N.createMonthArrays(this,a.month,this.locale)}},I.ChartEngine.prototype.importLayout=function(t,e){if(t){"object"!=typeof e&&(e={managePeriodicity:e,preserveTicksAndCandleWidth:arguments[2]});var i=this.layout,a=I.shallowClone(i),r=e.managePeriodicity,n=e.cb,s=e.seriesCB,o=e.noDataLoad,l=this.minimumCandleWidth,h=e.preserveTicksAndCandleWidth,c=this.exportDrawings();if(this.abortDrawings(),this.currentlyImporting=!0,I.Studies)for(var u in i.studies){var p=i.studies[u];I.Studies.removeStudy(this,p)}this.overlays={};var d=I.shallowClone(this.panels);this.panels={};var m=I.clone(t);I.dataBindSafeAssignment(i,I.clone(m)),i.periodicity=a.periodicity,i.interval=a.interval,i.timeUnit=a.timeUnit,i.setSpan=a.setSpan,i.range=a.range,h?i.candleWidth=a.candleWidth:i.candleWidth||(i.candleWidth=8),i.candleWidth<l&&(i.candleWidth=l),this.setCandleWidth(i.candleWidth),"percent"==i.chartScale&&this.setComparison(!0);var g,f,y,v=m.panels,x=[];for(f in v){if(!("top"in v[f]))break;for((y=v[f]).name=f,g=x.length-1;0<=g&&x[g].top>y.top;--g);x.splice(g+1,0,y)}if(i.panels={},0<x.length)for(var C=0;C<x.length;++C)y=x[C],this.stackPanel(y.display,y.name,y.percent,y.chartName);else for(f in v)y=v[f],yAxis=y.yAxis?new I.ChartEngine.YAxis(y.yAxis):null,this.stackPanel(y.display,f,y.percent,y.chartName,yAxis);for(var S in I.isEmpty(v)&&this.stackPanel("chart","chart",1,"chart"),d){var b=d[S],w=this.panels[S];if(w){for(var T in this.container.removeChild(w.holder),b.handle&&this.container.removeChild(b.handle),{holder:!0,subholder:!0,display:!0,icons:!0})w[T]=b[T];this.configurePanelControls(w),b.chart.panel==b&&(b.chart.panel=w)}else this.privateDeletePanel(b)}if(this.adjustPanelPositions(),this.storePanels(),I.Studies){var D=I.clone(i.studies);for(var A in delete i.studies,D){var M=D[A];I.Studies.addStudy(this,M.type,M.inputs,M.outputs,M.parameters,M.panel)}}this.extendedHours&&this.extendedHours.prepare(i.extended,i.marketSessions),void 0===i.chartType&&(i.chartType="line"),this.setMainSeriesRenderer(),this.adjustPanelPositions();var k=this;if(!o){if(m.symbols&&m.symbols.length){var F={};!h&&r&&m.range&&Object.keys(m.range).length?F.range=m.range:!h&&r&&m.setSpan&&Object.keys(m.setSpan).length?F.span=m.setSpan:r&&m.interval?F.periodicity={interval:m.interval,period:m.periodicity,timeUnit:m.timeUnit}:F.periodicity={interval:a.interval,period:a.periodicity,timeUnit:a.timeUnit};var P=m.symbols[0].symbolObject||m.symbols[0].symbol;return void this.newChart(P,null,this.chart,function(t){if(!t)for(var e,i=1;i<m.symbols.length;++i){(e=m.symbols[i]).parameters||(e.parameters={});var a=I.clone(e.parameters);a.action=null,k.addSeries(e.id,a,s)}O(),n&&n.apply(null,arguments)},F)}if(r){if(!h){var _=m.range;if(_&&Object.keys(_).length&&this.chart.symbol)return void this.setRange(_,function(){O(),n&&n()});if(m.setSpan&&Object.keys(m.setSpan).length&&this.chart.symbol)return void this.setSpan(m.setSpan,function(){O(),n&&n()})}var N=m.interval,E=m.periodicity,L=m.timeUnit;return isNaN(E)&&(E=1),N||(N="day"),void this.setPeriodicity({period:E,interval:N,timeUnit:L},function(){O(),n&&n()})}}r&&(i.periodicity=m.periodicity,i.interval=m.interval,i.timeUnit=m.timeUnit,i.setSpan=m.setSpan),this.createDataSet(),h||this.home(),O(),n&&n()}else e.cb&&e.cb();function O(){k.importDrawings(c),k.currentlyImporting=!1,k.draw(),k.updateListeners("layout")}},I.ChartEngine.prototype.exportLayout=function(t){var e={};for(var i in this.layout)"studies"!=i&&"panels"!=i?e[i]=I.clone(this.layout[i]):"studies"==i?e.studies={}:"panels"==i&&(e.panels={});for(var a in this.panels){var r=e.panels[a]={},n=this.panels[a];r.percent=n.percent,r.display=n.display,r.chartName=n.chart.name,r.top=n.top,n.yAxis.position&&(r.yAxis={position:n.yAxis.position})}for(var s in this.layout.studies){var o=e.studies[s]={},l=this.layout.studies[s];o.type=l.type,o.inputs=I.clone(l.inputs),o.outputs=I.clone(l.outputs),o.panel=l.panel,o.parameters=I.clone(l.parameters)}return t?e.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0}):delete e.symbols,e},I.ChartEngine.prototype.doCleanupDates=function(t,e){if(t&&t.length)for(var i=0;i<t.length;i++){var a=t[i],r=a.DT;if(r||a.Date){if(a.DT&&"[object String]"==Object.prototype.toString.call(r)&&r.length<=10)(r=new Date(r)).setMinutes(r.getMinutes()+r.getTimezoneOffset());else{var n=!0;if(a.DT||(r=I.strToDateTime(a.Date),a.Date.length<=10&&(n=!1)),"[object Date]"!=Object.prototype.toString.call(r)&&(r=new Date(r)),this.dataZone&&n){var s=new p.Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),this.dataZone),o=1e3*r.getSeconds()+r.getMilliseconds();r=new Date(s.getTime()+o)}I.ChartEngine.isDailyInterval(e)&&r.setHours(0,0,0,0)}a.DT||(a.Date=I.yyyymmddhhmmssmmm(r)),a.DT=r}}},I.ChartEngine.prototype.doCleanupGaps=function(t,e,o){if(!t||!t.length)return t;var i=this.layout.interval;o=o||{},e||(e=this.chart),o.noCleanupDates||this.doCleanupDates(t,i);var a=o.cleanupGaps;if(!1===a)return t;a&&!0!==a||(a=this.cleanupGaps||a);var l="gap"==a;if(!a)return t;if("tick"==i)return t;if("month"==i||"week"==i){if(this.dontRoll)return t;i="day"}var r=function(t){return t.DT?"[object Date]"!=Object.prototype.toString.call(t.DT)?new Date(t.DT):new Date(+t.DT):I.strToDateTime(t.Date)},h=[],c=t[0];h.push(c);var n={begin:r(c),interval:i,periodicity:1,timeUnit:this.layout.timeUnit},u=new I.Market(e.market.market_def).newIterator(n);this.extendedHours&&this.extendedHours.filter&&u.market.enableAllAvailableSessions();var s,p=e.defaultPlotField;function d(t,e){var i=o.field,a=i?c[i]:c;void 0===a&&(a={});for(var r=l?null:a[p],n=l?null:a.Adj_Close;+t<+e;){var s={DT:t};i||(h.push(s),I.extend(s,{Open:r,High:r,Low:r,Close:r,Volume:0,Adj_Close:n})),t=u.next()}}function m(t,e){var i=o.field;if(i)void 0!==t[i]&&void 0===e[i]&&(e[i]=l?null:t[i]);else if(!l){var a=t[p],r=e[p];void 0!==a&&void 0===r&&I.ensureDefaults(e,{Close:a,Open:a,High:a,Low:a,Volume:0,Adj_Close:t.Adj_Close})}}for(var g=1;g<t.length;g++){var f=t[g];s=u.next();var y=r(f);for(d(s,y);y<s;){if(++g==t.length)return h;m(c,f),h.push(f),c=f,y=r(f=t[g])}s<y?(g--,s=u.previous()):(m(c,f),h.push(f),c=f)}return h},I.Comparison=function(){},I.Comparison.initialPrice=100,I.Comparison.getInitialPrice=function(t){if(t.initialComparisonPrice)return t.initialComparisonPrice;t.initialComparisonPrice=100;var e=I.Comparison.initialPrice;if("number"==typeof e&&(t.initialComparisonPrice=e),"string"==typeof e&&(t.series[e]||""===e)){var i="Close";t.defaultPlotField&&(t.highLowBars||(i=t.defaultPlotField));for(var a=t.dataSet.length-t.scroll;a<t.dataSet.length;a++){var r=t.dataSet[a];if(r){if(r[e]&&r[e][i]){t.initialComparisonPrice=r[e][i];break}if(""===e&&r[i]){t.initialComparisonPrice=r[i];break}}}}return t.initialComparisonPrice},I.Comparison.priceToPercent=function(t,e,i){var a=I.Comparison.baseline||i;return Math.round((i-a)/a*100*1e4)/1e4},I.Comparison.percentToPrice=function(t,e,i){return(I.Comparison.baseline||1)*(1+i/100)},I.Comparison.priceToRelative=function(t,e,i){var a=I.Comparison.baseline||i;return I.Comparison.getInitialPrice(e)*i/a},I.Comparison.relativeToPrice=function(t,e,i){return(I.Comparison.baseline||1)*i/I.Comparison.getInitialPrice(e)},I.Comparison.createComparisonSegmentInner=function(t,e){var i,a,r,n=[];for(i in e.series){var s=e.series[i].parameters;s.isComparison&&n.push(s.symbol)}var o=["Close","Open","High","Low","iqPrevClose"],l=t.chart.highLowBars||t.highLowBars[t.layout.chartType];e.defaultPlotField&&!l&&o.unshift(e.defaultPlotField);var h=o[0],c=t.layout.studies;if(c)for(var u in c){var p=c[u];if(a=t.panels[p.panel],r=t.getYAxisByName(a,p.name)||a.yAxis,a&&a.yAxis==r){for(i in p.outputMap)o.push(i);for(var d=0;d<=2;d++)o.push(p.name+"_hist"+(d||""));p.referenceOutput&&o.push(p.referenceOutput+" "+p.name)}}for(var m in t.plugins){var g=t.plugins[m];if(g.transformOutputs)for(i in g.transformOutputs)o.push(i)}e.initialComparisonPrice=null,e.dataSegment=[];var f=null,y=e.dataSet.length-e.scroll;t.micropixels+t.layout.candleWidth/2<0&&y++;for(var v=e.maxTicks+3,x=0;x<=v;x++){x==v&&(x=-1);var C=y+x;if(C<e.dataSet.length&&0<=C){var S,b=e.dataSet[C],w=b[h];if(!f){if(0===w||null===w){if(x<0)break;continue}f=I.clone(b)}for(b.transform||(b.transform={cache:{},DT:b.DT,Date:b.Date}),!I.Comparison.baseline&&w&&(f=I.clone(b)),I.Comparison.baseline=f[h],S=0;S<o.length;S++)(b[i=o[S]]||0===b[i])&&(b.transform[i]=e.transformFunc(t,e,b[i]));for(S=0;S<n.length;S++){i=n[S];var T=e.series[i];if(-1==x&&T&&T.parameters.isComparison)delete b.transform[i];else for(var D=b[i],A=0;D&&A<o.length;A++){var M=D[o[A]];if(M||0===M){var k=f[i]&&f[i][o[0]];if(k||0===k||(f[i]||(f[i]={}),f[i][o[A]]=k=M*I.Comparison.baseline/b[h]),0!==k){var F=M*((I.Comparison.baseline||1)/k);b.transform[i]||(b.transform[i]={}),b.transform[i][o[A]]=e.transformFunc(t,e,F)}}}}e.dataSegment.push(b)}else C<0&&e.dataSegment.push(null);if(x<0)break}},I.Comparison.priceFormat=function(t,e,i){if(null==i||isNaN(i))return"";var a=e.yAxis.priceTick,r=t.internationalizer;return i=r?5<=a?r.percent.format(i/100):.5<=a?r.percent1.format(i/100):.05<=a?r.percent2.format(i/100):.005<=a?r.percent3.format(i/100):r.percent4.format(i/100):5<=a?i.toFixed(0)+"%":.5<=a?i.toFixed(1)+"%":.05<=a?i.toFixed(2)+"%":.005<=a?i.toFixed(3)+"%":i.toFixed(4)+"%",0===parseFloat(i)&&"-"==i.charAt(0)&&(i=i.substring(1)),i},I.ChartEngine.prototype.setComparison=function(t,e,i){if(e||(e=this.chart),"string"==typeof e&&(e=this.charts[e]),(i||""===i)&&(I.Comparison.initialPrice=i),!0===t){if(e.isComparison)return;t="percent"}this.resetDynamicYAxis();var a=e.panel.yAxis,r=a.priceFormatter==I.Comparison.priceFormat;switch(t){case"relative":this.setTransform(e,I.Comparison.priceToRelative,I.Comparison.relativeToPrice),r&&(a.priceFormatter=a.originalPriceFormatter?a.originalPriceFormatter.func:null,a.originalPriceFormatter=null),a.whichSet="dataSegment",e.isComparison=!0;break;case"percent":this.setTransform(e,I.Comparison.priceToPercent,I.Comparison.percentToPrice),r||(a.originalPriceFormatter={func:a.priceFormatter},a.priceFormatter=I.Comparison.priceFormat),a.whichSet="dataSegment",e.isComparison=!0;break;default:this.unsetTransform(e),r&&(a.priceFormatter=a.originalPriceFormatter?a.originalPriceFormatter.func:null,a.originalPriceFormatter=null),a.whichSet="dataSet",e.isComparison=!1}},I.ChartEngine.prototype.importPreferences=function(t){I.extend(this.preferences,t),t.timeZone&&this.setTimeZone(this.dataZone,t.timeZone),t.language&&I.I18N&&I.I18N.localize(this,t.language),this.changeOccurred("preferences")},I.ChartEngine.prototype.exportPreferences=function(){return this.preferences},"undefined"!=typeof document&&document.addEventListener("contextmenu",I.ChartEngine.handleContextMenu),s(t),(V=t.CIQ).ChartEngine.prototype.setRange=function(x,C){V.isEmpty(x)&&(x={dtLeft:x,dtRight:C,padding:arguments[2],chart:arguments[3]},C=arguments[4]),this.staticRange&&(x.goIntoPast=x.goIntoFuture=!0),x.chart||(x.chart=this.chart),void 0===x.padding&&(x.padding=0);var t,e=!1,S=x.chart,b="string"==typeof x.dtLeft?new Date(x.dtLeft):x.dtLeft,w=new Date;x.dtRight&&(w="string"==typeof x.dtRight?new Date(x.dtRight):x.dtRight),b||(t=this.standardMarketIterator(w,null,S),b=t.previous(S.maxTicks),x.periodicity||(e=!0)),S.inflectionPoint=b,this.layout.range={dtLeft:b,dtRight:w};var T=this;function i(t){void 0===t&&(t=null);var e=0,i=0,a=new Date,r=x.base,n=x.periodicity,s=T.layout;if(x.goIntoFuture&&(!S.masterData.length||b>S.masterData[S.masterData.length-1].DT)){var o=S.masterData.length?S.masterData.pop():{DT:b},l=T.doCleanupGaps([o,{DT:w}],S,{cleanupGaps:"gap",noCleanupDates:!0});T.setMasterData(S.masterData.concat(l),S,{noCleanupDates:!0}),T.createDataSet(null,null,{appending:!0})}var h=S.dataSet,c=h.length;if(h&&0!==c){var u;if("day"===r&&n&&"day"===n.interval){var p=x.multiplier;e=c<p?0:c-p,i=c-1}else if("today"===r&&h[c-1].DT.getDate()!=a.getDate()){var d=new Date(h[c-1].DT.getTime());d.getTime(),u=0;for(var m=c-1;0<=m;m--)if(h[m]&&h[m].DT.getDate()!=d.getDate()){d=new Date(+h[m+1].DT),u=m+1;break}e=u,i=c-1}else e="all"!=x.base&&(b.getTime()>=h[0].DT.getTime()||x.goIntoPast)?T.tickFromDate(b,S,null,!0):0,"all"!=x.base&&(w.getTime()<=h[c-1].DT.getTime()||x.goIntoFuture)?c-1<(i=T.tickFromDate(w,S))&&i--:i=c-1;var g=i-e+1;if(g<1)C&&C(t);else{var f=x.padding||0;i<c-1&&(f=0);var y=(S.width-f)/g;for(var v in T.setCandleWidth(y,S),S.scroll=g-(i-c)-1,T.micropixels=1,T.panels)T.calculateYAxisMargins(T.panels[v].yAxis);x.dontSaveRangeToLayout?delete s.range:(delete x.chart,delete s.setSpan,s.range=x),T.draw(),T.changeOccurred("layout"),C&&C(t)}}else C&&C(t)}var a,r,n,s,o,l,h,c=0;function u(t){return t&&0===c?(S.scroll=E,T.setCandleWidth(L),T.layout.interval=O,T.layout.periodicity=I,T.layout.timeUnit=H,void(C&&C(t))):(10<++c&&console.log("CIQ.ChartEngine.setRange(): Too many loads (10) from server. Stopping. Check periodicity logic."),void i())}if(this.quoteDriver){var p,d,m;if(e)p=this.layout.interval,m=this.layout.timeUnit,d=this.layout.periodicity;else if(x.periodicity){var g=V.cleanPeriodicity(x.periodicity.period,x.periodicity.interval,x.periodicity.timeUnit);p=g.interval,m=g.timeUnit,d=g.period}else{var f=w.getTime()-b.getTime();if(this.autoPickCandleWidth.turnOn){var y=0;y=this.autoPickCandleWidth.candleWidth?this.autoPickCandleWidth.candleWidth:this.barsHaveWidth[this.layout.chartType]?5:2;var v,D=S.width/y,A=this.dynamicRangePeriodicityMap;p=A[0].interval,d=1;for(var M=0;M<A.length;M++){var k=f/A[M].rangeInMS;if(k<D){d=A[M-1]?(p=A[M-1].interval,m=A[M-1].timeUnit,Math.ceil(v/D)):(p=A[M].interval,m=A[M].timeUnit,1);break}v=k}}else{for(var F=this.staticRangePeriodicityMap,P=null,_=0;_<F.length;_++){var N=F[_];if(f/N.rangeInMS<1.001){P=N;break}}p=P.interval,d=P.periodicity,m=P.timeUnit}}var E=this.chart.scroll,L=this.layout.candleWidth,O=this.layout.interval,I=this.layout.periodicity,H=this.layout.timeUnit;this.chart.scroll=this.chart.maxTicks=(a=w.getTime(),r=b.getTime(),n=p,s=d,o=m,this.dontRoll,l=0,h=a-r,V.ChartEngine.isDailyInterval(n)?l="month"==n?h/V.MONTH/s:"week"==n?h/V.WEEK/s:h/V.DAY/s:isNaN(n)||(l="millisecond"==o?h/(s*n):"second"==o?h/V.SECOND/(s*n):h/V.MINUTE/(s*n)),Math.round(l)),this.layout.candleWidth=this.chart.width/this.chart.maxTicks;var R=this.needDifferentData({period:d,interval:p,timeUnit:m});if(Object.keys(this.chart.endPoints).length&&(this.chart.endPoints.begin>b||this.chart.endPoints.end<w)&&(R=!0),!this.chart.masterData||!this.chart.masterData.length||R||x.forceLoad){this.layout.interval=p,this.layout.periodicity=d,this.layout.timeUnit=m,this.layout.timeUnit||(V.ChartEngine.isDailyInterval(this.layout.interval)?this.layout.timeUnit=null:"second"==this.layout.interval?this.layout.timeUnit="second":"tick"!=this.layout.interval&&(this.layout.timeUnit="minute"));var z={symbol:S.symbol,symbolObject:S.symbolObject,chart:S,nodraw:!0};this.isHistoricalModeSet=!0,"tick"==this.layout.interval&&(z.startDate=b,z.endDate=w),this.displayInitialized||(z.initializeChart=!0);var B=Math.max(this.quoteDriver.behavior.bufferSize+50,200);t=this.standardMarketIterator(b,null,S),z.startDate=new Date(t.previous(B).getTime()),this.isHistoricalModeSet&&(t=this.standardMarketIterator(w,null,S),z.endDate=new Date(t.next(B).getTime())),this.clearCurrentMarketData(this.chart),this.quoteDriver.newChart(z,u)}else this.layout.interval==p&&this.layout.periodicity==d&&this.layout.timeUnit==m&&this.chart.dataSegment&&this.chart.dataSegment[0]&&this.chart.dataSegment[0].DT==S.inflectionPoint||(this.layout.interval=p,this.layout.periodicity=d,this.layout.timeUnit=m,this.createDataSet()),u()}else i()},V.ChartEngine.prototype.setSpan=function(e,i){var t=e,a=i,r=arguments[2],n=arguments[3];"object"==typeof e?(t=e.period?e.period:e.multiplier?e.multiplier:1,a=e.interval?e.interval:e.base?e.base:e.span?e.span:e.period,r=e.padding,n=e.chart):(e={period:t,interval:a,padding:r,chart:n},i=arguments[5]),n||(n=this.chart);var s,o=n.market;if("all"==(a=a.toLowerCase()))return e.dontSaveRangeToLayout=!0,void this.displayAll(e,i);var l=a,h=1;"today"==a?l="day":"year"==a&&(l="month",h=12);var c=V.shallowClone(e),u={begin:o.marketZoneNow(),interval:l,period:h},p=u.begin;function d(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}var m=V.Market.Symbology.isForexSymbol(n.symbol);function g(t,e){return m&&(e?t.setHours(t.getHours()+7):(t.setHours(t.getHours()-7),o.isMarketDate(t)||t.setDate(t.getDate()-2))),t}if("ytd"===a)(p=d(p)).setMonth(0),p.setDate(1);else if("month"===a)(p=d(new Date)).setMonth(p.getMonth()-t);else if("year"===a)(p=d(new Date)).setFullYear(p.getFullYear()-t);else if("week"===a)(p=d(new Date)).setDate(p.getDate()-7*t);else if("day"===a&&1==t&&o.isMarketDay()){var f=p.getHours(),y=p.getMinutes(),v=p.getSeconds(),x=p.getMilliseconds();(p=(s=o.newIterator(u)).previous()).setHours(f,y,v,x),p=o._convertFromMarketTZ(p)}else"today"===a?(u.begin=g(p,!0),s=o.newIterator(u),(o.isOpen()||o.getPreviousOpen().getDate()==p.getDate())&&s.next(),g(p=s.previous()),c.goIntoFuture=!0,c.dtRight=new Date(+p),c.dtRight.setDate(p.getDate()+1),c.dtRight=o._convertFromMarketTZ(c.dtRight),m||(p.setHours(s.market.zopen_hour),p.setMinutes(s.market.zopen_minute),p.setSeconds(0)),p=o._convertFromMarketTZ(p)):("day"==a&&(u.begin=g(p,!0)),1==t&&t++,p=(s=o.newIterator(u)).previous(t-1),"day"==a&&(p=o._convertFromMarketTZ(g(p))));c.dtLeft=p,c.maintainPeriodicity&&(c.periodicity={},c.periodicity.interval=this.layout.interval,c.periodicity.period=this.layout.periodicity),n.spanLock=!1,c.dontSaveRangeToLayout=!0;var C=this;this.setRange(c,function(t){C.layout.setSpan=e,C.changeOccurred("layout"),"today"==a&&(n.spanLock=!0),i&&i(t)})},V.ChartEngine.prototype.getSpanCandleWidth=function(t){if(t&&t.base&&t.multiplier){var e=parseFloat(t.multiplier),i=t.base,a=new Date,r=new Date;"year"==i?r.setFullYear(r.getFullYear()-e):"month"==i?r.setMonth(r.getMonth()-e):"day"==i?r.setDate(r.getDate()-e):"week"==i?r.setDate(r.getDate()-7*e):"YTD"==i&&(r.setMonth(0),r.setDate(1));var n=(a.getTime()-r.getTime())/1e3/60/60/24;return n=5*n/7,this.chart.width/n}},V.ChartEngine.prototype.displayAll=function(i,a){var e=this.chart;i&&i.chart&&(e=i.chart);var r=this;function n(){if(e.masterData&&e.masterData.length){var t=V.clone(i);t.dtLeft=e.masterData[0].DT,t.dtRight=e.masterData[e.masterData.length-1].DT,t.periodicity={},t.periodicity.interval=r.layout.interval,t.periodicity.period=r.layout.periodicity,t.periodicity.timeUnit=r.layout.timeUnit,r.setRange(t,function(t){for(var e in r.layout.setSpan={base:i.base,multiplier:i.multiplier},r.changeOccurred("layout"),r.panels)r.calculateYAxisMargins(r.panels[e].yAxis);r.draw(),a&&a(t)})}}function t(t){t||r.quoteDriver.loadAll(e,n)}if(this.quoteDriver){var s=i.maintainPeriodicity?{period:this.layout.periodicity,interval:this.layout.interval}:{period:1,interval:"month"};s=i.periodicity?i.periodicity:s,s=V.cleanPeriodicity(s.period,s.interval,s.timeUnit);var o=this.needDifferentData(s);this.layout.periodicity=s.period,this.layout.interval=s.interval,this.layout.timeUnit=s.timeUnit,i.forceLoad||o?(this.clearCurrentMarketData(this.chart),this.quoteDriver.newChart({noDraw:!0,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,chart:this.chart,initializeChart:!0,fetchMaximumBars:!0},t)):e.moreAvailable?t():(this.createDataSet(),n())}else n()},(k=t.CIQ).QuoteFeed=function(){},k.QuoteFeed.prototype.fetch=function(t,e){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},k.QuoteFeed.prototype.announceError=function(t,e){t.suppressErrors||e.suppressAlert||t.startDate||t.endDate||e.error&&k.alert("Error fetching quote:"+e.error)},k.QuoteFeed.prototype.multiFetch=function(t,e){0===t.length&&e([]);var i={counter:0,finished:t.length,results:[]};function a(i,a,r){return function(t){if(a.results.push({dataCallback:t,params:i}),a.counter++,a.counter>=a.finished){var e=a.results;a.results=[],r(e)}}}for(var r=0;r<t.length;r++){var n=t[r];n.stx.isEquationChart(n.symbol)?k.fetchEquationChart(n,a(n,i,e)):k.ChartEngine.Driver.fetchData(k.QuoteFeed.SERIES,this,n,a(n,i,e))}},k.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},k.QuoteFeed.Subscriptions.ciqInheritsFrom(k.QuoteFeed),k.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(e){for(var t,i,a=e.getSymbols(),r=0;r<this.subscriptions.length;r++)this.subscriptions[r].match=!1;for(var n=0;n<a.length;n++){var s=(i=a[n]).interval;for("month"!=s&&"week"!=s||e.dontRoll||(s="day"),i.interval=s,i.period=1,i.match=!1,isNaN(i.interval)||(i.period=i.interval,i.interval=i.timeUnit,i.interval||(i.interval="minute")),delete i.periodicity,delete i.timeUnit,delete i.setSpan,r=0;r<this.subscriptions.length;r++){if((t=this.subscriptions[r]).symbol==i.symbol&&t.period==i.period&&t.interval==i.interval){i.match=!0,t.match=!0;break}t.symbol!=i.symbol?("period"!=i.reason&&(i.reason="symbol"),t.reason="symbol"):(i.reason="period",t.reason="period")}}var o=this;this.subscriptions=this.subscriptions.filter(function(t){return t.match||(t.stx||(t.stx=e),o.unsubscribe(t)),t.match}),a.forEach(function(t){t.match||(t.stx||(t.stx=e),t.reason||(t.reason="initialize"),o.subscribe(t),o.subscriptions.push(t))})},k.QuoteFeed.Subscriptions.prototype.fetch=function(e,i){var a=this;this.fetchFromSource(e,function(t){t.error||a.checkSubscriptions(e.stx),i(t)})},k.QuoteFeed.Subscriptions.prototype.subscribe=function(t){console.log("subscribe",t)},k.QuoteFeed.Subscriptions.prototype.unsubscribe=function(t){console.log("unsubscribe",t)},k.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(t,e){console.log("Please provide implementation of fetchFromSource")},k.QuoteFeed.prototype.requiresImmediateRefresh=function(t){return!1},k.ChartEngine.prototype.attachQuoteFeed=function(e,t){t||(t={}),this.quoteDriver&&this.quoteDriver.die(),("function"==typeof e.fetchInitialData||"function"==typeof e.fetchUpdateData||"function"==typeof e.fetchPaginationData)&&("function"!=typeof e.fetchPaginationData&&"function"!=typeof e.fetchUpdateData&&(t.noLoadMore=!0),e.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach(function(t){e[t]||!1===e[t]||(e[t]=k.QuoteFeed.prototype[t])}),"function"==typeof e.subscribe&&(e.checkSubscriptions=k.QuoteFeed.Subscriptions.prototype.checkSubscriptions,e.subscriptions=[])),this.quoteDriver=new k.ChartEngine.Driver(this,e,t)},k.ChartEngine.prototype.attachEngineQuoteFeed=function(t,e){console.log("CIQ.ChartEngine.attachEngineQuoteFeed is now Deprecated. Use CIQ.ChartEngine.attachQuoteFeed instead"),this.attachQuoteFeed(t,e)},k.ChartEngine.prototype.attachTagAlongQuoteFeed=function(t){t.label?this.quoteDriver.attachTagAlongQuoteFeed(t):console.log("Attempt to attachTagAlongQuoteFeed without assigning a label")},k.ChartEngine.prototype.detachTagAlongQuoteFeed=function(t){t.label?this.quoteDriver.detachTagAlongQuoteFeed(t):console.log("Attempt to detachTagAlongQuoteFeed without assigning a label")},k.ChartEngine.Driver=function(t,e,i){this.tagalongs={},this.stx=t,this.quoteFeed=e,i.maximumTicks||(i.maximumTicks=e.maxTicks?e.maxTicks:2e4),(!i.bufferSize||i.bufferSize<0)&&(i.bufferSize=0),i.bufferSize=Math.round(i.bufferSize),this.behavior=i,this.loadingNewChart=!1,this.intervalTimer=null,this.updatingChart=!1,this.updateChartLoop()},k.ChartEngine.Driver.prototype.die=function(){this.intervalTimer&&(window.clearInterval(this.intervalTimer),this.intervalTimer=-1)},k.ChartEngine.Driver.prototype.updateSubscriptions=function(){this.quoteFeed.checkSubscriptions&&this.quoteFeed.checkSubscriptions(this.stx)},k.ChartEngine.Driver.prototype.attachTagAlongQuoteFeed=function(t){t.label&&(this.tagalongs[t.label]||(this.tagalongs[t.label]={label:t.label,quoteFeed:t.quoteFeed,behavior:t.behavior?t.behavior:{},count:0}),this.tagalongs[t.label].count++)},k.ChartEngine.Driver.prototype.detachTagAlongQuoteFeed=function(t){if(t.label){var e=this.tagalongs[t.label];e.count--,e.count||(this.tagalongs[t.label]=null)}},k.ChartEngine.Driver.prototype.loadDependents=function(p,d,m){var t,g,e,f=p.stx,y=p.chart,i=y.series,v=(f.masterData,this),a=[],r={},n=m==k.QuoteFeed.UPDATE,s=m==k.QuoteFeed.PAGINATION;for(t in i)if(g=i[t],(p.future||n||!1!==g.moreAvailable)&&!g.loading&&(!n&&!s||g.endPoints&&Object.keys(g.endPoints).length)){var o=g.parameters;if(!1!==o.loadData&&(!o.data||o.data.useDefaultQuoteFeed)&&(e=o.symbolObject).symbol){var l=!0;n||(g.loading=!0);for(var h=0;h<a.length;h++)k.symbolEqual(a[h],e)&&(l=!1);l&&(a.push(e),r[e.symbol]=g.endPoints)}}for(var x,c=[],u=0;u<a.length;u++){e=a[u];var C=k.shallowClone(p.originalState);C.symbol=e.symbol,C.symbolObject=e,C.update||C.future?(C.endDate||(C.endDate=p.endDate),C.startDate=r[e.symbol].end):(C.startDate||(C.startDate=p.startDate),C.endDate=s&&!p.future?r[e.symbol].begin:p.endDate,C.ticks=p.ticks),c.push(C)}if(!c.length&&n)return f.createDataSet(null,null,{appending:p.appending||p.originalState.update}),p.nodraw||f.draw(),void(d&&d(null));this.quoteFeed.multiFetch(c,(x=n,function(t){for(var e=null,i=0;i<t.length;i++){var a=t[i],r=a.dataCallback.error;if(!r&&0!==r){for(var n=a.params.symbolObject,s=a.dataCallback,o=s.quotes,l=s.moreAvailable,h=f.getSeries({symbolObject:n}),c=!1,u=0;u<h.length;u++)g=h[u],x||(p.future?f.isHistoricalModeSet&&o.length<2&&(g.mostRecentForwardAttempt=new Date):g.moreAvailable=!1!==l&&(l||o.length>(a.params.endDate?1:0)),g.loading=!1),c=g.parameters.fillGaps||c;o=v.cleanup(f,g,o,m,p,c),f.updateChartData(o,y,{secondarySeries:n.symbol,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),o&&o.length&&(!e||e>o[0].DT)&&(e=o[0].DT)}}t.length&&(f.createDataSet(null,null,{appending:p.originalState.update||p.future,appendToDate:e}),p.nodraw||f.draw()),d&&d(null)}))},k.ChartEngine.Driver.prototype.cleanup=function(t,e,i,a,r,n){if(t.doCleanupDates(i,t.layout.interval),!r.missingBarsCreated&&i.length&&t.cleanupGaps&&!1!==n){var s,o,l=r.chart;if(o=e?(l=e).parameters.symbol||e.id:l.defaultPlotField,a!=k.QuoteFeed.PAGINATION||r.loadMoreReplace){if(a==k.QuoteFeed.UPDATE&&l.endPoints.end&&l.endPoints.end<i[0].DT){var h=t.getFirstLastDataRecord(t.masterData,o,!0);e&&(h=h[o]),i.unshift(h),s="shift"}}else if(l.endPoints.begin&&l.endPoints.begin>i[i.length-1].DT){var c=t.getFirstLastDataRecord(t.masterData,o,!1);e&&(c=c[o]),i.push(c),s="pop"}i=t.doCleanupGaps(i,r.chart,{cleanupGaps:n,noCleanupDates:!0}),s&&i[s]()}return i},k.ChartEngine.Driver.prototype.executeTagAlongs=function(t){var e={count:k.objLength(this.taglongs)},n=this;function i(i,a,r){return function(t){if(r.count--,!t.error){var e=i.fields;e||(e=null),k.addMemberToMasterdata({stx:n.stx,label:a.label,data:t.quotes,fields:e,noCleanupDates:!0})}-1==r.count&&(n.stx.createDataSet(null,null,{appending:i.originalState.update}),n.stx.draw())}}for(var a in this.tagalongs){var r=this.tagalongs[a],s=k.shallowClone(r.behavior);k.extend(s,t,!0),k.ChartEngine.Driver.fetchData(null,r.quoteFeed,s,i(s,r,e))}},k.ChartEngine.Driver.prototype.updateChart=function(){if(!this.updatingChart&&!this.loadingNewChart){var s=k.objLength(this.stx.charts),o=0,l=this.stx,h=l.layout.interval,c=l.layout.timeUnit;for(var t in l.charts){var e=l.charts[t];if(e.symbol){var i=this.makeParams(e.symbol,e.symbolObject,e);e.masterData&&e.masterData.length&&(i.startDate=e.endPoints.end),i.update=!0,i.originalState=k.shallowClone(i),this.updatingChart=!0;var a=r(this,i,e.symbol);l.isEquationChart(i.symbol)?k.fetchEquationChart(i,a):k.ChartEngine.Driver.fetchData(k.QuoteFeed.UPDATE,this.quoteFeed,i,a)}}}function r(a,r,n){return a.behavior.prefetchAction&&a.behavior.prefetchAction("updateChart"),function(t){o++;var e=r.chart;if(e.masterData,n!=e.symbol||h!=l.layout.interval||c!=l.layout.timeUnit||l.isHistoricalMode())a.updatingChart=!1;else{if(t.error)a.quoteFeed.announceError(r.originalState,t);else{var i=t.quotes;i=a.cleanup(l,null,i,k.QuoteFeed.UPDATE,r),l.updateChartData(i,e,{noCreateDataSet:!0,noCleanupDates:!0}),e.attribution=t.attribution}o==s&&(a.updatingChart=!1),a.executeTagAlongs(r),a.behavior.callback&&a.behavior.callback(r),a.loadDependents(r,null,k.QuoteFeed.UPDATE)}}}},k.ChartEngine.Driver.prototype.updateChartLoop=function(t){var e;-1!=this.intervalTimer&&(this.intervalTimer&&window.clearInterval(this.intervalTimer),this.behavior.noUpdate||(t||0===t||(t=this.behavior.refreshInterval),t&&(this.intervalTimer=window.setInterval((e=this,function(){e.behavior.noUpdate||e.updateChart()}),1e3*t))))},k.ChartEngine.Driver.prototype.resetRefreshInterval=function(t){this.behavior.refreshInterval=t,this.updateChartLoop()},k.ChartEngine.Driver.prototype.loadAll=function(i,a){var r=this,n=0;!function e(){return function(t){t?a(t):i.moreAvailable?20<++n?a("error, moreAvailable not implemented correctly in QuoteFeed"):(i.loadingMore=!1,r.checkLoadMore(i,!0,!0,e(),!0)):a(null)}}()()},k.ChartEngine.Driver.prototype.checkLoadMore=function(e,t,i,o,l){var a,r=this.stx,n=this;if(r.isHistoricalMode()||(r.isHistoricalModeSet=!1),e.loadingMore||this.loadingNewChart)return e.initialScroll=e.scroll,void(o&&o(null));if(r.currentlyImporting)o&&o(null);else{var s,h=e.dataSet,c=1e3*(this.behavior.forwardPaginationRetryInterval||5),u=!1,p=!1;if(e.dataSet.length)for(var d in e.series){var m=e.series[d];m.loading||(s=!m.mostRecentForwardAttempt||m.mostRecentForwardAttempt.getTime()+c<Date.now(),!1!==m.moreAvailable&&A(m)&&(u=!0),s&&M(m)&&(p=!0))}s=!e.mostRecentForwardAttempt||e.mostRecentForwardAttempt.getTime()+c<Date.now();var g,f,y=(A(e)||t)&&!1!==e.moreAvailable,v=(M(e)||t)&&s,x=y||u,C=r.isHistoricalModeSet&&!x&&(v||p),S=r.layout.interval,b=r.layout.timeUnit,w=!1;if(!this.behavior.noLoadMore&&(C||!r.maxDataSetSize||e.dataSet.length<r.maxDataSetSize)&&(x||C)){var T;if(e.initialScroll=e.scroll,e.loadingMore=!0,(a=this.makeParams(e.symbol,e.symbolObject,e)).future=C,e.masterData&&e.masterData.length?(C?a.startDate=e.endPoints.end:a.endDate=e.endPoints.begin,C&&!a.startDate?(T=r.getFirstLastDataRecord(e.masterData,"DT",!0))&&(a.startDate=T.DT):x&&!a.endDate&&(T=r.getFirstLastDataRecord(e.masterData,"DT"))&&(a.endDate=T.DT)):a.endDate=new Date,a.originalState=k.shallowClone(a),a.nodraw=l,!y&&u||!v&&p)return this.loadingMore=!0,this.loadDependents(a,function(t){e.loadingMore=!1,o&&o(t)},k.QuoteFeed.PAGINATION),void(o&&o(null));r.fetchMaximumBars[r.layout.aggregationType]&&(a.fetchMaximumBars=!0,!r.maxMasterDataSize||this.behavior.maximumTicks<r.maxMasterDataSize?a.ticks=this.behavior.maximumTicks:a.ticks=r.maxMasterDataSize);var D=(f=a,(g=this).behavior.prefetchAction&&g.behavior.prefetchAction("checkLoadMore"),function(t){var e=g.stx,i=f.chart;if(f.symbol==i.symbol&&S==e.layout.interval&&b==e.layout.timeUnit)if(f.loadMore||(f.chart.loadingMore=!1),t.error)g.quoteFeed.announceError(f.originalState,t),f.chart.loadingMore=!1,o&&o(t.error);else{t.quotes||(t.quotes=[]);var a=t.quotes,r=i.masterData;if((a=g.cleanup(e,null,a,k.QuoteFeed.PAGINATION,f)).length&&i.masterData.length)if(f.future){var n=a[0];n.DT&&n.DT==i.masterData[i.masterData.length-1].DT&&r.pop()}else{var s=a[a.length-1];s.DT&&+s.DT==+i.masterData[0].DT&&r.shift()}f.future?e.isHistoricalModeSet&&a.length<2&&(i.mostRecentForwardAttempt=new Date):t.moreAvailable?i.moreAvailable=!0:!1!==t.moreAvailable&&a.length?i.moreAvailable=!0:i.moreAvailable=!1,g.tickMultiplier=a.length?2:2*g.tickMultiplier,i.loadingMore=!1,f.loadMoreReplace?e.setMasterData(a,i,{noCleanupDates:!0}):f.future?e.updateChartData(a,i,{noCreateDataSet:!0,noCleanupDates:!0}):k.addMemberToMasterdata({stx:e,chart:i,data:a,fields:["*"],noCleanupDates:!0}),a.length&&((!i.endPoints.begin||i.endPoints.begin>a[0].DT)&&(i.endPoints.begin=a[0].DT),(!i.endPoints.end||i.endPoints.end<a[a.length-1].DT)&&(i.endPoints.end=a[a.length-1].DT)),e.createDataSet(void 0,void 0,{appending:f.future}),l||e.draw(),g.executeTagAlongs(f),g.behavior.callback&&g.behavior.callback(f),g.loadDependents(f,o,k.QuoteFeed.PAGINATION)}});r.isEquationChart(a.symbol)?k.fetchEquationChart(a,D):(C&&(a.appending=!0),k.ChartEngine.Driver.fetchData(k.QuoteFeed.PAGINATION,this.quoteFeed,a,D)),w=!0}!w&&o&&o(null)}function A(t){return!t.endPoints.begin||h.length-e.scroll<n.behavior.bufferSize||h.length-e.scroll-r.tickFromDate(t.endPoints.begin,e)<n.behavior.bufferSize}function M(t){return!t.endPoints.end||e.scroll-e.maxTicks+1<n.behavior.bufferSize||r.tickFromDate(t.endPoints.end,e,null,!0)-h.length+e.scroll-e.maxTicks+2<n.behavior.bufferSize}},k.ChartEngine.Driver.prototype.barsToFetch=function(t){if(k.isValidNumber(this.tickMultiplier)||(this.tickMultiplier=2),t.isSeries)return t.stx.masterData.length;var e=this.stx.layout.interval,i=t.stx.layout.periodicity;return"month"!=e&&"week"!=e||this.stx.dontRoll||(i*="week"==e?7:30),t.stx.chart.maxTicks*i*this.tickMultiplier},k.ChartEngine.Driver.determineStartDate=function(t,e,i){return this.determineStartOrEndDate(t,e,i,!0)},k.ChartEngine.Driver.determineStartOrEndDate=function(t,e,i,a){var r,n,s=t.interval,o=t.stx.layout.periodicity,l=k.Market.Symbology.isForexSymbol?1.3:4;if(n="millisecond"===s||"second"===s?k.SECOND*o*l:"minute"===s?k.MINUTE*o*l:k.DAY*l,t.fetchMaximumBars){var h=i*n,c=e.begin.getTime();r=a?new Date(c-h):new Date(c+h)}else r=a?t.startDate||e.previous(i):t.future?e.next(i):new Date;return r},k.ChartEngine.Driver.prototype.makeParams=function(t,e,i){var a=this.stx,r=a.layout.interval,n=this.barsToFetch({stx:a});"month"!=r&&"week"!=r||a.dontRoll||(r="day");var s=k.shallowClone(this.behavior),o=!1,l=i.market.getSessionNames();a.extendedHours?a.extendedHours.filter?o=!0:(o=a.layout.extended,l=l.filter(function(t){return t.enabled||a.layout.marketSessions[t.name]})):l=l.filter(function(t){return t.enabled});for(var h=0;h<l.length;h++)l[h]=l[h].name;return k.extend(s,{stx:a,symbol:t,symbolObject:e,chart:i,interval:r,extended:o,period:1,ticks:n,additionalSessions:l},!0),s.symbolObject||(s.symbolObject={symbol:t}),isNaN(s.interval)||(s.period=parseInt(s.interval,10),s.interval=a.layout.timeUnit,s.interval||(s.interval="minute")),s},k.ChartEngine.Driver.prototype.newChart=function(s,o){var l=this.stx,h=s.symbol,c=l.layout.interval,u=l.layout.timeUnit,t=s.chart;t.moreAvailable=null,t.loadingMore=!1,t.attribution=null;var e=this.makeParams(h,s.symbolObject,t);k.extend(e,s,!0),(l.fetchMaximumBars[l.layout.aggregationType]||s.fetchMaximumBars)&&(!l.maxMasterDataSize||this.behavior.maximumTicks<l.maxMasterDataSize?e.ticks=this.behavior.maximumTicks:e.ticks=l.maxMasterDataSize,e.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,e.originalState=k.shallowClone(e);var p,d,i=(d=e,(p=this).behavior.prefetchAction&&p.behavior.prefetchAction("newChart"),function(t){var e=d.chart,i=t.quotes,a=!1;if(p.loadingNewChart=!1,h==e.symbol&&c==l.layout.interval&&u==l.layout.timeUnit){for(var r in t.error?p.quoteFeed.announceError(d.originalState,t):(i=p.cleanup(l,null,i,k.QuoteFeed.INITIAL,d),l.setMasterData(i,e,{noCleanupDates:!0}),e.endPoints={},i.length&&(e.endPoints.begin=i[0].DT,e.endPoints.end=i[i.length-1].DT),e.moreAvailable=!!i&&!1!==t.moreAvailable,e.attribution=t.attribution,s.initializeChart&&l.initializeChart(),l.createDataSet(),a=!0),e.series)e.series[r].endPoints={},e.series[r].moreAvailable=null;var n=e.masterData;n&&n.length&&(d.startDate=n[0].DT,d.endDate=n[n.length-1].DT),p.executeTagAlongs(d),p.behavior.callback&&p.behavior.callback(d),p.loadDependents(d,function(){a&&!d.nodraw&&p.stx.home(),o&&o(t.error),p.stx.dispatch("newChart",{stx:p.stx,symbol:p.stx.chart.symbol,symbolObject:p.stx.chart.symbolObject,moreAvailable:p.stx.chart.moreAvailable,quoteDriver:p}),p.resetRefreshInterval(p.behavior.refreshInterval)},k.QuoteFeed.INITIAL)}else o&&o("orphaned")});this.stx.isEquationChart(e.symbol)?k.fetchEquationChart(e,i):k.ChartEngine.Driver.fetchData(k.QuoteFeed.INITIAL,this.quoteFeed,e,i)},k.QuoteFeed.INITIAL=1,k.QuoteFeed.UPDATE=2,k.QuoteFeed.PAGINATION=3,k.QuoteFeed.SERIES=4,k.ChartEngine.Driver.fetchData=function(t,e,i,a){e.v2QuoteFeed?"function"!=typeof e.subscribe?k.ChartEngine.Driver.fetchDataInContext(t,e,i,a):k.ChartEngine.Driver.fetchDataInContext(t,e,i,function(t){t.error||e.checkSubscriptions(i.stx),a(t)}):(i.stx.convertToDataZone(i.startDate),i.stx.convertToDataZone(i.endDate),e.fetch(i,a))},k.ChartEngine.Driver.fetchDataInContext=function(t,e,i,a){var r,n,s,o,l=i.stx;t===k.QuoteFeed.SERIES&&(i.series=!0,t=k.QuoteFeed.INITIAL,i.endDate&&!i.startDate||i.future?t=k.QuoteFeed.PAGINATION:i.startDate&&!i.endDate&&(t=k.QuoteFeed.UPDATE));var h=Math.min(i.ticks,l.quoteDriver.behavior.maximumTicks);switch(e.maxTicks&&(h=Math.min(h,e.maxTicks)),t){case k.QuoteFeed.UPDATE:if(l.isHistoricalModeSet)return void(l.quoteDriver.updatingChart=!1);var c;i.startDate?c=i.startDate:(c=new Date).setHours(0,0,0,0),"function"==typeof e.fetchUpdateData&&e.fetchUpdateData(i.symbol,l.convertToDataZone(c),i,a);break;case k.QuoteFeed.INITIAL:r={begin:o=i.endDate||new Date,interval:"tick"==i.interval?1:i.interval,periodicity:"tick"==i.interval?l.chart.xAxis.futureTicksInterval:i.period,outZone:l.dataZone},n=l.chart.market.newIterator(r),s=k.ChartEngine.Driver.determineStartDate(i,n,h),i.endDate&&(o=i.endDate),"function"==typeof e.fetchInitialData&&e.fetchInitialData(i.symbol,s,l.convertToDataZone(o),i,a);break;case k.QuoteFeed.PAGINATION:r={begin:i.endDate||i.startDate,interval:"tick"==i.interval?1:i.interval,periodicity:"tick"==i.interval?l.chart.xAxis.futureTicksInterval:i.period,outZone:l.dataZone},n=l.chart.market.newIterator(r);var u=k.ChartEngine.Driver.determineStartOrEndDate(i,n,h,!i.future);if(s=i.startDate||u,o=i.endDate||u,i.startDate?i.stx.convertToDataZone(s):i.stx.convertToDataZone(o),"function"==typeof e.fetchPaginationData){if(l.maxMasterDataSize&&l.maxMasterDataSize<=l.masterData.length)return;e.fetchPaginationData(i.symbol,s,o,i,a)}break;default:console.error("Illegal fetchData constant")}},(H=t.CIQ).Studies=function(){},H.Studies.DEFAULT_INPUTS={Period:14},H.Studies.DEFAULT_OUTPUTS={Result:"auto"},H.Studies.actualOutputs=[],H.Studies.studyPanelMap={},H.Studies.colorPickerDiv=null,H.Studies.StudyDescriptor=function(t,e,i,a,r,n){this.name=t,this.type=e,this.panel=i,this.inputs=a,this.outputs=r,this.parameters=n,this.outputMap={},this.min=null,this.max=null,this.startFrom=0,this.subField="Close";var s=H.Studies.studyLibrary[e];s||(s={},("chart"==i||!i&&n&&"chart"==n.chartName)&&(this.overlay=!0)),void 0===s.inputs&&(s.inputs=H.clone(H.Studies.DEFAULT_INPUTS)),void 0===s.outputs&&(s.outputs=H.clone(H.Studies.DEFAULT_OUTPUTS)),this.study=s,this.libraryEntry=s},H.Studies.generateID=function(t,e,i,a,r){var n=H.Studies.studyLibrary[e],s=""+(r||e)+"";if(n&&n.customRemoval)return s;if(!H.isEmpty(i)){s+=" (";var o=!1;for(var l in i)if("id"!=l&&"display"!=l&&"Shading"!=l){var h=i[l];"field"!=h&&(h=h.toString(),void 0!==H.Studies.prettify[h]&&(h=H.Studies.prettify[h]),o?h&&(s+=","):o=!0,s+=h)}s+=")"}if(a&&0===a.indexOf(s))return a;if(t.layout.studies&&t.layout.studies[s])for(var c=2;c<50;c++){var u=s+"-"+c;if(!t.layout.studies[u]){s=u;break}}return s},H.Studies.DialogHelper=function(t){var e=this.stx=t.stx,i=this.sd=t.sd;this.name=i?i.type:t.name,this.inputs=[],this.outputs=[],this.parameters=[];var a=this.libraryEntry=i?i.study:H.Studies.studyLibrary[t.name];void 0===a.inputs&&(a.inputs=H.clone(H.Studies.DEFAULT_INPUTS)),void 0===a.outputs&&(a.outputs=H.clone(H.Studies.DEFAULT_OUTPUTS));var r,n=i&&e.panels[i.panel]?e.panels[i.panel]:{chart:e.chart},s=n.chart;function o(t,e){this.attributes[t]||(this.attributes[t]={}),e&&(this.attributes[t].hidden=!0)}for(var l in this.title=e.translateIf(a.name),this.attributes=a.attributes,this.attributes||(this.attributes={}),a.inputs){var h={};this.inputs.push(h),h.name=l,h.heading=e.translateIf(l);var c=a.inputs[l];if(i&&i.inputs&&void 0!==i.inputs[l]&&null!==i.inputs[l]?h.value=i.inputs[l]:h.value=a.inputs[l],h.defaultInput=a.inputs[l],this.attributes[l]||(this.attributes[l]=H.Studies.inputAttributeDefaultGenerator(h.defaultInput)),c.constructor==Number)h.type="number";else if(c.constructor==String){var u=H.Studies.movingAverageHelper(e,h.defaultInput);if(u){h.type="select",h.defaultInput=u;var p=H.Studies.movingAverageHelper(e,h.value);p||(p=h.value),h.value=p,h.options=H.Studies.movingAverageHelper(e,"options")}else if("field"==c){h.type="select",h.options={};t:for(var d in s.dataSet[s.dataSet.length-1]){if(-1==["Open","High","Low","Close","Adj_Close","hl/2","hlc/3","hlcc/4","ohlc/4",s.defaultPlotField].indexOf(d)){if(-1==H.Studies.actualOutputs.indexOf(d))continue;if(t.sd)for(var m in t.sd.outputMap)if(-1!=d.indexOf(m)&&-1==d.indexOf(m+"-"))continue t}h.options[d]=e.translateIf(d)}"field"==h.value&&(h.value="Close"),"field"==h.defaultInput&&(h.defaultInput="Close")}else h.type="text"}else if(c.constructor==Boolean)h.type="checkbox",!0!==h.value&&"true"!=h.value&&"on"!=h.value||(h.value=!0);else if(c.constructor==Array){h.type="select",h.options={};for(var g=0;g<c.length;g++)h.options[c[g]]=e.translateIf(c[g]);h.value.constructor==Array&&(h.value=h.value[0]),h.defaultInput=c[0]}}for(l in a.outputs){var f={name:l,heading:e.translateIf(l)};e.defaultColor||e.getDefaultColor(),f.color=f.defaultOutput=a.outputs[l],i&&i.outputs&&i.outputs[l]&&(f.color=i.outputs[l]),"auto"==f.color&&(f.color=e.defaultColor),this.outputs.push(f)}var y=i?i.parameters:null;if(y){var v=e.getYAxisByName(n,i.name),x={"Panel Name":{panelName:y.panelName,value:i.overlay||i.underlay?i.panel:"Own panel"},Underlay:{underlay:y.underlayEnabled,value:i.underlay},"Y-Axis":{yaxisDisplay:y.yaxisDisplay,value:v&&v.position||(i.overlay||i.underlay?"shared":n.yAxis.position||n.chart.yAxis.position||"right"),color:v&&v.textStyle?v.textStyle:null}};for(var C in x)for(var S in x[C])if("value"!=S&&"color"!=S){var b=x[C][S];if("panel"==b){for(var w in b=[],e.panels)w!=i.name&&b.push(w);b.push("Own panel")}if(b&&b.constructor==Array){for(var T={},D=0;D<b.length;D++)T[b[D]]=e.translateIf(b[D]);r={name:S,heading:e.translateIf(C),defaultValue:b[0],value:x[C].value,options:T},void 0!==x[C].color?(r.defaultColor=e.defaultColor,r.color=x[C].color,y[S+"Value"]=r.value,y[S+"Color"]=r.color):y[S]=r.value,r.type="select",this.parameters.push(r)}else!b&&!1!==b||b.constructor!=Boolean||(r={name:S,heading:e.translateIf(C),defaultValue:!1,value:x[C].value},y[S+"Enabled"]=r.value,r.type="checkbox",this.parameters.push(r))}o.call(this,"underlayEnabled",a.underlay),o.call(this,"panelName",null===a.seriesFN),o.call(this,"yaxisDisplayValue",null===a.seriesFN||a.yAxis&&a.yAxis.noDraw)}if(a.parameters){var A=a.parameters.init;A&&"studyOverZones"==a.parameters.template&&(r={name:"studyOverZones",heading:e.translateIf("Show Zones"),defaultValue:A.studyOverZonesEnabled,value:A.studyOverZonesEnabled},y&&(y.studyOverZonesEnabled||!1===y.studyOverZonesEnabled)&&(r.value=y.studyOverZonesEnabled),r.type="checkbox",this.parameters.push(r),r={name:"studyOverBought",heading:e.translateIf("OverBought"),defaultValue:A.studyOverBoughtValue,value:A.studyOverBoughtValue,defaultColor:A.studyOverBoughtColor,color:A.studyOverBoughtColor},y&&y.studyOverBoughtValue&&(r.value=y.studyOverBoughtValue),y&&y.studyOverBoughtColor&&(r.color=y.studyOverBoughtColor),"auto"==r.color&&(r.color=e.defaultColor),r.type="text",this.parameters.push(r),r={name:"studyOverSold",heading:e.translateIf("OverSold"),defaultValue:A.studyOverSoldValue,value:A.studyOverSoldValue,defaultColor:A.studyOverSoldColor,color:A.studyOverSoldColor},y&&y.studyOverSoldValue&&(r.value=y.studyOverSoldValue),y&&y.studyOverSoldColor&&(r.color=y.studyOverSoldColor),"auto"==r.color&&(r.color=e.defaultColor),r.type="text",this.parameters.push(r),this.attributes.studyOverBoughtValue||(this.attributes.studyOverBoughtValue={}),this.attributes.studyOverSoldValue||(this.attributes.studyOverSoldValue={}))}},H.Studies.DialogHelper.prototype.updateStudy=function(t){var e={},i=this.sd,a=this.libraryEntry;a||(a={}),i||(i=a),e.inputs=H.shallowClone(i.inputs),e.outputs=H.clone(i.outputs),e.parameters=H.shallowClone(i.parameters),H.extend(e,t),e.parameters||(e.parameters={}),e.inputs&&e.inputs.id?this.sd=H.Studies.replaceStudy(this.stx,e.inputs.id,this.name,e.inputs,e.outputs,e.parameters,null,i.study):this.sd=H.Studies.addStudy(this.stx,this.name,e.inputs,e.outputs,e.parameters,null,i.study)},H.Studies.prepareStudy=function(t,e,i,a){if(void 0===e.calculateFN&&(e.useRawValues=!0),a&&a.replaceID&&(H.Studies.rejiggerDerivedStudies(t,a.replaceID,i.inputs.id,i.panel),delete a.replaceID),H.isEmpty(i.outputMap))for(var r in i.outputs)e.useRawValues?i.outputMap[r]=r:i.outputMap[r+" "+i.name]=r;(i.overlay||i.underlay)&&t.addOverlay(i),e.feed?t.attachTagAlongQuoteFeed(e.feed):t.currentlyImporting||(i.chart.dataSet&&t.createDataSet(),t.draw())},H.Studies.rejiggerDerivedStudies=function(t,e,i){var a=t.layout.studies;for(var r in a){var n=a[r];n.panel==e&&(n.panel=i);var s=n.inputs,o=s.id;if(-1!=s.id.indexOf(e)&&-1==s.id.indexOf(e+"-")){s.id.replace(e,i);for(var l=!1,h=H.Studies.getFieldInputs(n),c=0;c<h.length;c++)if(-1!=s[h[c]].indexOf(e)){for(var u in n.name,s[h[c]]=s[h[c]].replace(e,i),s.id=s.id.replace(e,i),s.display=s.display.replace(e,i),n.name=n.name.replace(e,i),n.outputMap={},n.outputs)n.study.useRawValues?n.outputMap[u]=u:n.outputMap[u+" "+n.name]=u;l=!0}l&&H.Studies.replaceStudy(t,o,n.type,n.inputs,n.outputs,n.parameters)}}},H.Studies.removeStudySymbols=function(t,e){if(t.series)for(var i in t.series)e.deleteSeries(t.series[i],null,{action:"remove-study"})},H.Studies.replaceStudy=function(t,e,i,a,r,n,s,o){n||(n={}),e&&(n.replaceID=e),a.id==a.display&&delete a.display,delete a.id;var l=t.layout.studies[n.replaceID];return H.Studies.removeStudySymbols(l,t),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),H.Studies.addStudy(t,i,a,r,n,s,o)},H.Studies.addStudy=function(t,e,i,a,r,n,s){var o=s||H.Studies.studyLibrary[e];if(r||(r={}),o){if(o.inputs){var l=H.shallowClone(o.inputs);for(var h in l)l[h]instanceof Array&&(l[h]=l[h][0]);i=H.extend(l,i)}o.outputs&&(a=H.extend(H.clone(o.outputs),a));var c=o.parameters;c&&c.init&&(r=H.extend(H.shallowClone(c.init),r)),c&&!r.display&&(r.display=c.display)}i||(i=H.clone(H.Studies.DEFAULT_INPUTS)),a||(a=H.clone(H.Studies.DEFAULT_OUTPUTS)),r.chartName||(r.chartName="chart"),i.Period<1&&(i.Period=1),i.id||(i.id=H.Studies.generateID(t,e,i,r.replaceID,r.display));var u=null;if(u=o&&o.initializeFN?o.initializeFN(t,e,i,a,r,n,s):H.Studies.initializeFN(t,e,i,a,r,n,s)){s=u.study,u.chart=t.charts[r.chartName],t.layout.studies||(t.layout.studies={}),(t.layout.studies[u.inputs.id]=u).type=e,u.permanent=s.permanent,u.customLegend=s.customLegend;var p=t.panels[u.panel];H.Studies.prepareStudy(t,s,u,r),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),t.changeOccurred("layout");var d,m,g,f,y,v,x,C,S,b,w,T,D,A,M,k,F,P,_=!1,N=!(u.overlay||u.underlay);if(N&&s.horizontalCrosshairFieldFN&&(p.horizontalCrosshairField=s.horizontalCrosshairFieldFN(t,u)),t.editCallback?_=!0:N?(t.callbacks.studyPanelEdit||t.callbackListeners.studyPanelEdit&&t.callbackListeners.studyPanelEdit.length)&&(_=!0):(t.callbacks.studyOverlayEdit||t.callbackListeners.studyOverlayEdit&&t.callbackListeners.studyOverlayEdit.length)&&(_=!0),_){var E,L=!(r.editMode=!0);for(var O in u.inputs)if("id"!=O&&"display"!=O){L=!0;break}if(!L)for(var I in u.outputs){L=!0;break}L&&(void 0!==u.study.edit?u.study.edit&&(k=u,F=i,P=a,E=function(){H.clearCanvas(M.chart.tempCanvas,M),k.study.edit(k,{stx:M,inputs:F,outputs:P,parameters:r})},(M=t).setPanelEdit(p,E),u.editFunction=E):N?t.editCallback?(v=t,x=u,C=i,S=a,E=function(){var t=v.editCallback(v,x);H.clearCanvas(v.chart.tempCanvas,v),H.Studies.studyDialog(v,e,t,{inputs:C,outputs:S,parameters:r})},"chart"!=p.name&&t.setPanelEdit(p,E)):(d=t,m=u,g=i,f=a,y=r,E=function(){H.clearCanvas(d.chart.tempCanvas,d),d.dispatch("studyPanelEdit",{stx:d,sd:m,inputs:g,outputs:f,parameters:y})},"chart"!=p.name&&(t.setPanelEdit(p,E),u.editFunction=E)):(b=t,T=i,D=a,A=r,E=function(t){H.clearCanvas(b.chart.tempCanvas,b),b.dispatch("studyOverlayEdit",{stx:b,sd:w,inputs:T,outputs:D,parameters:A,forceEdit:t})},(w=u).editFunction=E))}return t.draw(),u}console.log("CIQ.Studies.addStudy: initializeFN() returned null for "+e)},H.Studies.quickAddStudy=H.Studies.addStudy,H.Studies.removeStudy=function(t,e){if(e.overlay||e.underlay)t.removeOverlay(e.name),t.draw();else{var i=t.panels[e.panel];i&&t.panelClose(i)}},H.Studies.displayStudies=function(t,e,i){var a=t.layout.studies;if(a){i&&(H.Studies.actualOutputs=[]);var r={};for(var n in r[e.name]=!0,a){var s=a[n],o=s.study;if(o){if(i){if(!s.underlay)continue}else if(s.underlay)continue;var l=H.clone(o.renderer);!l||l instanceof Array||(l=[l]);var h=t.panels[s.panel];if(h){if(h.chart==e&&!h.hidden){if(!r[h.name]){var c=s.permanent||!t.manageTouchAndMouse;h.closeX?h.closeX.style.display=c?"none":"":h.close&&(h.close.style.display=c?"none":""),h.edit&&(h.edit.style.display=c?"none":""),r[h.name]=c}var u=s.chart.dataSegment;for(var p in s.outputMap)H.Studies.actualOutputs.push(p),H.Studies.studyPanelMap[p]=s;var d=H.Studies.getFieldInputs(s);if(!(s.panel!=s.parameters.chartName||s.parameters&&s.parameters.panelName))for(var m=0;m<d.length;m++)if(s.inputs[d[m]]){var g=H.Studies.studyPanelMap[s.inputs[d[m]]];if(g){s.panel=g.panel;break}}if(void 0===o.seriesFN){if(l){s.overlay||H.Studies.createYAxis(t,s,u,h);for(var f=0;f<l.length;f++){var y=l[f];for(var v in s.outputMap)s.outputMap[v]==y.field&&(y.field=v);if(y.field){y.panel=s.panel;var x=y.binding;if(x)for(var C in x){var S=H.Studies.determineColor(s.outputs[x[C]]);S&&"auto"!=S&&(y[C]=S)}y.yAxis=null;var b=H.Renderer.produce(y.type,y);b.stx=t,b.attachSeries(null,y).draw()}}}else H.Studies.displaySeriesAsLine(t,s,u);h&&H.Studies.displayError(t,s)}else o.seriesFN&&h&&(o.seriesFN(t,s,u),H.Studies.displayError(t,s))}}else delete a[n]}}}},H.Studies.displayError=function(t,e,i){var a=i&&i.panel?i.panel:e.panel,r=t.panels[a].state;r.studyError||!e.error||"undefined"!=typeof practiceMode&&practiceMode||((i=i||{h:"center",v:"bottom"}).text=r.studyError=!0===e.error?t.translateIf("Not enough data to compute ")+t.translateIf(e.study.name):t.translateIf(e.error),t.watermark(a,i))},H.Studies.calculateMinMaxForDataPoint=function(t,e,i){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,n=0;n<i.length;n++){var s=i[n][e];null!=s&&(isNaN(s)||(a=Math.min(s,a),r=Math.max(s,r)))}return{min:a,max:r}},H.Studies.determineMinMax=function(t,e,i){},H.Studies.getYAxisParameters=function(t,e){var i={},a=t.layout.studies&&t.layout.studies[e.name];if(a){var r=a.study;r.yaxis||r.yAxisFN?i.noDraw=!0:(r.parameters&&r.parameters.excludeYAxis&&(i.noDraw=!0),i.ground=r.yAxis&&r.yAxis.ground,e&&("bypass"!=r.range&&("0 to 100"==r.range?i.range=[0,100]:"-1 to 1"==r.range?i.range=[-1,1]:"0 to max"==r.range?i.range=[0,Math.max(0,e.high)]:(r.centerline||0===r.centerline)&&(i.range=[Math.min(r.centerline,e.low),Math.max(r.centerline,e.high)])),i.range&&(e.low=i.range[0],e.high=i.range[1]),a.min&&(e.min=a.min),a.max&&(e.max=a.max),a.parameters&&a.parameters.studyOverZonesEnabled&&(i.noDraw=!0)))}return i},H.Studies.doPostDrawYAxis=function(t,e){for(var i in t.layout.studies){var a=t.layout.studies[i],r=t.panels[a.panel];if(r&&!r.hidden&&(t.getYAxisByName(a.panel,a.name)||r.yAxis)==e){var n=a.study;if(e.name==a.name&&(n.yaxis&&n.yaxis(t,a),n.yAxisFN&&n.yAxisFN(t,a)),H.Studies.drawZones(t,a),!a.error){var s=n.centerline;(s||0===s||null!==s&&0<e.highValue&&e.lowValue<0)&&H.Studies.drawHorizontal(t,a,null,s||0,e)}}}},H.Studies.createYAxis=function(t,e,i,a){},H.Studies.displaySeriesAsLine=function(t,e,i){if(i.length){var a=t.panels[e.panel];if(a&&!a.hidden)for(var r in e.outputMap)H.Studies.displayIndividualSeriesAsLine(t,e,a,r,i)}},H.Studies.displaySeriesAsHistogram=function(t,e,i){if(i.length){var a=t.panels[e.panel];if(a&&!a.hidden){var r=[];for(var n in e.outputMap){var s=e.outputs[e.outputMap[n]];if(s){var o=.3;"object"==typeof s&&(o=s.opacity,s=s.color);var l={field:n,fill_color_up:s,border_color_up:s,fill_color_down:s,border_color_down:s};e.underlay&&(l.opacity_up=l.opacity_down=o||.3),r.push(l)}}var h=e.inputs,c=t.getYAxisByName(a,e.name),u={name:e.name,type:h.HistogramType?h.HistogramType:"overlaid",panel:e.panel,yAxis:c,heightPercentage:h.HeightPercentage?h.HeightPercentage:c?1:.25,widthFactor:h.WidthFactor?h.WidthFactor:.5,bindToYAxis:"none"!=c.position};t.drawHistogram(u,r)}}},H.Studies.displayIndividualSeriesAsLine=function(t,e,i,a,r){i.height||(i.height=i.bottom-i.top);var n=t.chart.context,s=e.outputs[e.outputMap[a]];if(s){t.chart.context.save(),"string"==typeof s&&(s={color:s,width:1});var o=s.width||1;n.lineWidth=e.highlight?o+2:o;var l=s.color;"auto"==l&&(l=t.defaultColor),n.strokeStyle=l;var h=s.pattern;n.setLineDash(H.borderPatternToArray(n.lineWidth,h));var c=n.lineDashOffset=0,u=e.study,p=t.getYAxisByName(i,e.name)||i.yAxis;c=t.decimalPlacesFromPriceTick(p.priceTick),(e.overlay||e.underlay)&&(c=null),(p.decimalPlaces||0===p.decimalPlaces)&&(c=p.decimalPlaces);var d=null;e.parameters&&(d=e.parameters.label);var m=u.parameters;m||(m={});var g="step"==m.plotType;if(e.series)for(var f in e.series){var y=e.series[f].parameters.type;y&&(g="step"==y)}m.noLabels&&(d=!1),e.noSlopes||!1===e.noSlopes||(e.noSlopes=m.noSlopes),e.extendToEnd||!1===e.extendToEnd||(e.extendToEnd=m.extendToEnd);var v=d||t.preferences.labels&&!1!==d,x=e.gaplines;!1===x&&(x="transparent");var C=e.inputs.Symbol,S=x?t.getGapColorFunction(C,a,s,x):null;t.plotDataSegmentAsLine(a,i,{yAxis:p,skipTransform:t.panels[e.panel].name!=e.chart.name,label:v,labelDecimalPlaces:c,noSlopes:e.noSlopes,step:g,extendToEndOfDataSet:e.extendToEnd,gapDisplayStyle:x},S),u.appendDisplaySeriesAsLine&&u.appendDisplaySeriesAsLine(t,e,r,a,i),t.chart.context.restore()}},H.Studies.drawHorizontal=function(t,e,i,a,r,n){var s=t.panels[e.panel];if(s){n||(n=r.textStyle);var o=t.pixelFromPrice(a,s,r);o>r.top&&o<r.bottom&&t.plotLine(s.left,s.right,o,o,n,"segment",t.chart.context,!1,{opacity:n&&n.opacity?n.opacity:.5})}},H.Studies.displayHistogramWithSeries=function(t,e,i){t.panels[e.panel];var a=.5;e.underlay&&(a=.3),H.Studies.createHistogram(t,e,i,!1,a),H.Studies.displaySeriesAsLine(t,e,i)},H.Studies.drawZones=function(t,e,i){if(e.parameters&&e.parameters.studyOverZonesEnabled){var a=parseFloat(e.parameters.studyOverSoldValue),r=parseFloat(e.parameters.studyOverBoughtValue),n=e.parameters.studyOverSoldColor,s=e.parameters.studyOverBoughtColor,o=e.zoneOutput;o||(o="Result");var l=H.Studies.determineColor(e.outputs[o]);l&&"auto"!=l&&!H.isTransparent(l)||(l=t.defaultColor),n||(n=l),n&&"auto"!=n&&!H.isTransparent(n)||(n=t.defaultColor),s||(s=l),s&&"auto"!=s&&!H.isTransparent(s)||(s=t.defaultColor);var h=t.panels[e.panel],c=t.getYAxisByName(h,e.name)||h.yAxis,u=c.displayBorder;!1===t.axisBorders&&(u=!1),!0===t.axisBorders&&(u=!0),0===c.width&&(u=!1);var p="left"==c.position,d=c.justifyRight,m=Math.round(c.left+(p?c.width:0))+.5,g=u?3:0,f=t.chart.context,y=f.fillStyle;t.chart.context.globalAlpha=.2,t.startClip(h.name,!0),f.beginPath();var v=Math.round(t.pixelFromPrice(r,h,c))+.5;f.strokeStyle=s,f.moveTo(h.left,v),f.lineTo(h.right,v),f.stroke(),f.closePath(),t.chart.context.beginPath();var x=Math.round(t.pixelFromPrice(a,h,c))+.5;f.strokeStyle=n,f.moveTo(h.left,x),f.lineTo(h.right,x),f.stroke(),f.closePath();var C=new H.Plotter;if(C.newSeries("border","stroke",t.canvasStyle("stx_grid_border")),u){var S=p?m-g:m-.5,b=p?m+.5:m+g;C.moveTo("border",S,v),C.lineTo("border",b,v),C.moveTo("border",S,x),C.lineTo("border",b,x)}f.fillStyle=y;var w={skipTransform:t.panels[e.panel].name!=e.chart.name,panelName:e.panel,band:o+" "+e.name,yAxis:c};if(H.preparePeakValleyFill(t,H.extend(w,{threshold:r,direction:1,color:s})),H.preparePeakValleyFill(t,H.extend(w,{threshold:a,direction:-1,color:n})),f.globalAlpha=1,!e.study||!e.study.yaxis){if(u){var T=Math.round(c.bottom)+.5;C.moveTo("border",m,c.top),C.lineTo("border",m,T),C.draw(t.chart.context,"border")}0!==c.width&&(t.canvasFont("stx_yaxis"),t.canvasColor("stx_yaxis"),f.textAlign=d?"right":"left",p?(textX=c.left+3,d&&(textX=c.left+c.width-g-3)):(textX=c.left+g+3,d&&(textX=c.left+c.width)),f.fillStyle=s,f.fillText(r,textX,v),f.fillStyle=n,f.fillText(a,textX,x),f.fillStyle=y)}t.endClip(),f.globalAlpha=1,c.name==e.name&&(c.yAxisPlotter=new H.Plotter)}},H.Studies.createHistogram=function(t,e,i,a,r){var n=t.panels[e.panel],s=t.getYAxisByName(n,e.name),o=s||n.yAxis;t.startClip(n.name);var l=t.layout.candleWidth-2;l<2&&(l=1);var h=t.pixelFromPrice(0,n,s);0<o.min&&(h=t.pixelFromPrice(o.min,n,s)),a&&(h=Math.floor(n.top+n.height/2));var c=t.chart.context,u=e.name+"_hist";e.outputs["Decreasing Bar"]||e.outputs["Negative Bar"]?c.globalAlpha=r||1:t.canvasColor("stx_histogram");for(var p=null,d=null,m=e.outputs,g=0;g<i.length;g++){var f=i[g];if(f){f.candleWidth&&(l=Math.floor(Math.max(1,f.candleWidth-2)));var y=Math.floor(t.pixelFromBar(g,n.chart)-l/2),v=Math.floor(l);if(null===p){var x=t.tickFromPixel(y,n.chart)-1;p=x<0?d:t.pixelFromPrice(t.chart.dataSet[x][u],n,s)-h}else p=d;d=t.pixelFromPrice(f[u],n,s)-h;var C=H.Studies.determineColor(m["Decreasing Bar"]),S=H.Studies.determineColor(m["Increasing Bar"]),b=H.Studies.determineColor(m["Positive Bar"]),w=H.Studies.determineColor(m["Negative Bar"]);C&&p<d?c.fillStyle=C:S&&d<p?c.fillStyle=S:b&&d<0?c.fillStyle=b:w&&0<d&&(c.fillStyle=w),c.fillRect(y,h,v,Math.floor(d))}}c.globalAlpha=1,t.endClip()},H.Studies.volumeChart=function(t,e,i,a){var r,n,s=-1*Number.MAX_VALUE;for(r in i)for(var o=0;o<i[r].length;o++)(n=i[r][o])&&s<n&&(s=n);var l=t.panels[e.panel],h=Math.floor(l.yAxis.bottom)+.5,c=h-(Math.floor(l.yAxis.top)+.5),u=t.layout.candleWidth,p=null;e.parameters&&e.parameters.displayBorder||(a=null);var d=0;a||(d=(u-t.chart.tmpWidth)/2);var m=t.chart.context;for(r in m.lineWidth=1,t.startClip(e.panel),i){a&&(p=a[r]),m.fillStyle=r,p&&(m.strokeStyle=p),m.beginPath();for(var g,f=h+.5,y=Math.floor(t.pixelFromBar(0,l.chart)),v=0;v<i[r].length;v++)if(t.chart.dataSegment[v]&&t.chart.dataSegment[v].candleWidth?(u=t.chart.dataSegment[v].candleWidth,a||(d=u/4)):(u=t.layout.candleWidth,a||(d=(u-t.chart.tmpWidth)/2)),0===v&&(g=y-=u/2),n=i[r][v]){var x,C,S=n*(c/s),b=Math.min(Math.floor(h-c+(c-S))+.5,h);x=Math.floor(g+d),C=Math.floor(g+u-d),x=Math.max(x,y),m.moveTo(x,h),m.lineTo(C,h),m.lineTo(C,b),m.lineTo(x,b),a?(b<f||0===v)&&m.lineTo(x,f):m.lineTo(x,h),f=b,g+=u}else f=h,g+=u;m.fill(),m.strokeStyle=p,a&&2<=t.layout.candleWidth&&m.stroke(),m.closePath()}t.endClip()},H.Studies.prettify={Close:"C",Open:"O",High:"H",Low:"L",simple:"ma",exponential:"ema","time series":"tsma",triangular:"tma",variable:"vma",VIDYA:"vdma",weighted:"wma","welles wilder":"smma",true:"y",false:"n"},H.Studies.prettyRE=/^.*\((.*?)\).*$/,H.Studies.prettyDisplay=function(t){var e=H.Studies.prettyRE.exec(t);if(!e)return t;var i=e[1];if(i){for(var a in H.Studies.prettify)i=i.replace(a,H.Studies.prettify[a]);t=t.replace(e[1],i)}return t},H.Studies.getFieldInputs=function(t){var e=[],i=t.study.inputs;for(var a in i)"field"==i[a]&&e.push(a);return e},H.Studies.initializeFN=function(o,t,e,i,a,r,n){function s(t,e,i){for(var a=null,r=H.Studies.getFieldInputs(l),n=(o.chart.highLowBars||o.highLowBars[o.layout.chartType],0);n<r.length;n++){var s=H.Studies.studyPanelMap[t[r[n]]];if(s){a=s.panel;break}}return a||(a=e.chartName),a}e||(e={id:t}),a||(a={}),e.display||(e.display=e.id);var l=new H.Studies.StudyDescriptor(e.id,t,e.id,e,i,a);e.Period&&(l.days=Math.max(1,parseInt(l.inputs.Period,10))),n?(n.inputs||(n.inputs=l.study.inputs),n.outputs||(n.outputs=l.study.outputs),l.study=n):n=l.study,n.display&&(e.display=n.display),r||(r=e.id);var h=!1,c=!1;"Own panel"==a.panelName?l.underlay=l.overlay=!1:(h=l.overlay||n.overlay||e.Overlay||!!a.panelName,(c=l.underlay||n.underlay||e.Underlay||a.panelName&&a.underlayEnabled)&&(l.underlay=!0),h&&(l.overlay=!0));var u=a.replaceID?o.layout.studies[a.replaceID]:null;if(u&&(o.panelExists(a.replaceID)||h||c))if(h||c)a.replaceID!=l.inputs.id&&(delete o.layout.studies[a.replaceID],delete o.overlays[a.replaceID]),H.deleteRHS(H.Studies.studyPanelMap,u),o.panelExists(a.replaceID)&&o.panelClose(o.panels[a.replaceID]),o.panels[a.panelName]?l.panel=a.panelName:l.panel=s(e,a,o.panels);else{l.panel=r;var p={};for(var d in o.panels)if(d==a.replaceID){var m=o.panels[d];m.name=r,m.yAxis&&(m.yAxis.name=r),m.display=e.display,p[r]=m,a.replaceID!=r&&H.deleteRHS(H.Studies.studyPanelMap,u),o.moveMarkers&&o.moveMarkers(a.replaceID,r)}else p[d]=o.panels[d];o.panels=p,a.replaceID!=l.inputs.id&&delete o.layout.studies[a.replaceID]}else if(o.panelExists(r))l.panel=r,h||c||(o.panels[r].yAxis.name=l.name),l.underlay||l.panel!=o.chart.name||(h=l.overlay=!0);else if(h||c)l.panel=s(e,a,o.panels);else{var g=n.panelHeight?n.panelHeight:null,f=new H.ChartEngine.YAxis(n.yAxis);f.name=l.name,u&&(a.replaceID!=l.inputs.id?H.Studies.removeStudy(o,u):delete o.overlays[a.replaceID]),o.createPanel(e.display,e.id,g,a.chartName,f)}var y=o.panels[l.panel],v=!0;if(u){var x=o.panels[u.panel],C=o.getYAxisByName(x,u.name);x&&C&&(C.name=l.name,(v=x!=y||C.position!=a.yaxisDisplayValue)?o.deleteYAxisIfUnused(x,C):a.yaxisDisplayColor&&"auto"!=a.yaxisDisplayColor?C.textStyle=H.colorToHex(a.yaxisDisplayColor):delete C.textStyle)}if(v){var S=n?H.clone(n.yAxis):null;if(S?H.extend(S,a.yAxis):S=a.yAxis,h||c){if((S||a.yaxisDisplayValue)&&"shared"!=a.yaxisDisplayValue){var b={name:l.name,position:a.yaxisDisplayValue};S&&(b=H.extend(S,b));var w=new H.ChartEngine.YAxis(b);"none"==w.position&&(w.width=0);var T=o.addYAxis(y,w);"none"==w.position&&(T.width=0),T.displayGridLines=!1,a.yaxisDisplayColor&&"auto"!=a.yaxisDisplayColor&&(T.textStyle=H.colorToHex(a.yaxisDisplayColor))}}else{if(S)(S=H.extend(y.yAxis,S)).ground&&(S.initialMarginBottom=0),(S.ground||S.initialMarginTop||0===S.initialMarginTop||S.initialMarginBottom||0===S.initialMarginBottom)&&o.calculateYAxisMargins(S);else{var D=n?n.parameters:null;D&&(D.zoom||0===D.zoom)?y.yAxis.zoom=D.zoom:y.yAxis.zoom||(y.yAxis.zoom=10)}a.yaxisDisplayValue&&"shared"!=a.yaxisDisplayValue?(y.yAxis.position=a.yaxisDisplayValue,y.yAxis.width="none"==a.yaxisDisplayValue?0:H.ChartEngine.YAxis.prototype.width,y.yAxis.justifyRight=null,a.yaxisDisplayColor&&"auto"!=a.yaxisDisplayColor?y.yAxis.textStyle=H.colorToHex(a.yaxisDisplayColor):delete y.yAxis.textStyle,o.calculateYAxisPositions()):S&&S.position&&o.calculateYAxisPositions()}}return!n.yAxis&&o.panels[e.id]&&(o.panels[e.id].yAxis.displayGridLines=o.displayGridLinesInStudies),l},H.Studies.overZones=H.Studies.drawZones,H.Studies.displayPSAR2=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name),n=a.name==a.chart.name&&!r;t.startClip(a.name);var s=t.chart.context,o="squarewave"==e.inputs["Plot Type"];for(var l in e.outputs){var h=l+" "+e.name;s.beginPath();for(var c=t.layout.candleWidth,u=Math.max(3,Math.floor(t.chart.tmpWidth/2)),p=0;p<i.length;p++){var d=i[p];if(d&&(d[h]||0===d[h])){d.candleWidth&&(c=d.candleWidth),n&&d.transform&&(d=d.transform);var m=t.pixelFromBar(p,a.chart);o&&(m-=c/2);var g=t.pixelFromTransformedValue(d[h],a,r);if(0!==p&&i[p-1]&&(i[p-1][h]||0===i[p-1][h])||s.moveTo(m,g),o){if(s.lineTo(m,g),s.lineTo(m+c,g),i[p+1]){var f=i[p+1];n&&f.transform&&(f=f.transform),f[h]||0===f[h]||s.lineTo(m+c,t.pixelFromTransformedValue(f[e.referenceOutput+" "+e.name],t.panels[e.panel],r))}}else s.moveTo(m-u/2,g),s.lineTo(m+u/2,g)}}s.lineWidth=1,e.highlight&&(s.lineWidth=3);var y=H.Studies.determineColor(e.outputs[l]);"auto"==y&&(y=t.defaultColor),s.strokeStyle=y,s.stroke(),s.closePath(),s.lineWidth=1}t.endClip()},H.Studies.initializeStochastics=function(t,e,i,a){return i.display=t.translateIf("Stoch")+" ("+i.Period+")",H.Studies.initializeFN.apply(null,arguments)},H.Studies.calculateVolume=function(t,e){var i=e.outputs,a=H.Studies.determineColor(i["Up Volume"]),r=H.Studies.determineColor(i["Down Volume"]);if("vol undr"!=e.type)t.setStyle("stx_volume_up","color",a),t.setStyle("stx_volume_down","color",r);else{if(!t||!t.chart.dataSet)return;var n=t.layout,s=e.parameters.removeStudy,o=n.volumeUnderlay;n.volumeUnderlay=!s,o!=n.volumeUnderlay&&t.changeOccurred("layout"),s?H.Studies.removeStudy(t,e):(t.setStyle("stx_volume_underlay_up","color",a),t.setStyle("stx_volume_underlay_down","color",r))}},H.Studies.MA=function(t,e,i,a,r,n,s,o){var l=new H.Studies.StudyDescriptor(r+" "+s.name,"ma",s.panel);l.chart=s.chart,l.days=parseInt(e,10),l.startFrom=s.startFrom,o&&(l.subField=o),l.inputs={},t&&(l.inputs.Type=t),i&&(l.inputs.Field=i),a&&(l.inputs.Offset=parseInt(a,10)),H.Studies.calculateMovingAverage(n,l)},H.Studies.movingAverage={conversions:{ma:"simple",sma:"simple",ema:"exponential",tsma:"time series",tma:"triangular",vma:"variable",vdma:"vidya",wma:"weighted",smma:"welles wilder"},translations:{simple:"Simple",exponential:"Exponential","time series":"Time Series",triangular:"Triangular",variable:"Variable",vidya:"VIDYA",weighted:"Weighted","welles wilder":"Welles Wilder"},typeMap:{ema:"Exponential",exponential:"Exponential",tsma:"TimeSeries","time series":"TimeSeries",tma:"Triangular",triangular:"Triangular",vma:"Variable",variable:"Variable",vdma:"VIDYA",vidya:"VIDYA",wma:"Weighted",weighted:"Weighted",smma:"Exponential","welles wilder":"Exponential"}},H.Studies.movingAverageHelper=function(t,e){if("options"!=e)return H.Studies.movingAverage.conversions[e];var i={};for(var a in H.Studies.movingAverage.translations)i[a]=t.translateIf(H.Studies.movingAverage.translations[a]);return i},H.Studies.volUnderlay=function(t,e,i){H.Studies.createVolumeChart(t,e,i)},H.Studies.createVolumeChart=function(t,e,i){var a=e.panel,r=e.inputs,n=e.underlay,s=e.overlay,o=n||s,l=n?"stx_volume_underlay":"stx_volume",h=[{field:"Volume",fill_color_up:t.canvasStyle(l+"_up").color,border_color_up:t.canvasStyle(l+"_up").borderLeftColor,opacity_up:t.canvasStyle(l+"_up").opacity,fill_color_down:t.canvasStyle(l+"_down").color,border_color_down:t.canvasStyle(l+"_down").borderLeftColor,opacity_down:t.canvasStyle(l+"_down").opacity}],c=h[0];n||"rgb(184, 44, 12)"!==c.border_color_down||(c.border_color_down="#000000",c.border_color_up="#000000");var u=t.getYAxisByName(a,e.name),p={name:"Volume",panel:a,yAxis:u,heightPercentage:r.HeightPercentage?r.HeightPercentage:o?.25:null,widthFactor:1,bindToYAxis:!u||"none"!=u.position};H.extend(p,e.study.parameters),H.extend(p,e.parameters),t.colorByCandleDirection&&(c.color_function=function(t){var e=t.Open,i=t.Close;return{fill_color:i<e?c.fill_color_down:c.fill_color_up,border_color:i<e?c.border_color_down:c.border_color_up,opacity:i<e?c.opacity_down:c.opacity_up}}),e.outputMap.Volume=null,t.drawHistogram(p,h)},H.Studies.calculateRSI=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{for(var a=e.startFrom;a<i.length;a++)if(a){var r=i[a],n=i[a-1],s=r.Close-n.Close,o=Math.min(a,e.days),l=n["_avgG "+e.name];l||(l=0),l-=l/o;var h=n["_avgL "+e.name];h||(h=0),h-=h/o,0<s?l+=s/o:h-=s/o,a>=e.days&&(r["RSI "+e.name]=(c=l,0===(u=h)?100:100-100/(1+c/u))),r["_avgG "+e.name]=l,r["_avgL "+e.name]=h}var c,u;e.zoneOutput="RSI"}},H.Studies.calculateMACD=function(t,e){var i=e.chart.scrubbed,a=e.inputs,r=e.name;if(e.macd1Days||(e.macd1Days=parseFloat(a["Fast MA Period"])),e.macd2Days||(e.macd2Days=parseFloat(a["Slow MA Period"])),e.signalDays||(e.signalDays=parseFloat(a["Signal Period"])),e.days||(e.days=Math.max(e.macd1Days,e.macd2Days,e.signalDays)),i.length<e.days+1)e.error=!0;else{var n=e.inputs.Field;n&&"field"!=n||(n="Close");var s=a["Moving Average Type"];s||(s="exponential"),H.Studies.MA(s,e.macd1Days,n,0,"_MACD1",t,e),H.Studies.MA(s,e.macd2Days,n,0,"_MACD2",t,e);var o,l,h=Math.max(e.startFrom,e.days-1);for(o=h;o<i.length;o++)(l=i[o])["MACD "+r]=l["_MACD1 "+r]-l["_MACD2 "+r];var c=a["Signal MA Type"];c||(c="exponential"),H.Studies.MA(c,e.signalDays,"MACD "+r,0,"Signal",t,e);var u=r+"_hist";for(o=h;o<i.length;o++){var p=(l=i[o])["Signal "+r];(p||0===p)&&(l[u]=l["MACD "+r]-l["Signal "+r])}}},H.Studies.calculateStandardDeviation=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Moving Average Type"];r||(r=e.inputs.Type),H.Studies.MA(r,e.days,a,e.inputs.Offset,"_MA",t,e);var n=0,s=0,o=0,l=Number(e.inputs["Standard Deviations"]);l<0&&(l=2);var h,c,u,p=e.name;for(var d in e.outputs)p=d+" "+p;for(h=e.startFrom-1,u=0;0<=h&&u<e.days;h--,u++)(c=i[h][a])&&"object"==typeof c&&(c=c[e.subField]),isNaN(c)&&(c=0),n+=Math.pow(c,2),s+=c;for(h=e.startFrom;h<i.length;h++){var m=i[h];if((c=m[a])&&"object"==typeof c&&(c=c[e.subField]),isNaN(c)&&(c=0),n+=Math.pow(c,2),s+=c,!(h<e.days-1)){if(h>=e.days){var g=i[h-e.days][a];g&&"object"==typeof g&&(g=g[e.subField]),isNaN(g)&&(g=0),n-=Math.pow(g,2),s-=g}o=m["_MA "+e.name],m[p]=Math.sqrt((n+e.days*Math.pow(o,2)-2*o*s)/e.days)*l}}}},H.Studies.calculateMovingAverage=function(t,e){if(e.chart.scrubbed){var i=e.inputs.Type;"ma"!=i&&"sma"!=i&&i||(i="simple");var a=H.Studies.movingAverage.typeMap;if(i in a)return H.Studies["calculateMovingAverage"+a[i]](t,e);if("simple"===i){var r=e.chart.scrubbed,n=0,s=[],o=e.name;for(var l in e.outputs)o=l+" "+o;var h=e.inputs.Field;h&&"field"!=h||(h="Close");var c=parseInt(e.inputs.Offset,10);isNaN(c)&&(c=0);var u,p,d=e.startFrom,m=c;for(u=e.startFrom-1;0<=u;u--)if((p=r[u][h])&&"object"==typeof p&&(p=p[e.subField]),p||0===p)if(0<m)m--,d=u;else{if(s.length==e.days-1)break;n+=p,s.unshift(p)}for(s.length<e.days-1&&(s=[],d=0),u=d;u<r.length;u++){(p=r[u][h])&&"object"==typeof p&&(p=p[e.subField]);var g=0<=u+c&&u+c<r.length?r[u+c]:null;p||0===p?(n+=p,s.push(p),s.length>e.days&&(n-=s.shift()),g&&(g[o]=s.length==e.days?n/e.days:null)):g&&(g[o]=null)}}}},H.Studies.calculateMovingAverageExponential=function(t,e){var i=e.inputs.Type,a=e.chart.scrubbed,r=0,n=0,s=0,o=2/(e.days+1);"welles wilder"!==i&&"smma"!==i||(o=1/e.days);var l=null,h=e.name;for(var c in e.outputs)h=c+" "+h;var u=e.inputs.Field;u&&"field"!=u||(u="Close");var p,d,m=parseInt(e.inputs.Offset,10);isNaN(m)&&(m=0);var g=e.startFrom,f=m;for(p=e.startFrom-1;0<=p;p--)if((d=a[p][h])||0===d){if(null===l&&(l=d),s=e.days,f<=0)break;f--,g=p}for(null===l&&(l=g=0),p=g;p<a.length;p++){(d=a[p][u])&&"object"==typeof d&&(d=d[e.subField]);var y=0<=p+m&&p+m<a.length?a[p+m]:null;d||0===d?(s==e.days-1?(n=(r+=d)/e.days,y&&(y[h]=n)):s<e.days-1?(n=(r+=d)/(s+1),y&&(y[h]=null)):0===s?(n=r+=d,y&&(y[h]=null)):(l||0===l)&&(n=(d-l)*o+l,y&&(y[h]=n)),l=n,s++):y&&(y[h]=null)}},H.Studies.calculateMovingAverageVariable=function(t,e){e.inputs.Type;var i=e.chart.scrubbed,a=2/(e.days+1),r=null,n=e.name;for(var s in e.outputs)n=s+" "+n;var o=e.inputs.Field;o&&"field"!=o||(o="Close"),e.cmo=new H.Studies.StudyDescriptor(e.name,"cmo",e.panel),e.cmo.chart=e.chart,e.cmo.days=9,e.cmo.inputs={Field:o},e.cmo.startFrom=e.startFrom,e.cmo.outputs={_CMO:null},H.Studies.calculateChandeMomentum(t,e.cmo);var l,h,c=parseInt(e.inputs.Offset,10);isNaN(c)&&(c=0);var u=e.startFrom,p=c;for(l=e.startFrom-1;0<=l;l--)if((h=i[l][n])||0===h){if(null===r&&(r=h),p<=0)break;p--,u=l}for(null===r&&(r=u=0),l=u;l<i.length;l++){var d=i[l];(h=d[o])&&"object"==typeof h&&(h=h[e.subField]);var m=0<=l+c&&l+c<i.length?i[l+c]:null;if(h||0===h){if(d["_CMO "+e.name]||0===d["_CMO "+e.name]){var g=Math.abs(d["_CMO "+e.name])/100,f=a*g*h+(1-a*g)*r;r=f,l<e.days&&(f=null),m&&(m[n]=f)}}else m&&(m[n]=null)}},H.Studies.calculateMovingAverageVIDYA=function(t,e){e.inputs.Type;var i=e.chart.scrubbed,a=2/(e.days+1),r=null,n=e.name;for(var s in e.outputs)n=s+" "+n;var o=e.inputs.Field;o&&"field"!=o||(o="Close"),e.std=new H.Studies.StudyDescriptor(e.name,"sdev",e.panel),e.std.chart=e.chart,e.std.days=5,e.std.startFrom=e.startFrom,e.std.inputs={Field:o,"Standard Deviations":1,Type:"ma"},e.std.outputs={_STD:null},H.Studies.calculateStandardDeviation(t,e.std),H.Studies.MA("ma",20,"_STD "+e.name,0,"_MASTD",t,e);var l,h,c=parseInt(e.inputs.Offset,10);isNaN(c)&&(c=0);var u=e.startFrom,p=c;for(l=e.startFrom-1;0<=l;l--)if((h=i[l][n])||0===h){if(null===r&&(r=h),p<=0)break;p--,u=l}for(null===r&&(r=u=0),l=u;l<i.length;l++){var d=i[l];(h=d[o])&&"object"==typeof h&&(h=h[e.subField]);var m=0<=l+c&&l+c<i.length?i[l+c]:null;if(h||0===h){if(d["_MASTD "+e.name]||0===d["_MASTD "+e.name]){var g=d["_STD "+e.name]/d["_MASTD "+e.name],f=a*g*h+(1-a*g)*r;r=f,l<e.days&&(f=null),m&&(m[n]=f)}}else m&&(m[n]=null)}},H.Studies.calculateMovingAverageTimeSeries=function(t,e){e.ma=new H.Studies.StudyDescriptor(e.name,"ma",e.panel),e.ma.chart=e.chart,e.ma.days=e.days,e.ma.startFrom=e.startFrom,e.ma.inputs=e.inputs,H.Studies.calculateLinearRegressionIndicator(t,e.ma);var i=e.name;for(var a in e.outputs)i=a+" "+i;var r=parseInt(e.inputs.Offset,10);isNaN(r)&&(r=0);for(var n=e.chart.scrubbed,s=r,o=e.startFrom-1;0<=o;o--){var l=n[o][i];if(l||0===l){if(!(0<s))break;s--}}for(o++;o<n.length;o++){var h=n[o];0<=o+r&&o+r<n.length&&(n[o+r][i]=h["Forecast "+e.name])}},H.Studies.calculateMovingAverageTriangular=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=Math.ceil(e.days/2);H.Studies.MA("simple",r,a,0,"TRI1",t,e),e.days%2==0&&r++,H.Studies.MA("simple",r,"TRI1 "+e.name,0,"TRI2",t,e);var n=e.name;for(var s in e.outputs)n=s+" "+n;var o=parseInt(e.inputs.Offset,10);isNaN(o)&&(o=0);for(var l=o,h=e.startFrom-1;0<=h;h--){var c=i[h][n];if(c||0===c){if(!(0<l))break;l--}}for(h++;h<i.length;h++)0<=h+o&&h+o<i.length&&(i[h+o][n]=i[h]["TRI2 "+e.name])},H.Studies.calculateMovingAverageWeighted=function(t,e){var i=e.chart.scrubbed,a=0,r=0,n=e.inputs.Field;n&&"field"!=n||(n="Close");var s=e.days*(e.days+1)/2,o=e.name;for(var l in e.outputs)o=l+" "+o;var h,c,u=parseInt(e.inputs.Offset,10);isNaN(u)&&(u=0);var p=[],d=e.startFrom,m=u;for(h=e.startFrom-1;0<=h;h--)if((c=i[h][n])&&"object"==typeof c&&(c=c[e.subField]),c||0===c)if(0<m)m--,d=h;else{if(p.length==e.days-1)break;p.unshift(c)}for(p.length<e.days-1&&(p=[],d=0),h=0;h<p.length;h++)a+=(h+1)*p[h],r+=p[h];for(h=d;h<i.length;h++){(c=i[h][n])&&"object"==typeof c&&(c=c[e.subField]);var g=0<=h+u&&h+u<i.length?i[h+u]:null;c||0===c?(p.push(c),p.length>e.days&&(a-=r,r-=p.shift()),a+=p.length*c,r+=c,h<e.days-1?g&&(g[o]=null):g&&(g[o]=a/s)):g&&(g[o]=null)}},H.Studies.calculateKlinger=function(t,e){var i=e.chart.scrubbed,a=Number(e.inputs["Short Cycle"]),r=Number(e.inputs["Long Cycle"]);if(i.length<Math.max(a,r)+1)e.error=!0;else{var n,s=e.name+"_hist",o="Klinger "+e.name,l="KlingerSignal "+e.name,h="_SV "+e.name,c="_EMA-S "+e.name,u="_EMA-L "+e.name;for(n=Math.max(1,e.startFrom);n<i.length;n++){var p=i[n].Volume;i[n]["hlc/3"]<i[n-1]["hlc/3"]&&(p*=-1),i[n][h]=p}for(H.Studies.MA("exponential",a,h,0,"_EMA-S",t,e),H.Studies.MA("exponential",r,h,0,"_EMA-L",t,e),n=Math.max(r,e.startFrom);n<i.length;n++)i[n][o]=i[n][c]-i[n][u];for(H.Studies.MA("exponential",Number(e.inputs["Signal Periods"]),o,0,"KlingerSignal",t,e),n=e.startFrom;n<i.length;n++)i[n][s]=i[n][o]-i[n][l]}},H.Studies.calculateStochastics=function(t,e){e.smooth||(e.smooth=e.inputs.Smooth);var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.inputs["%K Periods"];a||(a=e.days);var o=e.chart.scrubbed;if(o.length<Math.max(a,e.days)+1)e.error=!0;else{var r=e.inputs["%K Smoothing Periods"];r?e.smooth=!0:e.smooth&&(r=3);var n=e.inputs["%D Periods"];n||(n=3),e.outputMap={},e.outputMap["%K "+e.name]="Fast",e.outputMap["%D "+e.name]="Slow";for(var s=Math.max(a,e.startFrom);s<o.length;s++)o[s][e.name]=l(s,i,a);H.Studies.MA("simple",e.smooth?r:1,e.name,0,"%K",t,e),H.Studies.MA("simple",n,"%K "+e.name,0,"%D",t,e)}function l(t,e,i){for(var a=t-i+1,r=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,s=a;s<=t;s++)n=Math.min(n,o[s].Low),r=Math.max(r,o[s].High);return r==n?0:(o[t][e]-n)/(r-n)*100}},H.Studies.calculateStudyATR=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else for(var r=0,n=e.name,s=Math.max(e.startFrom,1);s<i.length;s++){var o=i[s],l=i[s-1],h=o.trueRange;l["Sum True Range "+n]&&(r=l["Sum True Range "+n]),r+=h,a<s&&(r-=i[s-a]["True Range "+n]),o["True Range "+n]=h,o["Sum True Range "+n]=r,s==a?o["ATR "+n]=r/a:a<s&&(o["ATR "+n]=(l["ATR "+n]*(a-1)+h)/a)}},H.Studies.calculatePSAR=function(t,e){var i=e.chart.scrubbed,a=0,r=null,n=!1,s=0,o=parseFloat(e.inputs["Minimum AF"]),l=parseFloat(e.inputs["Maximum AF"]);function h(){a=0,r=null,n=!n}if(0<e.startFrom){s=i[e.startFrom-1]["Result "+e.name];var c=i[e.startFrom-1]["_state "+e.name];c&&3==c.length&&(a=c[0],r=c[1],n=c[2])}for(var u=e.startFrom-1;u<i.length-1;u++)if(!(u<0)){var p=s;if(n){(!r||r<i[u].High)&&(r=i[u].High,a=Math.min(a+o,l)),s=p+a*(r-p);var d=Math.min(i[Math.max(1,u)-1].Low,i[u].Low);s>i[u+1].Low?(s=r,h()):d<s&&(s=d)}else{(!r||r>i[u].Low)&&(r=i[u].Low,a=Math.min(a+o,l)),s=p+a*(r-p);var m=Math.max(i[Math.max(1,u)-1].High,i[u].High);s<i[u+1].High?(s=r,h()):s<m&&(s=m)}i[u+1]["Result "+e.name]=s,i[u+1]["_state "+e.name]=[a,r,n]}},H.Studies.calculateTRIX=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{for(var a=e.name,r=["Close","_MA1 "+a,"_MA2 "+a,"_MA3 "+a],n=0;n<r.length-1;n++)H.Studies.MA("exponential",e.days,r[n],0,"_MA"+(n+1).toString(),t,e);for(var s=r[3],o=Math.max(1,e.startFrom);o<i.length;o++){var l=i[o-1][s];l&&(i[o]["Result "+a]=100*(i[o][s]/l-1))}}},H.Studies.calculateIntradayMomentum=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{var r=0,n=0;1<e.startFrom&&(r=i[e.startFrom-1]["_totUp "+e.name],n=i[e.startFrom-1]["_totDn "+e.name]);for(var s=e.startFrom;s<i.length;s++){var o=i[s].Close-i[s].Open;if(0<o?r+=o:n-=o,a<=s){var l=i[s-a].Close-i[s-a].Open;0<l?r-=l:n+=l}i[s]["Result "+e.name]=100*r/(r+n),i[s]["_totUp "+e.name]=r,i[s]["_totDn "+e.name]=n}}},H.Studies.calculateQStick=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{for(var a=e.startFrom;a<i.length;a++)i[a]["_Close-Open "+e.name]=i[a].Close-i[a].Open;H.Studies.MA(e.inputs["Moving Average Type"],e.days,"_Close-Open "+e.name,0,"Result",t,e)}},H.Studies.calculateSchaff=function(t,o){var l=o.chart.scrubbed,e=o.days,i=Number(o.inputs["Short Cycle"]),a=Number(o.inputs["Long Cycle"]);if(l.length<Math.max(e,i,a)+1)o.error=!0;else{var r=o.inputs.Field;r&&"field"!=r||(r="Close"),H.Studies.MA(o.inputs["Moving Average Type"],i,r,0,"_MACD1",t,o),H.Studies.MA(o.inputs["Moving Average Type"],a,r,0,"_MACD2",t,o);for(var n=0,s=0,h=o.startFrom;h<l.length;h++){var c=l[h];if(c["Result "+o.name]=s,!(h<a-1||(c["_MACD "+o.name]=c["_MACD1 "+o.name]-c["_MACD2 "+o.name],h<a+(e-1)))){var u=p(e,h,"_MACD");n=u[1]>u[0]?100*(c["_MACD "+o.name]-u[0])/(u[1]-u[0]):n,c["_PF "+o.name]=l[h-1]["_PF "+o.name]?l[h-1]["_PF "+o.name]+.5*(n-l[h-1]["_PF "+o.name]):n,h<a+2*(e-1)||(s=(u=p(e,h,"_PF"))[1]>u[0]?100*(c["_PF "+o.name]-u[0])/(u[1]-u[0]):s,c["Result "+o.name]=l[h-1]["Result "+o.name]?l[h-1]["Result "+o.name]+.5*(s-l[h-1]["Result "+o.name]):s)}}}function p(t,e,i){for(var a=null,r=null,n=e-t+1;n<=e;n++){var s=l[n][i+" "+o.name];s&&(a=null===a?s:Math.min(a,s),r=null===r?s:Math.max(r,s))}return[a,r]}},H.Studies.calculateStochMomentum=function(t,e){var i=Number(e.inputs["%K Periods"]),a=Number(e.inputs["%K Smoothing Periods"]),r=Number(e.inputs["%K Double Smoothing Periods"]),n=Number(e.inputs["%D Periods"]),s=e.chart.scrubbed;if(s.length<i+a+r-1||s.length<n)e.error=!0;else{var o;for(o=Math.max(i,e.startFrom)-1;o<s.length;o++){var l=s[o],h=c(i,o);l["_H "+e.name]=l.Close-(h[0]+h[1])/2,l["_DHL "+e.name]=h[1]-h[0]}for(H.Studies.MA("exponential",a,"_H "+e.name,0,"_HS1",t,e),H.Studies.MA("exponential",r,"_HS1 "+e.name,0,"_HS2",t,e),H.Studies.MA("exponential",a,"_DHL "+e.name,0,"_DHL1",t,e),H.Studies.MA("exponential",r,"_DHL1 "+e.name,0,"_DHL2",t,e),o=i-1;o<s.length;o++)s[o]["%K "+e.name]=s[o]["_HS2 "+e.name]/(.5*s[o]["_DHL2 "+e.name])*100;H.Studies.MA(e.inputs["%D Moving Average Type"],n,"%K "+e.name,0,"%D",t,e),e.zoneOutput="%K"}function c(t,e){for(var i=null,a=null,r=e-t+1;r<=e;r++)i=null===i?s[r].Low:Math.min(i,s[r].Low),a=null===a?s[r].High:Math.max(a,s[r].High);return[i,a]}},H.Studies.calculateEhlerFisher=function(t,e){var s=e.chart.scrubbed;if(s.length<e.days+1)e.error=!0;else{var i=0;1<e.startFrom&&(i=s[e.startFrom-1]["_n "+e.name]);for(var a=e.startFrom;a<s.length;a++){var r=s[a];if(a<e.days-1)r["EF "+e.name]=r["EF Trigger "+e.name]=i;else{var n=l(e.days,a);0<(i=.66*(((s[a].High+s[a].Low)/2-n[0])/Math.max(1e-6,n[1]-n[0])-.5)+.67*i)?i=Math.min(i,.9999):i<0&&(i=Math.max(i,-.9999));var o=a?s[a-1]["EF "+e.name]:0;r["EF "+e.name]=.5*Math.log((1+i)/(1-i))+.5*o,r["EF Trigger "+e.name]=o,r["_n "+e.name]=i}}}function l(t,e){for(var i=Number.MAX_VALUE,a=-1*Number.MAX_VALUE,r=e-t+1;r<=e;r++){var n=(s[r].High+s[r].Low)/2;i=Math.min(i,n),a=Math.max(a,n)}return[i,a]}},H.Studies.calculatePrettyGoodOscillator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{H.Studies.MA("exponential",e.days,"trueRange",0,"_EMA",t,e),H.Studies.MA("simple",e.days,"Close",0,"_SMA",t,e);for(var a=Math.max(1,e.startFrom);a<i.length;a++)i[a]["_SMA "+e.name]&&i[a]["_EMA "+e.name]&&(i[a]["Result "+e.name]=(i[a].Close-i[a]["_SMA "+e.name])/i[a]["_EMA "+e.name])}},H.Studies.calculateUltimateOscillator=function(t,e){var i=e.chart.scrubbed,a=[e.inputs["Cycle 1"],e.inputs["Cycle 2"],e.inputs["Cycle 3"]],r=Math.max(a[0],a[1],a[2]);if(i.length<r+1)e.error=!0;else{var n=a[0]*a[1],s=a[0]*a[2],o=a[1]*a[2],l=[0,0,0],h=[0,0,0];e.startFrom&&(i[e.startFrom-1]["_accbp "+e.name]&&(l=i[e.startFrom-1]["_accbp "+e.name].slice()),i[e.startFrom-1]["_acctr "+e.name]&&(h=i[e.startFrom-1]["_acctr "+e.name].slice()));for(var c=Math.max(1,e.startFrom);c<i.length;c++){for(var u=Math.min(i[c].Low,i[c-1].Close),p=i[c].Close-u,d=Math.max(i[c].High,i[c-1].Close)-u,m=0;m<a.length;m++)if(l[m]+=p,h[m]+=d,a[m]<c){var g=Math.min(i[c-a[m]].Low,i[c-a[m]-1].Close),f=i[c-a[m]].Close-g,y=Math.max(i[c-a[m]].High,i[c-a[m]-1].Close)-g;l[m]-=f,h[m]-=y}if(i[c]["_accbp "+e.name]=l.slice(),i[c]["_acctr "+e.name]=h.slice(),!(c<r)){var v=o*l[0]/h[0]+s*l[1]/h[1]+n*l[2]/h[2],x=o+s+n;i[c]["Result "+e.name]=100*v/x}}}},H.Studies.calculatePriceVolumeTrend=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.chart.scrubbed,r=0;1<e.startFrom&&(r=a[e.startFrom-1]["Result "+e.name]);for(var n=Math.max(1,e.startFrom);n<a.length;n++)a[n][i]&&a[n-1][i]&&(r+=a[n].Volume*(a[n][i]-a[n-1][i])/a[n-1][i],a[n]["Result "+e.name]=r)},H.Studies.calculateOnBalanceVolume=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.inputs["Min Tick Value"],r=!1;a||0===a||(r=!0,a=0);for(var n,s,o=e.chart.scrubbed,l=0,h=e.startFrom;h<o.length;h++)if(n=o[h],h&&n[i]&&(o[h-1][i]&&(s=o[h-1]),s)){n[i]-s[i]>a?l=1:s[i]-n[i]>a?l=-1:r&&(l=0);var c=s["Result "+e.name];c||(c=0),c+=n.Volume*l,n["Result "+e.name]=c}},H.Studies.calculateVolumeIndex=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.chart.scrubbed;if(a.length<e.days+1)e.error=!0;else{var r=100;1<e.startFrom&&(r=a[e.startFrom-1]["Index "+e.name]);for(var n=Math.max(1,e.startFrom);n<a.length;n++){var s=a[n][i],o=a[n].Volume;s&&"object"==typeof s&&(o=s.Volume,s=s[e.subField]);var l=a[n-1][i],h=a[n-1].Volume;l&&"object"==typeof l&&(h=l.Volume,l=l[e.subField]),s&&l&&(("Pos Vol"==e.type&&h<o||"Neg Vol"==e.type&&o<h)&&(r*=s/l),a[n]["Index "+e.name]=r)}H.Studies.MA(e.inputs["Moving Average Type"],e.days,"Index "+e.name,0,"MA",t,e)}},H.Studies.calculateHistoricalVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Standard Deviations"];r<0&&(r=1);var n,s=100*Math.sqrt((n=e.inputs["Days Per Year"],isNaN(n)&&(n=365),"day"==t.layout.interval?n:"week"==t.layout.interval?52:"month"==t.layout.interval?12:n))*r,o=[],l=0;1<e.startFrom&&(l=i[e.startFrom-1]["_state "+e.name][0],o=i[e.startFrom-1]["_state "+e.name][1].slice());for(var h=Math.max(1,e.startFrom);h<i.length;h++){var c=i[h-1][a];if(c){var u=Math.log(i[h][a]/c);if(o.push(u),l+=u,h>=e.days){var p=0;l/=e.days;for(var d=0;d<o.length;d++)p+=Math.pow(o[d]-l,2);l*=e.days,l-=o.shift(),i[h]["Result "+e.name]=Math.sqrt(p/e.days)*s}}i[h]["_state "+e.name]=[l,o.slice()]}}},H.Studies.calculateSwingIndex=function(t,e){var i=e.inputs["Limit Move Value"];(null===i||isNaN(i))&&(i=99999);var a=e.chart.scrubbed,r=0;1<e.startFrom&&(r=a[e.startFrom-1]["Result "+e.name]);for(var n=Math.max(1,e.startFrom);n<a.length;n++){var s=Math.abs(a[n].High-a[n-1].Close),o=Math.abs(a[n].Low-a[n-1].Close),l=Math.abs(a[n].High-a[n].Low),h=Math.abs(a[n-1].Close-a[n-1].Open),c=Math.max(s,o),u=Math.max(l,c),p=u+.25*h;u==s?p-=.5*o:u==o&&(p-=.5*s);var d=50*(a[n].Close-a[n-1].Close+.5*(a[n].Close-a[n].Open)+.25*(a[n-1].Close-a[n-1].Open))/p*(c/i);0!==p&&0!==i||(d=0),"Swing"==e.type&&(r=0),r+=d,a[n]["Result "+e.name]=r}},H.Studies.calculateADX=function(t,e){H.Studies.calculateStudyATR(t,e);var i=e.chart.scrubbed,a=e.days,r=parseInt(e.inputs["Smoothing Period"],10);if(r||0===r||(r=a),i.length<e.days+1)e.error=!0;else for(var n,s=0,o=0,l=0,h=0,c=Math.max(1,e.startFrom);c<i.length;c++){n=i[c];var u=Math.max(0,n.High-i[c-1].High),p=Math.max(0,i[c-1].Low-n.Low);if(p<u?p=0:u=u<p?0:p=0,c<=a?(o+=u,l+=p,s+=n["True Range "+e.name]):(o=i[c-1]["_sm+DM "+e.name]*(a-1)/a+u,l=i[c-1]["_sm-DM "+e.name]*(a-1)/a+p,s=i[c-1]["_smTR "+e.name]*(a-1)/a+n["True Range "+e.name]),n["_sm+DM "+e.name]=o,n["_sm-DM "+e.name]=l,n["_smTR "+e.name]=s,!(c<a)){var d=100*o/s,m=100*l/s,g=100*Math.abs(d-m)/(d+m);if(n["+DI "+e.name]=d,n["-DI "+e.name]=m,!1!==e.inputs.Series&&r)if(c<a+r-1){if(c==e.startFrom)for(var f=a;f<e.startFrom;f++)h+=100*Math.abs(i[f]["+DI "+e.name]-i[f]["-DI "+e.name])/(i[f]["+DI "+e.name]+i[f]["-DI "+e.name]);h+=g}else n["ADX "+e.name]=c==a+r-1?h/r:(i[c-1]["ADX "+e.name]*(r-1)+g)/r;if(e.inputs.Histogram){var y=e.name+"_hist";if(!n["+DI "+e.name]&&0!==n["+DI "+e.name])continue;if(!n["-DI "+e.name]&&0!==n["-DI "+e.name])continue;n[y]=n["+DI "+e.name]-n["-DI "+e.name],!1===e.inputs.Series&&(n["+DI "+e.name]=null,n["-DI "+e.name]=null)}}}},H.Studies.calculateRandomWalk=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=Math.max(2,e.startFrom);a<i.length;a++){for(var r=0,n=i[a].High,s=i[a].Low,o=0,l=0,h=1;h<=e.days;h++){if(a<=h){o=l=0;break}var c=(r+=i[a-h].trueRange)/h*Math.sqrt(h);if(c){var u=(n-i[a-h].Low)/c,p=(i[a-h].High-s)/c;o=Math.max(o,u),l=Math.max(l,p)}}i[a]["Random Walk High "+e.name]=o,i[a]["Random Walk Low "+e.name]=l}},H.Studies.calculateRateOfChange=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),e.parameters.isVolume&&(a="Volume");var r=e.name;for(var n in e.outputs)r=n+" "+r;var s=e.inputs["Center Line"];s=s?parseInt(s,10):0;for(var o=Math.max(e.startFrom,e.days);o<i.length;o++){var l=i[o][a];l&&"object"==typeof l&&(l=l[e.subField]);var h=i[o-e.days][a];if(h&&"object"==typeof h&&(h=h[e.subField]),"Momentum"==e.type)i[o][r]=l-h+s;else{var c=h;c&&(i[o][r]=100*(l/c-1)+s)}}}},H.Studies.calculateTypicalPrice=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.overlay||(e.error=!0);else{var r=e.name;for(var n in e.outputs)r=n+" "+r;var s="hlc/3";"Med Price"==e.type?s="hl/2":"Weighted Close"==e.type&&(s="hlcc/4");var o=0;e.startFrom<=a&&(e.startFrom=0);for(var l=e.startFrom;l<i.length;l++)l&&i[l-1][r]&&(o=i[l-1][r]*a),o+=i[l][s],a<=l&&(o-=i[l-a][s],i[l][r]=o/a)}},H.Studies.calculateElderRay=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{H.Studies.MA("exponential",e.days,"Close",0,"_EMA",t,e);for(var a=Math.max(e.startFrom,e.days-1);a<i.length;a++)i[a][e.name+"_hist1"]=i[a].High-i[a]["_EMA "+e.name],i[a][e.name+"_hist2"]=i[a].Low-i[a]["_EMA "+e.name]}},H.Studies.calculateElderForce=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{for(var a=Math.max(1,e.startFrom);a<i.length;a++)i[a]["_EF1 "+e.name]=i[a].Volume*(i[a].Close-i[a-1].Close);H.Studies.MA("exponential",e.days,"_EF1 "+e.name,0,"Result",t,e)}},H.Studies.calculateCenterOfGravity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");for(var r=Math.max(e.startFrom,e.days-1);r<i.length;r++){for(var n=0,s=0,o=0;o<e.days;o++)n-=(o+1)*i[r-o][a],s+=i[r-o][a];s&&(i[r]["Result "+e.name]=n/s)}}},H.Studies.calculateEaseOfMovement=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{for(var a=Math.max(1,e.startFrom);a<i.length;a++){var r=((i[a].High+i[a].Low)/2-(i[a-1].High+i[a-1].Low)/2)/(i[a].Volume/1e8/(i[a].High-i[a].Low));isFinite(r)?i[a]["_EOM1 "+e.name]=r:i[a]["_EOM1 "+e.name]=NaN}H.Studies.MA(e.inputs["Moving Average Type"],e.days,"_EOM1 "+e.name,0,"Result",t,e)}},H.Studies.calculateChaikinVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a;for(a=e.startFrom;a<i.length;a++)i[a]["_High-Low "+e.name]=i[a].High-i[a].Low;H.Studies.MA(e.inputs["Moving Average Type"],e.days,"_High-Low "+e.name,0,"_MA",t,e);var r=e.inputs["Rate Of Change"];for(r||(r=e.days),a=Math.max(e.startFrom,r);a<i.length;a++)i[a-r]["_MA "+e.name]&&(i[a]["Result "+e.name]=100*(i[a]["_MA "+e.name]/i[a-r]["_MA "+e.name]-1))}},H.Studies.calculateChaikinMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1];n&&(n["_sumMF "+e.name]&&(a=n["_sumMF "+e.name]),n["_sumV "+e.name]&&(r=n["_sumV "+e.name]));for(var s=e.startFrom;s<i.length;s++)i[s].High==i[s].Low?i[s]["_MFV "+e.name]=0:i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-i[s].High-i[s].Low)/(i[s].High-i[s].Low),a+=i[s]["_MFV "+e.name],r+=i[s].Volume,s>e.days-1&&(a-=i[s-e.days]["_MFV "+e.name],(r-=i[s-e.days].Volume)&&(i[s]["Result "+e.name]=a/r)),i[s]["_sumMF "+e.name]=a,i[s]["_sumV "+e.name]=r}},H.Studies.calculateTwiggsMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1];n&&(n["_sumMF "+e.name]&&(a=n["_sumMF "+e.name]),n["_sumV "+e.name]&&(r=n["_sumV "+e.name]));for(var s=Math.max(1,e.startFrom);s<i.length;s++){var o=Math.max(i[s-1].Close,i[s].High),l=Math.min(i[s-1].Close,i[s].Low);i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-o-l)/(o-l==0?999999:o-l),s>e.days-1&&(a*=(e.days-1)/e.days,r*=(e.days-1)/e.days),a+=i[s]["_MFV "+e.name],r+=i[s].Volume,s>e.days-1&&r&&(i[s]["Result "+e.name]=a/(0<r?r:999999)),i[s]["_sumMF "+e.name]=a,i[s]["_sumV "+e.name]=r}}},H.Studies.calculateMassIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<Math.max(9,e.days+1))e.error=!0;else{for(var a=e.startFrom;a<i.length;a++)i[a]["_High-Low "+e.name]=i[a].High-i[a].Low;H.Studies.MA("exponential",9,"_High-Low "+e.name,0,"_EMA",t,e),H.Studies.MA("exponential",9,"_EMA "+e.name,0,"_EMA2",t,e);var r=0;i[e.startFrom-1]&&i[e.startFrom-1]["_total "+e.name]&&(r=i[e.startFrom-1]["_total "+e.name]);for(var n=Math.max(17,e.startFrom);n<i.length;n++)r+=i[n]["_EMA "+e.name]/i[n]["_EMA2 "+e.name],n>=17+e.days-1&&(i[n]["Result "+e.name]=r,r-=i[n-e.days+1]["_EMA "+e.name]/i[n-e.days+1]["_EMA2 "+e.name]),i[n]["_total "+e.name]=r}},H.Studies.calculateMoneyFlowIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1],s="_rawMF "+e.name,o="_cumMF "+e.name,l="Result "+e.name;n&&n[o]&&(a=n[o][0],r=n[o][1]);for(var h=e.startFrom;h<i.length;h++){var c=i[h]["hlc/3"];if(0<h){var u=i[h-1]["hlc/3"],p=c*i[h].Volume;if(u<c?a+=p:c<u?r-=p*=-1:p=0,h>e.days){var d=i[h-e.days][s];0<d?a-=d:r+=d,i[h][l]=0===r?100:100-100/(1+a/r)}i[h][s]=p,i[h][o]=[a,r]}}}},H.Studies.calculateChandeMomentum=function(t,e){var i=e.name;for(var a in e.outputs)i=a+" "+i;var r=e.chart.scrubbed;if(r.length<e.days+1)e.error=!0;else{var n=e.inputs.Field;n&&"field"!=n||(n="Close");for(var s=0,o=0,l=[],h=e.startFrom-e.days+1;h<r.length;h++)if(!(h<1)){var c=r[h][n],u=r[h-1][n];if(c&&"object"==typeof c&&(c=c.Close),u&&"object"==typeof u&&(u=u.Close),void 0!==u){var p=c-u;if(l.push(p),s+=p,o+=Math.abs(p),l.length==e.days){r[h][i]=100*s/o;var d=l.shift();s-=d,o-=Math.abs(d)}}}}},H.Studies.calculateChandeForecast=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),H.Studies.MA("time series",e.days,a,0,"MA",t,e);for(var r=Math.max(1,e.startFrom);r<i.length;r++){var n=i[r][a];n&&"object"==typeof n&&(n=n[e.subField]),i[r]["Result "+e.name]=100*(1-i[r]["MA "+e.name]/n)}}},H.Studies.calculateDetrendedPrice=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=Math.floor(e.days/2+1);H.Studies.MA(e.inputs["Moving Average Type"],e.days,a,-r,"MA",t,e);for(var n=Math.max(e.days-r-1,e.startFrom-r);n<i.length-r;n++){var s=i[n][a];s&&"object"==typeof s&&(s=s[e.subField]),i[n]["Result "+e.name]=s-i[n]["MA "+e.name]}}},H.Studies.calculateAroon=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a,r=0,n=0,s=null,o=null;if(0<e.startFrom){var l=i[e.startFrom-1]["_state "+e.name];l&&(r=l[0],n=l[1],s=l[2],o=l[3])}for(var h=e.startFrom;h<i.length;h++){if(null===s&&(s=i[h].High),null===o&&(o=i[h].Low),(s=Math.max(s,i[h].High))==i[h].High)r=0;else if(++r>e.days)for(s=i[h].High,r=0,a=1;a<=e.days;a++)(s=Math.max(s,i[h-a].High))==i[h-a].High&&(r=a);if((o=Math.min(o,i[h].Low))==i[h].Low)n=0;else if(++n>e.days)for(o=i[h].Low,n=0,a=1;a<=e.days;a++)(o=Math.min(o,i[h-a].Low))==i[h-a].Low&&(n=a);i[h]["Aroon Up "+e.name]=100*(1-r/e.days),i[h]["Aroon Down "+e.name]=100*(1-n/e.days),i[h]["Aroon Oscillator "+e.name]=i[h]["Aroon Up "+e.name]-i[h]["Aroon Down "+e.name],i[h]["_state "+e.name]=[r,n,s,o]}}},H.Studies.calculatePrimeNumber=function(t,e){var a=[];function i(t){if(t<=0)return!1;if(t!=Math.floor(t))return!1;if(!0===a[t]||!1===a[t])return a[t];for(var e=parseInt(Math.sqrt(t),10),i=2;i<=e;i++)if(t%i==0)return a[t]=!1;return a[t]=!0}for(var r=e.chart.scrubbed,n=e.startFrom;n<r.length;n++){var s=r[n];if(s){for(var o=s.High,l=0;0<o&&o<=10;l++)o*=10;for(i(o)&&(o+=2),(o=Math.ceil(o))%2==0&&o++;!i(o);)o+=2;o/=Math.pow(10,l);for(var h=s.Low,c=0;0<h&&h<=10;c++)h*=10;if(i(h)&&(h-=2),(h=Math.floor(h))%2==0&&h--,0<h){for(;!i(h);)h-=2;h/=Math.pow(10,c)}if("Prime Number Bands"==e.type)s["Prime Bands Top "+e.name]=o,s["Prime Bands Bottom "+e.name]=Math.max(0,h);else{var u=0,p=e.inputs["Tolerance Percentage"]*(o-h)/100,d=o+h-2*s.Close;d<p?u=1:p<d&&(u=-1),u&&(s["Result "+e.name]=u)}}}},H.Studies.calculateVerticalHorizontalFilter=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{e.mhml=new H.Studies.StudyDescriptor(e.name,e.type,e.panel),e.mhml.chart=e.chart,e.mhml.days=e.days,e.mhml.startFrom=e.startFrom,e.mhml.inputs={},e.mhml.outputs={_MHML:null},H.Studies.calculateMaxHighMinLow(t,e.mhml);for(var a=0,r=[],n=Math.max(1,e.startFrom-e.days);n<i.length;n++){var s=Math.abs(i[n].Close-i[n-1].Close);r.push(s),a+=s,r.length==e.days&&(i[n]["Result "+e.name]=i[n]["_MHML "+e.name]/a,a-=r.shift())}}},H.Studies.calculatePriceOscillator=function(t,e){var i=e.chart.scrubbed,a=Number(e.inputs["Short Cycle"]),r=Number(e.inputs["Long Cycle"]);if(i.length<Math.max(a,r)+1)e.error=!0;else{var n=e.inputs.Field,s=e.inputs["Moving Average Type"];s||(s="simple"),n&&"field"!=n||(n="Close"),e.parameters.isVolume&&(n="Volume",s="exponential");var o=e.inputs["Points Or Percent"];o||(o="Percent"),H.Studies.MA(s,a,n,0,"_Short MA",t,e),H.Studies.MA(s,r,n,0,"_Long MA",t,e);for(var l=Math.max(r,e.startFrom);l<i.length;l++){var h=i[l];h&&(h["Result "+e.name]="Points"==o?h["_Short MA "+e.name]-h["_Long MA "+e.name]:100*(h["_Short MA "+e.name]/h["_Long MA "+e.name]-1),e.outputs["Increasing Bar"]&&(h[e.name+"_hist"]=h["Result "+e.name]))}}},H.Studies.calculateKeltner=function(t,e){H.Studies.MA(e.inputs["Moving Average Type"],e.days,"Close",0,"MA",t,e),H.Studies.calculateStudyATR(t,e),H.Studies.calculateGenericEnvelope(t,e,e.inputs.Shift,"MA "+e.name,"ATR "+e.name)},H.Studies.calculateCoppock=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=parseInt(e.inputs["Long RoC"],10);r||(r=14);var n=parseInt(e.inputs["Short RoC"],10);n||(n=11);var s=e.days;if(s||(s=10),!(r<n))if(i.length<Math.max(n,r,s)+1)e.error=!0;else{for(var o=Math.max(e.startFrom,r);o<i.length;o++){var l=i[o-n][a],h=i[o-r][a];l&&h&&(i[o]["_Sum "+e.name]=100*(i[o][a]/l+i[o][a]/h-2))}H.Studies.MA("weighted",s,"_Sum "+e.name,0,"Result",t,e)}},H.Studies.calculateLinearRegressionIndicator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.days*(e.days+1)/2,n=Math.pow(r,2),s=r*(2*e.days+1)/3,o=0,l=0,h=0;if(e.startFrom){var c=i[e.startFrom-1]["_sums "+e.name];c&&(l=c[0],o=c[1],h=c[2])}for(var u=e.startFrom;u<i.length;u++){var p=i[u][a];if(p&&"object"==typeof p&&(p=p[e.subField]),(p||0===p)&&(l+=e.days*p-o,o+=p,h+=Math.pow(p,2),!(u<e.days-1))){if(u>e.days-1){var d=i[u-e.days][a];if(d&&"object"==typeof d&&(d=d[e.subField]),!d&&0!==d)continue;o-=d,h-=Math.pow(d,2)}var m=(e.days*l-r*o)/(e.days*s-n),g=(o-(i[u]["Slope "+e.name]=m)*r)/e.days;i[u]["Intercept "+e.name]=g,i[u]["Forecast "+e.name]=g+m*e.days;var f=(e.days*s-n)/(e.days*h-Math.pow(o,2));i[u]["RSquared "+e.name]=m*m*f,i[u]["_sums "+e.name]=[l,o,h]}}}},H.Studies.calculateBollinger=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close"),H.Studies.MA(e.inputs["Moving Average Type"],e.days,i,0,"_MA",t,e),e.std=new H.Studies.StudyDescriptor(e.name,"STD Dev",e.panel),e.std.chart=e.chart,e.std.startFrom=e.startFrom,e.std.days=e.days,e.std.inputs={Field:i,"Standard Deviations":1,Type:e.inputs["Moving Average Type"]},e.std.outputs={"_STD Dev":null},H.Studies.calculateStandardDeviation(t,e.std),H.Studies.calculateGenericEnvelope(t,e,e.inputs["Standard Deviations"],"_MA "+e.name,"_STD Dev "+e.name),"Boll %b"==e.type&&(e.zoneOutput="%b")},H.Studies.calculateMAEnvelope=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close"),H.Studies.MA(e.inputs["Moving Average Type"],e.days,i,0,"MA",t,e);var a=e.inputs["Shift Type"],r=e.inputs.Shift;a||(a="percent",r=e.inputs["Shift Percentage"]),"percent"==a?H.Studies.calculateGenericEnvelope(t,e,r/100,"MA "+e.name):"points"==a&&H.Studies.calculateGenericEnvelope(t,e,null,"MA "+e.name,null,Number(r))},H.Studies.calculateGenericEnvelope=function(t,e,i,a,r,n){i||(i=0),n||(n=0),a&&"field"!=a||(a="Close"),r||(r=a);var s=e.chart.scrubbed,o=e.inputs.Field;o&&"field"!==o||(o="Close");for(var l=e.startFrom;s&&l<s.length;l++){var h=s[l];if(h&&h[a]){var c=h[o];c&&"object"==typeof c&&(c=c.Close);var u=h[a];u&&"object"==typeof u&&(u=u[e.subField]);var p=h[r];p&&"object"==typeof p&&(p=p[e.subField]);var d=i*p+n;h[e.type+" Top "+e.name]=u+d,h[e.type+" Bottom "+e.name]=u-d,h[e.type+" Median "+e.name]=u,h["Bandwidth "+e.name]=u?200*d/u:0,h["%b "+e.name]=50*((c-u)/d+1)}}},H.Studies.calculateMaxHighMinLow=function(t,e){var i=e.chart.scrubbed,a=e.days,r=e.days;if(e.inputs["High Period"]&&(a=e.inputs["High Period"]),e.inputs["Low Period"]&&(r=e.inputs["Low Period"]),i.length<Math.max(a,r)+1)e.error=!0;else{var n,s=Number.MAX_VALUE,o=-1*Number.MAX_VALUE;if(1<e.startFrom){for(n=1;n<a;n++)o=Math.max(o,i[e.startFrom-n].High);for(n=1;n<r;n++)s=Math.min(s,i[e.startFrom-n].Low)}for(var l=Math.max(0,e.startFrom-1);l<i.length;l++){if(o=Math.max(o,i[l].High),s=Math.min(s,i[l].Low),a<=l&&i[l-a].High==o)for(o=i[l].High,n=1;n<a;n++)o=Math.max(o,i[l-n].High);if(r<=l&&i[l-r].Low==s)for(s=i[l].Low,n=1;n<r;n++)s=Math.min(s,i[l-n].Low);var h=0;if("HHV"==e.type)h=o;else if("LLV"==e.type)h=s;else if("Donchian Width"==e.type)h=o-s;else if("GAPO"==e.type||"Gopala"==e.type)h=Math.log(o-s)/Math.log(r);else{if("VT HZ Filter"==e.type){h=o-s,i[l]["_MHML "+e.name]=h;continue}if("Williams %R"==e.type){h=-100*(o-i[l].Close)/(o-s),i[l]["Result "+e.name]=h;continue}}if(l==i.length-1)break;"Donchian Channel"==e.type?(i[l+1]["Donchian High "+e.name]=o,i[l+1]["Donchian Low "+e.name]=s,i[l+1]["Donchian Median "+e.name]=(o+s)/2):i[l+1]["Result "+e.name]=h}}},H.Studies.calculateAccumulationDistribution=function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)if(a){var r=i[a],n=i[a-1],s=0;r.Close>n.Close?s=r.Close-Math.min(r.Low,n.Close):r.Close<n.Close&&(s=r.Close-Math.max(r.High,n.Close)),e.inputs["Use Volume"]&&(s*=r.Volume);var o=n["Result "+e.name];o||(o=0),o+=s,r["Result "+e.name]=o}},H.Studies.calculateCCI=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{H.Studies.MA("simple",e.days,"hlc/3",0,"MA",t,e);for(var a=Math.max(e.startFrom,e.days-1);a<i.length;a++){var r=i[a];if(r){for(var n=0,s=0;s<e.days;s++)n+=Math.abs(i[a-s]["hlc/3"]-r["MA "+e.name]);n/=e.days,Math.abs(n)<1e-8?r["Result "+e.name]=0:r["Result "+e.name]=(r["hlc/3"]-r["MA "+e.name])/(.015*n)}}}},H.Studies.calculateFractalChaos=function(t,e){var i=e.chart.scrubbed,a=0,r=0,n=0;e.startFrom&&"Fractal Chaos Bands"==e.type&&(a=i[e.startFrom-1]["Fractal High "+e.name],r=i[e.startFrom-1]["Fractal Low "+e.name]);for(var s=Math.max(4,e.startFrom);s<i.length;s++){var o;for(o=n=i[s]["Result "+e.name]=0;o<=s&&i[s-o]&&!(i[s-o].High>i[s-2].High)&&!(o<2&&i[s-o].High==i[s-2].High);o++)if(i[s-o].High<i[s-2].High&&n++,4==n){a=i[s-2].High;break}for("Fractal Chaos Bands"==e.type?i[s]["Fractal High "+e.name]=0<a?a:null:4==n&&(i[s]["Result "+e.name]=1),o=n=0;o<=s&&i[s-o]&&!(i[s-o].Low<i[s-2].Low)&&!(o<2&&i[s-o].Low==i[s-2].Low);o++)if(i[s-o].Low>i[s-2].Low&&n++,4==n){r=i[s-2].Low;break}"Fractal Chaos Bands"==e.type?i[s]["Fractal Low "+e.name]=0<r?r:null:4==n&&(i[s]["Result "+e.name]=-1)}},H.Studies.displayRAVI=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name),n=t.pixelFromPrice(0,a,r),s=t.layout.candleWidth-2;s<2&&(s=1);var o=H.Studies.determineColor(e.outputs["Increasing Bar"]),l=H.Studies.determineColor(e.outputs["Decreasing Bar"]);t.startClip(e.panel),t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1);for(var h=0;h<i.length;h++){var c=i[h],u=i[h-1];if(u||(u=t.getPreviousBar(t.chart,e.name+"_hist",h)),c){var p=0,d=0;e.parameters&&e.parameters.studyOverZonesEnabled&&(p=parseFloat(e.parameters.studyOverBoughtValue),d=parseFloat(e.parameters.studyOverSoldValue)),u?c[e.name+"_hist"]>p&&u[e.name+"_hist"]<c[e.name+"_hist"]?t.chart.context.fillStyle=o:c[e.name+"_hist"]<d&&u[e.name+"_hist"]>c[e.name+"_hist"]?t.chart.context.fillStyle=l:t.chart.context.fillStyle="#CCCCCC":t.chart.context.fillStyle="#CCCCCC",c.candleWidth&&(s=Math.floor(Math.max(1,c.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(h,a.chart)-s/2),Math.floor(n),Math.floor(s),Math.floor(t.pixelFromPrice(c[e.name+"_hist"],a,r)-n))}}t.endClip()},H.Studies.displayElderForce=function(t,e,i){H.Studies.displaySeriesAsLine(t,e,i);var a=H.Studies.determineColor(e.outputs.Result),r=t.panels[e.panel],n=t.getYAxisByName(r,e.name),s={skipTransform:r.name!=e.chart.name,panelName:e.panel,band:"Result "+e.name,threshold:0,color:a,yAxis:n,direction:1};H.preparePeakValleyFill(t,s),s.direction=-1,H.preparePeakValleyFill(t,s)},H.Studies.displayElderRay=function(r,n,t){var s=r.panels[n.panel],o=r.getYAxisByName(s,n.name),l=r.pixelFromPrice(0,s,o),h=r.layout.candleWidth-2;function e(t,e,i,a){r.chart.context.fillStyle=H.Studies.determineColor(n.outputs[i]),r.chart.context.fillRect(Math.floor(r.pixelFromBar(t,s.chart)-h/2+h*e),Math.floor(l),Math.floor(h*(1-2*e)),Math.floor(r.pixelFromPrice(c[n.name+a],s,o)-l))}h<2&&(h=1),r.canvasColor("stx_histogram");var i=r.chart.context.fillStyle;n.underlay||(r.chart.context.globalAlpha=1),r.startClip(n.panel);for(var a=0;a<t.length;a++){var c=t[a];c&&(c.candleWidth&&(h=Math.floor(Math.max(1,c.candleWidth-2))),0<c[n.name+"_hist1"]&&e(a,0,"Elder Bull Power","_hist1"),c[n.name+"_hist2"]<0&&e(a,0,"Elder Bear Power","_hist2"),c[n.name+"_hist1"]<0&&e(a,.1,"Elder Bull Power","_hist1"),0<c[n.name+"_hist2"]&&e(a,.1,"Elder Bear Power","_hist2"))}r.endClip(),r.chart.context.fillStyle=i},H.Studies.displayADX=function(t,e,i){var a=e.underlay?.3:e.inputs.Series?.4:1;if(e.inputs.Series&&e.inputs.Shading){var r="+DI "+e.name,n="-DI "+e.name,s=H.Studies.determineColor(e.outputs[e.outputMap[r]]),o=H.Studies.determineColor(e.outputs[e.outputMap[n]]),l=t.getYAxisByName(e.panel,e.name),h={topBand:r,bottomBand:n,topColor:s,bottomColor:o,skipTransform:t.panels[e.panel].name!=e.chart.name,topAxis:l,bottomAxis:l};H.fillIntersecting(t,e.panel,h)}e.inputs.Histogram&&H.Studies.createHistogram(t,e,i,!1,a),!1!==e.inputs.Series?H.Studies.displaySeriesAsLine(t,e,i):e.inputs.Series||e.inputs.Histogram||t.watermark(e.panel,"center","bottom",t.translateIf(e.name)+": "+t.translateIf("Nothing to display"))},H.Studies.displayMassIndex=function(t,e,i){H.Studies.displaySeriesAsLine(t,e,i);var a=e.inputs["Bulge Threshold"],r=t.panels[e.panel],n=t.getYAxisByName(r,e.name),s=H.Studies.determineColor(e.outputs.Result);H.preparePeakValleyFill(t,{skipTransform:t.panels[e.panel].name!=e.chart.name,panelName:e.panel,band:"Result "+e.name,threshold:a,direction:1,color:s,yAxis:n}),H.Studies.drawHorizontal(t,e,null,a,n,s)},H.Studies.displayChannel=function(t,e,i){if(e.inputs["Channel Fill"]){var a={panelName:e.panel};for(var r in e.outputs){var n=r.split(" ").pop();"Top"==n||"High"==n?a.topBand=r+" "+e.name:"Bottom"==n||"Low"==n?a.bottomBand=r+" "+e.name:"Median"!=n&&"Channel"!=n||(a.color=H.Studies.determineColor(e.outputs[r]))}e.parameters&&e.parameters.opacity&&(a.opacity=e.parameters.opacity);var s=t.panels[e.panel];a.skipTransform=s.name!=e.chart.name,a.yAxis=t.getYAxisByName(s,e.name),H.prepareChannelFill(t,a)}H.Studies.displaySeriesAsLine(t,e,i)},H.Studies.inputAttributeDefaultGenerator=function(t){return!t&&0!==t||t.constructor!=Number?{}:Math.floor(t)==t?0<t?{min:1,step:1}:{step:1}:0<t?{min:0,step:.01}:{step:.01}},H.Studies.getStudyList=function(t){var e={},i={Directional:!0,Gopala:!0,vchart:!0};for(var a in H.extend(i,t),H.Studies.studyLibrary)i[a]||(e[H.Studies.studyLibrary[a].name]=a);return e},H.Studies.determineColor=function(t){return t?"object"==typeof t?t.color:t:null},H.Studies.studyScriptLibrary={},H.Studies.studyLibrary={rsi:{name:"RSI",inputs:{Period:14},calculateFN:H.Studies.calculateRSI,range:"0 to 100",outputs:{RSI:"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},ma:{name:"Moving Average",overlay:!0,calculateFN:H.Studies.calculateMovingAverage,inputs:{Period:50,Field:"field",Type:"ma",Offset:0},outputs:{MA:"#FF0000"}},macd:{name:"MACD",calculateFN:H.Studies.calculateMACD,seriesFN:H.Studies.displayHistogramWithSeries,inputs:{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},outputs:{MACD:"auto",Signal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},stochastics:{name:"Stochastics",range:"0 to 100",initializeFN:H.Studies.initializeStochastics,calculateFN:H.Studies.calculateStochastics,inputs:{Period:14,Smooth:!0},outputs:{Fast:"auto",Slow:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Aroon:{name:"Aroon",range:"0 to 100",calculateFN:H.Studies.calculateAroon,outputs:{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{name:"Aroon Oscillator",calculateFN:H.Studies.calculateAroon,outputs:{"Aroon Oscillator":"auto"}},"Lin R2":{name:"Linear Reg R2",calculateFN:H.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{RSquared:"auto"}},"Lin Fcst":{name:"Linear Reg Forecast",overlay:!0,calculateFN:H.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"Lin Incpt":{name:"Linear Reg Intercept",overlay:!0,calculateFN:H.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Intercept:"auto"}},"Time Fcst":{name:"Time Series Forecast",overlay:!0,calculateFN:H.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"VT HZ Filter":{name:"Vertical Horizontal Filter",calculateFN:H.Studies.calculateVerticalHorizontalFilter,inputs:{Period:28}},TRIX:{name:"TRIX",calculateFN:H.Studies.calculateTRIX},"STD Dev":{name:"Standard Deviation",calculateFN:H.Studies.calculateStandardDeviation,inputs:{Period:14,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Trade Vol":{name:"Trade Volume Index",calculateFN:H.Studies.calculateOnBalanceVolume,inputs:{"Min Tick Value":.5}},Swing:{name:"Swing Index",calculateFN:H.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Acc Swing":{name:"Accumulative Swing Index",calculateFN:H.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Price ROC":{name:"Price Rate of Change",calculateFN:H.Studies.calculateRateOfChange,inputs:{Period:14,Field:"field"}},"Vol ROC":{name:"Volume Rate of Change",calculateFN:H.Studies.calculateRateOfChange,parameters:{init:{isVolume:!0}}},Momentum:{name:"Momentum Indicator",calculateFN:H.Studies.calculateRateOfChange,inputs:{Period:14},centerline:0},"Price Vol":{name:"Price Volume Trend",calculateFN:H.Studies.calculatePriceVolumeTrend,inputs:{Field:"field"}},"Pos Vol":{name:"Positive Volume Index",calculateFN:H.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"Neg Vol":{name:"Negative Volume Index",calculateFN:H.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"On Bal Vol":{name:"On Balance Volume",calculateFN:H.Studies.calculateOnBalanceVolume,inputs:{}},"Stch Mtm":{name:"Stochastic Momentum Index",calculateFN:H.Studies.calculateStochMomentum,inputs:{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},"Hist Vol":{name:"Historical Volatility",calculateFN:H.Studies.calculateHistoricalVolatility,inputs:{Period:10,Field:"field","Days Per Year":[252,365],"Standard Deviations":1},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Pretty Good":{name:"Pretty Good Oscillator",calculateFN:H.Studies.calculatePrettyGoodOscillator,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}}},Ultimate:{name:"Ultimate Oscillator",calculateFN:H.Studies.calculateUltimateOscillator,inputs:{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"Vol Osc":{name:"Volume Oscillator",calculateFN:H.Studies.calculatePriceOscillator,inputs:{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]},parameters:{init:{isVolume:!0}}},Twiggs:{name:"Twiggs Money Flow",calculateFN:H.Studies.calculateTwiggsMoneyFlow,inputs:{Period:21}},"Chaikin MF":{name:"Chaikin Money Flow",calculateFN:H.Studies.calculateChaikinMoneyFlow,inputs:{Period:20}},"Chaikin Vol":{name:"Chaikin Volatility",calculateFN:H.Studies.calculateChaikinVolatility,inputs:{Period:14,"Rate Of Change":2,"Moving Average Type":"ma"}},"Price Osc":{name:"Price Oscillator",calculateFN:H.Studies.calculatePriceOscillator,inputs:{Field:"field","Short Cycle":12,"Long Cycle":26,"Moving Average Type":"ema","Points Or Percent":["Points","Percent"]}},EOM:{name:"Ease of Movement",calculateFN:H.Studies.calculateEaseOfMovement,inputs:{Period:14,"Moving Average Type":"ma"}},CCI:{name:"Commodity Channel Index",calculateFN:H.Studies.calculateCCI,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}},attributes:{Period:{min:2}}},Detrended:{name:"Detrended Price Oscillator",calculateFN:H.Studies.calculateDetrendedPrice,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}},"True Range":{name:"True Range",calculateFN:H.Studies.calculateStudyATR,inputs:{},outputs:{"True Range":"auto"}},ATR:{name:"Average True Range",calculateFN:H.Studies.calculateStudyATR,outputs:{ATR:"auto"}},"Ehler Fisher":{name:"Ehler Fisher Transform",calculateFN:H.Studies.calculateEhlerFisher,inputs:{Period:10},outputs:{EF:"auto","EF Trigger":"#FF0000"}},Schaff:{name:"Schaff Trend Cycle",range:"0 to 100",calculateFN:H.Studies.calculateSchaff,inputs:{Period:10,Field:"field","Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}},QStick:{name:"QStick",calculateFN:H.Studies.calculateQStick,inputs:{Period:8,"Moving Average Type":"ma"}},Coppock:{name:"Coppock Curve",calculateFN:H.Studies.calculateCoppock,inputs:{Period:10,Field:"field","Short RoC":11,"Long RoC":14}},"Chande Mtm":{name:"Chande Momentum Oscillator",calculateFN:H.Studies.calculateChandeMomentum,inputs:{Period:9},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}},"Chande Fcst":{name:"Chande Forecast Oscillator",calculateFN:H.Studies.calculateChandeForecast,inputs:{Period:14,Field:"field"}},"Intraday Mtm":{name:"Intraday Momentum Index",calculateFN:H.Studies.calculateIntradayMomentum,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},RAVI:{name:"RAVI",seriesFN:H.Studies.displayRAVI,calculateFN:H.Studies.calculatePriceOscillator,inputs:{Field:"field","Moving Average Type":"vdma","Short Cycle":7,"Long Cycle":65},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.1"},studyOverSoldValue:{max:0,step:"0.1"}}},"Random Walk":{name:"Random Walk Index",calculateFN:H.Studies.calculateRandomWalk,outputs:{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}},ADX:{name:"ADX/DMS",calculateFN:H.Studies.calculateADX,seriesFN:H.Studies.displayADX,inputs:{Period:14,"Smoothing Period":14,Series:!0,Shading:!1,Histogram:!1},outputs:{"+DI":"#00FF00","-DI":"#FF0000",ADX:"auto","Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"High Low":{name:"High Low Bands",overlay:!0,seriesFN:H.Studies.displayChannel,calculateFN:function(t,e){e.inputs["Moving Average Type"]="triangular",H.Studies.calculateMAEnvelope(t,e)},inputs:{Period:10,Field:"field","Shift Percentage":5,"Channel Fill":!0},outputs:{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"},attributes:{"Shift Percentage":{min:.1,step:.1}}},"High-Low":{name:"High Minus Low",calculateFN:function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)i[a]["Result "+e.name]=i[a].High-i[a].Low},inputs:{}},"Med Price":{name:"Median Price",calculateFN:H.Studies.calculateTypicalPrice,inputs:{Period:14}},"MA Env":{name:"Moving Average Envelope",overlay:!0,seriesFN:H.Studies.displayChannel,calculateFN:H.Studies.calculateMAEnvelope,inputs:{Period:50,Field:"field","Shift Type":["percent","points"],Shift:5,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},"Fractal Chaos Bands":{name:"Fractal Chaos Bands",overlay:!0,calculateFN:H.Studies.calculateFractalChaos,seriesFN:H.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}},"Fractal Chaos":{name:"Fractal Chaos Oscillator",range:"-1 to 1",calculateFN:H.Studies.calculateFractalChaos,inputs:{},centerline:null},GAPO:{name:"Gopalakrishnan Range Index",calculateFN:H.Studies.calculateMaxHighMinLow},"Prime Number Bands":{name:"Prime Number Bands",overlay:!0,calculateFN:H.Studies.calculatePrimeNumber,seriesFN:H.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}},"Prime Number":{name:"Prime Number Oscillator",range:"-1 to 1",calculateFN:H.Studies.calculatePrimeNumber,centerline:0,inputs:{"Tolerance Percentage":5},attributes:{"Tolerance Percentage":{min:.1,step:.1}}},"Bollinger Bands":{name:"Bollinger Bands",overlay:!0,calculateFN:H.Studies.calculateBollinger,seriesFN:H.Studies.displayChannel,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Channel":{name:"Donchian Channel",overlay:!0,calculateFN:H.Studies.calculateMaxHighMinLow,seriesFN:H.Studies.displayChannel,inputs:{"High Period":20,"Low Period":20,"Channel Fill":!0},outputs:{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},HHV:{name:"Highest High Value",calculateFN:H.Studies.calculateMaxHighMinLow,inputs:{Period:14}},LLV:{name:"Lowest Low Value",calculateFN:H.Studies.calculateMaxHighMinLow,inputs:{Period:14}},"Mass Idx":{name:"Mass Index",seriesFN:H.Studies.displayMassIndex,calculateFN:H.Studies.calculateMassIndex,inputs:{Period:25,"Bulge Threshold":27},attributes:{"Bulge Threshold":{min:20,max:35,step:.1}}},Keltner:{name:"Keltner Channel",overlay:!0,seriesFN:H.Studies.displayChannel,calculateFN:H.Studies.calculateKeltner,inputs:{Period:50,Shift:5,"Moving Average Type":"ema","Channel Fill":!0},outputs:{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},PSAR:{name:"Parabolic SAR",overlay:!0,calculateFN:H.Studies.calculatePSAR,seriesFN:H.Studies.displayPSAR2,inputs:{"Minimum AF":.02,"Maximum AF":.2}},Klinger:{name:"Klinger Volume Oscillator",seriesFN:H.Studies.displayHistogramWithSeries,calculateFN:H.Studies.calculateKlinger,inputs:{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},outputs:{Klinger:"auto",KlingerSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Ray":{name:"Elder Ray Index",seriesFN:H.Studies.displayElderRay,calculateFN:H.Studies.calculateElderRay,centerline:0,inputs:{Period:13},outputs:{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Force":{name:"Elder Force Index",calculateFN:H.Studies.calculateElderForce,seriesFN:H.Studies.displayElderForce,inputs:{Period:13}},"LR Slope":{name:"Linear Reg Slope",calculateFN:H.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Slope:"auto"}},COG:{name:"Center Of Gravity",calculateFN:H.Studies.calculateCenterOfGravity,inputs:{Period:10,Field:"field"}},"Typical Price":{name:"Typical Price",calculateFN:H.Studies.calculateTypicalPrice,inputs:{Period:14}},"Weighted Close":{name:"Weighted Close",calculateFN:H.Studies.calculateTypicalPrice,inputs:{Period:14}},"M Flow":{name:"Money Flow Index",range:"0 to 100",calculateFN:H.Studies.calculateMoneyFlowIndex,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"Williams %R":{name:"Williams %R",calculateFN:H.Studies.calculateMaxHighMinLow,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"W Acc Dist":{name:"Accumulation/Distribution",calculateFN:H.Studies.calculateAccumulationDistribution,inputs:{"Use Volume":!1}},volume:{name:"Volume Chart",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0},seriesFN:H.Studies.createVolumeChart,calculateFN:H.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},parameters:{zoom:0,widthFactor:1}},"vol undr":{name:"Volume Underlay",underlay:!0,range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,position:"none"},seriesFN:H.Studies.createVolumeChart,calculateFN:H.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},customRemoval:!0,removeFN:function(t,e){t.layout.volumeUnderlay=!1,t.changeOccurred("layout")},parameters:{zoom:0,widthFactor:1}}},R=(d=t).CIQ,y=d.timezoneJS,R.Drawing=function(){this.chartsOnly=!1,this.penDown=!1},R.Drawing.getDrawingParameters=function(t,e){var i;try{i=new R.Drawing[e]}catch(t){}if(!i)return null;i.stx=t,i.copyConfig(!0);for(var a={},r=i.configs,n=0;n<r.length;n++)a[r[n]]=i[r[n]];var s=t.canvasStyle("stx_annotation");return s&&a.font&&(a.font.size=s.fontSize,a.font.family=s.fontFamily,a.font.style=s.fontStyle,a.font.weight=s.fontWeight),a},R.Drawing.saveConfig=function(t,e){if(e){var i=t.preferences;i.drawings||(i.drawings={}),i.drawings[e]={};var a=new R.Drawing[e];a.stx=t,R.Drawing.copyConfig(a),a.configs.forEach(function(t){i.drawings[e][t]=a[t]}),t.changeOccurred("preferences")}},R.Drawing.restoreDefaultConfig=function(t,e,i){i?t.preferences.drawings=null:t.preferences.drawings[e]=null,t.changeOccurred("preferences"),t.currentVectorParameters=R.clone(R.ChartEngine.currentVectorParameters),t.currentVectorParameters.vectorType=e},R.Drawing.initializeSettings=function(t,e){var i=R.Drawing[e];i&&(drawInstance=new i,drawInstance.initializeSettings&&drawInstance.initializeSettings(t))},R.Drawing.prototype.copyConfig=function(t){R.Drawing.copyConfig(this,t)},R.Drawing.copyConfig=function(t,e){var i,a,r=t.stx.currentVectorParameters,n=t.configs;for(i=0;i<n.length;i++)"color"==(a=n[i])?t.color=r.currentColor:"parameters"==a?t.parameters=R.clone(r.fibonacci):"font"==a?t.font=R.clone(r.annotation.font):t[a]=r[a];if(e){var s=t.stx.preferences;if(s&&s.drawings)for(R.extend(t,s.drawings[r.vectorType]),i=0;i<n.length;i++)"color"==(a=n[i])?r.currentColor=t.color:"parameters"==a?r.fibonacci=R.clone(t.parameters):"font"==a?r.annotation.font=R.clone(t.font):r[a]=t[a]}},R.Drawing.prototype.dragToDraw=!1,R.Drawing.prototype.permanent=!1,R.Drawing.prototype.chartsOnly=!1,R.Drawing.prototype.abort=function(t){},R.Drawing.prototype.measure=function(){},R.Drawing.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name},R.Drawing.prototype.render=function(t){alert("must implement render function!")},R.Drawing.prototype.click=function(t,e,i){alert("must implement click function!")},R.Drawing.prototype.move=function(t,e,i){alert("must implement move function!")},R.Drawing.prototype.reposition=function(t,e,i,a){},R.Drawing.prototype.intersected=function(t,e,i){alert("must implement intersected function!")},R.Drawing.prototype.reconstruct=function(t,e){alert("must implement reconstruct function!")},R.Drawing.prototype.serialize=function(){alert("must implement serialize function!")},R.Drawing.prototype.adjust=function(){alert("must implement adjust function!")},R.Drawing.prototype.highlight=function(t){return t&&!this.highlighted?this.highlighted=t:!t&&this.highlighted&&(this.highlighted=t),this.highlighted},R.Drawing.prototype.littleCircleRadius=function(){return 6},R.Drawing.prototype.littleCircle=function(t,e,i,a){if(!this.permanent){var r=this.stx.defaultColor,n=R.chooseForegroundColor(r);t.beginPath(),t.lineWidth=1,t.arc(e,i,this.littleCircleRadius(),0,2*Math.PI,!1),t.fillStyle=a?r:n,t.strokeStyle=r,t.setLineDash([]),t.fill(),t.stroke(),t.closePath()}},R.Drawing.prototype.rotator=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),n=this.stx.defaultColor;t.beginPath(),t.lineWidth=2,a||(t.globalAlpha=.5);var s=4+r;t.arc(e,i,s,0,3*Math.PI/2,!1),t.moveTo(e+2+s,i+2),t.lineTo(e+s,i),t.lineTo(e-2+s,i+2),t.moveTo(e-2,i+2-s),t.lineTo(e,i-s),t.lineTo(e-2,i-2-s),t.strokeStyle=n,t.stroke(),t.closePath(),t.globalAlpha=1}},R.Drawing.prototype.mover=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),n=this.stx.defaultColor,s=r+1;t.save(),t.lineWidth=2,t.strokeStyle=n,t.translate(e,i),a||(t.globalAlpha=.5);for(var o=0;o<4;o++)t.rotate(Math.PI/2),t.beginPath(),t.moveTo(0,s),t.lineTo(0,s+5),t.moveTo(-2,s+5-2),t.lineTo(0,s+5),t.lineTo(2,s+5-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},R.Drawing.prototype.resizer=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),n=this.stx.defaultColor,s=5*Math.sqrt(2),o=r+1;t.save(),t.lineWidth=2,t.strokeStyle=n,t.translate(e,i),t.rotate(-e*i/Math.abs(e*i)*Math.PI/4),a||(t.globalAlpha=.5);for(var l=0;l<2;l++)t.rotate(Math.PI),t.beginPath(),t.moveTo(0,o),t.lineTo(0,o+s),t.moveTo(-2,o+s-2),t.lineTo(0,o+s),t.lineTo(2,o+s-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},R.Drawing.prototype.pointIntersection=function(t,e,i){return!!this.stx.panels[this.panelName]&&t>=i.x0&&t<=i.x1&&e>=i.y1&&e<=i.y0},R.Drawing.prototype.setPoint=function(t,e,i,a){var r,n=null,s=null;if("number"==typeof e?n=e:8<=e.length?s=e:n=Number(e),(i||0===i)&&(this["v"+t]=i),null!==n)r=this.stx.dateFromTick(n,a,!0),this["tzo"+t]=r.getTimezoneOffset(),this["d"+t]=R.yyyymmddhhmmssmmm(r),this["p"+t]=[n,i];else if(null!==s){r=R.strToDateTime(s),this["tzo"+t]||0===this["tzo"+t]||(this["tzo"+t]=r.getTimezoneOffset()),this["d"+t]=s;var o=this["tzo"+t]-r.getTimezoneOffset();r.setMinutes(r.getMinutes()+o);var l=!1;"freeform"==this.name||R.ChartEngine.isDailyInterval(this.stx.layout.interval)||r.getHours()||r.getMinutes()||r.getSeconds()||r.getMilliseconds()||(l=!0),this["p"+t]=[this.stx.tickFromDate(R.yyyymmddhhmmssmmm(r),a,null,l),i]}},R.Drawing.prototype.setLineColor=function(t){t||(t=this.color);var e=t;return("auto"==e||R.isTransparent(e))&&(e=this.stx.defaultColor),this.highlighted&&(e=this.stx.getCanvasColor("stx_highlight_vector")),e},R.Drawing.BaseTwoPoint=function(){this.p0=null,this.p1=null,this.color=""},R.Drawing.BaseTwoPoint.ciqInheritsFrom(R.Drawing),R.Drawing.BaseTwoPoint.prototype.configs=[],R.Drawing.BaseTwoPoint.prototype.lineIntersection=function(t,e,i,a,r,n,s){r||(r=this.p0),n||(n=this.p1);var o=this.stx;if(!r||!n)return!1;var l=R.convertBoxToPixels(o,this.panelName,i);if(void 0===l.x0)return!1;var h={x0:r[0],x1:n[0],y0:r[1],y1:n[1]};return s||(h=R.convertBoxToPixels(o,this.panelName,h)),R.boxIntersects(l.x0,l.y0,l.x1,l.y1,h.x0,h.y0,h.x1,h.y1,a)},R.Drawing.BaseTwoPoint.prototype.boxIntersection=function(t,e){return!(!this.p0||!this.p1||t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0])||e>Math.max(this.p0[1],this.p1[1])||e<Math.min(this.p0[1],this.p1[1]))},R.Drawing.BaseTwoPoint.prototype.accidentalClick=function(t,e){var i=this.stx.panels[this.panelName],a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(t,i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,t,e),o=Math.abs(r-a),l=Math.abs(s-n);if(Math.sqrt(o*o+l*l)<10)return this.penDown=!1,this.dragToDraw&&this.stx.undo(),!0},R.Drawing.BaseTwoPoint.prototype.click=function(t,e,i){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),!(this.penDown=!1)):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},R.Drawing.BaseTwoPoint.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart))},R.Drawing.BaseTwoPoint.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p1=[e,i],this.render(t))},R.Drawing.BaseTwoPoint.prototype.measure=function(){this.p0&&this.p1&&this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],!0,this.name)},R.Drawing.BaseTwoPoint.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.render(t))}},R.Drawing.annotation=function(){this.name="annotation",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={}},R.Drawing.annotation.ciqInheritsFrom(R.Drawing.BaseTwoPoint),R.Drawing.annotation.prototype.getFontString=function(){this.fontDef={style:null,weight:null,size:"12px",family:null};var t=this.stx.canvasStyle("stx_annotation");t&&(t.fontStyle&&(this.fontDef.style=t.fontStyle),t.fontWeight&&(this.fontDef.weight=t.fontWeight),t.fontSize&&(this.fontDef.size=t.fontSize),t.fontFamily&&(this.fontDef.family=t.fontFamily)),this.font.style&&(this.fontDef.style=this.font.style),this.font.weight&&(this.fontDef.weight=this.font.weight),this.font.size&&(this.fontDef.size=this.font.size),this.font.family&&(this.fontDef.family=this.font.family);var e=!(this.fontString="");for(var i in this.fontDef)this.fontDef[i]&&(e?e=!1:this.fontString+=" ",this.fontString+=this.fontDef[i])},R.Drawing.annotation.prototype.configs=["color","font"],R.Drawing.annotation.prototype.measure=function(){},R.Drawing.annotation.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);t.font=this.fontString,t.textBaseline="top";var r,n,s,o,l=i,h=a,c=this.w,u=this.h,p=this.setLineColor();this.stem&&(this.stem.d?(r=this.stx.pixelFromTick(this.stem.t),s=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v),n=l+c/2,o=h+u/2):this.stem.x&&(r=l,s=h,n=(l+=this.stem.x)+c/2,o=(h+=this.stem.y)+u/2),t.beginPath(),this.borderColor?t.strokeStyle=this.borderColor:t.strokeStyle=p,t.moveTo(r,s),t.lineTo(n,o),t.stroke()),this.highlighted?(this.stx.canvasColor("stx_annotation_highlight_bg",t),t.fillRect(l,h,c,u)):this.fillColor?(t.fillStyle=this.fillColor,t.fillRect(l,h,c,u)):this.stem&&(t.fillStyle=this.stx.containerColor,t.fillRect(l,h,c,u)),this.borderColor&&(t.beginPath(),t.strokeStyle=this.borderColor,t.rect(l,h,c,u),t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=p,h+=this.padding;for(var d=0;d<this.arr.length;d++)t.fillText(this.arr[d],l+this.padding,h),h+=this.fontSize;t.textBaseline="alphabetic"}},R.Drawing.annotation.prototype.onChange=function(t){},R.Drawing.annotation.prototype.edit=function(t){var e=this.stx.panels[this.panelName];if(e){var u=this.stx.controls.annotationSave,p=this.stx.controls.annotationCancel;if(u&&p){var i;this.stx.editingAnnotation=!0,this.stx.undisplayCrosshairs(),this.stx.openDialog="annotation",this.ta||(this.ta=document.createElement("TEXTAREA"),this.ta.className="stx_annotation",this.ta.onkeyup=d(this),this.ta.onmouseup=(i=this.stx,function(t){i.manageTouchAndMouse&&R.ChartEngine.drawingLine&&i.mouseup(t)}),this.ta.setAttribute("wrap","hard"),R.isIOS7or8&&this.ta.setAttribute("placeholder","Enter Text"),this.stx.chart.container.appendChild(this.ta),this.ta.style.position="absolute",this.ta.style.width="100px",this.ta.style.height="20px",(R.ipad||R.iphone)&&(this.ta.ontouchstart=function(t){t.stopPropagation()}));var a=this;if(this.ta.oninput=function(t){a.onChange(t)},this.ta.style.font=this.fontString,this.color)if("transparent"==this.color||"auto"==this.color){var r=getComputedStyle(this.ta);r&&R.isTransparent(r.backgroundColor)?this.ta.style.color=this.stx.defaultColor:this.ta.style.color="#000"}else this.ta.style.color=this.color;var n,s,o=this.stx.pixelFromTick(this.p0[0],e.chart),l=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);if(this.ta.style.left=o+140<this.stx.chart.canvasRight?o+"px":this.stx.chart.canvasRight-200+"px",this.ta.style.top=l+60<this.stx.chart.canvasHeight?l+"px":l-60+"px","callout"==this.name&&(this.ta.style.left=o-(isNaN(this.w)?this.defaultWidth:this.w/2)+"px",this.ta.style.top=l-(isNaN(this.h)?this.defaultHeight:this.h/2)+"px"),u.style.display="inline-block",p.style.display="inline-block",R.safeClickTouch(u,(n=this,function(t){""!==n.ta.value&&(n.stx.editingAnnotation=!1,n.text=n.ta.value,n.adjust(),n.stx.addDrawing(n),n.stx.changeOccurred("vector"),n.stx.undo(),n.stx.cancelTouchSingleClick=!0)})),R.safeClickTouch(p,(s=this,function(t){s.stx.editingAnnotation=!1,s.stx.undo(),s.stx.cancelTouchSingleClick=!0})),d(this)(),this.ta.focus(),R.isAndroid&&!R.is_chrome){this.priorBottom=this.stx.chart.container.style.bottom;var h=this.stx.resolveY(l)+100;if(h>R.pageHeight()-400){var c=400-(R.pageHeight()-h);this.stx.chart.container.style.bottom=c+"px"}}}}function d(c){return function(t){if(t)switch(window.event?event.keyCode:t.keyCode){case 27:return void c.stx.undo()}var e=c.stx,i=c.ta,a=i.value.split("\n"),r=0;e.chart.context.font=c.fontString;for(var n=0;n<a.length;n++){var s=e.chart.context.measureText(a[n]).width;r<s&&(r=s)}var o=(a.length+1)*(c.fontSize+3);r<50&&(r=50),i.style.width=r+30+"px",i.style.height=o+"px";var l=parseInt(R.stripPX(i.style.top),10),h=R.stripPX(i.style.left);r=i.clientWidth,o=i.clientHeight,h+r+100<c.stx.chart.canvasWidth?(u.style.top=l+"px",p.style.top=l+"px",u.style.left=h+r+10+"px",p.style.left=h+r+60+"px"):(l+o+30<c.stx.chart.canvasHeight?(u.style.top=l+o+10+"px",p.style.top=l+o+10+"px"):(u.style.top=l-35+"px",p.style.top=l-35+"px"),u.style.left=h+"px",p.style.left=h+50+"px")}}},R.Drawing.annotation.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.adjust(),this.edit(t),!1}},R.Drawing.annotation.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}},R.Drawing.annotation.prototype.intersected=function(t,e,i){var a=this.stx.panels[this.panelName];if(!this.p0)return null;var r=this.stx.pixelFromTick(this.p0[0],a.chart),n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),s=r+this.w,o=n+this.h;this.stem&&this.stem.x&&(r+=this.stem.x,s+=this.stem.x,n+=this.stem.y,o+=this.stem.y);var l=this.stx.pixelFromTick(t,a.chart),h=this.stx.pixelFromValueAdjusted(a,t,e);return r<=l&&l<=s&&n<=h&&h<=o&&(this.highlighted=!0,{p0:R.clone(this.p0),tick:t,value:e})},R.Drawing.annotation.prototype.abort=function(){var t=this.stx.controls.annotationSave,e=this.stx.controls.annotationCancel;t&&(t.style.display="none"),e&&(e.style.display="none"),this.ta&&this.stx.chart.container.removeChild(this.ta),this.ta=null,this.stx.openDialog="",this.stx.showCrosshairs(),this.stx.editingAnnotation=!1,R.clearCanvas(this.stx.chart.tempCanvas,this.stx),R.isAndroid&&!R.is_chrome&&(this.stx.chart.container.style.bottom=this.priorBottom),R.fixScreen()},R.Drawing.annotation.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.text=t.escapeOnSerialize?decodeURIComponent(e.text):e.text,this.stem=e.stem,this.borderColor=e.bc,this.fillColor=e.bg,this.lineWidth=e.lw,this.pattern=e.ptrn,this.font=R.replaceFields(e.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.font||(this.font={}),this.adjust()},R.Drawing.annotation.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,d0:this.d0,tzo0:this.tzo0,v0:this.v0,text:this.stx.escapeOnSerialize?encodeURIComponent(this.text):this.text};if(this.font){var e=R.removeNullValues(R.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}));R.isEmpty(e)||(t.fnt=e)}return this.stem&&(t.stem={d:this.stem.d,v:this.stem.v,x:this.stem.x,y:this.stem.y}),this.borderColor&&(t.bc=this.borderColor),this.fillColor&&(t.bg=this.fillColor),this.lineWidth&&(t.lw=this.lineWidth),this.pattern&&(t.ptrn=this.pattern),t},R.Drawing.annotation.prototype.renderText=function(){this.getFontString();var t=this.stx.panels[this.panelName];if(t){this.arr=this.text.split("\n");var e=0;this.stx.chart.context.font=this.fontString;for(var i=0;i<this.arr.length;i++){var a=this.stx.chart.context.measureText(this.arr[i]).width;e<a&&(e=a)}0===e&&(e=2*this.defaultWidth),this.fontSize=R.stripPX(this.fontDef.size);var r=this.arr.length*this.fontSize;R.touchDevice&&(r+=5),this.w=e+2*this.padding,this.h=r+2*this.padding;var n=this.stx.pixelFromTick(this.p0[0],t.chart)+e,s=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1])+r;this.p1=[this.stx.tickFromPixel(n,t.chart),this.stx.valueFromPixel(s,t)],this.stem&&this.stem.d&&(this.stem.t=this.stx.tickFromDate(this.stem.d,t.chart))}},R.Drawing.annotation.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.renderText())},R.Drawing.segment=function(){this.name="segment"},R.Drawing.segment.ciqInheritsFrom(R.Drawing.BaseTwoPoint),R.Drawing.segment.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=this.lineWidth,o=this.setLineColor(),l={pattern:this.pattern,lineWidth:s};if("none"==l.pattern&&(l.pattern="solid"),this.stx.plotLine(i,a,r,n,o,this.name,t,e,l),this.axisLabel&&!this.repositioner)if("horizontal"==this.name){this.stx.endClip();var h=this.p0[1];e.chart.transformFunc&&(h=e.chart.transformFunc(this.stx,e.chart,h)),h=e.yAxis.priceFormatter?e.yAxis.priceFormatter(this.stx,e,h):this.stx.formatYAxisPrice(h,e),this.stx.createYAxisLabel(e,h,r,o),this.stx.startClip(e.name)}else if("vertical"==this.name&&0<=this.p0[0]&&!this.stx.chart.xAxis.noDraw){var c,u;if(c=this.stx.dateFromTick(this.p0[0],e.chart,!0),R.ChartEngine.isDailyInterval(this.stx.layout.interval))c.setHours(0,0,0,0);else{var p=1e3*c.getSeconds()+c.getMilliseconds();this.stx.displayZone&&(u=new y.Date(c.getTime(),this.stx.displayZone),c=new Date(u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes()),c=new Date(c.getTime()+p))}var d=R.mmddhhmm(R.yyyymmddhhmm(c));if(e.chart.xAxis.formatter)d=e.chart.xAxis.formatter(c);else if(this.stx.internationalizer){var m;0!==c.getHours()||0!==c.getMinutes()?(m=this.stx.internationalizer.monthDay.format(c),m+=" "+this.stx.internationalizer.hourMinute.format(c)):m=this.stx.internationalizer.yearMonthDay.format(c),d=m}this.stx.endClip(),this.stx.createXAxisLabel(e,d,i,o,null,!0),this.stx.startClip(e.name)}if(this.highlighted&&"horizontal"!=this.name&&"vertical"!=this.name){var g="p0"==this.highlighted,f="p1"==this.highlighted;this.littleCircle(t,i,r,g),this.littleCircle(t,a,n,f)}}},R.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,!1)},R.Drawing.segment.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1)return null;var a=this.name;if("horizontal"!=a&&"vertical"!=a&&"gartley"!=a){var r={0:this.p0,1:this.p1};for(var n in r)if(this.pointIntersection(r[n][0],r[n][1],i))return this.highlighted="p"+n,{action:"drag",point:"p"+n}}return"horizontal"!=a&&"vertical"!=a||(a="line"),this.lineIntersection(t,e,i,a)?(this.highlighted=!0,{action:"move",p0:R.clone(this.p0),p1:R.clone(this.p1),tick:t,value:e}):null},R.Drawing.segment.prototype.configs=["color","lineWidth","pattern"],R.Drawing.segment.prototype.copyConfig=function(t){R.Drawing.copyConfig(this,t),"none"==this.pattern&&-1==this.configs.indexOf("fillColor")&&(this.pattern="solid")},R.Drawing.segment.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},R.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},R.Drawing.continuous=function(){this.name="continuous",this.dragToDraw=!1,this.maxSegments=null},R.Drawing.continuous.ciqInheritsFrom(R.Drawing.segment),R.Drawing.continuous.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,a.chart),!(this.penDown=!0);if(this.accidentalClick(e,i))return this.stx.undo(),!0;this.setPoint(1,e,i,a.chart);var r=new R.Drawing.segment,n=this.serialize(this.stx);return r.reconstruct(this.stx,n),this.stx.addDrawing(r),this.stx.changeOccurred("vector"),this.stx.draw(),this.segment++,!!(this.maxSegments&&this.segment>this.maxSegments)||(this.setPoint(0,e,i,a.chart),!1)}},R.Drawing.line=function(){this.name="line"},R.Drawing.line.prototype.dragToDraw=!1,R.Drawing.line.ciqInheritsFrom(R.Drawing.segment),R.Drawing.line.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!R.ChartEngine.isDailyInterval(this.stx.layout.interval)){var e={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]};e.x0>e.x1&&(e={x0:this.p1[0],y0:this.p1[1],x1:this.p0[0],y1:this.p0[1]});var i=e.x0-1e3,a=e.x1+1e3;this.v0B=R.yIntersection(e,i),this.v1B=R.yIntersection(e,a),this.d0B=this.stx.dateFromTick(i,t.chart),this.d1B=this.stx.dateFromTick(a,t.chart)}},R.Drawing.line.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.calculateOuterSet(a),!(this.penDown=!1)):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},R.Drawing.line.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.v1=e.v1,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,e.d0B&&(this.d0B=e.d0B,this.d1B=e.d1B,this.v0B=e.v0B,this.v1B=e.v1B),this.adjust()},R.Drawing.line.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return this.d0B&&(t.d0B=this.d0B,t.d1B=this.d1B,t.v0B=this.v0B,t.v1B=this.v1B),t},R.Drawing.line.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),R.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&(this.setPoint(0,this.d0B,this.v0B,t.chart),this.setPoint(1,this.d1B,this.v1B,t.chart)))},R.Drawing.ray=function(){this.name="ray"},R.Drawing.ray.ciqInheritsFrom(R.Drawing.line),R.Drawing.ray.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!R.ChartEngine.isDailyInterval(this.stx.layout.interval)){var e={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]},i=e.x1+1e3;e.x1<e.x0&&(i=e.x1-1e3),this.v0B=this.v0,this.v1B=R.yIntersection(e,i),this.d0B=this.d0,this.d1B=this.stx.dateFromTick(i,t.chart)}},R.Drawing.ray.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),R.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&this.setPoint(1,this.d1B,this.v1B,t.chart))},R.Drawing.horizontal=function(){this.name="horizontal"},R.Drawing.horizontal.prototype.dragToDraw=!1,R.Drawing.horizontal.ciqInheritsFrom(R.Drawing.segment),R.Drawing.horizontal.prototype.measure=function(){},R.Drawing.horizontal.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.setPoint(0,e,i,a.chart),!0},R.Drawing.horizontal.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.d0=e.d0,this.tzo0=e.tzo0,this.axisLabel=e.al,this.adjust()},R.Drawing.horizontal.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,v0:this.v0,d0:this.d0,tzo0:this.tzo0,al:this.axisLabel}},R.Drawing.horizontal.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0]+100,this.p0[1]])},R.Drawing.horizontal.prototype.configs=["color","lineWidth","pattern","axisLabel"],R.Drawing.vertical=function(){this.name="vertical"},R.Drawing.vertical.ciqInheritsFrom(R.Drawing.horizontal),R.Drawing.vertical.prototype.measure=function(){},R.Drawing.vertical.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0],this.p0[1]+1])},R.Drawing.measure=function(){this.name="measure"},R.Drawing.measure.ciqInheritsFrom(R.Drawing.segment),R.Drawing.measure.prototype.click=function(t,e,i){return this.copyConfig(),this.penDown?(this.stx.undo(),!(this.penDown=!1)):(this.p0=[e,i],!(this.penDown=!0))},R.Drawing.rectangle=function(){this.name="rectangle"},R.Drawing.rectangle.ciqInheritsFrom(R.Drawing.BaseTwoPoint),R.Drawing.rectangle.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=Math.round(Math.min(i,a))+.5,o=Math.min(r,n),l=Math.max(i,a)-s,h=Math.max(r,n)-o,c=this.color;this.highlighted&&(c=this.stx.getCanvasColor("stx_highlight_vector"));var u=this.fillColor;u&&!R.isTransparent(u)&&"auto"!=u&&(t.beginPath(),t.rect(s,o,l,h),t.fillStyle=u,t.globalAlpha=.2,t.fill(),t.closePath(),t.globalAlpha=1);var p={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&"none"==p.pattern&&(p.pattern="solid",.1==p.lineWidth&&(p.lineWidth=1)),this.stx.plotLine(i,a,r,r,c,"segment",t,e,p),this.stx.plotLine(a,a,r-.5,n+.5,c,"segment",t,e,p),this.stx.plotLine(a,i,n,n,c,"segment",t,e,p),this.stx.plotLine(i,i,n+.5,r-.5,c,"segment",t,e,p),this.highlighted){var d="p0"==this.highlighted,m="p1"==this.highlighted;this.littleCircle(t,i,r,d),this.littleCircle(t,a,n,m)}}},R.Drawing.rectangle.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1)return null;var a={0:this.p0,1:this.p1};for(var r in a)if(this.pointIntersection(a[r][0],a[r][1],i))return this.highlighted="p"+r,{action:"drag",point:"p"+r};return this.boxIntersection(t,e)?(this.highlighted=!0,{action:"move",p0:R.clone(this.p0),p1:R.clone(this.p1),tick:t,value:e}):null},R.Drawing.rectangle.prototype.configs=["color","fillColor","lineWidth","pattern"],R.Drawing.rectangle.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},R.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},R.Drawing.ellipse=function(){this.name="ellipse"},R.Drawing.ellipse.ciqInheritsFrom(R.Drawing.BaseTwoPoint),R.Drawing.ellipse.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=i-(a-i),o=a,l=r,h=n,c=r-(n-r),u=(h-c)/6,p=this.lineWidth;p||(p=1.1);var d=this.color;("auto"==d||R.isTransparent(d))&&(d=this.stx.defaultColor),this.highlighted&&(d=this.stx.getCanvasColor("stx_highlight_vector"),.1==p&&(p=1.1));var m=this.fillColor;if(t.beginPath(),t.moveTo(s,l),t.bezierCurveTo(s,h+u,o,h+u,o,l),t.bezierCurveTo(o,c-u,s,c-u,s,l),m&&!R.isTransparent(m)&&"auto"!=m&&(t.fillStyle=m,t.globalAlpha=.2,t.fill(),t.globalAlpha=1),d&&"none"!=this.pattern&&(t.strokeStyle=d,t.lineWidth=p,t.setLineDash&&(t.setLineDash(R.borderPatternToArray(p,this.pattern)),t.lineDashOffset=0),t.stroke()),t.closePath(),this.highlighted){var g="p1"==this.highlighted;this.littleCircle(t,a,n,g)}}},R.Drawing.ellipse.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p1[0],this.p1[1],i))return{action:"drag",point:this.highlighted="p1"};var a=this.p0[0]-(this.p1[0]-this.p0[0]),r=this.p1[0],n=this.p1[1],s=this.p0[1]-(this.p1[1]-this.p0[1]);return!(t>Math.max(a,r)||t<Math.min(a,r))&&!(e>Math.max(s,n)||e<Math.min(s,n))&&(this.highlighted=!0,{action:"move",p0:R.clone(this.p0),p1:R.clone(this.p1),tick:t,value:e})},R.Drawing.ellipse.prototype.configs=["color","fillColor","lineWidth","pattern"],R.Drawing.ellipse.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},R.Drawing.ellipse.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},R.Drawing.fibonacci=function(){this.name="fibonacci",this.configurator="fibonacci"},R.Drawing.fibonacci.ciqInheritsFrom(R.Drawing.BaseTwoPoint),R.Drawing.fibonacci.mapping={trend:"t",color:"c",parameters:"p",pattern:"pt",opacity:"o",lineWidth:"lw",level:"l",extendLeft:"e",printLevels:"pl",printValues:"pv",timezone:"tz",display:"d"},R.Drawing.fibonacci.prototype.recommendedLevels=[-.618,-.382,0,.382,.5,.618,1,1.382,1.618],R.Drawing.fibonacci.prototype.configs=["color","fillColor","lineWidth","pattern","parameters"],R.Drawing.fibonacci.prototype.initializeSettings=function(t){var e=this.recommendedLevels;if(e)for(var i=t.currentVectorParameters.fibonacci.fibs,a=0;a<i.length;a++){delete i[a].display;for(var r=0;r<e.length;r++)i[a].level==e[r]&&(i[a].display=!0)}},R.Drawing.fibonacci.prototype.setOuter=function(){var t=this.stx,e=t.panels[this.panelName];if(e){var i=Math.max(this.p0[1],this.p1[1]),a=Math.min(this.p0[1],this.p1[1]),r=i-a;this.outer={p0:R.clone(this.p0),p1:R.clone(this.p1)};for(var n=t.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),s=t.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),o=t.pixelFromTick(this.p0[0],e.chart),l=t.pixelFromTick(this.p1[0],e.chart),h=0,c=1,u=0;u<this.parameters.fibs.length;u++){var p=this.parameters.fibs[u];if(!(p.level>=h&&p.level<=c)&&p.display){var d=t.pixelFromValueAdjusted(e,this.p0[0],s<n?i-r*p.level:a+r*p.level),m=R.xIntersection({x0:o,x1:l,y0:n,y1:s},d);p.level<h?(h=p.level,this.outer.p1[1]=t.valueFromPixel(d,e),this.outer.p1[0]=t.tickFromPixel(m,e.chart)):p.level>c&&(c=p.level,this.outer.p0[1]=t.valueFromPixel(d,e),this.outer.p0[0]=t.tickFromPixel(m,e.chart))}}}},R.Drawing.fibonacci.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.setOuter(),this.parameters=R.clone(this.parameters),!(this.penDown=!1)):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},R.Drawing.fibonacci.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=e.yAxis;if(this.p1){var a=Math.max(this.p0[1],this.p1[1]),r=Math.min(this.p0[1],this.p1[1]),n=a-r,s=this.stx.pixelFromTick(this.p0[0],e.chart),o=this.stx.pixelFromTick(this.p1[0],e.chart),l=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),h=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),c=Math.min(h,l),u=Math.max(h,l),p=u-c,d=0<(h-l)/(o-s);this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var m=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var g=t.measureText("161.8%").width+10,f=Number.MAX_VALUE,y=Number.MAX_VALUE,v=-1*Number.MAX_VALUE,x=-1*Number.MAX_VALUE,C=this.color;("auto"==C||R.isTransparent(C))&&(C=this.stx.defaultColor),this.rays=[];for(var S=0;S<this.parameters.fibs.length;S++){t.textAlign="left",t.fillStyle=C;var b=this.parameters.fibs[S];if(b.display){var w=this.stx.pixelFromValueAdjusted(e,this.p0[0],h<l?a-n*b.level:r+n*b.level),T=R.xIntersection({x0:s,x1:o,y0:l,y1:h},w),D=this.parameters.extendLeft?0:T,A=e.left+e.width;if(this.parameters.printLevels){var M=Math.round(1e3*b.level)/10+"%";A-=g,this.parameters.printValues&&(t.fillStyle=C,this.stx.canvasFont("stx_yaxis",t)),A<D&&(t.textAlign="right"),t.fillText(M,A,w),A<D?A+=5:A-=5}if(this.parameters.printValues&&T<e.width){var k=this.stx.transformedPriceFromPixel(w,e);k=i.priceFormatter?i.priceFormatter(this.stx,e,k):this.stx.formatYAxisPrice(k,e),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(e,k,w,C,null,t),t==this.stx.chart.context&&this.stx.startClip(e.name)}var F=b.color;("auto"==F||R.isTransparent(F))&&(F=this.color),("auto"==F||R.isTransparent(F))&&(F=this.stx.defaultColor);var P=b.color;("auto"==P||R.isTransparent(P))&&(P=this.fillColor),("auto"==P||R.isTransparent(P))&&(P=this.stx.defaultColor),t.fillStyle=P;var _=R.clone(b.parameters);this.highlighted&&(_.opacity=1),this.stx.plotLine(D,A,w,w,this.highlighted?m:F,"segment",t,e,_),this.rays.push([[D,w],[A,w]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(A,w),t.lineTo(D,w),D?t.lineTo(o,h):t.lineTo(D,h),t.lineTo(A,h),void 0!==P&&t.fill(),t.globalAlpha=1,w<y&&(f=T,y=w),x<w&&(v=T,x=w)}}for(var N=0;N<=1;N++){var E=d?u-p*N:c+p*N;(E=Math.round(E))<y&&(f=R.xIntersection({x0:s,x1:o,y0:l,y1:h},E),y=E),x<E&&(v=R.xIntersection({x0:s,x1:o,y0:l,y1:h},E),x=E)}var L=R.clone(this.parameters.trend.parameters);if(this.highlighted&&(L.opacity=1),this.stx.plotLine(f,v,y,x,m,"segment",t,e,L),this.highlighted){var O="p0"==this.highlighted,I="p1"==this.highlighted;this.littleCircle(t,s,l,O),this.littleCircle(t,o,h,I)}}}},R.Drawing.fibonacci.prototype.reposition=function(t,e,i,a){e&&(R.Drawing.BaseTwoPoint.prototype.reposition.apply(this,arguments),this.adjust())},R.Drawing.fibonacci.prototype.intersected=function(t,e,i){var a=this.p0,r=this.p1;if(!a||!r)return null;var n={0:a,1:r};for(var s in n)if(this.pointIntersection(n[s][0],n[s][1],i))return this.highlighted="p"+s,{action:"drag",point:"p"+s};var o=this.outer,l=this.rays,h=o&&this.lineIntersection(t,e,i,"segment",o.p0,o.p1);if(!h)for(var c=0;c<l.length;c++)if(this.lineIntersection(t,e,i,"ray",l[c][0],l[c][1],!0)){h=!0;break}return h?(this.highlighted=!0,{action:"move",p0:R.clone(a),p1:R.clone(r),tick:t,value:e}):null},R.Drawing.fibonacci.prototype.reconstruct=function(t,e){e=R.replaceFields(e,R.reverseObject(R.Drawing.fibonacci.mapping)),this.stx=t,this.parameters=e.parameters,this.parameters||(this.parameters=R.clone(this.stx.currentVectorParameters.fibonacci)),this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},R.Drawing.fibonacci.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setOuter())},R.Drawing.fibonacci.prototype.serialize=function(){var t={name:this.name,parameters:this.parameters,pnl:this.panelName,col:this.color,fc:this.fillColor,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2};return R.replaceFields(t,R.Drawing.fibonacci.mapping)},R.Drawing.retracement=function(){this.name="retracement"},R.Drawing.retracement.ciqInheritsFrom(R.Drawing.fibonacci),R.Drawing.getDrawingToolList=function(t){var e={},i={ciqInheritsFrom:!0,stxInheritsFrom:!0,copyConfig:!0,getDrawingParameters:!0,getDrawingToolList:!0,initializeSettings:!0,restoreDefaultConfig:!0,saveConfig:!0,BaseTwoPoint:!0,shape:!0};for(var a in R.extend(i,t),R.Drawing)i[a]||(e[(new R.Drawing[a]).name]=a);return e},S=(m=t).CIQ,b=m.$$,S.I18N=function(){},S.I18N.hereDoc=function(t){return t.toString().replace(/^[^/]+\/\*!?/,"").replace(/\*\/[^/]+$/,"")},S.I18N.language="en",S.I18N.longMonths={zh:!0},S.I18N.reverseColorsByLocale={zh:!0,ja:!0},S.I18N.findAllTextNodes=function(t){if(t||(t=document.body),t==document.body&&!b("stashedTextNodes")){var e=document.createElement("div");e.id="stashedTextNodes",e.style.display="none",t.appendChild(e);for(var i=document.querySelectorAll("input,textarea,.editable_content"),a=0;a<i.length;a++){var r=i[a].getAttribute("placeholder");if(r){var n=e.appendChild(document.createElement("translate"));n.setAttribute("original",r),n.placeholderFor=i[a],n.appendChild(document.createTextNode(r))}}}for(var s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),o=s.nextNode(),l=new RegExp("^\\s*$"),h=new RegExp("\n|\t|\f","g"),c={},u={SCRIPT:!0,STYLE:!0,TEXTAREA:!0};o;){var p=o.nodeValue;if(!l.test(p)){var d=o.parentNode,m=d.tagName;if(!u[m]){if("TRANSLATE"!=m){var g=d.insertBefore(document.createElement("translate"),o);g.setAttribute("original",p),g.appendChild(o)}else p=d.getAttribute("original");h.test(p)&&(p=p.replace(h,"")),c[p]||(c[p]=[]),c[p].push(o)}}o=s.nextNode()}if(t==document.body){var f=S.Studies?S.Studies.studyLibrary:null;if(f)for(var y in f){null===c[y]&&(c[y]=[]);var v=f[y];if(v.inputs)for(var x in v.inputs)c[x]||(c[x]=[]);if(v.outputs)for(var C in v.outputs)c[C]||(c[C]=[])}}return c},S.I18N.missingWordList=function(t){t||(t=S.I18N.language);var e=S.I18N.findAllTextNodes(),i={},a=S.I18N.wordLists[t];a||(a={});var r,n,s=function(t){void 0===a[t]&&(i[t]="")};for(var o in e)s(o);if(!S.Studies||!S.Studies.studyLibrary)return i;for(var l in S.Studies.studyLibrary){for(var h in s((r=S.Studies.studyLibrary[l]).name),r.inputs)switch(s(h),n=r.inputs[h],Object.prototype.toString.call(n)){case"[object String]":s(n);break;case"[object Array]":for(var c=0;c<n.length;++c)s(n[c])}for(var u in r.outputs)s(u)}return s("Show Zones"),s("OverBought"),s("OverSold"),i},S.I18N.printableMissingWordList=function(t){var e=JSON.stringify(S.I18N.missingWordList(t));return e=e.replace(/","/g,'",\n"')},S.I18N.translateUI=function(t,e){if("pu"==t&&(t="pt"),S.I18N.wordLists){t||(t=S.I18N.language);var i=S.I18N.findAllTextNodes(e),a=S.I18N.wordLists[t];if(a)for(var r in i)for(var n=S.I18N.translateSections(r,a),s=i[r],o=0;o<s.length;o++){var l=s[o],h=l.parentNode,c=h.getAttribute("original");","!==n&&n||(n=c);var u=h.placeholderFor;u?u.placeholder=n:l.data=n}}},S.I18N.translate=function(t,e){if(e||(e=S.I18N.language),!S.I18N.wordLists)return console.log("Must include translations.js in order to use CIQ.I18N.translate()"),t;var i=S.I18N.wordLists[e],a=null;return i&&(a=S.I18N.translateSections(t,i)||t),","===a?t:a},S.I18N.translateSections=function(t,n){if("string"!=typeof t||-1==t.indexOf(""))return n[t];var e=(t=t.replace(/([(),])/g,"$1")).split("");return e.forEach(function(t,e,i){var a=t.match(/^(\s*).*\S(\s*)$/),r=n[t.trim()];r&&(a&&(r=a[1]+r+a[2]),i[e]=r)}),e.join("")},S.I18N.convertCSV=function(t){var e=new RegExp("[]|[]","g"),i=new RegExp('^(")|(")$',"g"),a=S.I18N.wordLists;t||(t=S.I18N.csv);for(var r=t.split("\n"),n=r[0].split(","),s=0;s<n.length;s++){var o=n[s];a[o]||(a[o]={})}for(var l=1;l<r.length;l++){var h=r[l].match(/(".*?"|[^",]+)(?=\s*,|\s*$)|(,(?=,))/g)||[],c=h[0];i.test(c)&&(c=c.replace(i,"")),e.test(c)&&(c=c.replace(e,'"'));for(var u=1;u<h.length;u++){var p=h[u];i.test(p)&&(p=p.replace(i,"")),a[n[u]][c]=p}}},S.I18N.setLanguage=function(t,e,i,a,r){"pu"==e&&(e="pt"),S.I18N.convertCSV(a),S.I18N.language=e,S.I18N.translateUI(e,r),i||(i=S.I18N.translate),t.translationCallback=i},S.I18N.setLocale=function(t,e,i,a,r){if(!Intl.__addLocaleData)return t.setLocale(e,r),void(i&&i(null));var n=(a=void 0===a?"locale-data/jsonp":a)+"/"+e+".js",s=document.createElement("SCRIPT");s.async=!0,s.src=n;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(s,o.nextSibling),s.onload=function(){t.setLocale(e,r),i&&i(null)},s.onerror=function(){i&&i("cannot load script")}},S.I18N.createMonthArrays=function(t,e,i){t.monthAbv=[],t.monthLetters=[];var a=new Date,r=!0;S.I18N.longMonths&&S.I18N.longMonths[i]&&(r=!1);for(var n=0;n<12;n++){a.setDate(1),a.setMonth(n);var s=e.format(a);if(r){for(var o="",l=0;l<s.length;l++){var h=s.charAt(l);h.charCodeAt(0)<65||(o+=h)}t.monthAbv[n]=o,t.monthLetters[n]=o[0]}else t.monthAbv[n]=s,t.monthLetters[n]=s}},S.I18N.localize=function(t,e){var i=t.locale,a=this.reverseColorsByLocale[e],r=this.reverseColorsByLocale[i];this.setLocale(t,e),this.setLanguage(t,e),a&&r||(a||r)&&this.reverseCandles(t)},S.I18N.reverseCandles=function(t){var e=t.styles,i=t.cloneStyle(e.stx_candle_down),a=t.cloneStyle(e.stx_candle_up);e.stx_candle_up=i,e.stx_candle_down=a},e(t),(M=t.CIQ).ChartEngine.prototype.makeMarkerHelper=function(){this.markerHelper={chartMap:{},classMap:{}}},M.ChartEngine.prototype.addToHolder=function(t){var e=this.panels[t.params.panelName];if(e){M.derivedFrom(t.params.node,M.Marker.NodeCreator)?(t.stxNodeCreator=t.params.node,t.node=t.stxNodeCreator.node):t.node=t.params.node,this.markerHelper||this.makeMarkerHelper(),t.params.chartContainer?this.container.appendChild(t.node):t.params.includeAxis?e.holder.appendChild(t.node):e.subholder.appendChild(t.node);var i=t.params.label;this.markers[i]||(this.markers[i]=[]),this.markers[i].push(t),t.chart=e.chart,this.markerHelper.chartMap[t.chart.name]||(this.markerHelper.chartMap[t.chart.name]={dataSetLength:0,markers:[]}),this.markerHelper.chartMap[t.chart.name].markers.push(t),t.className||console.log("Marker objects must have a member className");var a=this.markerHelper.classMap[t.className];a||(a=this.markerHelper.classMap[t.className]={}),a[t.params.panelName]||(a[t.params.panelName]=[]),a[t.params.panelName].push(t),this.setMarkerTick(t)}},M.ChartEngine.prototype.getMarkerArray=function(t,e){var i=[];for(var a in this.markers)for(var r=0;r<this.markers[a].length;r++){var n=this.markers[a][r];"panelName"==t?n.params.panelName==e&&i.push(n):"label"==t?a==e&&i.push(n):"all"==t&&i.push(n)}return i},M.ChartEngine.prototype.removeFromHolder=function(t){var e=this.panels[t.params.panelName];e&&(t.node.parentNode==e.holder?e.holder.removeChild(t.node):t.node.parentNode==e.subholder?e.subholder.removeChild(t.node):t.node.parentNode==this.container&&this.container.removeChild(t.node));var i=this.markers[t.params.label];if(i){var a;for(a=0;a<i.length;a++)if(i[a]===t){i.splice(a,1);break}var r=this.markerHelper.chartMap[t.chart.name];if(r)for(a=0;a<r.markers.length;a++)if(r.markers[a]===t){r.markers.splice(a,1);break}var n=this.markerHelper.classMap[t.className];if(n){var s=n[t.params.panelName];if(s)for(a=0;a<s.length;a++)if(s[a]===t){s.splice(a,1);break}}}},M.ChartEngine.prototype.moveMarkers=function(t,e){for(var i=this.getMarkerArray("panelName",t),a=0;a<i.length;a++)i[a].params.panelName=e;for(var r in this.markerHelper.classMap){var n=this.markerHelper.classMap[r][t];n&&(this.markerHelper.classMap[r][e]=n,delete this.markerHelper.classMap[r][t])}},M.ChartEngine.prototype.establishMarkerTicks=function(){this.markerHelper||this.makeMarkerHelper();var t=this.markerHelper.chartMap;for(var e in t){var i=t[e];if(i.dataSetLength!=this.charts[e].dataSet.length)for(var a=0;a<i.markers.length;a++)this.setMarkerTick(i.markers[a])}},M.ChartEngine.prototype.futureTickIfDisplayed=function(t){var e=t.chart;if(!(e.dataSet.length<1)){var i=e.xaxis[e.xaxis.length-1].DT;if(i=new Date(i.getTime()-6e4*this.timeZoneOffset),!(t.params.x>i))for(var a,r,n=e.maxTicks-e.dataSegment.length,s=e.dataSet.length+n,o=new Date(+e.dataSet[e.dataSet.length-1].DT),l=this.standardMarketIterator(o,null,e),h=t.params.x.getTime(),c=e.dataSet.length;c<s;c++){if(a=o.getTime(),(r=(o=l.next()).getTime())==h)return void(t.tick=c);if(h<r&&a<h)return void(t.tick=Math.max(c-1,0))}}},M.ChartEngine.prototype.setMarkerTick=function(t){var e=t.chart;if("master"==t.params.xPositioner&&t.params.x)t.tick=Math.floor(t.params.x/this.layout.periodicity);else if("date"==t.params.xPositioner&&t.params.x){for(var i,a,r=t.params.x.getTime(),n=0;n<e.dataSet.length;n++){if(i=a=e.dataSet[n].DT.getTime(),0<n&&(i=e.dataSet[n-1].DT.getTime()),a==r)return void(t.tick=n);if(r<a&&i<r)return void(t.tick=Math.max(n-1,0));if(r<a)return void(t.tick=null)}if(e.dataSet.length<1)return;new Date(+e.dataSet[n-1].DT).getTime()<r&&(t.params.future=!0),t.tick=null}},M.ChartEngine.prototype.positionMarkers=function(){var s=this;function t(){if(!s.runPrepend("positionMarkers",arguments)){for(var t in s.markerTimeout=null,s.markerHelper.classMap)for(var e in s.markerHelper.classMap[t]){var i=s.markerHelper.classMap[t][e],a=s.panels[e];if(i.length){var r={stx:s,arr:i,panel:a};r.firstTick=a.chart.dataSet.length-a.chart.scroll,r.lastTick=r.firstTick+a.chart.dataSegment.length;var n=i[0].constructor.placementFunction;n?n(r):s.defaultMarkerPlacement(r)}}s.runAppend("positionMarkers",arguments)}}s.markerHelper&&(this.markerDelay||0===this.markerDelay?this.markerTimeout||(this.markerTimeout=setTimeout(t,this.markerDelay)):t())},M.Marker=function(t){this.params={xPositioner:"date",yPositioner:"value",panelName:"chart",permanent:!1,label:"generic",includeAxis:!1},M.extend(this.params,t),this.params.node||(this.params.node=document.createElement("DIV")),this.params.stx?(this.className||(this.className="CIQ.Marker"),this.params.stx.addToHolder(this)):console.log("Marker created without specifying stx")},M.Marker.prototype.remove=function(){this.params.stx.removeFromHolder(this)},M.Marker.prototype.render=function(){var t=[this],e={stx:this.params.stx,arr:t,panel:this.params.stx.panels[this.params.panelName],showClass:this.showClass};this.constructor.placementFunction(e)},M.Marker.removeByLabel=function(t,e){for(var i=t.getMarkerArray("label",e),a=0;a<i.length;a++)t.removeFromHolder(i[a])},M.Marker.positionContentVerticalAndHorizontal=function(t){var e=t.querySelectorAll(".stx-marker-expand")[0];if(e){var i=e.offsetWidth,a=e.offsetHeight;if(!i||!a)return;var r=e.style;r.left=r.right="",r.bottom=r.top="";var n=getComputedStyle(e).left,s=getComputedStyle(e).bottom,o=getComputedStyle(e).height,l=t.offsetLeft+parseInt(n,10),h=parseInt(s,10),c=parseInt(o,10),u=t.offsetTop+h-c,p=t.parentNode.offsetWidth,d=t.parentNode.offsetHeight;p<l+i&&(r.right=n,r.left="auto"),t.offsetTop-c<d&&(t.offsetTop-t.offsetHeight<0?(r.top=s,r.bottom="auto"):d<u+a&&(r.top="auto",r.bottom=3*h+"px"))}},M.ChartEngine.prototype.getBarBounds=function(t){var e;return this.layout.chartType,e="pandf"==this.layout.aggregationType?{high:Math.max(t.pfOpen,t.pfClose),low:Math.min(t.pfOpen,t.pfClose)}:{high:t.High,low:t.Low},t.markerHigh&&(e.high=markerHigh),t.markerLow&&(e.low=markerLow),e},M.ChartEngine.prototype.defaultMarkerPlacement=function(t){var e=t.panel,i=t.yAxis?t.yAxis:t.panel.yAxis,a=e.chart,r=t.stx,n=r.chart.highLowBars||r.highLowBars[r.layout.chartType],s=a.defaultPlotField;s&&!n||(s="Close");for(var o={},l=0;l<t.arr.length;l++){var h=t.arr[l],c=h.params,u=h.node;h.clientWidth||(h.clientWidth=u.clientWidth),h.clientHeight||(h.clientHeight=u.clientHeight);var p=null,d=c.xPositioner,m=c.yPositioner,g=h.tick,f=a.dataSet,y=h.clientWidth;if("none"!=d){if("bar"==d&&c.x){if(c.x<a.xaxis.length){var v=a.xaxis[c.x];v&&(p=v.data)}u.style.left=Math.round(r.pixelFromBar(c.x,a)-y/2)+1+"px"}else{if(!g&&0!==g){if(!(c.future&&a.scroll<a.maxTicks)){u.style.left="-1000px";continue}if(r.futureTickIfDisplayed(h),!(g=h.tick)&&0!==g){u.style.left="-1000px";continue}}if(g<f.length&&(p=f[g]),h.leftpx=Math.round(r.pixelFromTick(g,a)-a.left-y/2),h.rightEdge=h.leftpx+y,u.style.left=h.leftpx+"px",g<t.firstTick&&h.rightEdge<a.left-50)continue}p||(p=f[f.length-1])}else if(-1<m.indexOf("candle")&&(left=getComputedStyle(u).left,left)){var x=r.barFromPixel(parseInt(left,10),a);0<=x&&((p=a.xaxis[x].data)||(p=f[f.length-1]))}var C,S=c.y,b=u.clientHeight;if("none"!=m){var w,T=m+"-"+u.style.left,D=c.chartContainer?r.height:e.yAxis.bottom,A=0;void 0===o[T]&&(o[T]=0),w=o[T],o[T]+=b,"value"==m&&S?A=Math.round(D-r.pixelFromPrice(S,e,i)-b/2)+"px":"under_candle"==m&&p?(C=p[s],n&&(C=r.getBarBounds(p).low),A=Math.round(D-r.pixelFromPrice(C,e,i)-b-w)+"px"):"on_candle"==m&&p?(C=p[s],n&&(C=(p.Low+p.High)/2),A=Math.round(D-r.pixelFromPrice(C,e,i)-b/2-w)+"px"):"top"==m?A=Math.round(D-b-w)+"px":"bottom"==m?A=Math.round(w)+"px":p&&(C=p[s],n&&(C=r.getBarBounds(p).high),A=Math.round(D-r.pixelFromPrice(C,e,i)+w)+"px"),u.style.bottom!=A&&(u.style.bottom=A)}M.Marker.positionContentVerticalAndHorizontal(u)}},M.Marker.NodeCreator=function(){},M.Marker.NodeCreator.toNode=function(){return this.node},M.Marker.Simple=function(t){var e=this.node=document.createElement("div");e.className="stx-marker",M.appendClassName(e,t.type),t.category&&M.appendClassName(e,t.category);var i,a=M.newChild(e,"div","stx-visual");if(M.newChild(e,"div","stx-stem"),"callout"==t.type){var r=M.newChild(a,"div","stx-marker-content");M.newChild(r,"h4",null,t.headline),i=M.newChild(r,"div","stx-marker-expand"),M.newChild(i,"p",null,t.story)}else i=M.newChild(e,"div","stx-marker-expand"),M.newChild(i,"h4",null,t.headline),M.newChild(i,"p",null,t.story),M.safeClickTouch(i,function(t){M.toggleClassName(e,"highlight")});function n(){M.Marker.positionContentVerticalAndHorizontal(e)}M.safeClickTouch(a,function(t){M.toggleClassName(e,"highlight"),setTimeout(n,10)})},M.Marker.Simple.ciqInheritsFrom(M.Marker.NodeCreator,!1),r(t),_=(g=t).CIQ,f=g.timezoneJS,_.Drawing.channel=function(){this.name="channel",this.dragToDraw=!1,this.p2=null},_.Drawing.channel.ciqInheritsFrom(_.Drawing.segment),_.Drawing.channel.prototype.configs=["color","fillColor","lineWidth","pattern"],_.Drawing.channel.prototype.move=function(t,e,i){if(this.penDown){if(this.copyConfig(),null===this.p2)this.p1=[e,i];else{var a=i-(this.p1[1]-this.p0[1])/(this.p1[0]-this.p0[0])*(e-this.p1[0]);this.p2=[this.p1[0],a]}this.render(t)}},_.Drawing.channel.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],a.chart),!(this.penDown=!1)):(this.setPoint(1,e,i,a.chart),this.p0[0]==this.p1[0]?this.p1=null:this.p2=[this.p1[0],this.p1[1]],!1):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},_.Drawing.channel.prototype.boxIntersection=function(t,e){return!!(this.p0&&this.p1&&this.p2)&&!(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))&&((this.p1[0]-this.p0[0])*(e-this.p0[1])-(this.p1[1]-this.p0[1])*(t-this.p0[0]))*((this.p2[0]-this.p0[0])*(e-(this.p0[1]+this.p2[1]-this.p1[1]))-(this.p1[1]-this.p0[1])*(t-this.p0[0]))<0},_.Drawing.channel.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1||!this.p2)return null;var a={0:this.p0,1:this.p1,2:this.p2};for(var r in a)if(this.pointIntersection(a[r][0],a[r][1],i))return this.highlighted="p"+r,{action:"drag",point:"p"+r};return this.boxIntersection(t,e)?(this.highlighted=!0,{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),p2:_.clone(this.p2),tick:t,value:e}):null},_.Drawing.channel.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=null;this.p2&&(s=this.stx.pixelFromValueAdjusted(e,this.p2[0],this.p2[1]));var o=this.lineWidth,l=this.setLineColor(),h=this.fillColor;this.p2&&h&&!_.isTransparent(h)&&"auto"!=h&&(t.beginPath(),t.moveTo(i,r),t.lineTo(a,n),t.lineTo(a,s),t.lineTo(i,r+(s-n)),t.closePath(),t.globalAlpha=.2,t.fillStyle=h,t.fill(),t.globalAlpha=1);var c={pattern:this.pattern,lineWidth:o};if((this.penDown||this.highlighted)&&"none"==this.pattern&&(c.pattern="dotted"),this.stx.plotLine(i,a,r,n,l,"segment",t,e,c),this.p2&&this.stx.plotLine(i,a,r+(s-n),s,l,"segment",t,e,c),this.highlighted){var u="p0"==this.highlighted,p="p1"==this.highlighted,d="p2"==this.highlighted;this.littleCircle(t,i,r,u),this.littleCircle(t,a,n,p),this.littleCircle(t,a,s,d)}}},_.Drawing.channel.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.setPoint(2,e.p2[0]-n,e.p2[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},_.Drawing.channel.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d1,this.v2,t.chart))},_.Drawing.channel.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},_.Drawing.channel.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,v2:this.v2}},_.Drawing.pitchfork=function(){this.name="pitchfork",this.dragToDraw=!1,this.p2=null},_.Drawing.pitchfork.ciqInheritsFrom(_.Drawing.channel),_.Drawing.pitchfork.prototype.configs=["color","lineWidth","pattern"],_.Drawing.pitchfork.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},_.Drawing.pitchfork.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1||!this.p2)return null;var a={0:this.p0,1:this.p1,2:this.p2};for(var r in a)if(this.pointIntersection(a[r][0],a[r][1],i))return this.highlighted="p"+r,{action:"drag",point:"p"+r};for(var n=this.rays,s=0;s<n.length;s++)if(this.lineIntersection(t,e,i,s?"ray":"segment",n[s][0],n[s][1],!0))return this.highlighted=!0,{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),p2:_.clone(this.p2),tick:t,value:e};return null},_.Drawing.pitchfork.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx,a=this.p2;a||(a=this.p1);var r=i.pixelFromTick(this.p0[0],e.chart),n=i.pixelFromTick(this.p1[0],e.chart),s=i.pixelFromTick(a[0],e.chart),o=i.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),l=i.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),h=i.pixelFromValueAdjusted(e,a[0],a[1]),c=this.lineWidth,u=this.setLineColor(),p={pattern:this.pattern,lineWidth:c},d=50,m=2*o-l-h,g=2*r-n-s;g<0&&(d*=-1),m*=d/g,this.rays=[[[n,l],[s,h]],[[r,o],[(n+s)/2,(l+h)/2]]],n==s&&l==h||this.rays.push([[n,l],[n-d,l-m]],[[s,h],[s-d,h-m]]);for(var f=0;f<this.rays.length;f++){var y=this.rays[f],v=f?"ray":"segment";i.plotLine(y[0][0],y[1][0],y[0][1],y[1][1],u,v,t,e,p)}if(this.highlighted){var x="p0"==this.highlighted,C="p1"==this.highlighted,S="p2"==this.highlighted;this.littleCircle(t,r,o,x),this.littleCircle(t,n,l,C),this.littleCircle(t,s,h,S)}}},_.Drawing.pitchfork.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},_.Drawing.pitchfork.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},_.Drawing.pitchfork.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2}},_.Drawing.gartley=function(){this.name="gartley",this.dragToDraw=!1,this.maxSegments=4,this.shape=null,this.points=[]},_.Drawing.gartley.ciqInheritsFrom(_.Drawing.continuous),_.Drawing.gartley.prototype.check=function(t,e){if(!e)return!0;if(t[0]>=e[0]||t[1]==e[1])return!1;if(1==this.segment)t[1]<e[1]?this.shape="M":this.shape="W";else if(2==this.segment){if("M"==this.shape&&t[1]<e[1])return!1;if("W"==this.shape&&t[1]>e[1])return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])<.618)return!1;if(.786<=(e[1]-t[1])/(this.points[0][1]-t[1]))return!1}else if(3==this.segment){if("M"==this.shape&&t[1]>e[1])return!1;if("W"==this.shape&&t[1]<e[1])return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])<.618)return!1;if(.786<=(e[1]-t[1])/(this.points[1][1]-t[1]))return!1}else if(4==this.segment){if("M"==this.shape&&(t[1]<e[1]||e[1]<this.points[0][1]))return!1;if("W"==this.shape&&(t[1]>e[1]||e[1]>this.points[0][1]))return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])<1.27)return!1;if(1.618<=(this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1]))return!1}return!0},_.Drawing.gartley.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,a.chart),this.pts=[],this.penDown=!0,!(this.segment=1);if(this.accidentalClick(e,i))return!(this.penDown=!0);if(this.check(this.p0,this.p1)){if(1==this.segment&&this.points.push(this.p0),this.points.push(this.p1),this.drawDropZones=!0,this.setPoint(1,e,i,a.chart),this.segment++,this.segment>this.maxSegments)return this.setPoint(0,this.points[0][0],this.points[0][1],a.chart),!(this.penDown=!1);this.pts.push(this.d1,this.tzo1,this.v1),this.setPoint(0,e,i,a.chart)}return!1}},_.Drawing.gartley.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]);if(2==this.segment)this.drawDropZone(t,.618*this.points[0][1]+.382*this.p0[1],.786*this.points[0][1]+.214*this.p0[1],this.p0[0]);else if(3==this.segment)this.drawDropZone(t,.618*this.points[1][1]+.382*this.p0[1],.786*this.points[1][1]+.214*this.p0[1],this.p0[0]);else if(4==this.segment){var s=1.618*this.points[2][1]-.618*this.points[1][1];s="M"==this.shape?Math.max(s,this.points[0][1]):Math.min(s,this.points[0][1]),this.drawDropZone(t,s,1.27*this.points[2][1]-.27*this.points[1][1],this.p0[0])}var o=this.lineWidth,l=this.setLineColor(),h={pattern:this.pattern,lineWidth:o};(this.penDown||this.highlighted)&&"none"==this.pattern&&(h.pattern="dotted"),this.segment<=this.maxSegments&&this.stx.plotLine(i,a,r,n,l,this.name,t,e,h);var c=this.fillColor,u=[];if(this.points.length){t.beginPath();for(var p=1;p<this.points.length&&p<=4;p++){var d=this.stx.pixelFromTick(this.points[p-1][0],e.chart),m=this.stx.pixelFromTick(this.points[p][0],e.chart),g=this.stx.pixelFromValueAdjusted(e,this.points[p-1][0],this.points[p-1][1]),f=this.stx.pixelFromValueAdjusted(e,this.points[p][0],this.points[p][1]);1==p&&u.push(d,g),u.push(m,f),this.stx.plotLine(d,m,g,f,l,this.name,t,e,h)}if(2!=this.points.length&&4!=this.points.length||u.push(a,n),this.points[2]&&u.push(this.stx.pixelFromTick(this.points[2][0],e.chart),this.stx.pixelFromValueAdjusted(e,this.points[2][0],this.points[2][1])),c&&"auto"!=c&&!_.isTransparent(c)){for(var y=0;y<u.length;y+=2)0===y&&t.moveTo(u[0],u[1]),t.lineTo(u[y],u[y+1]);t.fillStyle=c,t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}}}},_.Drawing.gartley.prototype.lineIntersection=function(t,e,i,a){var r=this.points,n=this.stx.panels[this.panelName];if(r.length!=this.maxSegments+1||!n)return!1;for(var s=0;s<r.length-1;s++)if(_.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,e,i,"segment",r[s],r[s+1]))return!0;return!1},_.Drawing.gartley.prototype.boxIntersection=function(t,e){if(!this.p0||!this.p1)return!1;if(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))return!1;for(var i=Math.min(this.p0[1],this.p1[1]),a=Math.max(this.p0[1],this.p1[1]),r=0;r<this.points.length;r++)i=Math.min(i,this.points[r][1]),a=Math.max(a,this.points[r][1]);return!(a<e||e<i)},_.Drawing.gartley.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i;e.tick=i;var s=e.value-a;if(e.value=a,"move"==e.action){this.pts=[];for(var o=0;o<this.points.length;o++)this.points[o][0]-=n,this.points[o][1]-=s,this.setPoint(1,this.points[o][0],this.points[o][1],r.chart),o&&o<this.points.length-1&&this.pts.push(this.d1,this.tzo1,this.v1),this.points[o]=this.p1;this.setPoint(0,this.points[0][0],this.points[0][1],r.chart),this.render(t)}}},_.Drawing.gartley.prototype.configs=["color","fillColor","lineWidth","pattern"],_.Drawing.gartley.prototype.drawDropZone=function(t,e,i,a){var r=this.stx.panels[this.panelName];if(r){var n=this.stx.pixelFromPrice(e,r),s=this.stx.pixelFromPrice(i,r)-n,o=this.stx.pixelFromTick(a,r.chart),l=r.width-o;t.fillStyle="#008000",t.globalAlpha=.2,t.fillRect(o,n,l,s),t.globalAlpha=1}},_.Drawing.gartley.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.reconstructPoints(),this.setPoint(0,this.d0,this.v0,t.chart),this.points.unshift(this.p0),this.setPoint(1,this.d1,this.v1,t.chart),this.points.push(this.p1))},_.Drawing.gartley.prototype.reconstructPoints=function(){var t=this.stx.panels[this.panelName];if(t){this.points=[];for(var e=0;e<this.pts.length;e+=3){var i=_.strToDateTime(this.pts[e]);i.setMinutes(i.getMinutes()+Number(this.pts[e+1])-i.getTimezoneOffset()),this.points.push([this.stx.tickFromDate(_.yyyymmddhhmmssmmm(i),t.chart),this.pts[e+2]])}}},_.Drawing.gartley.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.pts=e.pts.split(","),this.adjust()},_.Drawing.gartley.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,pts:this.pts.join(",")}},_.Drawing.freeform=function(){this.name="freeform",this.splineTension=.3,this.dragToDraw=!0},_.Drawing.freeform.ciqInheritsFrom(_.Drawing.segment),_.Drawing.freeform.prototype.measure=function(){},_.Drawing.freeform.prototype.intersected=function(t,e,i){return t>this.hiX||t<this.lowX?null:e>this.hiY||e<this.lowY?null:(this.highlighted=!0,{action:"move",p0:_.clone(this.p0),tick:t,value:e})},_.Drawing.freeform.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action&&(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.adjust(),this.render(t))}},_.Drawing.freeform.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(!1!==this.penDown)return this.penDown=!1,this.splineTension=this.tempSplineTension,document.body.style.cursor="auto",!0;this.copyConfig(),this.startX=Math.round(this.stx.resolveX(this.stx.pixelFromTick(e,a.chart))),this.startY=Math.round(this.stx.resolveY(this.stx.pixelFromValueAdjusted(a,e,i)));var r=this.stx.dateFromTick(e,a.chart,!0);return this.d0=_.yyyymmddhhmmssmmm(r),this.tzo0=r.getTimezoneOffset(),this.v0=i,this.p0=[_.ChartEngine.crosshairX-this.startX,_.ChartEngine.crosshairY-this.startY],this.nodes=[this.p0[0],this.p0[1]],this.pNodes=[this.p0],this.candleWidth=this.stx.layout.candleWidth,this.multiplier=a.yAxis.multiplier,this.interval=this.stx.layout.interval,this.periodicity=this.stx.layout.periodicity,this.tempSplineTension=this.splineTension,this.splineTension=-1,document.body.style.cursor="pointer",!(this.penDown=!0)}},_.Drawing.freeform.prototype.move=function(t,e,i){if(this.penDown){var a=this.stx.panels[this.panelName],r=this.stx.dateFromTick(e,a.chart,!0);return this.d1=_.yyyymmddhhmmssmmm(r),this.tzo1=r.getTimezoneOffset(),this.v1=i,this.p1=[_.ChartEngine.crosshairX-this.startX,_.ChartEngine.crosshairY-this.startY],2<this.pNodes.length&&(this.p1[0]==this.pNodes[this.pNodes.length-2][0]&&this.p1[0]==this.pNodes[this.pNodes.length-1][0]?(this.pNodes.length--,this.nodes.length-=2):this.p1[1]==this.pNodes[this.pNodes.length-2][1]&&this.p1[1]==this.pNodes[this.pNodes.length-1][1]&&(this.pNodes.length--,this.nodes.length-=2)),this.nodes.push(this.p1[0],this.p1[1]),this.pNodes.push(this.p1),this.render(t),!1}},_.Drawing.freeform.prototype.intervalRatio=function(t,e,i,a,r,n){function s(t,e){return _.Market.Symbology.isForexSymbol(e)?1440:390}var o=0;return t==e?o=1:isNaN(t)||isNaN(e)?isNaN(t)?"month"==t?"week"==e?o=5:"day"==e?o=30:isNaN(e)||(o=30*s(0,n)/e):"week"==t?("month"==e&&(o=.2),"day"==e?o=5:isNaN(e)||(o=5*s(0,n)/e)):"day"==t&&("week"==e?o=.2:"month"==e?o=1/30:isNaN(e)||(o=s(0,n)/e)):isNaN(t)||("month"==e?o=t/(30*s(0,n)):"week"==e?o=t/(5*s(0,n)):"day"==e&&(o=t/s(0,n))):o=t/e,o*=i/a},_.Drawing.freeform.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,e.chart.symbol);if(0!==i){var a=this.stx.layout.candleWidth/this.candleWidth,r=e.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,e.chart);for(var n=this.stx.pixelFromTick(this.p0[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=[],l=this.lineWidth,h=this.setLineColor(),c={pattern:this.pattern,lineWidth:l},u=0;u<this.pNodes.length;u++){var p=i*a*this.pNodes[u][0]+n,d=r*this.pNodes[u][1]+s;o.push(p,d)}o.length&&(this.splineTension<0?this.stx.connectTheDots(o,h,this.name,t,e,c):this.stx.plotSpline(o,this.splineTension,h,this.name,t,!0,c))}}},_.Drawing.freeform.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var e=[this.nodes[0],this.nodes[1]];this.pNodes=[e],this.lowX=this.nodes[0],this.hiX=this.nodes[0],this.lowY=this.nodes[1],this.hiY=this.nodes[1];for(var i=2;i<this.nodes.length;i+=2){var a=[this.nodes[i],this.nodes[i+1]];this.pNodes.push(a),this.lowX=Math.min(this.lowX,a[0]),this.hiX=Math.max(this.hiX,a[0]),this.lowY=Math.max(this.lowY,a[1]),this.hiY=Math.min(this.hiY,a[1])}var r=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,t.chart.symbol);if(0!==r){var n=this.stx.layout.candleWidth/this.candleWidth,s=t.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,t.chart);var o=this.stx.pixelFromTick(this.p0[0],t.chart),l=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]);this.lowX=this.stx.tickFromPixel(Math.floor(r*n*this.lowX)+o,t.chart),this.hiX=this.stx.tickFromPixel(Math.ceil(r*n*this.hiX)+o,t.chart),this.lowY=this.stx.valueFromPixel(Math.floor(s*this.lowY)+l,t),this.hiY=this.stx.valueFromPixel(Math.ceil(s*this.hiY)+l,t)}}},_.Drawing.freeform.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,cw:Number(this.candleWidth.toFixed(4)),mlt:Number(this.multiplier.toFixed(4)),d0:this.d0,tzo0:this.tzo0,v0:this.v0,inter:this.interval,pd:this.periodicity,nodes:this.nodes}},_.Drawing.freeform.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.candleWidth=e.cw,this.multiplier=e.mlt,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.interval=e.inter,this.periodicity=e.pd,this.nodes=e.nodes,this.adjust()},_.Drawing.callout=function(){this.name="callout",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={},this.stemEntry="",this.defaultWidth=50,this.defaultHeight=10},_.Drawing.callout.ciqInheritsFrom(_.Drawing.annotation),_.Drawing.callout.prototype.configs=["color","fillColor","lineWidth","pattern","font"],_.Drawing.callout.prototype.copyConfig=function(t){_.Drawing.copyConfig(this,t),this.borderColor=this.color},_.Drawing.callout.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p0=[e,i],this.render(t))},_.Drawing.callout.prototype.onChange=function(t){if(this.stx.panels[this.panelName]){var e=t.target;this.w=e.clientWidth,this.h=e.clientHeight;var i=this.context||this.stx.chart.tempCanvas.context;_.clearCanvas(i.canvas,this.stx),this.render(i),this.edit(i)}},_.Drawing.callout.prototype.render=function(t){this.context=t;var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);if(!isNaN(a)){t.font=this.fontString,t.textBaseline="top";var r=i,n=a,s=this.w/2,o=this.h/2;this.penDown&&(s=this.defaultWidth,(o=this.defaultHeight)||(o=this.fontSize));var l=this.lineWidth;l||(l=1.1);var h=this.color;("auto"==h||_.isTransparent(h))&&(h=this.stx.defaultColor);var c,u,p,d,m=this.borderColor;("auto"==m||_.isTransparent(m))&&(m=this.stx.defaultColor),this.highlighted&&(m=this.stx.getCanvasColor("stx_highlight_vector"));var g=Math.min(Math.min(s,o)/2,8);if(this.stem){this.stem.t?(c=this.stx.pixelFromTick(this.stem.t),p=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v)):this.stem.x&&(c=r,p=n,r+=this.stem.x,n+=this.stem.y);var f="";r+s<=c?(u=r+s,f="r"):r-s<c&&c<r+s?(u=r,f="c"):c<=r-s&&(u=r-s,f="l"),n+o<=p?(d=n+o,f+="b"):n-o<p&&p<n+o?(d=n,f+="m"):p<=n-o&&(d=n-o,f+="t"),"cm"!=(this.stemEntry=f)&&(c=Math.round(c),u=Math.round(u),p=Math.round(p),d=Math.round(d))}this.highlighted?this.stx.canvasColor("stx_annotation_highlight_bg",t):this.fillColor?(t.fillStyle=this.fillColor,t.globalAlpha=.4):this.stem&&(t.fillStyle=this.stx.containerColor),t.strokeStyle=m,t.setLineDash&&(t.setLineDash(_.borderPatternToArray(l,this.pattern)),t.lineDashOffset=0),m&&(t.beginPath(),t.lineWidth=l,t.moveTo(r+s-g,n-o),"rt"!=this.stemEntry?t.quadraticCurveTo(r+s,n-o,r+s,n-o+g):(t.lineTo(c,p),t.lineTo(r+s,n-o+g)),t.lineTo(r+s,n-g/2),"rm"==this.stemEntry&&t.lineTo(c,p),t.lineTo(r+s,n+g/2),t.lineTo(r+s,n+o-g),"rb"!=this.stemEntry?t.quadraticCurveTo(r+s,n+o,r+s-g,n+o):(t.lineTo(c,p),t.lineTo(r+s-g,n+o)),t.lineTo(r+g/2,n+o),"cb"==this.stemEntry&&t.lineTo(c,p),t.lineTo(r-g/2,n+o),t.lineTo(r-s+g,n+o),"lb"!=this.stemEntry?t.quadraticCurveTo(r-s,n+o,r-s,n+o-g):(t.lineTo(c,p),t.lineTo(r-s,n+o-g)),t.lineTo(r-s,n+g/2),"lm"==this.stemEntry&&t.lineTo(c,p),t.lineTo(r-s,n-g/2),t.lineTo(r-s,n-o+g),"lt"!=this.stemEntry?t.quadraticCurveTo(r-s,n-o,r-s+g,n-o):(t.lineTo(c,p),t.lineTo(r-s+g,n-o)),t.lineTo(r-g/2,n-o),"ct"==this.stemEntry&&t.lineTo(c,p),t.lineTo(r+g/2,n-o),t.lineTo(r+s-g,n-o),t.fill(),t.globalAlpha=1,"none"!=this.pattern&&t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=h,n+=this.padding;for(var y=0;y<this.arr.length;y++)t.fillText(this.arr[y],r-s+this.padding,n-o),n+=this.fontSize;if(t.textBaseline="alphabetic",this.highlighted&&!this.noHandles){var v="p0"==this.highlighted;this.littleCircle(t,c,p,v)}}}},_.Drawing.callout.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.penDown?(this.adjust(),this.edit(t),this.penDown=!1):(this.stem={d:this.d0,v:this.v0},this.penDown=!0,this.adjust(),!1)}},_.Drawing.callout.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;e.stem?("drag"==e.action?this.stem={d:this.stx.dateFromTick(i,r.chart,!0),v:a}:"move"==e.action&&(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.stem={d:this.stx.dateFromTick(this.stx.tickFromDate(e.stem.d,r.chart)-n),v:e.stem.v-s}),this.adjust()):this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}},_.Drawing.callout.prototype.lineIntersection=function(t,e,i,a){var r=this.stx.panels[this.panelName],n=this.stem,s=this.p0,o=this.stx;if(!s||!n||!r)return!1;var l=n.t||this.stx.tickFromDate(n.d,r.chart),h={x0:s[0],x1:l,y0:s[1],y1:n.v},c=_.convertBoxToPixels(o,this.panelName,h),u=c.x0,p=c.y0,d=c.x1,m=c.y1;"string"==typeof this.stemEntry&&(-1<this.stemEntry.indexOf("l")?u-=this.w/2:-1<this.stemEntry.indexOf("r")&&(u+=this.w/2),-1<this.stemEntry.indexOf("t")?p-=this.h/2:-1<this.stemEntry.indexOf("b")&&(p+=this.h/2));var g=_.convertBoxToPixels(o,this.panelName,i);return _.boxIntersects(g.x0,g.y0,g.x1,g.y1,u,p,d,m,a)},_.Drawing.callout.prototype.intersected=function(t,e,i){var a=this.stx.panels[this.panelName];if(!this.p0)return null;if(this.pointIntersection(this.stem.t,this.stem.v,i))return this.highlighted="p0",{action:"drag",stem:!0};var r=this.stx.pixelFromTick(this.p0[0],a.chart)-this.w/2,n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1])-this.h/2,s=r+this.w,o=n+this.h;this.stem&&this.stem.x&&(r+=this.stem.x,s+=this.stem.x,n+=this.stem.y,o+=this.stem.y);var l=this.stx.pixelFromTick(t,a.chart),h=this.stx.pixelFromValueAdjusted(a,t,e);return r<=l&&l<=s&&n<=h&&h<=o?(this.highlighted=!0,{p0:_.clone(this.p0),tick:t,value:e}):this.lineIntersection(t,e,i,"segment")?(this.highlighted=!0,{action:"move",stem:_.clone(this.stem),p0:_.clone(this.p0),tick:t,value:e}):null},_.Drawing.fibprojection=function(){this.name="fibprojection",this.dragToDraw=!1,this.p2=null},_.Drawing.fibprojection.ciqInheritsFrom(_.Drawing.fibonacci),_.Drawing.fibprojection.prototype.recommendedLevels=[0,.618,1,1.272,1.618,2.618,4.236],_.Drawing.fibprojection.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],a.chart),this.parameters=_.clone(this.parameters),!0):(this.setPoint(1,e,i,a.chart),!(this.p2=[this.p1[0],this.p1[1]])):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},_.Drawing.fibprojection.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=e.yAxis;if(this.p1){var a=this.p1[1]-this.p0[1],r=this.stx.pixelFromTick(this.p0[0],e.chart),n=this.stx.pixelFromTick(this.p1[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),l=null,h=null;this.p2&&(l=this.stx.pixelFromTick(this.p2[0],e.chart),h=this.stx.pixelFromValueAdjusted(e,this.p2[0],this.p2[1])),this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var c=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var u=t.measureText("161.8%").width+10,p=this.color;if(("auto"==p||_.isTransparent(p))&&(p=this.stx.defaultColor),this.p2){this.rays=[];for(var d=0;d<this.parameters.fibs.length;d++){t.textAlign="left",t.fillStyle=p;var m=this.parameters.fibs[d];if(m.display){var g=this.stx.pixelFromValueAdjusted(e,this.p2[0],this.p2[1]+a*m.level),f=_.xIntersection({x0:r,x1:n,y0:s,y1:o},g),y=this.parameters.extendLeft?0:r,v=e.left+e.width;if(this.parameters.printLevels){var x=Math.round(1e3*m.level)/10+"%";v-=u,this.parameters.printValues&&(t.fillStyle=p,this.stx.canvasFont("stx_yaxis",t)),v<y&&(t.textAlign="right"),t.fillText(x,v,g),v<y?v+=5:v-=5}if(this.parameters.printValues&&f<e.width){var C=this.stx.transformedPriceFromPixel(g,e);C=i.priceFormatter?i.priceFormatter(this.stx,e,C):this.stx.formatYAxisPrice(C,e),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(e,C,g,p,null,t),t==this.stx.chart.context&&this.stx.startClip(e.name)}var S=m.color;("auto"==S||_.isTransparent(S))&&(S=this.color),("auto"==S||_.isTransparent(S))&&(S=this.stx.defaultColor);var b=m.color;("auto"==b||_.isTransparent(b))&&(b=this.fillColor),("auto"==b||_.isTransparent(b))&&(b=this.stx.defaultColor),t.fillStyle=b;var w=_.clone(m.parameters);this.highlighted&&(w.opacity=1),this.stx.plotLine(y,v,g,g,this.highlighted?c:S,"segment",t,e,w),this.rays.push([[y,g],[v,g]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(v,g),t.lineTo(y,g),y?t.lineTo(r,h):t.lineTo(y,h),t.lineTo(v,h),void 0!==b&&t.fill(),t.globalAlpha=1}}}var T=_.clone(this.parameters.trend.parameters);if(this.highlighted&&(T.opacity=1),this.stx.plotLine(r,n,s,o,c,"segment",t,e,T),this.p2&&this.stx.plotLine(n,l,o,h,c,"segment",t,e,T),this.highlighted){var D="p0"==this.highlighted,A="p1"==this.highlighted,M="p2"==this.highlighted;this.littleCircle(t,r,s,D),this.littleCircle(t,n,o,A),this.littleCircle(t,l,h,M)}}}},_.Drawing.fibprojection.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},_.Drawing.fibprojection.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.setPoint(2,e.p2[0]-n,e.p2[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},_.Drawing.fibprojection.prototype.intersected=function(t,e,i){var a=this.p0,r=this.p1,n=this.p2;if(!a||!r||!n)return null;var s={0:a,1:r,2:n};for(var o in s)if(this.pointIntersection(s[o][0],s[o][1],i))return this.highlighted="p"+o,{action:"drag",point:"p"+o};var l=this.rays,h=this.lineIntersection(t,e,i,"segment",a,r)||this.lineIntersection(t,e,i,"segment",r,n);if(!h)for(var c=0;c<l.length;c++)if(this.lineIntersection(t,e,i,"ray",l[c][0],l[c][1],!0)){h=!0;break}return h?(this.highlighted=!0,{action:"move",p0:_.clone(a),p1:_.clone(r),p2:_.clone(n),tick:t,value:e}):null},_.Drawing.fibprojection.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},_.Drawing.fibarc=function(){this.name="fibarc"},_.Drawing.fibarc.ciqInheritsFrom(_.Drawing.fibonacci),_.Drawing.fibarc.prototype.recommendedLevels=[.382,.5,.618,1],_.Drawing.fibarc.prototype.setOuter=function(){var t=this.stx.panels[this.panelName];if(t){this.outer={p0:_.clone(this.p0),p1:_.clone(this.p1)};var e=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]),i=this.stx.pixelFromValueAdjusted(t,this.p1[0],this.p1[1]),a=this.stx.pixelFromTick(this.p0[0],t.chart),r=this.stx.pixelFromTick(this.p1[0],t.chart),n=2*e-i,s=_.xIntersection({x0:a,x1:r,y0:e,y1:i},n);this.outer.p0[1]=this.stx.valueFromPixel(n,t),this.outer.p0[0]=this.stx.tickFromPixel(s,t.chart)}},_.Drawing.fibarc.prototype.intersected=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){var r=this.p0,n=this.p1,s=this.outer;if(!r||!n)return null;var o={0:r,1:n};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],i))return this.highlighted="p"+l,{action:"drag",point:"p"+l};if(this.lineIntersection(t,e,i,"segment",s.p0,s.p1))return this.highlighted=!0,{action:"move",p0:_.clone(r),p1:_.clone(n),tick:t,value:e};var h={x0:r[0],x1:n[0],y0:r[1],y1:n[1]},c=_.convertBoxToPixels(this.stx,this.panelName,h),u=Math.abs(Math.sqrt(2)*(c.x1-c.x0)),p=Math.abs(Math.sqrt(2)*(c.y1-c.y0)),d=this.stx.pixelFromTick(t,a.chart),m=this.stx.pixelFromValueAdjusted(a,t,e);return d<c.x1-u||d>c.x1+u?null:m<c.y1-p||m>c.y1+p?null:c.y0<c.y1&&m>c.y1?null:c.y0>c.y1&&m<c.y1?null:(this.highlighted=!0,{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),tick:t,value:e})}},_.Drawing.fibarc.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=e.yAxis;if(this.p1){var a=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),o=s<n,l=Math.abs((s-n)/(r-a)),h=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var c=this.color;("auto"==c||_.isTransparent(c))&&(c=this.stx.defaultColor);for(var u=0;u<this.parameters.fibs.length;u++){t.fillStyle=c;var p=this.parameters.fibs[u];if(!(p.level<0)&&p.display){var d=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*p.level,m=this.p1[1]+d*(o?-1:1),g=this.stx.pixelFromValueAdjusted(e,this.p0[0],m),f=_.xIntersection({x0:a,x1:r,y0:n,y1:s},g);if(this.parameters.printLevels){t.textAlign="center";var y=Math.round(1e3*p.level)/10+"%";this.parameters.printValues&&(t.fillStyle=c,this.stx.canvasFont("stx_yaxis",t)),t.fillText(y,r,Math.round(g-5))}if(t.textAlign="left",this.parameters.printValues&&f<e.width){var v=m;v=i.priceFormatter?i.priceFormatter(this.stx,e,v):this.stx.formatYAxisPrice(v,e),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(e,v,g,c,null,t),t==this.stx.chart.context&&this.stx.startClip(e.name)}var x=p.color;("auto"==x||_.isTransparent(x))&&(x=this.color),("auto"==x||_.isTransparent(x))&&(x=this.stx.defaultColor),t.strokeStyle=this.highlight?h:x;var C=p.color;("auto"==C||_.isTransparent(C))&&(C=this.fillColor),("auto"==C||_.isTransparent(C))&&(C=this.stx.defaultColor),t.fillStyle=C,t.globalAlpha=this.highlighted?1:p.parameters.opacity,t.lineWidth=p.parameters.lineWidth,t.setLineDash&&(t.setLineDash(_.borderPatternToArray(t.lineWidth,p.parameters.pattern)),t.lineDashOffset=0),t.save(),t.beginPath(),t.scale(1/l,1),t.arc(r*l,s,Math.abs(g-s),0,Math.PI,!o),"none"!=this.pattern&&t.stroke(),t.globalAlpha=.05,t.fill(),t.restore(),t.setLineDash&&t.setLineDash([]),t.globalAlpha=1}}t.textAlign="left";var S=_.clone(this.parameters.trend.parameters);if(this.highlighted&&(S.opacity=1),this.stx.plotLine(r,2*a-r,s,2*n-s,h,"segment",t,e,S),this.highlighted){var b="p0"==this.highlighted,w="p1"==this.highlighted;this.littleCircle(t,a,n,b),this.littleCircle(t,r,s,w)}}}},_.Drawing.fibfan=function(){this.name="fibfan"},_.Drawing.fibfan.ciqInheritsFrom(_.Drawing.fibonacci),_.Drawing.fibfan.prototype.recommendedLevels=[0,.382,.5,.618,1],_.Drawing.fibfan.prototype.setOuter=function(){},_.Drawing.fibfan.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=e.yAxis;if(this.p1){var a=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),o=Math.min(s,n),l=Math.max(s,n),h=l-o,c=0<(s-n)/(r-a),u=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var p=t.measureText("161.8%").width+10,d=Number.MAX_VALUE,m=-1*Number.MAX_VALUE,g=this.color;("auto"==g||_.isTransparent(g))&&(g=this.stx.defaultColor),this.rays=[];for(var f=0;f<this.parameters.fibs.length;f++){t.fillStyle=g;var y=this.parameters.fibs[f];if(y.display){var v=this.stx.pixelFromValueAdjusted(e,this.p0[0],(this.p0[1]-this.p1[1])*y.level+this.p1[1]),x=_.xIntersection({x0:r,x1:r,y0:n,y1:s},v),C=e.left;a<r&&(C+=e.width);var S=(C-a)*(v-n)/(x-a)+n;if(!(a>C-(this.parameters.printLevels?p+5:0)&&a<r||a<C+(this.parameters.printLevels?p+5:0)&&r<a)){if(this.parameters.printLevels){var b=Math.round(1e3*y.level)/10+"%";t.textAlign=a<r?(C-=p,"left"):(C+=p,"right"),this.parameters.printValues&&(t.fillStyle=g,this.stx.canvasFont("stx_yaxis",t)),S=(C-a)*(v-n)/(x-a)+n,t.fillText(b,C,S),a<r?C-=5:C+=5}if(t.textAlign="left",this.parameters.printValues&&x<e.width){var w=this.stx.transformedPriceFromPixel(v,e);w=i.priceFormatter?i.priceFormatter(this.stx,e,w):this.stx.formatYAxisPrice(w,e),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(e,w,v,g,null,t),t==this.stx.chart.context&&this.stx.startClip(e.name)}var T=y.color;("auto"==T||_.isTransparent(T))&&(T=this.color),("auto"==T||_.isTransparent(T))&&(T=this.stx.defaultColor);var D=y.color;("auto"==D||_.isTransparent(D))&&(D=this.fillColor),("auto"==D||_.isTransparent(D))&&(D=this.stx.defaultColor),t.fillStyle=D,this.parameters.printLevels&&(S=(C-a)*(v-n)/(x-a)+n);var A=_.clone(y.parameters);this.highlighted&&(A.opacity=1),this.stx.plotLine(a,C,n,S,this.highlighted?u:T,"segment",t,e,A),this.rays.push([[a,n],[C,S]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(C,S),t.lineTo(a,n),t.lineTo(C,n),t.fill(),t.globalAlpha=1,v<d&&(d=v),m<v&&(m=v)}}}for(var M=0;M<=1;M++){var k=c?l-h*M:o+h*M;(k=Math.round(k))<d&&(d=k),m<k&&(m=k)}if(this.highlighted){var F="p0"==this.highlighted,P="p1"==this.highlighted;this.littleCircle(t,a,n,F),this.littleCircle(t,r,s,P)}}}},_.Drawing.fibtimezone=function(){this.name="fibtimezone"},_.Drawing.fibtimezone.ciqInheritsFrom(_.Drawing.fibonacci),_.Drawing.fibtimezone.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=[1,0],o=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var l=this.p1[0]-this.p0[0],h=this.color;("auto"==h||_.isTransparent(h))&&(h=this.stx.defaultColor),t.textAlign="center";var c=i,u=e.yAxis.top,p=e.yAxis.bottom,d=0,m=this.parameters.timezone.color;("auto"==m||_.isTransparent(m))&&(m=this.color),("auto"==m||_.isTransparent(m))&&(m=this.stx.defaultColor);var g=this.parameters.timezone.color;("auto"==g||_.isTransparent(g))&&(g=this.fillColor),("auto"==g||_.isTransparent(g))&&(g=this.stx.defaultColor),this.parameters.printLevels&&(p-=13);var f=_.clone(this.parameters.timezone.parameters);this.highlighted&&(f.opacity=1);do{if(c=this.stx.pixelFromTick(this.p0[0]+d*l,e.chart),i<a&&c>e.left+e.width)break;if(a<i&&c<e.left)break;this.parameters.printLevels&&(t.fillStyle=h,t.fillText(i<a?d:-1*d,c,p+7)),t.fillStyle=g,this.stx.plotLine(c,c,0,p,this.highlighted?o:m,"segment",t,e,f),t.globalAlpha=.05,t.beginPath(),t.moveTo(i,u),t.lineTo(c,u),t.lineTo(c,p),t.lineTo(i,p),t.fill(),t.globalAlpha=1,d=s[0]+s[1],s.unshift(d)}while(l);if(t.textAlign="left",this.stx.plotLine(i,a,r,n,o,"segment",t,e,f),this.highlighted){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,i,r,y),this.littleCircle(t,a,n,v)}else{var x=this.stx.valueFromPixel(e.height/2,e);this.setPoint(0,this.p0[0],x,e.chart),this.setPoint(1,this.p1[0],x,e.chart)}}},_.Drawing.fibtimezone.prototype.intersected=function(t,e,i){var a=this.p0,r=this.p1,n=this.stx.panels[this.panelName];if(!a||!r||!n)return null;var s={0:a,1:r};for(var o in s)if(this.pointIntersection(s[o][0],s[o][1],i))return this.highlighted="p"+o,{action:"drag",point:"p"+o};return this.lineIntersection(t,e,i,"segment")||i.x0<=this.p0[0]&&i.x1>=a[0]?(this.highlighted=!0,{action:"move",p0:_.clone(a),p1:_.clone(r),tick:t,value:e}):null},_.Drawing.shape=function(){this.name="shape",this.radians=0,this.a=0,this.rotating=!1,this.textMeasure=!1,this.configurator="shape",this.dimension=[0,0],this.points=[]},_.Drawing.shape.ciqInheritsFrom(_.Drawing.BaseTwoPoint),_.Drawing.shape.prototype.measure=function(){},_.Drawing.shape.prototype.render=function(t){if(this.points.length){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);if(this.p1){var r=this.stx.pixelFromTick(this.p1[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]);t.globalAlpha=.5,t.fillStyle="#000000",this.rotating?(this.radians=Math.atan((n-a)/(r-i)),r<i?this.radians+=Math.PI:n<a&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.a%=360,this.radians=this.a*Math.PI/180,this.textMeasure&&t.fillText(this.a+"",r+10,n+10)):this.penDown&&(this.sx=Math.max(1,parseFloat(Math.abs(2*(r-i)/this.dimension[0]).toFixed(1))),r<i&&(this.sx*=-1),this.sy=Math.max(1,parseFloat(Math.abs(2*(n-a)/this.dimension[1]).toFixed(1))),n<a&&(this.sy*=-1),this.textMeasure&&t.fillText(this.sx+"x,"+this.sy+"x",r+this.sx+5,n+this.sy+5)),t.globalAlpha=1}var s=this.lineWidth;s||(s=1.1);var o={pattern:this.pattern,lineWidth:s};this.highlighted&&"none"==o.pattern&&(o.pattern="solid",.1==o.lineWidth&&(o.lineWidth=1));var l=this.color;("auto"==l||_.isTransparent(l))&&(l=this.stx.defaultColor),this.highlighted&&(l=this.stx.getCanvasColor("stx_highlight_vector"),.1==s&&(s=1.1));var h,c,u=this.fillColor;for(s/=2*Math.abs(this.sx*this.sy)/(Math.abs(this.sx)+Math.abs(this.sy)),t.save(),t.translate(i,a),t.rotate(this.radians),t.scale(this.sx,this.sy),h=0;h<this.points.length;h++){for(t.beginPath(),c=0;c<this.points[h].length;c++){var p,d,m,g,f,y;"M"==this.points[h][c]?(p=this.points[h][++c]-(this.dimension[0]-1)/2,d=this.points[h][++c]-(this.dimension[1]-1)/2,t.moveTo(p,d)):"L"==this.points[h][c]?(p=this.points[h][++c]-(this.dimension[0]-1)/2,d=this.points[h][++c]-(this.dimension[1]-1)/2,t.lineTo(p,d)):"Q"==this.points[h][c]?(m=this.points[h][++c]-(this.dimension[0]-1)/2,f=this.points[h][++c]-(this.dimension[1]-1)/2,p=this.points[h][++c]-(this.dimension[0]-1)/2,d=this.points[h][++c]-(this.dimension[1]-1)/2,t.quadraticCurveTo(m,f,p,d)):"B"==this.points[h][c]&&(m=this.points[h][++c]-(this.dimension[0]-1)/2,f=this.points[h][++c]-(this.dimension[1]-1)/2,g=this.points[h][++c]-(this.dimension[0]-1)/2,y=this.points[h][++c]-(this.dimension[1]-1)/2,p=this.points[h][++c]-(this.dimension[0]-1)/2,d=this.points[h][++c]-(this.dimension[1]-1)/2,t.bezierCurveTo(m,f,g,y,p,d))}t.closePath(),u&&!_.isTransparent(u)&&"auto"!=u&&(t.fillStyle=u,t.fill()),l&&"none"!=this.pattern&&(t.strokeStyle=l,t.lineWidth=s,t.setLineDash&&(t.setLineDash(_.borderPatternToArray(s,this.pattern)),t.lineDashOffset=0),t.stroke())}if(t.restore(),t.save(),t.translate(i,a),t.rotate(this.radians),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted,C="p2"==this.highlighted;this.littleCircle(t,0,0,v),this.mover(t,0,0,v),this.littleCircle(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,x),this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,x),this.littleCircle(t,this.sx*this.dimension[0]/2,0,C),this.rotator(t,this.sx*this.dimension[0]/2,0,C),t.globalAlpha=.5,t.fillStyle="#000000",this.textMeasure&&(t.fillText(this.sx+"x,"+this.sy+"x",this.sx*this.dimension[0]/2+12,this.sy*this.dimension[1]/2+5),t.fillText(this.a+"",this.sx*this.dimension[0]/2+12,5)),t.globalAlpha=1}else this.penDown&&(this.rotating?this.rotator(t,this.sx*this.dimension[0]/2,0,!0):this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,!0));t.restore()}}},_.Drawing.shape.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName];if("move"==e.action){var n=e.tick-i,s=e.value-a;this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}else{var o=this.stx.pixelFromTick(this.p0[0],r.chart),l=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),h=this.stx.pixelFromTick(i,r.chart),c=this.stx.pixelFromValueAdjusted(r,i,a);"scale"==e.action?(this[e.point]=[i,a],this.sx=parseFloat((((h-o)*Math.cos(this.radians)+(c-l)*Math.sin(this.radians))/(this.dimension[0]/2)).toFixed(1)),Math.abs(this.sx)<1&&(this.sx/=Math.abs(this.sy)),this.sy=parseFloat((((c-l)*Math.cos(this.radians)-(h-o)*Math.sin(this.radians))/(this.dimension[1]/2)).toFixed(1)),Math.abs(this.sy)<1&&(this.sy/=Math.abs(this.sy)),this.render(t)):"rotate"==e.action&&(this[e.point]=[i,a],this.radians=Math.atan((c-l)/(h-o)),h<o?this.radians+=Math.PI:c<l&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.sx<0&&(this.a=this.a+180),this.a%=360,this.radians=this.a*Math.PI/180,this.render(t))}}},_.Drawing.shape.prototype.intersected=function(t,e,i){if(!this.p0)return null;if(this.stx.repositioningDrawing==this&&this.stx.repositioningDrawing.repositioner)return this.stx.repositioningDrawing.repositioner;var a=this.stx.panels[this.panelName],r=this.stx.pixelFromTick(this.p0[0],a.chart),n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),s=this.stx.pixelFromTick(t,a.chart),o=this.stx.pixelFromValueAdjusted(a,t,e),l=o-=n,h=s-=r;s=Math.cos(this.radians)*h+Math.sin(this.radians)*l,o=Math.cos(this.radians)*l-Math.sin(this.radians)*h,s/=this.sx,o/=this.sy;var c=Math.pow(_.touchDevice?25:5+this.littleCircleRadius(),2),u=Math.abs(c/(this.sx*this.sy)),p=Math.pow(this.dimension[0]/2,2)+Math.pow(this.dimension[1]/2,2)>Math.pow(s,2)+Math.pow(o,2),d=(c-(Math.pow(s*this.sx,2)+Math.pow(o*this.sy,2)))/Math.abs(this.sx*this.sy),m=u-(Math.pow(s-this.dimension[0]/2,2)+Math.pow(o-this.dimension[1]/2,2)),g=u-(Math.pow(s-this.dimension[0]/2,2)+Math.pow(o,2));return 0<m&&g<=m&&d<=m?(this.highlighted="p1",{action:"scale"}):0<g&&m<=g&&d<=g?(this.highlighted="p2",{action:"rotate"}):0<d&&m<=d&&g<=d?(this.highlighted="p0",{action:"move",p0:_.clone(this.p0),tick:t,value:e}):p?(this.highlighted=!0,{}):null},_.Drawing.shape.prototype.configs=["color","fillColor","lineWidth","pattern"],_.Drawing.shape.prototype.littleCircleRadius=function(){return 3},_.Drawing.shape.prototype.click=function(t,e,i){if(!this.points.length)return!1;this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?(this.setPoint(1,e,i,a.chart),this.rotating?(this.penDown=!1,!(this.rotating=!1)):!(this.rotating=!0)):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))},_.Drawing.shape.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.radians=Math.round(this.a/5)*Math.PI/36)},_.Drawing.shape.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.v0=e.v0,this.tzo0=e.tzo0,this.a=e.a,this.sx=e.sx,this.sy=e.sy,this.adjust()},_.Drawing.shape.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,v0:this.v0,tzo0:this.tzo0,a:this.a,sx:this.sx,sy:this.sy}},_.Drawing.xcross=function(){this.name="xcross",this.dimension=[7,7],this.points=[["M",1,0,"L",3,2,"L",5,0,"L",6,1,"L",4,3,"L",6,5,"L",5,6,"L",3,4,"L",1,6,"L",0,5,"L",2,3,"L",0,1,"L",1,0]]},_.Drawing.xcross.ciqInheritsFrom(_.Drawing.shape),_.Drawing.arrow=function(){this.name="arrow",this.dimension=[11,11],this.points=[["M",3,0,"L",7,0,"L",7,5,"L",10,5,"L",5,10,"L",0,5,"L",3,5,"L",3,0]]},_.Drawing.arrow.ciqInheritsFrom(_.Drawing.shape),_.Drawing.check=function(){this.name="check",this.dimension=[8,9],this.points=[["M",1,5,"L",0,6,"L",2,8,"L",7,1,"L",6,0,"L",2,6,"L",1,5]]},_.Drawing.check.ciqInheritsFrom(_.Drawing.shape),_.Drawing.star=function(){this.name="star",this.dimension=[12,12],this.points=[["M",0,4,"L",4,4,"L",5.5,0,"L",7,4,"L",11,4,"L",8,7,"L",9,11,"L",5.5,9,"L",2,11,"L",3,7,"L",0,4]]},_.Drawing.star.ciqInheritsFrom(_.Drawing.shape),_.Drawing.heart=function(){this.name="heart",this.dimension=[23,20],this.points=[["M",11,3,"B",11,2.4,10,0,6,0,"B",0,0,0,7.5,0,7.5,"B",0,11,4,15.4,11,19,"B",18,15.4,22,11,22,7.5,"B",22,7.5,22,0,16,0,"B",13,0,11,2.4,11,3]]},_.Drawing.heart.ciqInheritsFrom(_.Drawing.shape),_.Drawing.focusarrow=function(){this.name="focusarrow",this.dimension=[7,5],this.points=[["M",0,0,"L",2,2,"L",0,4,"L",0,0],["M",6,0,"L",4,2,"L",6,4,"L",6,0]]},_.Drawing.focusarrow.ciqInheritsFrom(_.Drawing.shape),_.Drawing.crossline=function(){this.name="crossline"},_.Drawing.crossline.ciqInheritsFrom(_.Drawing.horizontal),_.extend(_.Drawing.crossline.prototype,{measure:function(){},accidentalClick:function(t,e){return!1},adjust:function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=_.clone(this.p0))},intersected:function(t,e,i){if(!this.p0||!this.p1)return null;this.p1[0]+=1;var a=this.lineIntersection(t,e,i,"line");return this.p1=_.clone(this.p0),a||(this.p1[1]+=1,a=this.lineIntersection(t,e,i,"line"),this.p1=_.clone(this.p0),a)?(this.highlighted=!0,this.pointIntersection(this.p0[0],this.p0[1],i)&&(this.highlighted="p0"),{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),tick:t,value:e}):null},render:function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),r=this.setLineColor(),n={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,i+100,a,a,r,"horizontal",t,e,n),this.stx.plotLine(i,i,a,a+100,r,"vertical",t,e,n),this.axisLabel&&!this.repositioner){this.stx.endClip();var s=this.p0[1];if(e.chart.transformFunc&&(s=e.chart.transformFunc(this.stx,e.chart,s)),s=e.yAxis.priceFormatter?e.yAxis.priceFormatter(this.stx,e,s):this.stx.formatYAxisPrice(s,e),this.stx.createYAxisLabel(e,s,a,r),this.stx.startClip(e.name),0<=this.p0[0]&&!this.stx.chart.xAxis.noDraw){var o,l;if(o=this.stx.dateFromTick(this.p0[0],e.chart,!0),_.ChartEngine.isDailyInterval(this.stx.layout.interval))o.setHours(0,0,0,0);else{var h=1e3*o.getSeconds()+o.getMilliseconds();this.stx.displayZone&&(l=new f.Date(o.getTime(),this.stx.displayZone),o=new Date(l.getFullYear(),l.getMonth(),l.getDate(),l.getHours(),l.getMinutes()),o=new Date(o.getTime()+h))}var c=_.mmddhhmm(_.yyyymmddhhmm(o));if(e.chart.xAxis.formatter)c=e.chart.xAxis.formatter(o);else if(this.stx.internationalizer){var u;0!==o.getHours()||0!==o.getMinutes()?(u=this.stx.internationalizer.monthDay.format(o),u+=" "+this.stx.internationalizer.hourMinute.format(o)):u=this.stx.internationalizer.yearMonthDay.format(o),c=u}this.stx.endClip(),this.stx.createXAxisLabel(e,c,i,r,null,!0),this.stx.startClip(e.name)}}if(this.highlighted){var p="p0"==this.highlighted;this.littleCircle(t,i,a,p)}}}},!0),_.Drawing.speedarc=function(){this.name="speedarc",this.printLevels=!0},_.Drawing.speedarc.ciqInheritsFrom(_.Drawing.segment),_.extend(_.Drawing.speedarc.prototype,{defaultOpacity:.25,configs:["color","fillColor","lineWidth","pattern"],copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},intersected:function(t,e,i){if(!this.p0||!this.p1)return null;var a={0:this.p0,1:this.p1};for(var r in a)if(this.pointIntersection(a[r][0],a[r][1],i))return this.highlighted="p"+r,{action:"drag",point:"p"+r};if(this.lineIntersection(t,e,i,this.name))return this.highlighted=!0,{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),tick:t,value:e};var n=this.p1[0]-(this.p0[0]-this.p1[0]),s=this.p0[0],o=this.p1[1],l=this.p0[1];return t>Math.max(n,s)||t<Math.min(n,s)?null:e>Math.max(l,o)||e<Math.min(l,o)?null:(this.highlighted=!0,{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),tick:t,value:e})},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=n<r,o=Math.abs((n-r)/(a-i)),l=this.setLineColor();t.strokeStyle=l;var h=this.fillColor;("auto"==h||_.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h,t.setLineDash&&(t.setLineDash(_.borderPatternToArray(this.lineWidth,this.pattern)),t.lineDashOffset=0),this.stx.canvasFont("stx_yaxis",t);for(var c=1;c<3;c++){var u=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*c/3,p=this.p1[1]+u*(s?-1:1),d=this.stx.pixelFromValueAdjusted(e,this.p0[0],p);if(t.save(),t.beginPath(),t.scale(1/o,1),t.arc(a*o,n,Math.abs(d-n),0,Math.PI,!s),t.globalAlpha=this.highlighted?1:this.defaultOpacity,"none"!=this.pattern&&t.stroke(),t.globalAlpha=.1,t.fill(),t.restore(),t.globalAlpha=1,this.printLevels){t.fillStyle=l,t.textAlign="center";var m=c+"/3";t.fillText(m,a,Math.round(d-5)),t.fillStyle=h}}t.textAlign="left";var g={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity};if(this.stx.plotLine(i,a,r,n,l,"segment",t,e,g),t.setLineDash&&t.setLineDash([]),this.highlighted){var f="p0"==this.highlighted,y="p1"==this.highlighted;this.littleCircle(t,i,r,f),this.littleCircle(t,a,n,y)}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}}},!0),_.Drawing.speedline=function(){this.name="speedline",this.printLevels=!0},_.Drawing.speedline.ciqInheritsFrom(_.Drawing.speedarc),_.extend(_.Drawing.speedline.prototype,{intersected:function(t,e,i){var a=this.p0,r=this.p1;if(!a||!r)return null;var n={0:a,1:r};for(var s in n)if(this.pointIntersection(n[s][0],n[s][1],i))return this.highlighted="p"+s,{action:"drag",point:"p"+s};for(var o=this.rays,l=0;l<o.length;l++)if(this.lineIntersection(t,e,i,"ray",o[l][0],o[l][1],!0))return this.highlighted=!0,{action:"move",p0:_.clone(a),p1:_.clone(r),tick:t,value:e};return null},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var s=this.setLineColor(),o=this.color;("auto"==o||_.isTransparent(o))&&(o=this.stx.defaultColor),t.strokeStyle=o;var l=this.fillColor;("auto"==l||_.isTransparent(l))&&(l=this.stx.defaultColor),t.fillStyle=l;var h,c,u={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},p=["1","2/3","1/3","3/2","3"],d=[1,2/3,1/3,1.5,3],m=[];this.rays=[];for(var g=0;g<d.length;g++){var f=d[g];if(!(1<f)||this.extension){var y,v=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]-(this.p0[1]-this.p1[1])*f);1<f?(y=_.xIntersection({x0:i,x1:a,y0:r,y1:v},n),m.push(y)):(y=_.xIntersection({x0:a,x1:a,y0:r,y1:n},v),m.push(v));var x=1<f?y:a,C=1<f?n:v;if(this.confineToGrid||(x=e.left,i<a&&(x+=e.width),C=(x-i)*(v-r)/(a-i)+r),this.printLevels&&(1!=f||this.extension)){t.fillStyle=o;var S=0,b=0;t.textBaseline=n<r?(b=-5,"bottom"):(b=5,"top"),t.textAlign=a<i?(S=5,"right"):(S=-5,"left"),1<f?t.fillText(p[g],y+(this.confineToGrid?0:S),n):t.fillText(p[g],a,v+(this.confineToGrid?0:b)),t.fillStyle=l}this.stx.plotLine(i,x,r,C,this.highlighted?s:o,"segment",t,e,u),1==f&&(h=x,c=C),this.rays.push([[i,r],[x,C]]),t.globalAlpha=.1,t.beginPath(),t.moveTo(x,C),t.lineTo(i,r),t.lineTo(h,c),t.fill(),t.globalAlpha=1}}if(t.textAlign="left",t.textBaseline="middle",this.confineToGrid&&(t.globalAlpha=.3,t.beginPath(),t.strokeRect(i,r,a-i,n-r),t.moveTo(i,m[1]),t.lineTo(a,m[1]),t.moveTo(i,m[2]),t.lineTo(a,m[2]),this.extension&&(t.moveTo(m[3],r),t.lineTo(m[3],n),t.moveTo(m[4],r),t.lineTo(m[4],n)),t.stroke(),t.globalAlpha=1),this.highlighted){var w="p0"==this.highlighted,T="p1"==this.highlighted;this.littleCircle(t,i,r,w),this.littleCircle(t,a,n,T)}}}},!0),_.Drawing.gannfan=function(){this.name="gannfan",this.printLevels=!0},_.Drawing.gannfan.ciqInheritsFrom(_.Drawing.speedline),_.extend(_.Drawing.gannfan.prototype,{render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var s=this.setLineColor(),o=this.color;("auto"==o||_.isTransparent(o))&&(o=this.stx.defaultColor),t.strokeStyle=o;var l=this.fillColor;("auto"==l||_.isTransparent(l))&&(l=this.stx.defaultColor),t.fillStyle=l;var h,c,u={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},p=[1,2,3,4,8,.5,1/3,.25,1/8];this.rays=[];for(var d=0;d<p.length;d++){var m=p[d],g=i+(a-i)/m,f=r-m*(r-n),y=e.left;i<a&&(y+=e.width);var v=(y-i)*(f-r)/(a-i)+r;if(this.printLevels){t.fillStyle=o;var x=0,C=0;t.textBaseline=n<r?(C=5,"top"):(C=-5,"bottom"),t.textAlign=a<i?(x=5,"left"):(x=-5,"right"),1<m?t.fillText(m+"x1",g+x,n):t.fillText("1x"+1/m,a,f+C),t.fillStyle=l}this.stx.plotLine(i,y,r,v,this.highlighted?s:o,"segment",t,e,u),this.rays.push([[i,r],[y,v]]),1==m&&(h=y,c=v),t.globalAlpha=.1,t.beginPath(),t.moveTo(y,v),t.lineTo(i,r),t.lineTo(h,c),t.fill(),t.globalAlpha=1}if(t.textAlign="left",t.textBaseline="middle",this.highlighted){var S="p0"==this.highlighted,b="p1"==this.highlighted;this.littleCircle(t,i,r,S),this.littleCircle(t,a,n,b)}}}},!0),_.Drawing.timecycle=function(){this.name="timecycle",this.printLevels=!0},_.Drawing.timecycle.ciqInheritsFrom(_.Drawing.speedarc),_.extend(_.Drawing.timecycle.prototype,{intersected:function(t,e,i){var a=this.p0,r=this.p1,n=this.stx.panels[this.panelName];if(!a||!r||!n)return null;var s={0:a,1:r};for(var o in s)if(this.pointIntersection(s[o][0],s[o][1],i))return this.highlighted="p"+o,{action:"drag",point:"p"+o};return this.lineIntersection(t,e,i,"segment")||i.x0<=this.p0[0]&&i.x1>=a[0]?(this.highlighted=!0,{action:"move",p0:_.clone(a),p1:_.clone(r),tick:t,value:e}):null},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),s=0,o=this.setLineColor();t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var l=this.p1[0]-this.p0[0];t.textAlign="center";var h=i,c=e.yAxis.top,u=e.yAxis.bottom,p=this.color;("auto"==p||_.isTransparent(p))&&(p=this.stx.defaultColor);var d=this.fillColor;("auto"==d||_.isTransparent(d))&&(d=this.stx.defaultColor),this.printLevels&&(u-=13);var m={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},g=[];t.save(),t.fillStyle=d,t.globalAlpha=.05;do{if(h=this.stx.pixelFromTick(this.p0[0]+s*l,e.chart),s++,i<a&&h>e.left+e.width)break;if(a<i&&h<e.left)break;h<e.left||h>e.left+e.width||(t.beginPath(),t.moveTo(i,c),t.lineTo(h,c),t.lineTo(h,u),t.lineTo(i,u),t.fill(),g.push({c:s,x:h}))}while(l);t.globalAlpha=1;for(var f=0,y=0;y<g.length;y++)this.stx.plotLine(g[y].x,g[y].x,0,u,this.highlighted?o:p,"segment",t,e,m),this.printLevels&&(t.fillStyle=p,this.stx.chart.context.measureText(g[y].c).width+3<this.stx.layout.candleWidth+f?(t.fillText(g[y].c,g[y].x,u+7),f=0):f+=this.stx.layout.candleWidth);if(t.restore(),t.textAlign="left",this.stx.plotLine(i,a,r,n,o,"segment",t,e,m),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,i,r,v),this.littleCircle(t,a,n,x)}else{var C=this.stx.valueFromPixel(e.height/2,e);this.setPoint(0,this.p0[0],C,e.chart),this.setPoint(1,this.p1[0],C,e.chart)}}}},!0),_.Drawing.regression=function(){this.name="regression"},_.Drawing.regression.ciqInheritsFrom(_.Drawing.segment),_.extend(_.Drawing.regression.prototype,{chartsOnly:!0,click:function(t,e,i){if(!(e<0)){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),!(this.penDown=!1)):(this.setPoint(0,e,i,a.chart),!(this.penDown=!0))}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=[],n=0,s=0,o=0,l=Math.min(this.p1[0],this.p0[0]);l<=Math.max(this.p1[0],this.p0[0]);l++){if(this.stx.chart.dataSet[l]){var h=this.stx.chart.dataSet[l].Close;(h||0===h)&&r.push(h)}o++}for(l=0;l<r.length;l++)s+=r.length*r[l]-n,n+=r[l];var c,u,p=r.length,d=p*(p+1)/2,m=(p*s-d*n)/(p*(d*(2*p+1)/3)-Math.pow(d,2)),g=(n-m*d)/p;u=this.p0[0]<this.p1[0]?(c=this.stx.pixelFromValueAdjusted(e,this.p0[0],g),this.stx.pixelFromValueAdjusted(e,this.p1[0],m*o+g)):(c=this.stx.pixelFromValueAdjusted(e,this.p0[0],m*o+g),this.stx.pixelFromValueAdjusted(e,this.p1[0],g));var f=this.setLineColor(),y={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,c,u,f,"segment",t,e,y),this.stx.plotLine(i,i,c-20,c+20,f,"segment",t,e,y),this.stx.plotLine(a,a,u-20,u+20,f,"segment",t,e,y),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,i,c,v),this.littleCircle(t,a,u,x)}else this.p0[0]<this.p1[0]?(this.setPoint(0,this.p0[0],g,e.chart),this.setPoint(1,this.p1[0],m*o+g,e.chart)):(this.setPoint(0,this.p0[0],m*o+g,e.chart),this.setPoint(1,this.p1[0],g,e.chart))}}}},!0),_.Drawing.trendline=function(){this.name="trendline"},_.Drawing.trendline.ciqInheritsFrom(_.Drawing.segment),_.Drawing.trendline.prototype.configs=["color","fillColor","lineWidth","pattern","font"],_.Drawing.trendline.prototype.measure=function(){},_.Drawing.trendline.prototype.reconstruct=function(t,e){_.Drawing.segment.prototype.reconstruct.call(this,t,e),this.callout=new _.Drawing.callout,this.callout.reconstruct(t,e.callout)},_.Drawing.trendline.prototype.serialize=function(){var t=_.Drawing.segment.prototype.serialize.call(this);return t.callout=this.callout.serialize(),t},_.Drawing.trendline.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){if(_.Drawing.segment.prototype.render.call(this,t),!this.callout){this.callout=new _.Drawing.callout;var i=_.Drawing.segment.prototype.serialize.call(this);this.callout.reconstruct(this.stx,i)}this.callout.p0=_.clone(this.p0);var a=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]);if(isFinite(n)&&isFinite(s)){var o=(a+r)/2,l=(n+s)/2;this.fontSize=_.stripPX(this.font&&this.font.size||13);var h=1.2*this.callout.w+("c"==this.callout.stemEntry[0]?0:50),c=h/(Math.sqrt(Math.pow(r-a,2)+Math.pow(s-n,2))||h)*(this.p1[1]<this.p0[1]?1:-1),u=-(s-l)*c+o,p=(r-o)*c+l;this.callout.p0[0]=this.stx.tickFromPixel(u,e.chart),this.callout.p0[1]=this.stx.priceFromPixel(p,e),this.callout.v0=this.callout.p0[1],this.callout.p1=_.clone(this.p0),this.callout.stx=this.stx,this.callout.fillColor=this.fillColor||this.callout.fillColor,this.callout.borderColor=this.color,this.callout.font=this.font||this.callout.font,this.callout.noHandles=!0;var d=this.p1[1]-this.p0[1];this.callout.text=Number(d).toFixed(2)+(0===this.p0[1]?"":" ("+Number(100*d/this.p0[1]).toFixed(2)+"%) ")+Math.abs(this.p1[0]-this.p0[0])+" Bars";var m,g=Math.floor((this.p0[0]+this.p1[0])/2);if(1<Math.abs(this.p0[0]-this.p1[0])&&Math.abs(this.p0[0]-this.p1[0])<20){var f=n+(s-n)/(r-a)*(this.stx.pixelFromTick(g,e.chart)-a);m=this.stx.priceFromPixel(f,e)||l}else m=this.stx.priceFromPixel(l,e);if(this.callout.stem={t:g,v:m},this.callout.renderText(),this.callout.render(t),this.highlighted){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,a,n,y),this.littleCircle(t,r,s,v)}}}},_.Drawing.trendline.prototype.lineIntersection=function(t,e,i,a){return _.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,e,i,"segment")},_.Drawing.trendline.prototype.intersected=function(t,e,i){if(!this.p0||!this.p1)return null;var a=this.callout.intersected(t,e,i),r=_.Drawing.segment.prototype.intersected.call(this,t,e,i);return this.callout.highlighted=!(!a&&!r),r||(a?{action:"move",p0:_.clone(this.p0),p1:_.clone(this.p1),tick:t,value:e}:null)},_.Drawing.average=function(){this.name="average"},_.Drawing.average.ciqInheritsFrom(_.Drawing.regression),_.extend(_.Drawing.average.prototype,{configs:["color","lineWidth","pattern","axisLabel","active1","color1","lineWidth1","pattern1","active2","color2","lineWidth2","pattern2","active3","color3","lineWidth3","pattern3"],copyConfig:function(t){_.Drawing.copyConfig(this,t);var e=this.stx.currentVectorParameters;this.deviation1=!!e.active1,this.deviation2=!!e.active2,this.deviation3=!!e.active3,this.color1=e.color1||"auto",this.color2=e.color2||"auto",this.color3=e.color3||"auto",this.lineWidth1=e.lineWidth1,this.lineWidth2=e.lineWidth2,this.lineWidth3=e.lineWidth3,this.pattern1=e.pattern1,this.pattern2=e.pattern2,this.pattern3=e.pattern3},$controls:['cq-cvp-controller[cq-cvp-header="1"]','cq-cvp-controller[cq-cvp-header="2"]','cq-cvp-controller[cq-cvp-header="3"]'],measure:function(){if(this.p0&&this.p1){this.stx.setMeasure(this.p0[1],!1,this.p0[0],this.p1[0],!0,this.name);var t=[];if(this.deviation1&&t.push("1"),this.deviation2&&t.push("2"),this.deviation3&&t.push("3"),0===t.length)return;var e="&ensp;"+t.join(", ")+" &sigma;",i=$$$(".mMeasure",this.stx.chart.drawingContainer),a=this.stx.controls.mSticky,r=a&&$$$(".mStickyInterior",a);i&&(i.innerHTML+=e),r&&(r.innerHTML+=e)}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){var r,n,s=this.stx,o=s.chart.dataSet,l=Math.min(this.p1[0],this.p0[0]),h=Math.max(this.p1[0],this.p0[0]),c=0,u=0;for(r=l;r<=h;r++)o[r]&&((n=o[r].Close)||0===n)&&(u++,c+=n);if(u){var p=c/u,d=0;for(r=l;r<=h;r++)o[r]&&((n=o[r].Close)||0===n)&&(d+=Math.pow(n-p,2));var m,g,f,y,v,x,C,S=Math.sqrt(d/u),b={};for(var w in this.deviation1&&(m=this.setLineColor(this.color1),g="1",b.deviation1p={value:p+S,color:m,label:g,params:{pattern:this.pattern1,lineWidth:this.lineWidth1}},b.deviation1n={value:p+-1*S,color:m,label:g,params:{pattern:this.pattern1,lineWidth:this.lineWidth1}}),this.deviation2&&(m=this.setLineColor(this.color2),g="2",b.deviation2p={value:p+2*S,color:m,label:g,params:{pattern:this.pattern2,lineWidth:this.lineWidth2}},b.deviation2n={value:p+-2*S,color:m,label:g,params:{pattern:this.pattern2,lineWidth:this.lineWidth2}}),this.deviation3&&(m=this.setLineColor(this.color3),g="3",b.deviation3p={value:p+3*S,label:g,color:m,params:{pattern:this.pattern3,lineWidth:this.lineWidth3}},b.deviation3n={value:p+-3*S,color:m,label:g,params:{pattern:this.pattern3,lineWidth:this.lineWidth3}}),b.average={value:p,color:this.setLineColor(),params:{pattern:this.pattern,lineWidth:this.lineWidth}},this.intersections=[],b)f=b[w],this.intersections.push(f.value),y=s.pixelFromValueAdjusted(e,this.p0[0],f.value),v="average"===w?20:10,s.plotLine(i,a,y,y,f.color,"segment",t,e,f.params),s.plotLine(i,i,y-v,y+v,f.color,"segment",t,e,f.params),s.plotLine(a,a,y-v,y+v,f.color,"segment",t,e,f.params),f.label&&(t.fillStyle=f.color,t.save(),t.textBaseline="middle",t.fillText(f.label,Math.max(i,a)+5,y),t.restore()),!this.axisLabel||this.highlighted||this.penDown||(i>=e.chart.left&&i<=e.chart.right||a>=e.chart.left&&a<=e.chart.right)&&(s.endClip(),x=f.value,e.chart.transformFunc&&(x=e.chart.transformFunc(this.stx,e.chart,x)),s.createYAxisLabel(e,(C=x,C=e.yAxis.priceFormatter?e.yAxis.priceFormatter(s,e,C):s.formatYAxisPrice(C,e)),y,f.color),s.startClip(e.name));if(this.highlighted){var T="p0"==this.highlighted,D="p1"==this.highlighted;this.littleCircle(t,i,y,T),this.littleCircle(t,a,y,D)}else this.setPoint(0,this.p0[0],p),this.setPoint(1,this.p1[0],p)}}}},reconstruct:function(t,e){this.stx=t,this.panelName=e.pnl,this.deviation1=e.dev1,this.deviation2=e.dev2,this.deviation3=e.dev3,this.color=e.col,this.color1=e.col1,this.color2=e.col2,this.color3=e.col3,this.pattern=e.ptrn,this.pattern1=e.ptrn1,this.pattern2=e.ptrn2,this.pattern3=e.ptrn3,this.lineWidth=e.lw,this.lineWidth1=e.lw1,this.lineWidth2=e.lw2,this.lineWidth3=e.lw3,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.axisLabel=e.al,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,dev1:this.deviation1,dev2:this.deviation2,dev3:this.deviation3,col:this.color,col1:this.color1,col2:this.color2,col3:this.color3,ptrn:this.pattern,ptrn1:this.pattern1,ptrn2:this.pattern2,ptrn3:this.pattern3,lw:this.lineWidth,lw1:this.lineWidth1,lw2:this.lineWidth2,lw3:this.lineWidth3,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,al:this.axisLabel}},intersected:function(t,e,i){var a=_.Drawing.segment.prototype.intersected.call(this,t,e,i);if(a)return a;for(var r=_.Drawing.BaseTwoPoint.prototype.lineIntersection,n=this.intersections,s=[this.p0[0],0],o=[this.p1[0],0],l={p0:s,p1:o,stx:this.stx,panelName:this.panelName},h=0;n&&h<n.length-1;++h)if(s[1]=o[1]=n[h],r.call(l,t,e,i,"segment"))return this.highlighted=!0,{action:"move",p0:s,p1:o,tick:t,value:e};return null}},!0),_.Drawing.quadrant=function(){this.name="quadrant"},_.Drawing.quadrant.ciqInheritsFrom(_.Drawing.speedarc),_.extend(_.Drawing.quadrant.prototype,{chartsOnly:!0,render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=null,n=null,s=Math.min(this.p1[0],this.p0[0]);s<=Math.max(this.p1[0],this.p0[0]);s++)if(this.stx.chart.dataSet[s]){var o=this.stx.chart.dataSet[s].Close;(o||0===o)&&((null===r||r<o)&&(r=o),(null===n||o<n)&&(n=o))}var l=(r+n)/2,h=this.stx.pixelFromValueAdjusted(e,this.p0[0],r),c=this.stx.pixelFromValueAdjusted(e,this.p0[0],(r+l)/2),u=this.stx.pixelFromValueAdjusted(e,this.p0[0],(2*r+n)/3),p=this.stx.pixelFromValueAdjusted(e,this.p0[0],l),d=this.stx.pixelFromValueAdjusted(e,this.p0[0],(r+2*n)/3),m=this.stx.pixelFromValueAdjusted(e,this.p0[0],(n+l)/2),g=this.stx.pixelFromValueAdjusted(e,this.p0[0],n);this.highest=r,this.lowest=n;var f=this.setLineColor(),y=this.fillColor;("auto"==y||_.isTransparent(y))&&(y=this.stx.defaultColor),t.fillStyle=y;var v={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,h,h,f,"segment",t,e,v),this.stx.plotLine(i,a,g,g,f,"segment",t,e,v),"quadrant"==this.name?(this.stx.plotLine(i,a,c,c,f,"segment",t,e,v),this.stx.plotLine(i,a,m,m,f,"segment",t,e,v)):"tirone"==this.name&&(this.stx.plotLine(i,a,u,u,f,"segment",t,e,v),this.stx.plotLine(i,a,d,d,f,"segment",t,e,v)),this.stx.plotLine(i,i,h,g,f,"segment",t,e,v),this.stx.plotLine(a,a,h,g,f,"segment",t,e,v),this.stx.plotLine(i,a,p,p,f,"segment",t,e,_.extend(v,{opacity:"tirone"==this.name?.2:1})),t.globalAlpha=.1,t.beginPath(),t.fillRect(i,h,a-i,g-h),"quadrant"==this.name?t.fillRect(i,c,a-i,m-c):"tirone"==this.name&&t.fillRect(i,u,a-i,d-u),t.globalAlpha=1,this.highlighted){var x="p0"==this.highlighted,C="p1"==this.highlighted;this.littleCircle(t,i,p,x),this.littleCircle(t,a,p,C)}else this.setPoint(0,this.p0[0],l,e.chart),this.setPoint(1,this.p1[0],l,e.chart)}}},boxIntersection:function(t,e){var i=this.p0,a=this.p1;return!(!i||!a||t>Math.max(i[0],a[0])||t<Math.min(i[0],a[0])||!this.stx.repositioningDrawing&&(e>this.highest||e<this.lowest))},intersected:function(t,e,i){var a=this.p0,r=this.p1;if(!a||!r)return null;var n={0:a,1:r};for(var s in n)if(this.pointIntersection(n[s][0],n[s][1],i))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(t,e)?(this.highlighted=!0,{action:"move",p0:_.clone(a),p1:_.clone(r),tick:t,value:e}):null}},!0),_.Drawing.tirone=function(){this.name="tirone"},_.Drawing.tirone.ciqInheritsFrom(_.Drawing.quadrant),(z=t.CIQ).formatEquation=function(t){for(var e="",i=[],a="",r=!1,n=1;n<t.length;n++){var s=t[n].toUpperCase();"["!=s||r?"]"==s&&r?(r=!1,""!==a&&(i.push(a),e+="["+a+"]"),a=""):r?a+=s:"+"==s||"-"==s||"*"==s||"/"==s||":"==s||"%"==s||"("==s||")"==s?(""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,":"==s&&(s="/"),e+=s,a=""):" "!=s&&(a+=s):r=!0}return""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,{equation:e,symbols:i}},z.fetchEquationChart=function(l,h){var c=z.formatEquation(l.symbol),t=c.symbols,u=[],e=l.stx;l.stx=null;for(var i=0;i<t.length;i++){var a=z.shallowClone(l);a.stx=e,a.symbol=t[i],u.push(a)}(l.stx=e).quoteDriver.quoteFeed.multiFetch(u,function(t){var e={};l.loadMoreReplace=!0;for(var i={charge:0},a=0;a<t.length;a++){var r=t[a];if(r.dataCallback.error)return void h({error:r.dataCallback.error});e[r.params.symbol]=r.dataCallback.quotes,l.loadMoreReplace=l.loadMoreReplace&&r.params.loadMoreReplace,l.moreToLoad=l.moreToLoad||r.dataCallback.moreAvailable;var n=r.dataCallback.attribution;n.charge&&(i.charge+=n.charge),i.source=n.source,void 0===i.exchange?i.exchange=n.exchange:i.exchange!=n.exchange&&(i.exchange="")}if(u.length||!l.loadMore&&!l.update)try{var s=z.computeEquationChart(c.equation,e);h({quotes:s,moreAvailable:l.moreToLoad,attribution:i})}catch(t){var o={error:"Invalid equation: "+c.equation};t.name&&"NoException"==t.name&&(o.suppressAlert=!0),h(o)}})},z.computeEquationChart=function(t,e){t=t.replace(/[:]/,"/").toUpperCase();var i=0;for(var a in e){var r=new RegExp("\\["+a.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/[+\-*/%()]/g,"\\$&")+"\\]","g");t=t.replace(r,"symbol"+i),i++}var n,s=function(){function c(t){function e(){}return e.prototype=t,new e}var u=0,p=1,d=2,m=3,g=4;function f(t,e,i,a){this.type_=t,this.index_=e||0,this.prio_=i||0,this.number_=null!=a?a:0,this.toString=function(){switch(this.type_){case u:return this.number_;case p:case d:case m:return this.index_;case g:return"CALL";default:return"Invalid Token"}}}function y(t,e,i,a){this.tokens=t,this.ops1=e,this.ops2=i,this.functions=a}var v=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,x={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function t(t,e){return Number(t)+Number(e)}function e(t,e){return t-e}function i(t,e){return t*e}function a(t,e){return t/e}function r(t,e){return t%e}function n(t,e){return""+t+e}function s(t,e){return t==e}function o(t,e){return t!=e}function l(t,e){return e<t}function h(t,e){return t<e}function C(t,e){return e<=t}function S(t,e){return t<=e}function b(t,e){return Boolean(t&&e)}function w(t,e){return Boolean(t||e)}function T(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function D(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function A(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function M(t){return Math.asinh?Math.asinh(t):t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function k(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function F(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function P(t){return Math.log(t)*Math.LOG10E}function _(t){return-t}function N(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function E(t){return Math.random()*(t||1)}function L(t){for(var e=t=Math.floor(t);1<t;)e*=--t;return e}function O(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)}function I(t,e,i){return t?e:i}function H(t,e){return"[object Array]"!=Object.prototype.toString.call(t)?[t,e]:((t=t.slice()).push(e),t)}function R(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:T,cosh:D,tanh:A,asinh:M,acosh:k,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:P,log10:P,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:N,"-":_,exp:Math.exp},this.ops2={"+":t,"-":e,"*":i,"/":a,"%":r,"^":Math.pow,",":H,"||":n,"==":s,"!=":o,">":l,"<":h,">=":C,"<=":S,and:b,or:w},this.functions={random:E,fac:L,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:I},this.consts={E:Math.E,PI:Math.PI}}return z.extend(y.prototype,{simplify:function(t){t=t||{};var e,i,a,r,n=[],s=[],o=this.tokens.length,l=0;for(l=0;l<o;l++){var h=(r=this.tokens[l]).type_;if(h===u)n.push(r);else if(h===m&&r.index_ in t)r=new f(u,0,0,t[r.index_]),n.push(r);else if(h===d&&1<n.length)i=n.pop(),e=n.pop(),a=this.ops2[r.index_],r=new f(u,0,0,a(e.number_,i.number_)),n.push(r);else if(h===p&&0<n.length)e=n.pop(),a=this.ops1[r.index_],r=new f(u,0,0,a(e.number_)),n.push(r);else{for(;0<n.length;)s.push(n.shift());s.push(r)}}for(;0<n.length;)s.push(n.shift());return new y(s,c(this.ops1),c(this.ops2),c(this.functions))},substitute:function(t,e){e instanceof y||(e=(new R).parse(String(e)));var i,a=[],r=this.tokens.length,n=0;for(n=0;n<r;n++)if((i=this.tokens[n]).type_===m&&i.index_===t)for(var s=0;s<e.tokens.length;s++){var o=e.tokens[s],l=new f(o.type_,o.index_,o.prio_,o.number_);a.push(l)}else a.push(i);return new y(a,c(this.ops1),c(this.ops2),c(this.functions))},evaluate:function(t){t=t||{};var e,i,a,r,n=[],s=this.tokens.length,o=0;for(o=0;o<s;o++){var l=(r=this.tokens[o]).type_;if(l===u)n.push(r.number_);else if(l===d)i=n.pop(),e=n.pop(),a=this.ops2[r.index_],n.push(a(e,i));else if(l===m)if(r.index_ in t)n.push(t[r.index_]);else{if(!(r.index_ in this.functions))throw new Error("undefined variable: "+r.index_);n.push(this.functions[r.index_])}else if(l===p)e=n.pop(),a=this.ops1[r.index_],n.push(a(e));else{if(l!==g)throw new Error("invalid Expression");if(e=n.pop(),!(a=n.pop()).apply||!a.call)throw new Error(a+" is not a function");"[object Array]"==Object.prototype.toString.call(e)?n.push(a.apply(void 0,e)):n.push(a.call(void 0,e))}}if(1<n.length)throw new Error("invalid Expression (parity)");return n[0]},toString:function(t){var e,i,a,r,n,s=[],o=this.tokens.length,l=0;for(l=0;l<o;l++){var h=(r=this.tokens[l]).type_;if(h===u)s.push("string"==typeof(n=r.number_)?(v.lastIndex=0,v.test(n)?"'"+n.replace(v,function(t){var e=x[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+n+"'"):n);else if(h===d)i=s.pop(),e=s.pop(),a=r.index_,t&&"^"==a?s.push("Math.pow("+e+","+i+")"):s.push("("+e+a+i+")");else if(h===m)s.push(r.index_);else if(h===p)e=s.pop(),"-"===(a=r.index_)?s.push("("+a+e+")"):s.push(a+"("+e+")");else{if(h!==g)throw new Error("invalid Expression");e=s.pop(),a=s.pop(),s.push(a+"("+e+")")}}if(1<s.length)throw new Error("invalid Expression (parity)");return s[0]},variables:function(){for(var t=this.tokens.length,e=[],i=0;i<t;i++){var a=this.tokens[i];a.type_===m&&-1==e.indexOf(a.index_)&&e.push(a.index_)}return e}},!0),R.parse=function(t){return(new R).parse(t)},R.evaluate=function(t,e){return R.parse(t).evaluate(e)},R.Expression=y,R.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:T,cosh:D,tanh:A,asinh:M,acosh:k,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:P,log10:P,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:N,random:E,fac:L,exp:Math.exp,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:I,E:Math.E,PI:Math.PI},z.extend(R.prototype,{parse:function(t){this.errormsg="",this.success=!0;var e=[],i=[],a=77,r=this.tmpprio=0;for(this.expression=t,this.pos=0;this.pos<this.expression.length;){var n;if(this.isOperator())this.isSign()&&64&a?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",r++,this.addfunc(i,e,p)),a=77):this.isComment()||(0==(2&a)&&this.error_parsing(this.pos,"unexpected operator"),r+=2,this.addfunc(i,e,d),a=77);else if(this.isNumber())0==(1&a)&&this.error_parsing(this.pos,"unexpected number"),n=new f(u,0,0,this.tokennumber),i.push(n),a=50;else if(this.isString())0==(1&a)&&this.error_parsing(this.pos,"unexpected string"),n=new f(u,0,0,this.tokennumber),i.push(n),a=50;else if(this.isLeftParenth())0==(8&a)&&this.error_parsing(this.pos,'unexpected "("'),128&a&&(r+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(i,e,g)),a=333;else if(this.isRightParenth())256&a?(n=new f(u,0,0,[]),i.push(n)):0==(16&a)&&this.error_parsing(this.pos,'unexpected ")"'),a=186;else if(this.isComma())0==(32&a)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(i,e,d),r+=2,a=77;else if(this.isConst()){0==(1&a)&&this.error_parsing(this.pos,"unexpected constant");var s=new f(u,0,0,this.tokennumber);i.push(s),a=50}else if(this.isOp2())0==(4&a)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(i,e,d),r+=2,a=8;else if(this.isOp1())0==(4&a)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(i,e,p),r++,a=8;else if(this.isVar()){0==(1&a)&&this.error_parsing(this.pos,"unexpected variable");var o=new f(m,this.tokenindex,0,0);i.push(o),a=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||10<=this.tmpprio)&&this.error_parsing(this.pos,'unmatched "()"');0<e.length;){var l=e.pop();i.push(l)}return r+1!==i.length&&this.error_parsing(this.pos,"parity"),new y(i,c(this.ops1),c(this.ops2),c(this.functions))},evaluate:function(t,e){return this.parse(t).evaluate(e)},error_parsing:function(t,e){throw this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,this.column=t,new Error(this.errormsg)},addfunc:function(t,e,i){for(var a=new f(i,this.tokenindex,this.tokenprio+this.tmpprio,0);0<e.length&&a.prio_<=e[e.length-1].prio_;)t.push(e.pop());e.push(a)},isNumber:function(){for(var t=!1,e="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(48<=i&&i<=57||46===i))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},unescape:function(t,e){for(var i=[],a=!1,r=0;r<t.length;r++){var n=t.charAt(r);if(a){switch(n){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var s=parseInt(t.substring(r+1,r+5),16);i.push(String.fromCharCode(s)),r+=4;break;default:throw this.error_parsing(e+r,"Illegal escape sequence: '\\"+n+"'")}a=!1}else"\\"==n?a=!0:i.push(n)}return i.join("")},isString:function(){var t=!1,e="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=e.slice(-1)){this.pos++,this.tokennumber=this.unescape(e,i),t=!0;break}e+=this.expression.charAt(this.pos),this.pos++}return t},isConst:function(){for(var t in this.consts){var e=t.length;if(t===this.expression.substr(this.pos,e))return this.tokennumber=this.consts[t],this.pos+=e,!0}return!1},isOperator:function(){var t=this.expression.charCodeAt(this.pos);if(43===t)this.tokenprio=2,this.tokenindex="+";else if(45===t)this.tokenprio=2,this.tokenindex="-";else if(62===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex=">="):(this.tokenprio=1,this.tokenindex=">");else if(60===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex="<="):(this.tokenprio=1,this.tokenindex="<");else if(124===t){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="||"}else if(61===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="=="}else if(33===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="!="}else if(97===t){if(110!==this.expression.charCodeAt(this.pos+1)||100!==this.expression.charCodeAt(this.pos+2))return!1;this.pos++,this.pos++,this.tokenprio=0,this.tokenindex="and"}else if(111===t){if(114!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="or"}else if(42===t||8729===t||8226===t)this.tokenprio=3,this.tokenindex="*";else if(47===t)this.tokenprio=4,this.tokenindex="/";else if(37===t)this.tokenprio=4,this.tokenindex="%";else{if(94!==t)return!1;this.tokenprio=5,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var t=this.expression.charCodeAt(this.pos-1);return 45===t||43===t},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var t=this.expression.charCodeAt(this.pos);return(32===t||9===t||10===t||13===t)&&(this.pos++,!0)},isOp1:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;t+=i}return 0<t.length&&t in this.ops1&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isOp2:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;t+=i}return 0<t.length&&t in this.ops2&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isVar:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;t+=i}return 0<t.length&&(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},!0),R}().parse(t),o=[],l={},h=0,c=null,u=!1,p=[];for(a in e){var d={sym:a,map:e[a]};e[a]?p.unshift(d):p.push(d)}for(var m=0;m<p.length;m++){var g=p[m];l[g.sym]={i:0,s:g.sym},g.map?(h++,n=g.map[0]):1==h&&(u=g.sym),n.DT||(n.DT=z.strToDateTime(n.Date)),l[g.sym].d=n.DT,c||(c=l[g.sym])}var f=0===h,y=1==h&&-1==t.indexOf("%");function v(t){if(t.i++,e[t.s]){if(t.i>=e[t.s].length)return 0;n=e[t.s][t.i]}return n.DT||(n.DT=z.strToDateTime(n.Date)),t.d=n.DT,1}function x(){var t=null,e=null;for(var i in l)e?l[i].d.getTime()<e.d.getTime()?t=e=l[i]:l[i].d.getTime()>e.d.getTime()&&(t=e):e=l[i];return t?v(t)?-1:0:1}t:for(;;){var C=x();if(!C)break;if(1==C){var S;if(u){var b=e[c.s][c.i][u];b&&(b.Close||0===b.Close)&&(b=b.Close);var w=s.evaluate({symbol0:e[c.s][c.i].Close,symbol1:b});w=Number(w.toFixed(8)),(S={DT:c.d,Close:w,Adj_Close:w})[c.s]=e[c.s][c.i].Close,isNaN(w)||w==1/0||o.push(S)}else{if(f){var T=s.evaluate({});throw z.alert(t+"="+T),{name:"NoException",message:""}}i=0;var D={Adj_Close:{},Close:{},Open:{},High:{},Low:{},Volume:{}};for(a in e){for(var A in D)D[A]["symbol"+i]=e[a][l[a].i][A];i++}(S={DT:c.d}).Adj_Close=s.evaluate(D.Adj_Close),S.Close=s.evaluate(D.Close),S.Open=s.evaluate(D.Open),S.Volume=s.evaluate(D.Volume),isNaN(S.Volume)&&(S.Volume=0),S.Low=y?(S.High=s.evaluate(D.High),s.evaluate(D.Low)):(S.High=Math.max(S.Open,S.Close),Math.min(S.Open,S.Close)),isNaN(S.Close)||S.Close==1/0||o.push(S),isNaN(S.High)||(S.High=Number(S.High.toFixed(8))),isNaN(S.Low)||(S.Low=Number(S.Low.toFixed(8))),isNaN(S.Open)||(S.Open=Number(S.Open.toFixed(8))),isNaN(S.Close)||(S.Close=Number(S.Close.toFixed(8))),isNaN(S.Adj_Close)?S.Adj_Close=S.Close:S.Adj_Close=Number(S.Adj_Close.toFixed(8))}for(a in e)if(!v(l[a]))break t}}return o},(v=t.CIQ).Renderer.Shading=function(t){this.construct(t),this.beenSetup=!1,this.errTimeout=null,this.params.useChartLegend=!1,this.shading=[],"rangechannel"==this.params.type&&(this.highLowBars=!0)},v.Renderer.Shading.ciqInheritsFrom(v.Renderer.Lines,!1),v.Renderer.Shading.requestNew=function(t,e){for(var i=null,a=0;a<t.length;a++)"rangechannel"==t[a]&&(i="rangechannel");return null===i?null:new v.Renderer.Shading({params:v.extend(e,{type:i})})},v.Renderer.Shading.prototype.setShading=function(t){t.constructor!=Array&&(t=[t]),this.shading=t},v.Renderer.Shading.prototype.draw=function(){var t=this.stx,e=t.panels[this.params.panel].chart;if("rangechannel"==this.params.type)if(this.beenSetup)2<this.seriesParams.length&&this.removeSeries(this.seriesParams[2].id);else{this.beenSetup=!0,this.params.display=this.seriesParams[0].display,this.params.yAxis=this.seriesParams[0].yAxis;var i=this.seriesParams[0].color||"auto",a=this.seriesParams[0].symbol;this.removeAllSeries(!0);var r=this.params.name;t.addSeries(null,{symbol:a,loadData:!!a,field:"High",renderer:"Shading",name:r,style:"stx_line_up",display:this.params.display}),t.addSeries(null,{symbol:a,loadData:!!a,field:"Low",renderer:"Shading",name:r,style:"stx_line_down",display:this.params.display}),this.setShading({primary:this.seriesParams[0].id,secondary:this.seriesParams[1].id,color:i})}if(!this.shading&&!this.errTimeout){console.log("Warning: no shading scheme set.  Use myRenderer.setShading(scheme) to set.");var n=this;this.errTimeout=setTimeout(function(){n.errTimeout=null},1e4)}var s,o={};for(s=0;s<this.seriesParams.length;s++){var l={};e.series[this.seriesParams[s].id]&&(l=v.clone(e.series[this.seriesParams[s].id].parameters)),o[this.seriesParams[s].id]={parameters:v.extend(v.extend(l,this.params),this.seriesParams[s]),yValueCache:this.caches[this.seriesParams[s].id]}}if(t.drawSeries(e,o,this.params.yAxis,this),e.legend&&"rangechannel"==this.params.type){e.legend.colorMap||(e.legend.colorMap={});var h=this.params.display,c=[t.getCanvasColor("stx_line_up"),t.getCanvasColor("stx_line_down")];e.legend.colorMap[h]={color:c,display:h,isBase:this==t.mainSeriesRenderer}}for(s in o)this.caches[s]=o[s].yValueCache;function u(t){var e=o[t];if(e){var i=e.parameters.field,a=e.parameters.subField;return i+(a?"."+a:"")}return t}for(s=0;s<this.shading.length;s++){var p=this.shading[s],d=p.color;if("auto"==p.color&&(d=t.defaultColor),p.primary||(p.primary="Close"),p.secondary||(p.secondary=this.seriesParams[0].field),p.secondary&&d&&(o[p.primary]||"Close"==p.primary)&&o[p.secondary]&&("Close"!=p.primary||this.params.yAxis==e.yAxis)){var m=u(p.primary).split("."),g=u(p.secondary).split("."),f={topBand:m[0],topSubBand:m[1],topColor:p.greater||d,topAxis:this.params.yAxis,bottomBand:g[0],bottomSubBand:g[1],bottomColor:p.lesser||d,bottomAxis:"Close"==p.primary?null:this.params.yAxis,tension:this.params.tension||e.tension,opacity:.1};v.fillIntersecting(t,this.params.panel,f)}}},v.Renderer.Histogram=function(t){this.construct(t),this.params.type="histogram",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0,this.params.yAxis&&(this.params.bindToYAxis=!0)},v.Renderer.Histogram.ciqInheritsFrom(v.Renderer,!1),v.Renderer.Histogram.prototype.adjustYAxis=function(){this.params.yAxis&&(this.params.yAxis.min=0,this.params.yAxis.highValue/=this.params.heightPercentage||1)},v.Renderer.Histogram.prototype.draw=function(){this.stx.drawHistogram(v.clone(this.params),this.seriesParams)},v.Renderer.Heatmap=function(t){this.construct(t),this.params.type="heatmap",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0},v.Renderer.Heatmap.ciqInheritsFrom(v.Renderer,!1),v.Renderer.Heatmap.prototype.draw=function(){this.stx.drawHeatmap(v.clone(this.params),this.seriesParams)},v.Renderer.Scatter=function(t){this.construct(t),this.standaloneBars=this.barsHaveWidth=!0},v.Renderer.Scatter.ciqInheritsFrom(v.Renderer.Lines,!1),v.Renderer.Scatter.requestNew=function(t,e){for(var i=null,a=0;a<t.length;a++)"scatterplot"==t[a]&&(i="scatter");return null===i?null:new v.Renderer.Scatter({params:v.extend(e,{type:i})})},v.Renderer.Scatter.prototype.drawIndividualSeries=function(t,e){panel=this.stx.panels[e.panel]||t.panel;var i={colors:[]};return this.stx.scatter?i=this.stx.scatter(panel,e):console.warn("Error, Scatter renderer requires customChart.js"),i},(F=t.CIQ).Studies.calculateValuationLines=function(t,e,i){for(var a="field"==e.inputs.Field?"Close":e.inputs.Field,r=e.inputs["Average Type"],n=e.inputs["Display Average"],s=e.inputs["Display 1 Standard Deviation (1)"],o=e.inputs["Display 2 Standard Deviation (2)"],l=e.inputs["Display 3 Standard Deviation (3)"],h=[],c=0;c<i.length;++c)i[c]&&h.push(i[c][a]);var u=function(t,e){var i=t.length,a=0,r=0,n=0;switch(e){case"mean":for(r=i;n<i;++n)a+=t[n];break;case"harmonic":for(a=i;n<i;++n)r+=1/t[n];break;case"median":var s=Math.floor(i/2),o=t.slice().sort(function(t,e){return e<t?1:t<e?-1:0});r=i%1==0?(a=o[s]+o[s-1],2):(a=o[s],1)}return a/r}(h,r),p=!(s||o||l)||function(t,e){for(var i=t.length,a=0,r=0;r<i;++r)a+=Math.pow(t[r]-e,2);return Math.sqrt(a/i)}(h,u);e.data={Average:n?[u]:null,"1 Standard Deviation (1)":s?[u+p,u-p]:null,"2 Standard Deviation (2)":o?[u+2*p,u-2*p]:null,"3 Standard Deviation (3)":l?[u+3*p,u-3*p]:null};var d=p;if(e.parameters||(e.parameters={}),l?e.parameters.range=[u-3*p-d,u+3*p+d]:o?e.parameters.range=[u-2*p-d,u+2*p+d]:s?e.parameters.range=[u-p-d,u+p+d]:n&&(e.parameters.range=[u-d,u+d]),e.panel){var m=t.panels[e.panel],g=t.getYAxisByName(m,e.name);if(g){g.decimalPlaces=m.chart.yAxis.printDecimalPlaces;var f={yAxis:g};t.calculateYAxisRange(m,g,e.parameters.range[0],e.parameters.range[1]),t.createYAxis(m,f),t.drawYAxis(m,f)}}},F.Studies.displayValuationLines=function(t,e){var i,a,r,n,s,o,l,h,c,u=t.panels[e.panel],p=t.getYAxisByName(u,e.name),d=e.chart.context,m=e.data,g=e.parameters.labels,f=e.inputs["Average Type"],y={mean:"AVG",median:"MED",harmonic:"HAVG"},v=t.canvasStyle("ciq-valuation-average-line"),x=t.canvasStyle("ciq-valuation-deviation-line"),C=t.getCanvasFontSize("stx_yaxis")+6;for(var S in m)if(m[S])for(i="Average"==S,a=F.Studies.determineColor(e.outputs[S]),r=m[S],n=0;n<r.length;++n)if(s=r[n],!((o=t.pixelFromPrice(s,u,p))<=u.top||o>=u.yAxis.bottom))if(c=i?{pattern:"none"!=v.borderStyle&&v.borderStyle||"solid",lineWidth:parseFloat(v.borderWidth)||1,opacity:parseFloat(v.opacity)||1,yAxis:p}:{pattern:"none"!=x.borderStyle&&x.borderStyle||"dashed",lineWidth:parseFloat(x.borderWidth)||1,opacity:parseFloat(x.opacity)||1,yAxis:p},t.plotLine(u.left,u.right,o,o,a,"line",d,u,c),"yaxis"!==g){if(!((o+=Math.floor(c.lineWidth/2))+C>=u.yAxis.bottom)){l=(i?y[f]+": ":S[0]+": ")+t.formatYAxisPrice(s,u),h=d.measureText(l).width;var b=u.right-h-3;p&&"left"==p.position&&(b=u.left+3),d.strokeText(l,b,o+C/2+.5)}}else t.createYAxisLabel(u,t.formatYAxisPrice(s,u),o,a,null,d,p)},F.Studies.calculateCorrelationCoefficient=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{if(e.compare=e.inputs["Compare To"],!e.compare)for(var r in e.compare=[],e.outputs={},e.outputMap={},t.chart.series){var n=t.chart.series[r];n.parameters.color&&(e.compare.push(n.display),e.outputs["Result "+n.display]=n.parameters.color,e.outputMap["Result "+n.display+" "+e.name]="Result "+n.display)}if(e.compare.length){for(var s=0;s<e.compare.length;s++)for(var o=0,l=0,h=0,c=0,u=0,p=e.compare[s],d=0,m=e.startFrom-a;m<i.length;m++)if(i[m]){var g=i[m][p];if(g&&"object"==typeof g&&(g=g.Close),g||0===g||(g=0<m&&i[m-1]&&i[m-1]["_temps "+e.name].c?i[m-1]["_temps "+e.name].c:0),g&&"object"==typeof g&&(g=g.Close),i[m]["_temps "+e.name]={},o+=i[m]["_temps "+e.name].b=i[m].Close,l+=i[m]["_temps "+e.name].c=g,h+=i[m]["_temps "+e.name].b2=Math.pow(i[m].Close,2),c+=i[m]["_temps "+e.name].c2=Math.pow(g,2),u+=i[m]["_temps "+e.name].bc=i[m].Close*g,a<=d){o-=i[m-a]["_temps "+e.name].b,l-=i[m-a]["_temps "+e.name].c,h-=i[m-a]["_temps "+e.name].b2,c-=i[m-a]["_temps "+e.name].c2,u-=i[m-a]["_temps "+e.name].bc;var f=h/a-Math.pow(o/a,2),y=c/a-Math.pow(l/a,2),v=(u/a-o*l/Math.pow(a,2))/Math.sqrt(f*y);i[m]["Result "+p+" "+e.name]=v}d++}}else e.error="Correlation Coefficient requires at least one comparison symbol"}},F.Studies.prettify=F.extend({"2-exponential":"dema","3-exponential":"tema",hull:"hma"},F.Studies.prettify),F.extend(F.Studies.movingAverage,{conversions:{hma:"hull",dema:"2-exponential",tema:"3-exponential"},translations:{hull:"Hull","2-exponential":"Double Exponential","3-exponential":"Triple Exponential"},typeMap:{hma:"Hull",hull:"Hull",dema:"DoubleExponential","2-exponential":"DoubleExponential",tema:"TripleExponential","3-exponential":"TripleExponential"}}),F.Studies.calculateMovingAverageHull=function(t,e){var i,a,r=e.chart.scrubbed,n=e.inputs.Field;for(n&&"field"!=n||(n="Close"),F.Studies.MA("wma",e.days,n,0,"_WMA1",t,e),F.Studies.MA("wma",Math.ceil(e.days/2),n,0,"_WMA2",t,e),i=e.startFrom-1;0<=i&&((a=r[i][n])&&"object"==typeof a&&(a=a[e.subField]),!a&&0!==a);i--);for(i++;i<r.length;i++){var s=r[i];s["_MMA "+e.name]=2*s["_WMA2 "+e.name]-s["_WMA1 "+e.name]}var o=parseInt(e.inputs.Offset,10);isNaN(o)&&(o=0);var l=Math.floor(Math.sqrt(e.days));F.Studies.MA("wma",l,"_MMA "+e.name,o,"_HMA",t,e);var h=e.name;for(var c in e.outputs)h=c+" "+h;for(i=Math.max(e.days+l-1,e.startFrom);i<r.length;i++)r[i][h]=r[i]["_HMA "+e.name]},F.Studies.calculateMovingAverageDoubleExponential=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close"),F.Studies.MA("ema",e.days,a,0,"_EMA1",t,e),F.Studies.MA("ema",e.days,"_EMA1 "+e.name,0,"_EMA2",t,e);var r,n,s=parseInt(e.inputs.Offset,10);isNaN(s)&&(s=0);var o=s;for(r=e.startFrom-1;0<=r;r--)if((n=i[r][a])&&"object"==typeof n&&(n=n[e.subField]),n||0===n){if(!(0<o))break;o--}var l=e.name;for(var h in e.outputs)l=h+" "+l;for(r++;r<i.length;r++)if(!(r<2*(e.days-1))){var c=i[r];i[r+s]&&(i[r+s][l]=2*c["_EMA1 "+e.name]-c["_EMA2 "+e.name])}},F.Studies.calculateMovingAverageTripleExponential=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close"),F.Studies.MA("ema",e.days,a,0,"_EMA1",t,e),F.Studies.MA("ema",e.days,"_EMA1 "+e.name,0,"_EMA2",t,e),F.Studies.MA("ema",e.days,"_EMA2 "+e.name,0,"_EMA3",t,e);var r,n,s=parseInt(e.inputs.Offset,10);isNaN(s)&&(s=0);var o=s;for(r=e.startFrom-1;0<=r;r--)if((n=i[r][a])&&"object"==typeof n&&(n=n[e.subField]),n||0===n){if(!(0<o))break;o--}var l=e.name;for(var h in e.outputs)l=h+" "+l;for(r++;r<i.length;r++)if(!(r<3*(e.days-1))){var c=i[r];i[r+s]&&(i[r+s][l]=3*c["_EMA1 "+e.name]-3*c["_EMA2 "+e.name]+c["_EMA3 "+e.name])}},F.Studies.calculateATRBands=function(t,e){F.Studies.calculateStudyATR(t,e);var i=e.inputs.Field;i&&"field"!=i||(i="Close"),F.Studies.calculateGenericEnvelope(t,e,e.inputs.Shift,i,"ATR "+e.name)},F.Studies.calculateSTARCBands=function(t,e){F.Studies.calculateStudyATR(t,e),F.Studies.MA("simple",e.inputs["MA Period"],"Close",0,"_MA",t,e),F.Studies.calculateGenericEnvelope(t,e,e.inputs.Multiplier,"_MA "+e.name,"ATR "+e.name)},F.Studies.calculateATRStops=function(t,e){var i=e.chart.scrubbed;if(i){F.Studies.calculateStudyATR(t,e);for(var a=e.inputs.HighLow,r=Math.max(e.startFrom-1,1);r<i.length-1;r++){var n=i[r],s=i[r-1],o=n["Buy Stops "+e.name];if(o||(o=n["Sell Stops "+e.name]),o||(o=0),n&&s){var l=n.Close,h=l,c=n["ATR "+e.name]*e.inputs.Multiplier;n.Close>o&&s.Close>o?(a&&(l=n.High),h=Math.max(o,l-c)):n.Close<=o&&s.Close<=o?(a&&(l=n.Low),h=Math.min(o,l+c)):n.Close>o?(a&&(l=n.High),h=l-c):n.Close<=o&&(a&&(l=n.Low),h=l+c),l<=h?(i[r+1]["Buy Stops "+e.name]=h,delete i[r+1]["Sell Stops "+e.name]):h<l&&(i[r+1]["Sell Stops "+e.name]=h,delete i[r+1]["Buy Stops "+e.name]),i[r+1]["All Stops "+e.name]=h,e.referenceOutput="All Stops"}}}},F.Studies.calculateAwesomeOscillator=function(t,e){var i=e.chart.scrubbed;if(i.length<33)e.error=!0;else{F.Studies.MA("simple",5,"hl/2",0,"_MA5",t,e),F.Studies.MA("simple",34,"hl/2",0,"_MA34",t,e);for(var a=Math.max(e.startFrom,33);a<i.length;a++)i[a]&&(i[a][e.name+"_hist"]=i[a]["_MA5 "+e.name]-i[a]["_MA34 "+e.name])}},F.Studies.calculateRelativeVolatility=function(t,e){e.days=Number(e.inputs["Smoothing Period"]);var i=Number(e.inputs["STD Period"]),a=e.chart.scrubbed;if(a.length<e.days+i)e.error=!0;else{var r=e.inputs.Field;r&&"field"!=r||(r="Close"),e.std=new F.Studies.StudyDescriptor(e.name,"sdev",e.panel),e.std.chart=e.chart,e.std.days=i,e.std.startFrom=e.startFrom,e.std.inputs={Field:r,"Standard Deviations":1,Type:"ma"},e.std.outputs={STD:null},F.Studies.calculateStandardDeviation(t,e.std);var n,s,o=0,l=0;1<e.startFrom&&(o=a[e.startFrom-1]["_avgG "+e.name],l=a[e.startFrom-1]["_avgL "+e.name]);for(var h=Math.max(e.startFrom,e.days);h<a.length;h++){var c=a[h];c[r]>a[h-1][r]?(o=(o*(e.days-1)+c["STD "+e.name])/e.days,l=l*(e.days-1)/e.days):(l=(l*(e.days-1)+c["STD "+e.name])/e.days,o=o*(e.days-1)/e.days),c["Rel Vol "+e.name]=(n=o)+(s=l)===0?100:100*n/(n+s),c["_avgG "+e.name]=o,c["_avgL "+e.name]=l}e.zoneOutput="Rel Vol"}},F.Studies.calculatePMO=function(t,e){var i={Smooth:Number(e.inputs["Smoothing Period"])-1,Double:Number(e.inputs["Double Smoothing Period"])-1,Signal:Number(e.inputs["Signal Period"])},a=e.chart.scrubbed;if(a.length<i.Smooth+i.Double)e.error=!0;else{var r,n=e.inputs.Field;for(n&&"field"!=n||(n="Close"),r=e.startFrom;r<a.length;r++)if(a[r]&&a[r-1]){var s=a[r-1][n];s&&(a[r]["_ROCx10 "+e.name]=1e3*(a[r][n]/s-1))}F.Studies.MA("exponential",i.Smooth,"_ROCx10 "+e.name,0,"_EMAx10",t,e),F.Studies.MA("exponential",i.Double,"_EMAx10 "+e.name,0,"PMO",t,e),F.Studies.MA("exponential",i.Signal,"PMO "+e.name,0,"PMOSignal",t,e),e.zoneOutput="PMO"}},F.Studies.calculateElderImpulse=function(t,e){var i,a=e.chart.scrubbed,r=e.outputs.Bullish,n=e.outputs.Bearish,s=e.outputs.Neutral;F.Studies.MA("exponential",13,"Close",0,"_MA",t,e),e.macd=new F.Studies.StudyDescriptor("_"+e.name,"macd",e.panel),e.macd.chart=e.chart,e.macd.days=e.days,e.macd.startFrom=e.startFrom,e.macd.inputs={"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},e.macd.outputs={_MACD:null,_Signal:null},F.Studies.calculateMACD(t,e.macd);for(var o=e.startFrom;o<a.length;o++)i=0===o?s:a[o]["_MA "+e.name]>a[o-1]["_MA "+e.name]&&a[o]["_"+e.name+"_hist"]>a[o-1]["_"+e.name+"_hist"]?r:a[o]["_MA "+e.name]<a[o-1]["_MA "+e.name]&&a[o]["_"+e.name+"_hist"]<a[o-1]["_"+e.name+"_hist"]?n:s,a[o]["Result "+e.name]=i},F.Studies.calculatePivotPoints=function(t,e){var i=e.chart.scrubbed,a="day";if("day"==t.layout.interval)a="month";else if(F.ChartEngine.isDailyInterval(t.layout.interval))a="year";else if("second"==t.layout.interval||"millisecond"==t.layout.interval||"second"==t.layout.timeUnit||"millisecond"==t.layout.timeUnit)a="15min";else{var r=t.layout.periodicity;"minute"!=t.layout.interval&&(r*=t.layout.interval),30<=r&&(a="week")}var n,s,o,l=F.Market.Symbology.isForexSymbol(t.chart.symbol),h=F.Market.Symbology.isForexMetal(t.chart.symbol),c=null,u={pivotPoint:NaN,high:0,low:0,prevHigh:0,prevLow:0,hlSpread:0};function p(){u.pivotPoint=(u.high+u.low+i[d-1].Close)/3,u.prevHigh=u.high,u.prevLow=u.low,u.hlSpread=u.high-u.low,u.high=u.low=0}1<e.startFrom&&(u=F.clone(i[e.startFrom-1]["_pointers "+e.name]));for(var d=Math.max(1,e.startFrom);d<i.length;d++)if(i[d-1]){if(u.high=Math.max(u.high,i[d-1].High),u.low=Math.min(0<u.low?u.low:i[d-1].Low,i[d-1].Low),e.inputs.Continuous)p();else if("year"==a&&i[d].DT.getYear()!=i[d-1].DT.getYear())p();else if("month"==a&&i[d].DT.getMonth()!=i[d-1].DT.getMonth())p();else if("week"==a&&i[d].DT.getDay()<i[d-1].DT.getDay())p();else if("day"==a){null===c&&(n=i[d].DT,o=s=void 0,s=l?"America/New_York":t.chart.market.market_tz,o=new Date(n.getTime()+6e4*n.getTimezoneOffset()),s&&-1!=s.indexOf("UTC")||(o=F.convertTimeZone(o,"UTC",s)),c=new Date(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()).getTime()-n.getTime(),l&&(c+=60*(h?6:7)*60*1e3));var m=new Date(new Date(+i[d].DT).setMilliseconds(i[d].DT.getMilliseconds()+c));new Date(new Date(+i[d-1].DT).setMilliseconds(i[d-1].DT.getMilliseconds()+c)).getDate()!==m.getDate()&&t.chart.market.isMarketDate(m)&&(c=null,p())}else"15min"!=a||i[d].DT.getHours()==i[d-1].DT.getHours()&&Math.floor(i[d].DT.getMinutes()/15)==Math.floor(i[d-1].DT.getMinutes()/15)||p();i[d]["Pivot "+e.name]=u.pivotPoint,"fibonacci"==e.inputs.Type.toLowerCase()?(i[d]["Resistance 1 "+e.name]=u.pivotPoint+.382*u.hlSpread,i[d]["Resistance 2 "+e.name]=u.pivotPoint+.618*u.hlSpread,i[d]["Resistance 3 "+e.name]=u.pivotPoint+u.hlSpread,i[d]["Support 1 "+e.name]=u.pivotPoint-.382*u.hlSpread,i[d]["Support 2 "+e.name]=u.pivotPoint-.618*u.hlSpread,i[d]["Support 3 "+e.name]=u.pivotPoint-u.hlSpread):(i[d]["Resistance 1 "+e.name]=2*u.pivotPoint-u.prevLow,i[d]["Resistance 2 "+e.name]=u.pivotPoint+u.hlSpread,i[d]["Resistance 3 "+e.name]=u.prevHigh+2*(u.pivotPoint-u.prevLow),i[d]["Support 1 "+e.name]=2*u.pivotPoint-u.prevHigh,i[d]["Support 2 "+e.name]=u.pivotPoint-u.hlSpread,i[d]["Support 3 "+e.name]=u.prevLow-2*(u.prevHigh-u.pivotPoint)),i[d]["_pointers "+e.name]=F.clone(u)}},F.Studies.calculateVWAP=function(t,e){var i=e.chart.scrubbed;if(F.ChartEngine.isDailyInterval(t.layout.interval))e.error="VWAP is Intraday Only";else{var a,r,n,s=F.Market.Symbology.isForexSymbol(t.chart.symbol),o=F.Market.Symbology.isForexMetal(t.chart.symbol),l=null,h=0,c=0,u=!1;1<e.startFrom&&(h=i[e.startFrom-1]["_V "+e.name],c=i[e.startFrom-1]["_VxP "+e.name]);for(var p=e.startFrom;p<i.length;p++){if(null===l&&(a=i[p].DT,n=r=void 0,r=s?"America/New_York":t.chart.market.market_tz,n=new Date(a.getTime()+6e4*a.getTimezoneOffset()),r&&-1!=r.indexOf("UTC")||(n=F.convertTimeZone(n,"UTC",r)),l=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()).getTime()-a.getTime(),s&&(l+=60*(o?6:7)*60*1e3)),i[p-1]&&i[p-1].DT){var d=new Date(new Date(+i[p].DT).setMilliseconds(i[p].DT.getMilliseconds()+l));new Date(new Date(+i[p-1].DT).setMilliseconds(i[p-1].DT.getMilliseconds()+l)).getDate()!=d.getDate()&&t.chart.market.isMarketDate(d)&&(l=null,h=c=0)}var m=i[p]["hlc/3"];h+=i[p].Volume,c+=i[p].Volume*m,h&&(i[p]["VWAP "+e.name]=c/h,i[p]["_V "+e.name]=h,i[p]["_VxP "+e.name]=c,u=!0)}u||(e.error="VWAP Requires Volume")}},F.Studies.calculateMFI=function(t,e){var i,a=e.chart.scrubbed,r=0,n=e.inputs["Scale Factor"];n||(n=e.study.inputs["Scale Factor"]);var s,o=Math.pow(10,Number(n));for(1<e.startFrom&&(r=a[e.startFrom-1]["_high "+e.name]),s=e.startFrom;s<a.length;s++)a[s]&&a[s].Volume&&(a[s][e.name+"_hist"]=i=o*(a[s].High-a[s].Low)/a[s].Volume,a[s]["_high "+e.name]=r=Math.max(r,i))},F.Studies.calculateAlligator=function(t,e){var i={J:Number(e.inputs["Jaw Period"]),T:Number(e.inputs["Teeth Period"]),L:Number(e.inputs["Lips Period"])},a=e.chart.scrubbed;if(a.length<Math.max(i.J,i.T,i.L)+1)e.error=!0;else{F.Studies.MA("welles wilder",i.J,"hl/2",e.inputs["Jaw Offset"],"Jaw",t,e),F.Studies.MA("welles wilder",i.T,"hl/2",e.inputs["Teeth Offset"],"Teeth",t,e),F.Studies.MA("welles wilder",i.L,"hl/2",e.inputs["Lips Offset"],"Lips",t,e);for(var r=e.startFrom;r<a.length;r++)if(a[r]&&("Gator"==e.type&&(a[r][e.name+"_hist1"]=Math.abs(a[r]["Jaw "+e.name]-a[r]["Teeth "+e.name]),a[r][e.name+"_hist2"]=-Math.abs(a[r]["Teeth "+e.name]-a[r]["Lips "+e.name])),e.inputs["Show Fractals"])){if(!(a[r-2]&&a[r-1]&&a[r]&&a[r+1]&&a[r+2]))continue;a[r-2].High&&a[r-1].High&&a[r].High&&a[r+1].High&&a[r+2].High&&a[r].High>a[r-1].High&&a[r].High>a[r-2].High&&a[r].High>a[r+1].High&&a[r].High>a[r+2].High&&(a[r]["Fractal High "+e.name]=1),a[r-2].Low&&a[r-1].Low&&a[r].Low&&a[r+1].Low&&a[r+2].Low&&a[r].Low<a[r-1].Low&&a[r].Low<a[r-2].Low&&a[r].Low<a[r+1].Low&&a[r].Low<a[r+2].Low&&(a[r]["Fractal Low "+e.name]=1)}}},F.Studies.calculateRelativeVigor=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a;for(a=e.startFrom;a<i.length;a++)i[a]["_Change "+e.name]=i[a].Close-i[a].Open,i[a]["_Range "+e.name]=i[a].High-i[a].Low;F.Studies.MA("triangular",4,"_Change "+e.name,0,"_Numer",t,e),F.Studies.MA("triangular",4,"_Range "+e.name,0,"_Denom",t,e);var r=[],n=[];for(a=Math.max(e.startFrom-e.days,0);a<i.length;a++){r.push(i[a]["_Numer "+e.name]),n.push(i[a]["_Denom "+e.name]),r.length>e.days&&(r.shift(),n.shift());var s,o=0,l=0;for(s=0;s<r.length;s++)o+=r[s];for(s=0;s<n.length;s++)l+=n[s];0===l&&(l=1e-8),a<e.startFrom||(i[a]["Rel Vig "+e.name]=o/l)}for(F.Studies.MA("triangular",4,"Rel Vig "+e.name,0,"RelVigSignal",t,e),a=e.startFrom;a<i.length;a++)i[a][e.name+"_hist"]=i[a]["Rel Vig "+e.name]-i[a]["RelVigSignal "+e.name]}},F.Studies.calculateUlcerIndex=function(t,e){var n=e.chart.scrubbed;if(n.length<2*e.days-1)e.error=!0;else{var i,a=e.inputs.Field;for(a&&"field"!=a||(a="Close"),i=Math.max(e.startFrom,e.days-1);i<n.length;i++)n[i]["_PD2 "+e.name]=Math.pow(100*(n[i][a]/r(e.days,i,a)-1),2);for(F.Studies.MA("simple",e.days,"_PD2 "+e.name,0,"_MA",t,e),i=Math.max(e.startFrom,2*(e.days-1));i<n.length;i++)n[i]["Result "+e.name]=Math.sqrt(n[i]["_MA "+e.name])}function r(t,e,i){for(var a=null,r=e-t+1;r<=e;r++)r<0||(a=null===a?n[r][i]:Math.max(a,n[r][i]));return a}},F.Studies.calculateChoppiness=function(t,e){F.Studies.calculateStudyATR(t,e);var n=e.chart.scrubbed;if(n.length<e.days+1)e.error=!0;else for(var i=Math.max(e.startFrom,e.days);i<n.length;i++)if(n[i]){var a=r(e.days,i);n[i]["Sum True Range "+e.name]?n[i]["Result "+e.name]=100*Math.log(n[i]["Sum True Range "+e.name]/Math.max(1e-6,a[1]-a[0]))/Math.log(e.days):n[i]["Result "+e.name]=0}function r(t,e){for(var i=-1*Number.MAX_VALUE,a=Number.MAX_VALUE,r=e-t+1;r<=e;r++)r<0||(i=Math.max(i,n[r].High),a=Math.min(a,n[r].Low));return[a,i]}},F.Studies.calculateDisparity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),F.Studies.MA(e.inputs["Moving Average Type"],e.days,a,0,"_MA",t,e);for(var r=Math.max(e.startFrom,e.days-1);r<i.length;r++)i[r]&&(i[r]["Result "+e.name]=100*(i[r][a]/i[r]["_MA "+e.name]-1))}},F.Studies.calculateRainbow=function(t,e){var n=e.chart.scrubbed;if(n.length<e.days+1)e.error=!0;else{var i=e.inputs.Field;i&&"field"!=i||(i="Close");for(var a=i,r=1;r<=10;r++)F.Studies.MA("simple",e.days,a,0,"SMA"+r,t,e),a="SMA"+r+" "+e.name;for(var s=Math.max(e.startFrom,10);s<n.length;s++)if(n[s]){var o=0,l=-1*Number.MAX_VALUE,h=Number.MAX_VALUE;for(r=1;r<=10;r++){var c=n[s]["SMA"+r+" "+e.name];o+=c,l=Math.max(l,c),h=Math.min(h,c)}if(-1<e.name.indexOf("Osc")){var u=p(e.inputs["HHV/LLV Lookback"],s);n[s][e.name+"_hist"]=100*(n[s][i]-o/10)/Math.max(1e-6,u[1]-u[0]),n[s]["Over "+e.name]=100*(l-h)/Math.max(1e-6,u[1]-u[0]),n[s]["Under "+e.name]=-n[s]["Over "+e.name],n[s]["Zero "+e.name]=0}}-1<e.name.indexOf("Osc")&&(e.outputMap["Over "+e.name]=e.outputMap["Under "+e.name]=e.outputMap["Zero "+e.name]=null)}function p(t,e){for(var i=-1*Number.MAX_VALUE,a=Number.MAX_VALUE,r=e-t+1;r<=e;r++)r<0||(i=Math.max(i,n[r].Close),a=Math.min(a,n[r].Close));return[a,i]}},F.Studies.calculateKST=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close");var r={},n={};r[1]=Number(e.inputs["Lightest Rate of Change Period"]),r[2]=Number(e.inputs["Light Rate of Change Period"]),r[3]=Number(e.inputs["Heavy Rate of Change Period"]),r[4]=Number(e.inputs["Heaviest Rate of Change Period"]),n[1]=Number(e.inputs["Lightest SMA Period"]),n[2]=Number(e.inputs["Light SMA Period"]),n[3]=Number(e.inputs["Heavy SMA Period"]),n[4]=Number(e.inputs["Heaviest SMA Period"]);var s,o,l=Number(e.inputs["Signal Period"]);for(s=e.startFrom;s<i.length;s++)if(i[s])for(o=1;o<=4;o++)s>=r[o]&&i[s-r[o]]&&i[s-r[o]][a]&&(i[s]["_ROC"+o+" "+e.name]=100*(i[s][a]/i[s-r[o]][a]-1));for(o=1;o<=4;o++)F.Studies.MA("simple",n[o],"_ROC"+o+" "+e.name,0,"_SMA"+o,t,e);for(s=e.startFrom;s<i.length;s++)for(i[s]["KST "+e.name]=0,o=1;o<=4;o++)i[s]["KST "+e.name]+=o*i[s]["_SMA"+o+" "+e.name];F.Studies.MA("simple",l,"KST "+e.name,0,"KSTSignal",t,e)},F.Studies.calculateSpecialK=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs.Interval;r||(r="daily");var n,s,o={daily:[10,15,20,30,50,65,75,100,195,265,390,530],weekly:[4,5,6,8,10,13,15,20,39,52,78,104]},l={daily:[10,10,10,15,50,65,75,100,130,130,130,195],weekly:[4,5,6,8,10,13,15,20,26,26,26,39]};for(n=e.startFrom;n<i.length;n++)if(i[n])for(s=0;s<o[r].length;s++)n>=o[r][s]&&i[n-o[r][s]]&&i[n-o[r][s]][a]&&(i[n]["_ROC"+s+" "+e.name]=100*(i[n][a]/i[n-o[r][s]][a]-1));for(s=0;s<l[r].length;s++)F.Studies.MA("daily"==r?"simple":"exponential",l[r][s],"_ROC"+s+" "+e.name,0,"_MA"+s,t,e);for(n=e.startFrom;n<i.length;n++)for(s=i[n]["Result "+e.name]=0;s<l[r].length;s++)i[n]["Result "+e.name]+=(s%4+1)*i[n]["_MA"+s+" "+e.name]},F.Studies.calculateDarvas=function(t,e){var i=e.chart.scrubbed,a=0,r=parseInt(e.inputs["ATH Lookback Period"],10);e.inputs["Volume Spike"]&&F.Studies.MA("simple",r,"Volume",0,"ADV",t,e);var n,s=parseFloat(e.inputs["Volume % of Avg"])/100,o="none",l={},h=null,c=null,u=null,p=parseFloat(e.inputs["Level Offset"]),d={};for(["Darvas","Ghost","Profit","Loss","ATH","ADV","Spike"].forEach(function(t){d[t]=t+" "+e.name}),n=e.startFrom-1;0<n;n--){var m=i[n];if(!m[d.Darvas]&&!m[d.Ghost]){a=m[d.ATH]||0,c=m[d.Profit],u=m[d.Loss];break}for(var g in d)m[g]=null}for(;n<i.length;n++){var f=i[n];if(f){if(parseFloat(e.inputs["Price Minimum"])<=i[a].Close){if(!h||h.End&&n!=h.End+1||(i[n-1].Close>l.High?l={State:1,High:2*l.High-l.Low,Low:l.High,Start:n,End:2*l.End-l.Start+1}:h=null,h&&(f[d.Ghost]=F.clone(l),l.State=0,i[l.End]&&(i[l.End][d.Ghost]=F.clone(l)),h={Start:l.Start,End:l.End},c=l.High+p,(!u||u<l.Low-p)&&(u=l.Low-p))),f[d.Profit]=c,f[d.Loss]=u,f.Close>=c?c=null:"high/low"==e.inputs["Exit Field"]&&f.High>=c&&(c=null),"none"==o&&n==a+3&&!i[a+2][d.Darvas]&&!i[a+1][d.Darvas]&&!i[a][d.Darvas]&&i[a].High>f.High&&(o="high"),"high"==o&&(f.High>i[a].High?o="none":i[n-3].Low<i[n-2].Low&&i[n-3].Low<i[n-1].Low&&i[n-3].Low<f.Low&&(l={State:1,High:i[a].High,Low:i[n-3].Low,Start:a},i[a][d.Darvas]=F.clone(l),o="darvas",h&&(h.End>n&&i[h.Start]&&(f[d.Ghost]=F.clone(i[h.Start][d.Ghost]),f[d.Ghost].End=n,i[h.End]&&delete i[h.End][d.Ghost]),f[d.Ghost].State=0,i[h.Start][d.Ghost].End=n,h=null),c=l.High+p,(!u||u<l.Low-p)&&(u=l.Low-p))),"darvas"==o&&(f.Close>l.High?h={}:"high/low"==e.inputs["Exit Field"]&&f.High>l.High?h={}:f.Close<l.Low?o="none":"high/low"==e.inputs["Exit Field"]&&f.Low<l.Low&&(o="none"),h?o="none":"none"==o&&(u=c=null),e.inputs["Ghost Boxes"]||(h=null),"none"==o)){for(var y=l.Start+1;y<n;y++)i[y][d.Darvas]=F.clone(l);l.State=0,l.End=n,f[d.Darvas]=F.clone(l),f[d.ATH]=a;continue}u&&(f.Close<l.Low||"high/low"==e.inputs["Exit Field"]&&f.Low<l.Low)&&("darvas"==o&&(o="none"),(f.Close<u||"high/low"==e.inputs["Exit Field"]&&f.Low<u)&&(u=c=null),h&&(h.End>n&&i[h.Start]&&(f[d.Ghost]=F.clone(i[h.Start][d.Ghost]),f[d.Ghost].End=n,i[h.End]&&delete i[h.End][d.Ghost]),f[d.Ghost].State=0,i[h.Start][d.Ghost].End=n,h=null))}if(f.High>=i[a].High&&(a=n),(n<3||f.High>=i[n-1].High&&f.High>=i[n-2].High&&f.High>=i[n-3].High)&&r<=n-a){a=n;for(var v=0;v<r&&!(n-v<0);v++)i[n-v].High>i[a].High&&(a=n-v)}e.inputs["Volume Spike"]&&r<n&&n==a&&f[d.ADV]*s<f.Volume&&(f[d.Spike]=1),f[d.ATH]=a}}},F.Studies.calculateSupertrend=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{F.Studies.calculateStudyATR(t,e);for(var a=e.startFrom;a<i.length;a++){var r=i[a];if(r){var n=(r.High+r.Low)/2,s=e.inputs.Multiplier*r["ATR "+e.name],o=n-s,l=n+s;a&&(i[a-1]&&i[a-1].Close&&i[a-1].Close>i[a-1]["_Uptrend "+e.name]&&i[a-1]["_Uptrend "+e.name]>o&&(o=i[a-1]["_Uptrend "+e.name]),i[a-1]&&i[a-1].Close&&i[a-1].Close<i[a-1]["_Downtrend "+e.name]&&i[a-1]["_Downtrend "+e.name]<l&&(l=i[a-1]["_Downtrend "+e.name])),r["_Direction "+e.name]=1,a&&(r["_Direction "+e.name]=i[a-1]["_Direction "+e.name],r.Close>i[a-1]["_Downtrend "+e.name]?r["_Direction "+e.name]=1:r.Close<i[a-1]["_Uptrend "+e.name]&&(r["_Direction "+e.name]=-1)),r["_Uptrend "+e.name]=o,r["_Downtrend "+e.name]=l,r["Trend "+e.name]=0<r["_Direction "+e.name]?o:l}}e.outputMap={},e.outputMap["Trend "+e.name]="Trend"}},F.Studies.fetchAdditionalInstruments=function(t,e,i,a){if(t.quoteDriver){var r,n,s,o=t.panels[e.panel].chart;for(e.symbols=i,r=0;r<i.length;r++){n=s=i[r],"object"==typeof s?n=s.symbol:s={symbol:n};var l={symbol:n,symbolObject:s,bucket:"study",studyName:e.name,chartName:o.name,action:"add-study"};F.extend(l,a);var h=l.loadData;t.currentlyImporting&&(l.loadData=!1),e.series||(e.series={}),e.series[n]=t.addSeries(null,l,c),e.series[n].parameters.loadData=h}}else console.log("CIQ.Studies.fetchAdditionalInstruments: No quotefeed to fetch symbol");function c(){t.createDataSet(),t.draw()}},F.Studies.initPriceRelative=function(t,e,i,a,r,n){var s=F.Studies.initializeFN(t,e,i,a,r,n),o=[s.inputs["Comparison Symbol"].toUpperCase()];return F.Studies.fetchAdditionalInstruments(t,s,o),s},F.Studies.calculatePriceRelative=function(t,e){var i=e.chart.scrubbed,a=e.inputs["Comparison Symbol"].toUpperCase();a||(a=e.study.inputs["Comparison Symbol"]);var r={},n=t.chart.symbol.replace(/=/,"");if(r[n=n.replace(/[+\-*\\%]/g,"")]=i.slice(e.startFrom),r[n].length){n!=a&&(r[a]=null);for(var s=F.computeEquationChart("["+n+"]/["+a+"]",r),o=0,l=e.startFrom;l<i.length&&o<s.length;l++){for(;o<s.length&&i[l].DT.getTime()>s[o].DT.getTime();)o++;i[l].DT.getTime()<s[o].DT.getTime()||(i[l]["Result "+e.name]=s[o].Close,o++)}}},F.Studies.calculatePerformance=function(t,e){var i=e.chart.scrubbed,a=e.inputs["Comparison Symbol"].toUpperCase();if(a||(a=e.study.inputs["Comparison Symbol"]),e.days||(e.days=e.study.inputs.Period),i.length<e.days+1)e.error=!0;else{F.Studies.MA("ma",e.days,"Close",0,"_MA Base",t,e),F.Studies.MA("ma",e.days,a,0,"_MA Comp",t,e);for(var r=e.startFrom;r<i.length;r++){var n=i[r][a];n&&(n.Close||0===n.Close)&&(n=n.Close),i[r]["Result "+e.name]=i[r].Close/n*(i[r]["_MA Comp "+e.name]/i[r]["_MA Base "+e.name])}}},F.Studies.calculateBeta=function(t,e){var i=e.chart.scrubbed,a=e.inputs["Comparison Symbol"].toUpperCase();if(a||(a=e.study.inputs["Comparison Symbol"]),e.days||(e.days=e.study.inputs.Period),i.length<e.days+1)e.error=!0;else{for(var r=Math.max(e.startFrom,1);r<i.length;r++){i[r]["_BaseChange "+e.name]=i[r].Close/i[r-1].Close-1;var n=i[r][a];n&&(n.Close||0===n.Close)&&(n=n.Close);var s=i[r-1][a];s&&(s.Close||0===s.Close)&&(s=s.Close),i[r]["_CompChange "+e.name]=n/s-1}for(F.Studies.MA("ma",e.days,"_BaseChange "+e.name,0,"_MA Base",t,e),F.Studies.MA("ma",e.days,"_CompChange "+e.name,0,"_MA Comp",t,e),r=Math.max(e.startFrom,e.days);r<i.length;r++)i[r]["_COVARn "+e.name]=(i[r]["_BaseChange "+e.name]-i[r]["_MA Base "+e.name])*(i[r]["_CompChange "+e.name]-i[r]["_MA Comp "+e.name]),i[r]["_VARn "+e.name]=Math.pow(i[r]["_CompChange "+e.name]-i[r]["_MA Comp "+e.name],2);for(F.Studies.MA("ma",e.days,"_COVARn "+e.name,0,"_COVAR",t,e),F.Studies.MA("ma",e.days,"_VARn "+e.name,0,"_VAR",t,e),r=Math.max(e.startFrom,2*e.days-1);r<i.length;r++)i[r]["Result "+e.name]=i[r]["_COVAR "+e.name]/i[r]["_VAR "+e.name]}},F.Studies.calculateVortex=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{var r={tr:0,vmPlus:0,vmMinus:0};1<e.startFrom&&(r=F.clone(i[e.startFrom-1]["_totals "+e.name]));for(var n=Math.max(e.startFrom,1);n<i.length;n++){var s=i[n],o=i[n-1],l=Math.abs(s.High-o.Low),h=Math.abs(s.Low-o.High),c=Math.max(s.High,o.Close)-Math.min(s.Low,o.Close);r.tr+=c,r.vmPlus+=l,r.vmMinus+=h,a<n&&(r.tr-=i[n-a]["_True Range "+e.name],r.vmPlus-=i[n-a]["_VMPlus "+e.name],r.vmMinus-=i[n-a]["_VMMinus "+e.name]),s["_True Range "+e.name]=c,s["_VMPlus "+e.name]=l,s["_VMMinus "+e.name]=h,a<=n&&(s["+VI "+e.name]=r.vmPlus/r.tr,s["-VI "+e.name]=r.vmMinus/r.tr),s["_totals "+e.name]=F.clone(r)}}},F.Studies.calculateBalanceOfPower=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{for(var a=e.startFrom;a<i.length;a++){var r=i[a];r["_Ratio "+e.name]=r.Close-r.Open,r.High-r.Low!=0&&(r["_Ratio "+e.name]/=r.High-r.Low)}F.Studies.MA(e.inputs["Moving Average Type"],e.days,"_Ratio "+e.name,0,"Result",t,e)}},F.Studies.calculateTrendIntensity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),F.Studies.MA("ma",e.days,a,0,"_SMA",t,e);var r,n,s,o,l=0,h=0,c=[],u=Math.ceil(e.days/2);for(r=Math.max(0,e.startFrom-u);r<i.length;r++)(i[r]["_SMA "+e.name]||0===i[r]["_SMA "+e.name])&&((n=i[r][a]-i[r]["_SMA "+e.name])<0?h+=-1*n:l+=n,c.push(n),c.length>u&&((n=c.shift())<0?h-=-1*n:l-=n),r<e.startFrom||(i[r]["TII "+e.name]=(s=l,o=h,Math.abs(o)<1e-8?100:100-100/(1+s/o))));F.Studies.MA("ema",e.inputs["Signal Period"],"TII "+e.name,0,"Signal",t,e),e.zoneOutput="TII"}},F.Studies.calculateZigZag=function(t,a){var r=a.chart.scrubbed;if(r&&r.length){for(var e=a.highLowChart,i=null,n=null,s=a.inputs["Distance(%)"],o=0,l=0,h=0,c=null,u=null,p=0,d=Math.min(r.length-1,a.startFrom);0<=d;d--)if(r[p=d]["_state "+a.name]){var m=r[d]["_state "+a.name];i=m[0],n=m[1],o=m[2],l=m[3],h=m[4],c=m[5],u=m[6];break}for(var g=p;g<r.length;g++){var f=r[g][e?"High":"Close"],y=r[g][e?"Low":"Close"];if(null===n||n<f)if(o<0&&(i=y),c=(1-s/100)*(n=f),-1<o){if(null!==u&&u<n){r[l]["Result "+a.name]=r[l][e?"Low":"Close"],v(h,l),o=-1,i=y,h=l,l=g;continue}}else l=g;if(null===i||y<i)if(0<o&&(n=f),u=(1+s/100)*(i=y),o<1){if(null!==c&&i<c){r[l]["Result "+a.name]=r[l][e?"High":"Close"],v(h,l),o=1,n=f,h=l,l=g;continue}}else l=g}r[l]["Result "+a.name]=r[l][e?1==o?"Low":"High":"Close"],r[l]["_state "+a.name]=[i,n,o,l,h,c,u],v(h,l),r[r.length-1]["Result "+a.name]=r[r.length-1][e?1==o?"High":"Low":"Close"],v(l,r.length-1)}function v(t,e){for(var i=t+1;i<e;i++)r[i]["ShadowResult "+a.name]=(r[e]["Result "+a.name]-r[t]["Result "+a.name])*(i-t)/(e-t)+r[t]["Result "+a.name],delete r[i]["Result "+a.name]}},F.Studies.calculatePsychologicalLine=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=[],r=100/e.days,n=0,s=Math.max(e.startFrom-e.days,1);s<i.length;s++){var o=Number(i[s].Close>i[s-1].Close);o&&(n+=r),a.push(o),a.length>e.days&&(n-=a.shift()*r),s<e.startFrom||(i[s]["Result "+e.name]=n)}},F.Studies.calculateMADev=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Points Or Percent"];r||(r="Points");var n=e.inputs["Moving Average Type"];n||(n="exponential"),F.Studies.MA(n,e.days,a,0,"_MA",t,e);for(var s=e.name+"_hist",o=Math.max(e.startFrom,e.days-1);o<i.length;o++){var l=i[o],h=l[a];h&&"object"==typeof h&&(h=h[e.subField]),l[s]="Points"==r?h-l["_MA "+e.name]:100*(h/l["_MA "+e.name]-1)}}},F.Studies.calculateShinohara=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a={weakNum:0,weakDen:0,strongNum:0,strongDen:0};1<e.startFrom&&(a=F.clone(i[e.startFrom-1]["_accums "+e.name]));for(var r=e.startFrom;r<i.length;r++)a.weakNum+=i[r].High-i[r].Close,a.weakDen+=i[r].Close-i[r].Low,0<r&&(a.strongNum+=i[r].High-i[r-1].Close,a.strongDen+=i[r-1].Close-i[r].Low),r>=e.days&&(a.weakNum-=i[r-e.days].High-i[r-e.days].Close,a.weakDen-=i[r-e.days].Close-i[r-e.days].Low,i[r]["Weak Ratio "+e.name]=100*a.weakNum/a.weakDen,r>e.days&&(a.strongNum-=i[r-e.days].High-i[r-e.days-1].Close,a.strongDen-=i[r-e.days-1].Close-i[r-e.days].Low,i[r]["Strong Ratio "+e.name]=100*a.strongNum/a.strongDen)),i[r]["_accums "+e.name]=F.clone(a)}},F.Studies.calculateIchimoku=function(t,e){var i,a,n=e.chart.scrubbed,r={Base:Number(e.inputs["Base Line Period"]),Conv:Number(e.inputs["Conversion Line Period"]),LeadB:Number(e.inputs["Leading Span B Period"]),Lag:Number(e.inputs["Lagging Span Period"])};function s(t,e){for(var i=Number.MAX_VALUE,a=-1*Number.MAX_VALUE,r=e-t+1;r<=e;r++)r<0||(i=Math.min(i,n[r].Low),a=Math.max(a,n[r].High));return[i,a]}for(i=e.startFrom;i<n.length;i++)n[i]&&(a=s(r.Conv,i),n[i]["Conversion Line "+e.name]=(a[1]+a[0])/2,a=s(r.Base,i),n[i]["Base Line "+e.name]=(a[1]+a[0])/2,i<r.Lag||(n[i-r.Lag]["Lagging Span "+e.name]=n[i].Close));for(e.futureA=[],e.futureB=[],i=Math.max(0,e.startFrom-r.Base);i<n.length;i++){a=s(r.LeadB,i);var o=(n[i]["Conversion Line "+e.name]+n[i]["Base Line "+e.name])/2,l=(a[1]+a[0])/2;n[i+r.Base]?(n[i+r.Base]["Leading Span A "+e.name]=o,n[i+r.Base]["Leading Span B "+e.name]=l):(e.futureA.push(o),e.futureB.push(l))}e.chart.whiteSpaceFutureTicks=Math.max(e.chart.whiteSpaceFutureTicks,e.futureA.length-1)},F.Studies.displayIchimoku=function(a,r,t){var e="Leading Span A "+r.name,i="Leading Span B "+r.name,n=F.Studies.determineColor(r.outputs[r.outputMap[e]]),s=F.Studies.determineColor(r.outputs[r.outputMap[i]]),o=a.getYAxisByName(r.panel,r.name),l={topBand:e,bottomBand:i,topColor:n,bottomColor:s,skipTransform:a.panels[r.panel].name!=r.chart.name,topAxis:o,bottomAxis:o};function h(t,e){var i={color:!1===e?s:e?n:"transparent",opacity:.3,panelName:r.panel,yAxis:o};F.fillArea(a,t,i),a.endClip()}F.fillIntersecting(a,r.panel,l);var c=a.panels[r.panel],u=a.pixelFromBar(t.length-1,c.chart),p=a.pixelFromPrice(t[t.length-1][e],c,o),d=[[u,a.pixelFromPrice(t[t.length-1][i],c,o)],[u,p]],m=null,g=r.futureA,f=r.futureB;if(r.chart.dataSegment.length>=r.chart.scroll){for(var y=0;g&&y<g.length-1;y++)if(null!==g[y]&&!isNaN(g[y])&&null!==f[y]&&!isNaN(f[y])){var v=a.pixelFromBar(t.length+y,c.chart),x=a.pixelFromBar(t.length+y+1,c.chart),C=a.pixelFromPrice(g[y],c,o),S=a.pixelFromPrice(g[y+1],c,o),b=a.pixelFromPrice(f[y],c,o),w=a.pixelFromPrice(f[y+1],c,o);if(d.push([v,C]),d.unshift([v,b]),(m=C<b)&&w<S||!m&&S<w){var T=F.intersectLineLineX(v,x,C,S,v,x,b,w),D=F.intersectLineLineY(v,x,C,S,v,x,b,w);d.push([T,D]),h(d,m),d=[[T,D]],m=null}}2<d.length&&h(d,m)}F.Studies.displaySeriesAsLine(a,r,t)},F.Studies.displayDarvas=function(t,e,i){var a=F.Studies.determineColor(e.outputs.Levels);a&&"auto"!=a&&!F.isTransparent(a)||(a=t.defaultColor);var r=F.Studies.determineColor(e.outputs.Darvas);r&&"auto"!=r&&!F.isTransparent(r)||(r=t.defaultColor);var n=F.Studies.determineColor(e.outputs.Ghost);n&&"auto"!=n&&!F.isTransparent(n)||(n=t.defaultColor);var s,o,l,h=t.panels[e.panel],c=t.layout.candleWidth-2;if(c<2&&(c=1),t.startClip(e.panel),e.inputs["Stop Levels"]){for(t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=a,t.chart.context.beginPath(),s=0;s<i.length;s++){o=i[s];var u=i[s-1];if(o){l=o["Loss "+e.name]?Math.floor(t.pixelFromPrice(o["Loss "+e.name],h)):null;var p=u&&u["Loss "+e.name]?Math.floor(t.pixelFromPrice(u["Loss "+e.name],h)):null;if(l){o.candleWidth&&(c=Math.floor(Math.max(1,o.candleWidth)));var d=Math.floor(t.pixelFromBar(s,h.chart)+c/2),m=Math.floor(t.pixelFromBar(s,h.chart)-c/2);p&&l<=p?t.chart.context.lineTo(m,l):0===s?t.chart.context.moveTo(t.chart.left,l):t.chart.context.moveTo(m,l),t.chart.context.lineTo(d,l)}}}t.chart.context.stroke(),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}var g,f,y,v,x=-10,C=0,S=-10,b=0,w=!1,T=!1,D=t.chart.context.measureText("").width/2;for(s=0;s<i.length;s++)if(i[s]){if(i[s]["Spike "+e.name]){t.chart.context.fillStyle=r,t.chart.context.textBaseline="bottom";var A=t.pixelFromPrice(i[s].High,t.chart.panel);t.chart.context.fillText("",t.pixelFromBar(s)-D,A-5)}i[s].candleWidth&&(c=Math.floor(Math.max(1,i[s].candleWidth))),i[s]["Darvas "+e.name]&&(1!=(o=i[s]["Darvas "+e.name]).State||w?0===o.State&&(C=Math.floor(t.pixelFromBar(s,h.chart)+c/2)-x,g=Math.floor(t.pixelFromPrice(o.High,h)),f=Math.floor(t.pixelFromPrice(o.Low,h))-g,t.chart.context.strokeStyle=r,t.chart.context.fillStyle=r,e.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(x,g,C,f),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(x,g,C,f),w=!(t.chart.context.globalAlpha=1)):(x=Math.floor(t.pixelFromBar(s,h.chart)-c/2),g=Math.floor(t.pixelFromPrice(o.High,h)),f=Math.floor(t.pixelFromPrice(o.Low,h))-g,w=!0)),i[s]["Ghost "+e.name]&&e.inputs["Ghost Boxes"]&&(1!=(o=i[s]["Ghost "+e.name]).State||T?0===o.State&&(o.Start==o.End&&(S=Math.floor(t.pixelFromBar(s,h.chart)-c/2)),b=Math.floor(t.pixelFromBar(s,h.chart)+c/2)-S,y=Math.floor(t.pixelFromPrice(o.High,h)),v=Math.floor(t.pixelFromPrice(o.Low,h))-y,t.chart.context.strokeStyle=n,t.chart.context.fillStyle=n,e.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(S,y,b,v),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(S,y,b,v),T=!(t.chart.context.globalAlpha=1)):(S=Math.floor(t.pixelFromBar(s,h.chart)-c/2),y=Math.floor(t.pixelFromPrice(o.High,h)),b=Math.floor((o.End-o.Start+1)*t.layout.candleWidth+c/2),v=Math.floor(t.pixelFromPrice(o.Low,h))-y,T=!0))}if(w&&(C=Math.floor(t.pixelFromBar(s,h.chart)+c/2)-x,t.chart.context.strokeStyle=r,t.chart.context.fillStyle=r,e.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.beginPath(),t.chart.context.moveTo(x+2*C,g),t.chart.context.lineTo(x,g),t.chart.context.lineTo(x,g+f),t.chart.context.lineTo(x+2*C,g+f),t.chart.context.stroke(),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(x,g,2*C,f),t.chart.context.globalAlpha=1),T&&(t.chart.context.strokeStyle=n,t.chart.context.fillStyle=n,e.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(S,y,b,v),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(S,y,b,v),t.chart.context.globalAlpha=1),w||T){if(e.inputs["Stop Levels"]){t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=a;var M=Math.floor(t.pixelFromBar(s-1,h.chart)+c/2);l&&(t.chart.context.beginPath(),t.chart.context.moveTo(M,l),t.chart.context.lineTo(w?x+2*C:S+b,l),t.chart.context.stroke()),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}T=w=!1}t.endClip()},F.Studies.displaySupertrend=function(t,a,e){var i=t.panels[a.panel],r=t.getYAxisByName(i,a.name);function n(t,e,i){return e&&e["_Direction "+a.name]<0?a.outputs.Downtrend:a.outputs.Uptrend}var s={skipTransform:i.name!=a.chart.name,skipProjections:!0,label:t.preferences.labels,yAxis:r},o=t.chart.context;o.strokeStyle=n(0,e[e.length-1]),o.lineWidth=2,a.highlight&&(o.lineWidth=3);for(var l="Trend "+a.name,h=0;i.chart.transformFunc&&r!=i.chart.yAxis&&h<e.length;h++){var c=e[h];c&&c.transform&&(c.transform[l]=i.chart.transformFunc(t,i.chart,c[l]))}t.plotDataSegmentAsLine(l,i,s,n),o.lineWidth=1,t.startClip(a.panel);var u,p=t.chart.context.measureText("").width/2;for(u=0;u<e.length;u++)if(e[u]&&e[u-1])if(e[u-1]["_Direction "+a.name]>e[u]["_Direction "+a.name]){t.chart.context.fillStyle=a.outputs.Downtrend,t.chart.context.textBaseline="bottom";for(var d=t.pixelFromPrice(e[u].High,i,r),m=5;m<=45;m+=10)t.chart.context.fillText("",t.pixelFromBar(u)-p,d-m)}else if(e[u-1]["_Direction "+a.name]<e[u]["_Direction "+a.name]){t.chart.context.fillStyle=a.outputs.Uptrend,t.chart.context.textBaseline="top";for(var g=t.pixelFromPrice(e[u].Low,i,r),f=5;f<=45;f+=10)t.chart.context.fillText("",t.pixelFromBar(u)-p,g+f)}t.endClip()},F.Studies.displayVsComparisonSymbol=function(t,e,i){var a=e.inputs["Comparison Symbol"].toUpperCase();if(t.getSeries({symbol:a,chart:e.chart}).length){for(var r={skipTransform:t.panels[e.panel].name!=e.chart.name,panelName:e.panel,band:"Result "+e.name,threshold:e.study.centerline,yAxis:t.getYAxisByName(t.panels[e.panel],e.name),gapDisplayStyle:!0},n=i.length-1;0<=n;n--)if(i[n]&&i[n][a])return F.Studies.displaySeriesAsLine(t,e,i),void((e.study.centerline||0===e.study.centerline)&&(e.outputs.Gain&&F.preparePeakValleyFill(t,F.extend(r,{direction:1,color:F.Studies.determineColor(e.outputs.Gain)})),e.outputs.Loss&&F.preparePeakValleyFill(t,F.extend(r,{direction:-1,color:F.Studies.determineColor(e.outputs.Loss)}))))}else t.watermark(e.panel,"center","bottom",t.translateIf(e.study.name)+": "+t.translateIf("Not Available"))},F.Studies.displayMFI=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name)||a.yAxis,n=r.bottom,s=t.layout.candleWidth-2;s<2&&(s=1);var o=F.Studies.determineColor(e.outputs.Green),l=F.Studies.determineColor(e.outputs.Fade),h=F.Studies.determineColor(e.outputs.Fake),c=F.Studies.determineColor(e.outputs.Squat);t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(e.panel);for(var u=0;u<i.length;u++){var p=i[u],d=i[u-1];d||(d=t.getPreviousBar(t.chart,e.name+"_hist",u)),p&&(d&&(d[e.name+"_hist"]<p[e.name+"_hist"]?d.Volume<p.Volume?t.chart.context.fillStyle=o:d.Volume>p.Volume&&(t.chart.context.fillStyle=h):d[e.name+"_hist"]>p[e.name+"_hist"]&&(d.Volume<p.Volume?t.chart.context.fillStyle=c:d.Volume>p.Volume&&(t.chart.context.fillStyle=l))),p.candleWidth&&(s=Math.floor(Math.max(1,p.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(u,a.chart)-s/2),Math.floor(n),Math.floor(s),Math.floor(t.pixelFromPrice(p[e.name+"_hist"],a,r)-n)))}t.endClip()},F.Studies.displayAwesomeOscillator=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name),n=t.pixelFromPrice(0,a,r),s=t.layout.candleWidth-2;s<2&&(s=1);var o=F.Studies.determineColor(e.outputs["Increasing Bar"]),l=F.Studies.determineColor(e.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(e.panel);for(var h=0;h<i.length;h++){var c=i[h],u=i[h-1];u||(u=t.getPreviousBar(t.chart,e.name+"_hist",h)),c&&(u&&(u[e.name+"_hist"]<c[e.name+"_hist"]?t.chart.context.fillStyle=o:u[e.name+"_hist"]>c[e.name+"_hist"]&&(t.chart.context.fillStyle=l)),c.candleWidth&&(s=Math.floor(Math.max(1,c.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(h,a.chart)-s/2),Math.floor(n),Math.floor(s),Math.floor(t.pixelFromPrice(c[e.name+"_hist"],a,r)-n)))}t.endClip()},F.Studies.displayGator=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name),n=t.pixelFromPrice(0,a,r),s=t.layout.candleWidth-2;s<2&&(s=1);var o=F.Studies.determineColor(e.outputs["Increasing Bar"]),l=F.Studies.determineColor(e.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(e.panel);for(var h=0;h<i.length;h++){var c=i[h],u=i[h-1];if(c)for(var p=1;p<=2;p++)u||(u=t.getPreviousBar(t.chart,e.name+"_hist"+p,h)),u?Math.abs(u[e.name+"_hist"+p])<Math.abs(c[e.name+"_hist"+p])?t.chart.context.fillStyle=o:Math.abs(u[e.name+"_hist"+p])>Math.abs(c[e.name+"_hist"+p])&&(t.chart.context.fillStyle=l):t.chart.context.fillStyle="#CCCCCC",c.candleWidth&&(s=Math.floor(Math.max(1,c.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(h,a.chart)-s/2),Math.floor(n),Math.floor(s),Math.floor(t.pixelFromPrice(c[e.name+"_hist"+p],a,r)-n))}t.endClip()},F.Studies.initElderImpulse=function(t,e,i,a,r,n){var s=F.Studies.initializeFN(t,e,i,a,r,n);return t.chart.customChart={chartType:"colored_bar",colorFunction:function(t,e,i){var a=e["Result "+s.name];return a&&"object"==typeof a&&(a=a.color),a}},t.setMainSeriesRenderer(),s},F.Studies.displayPivotPoints=function(t,e,i){if(e.noSlopes=!e.inputs.Continuous,F.Studies.displaySeriesAsLine(t,e,i),e.inputs.Shading){var a=t.panels[e.panel],r={noSlopes:e.noSlopes,opacity:e.parameters.opacity?e.parameters.opacity:.2,skipTransform:a.name!=e.chart.name,yAxis:t.getYAxisByName(a,e.name)};F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Resistance 3 "+e.name,bottomBand:"Resistance 2 "+e.name,color:F.Studies.determineColor(e.outputs["Resistance 3"])},r)),F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Resistance 2 "+e.name,bottomBand:"Resistance 1 "+e.name,color:F.Studies.determineColor(e.outputs["Resistance 2"])},r)),F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Resistance 1 "+e.name,bottomBand:"Pivot "+e.name,color:F.Studies.determineColor(e.outputs["Resistance 1"])},r)),F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Support 1 "+e.name,bottomBand:"Pivot "+e.name,color:F.Studies.determineColor(e.outputs["Support 1"])},r)),F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Support 2 "+e.name,bottomBand:"Support 1 "+e.name,color:F.Studies.determineColor(e.outputs["Support 2"])},r)),F.prepareChannelFill(t,F.extend({panelName:e.panel,topBand:"Support 3 "+e.name,bottomBand:"Support 2 "+e.name,color:F.Studies.determineColor(e.outputs["Support 3"])},r))}},F.Studies.displayAlligator=function(a,t,r){function e(t,e){var i;"high"==t?(a.chart.context.fillStyle=a.defaultColor,a.chart.context.textBaseline="bottom",i=a.pixelFromPrice(r[e].High,n,s),a.chart.context.fillText("",a.pixelFromBar(o,a.chart)-a.chart.context.measureText("").width/2+1,i-5)):"low"==t&&(a.chart.context.fillStyle=a.defaultColor,a.chart.context.textBaseline="top",i=a.pixelFromPrice(r[e].Low,n,s),a.chart.context.fillText("",a.pixelFromBar(o,a.chart)-a.chart.context.measureText("").width/2+1,i+5))}var n=a.panels[t.panel],s=a.getYAxisByName(n,t.name);if(F.Studies.displaySeriesAsLine(a,t,r),t.inputs["Show Fractals"]){a.startClip(t.panel),a.chart.context.globalAlpha=t.underlay?.3:1;for(var o=2;o<r.length-2;o++)r[o]&&(r[o]["Fractal High "+t.name]&&e("high",o),r[o]["Fractal Low "+t.name]&&e("low",o));a.endClip()}},F.Studies.displayRainbowMA=function(t,e,i){for(var a=t.panels[e.panel],r=10;0<r;r--)F.Studies.displayIndividualSeriesAsLine(t,e,a,"SMA"+r+" "+e.name,i)},F.Studies.displayRainbowOsc=function(t,e,i){F.Studies.displaySeriesAsLine(t,e,i);var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name);t.startClip(e.panel);var n=t.pixelFromPrice(0,a,r),s=a.name!=e.chart.name,o=F.Studies.determineColor(e.outputs["Positive Bar"]);t.chart.context.strokeStyle=o,t.plotDataSegmentAsLine("Over "+e.name,a,{skipTransform:s,label:!1,yAxis:r});var l=t.chart.context.createLinearGradient(0,n,0,a.yAxis.top);l.addColorStop(0,t.containerColor),l.addColorStop(1,o),F.prepareChannelFill(t,{skipTransform:s,color:l,opacity:1,panelName:e.panel,topBand:"Over "+e.name,bottomBand:"Zero "+e.name,yAxis:r});var h=F.Studies.determineColor(e.outputs["Negative Bar"]);t.chart.context.strokeStyle=h,t.plotDataSegmentAsLine("Under "+e.name,a,{skipTransform:s,label:!1,yAxis:r});var c=t.chart.context.createLinearGradient(0,n,0,a.yAxis.bottom);c.addColorStop(0,t.containerColor),c.addColorStop(1,h),F.prepareChannelFill(t,{skipTransform:s,color:c,opacity:1,panelName:e.panel,topBand:"Zero "+e.name,bottomBand:"Under "+e.name,yAxis:r});var u=t.layout.candleWidth-2;u<2&&(u=1),t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC";for(var p=0;p<i.length;p++){var d=i[p];d&&(0<d[e.name+"_hist"]?t.chart.context.fillStyle=o:d[e.name+"_hist"]<0&&(t.chart.context.fillStyle=h),d.candleWidth&&(u=Math.floor(Math.max(1,d.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(p,a.chart)-u/2),Math.floor(n),Math.floor(u),Math.floor(t.pixelFromPrice(d[e.name+"_hist"],a,r)-n)))}t.endClip()},F.Studies.displayZigZag=function(t,e,i){var a=t.chart.highLowBars||t.highLowBars[t.layout.chartType];e.highLowChart!=a&&(e.highLowChart=a,e.startFrom=0,e.study.calculateFN(t,e));for(var r=t.chart,n=0;n<i.length;n++){var s=i[n];s&&(s["_shadowCopy "+e.name]&&(delete s["Result "+e.name],delete s["_shadowCopy "+e.name]),s["Result "+e.name]||s.transform&&delete s.transform["Result "+e.name])}var o=i[0],l=i[i.length-1];o&&o["ShadowResult "+e.name]&&(o["Result "+e.name]=o["ShadowResult "+e.name],o.transform&&(o.transform["Result "+e.name]=r.transformFunc(t,r,o["ShadowResult "+e.name])),o["_shadowCopy "+e.name]=1),l&&l["ShadowResult "+e.name]&&(l["Result "+e.name]=l["ShadowResult "+e.name],l.transform&&(l.transform["Result "+e.name]=r.transformFunc(t,r,l["ShadowResult "+e.name])),l["_shadowCopy "+e.name]=1),F.Studies.displaySeriesAsLine(t,e,i)},F.Studies.displayVolumeProfile=function(t,e,i){if(t&&t.chart.dataSet){var a=t.chart,r=e.parameters.numberOfBars,n=e.parameters.widthPercentage,s=e.parameters.displayBorder,p=e.parameters.displayVolume;(!r||r<0)&&(r=30),r=Math.ceil(r),(!n||n<0)&&(n=.25),!1!==s&&(s=!0),!0!==p&&(p=!1);var o=(a.highValue-a.lowValue)/r;if(0!==o){for(var d=[],l=a.lowValue;l<a.highValue+.1;l+=o)d.push([l,0]);if(d.length<2)t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"));else{for(var m=0,h=0;h<i.length;h++){var c=i[h];if(c){var u=c.Volume;e.panel==a.name&&c.transform&&(c=c.transform);for(var g=d[0][0],f=0,y=1;y<d.length;y++)f=d[y][0],(c.Low>=g&&c.Low<=f||c.Low<g&&c.High>f||c.High>=g&&c.High<=f)&&(d[y][1]+=u,d[y][1]>m&&(m=d[y][1])),g=f}}if(0!==m){t.setStyle("stx_volume_profile","color",F.Studies.determineColor(e.outputs["Bars Color"]));var v=a.context,x="stx-float-date";t.canvasFont(x,v);var C=t.getCanvasFontSize(x),S=a.panel,b=S.yAxis.bottom,w=Math.round(a.width)-.5,T=a.width*n,D=t.canvasStyle("stx_volume_profile").borderColor,A=!F.isTransparent(t.canvasStyle("stx_volume_profile").borderColor)&&s,M=t;k("stx_volume_profile",!1),A&&k("stx_volume_profile",!0),v.globalAlpha=1}else t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"))}}}function k(t,e){e||(w-=2),M.canvasColor(t),F.isIE8&&(v.globalAlpha=.5),v.beginPath();for(var i=d[0][0],a=w,r=1;r<d.length;r++){if(d[r][1]){var n=Math.round(w-d[r][1]*T/m)-.5,s=Math.round(M.pixelFromTransformedValue(i,S))+.5,o=Math.round(M.pixelFromTransformedValue(d[r][0],S))+.5;if(e||(s-=.5,o+=.5,n+=.5),b<s&&(s=b),o<b)if(v.moveTo(w,s),v.lineTo(w,o),v.lineTo(n,o),v.lineTo(n,s),e)(n<a||1==r)&&v.lineTo(a,s);else if(v.lineTo(w,s),p){var l=F.condenseInt(d[r][1]),h=s-o;if(C<=h-2){var c;try{c=v.measureText(l).width}catch(t){c=0}v.textBaseline="top";var u=v.fillStyle;v.fillStyle=D,v.fillText(l,n-c-3,o+(h/2-C/2)),v.fillStyle=u}}a=n}else a=w;i=d[r][0]}e||v.fill(),v.strokeStyle=D,e&&v.stroke(),v.closePath()}},F.Studies.studyLibrary=F.extend(F.Studies.studyLibrary,{"val lines":{name:"Valuation Lines",calculateFN:function(){},seriesFN:function(t,e,i){F.Studies.calculateValuationLines(t,e,i),F.Studies.displayValuationLines(t,e)},overlay:!0,yAxisFN:function(){},inputs:{Field:"field","Average Type":["mean","median","harmonic"],"Display Average":!0,"Display 1 Standard Deviation (1)":!1,"Display 2 Standard Deviation (2)":!1,"Display 3 Standard Deviation (3)":!1},outputs:{Average:"#00afed","1 Standard Deviation (1)":"#e1e1e1","2 Standard Deviation (2)":"#85c99e","3 Standard Deviation (3)":"#fff69e"}},correl:{name:"Correlation Coefficient",range:"-1 to 1",calculateFN:F.Studies.calculateCorrelationCoefficient,outputs:{}},PMO:{name:"Price Momentum Oscillator",calculateFN:F.Studies.calculatePMO,inputs:{Field:"field","Smoothing Period":35,"Double Smoothing Period":20,"Signal Period":10},outputs:{PMO:"auto",PMOSignal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:2.5,studyOverBoughtColor:"auto",studyOverSoldValue:-2.5,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.05"},studyOverSoldValue:{max:0,step:"0.05"}}},"Rel Vol":{name:"Relative Volatility",range:"0 to 100",calculateFN:F.Studies.calculateRelativeVolatility,inputs:{Field:"field","STD Period":10,"Smoothing Period":14},outputs:{"Rel Vol":"auto"},centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},Awesome:{name:"Awesome Oscillator",seriesFN:F.Studies.displayAwesomeOscillator,calculateFN:F.Studies.calculateAwesomeOscillator,inputs:{},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"W MFI":{name:"Market Facilitation Index",seriesFN:F.Studies.displayMFI,calculateFN:F.Studies.calculateMFI,yAxis:{ground:!0},range:"0 to max",inputs:{"Scale Factor":6},outputs:{Green:"#8bc176",Fade:"#ab611f",Fake:"#5f7cb8",Squat:"#ffd0cf"}},"ATR Bands":{name:"ATR Bands",overlay:!0,seriesFN:F.Studies.displayChannel,calculateFN:F.Studies.calculateATRBands,inputs:{Period:5,Field:"field",Shift:3,"Channel Fill":!0},outputs:{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"},attributes:{Shift:{min:.1,step:.1}}},"STARC Bands":{name:"STARC Bands",overlay:!0,seriesFN:F.Studies.displayChannel,calculateFN:F.Studies.calculateSTARCBands,inputs:{Period:15,"MA Period":5,Multiplier:1.3,"Channel Fill":!0},outputs:{"STARC Bands Top":"auto","STARC Bands Median":"auto","STARC Bands Bottom":"auto"},attributes:{Multiplier:{min:.1,step:.1}}},"ATR Trailing Stop":{name:"ATR Trailing Stops",overlay:!0,seriesFN:F.Studies.displayPSAR2,calculateFN:F.Studies.calculateATRStops,inputs:{Period:21,Multiplier:3,"Plot Type":["points","squarewave"],HighLow:!1},outputs:{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"},attributes:{Multiplier:{min:.1,step:.1}}},"Boll %b":{name:"Bollinger %b",calculateFN:F.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{"%b":"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:0,studyOverSoldColor:"auto"}},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll BW":{name:"Bollinger Bandwidth",calculateFN:F.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{Bandwidth:"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Width":{name:"Donchian Width",calculateFN:F.Studies.calculateMaxHighMinLow,inputs:{"High Period":20,"Low Period":20}},"Rel Vig":{name:"Relative Vigor Index",seriesFN:F.Studies.displayHistogramWithSeries,calculateFN:F.Studies.calculateRelativeVigor,inputs:{Period:10},outputs:{"Rel Vig":"auto",RelVigSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Impulse":{name:"Elder Impulse System",calculateFN:F.Studies.calculateElderImpulse,initializeFN:F.Studies.initElderImpulse,seriesFN:null,customRemoval:!0,underlay:!0,inputs:{},outputs:{Bullish:"#8BC176",Bearish:"#DD3E39",Neutral:"#5F7CB8"},removeFN:function(t,e){t.chart.customChart=null,t.setMainSeriesRenderer()}},"Pivot Points":{name:"Pivot Points",overlay:!0,seriesFN:F.Studies.displayPivotPoints,calculateFN:F.Studies.calculatePivotPoints,inputs:{Type:["standard","fibonacci"],Continuous:!1,Shading:!1},outputs:{Pivot:"auto","Resistance 1":"rgb(184,44,11)","Support 1":"rgb(105,145,88)","Resistance 2":"rgb(227,100,96)","Support 2":"rgb(179,217,135)","Resistance 3":"rgb(255,208,207)","Support 3":"rgb(211,232,174)"},parameters:{init:{opacity:.2}}},VWAP:{name:"VWAP",overlay:!0,calculateFN:F.Studies.calculateVWAP,inputs:{},outputs:{VWAP:"#FF0000"}},Alligator:{name:"Alligator",overlay:!0,seriesFN:F.Studies.displayAlligator,calculateFN:F.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3,"Show Fractals":!1},outputs:{Jaw:"#0000FF",Teeth:"#FF0000",Lips:"#00DD00"}},Gator:{name:"Gator Oscillator",seriesFN:F.Studies.displayGator,calculateFN:F.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0},"Ichimoku Clouds":{name:"Ichimoku Clouds",overlay:!0,calculateFN:F.Studies.calculateIchimoku,seriesFN:F.Studies.displayIchimoku,inputs:{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},outputs:{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}},"P Rel":{name:"Price Relative",initializeFN:F.Studies.initPriceRelative,seriesFN:F.Studies.displayVsComparisonSymbol,calculateFN:F.Studies.calculatePriceRelative,centerline:0,inputs:{"Comparison Symbol":"SPY"},deferUpdate:!0},"Perf Idx":{name:"Performance Index",centerline:1,initializeFN:F.Studies.initPriceRelative,seriesFN:F.Studies.displayVsComparisonSymbol,calculateFN:F.Studies.calculatePerformance,inputs:{Period:120,"Comparison Symbol":"SPY"},outputs:{Result:"auto",Gain:"#00DD00",Loss:"#FF0000"},deferUpdate:!0},Beta:{name:"Beta",centerline:1,initializeFN:F.Studies.initPriceRelative,seriesFN:F.Studies.displayVsComparisonSymbol,calculateFN:F.Studies.calculateBeta,inputs:{Period:20,"Comparison Symbol":"SPY"},deferUpdate:!0},Ulcer:{name:"Ulcer Index",calculateFN:F.Studies.calculateUlcerIndex,inputs:{Period:14,Field:"field"}},"Bal Pwr":{name:"Balance of Power",range:"-1 to 1",centerline:0,calculateFN:F.Studies.calculateBalanceOfPower,inputs:{Period:14,"Moving Average Type":"ma"}},"Trend Int":{name:"Trend Intensity Index",calculateFN:F.Studies.calculateTrendIntensity,range:"0 to 100",inputs:{Period:14,Field:"field","Signal Period":9},outputs:{TII:"auto",Signal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Choppiness:{name:"Choppiness Index",calculateFN:F.Studies.calculateChoppiness,centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:61.8,studyOverBoughtColor:"auto",studyOverSoldValue:38.2,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:50,step:"0.1"},studyOverSoldValue:{max:50,step:"0.1"}}},Disparity:{name:"Disparity Index",calculateFN:F.Studies.calculateDisparity,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}},"Rainbow MA":{name:"Rainbow Moving Average",overlay:!0,calculateFN:F.Studies.calculateRainbow,seriesFN:F.Studies.displayRainbowMA,inputs:{Period:2,Field:"field"},outputs:{SMA1:"#FF0000",SMA2:"#FF7F00",SMA3:"#FFFF00",SMA4:"#7FFF00",SMA5:"#00FF7F",SMA6:"#00FFFF",SMA7:"#007FFF",SMA8:"#0000FF",SMA9:"#7F00FF",SMA10:"#FF00FF"}},"Rainbow Osc":{name:"Rainbow Oscillator",calculateFN:F.Studies.calculateRainbow,seriesFN:F.Studies.displayRainbowOsc,centerline:0,inputs:{Period:2,Field:"field","HHV/LLV Lookback":10},outputs:{"Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"Pring KST":{name:"Pring's Know Sure Thing",calculateFN:F.Studies.calculateKST,inputs:{Field:"field","Lightest Rate of Change Period":10,"Lightest SMA Period":10,"Light Rate of Change Period":15,"Light SMA Period":10,"Heavy Rate of Change Period":20,"Heavy SMA Period":10,"Heaviest Rate of Change Period":30,"Heaviest SMA Period":15,"Signal Period":9},outputs:{KST:"#00DD00",KSTSignal:"#FF0000"}},"Pring Sp-K":{name:"Pring's Special K",calculateFN:F.Studies.calculateSpecialK,inputs:{Field:"field",Interval:["daily","weekly"]}},Darvas:{name:"Darvas Box",underlay:!0,calculateFN:F.Studies.calculateDarvas,seriesFN:F.Studies.displayDarvas,inputs:{"ATH Lookback Period":100,"Exit Field":["close","high/low"],"Ghost Boxes":!0,"Stop Levels":!1,"Level Offset":.01,"Price Minimum":5,"Volume Spike":!1,"Volume % of Avg":400},outputs:{Darvas:"#5F7CB8",Ghost:"#699158",Levels:"auto"},customRemoval:!0,attributes:{"Price Minimum":{min:.01,step:.01},yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0}}},Supertrend:{name:"Supertrend",overlay:!0,seriesFN:F.Studies.displaySupertrend,calculateFN:F.Studies.calculateSupertrend,inputs:{Period:7,Multiplier:3},outputs:{Uptrend:"#8cc176",Downtrend:"#b82c0c"},attributes:{Multiplier:{min:.1,step:.1}}},"vol profile":{name:"Volume Profile",underlay:!0,seriesFN:F.Studies.displayVolumeProfile,calculateFN:null,inputs:{},outputs:{"Bars Color":"#b64a96"},customRemoval:!0,parameters:{init:{displayBorder:!0,displayVolume:!1,numberOfBars:30,widthPercentage:.25}},attributes:{yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0}}},Vortex:{name:"Vortex Indicator",calculateFN:F.Studies.calculateVortex,centerline:1,outputs:{"+VI":"#00FF00","-VI":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:1.1,studyOverBoughtColor:"auto",studyOverSoldValue:.9,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:1,step:"0.01"},studyOverSoldValue:{max:1,step:"0.01"}}},ZigZag:{name:"ZigZag",overlay:!0,seriesFN:F.Studies.displayZigZag,calculateFN:F.Studies.calculateZigZag,inputs:{"Distance(%)":10},parameters:{init:{label:!1}},attributes:{"Distance(%)":{min:.1,step:.1}}},PSY:{name:"Psychological Line",range:"0 to 100",calculateFN:F.Studies.calculatePsychologicalLine,inputs:{Period:20}},"MA Dev":{name:"Moving Average Deviation",calculateFN:F.Studies.calculateMADev,seriesFN:F.Studies.displayHistogramWithSeries,inputs:{Period:12,Field:"field","Moving Average Type":"ma","Points Or Percent":["Points","Percent"]},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},Shinohara:{name:"Shinohara Intensity Ratio",calculateFN:F.Studies.calculateShinohara,inputs:{Period:26},outputs:{"Strong Ratio":"#E99B54","Weak Ratio":"#5F7CB8"}}}),function(t){var o,u=t.CIQ;function a(t,e,i){e||(e={});var a=document.querySelector("body");if(e.hide&&e.hide instanceof Array)for(var r=e.hide.join(", "),n=document.querySelectorAll(r),s=0;s<n.length;s++)u.appendClassName(n[s],"ciq-no-share");u.appendClassName(a,"sharing"),o(t.chart.container,{allowTaint:!1,logging:!1,width:e.width?e.width:null,height:e.height?e.height:null,background:e.background?e.background:null,useCORS:!0}).then(function(t){if(i)return u.unappendClassName(a,"sharing"),e.data?i(null,t.toDataURL("image/png")):i(null,t)})}u.Share=function(){},t.STXSocial=u.Share,u.Share.FullChart2PNG=function(t,e,i){if(t&&t.chart){if("undefined"==typeof html2canvas)return function(e){if("undefined"!=typeof html2canvas)return o=html2canvas,e();if("undefined"!=typeof requirejs)try{return requirejs(["html2canvas"],function(t){return o=t,e()})}catch(t){console.warn("Require loading has failed, attempting to load html2canvas manually.")}u.loadScript(function(){if(u.Share.html2canvasLocation)return u.Share.html2canvasLocation;for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var i=t[e];if(i.src&&-1<i.src.indexOf("share.js"))return i.src.replace(/advanced\/share\.js/,"")+"thirdparty/"}return"js/thirdparty/"}()+"/html2canvas.js",function(){return o=html2canvas,e()})}(function(){return a(t,e,i)});o=html2canvas,a(t,e,i)}},u.Share.createImage=function(t,e,i){var a=[].slice.call(arguments);i=a.pop(),null!==e&&"object"==typeof e||(e={widthPX:a[1],heightPX:a[2],imageType:a[3]});var r=e.widthPX,n=e.heightPX,s=e.imageType,o=t.chart.canvas.height,l=t.chart.canvas.width;t.chart.canvas.style.height&&(o=u.stripPX(t.chart.canvas.style.height),l=u.stripPX(t.chart.canvas.style.width)),r&&n?(o=n,l=r):n?l=t.chart.canvas.width*(o/t.chart.canvas.height):r&&(l=r,o=t.chart.canvas.height*(r/t.chart.canvas.width));var h=s?"image/"+s:"image/png",c=document.createElement("img");c.onload=function(){u.Share.FullChart2PNG(t,{image:this,width:l,height:o,hide:e.hide},function(t,e){try{i(e.toDataURL(h))}catch(t){console.warn("Safari devices do not handle CORS enabled images. Using the charts' canvas as a fallback."),i(c.src)}})},c.src=t.chart.canvas.toDataURL(h)},u.Share.uploadImage=function(t,e,i,a){i||(i={}),i.image=t,u.postAjax(e,JSON.stringify(i),function(t,e){200==t?a(null,e):a(t,null)})||a(0,null)},u.Share.shareChart=function(s,o,l){u.Share.createImage(s,{},function(t){var e=u.uniqueID(),i="https://share.chartiq.com",a=i+"/upload/"+e;o&&(o.host&&(i=o.host),o.path&&(a=i+o.path+"/"+e));var r=s.getStartDateOffset(),n={id:e,image:t,config:{layout:s.exportLayout(),drawings:s.exportDrawings(),xOffset:r,startDate:s.chart.dataSegment[r].Date,endDate:s.chart.dataSegment[s.chart.dataSegment.length-1].Date,id:e,symbol:s.chart.symbol}};u.Share.uploadImage(t,a,n,function(t,e){null!==t?u.alert("error sharing chart: ",t):l(i+e)})})}}(t),t});
//# sourceMappingURL=chartiq.min.js.map