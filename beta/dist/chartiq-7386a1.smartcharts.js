(window.webpackJsonpsmartcharts=window.webpackJsonpsmartcharts||[]).push([[0],{284:function(module,exports,__webpack_require__){(function(global){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var root,factory;!function(){var t,e=["127.0.0.1","localhost","binary.com","binary.sx","binary.me","binary.bot","deriv.com","deriv.bot","deriv.app"];if(t=new Date("2020/04/01").getTime()){var i=(new Date).getTime();if(t<=i)console.error("This license has expired!");else;}if("undefined"!=typeof document&&e&&e.length>0){for(var a=document.location.href,r=!1,s=0;s<e.length;s++)if(a.indexOf(e[s])>-1){r=!0;break}r||(alert("ERROR: Not licensed for domain "+a),console.error("ERROR: Not licensed for domain "+a))}}(),root=this,factory=function(_exports){var __js_core__init_=function(t){function e(){}return t.CIQ=e,t.STX=e,Function.prototype.ciqInheritsFrom||(Function.prototype.ciqInheritsFrom=function(t,e){var i=t.prototype||Object.getPrototypeOf(t);this.prototype=!1!==e&&"function"==typeof t?new t:Object.create(i),Object.defineProperties(this.prototype,{constructor:{configurable:!0,enumerable:!1,value:this,writable:!0},parent:{configurable:!0,enumerable:!1,value:i,writable:!0}})},Function.prototype.stxInheritsFrom=Function.prototype.ciqInheritsFrom),e.extend=function(t,i,a){var r,s;for(r in i)t!==(s=i[r])&&void 0!==s&&(null===s||!0===a?t[r]=s:s.constructor==Array?t[r]=s.slice():s.constructor==Object?t[r]=e.extend("object"===_typeof(t[r])&&null!==t[r]?t[r]:{},s):t[r]=s);return t},t},__js_core__polyfills_=function(t){"use strict";var e=("undefined"!=typeof window?window:null)||(void 0!==global?global:self);function i(t,e){var i=document.createEvent("Event");return i.initEvent(t,!(!e||!e.bubbles),!(!e||!e.cancelable)),i}function a(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!(!e||!e.bubbles),!(!e||!e.cancelable),e&&e.detail),i}e.Event&&"function"!=typeof e.Event&&(i.prototype=e.Event.prototype,e.Event=i),e.CustomEvent&&"function"!=typeof e.CustomEvent&&(a.prototype=e.CustomEvent.prototype,e.CustomEvent=a)},__js_core_core_=function(t){t.SplinePlotter||(t.SplinePlotter={});var e=t.CIQ,i=t.SplinePlotter;t.SplinePlotter.plotSpline||(t.SplinePlotter.plotSpline=function(t,e,i,a){window.splineWarning||console.log("Warning: Cannot find implementation of splining.  Try loading splines.js"),window.splineWarning=1;var r=0;i.moveTo(t[0],t[1]);for(var s=2;s<t.length;s+=2){if(a&&r<a.length){var n=a[r];n.coord[0]==t[s-2]&&n.coord[1]==t[s-1]&&(i.stroke(),i.strokeStyle=n.color,i.setLineDash(n.pattern),i.lineDashOffset=0,i.lineWidth=n.width,i.beginPath(),i.moveTo(t[s-2],t[s-1]),r++)}i.lineTo(t[s],t[s+1])}}),e.getETDateTime=function(){var t=new Date;return e.convertTimeZone(new Date(t.getTime()+6e4*t.getTimezoneOffset()),"UTC","America/New_York")},e.fromET=function(t){var e=new Date,i=4;(e.getMonth()<2||2==e.getMonth()&&e.getDate()<11||e.getMonth()>10||10==e.getMonth()&&e.getDate()>=4)&&(i=5);var a=t.getTime()+36e5*i;return new Date(a)},e.convertFutureMonth=function(t){var e=t.toString();if(e.length<=0||e.length>2)return"";switch(e){case"1":return"F";case"2":return"G";case"3":return"H";case"4":return"J";case"5":return"K";case"6":return"M";case"7":return"N";case"8":return"Q";case"9":return"U";case"10":return"V";case"11":return"X";case"12":return"Z";case"F":return"1";case"G":return"2";case"H":return"3";case"J":return"4";case"K":return"5";case"M":return"6";case"N":return"7";case"Q":return"8";case"U":return"9";case"V":return"10";case"X":return"11";case"Z":return"12"}return e},e.money=function(t,i,a){return a||(a="$"),3==a.length&&(a+=" "),i||0===i||(i=2),a+e.commas((Math.round(1e4*t)/1e4).toFixed(i))},e.convertCurrencyCode=function(t){var e={JPY:"¥",USD:"$",AUD:"A$",BRL:"R$",CAD:"CA$",CNY:"CN¥",CZK:"Kč",DKK:"kr",EUR:"€",GBP:"£",HKD:"HK$",HUF:"Ft",ILS:"₪",INR:"₹",KRW:"₩",MXN:"MX$",NOK:"kr",NZD:"NZ$",PLN:"zł",RUB:"руб",SAR:"﷼",SEK:"kr",SGD:"S$",THB:"฿",TRY:"₺",TWD:"NT$",VND:"₫",XAF:"FCFA",XCD:"EC$",XOF:"CFA",XPF:"CFPF",ZAR:"R"}[t];return e||t},e.commas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},e.alert=function(t){alert(t)},e.withinElement=function(t,e,i){var a=t.getBoundingClientRect();return!(e<=a.left)&&(!(i<=a.top)&&(!(e>=a.left+t.offsetWidth)&&!(i>=a.top+t.offsetHeight)))},e.efficientDOMUpdate=function(t,e,i){t[e]!==i&&(t[e]=i)},e.safeMouseOut=function(t,i){t.addEventListener("mouseout",function(t,i){return function(a){void 0===a.pageX&&(a.pageX=a.clientX,a.pageY=a.clientY),e.withinElement(t,a.pageX,a.pageY)||(t.stxMouseOver=!1,i(a))}}(t,i))},e.safeMouseOver=function(t,i){t.addEventListener("mouseover",function(t,i){return function(a){if(void 0===a.pageX&&(a.pageX=a.clientX,a.pageY=a.clientY),e.withinElement(t,a.pageX,a.pageY)){if(t.stxMouseOver)return;t.stxMouseOver=!0,i(a)}}}(t,i))},e.installTapEvent=function(t,i){e.safeClickTouch(t,function(t){var e=new Event("stxtap",{bubbles:!0,cancelable:!0});void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),e.pageX=t.pageX,e.pageY=t.pageY,t.target.dispatchEvent(e),i&&i.stopPropagation&&t.stopPropagation()},i)},e.safeClickTouch=function(t,i,a){a||(a={});var r={};function s(t,a,r){return function(s){if(!e.safeClickTouchEvent){if(!r.t)return;var n=r.t;if(r.t=null,n+1e3<(new Date).getTime())return}if(!(a.safety&&a.safety.recentlyDragged||(s||(s=event),s.which&&s.which>=2||s.button&&s.button>=2))){if(a.preventUnderlayClick)"INPUT"!==s.target.tagName&&s.preventDefault();else{if(a.lastType!=t&&Date.now()<a.allowAnotherDevice)return;a.lastType=t,a.allowAnotherDevice=Date.now()+1e3}i(s)}}}function n(t,e){return function(i){var a=i.clientX?i.clientX:i.pageX,r=i.clientY?i.clientY:i.pageY;e?(t.t=(new Date).getTime(),t.x=a,t.y=r):t.x&&Math.pow(t.x-a,2)+Math.pow(t.y-r,2)>16&&(t.t=null)}}a.allowMultiple||e.clearSafeClickTouches(t),!1!==a.preventUnderlayClick&&(a.preventUnderlayClick=!0),!1!==a.absorbDownEvent&&(a.absorbDownEvent=!0),a.allowAnotherDevice=0,a.registeredClick=!1;var o=t.safeClickTouchEvents;o||(o=t.safeClickTouchEvents=[]);var l=s("mouseup",a,r),h=s("touchend",a,r),c=s("pointerup",a,r),u=function(t){t.stopPropagation()},p={};if(e.safeClickTouchEvent){var d=s(e.safeClickTouchEvent,a);t.addEventListener(e.safeClickTouchEvent,d),p[e.safeClickTouchEvent]=d,o.push(p)}else"onpointerup"in document&&!e.noPointerEvents?(t.addEventListener("pointerdown",n(r,!0)),t.addEventListener("pointermove",n(r)),t.addEventListener("pointerup",c),p.pointerup=c,a.absorbDownEvent&&(t.addEventListener("pointerdown",u),p.pointerdown=u),o.push(p)):(t.addEventListener("mousedown",n(r,!0)),t.addEventListener("mousemove",n(r)),t.addEventListener("touchstart",n(r,!0)),t.addEventListener("touchmove",n(r)),t.addEventListener("mouseup",l),t.addEventListener("touchend",h),p.mouseup=l,p.touchend=h,a.absorbDownEvent&&(t.addEventListener("mousedown",u),p.mousedown=u,t.addEventListener("touchstart",u),p.touchstart=u),o.push(p))},e.clearSafeClickTouches=function(t){var e=t.safeClickTouchEvents;if(e){for(var i=0;i<e.length;i++){var a=e[i];for(var r in a){var s=a[r];t.removeEventListener(r,s)}}t.safeClickTouchEvents=null}};var a=function(t,e){return function(i){if(i.touches){if(i.touches.length>0)return i.touches[0][t];if(i.changedTouches&&i.changedTouches.length>0)return i.changedTouches[0][t]}return void 0!==i[t]?i[t]:i[e]}},r=a("pageX","clientX"),s=a("pageY","clientY");return e.safeDrag=function(t,i){"function"==typeof i&&(i={down:arguments[1],move:arguments[2],up:arguments[3]}),i=i||{};var a=100,n=!1,o=0,l=0,h={recentlyDragged:!1};function c(t){return function(c){if(!n){n=!0,e.ChartEngine.ignoreTouch=!0;var u=function(t){t&&t.preventDefault&&t.preventDefault(),h.recentlyDragged=!0,t.displacementX=r(t)-o,t.displacementY=s(t)-l,i.move(t)};i.move&&document.body.addEventListener(t.move,u);document.body.addEventListener(t.up,function a(n){e.ChartEngine.ignoreTouch=!1,i.move&&document.body.removeEventListener(t.move,u),document.body.removeEventListener(t.up,a),n.displacementX=r(n)-o,n.displacementY=s(n)-l,i.up&&i.up(n),setTimeout(function(){h.recentlyDragged=!1},50)}),setTimeout(function(){n=!1},a),o=r(c),l=s(c),i.down&&i.down(c)}}}return t.addEventListener("mousedown",c({down:"mousedown",move:"mousemove",up:"mouseup"})),t.addEventListener("pointerdown",c({down:"pointerdown",move:"pointermove",up:"pointerup"})),t.addEventListener("touchstart",c({down:"touchstart",move:"touchmove",up:"touchend"})),h},e.inputKeyEvents=function(t,e){t.addEventListener("keyup",function(i){switch(window.event?event.keyCode:i.keyCode){case 13:e();break;case 27:t.value=""}},!1)},e.fixScreen=function(){window.scrollTo(0,0)},e.setCaretPosition=function(t,i){if(t.style.zIndex=5e3,t.setSelectionRange){e.focus(t);try{t.setSelectionRange(i,i)}catch(t){}}else if(t.createTextRange){var a=t.createTextRange();a.collapse(!0),a.moveEnd("character",i),a.moveStart("character",i),a.select()}},e.setValueIfNotActive=function(t,e){document.activeElement!=t&&(t.value=e)},e.hideKeyboard=function(t){var e=document.activeElement;"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.blur(),window.focus(),t&&(t===document.body||document.body.contains(t))&&t.focus())},e.smartHover=function(){if(document&&!document.documentElement.hasAttribute("ciq-last-interaction")){var t,e=!1;document.addEventListener("touchend",function(a){clearTimeout(t),e=!0,"touch"!=document.documentElement.getAttribute("ciq-last-interaction")&&i("touch"),t=setTimeout(function(){e=!1},500)},!1),document.addEventListener("mouseover",function(t){e||i("mouse")},!1),i("")}function i(t){document.documentElement.setAttribute("ciq-last-interaction",t)}},e.boxIntersects=function(t,e,i,a,r,s,n,o,l){void 0!==arguments[9]&&console.warn("CIQ.boxIntersects() no longer supports isLog argument, please be sure arguments are passed in as pixels.");var h=Math.min(t,i),c=Math.max(t,i),u=Math.min(e,a),p=Math.max(e,a),d="ray"==l;if(isNaN(r)||isNaN(n)||isNaN(s)||isNaN(o))return!1;if("line"!=l){if(r<h&&n<h&&(!d||r>n))return!1;if(r>c&&n>c&&(!d||r<n))return!1;if(s<u&&o<u&&(!d||s>o))return!1;if(s>p&&o>p&&(!d||s<o))return!1}function m(t,e){return(e-s)*(n-r)-(t-r)*(o-s)}var g={a:m(t,e),b:m(t,a),c:m(i,e),d:m(i,a)};return!(g.a>0&&g.b>0&&g.c>0&&g.d>0)&&!(g.a<0&&g.b<0&&g.c<0&&g.d<0)},e.convertBoxToPixels=function(t,e,i){var a=t.panels[e];return{x0:t.pixelFromTick(i.x0,a.chart),x1:t.pixelFromTick(i.x1,a.chart),y0:i.cy0||0===i.cy0?i.cy0:t.pixelFromValueAdjusted(a,i.x0,i.y0),y1:i.cy1||0===i.cy1?i.cy1:t.pixelFromValueAdjusted(a,i.x1,i.y1)}},e.linesIntersect=function(t,e,i,a,r,s,n,o,l){var h=(o-n)*(e-t)-(s-r)*(a-i),c=(s-r)*(i-n)-(o-n)*(t-r),u=(e-t)*(i-n)-(a-i)*(t-r);if(0===h)return 0===c&&0===u;var p=c/h,d=u/h;if("segment"==l){if(p>=0&&p<=1&&d>=0&&d<=1)return!0}else if("line"==l||"horizontal"==l||"vertical"==l){if(p>=0&&p<=1)return!0}else if("ray"==l&&p>=0&&p<=1&&d>=0)return!0;return!1},e.yIntersection=function(t,e){var i=t.x0,a=t.x1,r=e,s=e,n=t.y0,o=t.y1,l=1e4*(a-i)-(s-r)*(o-n),h=(s-r)*(n-0)-1e4*(i-r),c=h/l;if(0===l){if(0!==h)return null;c=1}return n+c*(o-n)},e.xIntersection=function(t,e){var i=t.x0,a=t.x1,r=t.y0,s=(e-e)*(a-i)-1e4*(t.y1-r),n=1e4*(r-e)-(e-e)*(i-0),o=n/s;if(0===s){if(0!==n)return null;o=1}return i+o*(a-i)},e.intersectLineLineX=function(t,e,i,a,r,s,n,o){return t+((s-r)*(i-n)-(o-n)*(t-r))/((o-n)*(e-t)-(s-r)*(a-i))*(e-t)},e.intersectLineLineY=function(t,e,i,a,r,s,n,o){return i+((s-r)*(i-n)-(o-n)*(t-r))/((o-n)*(e-t)-(s-r)*(a-i))*(a-i)},e.privateBrowsingAlert=!1,e.localStorage="undefined"!=typeof localStorage?localStorage:{},e.localStorageSetItem=function(t,i){try{e.localStorage.setItem(t,i)}catch(t){e.privateBrowsingAlert||(e.alert("No storage space available.  Possible causes include browser being in Private Browsing mode, or maximum storage space has been reached."),e.privateBrowsingAlert=!0)}},e.loadUI=function(t,i,a){i&&"function"!=typeof i||(a=i,i=document.body);var r=document.querySelector('iframe[original-url="'+t+'"]'),s=function(){var t=null;try{t=this.contentDocument}catch(t){return a(t)}if(t&&!t.title){var r=t.body.innerHTML,s=document.createElement("div");e.innerHTML(s,r);for(var n=0;n<s.children.length;n++){var o=s.children[n].cloneNode(!0);i.appendChild(o)}a(null)}else a(new Error("iFrame not found or document has a title"))};if(r){var n=null;try{n=r.contentDocument}catch(t){return a(t)}"complete"===n.readyState&&n.location&&"about:blank"!==n.location.href?s.call(r):r.addEventListener("load",s)}else(r=document.createElement("iframe")).setAttribute("original-url",t),r.src=t+(-1===t.indexOf("?")?"?":"&")+e.uniqueID(),r.hidden=!0,r.addEventListener("load",s),document.body.appendChild(r)},e.loadScript=function(t,i){if(e.loadedScripts||(e.loadedScripts={}),e.loadedScripts[t])i&&i();else{var a=document.createElement("SCRIPT");a.async=!0,a.onload=function(){e.loadedScripts[t]=!0,i&&i()},"undefined"!=typeof isIE8&&(a.onreadystatechange=function(){"loaded"==a.readyState&&(e.loadedScripts[t]=!0,i&&setTimeout(i,0))});var r=t;r=-1==r.indexOf("?")?r+"?"+Date.now():r+"&"+Date.now(),a.src=r;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s.nextSibling)}},e.loadStylesheet=function(t,e){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="screen",i.href=t+(-1===t.indexOf("?")?"?":"&")+Date.now(),i.onload=function(){this.loaded||(this.loaded=!0,e&&e())};var a=document.getElementsByTagName("link"),r=a[a.length-1];r.parentNode.insertBefore(i,r.nextSibling)},e.loadWidget=function(t,i,a){i&&"function"!=typeof i||(a=i,i=document.body),e.loadStylesheet(t+".css",function(){e.loadUI(t+".html",i,function(i){i?a(i):e.loadScript(t+".js",a)})})},e.waitForPlugins=function(t,i){var a=0,r=t.length;if(r){for(var s=0;s<r;s++){var n="cq-"+t[s],o=document.getElementsByTagName(n)[0];o&&o.hasAttribute("loaded")&&a++}if(r!==a)return setTimeout(function(){e.waitForPlugins(t,i)},0);i()}else i()},e.fillTransparentCanvas=function(t,e,i,a){var r=t.globalCompositeOperation;t.globalCompositeOperation="destination-over",t.fillStyle=e,t.fillRect(0,0,i,a),t.globalCompositeOperation=r},e.tickedRect=function(t){e.rect(t);var i=Math.round(t.top+t.height/2)+.5;t.ctx.beginPath(),t.ctx.moveTo(t.x-2,i),t.ctx.lineTo(t.x,i),t.ctx.stroke(),t.ctx.closePath()},e.roundRect=function(t,i){9===arguments.length&&(t={ctx:arguments[0],x:arguments[1],top:arguments[2],width:arguments[3],height:arguments[4],radius:arguments[5],fill:arguments[6],stroke:arguments[7],edge:arguments[8]});var a=t.stroke,r=t.x,s=t.top,n=t.width,o=t.height,l=t.radius,h=t.fill,c=t.ctx;void 0===a&&(a=!0),void 0===l&&(l=5,n<0&&(l=-5));var u=n<0?-1*l:l;l&&!i&&(r-=1);var p=r+l,d=r+n,m=s+u,g=s+o,f=d-l,y=g-u;if(c.beginPath(),c.moveTo(p,s),c.lineTo(f,s),c.quadraticCurveTo(d,s,d,m),c.lineTo(d,y),c.quadraticCurveTo(d,g,f,g),c.lineTo(p,g),"flush"==i)c.lineTo(r,g),c.lineTo(r,s);else if("arrow"==i){c.quadraticCurveTo(r,g,r-l,y);var v=n<0?1:-1;c.lineTo(r+o/2*v,s+o/2),c.lineTo(r-l,m),c.quadraticCurveTo(r,s,p,s)}else c.quadraticCurveTo(r,g,r,y),c.lineTo(r,m),c.quadraticCurveTo(r,s,p,s);c.closePath(),t.backgroundColor&&(c.fillStyle=t.backgroundColor),a&&c.stroke(),h&&c.fill(),t.txt&&e.createLabel(t)},e.createLabel=function(t){t.ctx.textBaseline="middle",t.ctx.fillStyle=t.color?t.color:e.chooseForegroundColor(t.backgroundColor),t.ctx.fillStyle===t.backgroundColor&&("#FFFFFF"==t.backgroundColor.toUpperCase()?t.ctx.fillStyle="#000000":t.ctx.fillStyle="#FFFFFF"),t.ctx.fillText(t.txt,t.x+t.margin.left,t.y+t.margin.top),t.ctx.textAlign="left"},e.roundRectArrow=function(t){e.roundRect(t,"arrow")},e.semiRoundRect=function(t){e.roundRect(t,"flush")},e.rect=function(t){t.radius=0,e.roundRect(t)},e.noop=function(t){t.color=t.backgroundColor,e.createLabel(t)},e.getLines=function(t,e,i){for(var a=e.split(" "),r=[],s="",n=!1,o=0;o<a.length;o++){var l=a[o];if(t.measureText(s+l).width<i?(n&&(s+=" "),n=!0,s+=l):(r.push(s),s=l),o===a.length-1){r.push(s);break}}return r},e.readablePeriodicity=function(t){var e=t.layout.periodicity,i=t.layout.interval;return"number"==typeof t.layout.interval&&t.layout.timeUnit?(e=t.layout.interval*t.layout.periodicity,i=t.layout.timeUnit):"number"!=typeof t.layout.interval||t.layout.timeUnit||(e=t.layout.interval*t.layout.periodicity,i="minute"),e%60==0&&"minute"==i&&(e/=60,i="hour"),e+" "+t.translateIf(i.capitalize())},e.translatableTextNode=function(t,e,i){if(t.translationCallback){var a=document.createElement("translate");return a.setAttribute("original",e),a.innerHTML=t.translationCallback(e,i),a}return document.createTextNode(e)},e.clearCanvas=function(t,i){t.isDirty=!1;var a=t.context;if(a.clearRect(0,0,t.width,t.height),e.isAndroid&&!e.is_chrome&&!e.isFF){e.ChartEngine.useOldAndroidClear&&i&&(a.fillStyle=i.containerColor,a.fillRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height));var r=t.width;t.width=1,t.width=r}},e.monthLetters=["J","F","M","A","M","J","J","A","S","O","N","D"],e.monthAbv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.MILLISECOND=1,e.SECOND=1e3,e.MINUTE=60*e.SECOND,e.HOUR=60*e.MINUTE,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.MONTH=31*e.DAY,e.YEAR=366*e.DAY,e.DECADE=10*e.YEAR-7*e.DAY,e.monthAsDisplay=function(t,i,a){return i?a&&a.monthLetters?a.monthLetters[t]:e.monthLetters[t]:a&&a.monthAbv?a.monthAbv[t]:e.monthAbv[t]},e.timeAsDisplay=function(t,i,a){var r=i?i.internationalizer:null;if(r)return a==e.SECOND?r.hourMinuteSecond.format(t):a==e.MILLISECOND?r.hourMinuteSecond.format(t)+"."+t.getMilliseconds():r.hourMinute.format(t);var s=t.getMinutes();s<10&&(s="0"+s);var n=t.getHours()+":"+s,o="";if(a<=e.SECOND&&((o=t.getSeconds())<10&&(o="0"+o),n+=":"+o),a==e.MILLISECOND){var l=t.getMilliseconds();l<10?l="00"+l:l<100&&(l="0"+l),n+="."+l}return n},e.displayableDate=function(t,i,a){function r(t){return t<10?"0"+t:t}var s="",n=t.layout.interval,o=e.ChartEngine.isDailyInterval(n);if(i.xAxis.formatter)s=i.xAxis.formatter(a);else if(t.internationalizer)s=t.internationalizer.monthDay.format(a),o?s="month"==n?t.internationalizer.yearMonth.format(a):t.internationalizer.yearMonthDay.format(a):s+=" "+t.internationalizer.hourMinute.format(a);else{var l=r(a.getMonth()+1),h=r(a.getDate()),c=r(a.getHours()),u=r(a.getMinutes());if(o)s="month"==n?l+"-":l+"-"+h+"-",s+=a.getFullYear();else{s=l+"/"+h+" "+c+":"+u;var p=i.xAxis.activeTimeUnit&&i.xAxis.activeTimeUnit<=e.SECOND||"second"==t.layout.timeUnit,d=i.xAxis.activeTimeUnit&&i.xAxis.activeTimeUnit<=e.MILLISECOND||"millisecond"==t.layout.timeUnit;if(p||d)if(s+=":"+r(a.getSeconds()),d){var m=r(a.getMilliseconds());m<100&&(m="0"+m),s+=":"+m}}}return s},e.fixPrice=function(t){if(!t&&0!==t)return null;for(var e=t.toFixed(10),i=e.length-1;i>1&&"0"==e.charAt(i);i--);return e=e.substring(0,i+1),parseFloat(e)},e.condenseInt=function(t){return null==t?"":t===1/0||t===-1/0?"n/a":t=t>0?t>1e12?Math.round(t/1e11)/10+"t":t>1e11?Math.round(t/1e9)+"b":t>1e10?(Math.round(t/1e8)/10).toFixed(1)+"b":t>1e9?(Math.round(t/1e7)/100).toFixed(2)+"b":t>1e8?Math.round(t/1e6)+"m":t>1e7?(Math.round(t/1e5)/10).toFixed(1)+"m":t>1e6?(Math.round(t/1e4)/100).toFixed(2)+"m":t>1e5?Math.round(t/1e3)+"k":t>1e4?(Math.round(t/100)/10).toFixed(1)+"k":t>1e3?(Math.round(t/10)/100).toFixed(2)+"k":t.toString():t<-1e12?Math.round(t/1e11)/10+"t":t<-1e9?Math.round(t/1e8)/10+"b":t<-1e6?Math.round(t/1e5)/10+"m":t<-1e3?Math.round(t/100)/10+"k":t.toString()},e.calculateTradingDecimalPlaces=function(t){var e=t.chart,i=2,a=e.masterData;if(a&&a.length>50)for(var r=2;r<50;r++){var s=a.length-r;if(s<0)break;var n=a[s];if(n.Close&&"number"==typeof n.Close){var o=n.Close.toString(),l=o.indexOf(".");if(-1!=l){var h=o.length-l-1;h>i&&(i=h)}}}var c=e.yAxis.maxDecimalPlaces;return i>c&&null!==c&&(i=c),i},e.fillArea=function(t,e,a){if(e.length){var r=t.chart.context,s=r.globalAlpha,n=arguments[2],o=arguments[3],l=arguments[4],h=0,c=null;a&&"object"==_typeof(a)&&(n=a.color,o=a.opacity,h=a.tension,l=a.panelName,c=a.yAxis),o||0===o||(o=.2),"auto"==n&&(n=t.defaultColor),r.globalAlpha=o,n&&(r.fillStyle=n);var u,p=Number.MAX_VALUE,d=-1*p,m=t.panels[l];if(m&&(d=(c||m.yAxis).top,p=(c||m.yAxis).bottom,r.save(),r.beginPath(),r.rect(m.left,d,m.width,p-d),r.clip()),r.beginPath(),h){var g=[];for(u=0;u<e.length-2;u++)g.push(e[u][0],e[u][1]);for(i.plotSpline(g,h,r),u=e.length-2;u<e.length;u++)r.lineTo(Math.round(e[u][0]),Math.round(e[u][1]))}else for(r.moveTo(e[0][0],e[0][1]),u=1;u<e.length;u++)r.lineTo(e[u][0],e[u][1]);r.closePath(),r.fill(),m&&r.restore(),r.globalAlpha=s}},e.prepareChannelFill=function(t,i){(!i||i instanceof Array)&&(i=arguments[2]),i.gapDisplayStyle||!1===i.gapDisplayStyle||(i.gapDisplayStyle=i.gaps);var a=t.panels[i.panelName],r=t.chart,s=(r.context.strokeStyle,{noDraw:i.noDraw,gapDisplayStyle:i.gapDisplayStyle}),n=e.ensureDefaults(i,{noDraw:!0,gapDisplayStyle:{},yAxis:a.yAxis}),o=t.plotDataSegmentAsLine(i.topBand,a,n),l=t.plotDataSegmentAsLine(i.bottomBand,a,n);i.noDraw=s.noDraw,i.gapDisplayStyle=s.gapDisplayStyle;for(var h=[],c=0;c<o.points.length;c+=2)h.push([o.points[c],o.points[c+1]]);for(var u=l.points.length-1;u>=0;u-=2)h.push([l.points[u-1],l.points[u]]);e.fillArea(t,h,i)},e.preparePeakValleyFill=function(t,i){(!i||i instanceof Array)&&(i=arguments[2]),i.gapDisplayStyle||!1===i.gapDisplayStyle||(i.gapDisplayStyle=i.gaps);var a=t.panels[i.panelName],r=a.yAxis,s=t.chart,n=s.context,o=(n.strokeStyle,{noDraw:i.noDraw,gapDisplayStyle:i.gapDisplayStyle}),l=t.plotDataSegmentAsLine(i.band,a,e.ensureDefaults(i,{noDraw:!0,gapDisplayStyle:{}}));i.noDraw=o.noDraw,i.gapDisplayStyle=o.gapDisplayStyle;var h=i.threshold,c=i.direction,u=i.reverse,p=i.gapDisplayStyle;i.yAxis&&(r=i.yAxis);var d=-Number.MAX_VALUE,m=Number.MAX_VALUE,g=u?d:m;(h||0===h)&&(g=t.pixelFromPrice(h,a,r));for(var f=[],y=l.points.length,v=0;v<y;v+=2){var x,b,S=l.points[v],C=l.points[v+1];if(i.roundOffEdges&&(0===v?S=Math.floor(S):v+2==y&&(S=Math.ceil(S))),!isNaN(C)){var w=C>g&&c>0||C<g&&c<0;w||(f.push([S,C]),d=Math.max(C,d),m=Math.min(C,m)),v<y-3&&(x=l.points[v+2],b=l.points[v+3],(C<g&&b>g||C>g&&b<g)&&(S+=(g-C)*(x-S)/(b-C),f.push([S,g])))}}if(y=f.length){var T=i.edgeParameters,k=i.edgeHighlight;if(k){T.lineWidth>100&&(T.lineWidth=1);for(var D=0;D<y-1;D++){var M=f[D],A=f[D+1];if(M[1]!=g||A[1]!=g){if(M[0]==A[0]&&t.layout.candleWidth>=1){if(M[1]==g&&f[D-1]&&f[D-1][1]==g)continue;if(A[1]==g&&f[D+2]&&f[D+2][1]==g)continue}t.plotLine(M[0],A[0],M[1],A[1],i.edgeHighlight,"segment",s.context,a,T)}}}h||0===h||(r.flipped&&(u=!u),g=u?Math.min(m,r.top):Math.max(d,r.bottom)),f.push([f[y-1][0],g],[f[0][0],g]);var F=i.opacity;if(F||0===F||(i.opacity=.3),e.fillArea(t,f,i),p&&p.color&&p.fillMountain&&!i.tension&&!e.isTransparent(p.color)&&!e.isTransparent(i.color)){if(n.save(),n.fillStyle instanceof CanvasGradient){var P=n.createLinearGradient(0,1===c?a.top:a.bottom,0,g);P.addColorStop(0,e.hexToRgba(e.colorToHex(p.color),60)),P.addColorStop(1,e.hexToRgba(e.colorToHex(p.color),10)),n.fillStyle=P}else n.fillStyle=p.color;var _=[],E={opacity:i.opacity,panelName:i.panelName};for(v=0;v<l.gapAreas.length;v++){var L=l.gapAreas[v],N=L.start,R=L.end,O=L.threshold;N?_=[[N[0],N[1]],[N[0],O]]:_.push([R[0],O],[R[0],i.step?_[0][1]:R[1]]),4==_.length&&(e.fillArea(t,_,E),i.step?(t.plotLine(_[0][0],_[3][0],_[0][1],_[0][1],p,"segment",n,a,p),t.plotLine(_[3][0],_[3][0],_[0][1],_[3][1],p,"segment",n,a,p)):t.plotLine(_[0][0],_[3][0],_[0][1],_[3][1],p,"segment",n,a,p))}n.restore()}i.opacity=F}},e.fillIntersecting=function(t,i,a){(!a||a instanceof Array)&&(a=arguments[3]);var r=a.topBand,s=a.bottomBand,n=a.topSubBand,o=a.bottomSubBand,l=a.topColor,h=a.bottomColor,c=i;c.panel&&(c.outputs&&c.outputMap&&(l||(l=c.outputs[c.outputMap[r]]),h||(h=c.outputs[c.outputMap[s]])),c=c.panel),c=t.panels[c];var u=t.chart.context,p=t.scratchContext;if(!p){var d=u.canvas.cloneNode(!0);p=t.scratchContext=d.getContext("2d")}p.canvas.height=u.canvas.height,p.canvas.width=u.canvas.width,p.drawImage(u.canvas,0,0),u.clearRect(0,0,u.canvas.width,u.canvas.height);var m=.3;a.opacity&&(m=a.opacity),u.save(),u.globalCompositeOperation="xor";var g={band:r,subField:n,color:l,opacity:1,panelName:c.name,yAxis:a.topAxis,skipTransform:a.skipTransform,tension:a.tension,roundOffEdges:!0};e.preparePeakValleyFill(t,g),e.extend(g,{band:s,subField:o,color:h,yAxis:a.bottomAxis}),e.preparePeakValleyFill(t,g),u.globalAlpha=m,u.globalCompositeOperation="copy",u.scale(1/t.adjustedDisplayPixelRatio,1/t.adjustedDisplayPixelRatio),u.drawImage(u.canvas,0,0),u.globalAlpha=1,u.globalCompositeOperation="destination-over",u.drawImage(t.scratchContext.canvas,0,0),u.restore()},e.drawLegendItem=function(t,e,i,a,r){r||(r=1);var s=e[0],n=e[1],o=t.chart.context;return o.globalAlpha=r,o.fillStyle=a,o.fillRect(s,n,10,10),o.globalAlpha=1,s+=12,o.fillStyle=t.defaultColor,o.fillText(i,s,n),[s+=o.measureText(i).width+6,n]},e.drawLegend=function(t,i){var a=i.coordinates,r=t.chart.context;r.textBaseline="top";var s=r.font;t.canvasFont("stx-legend",r);var n=i.chart||t.chart;a||(a=n.legend);for(var o=[a.x,a.y],l=t.defaultColor,h=0;h<2;h++)for(var c in i.legendColorMap){var u=i.legendColorMap[c];if((!u.isBase||!h&&!i.noBase)&&(u.isBase||h)){var p;if(u.color instanceof Array){var d=u.color;for(p=d.length-1;p>=0;p--)e.isTransparent(d[p])&&d.splice(p,1);if(d.length>1){var m=r.createLinearGradient(o[0],o[1],o[0]+10,o[1]);for(p=0;p<d.length;p++)m.addColorStop(p/(d.length-1),d[p]);l=m}else l=d.length>0?d[0]:t.getCanvasColor("stx_line_chart")}else l=u.color?u.color:null;if(l){var g=c;u.display&&(g=u.display),g||(g=n.symbolDisplay?n.symbolDisplay:n.symbol),o[0]+r.measureText(g).width>n.panel.right&&(o=[a.x,a.y+r.measureText("M").width+6]),o=e.drawLegendItem(t,o,g,l,u.opacity)}}}r.font=s},e.minMax=function(t,e,i,a){var r=Number.MAX_VALUE,s=-1*Number.MAX_VALUE;i||(i="Close");for(var n=a?"High":i,o=a?"Low":i,l=0;l<t.length;l++){var h=t[l];if(h){var c=h[e];if(c||0===c){var u=c;"object"===_typeof(c)&&(u=c[n]),isNaN(u)||!u&&0!==u||(s=Math.max(s,u)),"object"===_typeof(c)&&(u=c[o]),isNaN(u)||!u&&0!==u||(r=Math.min(r,u))}}}return[r,s]},e.symbolEqual=function(t,e){if(!t||!e)return!1;if("object"!=_typeof(t)&&(t={symbol:t}),"object"!=_typeof(e)&&(e={symbol:e}),"function"==typeof t.equals)return t.equals(e);var i=t.symbol,a=e.symbol;return i&&(i=i.toUpperCase()),a&&(a=a.toUpperCase()),i==a&&t.source==e.source},e.addMemberToMasterdata=function(t){t.constructor===e.ChartEngine&&(t={stx:arguments[0],label:arguments[1],data:arguments[2],fields:arguments[3],createObject:arguments[4],fieldForLabel:arguments[5]});var i=t.stx,a=t.label,r=t.data,s=t.fields,n=t.createObject,o=t.fieldForLabel,l=t.chart?t.chart:i.chart;t.noCleanupDates||i.doCleanupDates(r,i.layout.interval);var h=i.getSeries({symbol:a,chart:l});if(r&&r.constructor==Object&&(r=[r]),r&&r.length){var c,u,p=0,d=0,m=l.masterData,g=i.layout;m||(m=[]);for(var f=i.chart&&i.chart.defaultPlotField?i.chart.defaultPlotField:null,y=!i.chart.highLowBars&&!i.highLowBars[i.layout.chartType];r&&p<m.length&&d<r.length;){if(u=r[d],c=m[p],u.DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=e.yyyymmddhhmmssmmm(u.DT))):u.DT=e.strToDateTime(u.Date),0===d)for(var v=0;v<h.length;v++)(!h[v].endPoints.begin||h[v].endPoints.begin>u.DT)&&(h[v].endPoints.begin=u.DT);+u.DT!=+c.DT?u.DT<c.DT?m.splice(p,0,{DT:u.DT,Date:u.Date}):D(u.DT):(k(c,u),d++,p++)}if(p>=m.length)for(;r&&d<r.length;)(u=r[d]).DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=e.yyyymmddhhmmssmmm(u.DT))):u.DT=e.strToDateTime(u.Date),k(c={DT:u.DT,Date:u.Date},u),m.push(c),d++;if(t.fillGaps&&m.length){var x={noCleanupDates:!0,cleanupGaps:t.fillGaps};if(s)for(var b=0;b<s.length;b++)x.field=s[b],i.doCleanupGaps(m,l,x);else x.field=a,i.doCleanupGaps(m,l,x)}for(var S=0;S<h.length;S++){var C=h[S].endPoints;if(!C.end||C.end<=c[a].DT){C.end=c[a].DT;var w=a||h[S].parameters&&h[S].parameters.field||l.defaultPlotField;h[S].lastQuote=i.getFirstLastDataRecord(m,w,!0)}}i.setMasterData(m,l,{noCleanupDates:!0})}function T(t,e){if(!t||"object"!=_typeof(t))return t=e;var i={Close:t.Close,High:t.High,Low:t.Low,Open:t.Open,Volume:t.Volume};for(var a in t=e,i)null===t.Close?void 0!==t[a]&&(t[a]=null):"number"!=typeof t[a]?t[a]=i[a]:"number"==typeof i[a]&&("Open"==a?t.Open=i.Open:"Low"==a&&t.Low>i.Low?t.Low=i.Low:"High"==a&&t.High<i.High?t.High=i.High:"Volume"==a&&(t.Volume+=i.Volume));return t}function k(t,i){if(s&&s.length)if("*"==s[0])e.extend(t,i);else for(var r=0;r<s.length;r++)t[s[r]]=i[s[r]];else if(n){if(void 0!==i.Value)return void(t[a]=i.Value);t[a]="aggregate"==n?T(t[a],i):i;var l=t[a];if("number"==typeof l.Close){"number"!=typeof l.Open&&(l.Open=l.Close);var h=Math.max(l.Open,l.Close),c=Math.min(l.Open,l.Close);("number"!=typeof l.High||l.High<h)&&(l.High=h),("number"!=typeof l.Low||l.Low>c)&&(l.Low=c)}l.Volume&&"number"!=typeof l.Volume&&(l.Volume=parseInt(l.Volume,10))}else o?t[a]=i[o]:y&&f&&void 0!==i[f]?t[a]=i[f]:g.adj&&void 0!==i.Adj_Close?t[a]=i.Adj_Close:void 0!==i.Close?t[a]=i.Close:void 0!==i.Value?t[a]=i.Value:t[a]=i[a]}function D(t){var e=p,i=m.length-1;if(m[i].DT<t)p=i+1;else if(+m[i].DT!=+t){p++;for(var a=0;++a<100;){switch(+m[p].DT==+t?0:m[p].DT<t?1:m[p-1].DT>t?-1:(+m[p-1].DT==+t&&p--,0)){case 0:return;case 1:e=p;break;case-1:i=p}p=Math.round((i+e)/2)}a>=100&&(console.log("!!!Warning: addMemberToMasterdata() did not find insertion point."),p=m.length-1)}else p=i}},e.ThemeHelper=function(t){this.params=t;var i=t.stx,a="#FFFFFF";i.chart.container&&(a=getComputedStyle(i.chart.container).backgroundColor,e.isTransparent(a)&&(a=i.containerColor)),this.settings.chart.Background.color=e.hexToRgba(a),this.settings.chart["Grid Lines"].color=e.hexToRgba(i.canvasStyle("stx_grid").color),this.settings.chart["Grid Dividers"].color=e.hexToRgba(i.canvasStyle("stx_grid_dark").color),this.settings.chart["Axis Text"].color=e.hexToRgba(i.canvasStyle("stx_xaxis").color),this.settings.chartTypes["Candle/Bar"].up.color=e.hexToRgba(i.canvasStyle("stx_candle_up").color),this.settings.chartTypes["Candle/Bar"].down.color=e.hexToRgba(i.canvasStyle("stx_candle_down").color),this.settings.chartTypes["Candle/Bar"].up.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_up").color),this.settings.chartTypes["Candle/Bar"].down.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_down").color),this.settings.chartTypes["Candle/Bar"].even.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_even").color),this.settings.chartTypes["Candle/Bar"].up.border=e.hexToRgba(i.canvasStyle("stx_candle_up").borderLeftColor),this.settings.chartTypes["Candle/Bar"].down.border=e.hexToRgba(i.canvasStyle("stx_candle_down").borderLeftColor),e.isTransparent(i.canvasStyle("stx_candle_up").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].up.border=null),e.isTransparent(i.canvasStyle("stx_candle_down").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].down.border=null),this.settings.chartTypes.Line.color=e.hexToRgba(i.canvasStyle("stx_line_chart").color),this.settings.chartTypes.Mountain.color=e.hexToRgba(i.canvasStyle("stx_mountain_chart").backgroundColor),this.settings.chartTypes.Mountain.basecolor=e.hexToRgba(i.canvasStyle("stx_mountain_chart").color)},e.ThemeHelper.prototype.settings={chart:{Background:{color:null},"Grid Lines":{color:null},"Grid Dividers":{color:null},"Axis Text":{color:null}},chartTypes:{"Candle/Bar":{up:{color:null,wick:null,border:null},down:{color:null,wick:null,border:null},even:{color:null,wick:null,border:null}},Line:{color:null},Mountain:{color:null,basecolor:null}}},e.ThemeHelper.prototype.update=function(t){t||(t=this.params.stx);var i={stx_candle_up:{stx_candle_up:!0,stx_bar_up:!0,stx_hollow_candle_up:!0,stx_line_up:!0,stx_baseline_up:!0},stx_candle_down:{stx_candle_down:!0,stx_bar_down:!0,stx_hollow_candle_down:!0,stx_line_down:!0,stx_baseline_down:!0},stx_candle_even:{stx_hollow_candle_even:!0,stx_bar_even:!0},stx_shadow_up:{stx_candle_shadow_up:!0},stx_shadow_down:{stx_candle_shadow_down:!0},stx_shadow_even:{stx_candle_shadow_even:!0},stx_line_chart:{stx_bar_chart:!0,stx_line_chart:!0},stx_grid:{stx_grid:!0},stx_grid_dark:{stx_grid_dark:!0},stx_xaxis:{stx_xaxis_dark:!0,stx_xaxis:!0,stx_yaxis:!0,stx_yaxis_dark:!0,stx_grid_border:!0},stx_mountain_chart:{stx_mountain_chart:!0},stx_market_session:{stx_market_session:!0}};function a(e,a,r){var s=i[e];for(var n in s)t.setStyle(n,a,r)}t.chart.container.style.backgroundColor=this.settings.chart.Background.color,t.defaultColor="",a("stx_grid","color",this.settings.chart["Grid Lines"].color),a("stx_grid_dark","color",this.settings.chart["Grid Dividers"].color),a("stx_xaxis","color",this.settings.chart["Axis Text"].color);var r=this.settings.chartTypes["Candle/Bar"];r.even||(r.even={color:null,wick:e.hexToRgba(t.canvasStyle("stx_candle_shadow_even").color),border:null}),a("stx_candle_up","color",r.up.color),a("stx_candle_down","color",r.down.color),a("stx_candle_even","color",r.even.color),a("stx_shadow_up","color",r.up.wick),a("stx_shadow_down","color",r.down.wick),a("stx_shadow_even","color",r.even.wick),t.setStyle("stx_candle_up","borderLeftColor",r.up.border),t.setStyle("stx_candle_down","borderLeftColor",r.down.border),a("stx_line_chart","color",this.settings.chartTypes.Line.color),t.setStyle("stx_mountain_chart","borderTopColor",e.hexToRgba(this.settings.chartTypes.Mountain.color,1)),t.setStyle("stx_mountain_chart","backgroundColor",e.hexToRgba(this.settings.chartTypes.Mountain.color,.5)),t.setStyle("stx_mountain_chart","color",e.hexToRgba(this.settings.chartTypes.Mountain.basecolor,.01)),t.draw()},e.NameValueStore=function(){},e.NameValueStore.prototype.toJSONIfNecessary=function(t){if(t.constructor==String)return t;try{return JSON.stringify(t)}catch(e){return console.log("Cannot convert to JSON: "+t),null}},e.NameValueStore.prototype.fromJSONIfNecessary=function(t){try{return JSON.parse(t)}catch(e){return t}},e.NameValueStore.prototype.get=function(t,i){var a=e.localStorage.getItem(t);i&&i(null,this.fromJSONIfNecessary(a))},e.NameValueStore.prototype.set=function(t,i,a){e.localStorageSetItem(t,this.toJSONIfNecessary(i)),a&&a(null)},e.NameValueStore.prototype.remove=function(t,i){e.localStorage.removeItem(t),i&&i(null)},e.Plotter=function(){this.seriesArray=[],this.seriesMap={}},e.extend(e.Plotter.prototype,{Series:function(t,i,a,r,s,n){this.name=t,this.strokeOrFill=i,this.color=a,this.moves=[],this.text=[],(!r||r>1||r<0)&&(r=1),this.opacity=r,(!s||s>25||s<1)&&(s=1),this.width=s,this.pattern=e.borderPatternToArray(s,n)},newSeries:function(t,e,i,a,r){var s;s=i.constructor==String?new this.Series(t,e,i,a,r):new this.Series(t,e,i.color,i.opacity,r,i.borderTopStyle),this.seriesArray.push(s),this.seriesMap[t]=s},reset:function(t){for(var e in this.seriesMap)if(!t||t==e){var i=this.seriesMap[e];i&&(i.moves=[],i.text=[])}},moveTo:function(t,e,i){this.seriesMap[t].moves.push({action:"moveTo",x:e,y:i})},lineTo:function(t,e,i){var a=this.seriesMap[t],r=a.pattern;a.moves.push({action:"lineTo",x:e,y:i,pattern:r})},dashedLineTo:function(t,e,i,a){this.seriesMap[t].moves.push({action:"lineTo",x:e,y:i,pattern:a})},quadraticCurveTo:function(t,e,i,a,r){var s=this.seriesMap[t],n=s.pattern;s.moves.push({action:"quadraticCurveTo",x0:e,y0:i,x:a,y:r,pattern:n})},bezierCurveTo:function(t,e,i,a,r,s,n){var o=this.seriesMap[t],l=o.pattern;o.moves.push({action:"bezierCurveTo",x0:e,y0:i,x1:a,y1:r,x:s,y:n,pattern:l})},addText:function(t,e,i,a,r,s,n){this.seriesMap[t].text.push({text:e,x:i,y:a,bg:r})},drawText:function(t,e){for(var i=0;i<e.text.length;i++){var a=e.text[i];if(a.bg){var r=a.width?a.width:t.measureText(a.text).width,s=a.height?a.height:12,n=t.fillStyle;t.fillStyle=a.bg,"right"==t.textAlign?t.fillRect(a.x,a.y-s/2,-r,-s):t.fillRect(a.x,a.y-s/2,r,s),t.fillStyle=n}t.fillText(a.text,a.x,a.y)}},draw:function(t,e){for(var i=t.lineWidth,a=t.fillStyle,r=t.strokeStyle,s=t.globalAlpha,n=0;n<this.seriesArray.length;n++){var o=this.seriesArray[n];if(!e||o.name==e){t.beginPath(),t.lineWidth=o.width,t.globalAlpha=o.opacity,t.fillStyle=o.color,t.strokeStyle=o.color,t.save();for(var l=0;l<o.moves.length;l++){var h=o.moves[l];h.pattern?(t.setLineDash(h.pattern),t.lineDashOffset=0):t.setLineDash([]),"quadraticCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x,h.y):"bezierCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x1,h.y1,h.x,h.y):t[h.action](h.x,h.y)}"fill"==o.strokeOrFill?t.fill():t.stroke(),t.closePath(),t.restore(),this.drawText(t,o),t.lineWidth=1}}t.lineWidth=i,t.fillStyle=a,t.strokeStyle=r,t.globalAlpha=s}},!0),e.EaseMachine=function(t,e,i,a){this.fc=t,this.ms=e,(i||0===i)&&this.reset(i,a)},e.EaseMachine.prototype.reset=function(t,e){for(var i in t||0===t||(t=this.currentValues),this.hasCompleted=!1,this.running=!1,this.okayToRun=!0,this.useNameValuePairs="object"==_typeof(e),this.startTime=Date.now(),this.useNameValuePairs?(this.startValues=t,this.endValues=e):(this.startValues={default:t},this.endValues={default:e}),this.changeValues={},this.currentValues={},this.startValues)this.changeValues[i]=this.endValues[i]-this.startValues[i]},e.EaseMachine.prototype.next=function(){var t=Date.now();for(var e in t>=this.startTime+this.ms&&(t=this.startTime+this.ms,this.hasCompleted=!0,this.running=!1),this.currentValues={},this.changeValues)this.currentValues[e]=this.fc(t-this.startTime,this.startValues[e],this.changeValues[e],this.ms);return this.useNameValuePairs?this.currentValues:this.currentValues.default},e.EaseMachine.prototype.hasCompleted=!0,e.EaseMachine.prototype.run=function(t,e,i,a){this.afid&&cancelAnimationFrame(this.afid),e||0===e?this.reset(e,i):(i||0===i)&&this.reset(this.currentValues,i);var r=this;function s(){if(r.afid=null,r.okayToRun){var e=r.next();t(e),r.hasCompleted||(r.afid=requestAnimationFrame(s))}}this.running=!0,a?this.afid=requestAnimationFrame(s):s()},e.EaseMachine.prototype.stop=function(){return this.afid&&cancelAnimationFrame(this.afid),this.afid=null,this.okayToRun=!1,this.running=!1,void 0===this.useNameValuePairs?{}:this.useNameValuePairs?this.currentValues:this.currentValues.default},e.Renderer=function(){},e.Renderer.produce=function(t,i){var a=null;if(t)for(var r in e.Renderer){var s=e.Renderer[r];if(s.requestNew&&(a=s.requestNew(t.split("_"),i)),a)return a}return i.type="line",new e.Renderer.Lines({params:i})},e.Renderer.colorFunctions={},e.Renderer.registerColorFunction=function(t,i){e.Renderer.colorFunctions[t]=i},e.Renderer.unregisterColorFunction=function(t){delete e.Renderer.colorFunctions[t]},e.Renderer.prototype.performCalculations=function(){},e.Renderer.prototype.adjustYAxis=function(){},e.Renderer.prototype.draw=function(){},e.Renderer.prototype.drawIndividualSeries=function(t,e){},e.Renderer.prototype.construct=function(t){t||(t={});var i=t.params?t.params:{};i.name||(i.name=e.uniqueID()),i.heightPercentage||(i.heightPercentage=.7),i.opacity||(i.opacity=1),!1!==i.highlightable&&(i.highlightable=!0),i.panel||(i.panel="chart"),i.yAxis&&(i.yAxis=new e.ChartEngine.YAxis(i.yAxis),i.yAxis.name||(i.yAxis.name=i.name)),this.cb=t.callback,this.params=i,this.seriesParams=[],this.caches={},this.colors={}},e.Renderer.prototype.attachSeries=function(t,i){var a=this.stx;if(!a)return this;var r=a.chart.series[t];r||(r={parameters:{}});var s=this.params,n=r.parameters,o={id:t,chartType:s.type,display:n.display,border_color_up:s.defaultBorders?"auto":null,fill_color_up:n.color,opacity_up:s.opacity,border_color_down:s.defaultBorders?"auto":null,fill_color_down:n.color,opacity_down:s.opacity,color:n.color,symbol:n.symbol,symbolObject:e.clone(n.symbolObject)};if("string"==typeof i)o.color=o.fill_color_down=o.fill_color_up=i;else if("object"==_typeof(i)){for(var l in i)o[l]=i[l];var h=o.color,c=o.border_color;h&&(o.fill_color_up||(o.fill_color_up=h),o.fill_color_down||(o.fill_color_down=h),o.fill_color_even||(o.fill_color_even=h)),c&&(o.border_color_up||(o.border_color_up=c),o.border_color_down||(o.border_color_down=c),o.border_color_even||(o.border_color_even=c))}o.symbol&&o.field!=o.symbol&&(o.subField=o.field,o.field=o.symbol),o.id||(o.id=e.uniqueID());for(var u=0;u<this.seriesParams.length;++u)if(this.seriesParams[u].id===o.id){this.removeSeries(o.id,!0);break}this.seriesParams.splice(u,0,o),o.fill_color_up!=o.fill_color_down?(this.colors[t+" up"]={color:o.fill_color_up,opacity:o.opacity_up,display:o.display?o.display+" up":t+" up"},this.colors[t+" dn"]={color:o.fill_color_down,opacity:o.opacity_down,display:o.display?o.display+" down":t+" down"}):this.colors[t]={color:o.fill_color_up,opacity:o.opacity_up,display:o.display?o.display:t};var p=s.panel;if(a.panels[p])s.yAxis&&(s.yAxis=a.addYAxis(a.panels[p],s.yAxis),s.yAxis.needsInitialPadding=!0,a.resizeChart());else{var d=s.yAxis;d||((d=new e.ChartEngine.YAxis).needsInitialPadding=!0),d.name=p,a.createPanel(p,p,null,null,d)}return this},e.Renderer.prototype.removeSeries=function(t,e){var i=null,a=!1,r=this.stx,s=r.chart;for(var n in s.seriesRenderers)for(var o=s.seriesRenderers[n],l=0;l<o.seriesParams.length;l++){var h=o.seriesParams[l];h.id==t&&this===o?i=l:!h.isComparison||h.panel!=s.panel.name||h.yAxis&&h.yAxis!=s.yAxis||(a=!0)}if(null!==i&&(s.forcePercentComparison&&!a&&this.seriesParams[i].isComparison&&"linear"!=r.layout.chartScale&&r.setChartScale(),this.seriesParams.splice(i,1)),delete this.colors[t+" up"],delete this.colors[t+" dn"],delete this.colors[t],!e){var c=!1;for(var u in s.seriesRenderers){for(var p=s.seriesRenderers[u],d=0;d<p.seriesParams.length;d++)if(p.seriesParams[d].id==t){c=!0;break}if(c)break}c||r.deleteSeries(t,s)}return r.deleteYAxisIfUnused(r.panels[this.params.panel],this.params.yAxis),r.resizeChart(),r.layout.symbols=r.getSymbols({"include-parameters":!0,"exclude-studies":!0}),r.changeOccurred("layout"),this},e.Renderer.prototype.removeAllSeries=function(t){if(t){for(var e=[],i=0;i<this.seriesParams.length;i++)e.push(this.seriesParams[i].id);for(var a=0;a<e.length;a++)this.removeSeries(e[a])}return this.seriesParams=[],this.colors={},this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this.stx.resizeChart(),this},e.Renderer.prototype.getYAxis=function(t){var e;if(this.params)if(this.params.yAxis)e=this.params.yAxis;else{var i=t.panels[this.params.panel];if(!i)return!1;e=i.yAxis}else e=t.chart.panel.yAxis;return e},e.Renderer.prototype.ready=function(){return this.stx.createDataSet(),this.stx.draw(),this},e.Renderer.Lines=function(t){this.construct(t);var e=this.params;if(e.type||(e.type="line"),!e.style)switch(e.type){case"mountain":e.baseline?e.style="stx_baseline_delta_mountain":e.colored?e.style="stx_colored_mountain_chart":e.style="stx_mountain_chart";break;default:e.style="stx_line_chart"}this.supportsAnimation=!0,"wave"==e.type?(e.step=e.vertex=e.baseline=e.colored=!1,this.highLowBars=this.barsHaveWidth=!0,this.supportsAnimation=!1):"step"==e.type&&(e.step=!0)},e.Renderer.Lines.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Lines.requestNew=function(t,i){for(var a=null,r=i.step,s=i.colored,n=i.baseline,o=i.vertex,l=0;l<t.length;l++){var h=t[l];switch(h){case"line":case"mountain":case"wave":a=h;break;case"baseline":n=!0;break;case"colored":s=!0;break;case"step":r=!0;break;case"vertex":o=!0;break;case"delta":break;default:return null}}return null!==a||n||r?new e.Renderer.Lines({params:e.extend(i,{type:a,step:r,colored:s,baseline:n,vertex:o})}):null},e.Renderer.Lines.prototype.draw=function(){var t,i=this.stx,a=this.stx.panels[this.params.panel].chart,r={},s=this.seriesParams,n=this.params.colorFunction;function o(t){var e=t.fill_color_up||i.getCanvasColor("stx_line_up"),a=t.fill_color_down||i.getCanvasColor("stx_line_down"),r=t.color||i.getCanvasColor("stx_line_chart");return function(t,i,s){return i.iqPrevClose||0===i.iqPrevClose?i.Close>i.iqPrevClose?e:i.Close<i.iqPrevClose?a:r:r}}for(this.params.vertex&&!i.scatter&&(console.warn("Error, vertex option requires customChart.js"),this.params.vertex=!1),t=0;t<s.length;t++){var l=s[t];if(this.params.colored){for(var h=["_color_up","_color_down","_color"],c=0;c<h.length;c++){var u=l["border"+h[c]];u&&"auto"!=u&&(l["fill"+h[c]]=u)}n||(n=o(l)),this.params.colorFunction=n}var p={};a.series[l.id]&&(p=e.clone(a.series[l.id].parameters)),r[l.id]={parameters:e.extend(e.extend(p,this.params),l),yValueCache:this.caches[l.id]},this==i.mainSeriesRenderer&&a.customChart&&a.customChart.colorFunction&&(r[l.id].parameters.colorFunction=a.customChart.colorFunction)}for(t in i.drawSeries(a,r,this.params.yAxis,this),r)this.caches[t]=r[t].yValueCache},e.Renderer.Lines.prototype.drawIndividualSeries=function(t,i){if(!i.invalid){var a=this.stx,r=t.context,s=null,n=i.colorFunction,o=a.panels[i.panel]||t.panel;if("string"!=typeof n||(n=e.Renderer.colorFunctions[n]))return i.vertex&&(r.save(),r.lineJoin="bevel"),"wave"==i.type?s=a.drawWaveChart(o,i):i.baseline?s=a.drawBaselineChart(o,i):"mountain"==i.type?(i.returnObject=!0,s=a.drawMountainChart(o,i,n)):(i.returnObject=!0,s=a.drawLineChart(o,i.style,n,i)),i.vertex&&(a.scatter(o,{yAxis:i.yAxis,field:i.symbol||i.field,subField:i.subField,symbol:i.symbol,color:i.vertex_color,highlight:i.highlight}),r.restore()),s}},e.Renderer.OHLC=function(t){this.construct(t);var e=this.params;e.type||(e.type="candle"),this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.histogram&&(e.type="candle",this.highLowBars=!1,e.volume=e.hollow=!1),"bar"==e.type&&(e.volume=e.hollow=e.histogram=!1),"candle"==e.type&&(e.hlc=e.colored=!1),e.volume&&(e.hollow=!0)},e.Renderer.OHLC.ciqInheritsFrom(e.Renderer,!1),e.Renderer.OHLC.requestNew=function(t,i){for(var a=null,r=i.hlc,s=i.colored,n=i.hollow,o=i.volume,l=i.histogram,h=0;h<t.length;h++){var c=t[h];switch(c){case"bar":case"candle":a=c;break;case"volume":o=!0;break;case"hollow":n=!0;break;case"colored":s=!0;break;case"histogram":l=!0,a="candle";break;case"hlc":r=!0,a="bar";break;default:return null}}return null===a?null:new e.Renderer.OHLC({params:e.extend(i,{type:a,hlc:r,colored:s,hollow:n,volume:o,histogram:l})})},e.Renderer.OHLC.prototype.draw=function(){var t,i=this.stx,a=this.stx.panels[this.params.panel].chart,r={},s=this.seriesParams;for(t=0;t<s.length;t++){var n=s[t],o={};a.series[n.id]&&(o=e.clone(a.series[n.id].parameters)),r[n.id]={parameters:e.extend(e.extend(o,this.params),n)},this==i.mainSeriesRenderer&&a.customChart&&a.customChart.colorFunction&&(r[n.id].parameters.colorFunction=a.customChart.colorFunction)}for(t in i.drawSeries(a,r,this.params.yAxis,this),r)r[t].yValueCache&&(this.caches[t]=r[t].yValueCache)},e.Renderer.OHLC.prototype.getColor=function(t,i,a,r,s,n){var o=n||a.color;if(r&&!(o=n||a.borderLeftColor||a["border-left-color"]))return null;if(!s)return o;var l=t.pixelFromTransformedValue(i.chart.highValue,i);isNaN(l)&&(l=0);var h=a.backgroundColor;if(o&&!e.isTransparent(o)){var c=t.chart.context.createLinearGradient(0,l,0,2*i.yAxis[i.yAxis.flipped?"top":"bottom"]-l);return c.addColorStop(0,o),c.addColorStop(1,h),c}return h},e.Renderer.OHLC.prototype.drawIndividualSeries=function(t,i){if(!i.invalid){var a=this.stx,r=(t.context,i.colorFunction),s=a.panels[i.panel]||t.panel;if("string"!=typeof r||(r=e.Renderer.colorFunctions[r])){var n=a.layout.candleWidth-t.tmpWidth<=2&&t.tmpWidth<=3;t.state.chartType||(t.state.chartType={});var o=t.state.chartType.pass={},l=a.colorByCandleDirection;i.colorBasis&&(l="open"==i.colorBasis);var h=i.histogram,c=i.type,u=i.hollow,p=a.noWicksOnCandles[c];a.startClip(s.name);var d=null,m={colors:[],cache:[]},g=[];if(r){var f={isHistogram:h,field:i.field,yAxis:i.yAxis,volume:i.volume,highlight:i.highlight};h||"bar"!=c?("candle"!=c||p||a.drawShadows(s,r,f),m=a.drawCandles(s,r,f),f.isOutline=!0,!u&&n||a.drawCandles(s,r,f)):(f.type=i.hlc?"hlc":"bar",m=a.drawBarChart(s,"stx_bar_chart",r,f))}else for(var y=h&&!1!==i.gradient,v=[{type:"histogram",drawType:"histogram",style:"stx_histogram_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_even",condition:32,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0,useBorderStyleProp:!0},{type:"bar",drawType:"bar",style:i.style||"stx_bar_chart",border:"border_color",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_up",condition:l?8:1,border:"border_color_up",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_down",condition:l?16:2,border:"border_color_down",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_even",condition:l?32:4,border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"candle",drawType:"shadow",style:"stx_candle_shadow",border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_up",condition:8,border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_down",condition:16,border:"border_color_down"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_even",condition:32,border:"border_color_even",skipIfPass:!0},{type:"candle",drawType:"candle",style:"stx_candle_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"candle",drawType:"candle",style:"stx_candle_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_up",condition:1,border:"border_color_up"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_down",condition:2,border:"border_color_down"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_even",condition:4,border:"border_color_even",skipIfPass:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:17,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:18,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:20,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:9,fill:"fill_color_up",border:"border_color_up"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:10,fill:"fill_color_down",border:"border_color_down"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:12,fill:"fill_color_even",border:"border_color_even"}],x=0;x<v.length;x++){var b=v[x];if(!b.skipIfPass||o.even){if(h){if("histogram"!=b.type)continue}else if("bar"==c){if("bar"!=b.type)continue;if(i.colored&&!b.condition)continue;if(!i.colored&&b.condition)continue}else if(u){if("hollow"!=b.type)continue;if("shadow"==b.drawType&&p)continue}else{if("candle"!=c)continue;if("candle"!=b.type)continue;if("shadow"==b.drawType){if(p)continue;var S=i.border_color_up||a.getCanvasColor("stx_candle_shadow_up"),C=i.border_color_down||a.getCanvasColor("stx_candle_shadow_down"),w=i.border_color_even||a.getCanvasColor("stx_candle_shadow_even");if(e.colorsEqual(S,C)&&e.colorsEqual(S,w)&&e.colorsEqual(S,a.defaultColor)){if(b.condition)continue}else if(!b.condition)continue}}var T=a.canvasStyle(b.style),k=this.getColor(a,s,T,!1,!1,i[b.fill]),D=this.getColor(a,s,T,!1,y,i[b.fill]),M=this.getColor(a,s,T,b.useBorderStyleProp&&!n,y,i[b.border]);"candle"==b.drawType&&("hollow"==b.type?(!e.isTransparent(D)&&e.colorsEqual(M,D)&&(M=b.useColorInMap?"transparent":D),b.useColorInMap||(D=a.containerColor)):"candle"==b.type&&n&&(e.isTransparent(D)?D=M:M=D)),g.push(a.drawBarTypeChartInner({fillColor:D,borderColor:M,condition:b.condition,style:b.style,type:i.hlc?"hlc":b.drawType,panel:s,field:i.field,yAxis:i.yAxis,volume:i.volume,highlight:i.highlight})),d||(d={}),b.useColorInMap&&(d[k]=1)}}for(var A in a.endClip(),d)i.hollow&&e.equals(A,a.containerColor)||m.colors.push(A);for(A=0;A<g.length;A++)for(var F=0;F<g[A].cache.length;F++){var P=g[A].cache[F];(P||0===P)&&(m.cache[F]=P)}return m}}},e.Renderer.Bars=function(t){this.construct(t);var e=this.params;e.type="bar",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.volume=e.hollow=e.histogram=!1},e.Renderer.Bars.ciqInheritsFrom(e.Renderer.OHLC,!1),e.Renderer.HLC=function(t){this.construct(t);var e=this.params;e.type="bar",e.hlc=!0,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.volume=e.hollow=e.histogram=!1},e.Renderer.HLC.ciqInheritsFrom(e.Renderer.Bars,!1),e.Renderer.Candles=function(t){this.construct(t);var e=this.params;e.type="candle",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.colored=e.histogram=!1,e.volume&&(e.hollow=!0)},e.Renderer.Candles.ciqInheritsFrom(e.Renderer.OHLC,!1),e.Renderer.SimpleHistogram=function(t){this.construct(t);var e=this.params;e.type="candle",e.histogram=!0,this.barsHaveWidth=this.standaloneBars=!0,this.highLowBars=!1,e.hlc=e.colored=e.hollow=e.volume=!1},e.Renderer.SimpleHistogram.ciqInheritsFrom(e.Renderer.Candles,!1),t},__js_core_engine_=function(t){t.SplinePlotter||(t.SplinePlotter={}),t.timezoneJS||(t.timezoneJS={});var e=t.CIQ,i=t.SplinePlotter,a=t.timezoneJS;return e.ChartEngine=function(t){if(t){if("undefined"!=typeof HTMLDivElement&&t.constructor==HTMLDivElement){t={container:t}}}else t={container:null};var i;(this.container=null,this.createChartPanel=!0,this.markers={},this.panels={},this.overlays={},this.charts={},this.eventListeners=[],this.animations={zoom:new e.EaseMachine(Math.easeOutCubic,400)},this.callbacks={studyOverlayEdit:null,studyPanelEdit:null,tap:null,rightClick:null,longhold:null,move:null,layout:null,drawing:null,drawingEdit:null,preferences:null,theme:null,symbolChange:null,symbolImport:null,calculateTradingDecimalPlaces:e.calculateTradingDecimalPlaces},this.controls={},this.goneVertical=!1,this.pinchingScreen=!1,this.grabbingScreen=!1,this.grabStartX=0,this.grabStartY=0,this.grabStartScrollX=0,this.grabStartScrollY=0,this.swipe={},this.yTolerance=100,this.minimumLeftBars=1,this.grabStartCandleWidth=0,this.grabStartZoom=0,this.grabOverrideClick=!1,this.grabMode="",this.vectorsShowing=!1,this.mouseMode=!0,this.reverseMouseWheel=!1,this.mouseWheelAcceleration=!0,this.minimumCandleWidth=1,this.minimumZoomTicks=9,this.allowZoom=!0,this.allowScroll=!0,this.allowSideswipe=!0,this.allowThreeFingerTouch=!1,this.bypassRightClick={series:!1,study:!1,drawing:!1},this.adjustHighlightedDataSetField=function(t){return t},this.highlightedDataSetField=null,this.anyHighlighted=!1,this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime(),this.displayCrosshairs=!0,this.hrPanel=null,this.editingAnnotation=!1,this.openDialog="",this.displayIconsUpDown=!0,this.displayIconsSolo=!0,this.displayIconsClose=!0,this.displayPanelResize=!0,this.soloPanelToFullScreen=!1,this.markerDelay=null,this.useBackingStore=!0,this.disableBackingStoreDuringTouch=e.isMobile||e.isSurface&&e.isFF,this.manageTouchAndMouse=!0,this.captureTouchEvents=!0,this.captureMouseWheelEvents=!0,this.touches=[],this.changedTouches=[],this.crosshairTick=null,this.crosshairValue=null,this.yaxisLabelStyle="roundRectArrow",this.axisBorders=null,this.pt={x1:-1,x2:-1,y1:-1,y2:-1},this.moveA=-1,this.moveB=-1,this.touchStartTime=-1,this.touchPointerType="",this.gestureStartDistance=-1,this.grabStartPeriodicity=1,this.grabEndPeriodicity=-1,this.scrollEvent=null,this.cmd=!1,this.ctrl=!1,this.shift=!1,this.userPointerDown=!1,this.cloneDrawing=!1,this.singleDrawingHighlight=!0,this.crosshairXOffset=-40,this.crosshairYOffset=-40,this.insideChart=!1,this.overXAxis=!1,this.overYAxis=!1,this.displayInitialized=!1,this.cx=null,this.isHistoricalModeSet=null,this.cy=null,this.extendLastTick=!1,this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.cancelTouchSingleClick=!1,this.layout={interval:"day",periodicity:1,timeUnit:null,candleWidth:8,flipped:!1,volumeUnderlay:!1,adj:!0,crosshair:!1,chartType:"candle",extended:!1,marketSessions:{},aggregationType:"ohlc",chartScale:"linear",studies:{},panels:{},setSpan:{}},this.preferences={currentPriceLine:!1,dragging:{series:!0,study:!0,yaxis:!0},drawings:null,highlightsRadius:10,highlightsTapRadius:30,magnet:!1,horizontalCrosshairField:null,labels:!0,language:null,timeZone:null,whitespace:50,zoomInSpeed:null,zoomOutSpeed:null,zoomAtCurrentMousePosition:!1},this.streamParameters={count:0,maxWait:1e3,maxTicks:100,timeout:-1,fillGaps:!0},this.translationCallback=null,this.locale=null,this.dataZone=null,this.displayZone=null,this.timeZoneOffset=0,this.changeCallback=null,this.masterData=null,this.transformDataSetPre=null,this.transformDataSetPost=null,this.dataCallback=null,this.dontRoll=!1,this.allowEquations=!0,this.drawingObjects=[],this.undoStamps=[],this.cleanupGaps=!1,this.staticRange=!1,this.maxDataSetSize=2e4,this.maxMasterDataSize=0,this.resizeDetectMS=1e3,this.xAxisAsFooter=!0,this.xaxisHeight=30,this.displayGridLinesInStudies=!1,this.escapeOnSerialize=!0,this.chart=new e.ChartEngine.Chart,this.chart.name="chart",this.chart.yAxis.name="chart",this.chart.canvas=null,this.chart.tempCanvas=null,this.chart.container=t.container,this.chart.market=new e.Market,this.candleWidthPercent=.65,this.colorByCandleDirection=!1,this.noWicksOnCandles={renko:!0,linebreak:!0},this.fetchMaximumBars={rangebars:!0,kagi:!0,renko:!0,linebreak:!0,pandf:!0},this.mainSeriesRenderer=null,this.highLowBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,wave:!0,rangechannel:!0,none:!0},this.standaloneBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0},this.barsHaveWidth={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0,wave:!0},this.autoPickCandleWidth={turnOn:!1,candleWidth:5},this.staticRangePeriodicityMap=[{rangeInMS:e.WEEK,periodicity:1,interval:5,timeUnit:"minute"},{rangeInMS:e.MONTH,periodicity:1,interval:30,timeUnit:"minute"},{rangeInMS:e.YEAR,periodicity:1,interval:"day"},{rangeInMS:e.DECADE,periodicity:1,interval:"week"},{rangeInMS:10*e.DECADE,periodicity:1,interval:"month"},{rangeInMS:Number.MAX_VALUE,periodicity:12,interval:"month"}],this.dynamicRangePeriodicityMap=[{interval:1,timeUnit:"minute",rangeInMS:e.MINUTE},{interval:5,timeUnit:"minute",rangeInMS:5*e.MINUTE},{interval:30,timeUnit:"minute",rangeInMS:30*e.MINUTE},{interval:60,timeUnit:"minute",rangeInMS:60*e.MINUTE},{interval:"day",rangeInMS:e.DAY},{interval:"month",rangeInMS:e.MONTH},{interval:"year",rangeInMS:e.YEAR}],this.charts.chart=this.chart,this.styles={},this.currentVectorParameters=e.clone(e.ChartEngine.currentVectorParameters),e.extend(this,t),t.container)&&(this.registerHTMLElements(),this.chart.width=this.chart.container.clientWidth-this.chart.yAxis.width,this.setCandleWidth(this.layout.candleWidth,this.chart),this.chart.canvasHeight=this.chart.container.clientHeight,e.useOldWheelLogic&&!e.FireFoxWheelWorkaround&&(i=e.isIE?function(t){if(this.insideChart){t.preventDefault();for(var i=0;i<e.ChartEngine.registeredContainers.length;i++){var a=e.ChartEngine.registeredContainers[i].stx;e.ChartEngine.crosshairX>=a.left&&e.ChartEngine.crosshairX<=a.right&&e.ChartEngine.crosshairY>=a.top&&e.ChartEngine.crosshairY<=a.bottom&&a.mouseWheel(t,"onmousewheel")}}}.bind(this):function(t){this.insideChart&&t.preventDefault()}.bind(this),this.addDomEventListener(document.body,"wheel",i),e.FireFoxWheelWorkaround=!0));this.construct()},e.ChartEngine.drawingLine=!1,e.ChartEngine.resizingPanel=null,e.ChartEngine.vectorType="",e.ChartEngine.crosshairX=0,e.ChartEngine.crosshairY=0,e.ChartEngine.currentColor="auto",e.ChartEngine.drawingTools={},e.ChartEngine.useAnimation=!0,e.ChartEngine.ipadMaxTicks=1500,e.ChartEngine.enableCaching=!1,e.ChartEngine.ignoreTouch=!1,e.ChartEngine.useOldAndroidClear=!0,e.ChartEngine.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:!0,fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:1.272,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:2.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:4.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:!1,printLevels:!0,printValues:!1,timezone:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}},annotation:{font:{style:null,size:null,weight:null,family:null}}},e.ChartEngine.defaultDisplayTimeZone=null,e.ChartEngine.Chart=function(){this.xAxis=new e.ChartEngine.XAxis,this.yAxis=new e.ChartEngine.YAxis,this.symbolObject={symbol:null},this.series={},this.seriesRenderers={},this.xaxis=[],this.state={},this.endPoints={},this.defaultChartStyleConfig={},this.baseline=e.clone(this.baseline)},e.ChartEngine.YAxis=function(t){for(var i in t)this[i]=t[i];this.name||(this.name=e.uniqueID()),"none"==this.position&&(this.width=0)},e.ChartEngine.XAxis=function(t){for(var e in t)this[e]=t[e]},e.ChartEngine.Panel=function(t,i){this.yAxis=i||new e.ChartEngine.YAxis,this.name=t,this.state={}},e.extend(e.ChartEngine.YAxis.prototype,{high:null,low:null,shadow:null,logHigh:null,logLow:null,logShadow:null,multiplier:null,bottom:null,top:null,height:null,left:null,width:null,renderers:[],studies:[]},!0),e.ChartEngine.YAxis.prototype.maxDecimalPlaces=null,e.ChartEngine.YAxis.prototype.max=null,e.ChartEngine.YAxis.prototype.min=null,e.ChartEngine.YAxis.prototype.decimalPlaces=null,e.ChartEngine.YAxis.prototype.idealTickSizePixels=null,e.ChartEngine.YAxis.prototype.minimumPriceTick=null,e.ChartEngine.YAxis.prototype.fractional=null,e.ChartEngine.YAxis.prototype.displayBorder=!0,e.ChartEngine.YAxis.prototype.displayGridLines=!0,e.ChartEngine.YAxis.prototype.noDraw=null,e.ChartEngine.YAxis.prototype.drawCurrentPriceLabel=!0,e.ChartEngine.YAxis.prototype.drawSeriesPriceLabels=!0,e.ChartEngine.YAxis.prototype.drawPriceLabels=!0,e.ChartEngine.YAxis.prototype.goldenRatioYAxis=!0,e.ChartEngine.YAxis.prototype.yaxisLabelStyle=null,e.ChartEngine.YAxis.prototype.justifyRight=null,e.ChartEngine.YAxis.prototype.flipped=!1,e.ChartEngine.YAxis.prototype.textBackground=!1,e.ChartEngine.YAxis.prototype.priceFormatter=null,e.ChartEngine.YAxis.prototype.bottomOffset=0,e.ChartEngine.YAxis.prototype.topOffset=0,e.ChartEngine.YAxis.prototype.initialMarginTop=10,e.ChartEngine.YAxis.prototype.initialMarginBottom=10,e.ChartEngine.YAxis.prototype.zoom=0,e.ChartEngine.YAxis.prototype.scroll=0,e.ChartEngine.YAxis.prototype.heightFactor=1,Object.defineProperty(e.ChartEngine.YAxis.prototype,"width",{configurable:!0,enumerable:!0,get:function(){return this._dynamicWidth||this._width},set:function(t){this._width=t,this._dynamicWidth<t&&(this._dynamicWidth=NaN)}}),e.ChartEngine.YAxis.prototype.width=50,e.ChartEngine.YAxis.prototype.textStyle=null,e.ChartEngine.YAxis.prototype.position=null,e.ChartEngine.YAxis.defaultShadowBreaks=[[1e3,2],[5,4],[.001,8]],e.ChartEngine.YAxis.smallChartShadowBreaks=[[10,2],[1,4]],e.ChartEngine.YAxis.prototype.pretty=!0,e.ChartEngine.YAxis.prototype.increments=[1,2.5,5],e.ChartEngine.YAxis.prototype.prettySemiLog=!0,e.ChartEngine.YAxis.prototype.shadowBreaks=e.ChartEngine.YAxis.defaultShadowBreaks,e.ChartEngine.YAxis.prototype.getYAxis=function(t){return this},e.ChartEngine.YAxis.prototype.isShared=function(){return this.renderers.length+this.studies.length>1},e.ChartEngine.YAxis.prototype.setBackground=function(t,i){i||(i={}),i.color||(i.color="auto");var a=[[this.left,this.top],[this.left,this.bottom],[this.left+this.width,this.bottom],[this.left+this.width,this.top]];e.fillArea(t,a,{color:i.color,opacity:i.opacity})},e.extend(e.ChartEngine.Panel.prototype,{name:null,display:null,chart:null,yAxis:null,shareChartXAxis:null,top:null,bottom:null,height:null,percent:null,displayEdgeIfPadded:!0,noDrag:!1},!0),e.extend(e.ChartEngine.XAxis.prototype,{formatter:null,adjustTimeZone:!0,idealTickSizePixels:null,timeUnit:null,timeUnitMultiplier:null,displayBorder:!0,displayGridLines:!0,noDraw:null,minimumLabelWidth:50,futureTicks:!0,futureTicksInterval:1},!0),e.extend(e.ChartEngine.Chart.prototype,{symbol:null,symbolObject:{symbol:null},symbolDisplay:null,series:{},seriesRenderers:{},scroll:0,isComparison:!1,forcePercentComparison:!0,maxTicks:0,tension:null,currentMarketData:{},masterData:null,dataSet:null,scrubbed:null,dataSegment:null,segmentImage:null,baseline:{includeInDataSegment:!1,defaultLevel:null,userLevel:null,actualLevel:null},xAxis:null,xaxis:[],xaxisFactor:30,decimalPlaces:2,dynamicYAxis:!1,roundit:100,legendRenderer:e.drawLegend,customChart:null,yaxisPaddingRight:null,yaxisPaddingLeft:null,tickCache:{},allowScrollPast:!0,allowScrollFuture:!0,whiteSpaceFutureTicks:0,hideDrawings:!1,defaultPlotField:"Close",defaultChartStyleConfig:{},lockScroll:!1,includeOverlaysInMinMax:!0,gaplines:null,lineStyle:null,lineApproximation:!0,highLowBars:!1,standaloneBars:!1,barsHaveWidth:!1},!0),e.ChartEngine.prototype.setDrawingContainer=function(t){this.drawingContainer=t},e.ChartEngine.prototype.isHistoricalMode=function(){var t=new Date,i=!0,a=this.masterData;if(!this.isHistoricalModeSet)return!1;if(a.length){var r=this.getFirstLastDataRecord(a,"DT",!0),s=this.standardMarketIterator(r.DT);if((i=s.next()<=t)&&e.ChartEngine.isDailyInterval(s.interval)){var n=this.chart.market.getOpen();n&&t<n&&(t.setHours(0,0,0,0),+t==+s.begin&&(i=!1))}}return i},e.ChartEngine.prototype.convertToDataZone=function(t){if((t||0===t)&&this.dataZone){var i=e.convertTimeZone(t,null,this.dataZone);t=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())}return t},e.ChartEngine.isDailyInterval=function(t){return"day"==t||("week"==t||"month"==t)},e.ChartEngine.prototype.needDifferentData=function(t){var i=this.layout,a=e.ChartEngine.isDailyInterval(t.interval),r=e.ChartEngine.isDailyInterval(i.interval),s=!1;return this.dontRoll||!r?i.interval!=t.interval&&(s=!0):a!=r&&(s=!0),a||t.timeUnit||(t.timeUnit="minute"),r||i.timeUnit||(i.timeUnit="minute"),t.timeUnit!=i.timeUnit&&(s=!0),this.masterData&&this.masterData.length||(s=!0),s},e.ChartEngine.chartShowsHighs=function(t){return console.warn("CIQ.ChartEngine.chartShowsHighs() has been deprecated. Please check one of the appropriate renderer properties instead: stxx.chart.highLowBars, stxx.chart.standaloneBars, or stxx.chart.barsHaveWidth."),1!={line:1,colored_line:1,mountain:1,colored_mountain:1,baseline_delta:1,baseline_delta_mountain:1,histogram:1,scatterplot:1,step:1,colored_step:1}[t]},e.ChartEngine.prototype.debug=function(){},e.ChartEngine.prototype.fps=function(t,i){t=t||5;var a=(new Date).getTime(),r=0,s=this;console.log("Running fps() for "+t+" seconds"),function n(){var o=((new Date).getTime()-a)/1e3;if(o>t){var l=r/o;return console.log("FPS="+l),void(i&&i(l))}s.draw(),r++,e.ChartEngine.useAnimation?requestAnimationFrame(n):setTimeout(n,0)}()},t.STXChart=e.ChartEngine,e.ChartEngine.DrawingDescriptor={name:"",render:null,intersected:null,click:null,abort:null},e.ChartEngine.prototype.prepend=function(t,i){var a,r="prepend"+t;return this instanceof e.ChartEngine?(a=this.hasOwnProperty(r)?this[r]:[],this[r]=[i].concat(a)):(a=e.ChartEngine.prototype[r]||[],e.ChartEngine.prototype[r]=[i].concat(a)),{method:r,func:i}},e.ChartEngine.prototype.append=function(t,i){var a,r="append"+t;return this instanceof e.ChartEngine?(a=this.hasOwnProperty(r)?this[r]:[],this[r]=a.concat(i)):(a=e.ChartEngine.prototype[r]||[],e.ChartEngine.prototype[r]=a.concat(i)),{method:r,func:i}},e.ChartEngine.prototype.removeInjection=function(t){var i,a=t.method;if(this instanceof e.ChartEngine){if(!this[a])return;for(i=0;i<this[a].length;i++)if(this[a][i]==t.func)return void this[a].splice(i,1)}else{if(!e.ChartEngine.prototype[a])return;for(i=0;i<e.ChartEngine.prototype[a].length;i++)if(e.ChartEngine.prototype[a][i]==t.func)return void e.ChartEngine.prototype[a].splice(i,1)}},e.ChartEngine.prototype.remove=function(t){this instanceof e.ChartEngine?(delete this["append"+t],delete this["prepend"+t]):(delete e.ChartEngine.prototype["append"+t],delete e.ChartEngine.prototype["prepend"+t])},e.ChartEngine.registeredContainers=[],e.ChartEngine.handleContextMenu=function(t){t||(t=event);for(var i=0;i<e.ChartEngine.registeredContainers.length;i++){var a=e.ChartEngine.registeredContainers[i].stx;if(a&&a.anyHighlighted)return t.preventDefault&&t.preventDefault(),!1}},e.ChartEngine.prototype.positionMarkers=function(){},e.ChartEngine.prototype.plugins={},e.ChartEngine.htmlControls={annotationSave:'<span class="stx-btn stx_annotation_save" style="display: none;">save</span>',annotationCancel:'<span class="stx-btn stx_annotation_cancel" style="display: none; margin-left:10px;">cancel</span>',mSticky:'<div class="stx_sticky"> <span class="mStickyInterior"></span> <span class="mStickyRightClick"><span class="overlayEdit stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="overlayTrashCan stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="mouseDeleteInstructions"><span>(</span><span class="mouseDeleteText">right-click to delete</span><span class="mouseManageText">right-click to manage</span><span>)</span></span></span><span class="stickyLongPressText">(long-press to drag)</span></div>',drawOk:'<div class="stx_draw_ok"><div class="icon"></div><div class="field"></div></div>',dragOk:'<div class="stx_drag_ok"><div class="icon"></div><div class="field"></div></div>',crossX:'<div class="stx_crosshair stx_crosshair_x" style="display: none;"></div>',crossY:'<div class="stx_crosshair stx_crosshair_y" style="display: none;"></div>',chartControls:'<div class="stx_chart_controls" style="display: none; bottom: 22px;"><div class="chartSize"><span class="stx-zoom-out"></span><span class="stx-zoom-in"></span></div></div>',home:'<div class="stx_jump_today" style="display:none"><span></span></div>',floatDate:'<div class="stx-float-date" style="visibility: hidden;"></div>',handleTemplate:'<div class="stx-ico-handle" style="display: none;"><span></span></div> ',iconsTemplate:'<div class="stx-panel-control"><div class="stx-panel-title"></div><div class="stx-panel-legend"></div><div class="stx-btn-panel"><span class="stx-ico-up"></span></div><div class="stx-btn-panel"><span class="stx-ico-focus"></span></div><div class="stx-btn-panel"><span class="stx-ico-down"></span></div><div class="stx-btn-panel"><span class="stx-ico-edit"></span></div><div class="stx-btn-panel"><span class="stx-ico-close"></span></div></div>',baselineHandle:'<div class="stx-baseline-handle" style="display: none;"></div>'},e.ChartEngine.prototype.registerHTMLElements=function(){var t=this.chart.container;for(var i in e.ChartEngine.htmlControls)if(void 0===this.chart[i]&&void 0===this.controls[i]){if(!this.allowZoom&&"chartControls"==i)continue;var a=t.querySelector("."+i);if(a)this.chart[i]=a,this.controls[i]=a;else{var r=e.ChartEngine.htmlControls[i];if(!r)continue;var s=document.createElement("DIV");s.innerHTML=r,a=s.firstChild,t.appendChild(a),this.chart[i]=a,this.controls[i]=a,e.appendClassName(a,i)}}var n=this.controls.chartControls,o=this.controls.home;if(n){var l=n.querySelector(".stx-zoom-in"),h=n.querySelector(".stx-zoom-out");e.safeClickTouch(l,function(t){return function(e){t.allowZoom&&t.zoomIn(e),e.stopPropagation()}}(this)),e.safeClickTouch(h,function(t){return function(e){t.allowZoom&&t.zoomOut(e),e.stopPropagation()}}(this)),e.touchDevice||(this.makeModal(l),this.makeModal(h))}o&&(e.safeClickTouch(o,function(t){return function(e){e.stopPropagation(),t.isHistoricalMode()?(delete t.layout.range,t.loadChart(t.chart.symbol,function(){t.home({animate:!1})})):t.home({animate:!0})}}(this)),e.touchDevice||this.makeModal(o))},e.ChartEngine.prototype.makeModal=function(t){var e=this;t.onmouseover=function(t){e.modalBegin()},t.onmouseout=function(t){e.modalEnd()}},e.ChartEngine.prototype.cloneStyle=function(t){var i={},a=!1;function r(t){return t[1].toUpperCase()}for(var s in t){var n=t[s];if("backgroundAttachment"==s&&(a=!0),a)n&&n.constructor==String&&isNaN(s)&&(i[s]=n);else if(isNaN(s)){i[s.replace(e.camelCaseRegExp,r)]=n}else{var o=t.getPropertyValue(n);if(o){for(var l=0,h=(n=n.split("-")).length,c=n[0];++l<h;)c+=n[l].charAt(0).toUpperCase()+n[l].slice(1);i[c]=o}}}return i},e.ChartEngine.prototype.canvasStyle=function(t){var e=this.styles[t];if(!e){var i=document.createElement("div");i.className=t,this.container.appendChild(i);var a=getComputedStyle(i);e=this.styles[t]=this.cloneStyle(a),this.container.removeChild(i),a||(this.styles[t]=null)}return e},e.ChartEngine.prototype.colorOrStyle=function(t){return-1!=t.indexOf("#")?t:-1!=t.indexOf("(")?t:"transparent"==t?t:this.canvasStyle(t)},e.ChartEngine.prototype.clearStyles=function(){this.styles={},this.defaultColor=""},e.ChartEngine.prototype.setStyle=function(t,i,a){this.styles[t]||this.canvasStyle(t),this.styles[t]||(this.styles[t]={}),this.styles[t][e.makeCamelCase(i)]=a},e.ChartEngine.prototype.setThemeSettings=function(t){if(this.styles={},this.chart.container.style.backgroundColor="",this.defaultColor="",t){var i=new e.ThemeHelper({stx:this});i.settings=t,i.update()}this.updateListeners("theme"),this.changeOccurred("theme"),this.displayInitialized&&(this.headsUpHR(),this.clearPixelCache(),this.updateListeners("theme"),this.draw())},e.ChartEngine.prototype.canvasFont=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+" "+i.fontFamily;-1==a.indexOf("undefined")?e.font=a:(this.styles[t]=null,console.log("bad css style for class "+t))}},e.ChartEngine.prototype.canvasColor=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.color;a||(a=this.defaultColor),e.globalAlpha=1,e.fillStyle=a,e.strokeStyle=a;var r=i.opacity;void 0!==r&&(e.globalAlpha=r)}},e.ChartEngine.prototype.getCanvasFontSize=function(t){var i=this.canvasStyle(t).fontSize;return i||(i="12"),parseInt(e.stripPX(i),10)},e.ChartEngine.prototype.getCanvasColor=function(t){return this.canvasStyle(t).color},e.ChartEngine.hideDates=function(){return!1},e.ChartEngine.prototype.runPrepend=function(t,i,a){var r="prepend"+t,s=this.hasOwnProperty(r)?this[r]:[];if(!(s=s.concat(e.ChartEngine.prototype[r]||[])).length)return!1;a||(a=this);for(var n=0;n<s.length;n++){var o=s[n].apply(a,i);if(o)return o}return!1},e.ChartEngine.prototype.runAppend=function(t,i,a){var r="append"+t,s=this.hasOwnProperty(r)?this[r]:[];if(!(s=s.concat(e.ChartEngine.prototype[r]||[])).length)return!1;a||(a=this);for(var n=0;n<s.length;n++){var o=s[n].apply(a,i);if(o)return o}return!1},e.ChartEngine.registerDrawingTool=function(t,i){e.ChartEngine.drawingTools[t]=i},e.ChartEngine.prototype.createBlock=function(t,e,i,a,r,s){s||(s=this.chart.context),void 0!==a&&(this.canvasColor(r,s),s.fillRect(t,i,e,a),s.globalAlpha=1)},e.ChartEngine.prototype.changeOccurred=function(t){if(!this.currentlyImporting){this.changeCallback&&(console.warn("CIQ.ChartEngine.changeCallback has been deprecated. Please use addEventListener()"),this.changeCallback(this,t));var e={stx:this,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,layout:this.layout,drawings:this.drawingObjects};"layout"==t?this.dispatch("layout",e):"vector"==t?this.dispatch("drawing",e):"theme"==t?this.dispatch("theme",e):"preferences"==t&&this.dispatch("preferences",e)}},e.ChartEngine.prototype.setChartType=function(t){var e=this.layout,i=this.chart;"ohlc"!=e.aggregationType&&(e.aggregationType="ohlc",i.canvas&&this.createDataSet()),e.chartType=t,this.setMainSeriesRenderer(),i.defaultChartStyleConfig={type:t},this.displayInitialized&&this.draw(),this.changeOccurred("layout")},e.ChartEngine.prototype.setAggregationType=function(t){this.layout.chartType="candle";var i=this.chart;!1!==i.baseline.userLevel&&(i.baseline.userLevel=i.baseline.defaultLevel,i.panel.yAxis.scroll=e.ChartEngine.YAxis.prototype.scroll),this.layout.aggregationType=t,this.setMainSeriesRenderer(),i.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},e.ChartEngine.prototype.setChartScale=function(t){var i=this.chart,a={percent:!0,relative:!0};t||(t="linear"),a[t]?this.setComparison(t,i,e.Comparison.initialPrice):a[this.layout.chartScale]&&this.setComparison(!1,i),this.layout.chartScale=t,i.canvas&&this.draw(),this.changeOccurred("layout")},e.ChartEngine.prototype.flipChart=function(t){this.layout.flipped!=t&&(this.layout.flipped=t,this.chart.yAxis.flipped=t,this.changeOccurred("layout"),this.draw())},e.ChartEngine.prototype.setAdjusted=function(t){this.layout.adj=t,this.chart.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},e.ChartEngine.prototype.setVolumeUnderlay=function(t){this.layout.volumeUnderlay=t,this.chart.canvas&&this.draw(),this.changeOccurred("layout")},e.ChartEngine.prototype.serializeDrawings=function(){return console.warn("CIQ.ChartEngine.serializeDrawings() has been deprecated. Please use exportDrawings()"),this.exportDrawings()},e.ChartEngine.prototype.exportDrawings=function(){for(var t=[],e=0;e<this.drawingObjects.length;e++)t.push(this.drawingObjects[e].serialize());return t},e.ChartEngine.prototype.abortDrawings=function(t){!1!==t&&(t=!0);for(var e=this.drawingObjects.length-1;e>=0;e--){var i=this.drawingObjects[e];i.abort(!0),!t&&i.permanent||this.drawingObjects.splice(e,1)}},e.ChartEngine.prototype.reconstructDrawings=function(t){console.warn("CIQ.ChartEngine.reconstructDrawings() has been deprecated. Please use importDrawings()"),this.importDrawings(t)},e.ChartEngine.prototype.importDrawings=function(t){if(e.Drawing)for(var i=0;i<t.length;i++){var a=t[i];"fibonacci"==a.name&&(a.name="retracement");var r=e.ChartEngine.drawingTools[a.name];if(r||e.Drawing[a.name]&&(r=e.Drawing[a.name],e.ChartEngine.registerDrawingTool(a.name,r)),r){var s=new r;s.reconstruct(this,a),this.drawingObjects.push(s)}}},e.ChartEngine.prototype.clearDrawings=function(t,i){!1!==i&&(i=!0);var a=this.exportDrawings();this.abortDrawings(i),t?this.undoStamps=[]:this.undoStamp(a,this.exportDrawings()),this.changeOccurred("vector"),this.cancelTouchSingleClick=!0,e.clearCanvas(this.chart.tempCanvas,this),this.draw();var r=this.controls.mSticky;r&&(r.style.display="none",r.children[0].innerHTML="")},e.ChartEngine.prototype.createDrawing=function(t,i){if(e.Drawing){var a=new e.Drawing[t];a.reconstruct(this,i);var r=new e.Drawing[t];for(var s in r.stx=this,r.copyConfig(),r)a[s]=a[s]||r[s];return this.drawingObjects.push(a),this.draw(),a}},e.ChartEngine.prototype.removeDrawing=function(t){for(var e=0;e<this.drawingObjects.length;e++)if(this.drawingObjects[e]==t)return this.drawingObjects.splice(e,1),this.changeOccurred("vector"),void this.draw()},e.ChartEngine.prototype.dateFromTick=function(t,i,a){i||(i=this.chart);var r,s,n=i.dataSet.length,o=!1;return 0===n&&(i.dataSet[0]={},i.dataSet[0].DT=new Date,n=i.dataSet.length,o=!0),r=t<0?this.standardMarketIterator(i.dataSet[0].DT).previous(Math.abs(t)):t>=n?this.standardMarketIterator(i.dataSet[n-1].DT).next(t-(n-1)):i.dataSet[t].DT,s=a?new Date(r.getTime()):e.yyyymmddhhmm(r),o&&delete i.dataSet[0].DT,s},e.ChartEngine.prototype.calculateYAxisMargins=function(t){t.heightFactor&&(t.zoom=t.height*(1-t.heightFactor)),t.zoom+=t.initialMarginTop+t.initialMarginBottom,t.scroll=(t.initialMarginTop-t.initialMarginBottom)/2,t.zoom>t.height&&(t.zoom=0,t.scroll=0)},e.ChartEngine.prototype.getLabelOffsetInPixels=function(t,e){var i=!(this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e]);if(!("roundRectArrow"!=this.yaxisLabelStyle||i&&this.extendLastTick&&0!==t.yaxisPaddingRight)){return.66*(this.getCanvasFontSize("stx_yaxis")+6)}return 0},e.ChartEngine.prototype.home=function(t){this.swipe.amplitude=0;var e=this.layout;function i(t){for(var e in t.panels)for(var i=t.panels[e].yaxisLHS.concat(t.panels[e].yaxisRHS),a=0;a<i.length;a++)t.calculateYAxisMargins(i[a])}function a(t,e,a){return function(){i(t),e.scroll=a,t.draw()}}if("object"!=_typeof(t)&&(t={maintainWhitespace:t}),void 0===t.maintainWhitespace&&(t.maintainWhitespace=!0),this.cancelTouchSingleClick=!0,this.chart.dataSet&&this.chart.dataSet.length){this.micropixels=0;var r=Math.floor(this.chart.width/e.candleWidth);for(var s in this.charts){var n=this.charts[s];if(!t.chart||t.chart==n){var o=0;t.maintainWhitespace&&this.preferences.whitespace>=0&&(o=this.preferences.whitespace),(t.whitespace||0===t.whitespace)&&(o=t.whitespace);var l=this.getLabelOffsetInPixels(n,e.chartType);l>o&&(o=l);var h=Math.min(r,n.dataSet.length);for(this.chart.allowScrollPast&&(h=r),this.micropixels=this.chart.width-h*e.candleWidth-o,this.preferences.whitespace=o;this.micropixels>e.candleWidth;)h++,this.micropixels-=e.candleWidth;for(;this.micropixels<0;)h--,this.micropixels+=e.candleWidth;if(this.micropixels-=e.candleWidth,h++,this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e.chartType]||(this.micropixels+=e.candleWidth/2),t.animate){this.scrollTo(n,h,a(this,n,h))}else n.scroll=h,i(this)}}this.draw()}else this.draw()},e.ChartEngine.prototype.isHome=function(){var t=this.chart,e=t.dataSet,i=t.animatingHorizontalScroll;return this.pixelFromTick(e.length-(i?2:1),t)<t.width+t.panel.left},e.ChartEngine.prototype.tickFromDate=function(t,i,a,r){if(i||(i=this.chart),!i.dataSet||!i.dataSet.length)return 0;a||(a=0),i||(i=this.chart);var s=t.constructor==Date?t:e.strToDateTime(t);e.ChartEngine.isDailyInterval(this.layout.interval)||s.setMinutes(s.getMinutes()+a);var n=s.getTime(),o=i.tickCache[n];if(o||0===o)return o+(r?1:0);var l=i.dataSet[0].DT,h=i.dataSet[i.dataSet.length-1].DT;if(s>=l&&s<=h){for(var c=0,u=i.dataSet.length,p=0;++p<100;){var d=Math.floor((u+c)/2),m=i.dataSet[d].DT;if(+m==+s)return i.tickCache[n]=d,d;if(m<s&&(c=d),m>s){if(i.dataSet[d-1].DT<s)return i.tickCache[n]=d-1,i.tickCache[n]+(r?1:0);if(+i.dataSet[d-1].DT==+s)return i.tickCache[n]=d-1,d-1;u=d}}if(p>=100)return console.log("!!!Warning: tickFromDate() did not find match."),i.dataSet.length}var g=s<l,f=g?l:h,y=this.standardMarketIterator(f).futureTick({end:s});return o=g?-1*y:i.dataSet.length-1+y,i.tickCache[n]=o,o},e.ChartEngine.XAxisLabel=function(t,e,i){this.hz=t,this.grid=e,this.text=i},e.ChartEngine.prototype.createXAxis=function(t){if(t.dataSegment.length<=0)return null;if(t.xAxis.noDraw)return null;var e=[t],i=this.runPrepend("createXAxis",e);return i||(i=this.mainSeriesRenderer&&this.mainSeriesRenderer.createXAxis?this.mainSeriesRenderer.createXAxis(t):this.createTickXAxisWithDates(t),this.headsUpHR(),this.runAppend("createXAxis",e),i)},e.ChartEngine.prototype.resetDynamicYAxis=function(t){if(!this.runPrepend("resetDynamicYAxis",arguments)){var e=!1;for(var i in this.panels){var a=this.panels[i];if((!t||!t.chartName||a.chart.name===t.chartName)&&(a.yaxisLHS&&a.yaxisRHS))for(var r=a.yaxisLHS.concat(a.yaxisRHS),s=0;s<r.length;s++)r[s]._dynamicWidth&&(r[s]._dynamicWidth=NaN,e=!0)}!e||t&&t.noRecalculate||this.calculateYAxisPositions(),this.runAppend("resetDynamicYAxis",arguments)}},e.ChartEngine.prototype.adjustYAxisHeightOffset=function(t,e){var i=e.topOffset,a=e.bottomOffset;i+a>t.height&&(console.log("The sum of yAxis.topOffset and yAxis.bottomOffset cannot be greater than the panel height. Both values will be reset to 0."),e.bottomOffset=0,e.topOffset=0),this.xaxisHeight||0===this.xaxisHeight||(this.xaxisHeight=this.getCanvasFontSize("stx_xaxis")+4,(this.chart.xAxis.displayBorder||this.axisBorders)&&(this.xaxisHeight+=3)),(this.xAxisAsFooter&&t.bottom>this.chart.canvasHeight-this.xaxisHeight||!this.xAxisAsFooter&&t==this.chart.panel)&&(a+=this.xaxisHeight),e.top=t.top+i,e.bottom=t.bottom-a},e.ChartEngine.prototype.plotYAxisGrid=function(t){if(!this.runPrepend("plotYAxisGrid",arguments)){var e=this.chart.context,i=t.yAxis;i.yAxisPlotter&&i.yAxisPlotter.draw(e,"grid"),this.runAppend("plotYAxisGrid",arguments)}},e.ChartEngine.prototype.plotYAxisText=function(t){if(!this.runPrepend("plotYAxisText",arguments)){this.canvasFont("stx_yaxis"),this.canvasColor("stx_yaxis");var e=this.chart.context;e.textBaseline="middle";var i,a=t.yaxisLHS;for(i=0;i<a.length;i++)e.textAlign="right",r(a[i]);for(a=t.yaxisRHS,i=0;i<a.length;i++)e.textAlign="left",r(a[i]);e.textAlign="left",e.textBaseline="alphabetic",this.runAppend("plotYAxisText",arguments)}function r(t){t.yAxisPlotter&&!t.noDraw&&t.width&&(t.justifyRight?e.textAlign="right":!1===t.justifyRight&&(e.textAlign="left"),t.yAxisPlotter.draw(e,"text"))}},e.ChartEngine.prototype.decimalPlacesFromPriceTick=function(t){return t<1e-4?8:t<.01?4:t<.1?2:t<1?1:0},e.ChartEngine.prototype.formatYAxisPrice=function(t,i,a,r,s){if(null==t||isNaN(t))return"";i||(i=this.chart.panel);var n=r||i.yAxis,o=a;o||0===o||(o=n.printDecimalPlaces),o||0===o||(o=this.decimalPlacesFromPriceTick(n.priceTick));var l=n==i.chart.yAxis?2e4:1e3;if(n.priceTick>=l)return e.condenseInt(t);var h=this.internationalizer;if(h&&!1!==s){var c=h.priceFormatters.length;o>=c&&(o=c-1),t=h.priceFormatters[o].format(t)}else t=t.toFixed(o);return t},e.ChartEngine.prototype.padOutPrice=function(t,e){if(0!==t&&(!t||"number"!=typeof t))return"";e||0===e||(e=t);var i=""+e,a=0;i.indexOf(".")>-1&&(a=i.substring(i.indexOf(".")).length-1),a=e>=1e3?Math.max(a,0):e<2?Math.max(a,4):Math.max(a,2);var r=this.internationalizer;if(r){var s=r.priceFormatters.length;a>=s&&(a=s-1),t=r.priceFormatters[a].format(t)}else t=t.toFixed(a);return t},e.ChartEngine.prototype.formatPrice=function(t,e){if(0!==t&&(!t||void 0===t))return"";if(e||(e=this.currentPanel),e||(e=this.chart.panel),!e)return t.toString();var i=e.decimalPlaces;if(i||0===i||(i=e.chart.decimalPlaces),!i&&0!==i)return t.toString();var a=this.internationalizer;if(a){var r=a.priceFormatters.length;i>=r&&(i=r-1),t=a.priceFormatters[i].format(t)}else t=t.toFixed(i);return t},e.ChartEngine.prototype.createCrosshairs=function(){if(!this.runPrepend("createCrosshairs",arguments)&&!(!this.manageTouchAndMouse||this.mainSeriesRenderer&&this.mainSeriesRenderer.nonInteractive)){var t=this.controls.crossX,e=this.controls.crossY;t&&(t.onmousedown||(t.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),e&&(e.onmousedown||(e.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),this.runAppend("createCrosshairs",arguments)}},e.ChartEngine.prototype.determineMinMax=function(t,i,a,r,s){var n=-1*Number.MAX_VALUE,o=Number.MAX_VALUE,l=!1,h=t.length;s&&(h=s);for(var c=0;c<=h+1;c++){var u;if(i.length&&(u=c==h?this.getPreviousBar(this.chart,i[0],0):c==h+1?this.getNextBar(this.chart,i[0],h-1):t[c]),u){if(!r)if(u.transform)l=!0,u=u.transform;else if(l)continue;for(var p=0,d=0;d<i.length;d++){var m=e.existsInObjectChain(u,i[d]);if(m){var g=m.obj[m.member];"number"==typeof g&&(g=[g]);for(var f=0;f<g.length;f++){var y=g[f];(y||0===y)&&(a?((p+=y)>n&&(n=p),p<o&&(o=p)):(y>n&&(n=y),y<o&&(o=y)))}}}}}return n==-1*Number.MAX_VALUE&&(n=0),o==Number.MAX_VALUE&&(o=0),[o,n]},e.ChartEngine.prototype.calculateYAxisRange=function(t,e,i,a){i==Number.MAX_VALUE&&(i=0,a=0);var r=t.height,s=null,n=null;this.adjustYAxisHeightOffset(t,e),e.height=e.bottom-e.top;var o=Math.round(Math.abs(r/5));e.zoom>=0&&r-Math.abs(e.scroll)<o&&(e.scroll=(r-o)*(e.scroll<0?-1:1));var l=t.chart.name===t.name&&t.yAxis.name===e.name,h=i>0&&(this.layout.semiLog||"log"==this.layout.chartScale)&&!t.chart.isComparison&&"pandf"!=this.layout.aggregationType;if(i||0===i){if(a-i==0){var c=Math.pow(10,-(i.toString()+".").split(".")[1].length);1==c&&(c=100),s=i+c,n=i-c}else if(l&&h&&(a||0===a)){var u=Math.log(i)/Math.LN10,p=Math.log(a)/Math.LN10;s=Math.pow(10,p),n=Math.pow(10,u)}else s=a,n=i;e.high=s,e.low=n}(e.max||0===e.max)&&(e.high=e.max),(e.min||0===e.min)&&(e.low=e.min),e.shadow=e.high-e.low,l&&(e.semiLog!=h&&(this.clearPixelCache(),e.semiLog=h),e.flipped=this.layout.flipped)},e.ChartEngine.prototype.renderYAxis=function(t){if(!this.runPrepend("renderYAxis",arguments)){this.rendererAction(t,"yAxis");var i=t.context;for(var a in this.panels){var r=this.panels[a];if(r.chart==t){var s,n,o=r.yaxisRHS.concat(r.yaxisLHS),l={};for(s=0;s<o.length;s++)n=o[s],this.calculateYAxisRange(r,n,n.lowValue,n.highValue),e.Studies&&(l=e.Studies.getYAxisParameters(this,n)),l.yAxis=n,this.createYAxis(r,l),this.drawYAxis(r,l),e.Studies&&e.Studies.doPostDrawYAxis(this,n);for(s=0;s<o.length;s++)if((n=o[s]).dropzone){var h=this.canvasStyle("stx-subholder dropzone left");if(h)if(i.strokeStyle=h.borderLeftColor,i.lineWidth=parseFloat(h.borderLeftWidth),i.beginPath(),"all"==n.dropzone)i.strokeRect(n.left,n.top,n.width,n.height);else{var c=n.left+("left"==n.dropzone?0:n.width);i.moveTo(c,n.top),i.lineTo(c,n.top+n.height),i.stroke()}}this.displayDragOK(!0)}}this.runAppend("renderYAxis",arguments)}},e.ChartEngine.prototype.initializeDisplay=function(t){if(!this.runPrepend("initializeDisplay",arguments)){var i,a=[],r=!1,s=this,n=["Close","Open","High","Low"],o=[t.defaultPlotField||"Close"],l=null,h=Math.floor((t.width-this.micropixels)/this.layout.candleWidth);t.scroll>t.maxTicks&&t.maxTicks>h+1&&(l=t.dataSegment.length-1);var c=[];for(var u in this.panels){var p=this.panels[u];c=p.yaxisLHS.concat(p.yaxisRHS);for(var d=0;d<c.length;d++){var m=c[d];a=[];var g=t.transformFunc&&m==t.panel.yAxis;if(b(m,p),this.currentlyImporting||m.renderers.length||m.studies.length){if(i=this.mainSeriesRenderer&&this.mainSeriesRenderer.determineMax?this.mainSeriesRenderer.determineMax(t.dataSegment,a,r,!g,l):this.determineMinMax(t.dataSegment,a,r,!g,l),this.mainSeriesRenderer&&t.yAxis==m&&(!this.mainSeriesRenderer.highLowBars||!this.highLowBars[this.layout.chartType])){var f=this.mainSeriesRenderer||{};if(t.panel==p&&f.params&&f.params.baseline&&"mountain"!=f.params.type){var y=t.baseline.actualLevel;if(y||0===y){g&&(y=t.transformFunc(this,t,y));var v=Math.max(y-i[0],i[1]-y);this.repositioningBaseline?i=[t.lowValue,t.highValue]:(i[0]=y-v,i[1]=y+v)}}}m.lowValue=i[0],m.highValue=i[1],m==t.panel.yAxis&&(t.lowValue=m.lowValue,t.highValue=m.highValue)}else this.deleteYAxisIfUnused(p,m)}}var x=t.state.aggregation;x&&x.box&&(t.lowValue-=x.box/2,t.highValue+=x.box/2),this.runAppend("initializeDisplay",arguments)}function b(i,l){var h=!1,c=s.layout&&s.layout.studies&&s.layout.studies[i.name];if(c&&(!l||l.name==c.panel)){for(var u in c.outputMap)a.push(u);c.study&&(c.study.renderer?a=a.concat(e.createObjectChainNames(u,n)):c.study.seriesFN||(a=a.concat(e.createObjectChainNames(u,o))));for(var p=0;p<=2;p++)a.push(c.name+"_hist"+(p||""));h=!0}if(l){for(var d in i.studies=[],i.renderers=[],h&&i.studies.push(i.name),t.seriesRenderers){var m=t.seriesRenderers[d],g=m.params,f=g.panel;if((g.yAxis||!s.panels[f]||s.panels[f].yAxis)==i&&f==l.name){var y=m.highLowBars?n:o;r=m.useSum;for(var v=0;v<m.seriesParams.length;v++){var x=m.seriesParams[v];x.subField?a=a.concat(e.createObjectChainNames(x.symbol,[x.subField])).concat(x.symbol):x.symbol?a=a.concat(e.createObjectChainNames(x.symbol,y)).concat(x.symbol):x.field?a.push(x.field):i==t.panel.yAxis&&(a=a.concat(y))}i.renderers.push(d)}}for(var S in s.overlays){var C=s.overlays[S];if(C.panel==l.name)if(C.name!=i.name)C.getYAxis(s)==i&&(i.studies.push(C.name),t.includeOverlaysInMinMax&&b({name:C.name}))}}}},e.ChartEngine.prototype.computePosition=function(t,e){return void 0===e&&(e=0),t*this.layout.candleWidth+e+this.micropixels},e.ChartEngine.prototype.computeColor=function(t,e){return t<e?"stx_candle_up":t>e?"stx_candle_down":"stx_candle_shadow"},e.ChartEngine.prototype.computeLength=function(t,e){var i=this.pixelFromPrice(t);return this.pixelFromPrice(e)-i},e.ChartEngine.prototype.setSeriesRenderer=function(t){var e=t.params;return this.chart.seriesRenderers[e.name]?this.chart.seriesRenderers[e.name]:(e.yAxis&&(e.yAxis=this.addYAxis(this.panels[e.panel],e.yAxis),this.resizeChart()),t.stx=this,this.chart.seriesRenderers[e.name]=t,t)},e.ChartEngine.prototype.setMainSeriesRenderer=function(t){var i=this.layout.chartType,a=this.layout.aggregationType,r=this.chart.customChart,s=this.mainSeriesRenderer;s&&(t&&this.setMasterData(),s.removeAllSeries(t),this.removeSeriesRenderer(s),s=this.mainSeriesRenderer=null);var n={panel:this.chart.panel.name,name:"_main_series",highlightable:!1,useChartLegend:!0};if(r&&r.chartType&&(i=r.chartType),"none"!=i){a&&"ohlc"!=a&&(i=a);var o=e.Renderer.produce(i,n);o&&(this.setSeriesRenderer(o).attachSeries(null,{display:this.chart.symbol}),this.mainSeriesRenderer=o),["highLowBars","standaloneBars","barsHaveWidth"].forEach(function(t){this.chart[t]=this.mainSeriesRenderer&&this.mainSeriesRenderer[t]}.bind(this))}},e.ChartEngine.prototype.setMarket=function(t,i){for(var a in i||(i=this.chart),i.market=new e.Market(t),this.layout.marketSessions)i.market.disableSession(a,this.layout.marketSessions[a])},e.ChartEngine.prototype.setMarketFactory=function(t){this.marketFactory=t},e.ChartEngine.prototype.removeSeriesRenderer=function(t){for(var e in this.chart.seriesRenderers)if(t.params.name===this.chart.seriesRenderers[e].params.name){var i=this.chart.seriesRenderers[t.params.name];i.params.yAxis,this.panels[i.params.panel];delete this.chart.seriesRenderers[t.params.name];break}},e.ChartEngine.prototype.getSeriesRenderer=function(t){return this.chart.seriesRenderers[t]},e.ChartEngine.prototype.startClip=function(t,e){t||(t=this.chart.panel.name);var i=this.panels[t],a=i.yAxis,r=this.chart;r.context.save(),r.context.beginPath();var s=i.left,n=i.width;e?(s=0,n=this.width):i.yaxisLHS&&i.yaxisLHS.length&&(s++,n--),r.context.rect(s,a.top,n,a.height),r.context.clip()},e.ChartEngine.prototype.endClip=function(){this.chart.context.restore()},e.ChartEngine.prototype.setLineStyle=function(t,i){var a={};t&&"object"==_typeof(t)?a=t:a.color=t,a.color||a.pattern||a.width||(a=null),i||(i=this.chart);var r=1;a&&a.width&&(r=a.width),a&&a.pattern&&(a.pattern=e.borderPatternToArray(r,a.pattern)),i.lineStyle=a},e.ChartEngine.prototype.setGapLines=function(t,i){i||(i=this.chart);var a={};if(t&&"object"==_typeof(t))a=t;else{if("boolean"==typeof t)return i.gaplines=t;a.color=t}a.color||a.pattern||a.fillMountain||(a=null),a&&a.pattern&&(a.pattern=e.borderPatternToArray(a.pattern)),a&&a.width<=0&&(a.width=null),i.gaplines=a},e.ChartEngine.prototype.getGapColorFunction=function(t,e,i,a,r){return"object"!=_typeof(i)&&(i={color:i}),function(s,n,o){var l=r?r(s,n,o):i;l.color&&(l=l.color);var h=n[t];return h||0===h||(h=n[e]),o||!h&&0!==h?a?("object"!=_typeof(a)&&(a="string"==typeof a?{color:a}:{}),{color:a.color||l,pattern:a.pattern||i.pattern,width:a.width||i.width}):null:{color:l,pattern:i.pattern,width:i.width}}},e.ChartEngine.prototype.drawLineChart=function(t,i,a,r){var s=this.chart,n=s.context,o=s.lineStyle||{},l=this.canvasStyle(i);r||(r={}),this.startClip(t.name);var h=r.width||o.width||l.width;h&&parseInt(h,10)<=25?n.lineWidth=Math.max(1,e.stripPX(h)):n.lineWidth=1,r.pattern=r.pattern||o.pattern||l.borderTopStyle,r.pattern=e.borderPatternToArray(n.lineWidth,r.pattern),this.canvasColor(i);var c=r.color||o.color;c&&(n.strokeStyle=c),r.skipProjections=!0;var u=r.field||s.defaultPlotField,p=r.subField||s.defaultPlotField||"Close",d=r.gapDisplayStyle;d||!1===d||(d=r.gaps),d||!1===d||(d=s.gaplines),d||(d="transparent"),r.gapDisplayStyle=d;var m=this.getGapColorFunction(u,p,{color:n.strokeStyle,pattern:r.pattern,width:n.lineWidth},d,a);t.chart.tension&&(r.tension=t.chart.tension);var g=this.plotDataSegmentAsLine(u,t,r,m);return g.colors.length||g.colors.push(n.strokeStyle),n.lineWidth=1,this.endClip(),r.returnObject?g:g.colors},e.ChartEngine.prototype.getPreviousBar=function(t,e,i){return this.getNextBarInternal(t,e,i,-1)},e.ChartEngine.prototype.getNextBar=function(t,e,i){return this.getNextBarInternal(t,e,i,1)},e.ChartEngine.prototype.getNextBarInternal=function(t,i,a,r){var s=t.dataSegment&&t.dataSegment[a];if(s)for(var n=s.tick;n>0&&n<t.dataSet.length;){n+=r;var o=t.dataSet[n];if(o){var l=e.existsInObjectChain(o,i);if(l&&l.obj[l.member])return o}}return null},e.ChartEngine.prototype.getFirstLastDataRecord=function(t,e,i){for(var a=i?t.length-1:0;a>=0&&a<t.length;){if(t[a]&&void 0!==t[a][e])return t[a];i?a--:a++}return null},e.ChartEngine.prototype.updateFloatHRLabel=function(t){if(this.floatCanvas){var i=t.yaxisLHS.concat(t.yaxisRHS),a=this.crossYActualPos?this.crossYActualPos:this.cy;if(this.floatCanvas.isDirty&&e.clearCanvas(this.floatCanvas,this),!this.controls.crossX||"none"!=this.controls.crossX.style.display){if(this.controls.crossY){var r=t.width;"roundRectArrow"==this.yaxisLabelStyle&&(r-=7),this.controls.crossY.style.left=t.left+"px",this.controls.crossY.style.width=r+"px"}for(var s=0;s<i.length;s++){var n=i[s],o=this.transformedPriceFromPixel(a,t,n);if(!isNaN(o)&&!((n.min||0===n.min)&&o<n.min||(n.max||0===n.max)&&o>n.max)){var l=null;n!==t.chart.yAxis&&(l=this.decimalPlacesFromPriceTick(n.priceTick),(n.decimalPlaces||0===n.decimalPlaces)&&(l=n.decimalPlaces)),o=n.priceFormatter?n.priceFormatter(this,t,o,l):this.formatYAxisPrice(o,t,l,n);var h=this.canvasStyle("stx-float-price");this.createYAxisLabel(t,o,a,h.backgroundColor,h.color,this.floatCanvas.context,n),this.floatCanvas.isDirty=!0}}}}},e.ChartEngine.prototype.headsUpHR=function(){if(!this.runPrepend("headsUpHR",arguments)){var t=this.currentPanel;if(t){var i=t.chart;this.updateFloatHRLabel(t);var a=this.controls.floatDate;if(a&&!i.xAxis.noDraw){var r=this.barFromPixel(this.cx),s=i.xaxis[r];s&&s.DT?n(e.displayableDate(this,i,s.DT)):s&&s.index?n(s.index):n("")}this.runAppend("headsUpHR",arguments)}}function n(t){e.efficientDOMUpdate(a,"innerHTML",t)}},e.ChartEngine.prototype.setCrosshairColors=function(){},e.ChartEngine.prototype.magnetize=function(){if(this.magnetizedPrice=null,this.preferences.magnet&&!this.runPrepend("magnetize",arguments)&&!this.repositioningDrawing){var t=this.currentVectorParameters.vectorType;if(t&&"projection"!=t&&"freeform"!=t&&("annotation"!=t&&"callout"!=t||!e.ChartEngine.drawingLine)){var i=this.currentPanel,a=i.chart,r=this.crosshairTick;if(!(r>a.dataSet.length)){var s=a.dataSet[r];if(s){var n,o=a.transformFunc&&i.yAxis===a.yAxis;o&&s.transform&&(s=s.transform);var l=this.getRenderedItems(),h=["Open","High","Low","Close"];this.magneticHold&&this.activeDrawing&&this.activeDrawing.penDown?l=-1!=h.indexOf(this.magneticHold)&&-1!=l.indexOf("High")?h:[this.magneticHold]:this.magneticHold=null;for(var c=1e9,u=parseFloat(this.preferences.magnet),p=0;p<l.length;p++){var d=s[l[p]],m=this.getYAxisByField(i,l[p]),g=e.existsInObjectChain(s,l[p]);if(g&&(d=g.obj[g.member]),d||0===d){var f=this.pixelFromTransformedValue(d,i,m);if(Math.abs(this.cy-f)<c){if(c=Math.abs(this.cy-f),u&&u<=c)continue;this.magnetizedPrice=o?this.valueFromPixel(f,i):d,n=f,this.magneticHold=l[p]}}}var y=this.pixelFromTick(r,a),v=n;e.clearCanvas(a.tempCanvas,this);var x=this.chart.tempCanvas.context;x.beginPath(),x.lineWidth=1;var b=Math.max(this.layout.candleWidth,12)/3;x.arc(y,v,Math.min(b,8),0,2*Math.PI,!1),x.fillStyle="#398dff",x.strokeStyle="#398dff",x.fill(),x.stroke(),x.closePath(),this.chart.tempCanvas.style.display="block",this.anyHighlighted&&this.container.classList.remove("stx-draggable"),this.activeDrawing&&this.activeDrawing.move(x,this.crosshairTick,this.magnetizedPrice),this.runAppend("magnetize",arguments)}}}}},e.ChartEngine.prototype.positionCrosshairsAtPointer=function(){var t=this.currentPanel;if(t&&!(!this.manageTouchAndMouse||this.mainSeriesRenderer&&this.mainSeriesRenderer.nonInteractive||this.runPrepend("positionCrosshairsAtPointer",arguments))){var i=t.chart,a=this.container.getBoundingClientRect();this.top=a.top,this.left=a.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cy=this.crossYActualPos=this.backOutY(e.ChartEngine.crosshairY),this.cx=this.backOutX(e.ChartEngine.crosshairX);var r=this.crosshairTick=this.tickFromPixel(this.cx,i),s=this.pixelFromTick(r,i)-1;if(this.controls.crossX&&(this.controls.crossX.style.left=s+"px"),s>=t.right||s<=t.left)this.undisplayCrosshairs();else{var n="chart"==t.name?this.preferences.horizontalCrosshairField:t.horizontalCrosshairField,o=i.dataSet;n&&o&&r<o.length&&r>-1&&(this.crossYActualPos=this.pixelFromPrice(o[r][n],t)),this.controls.crossY&&(this.controls.crossY.style.top=this.crossYActualPos+"px"),this.runAppend("positionCrosshairsAtPointer",arguments)}}},e.ChartEngine.prototype.doDisplayCrosshairs=function(){if(!this.runPrepend("doDisplayCrosshairs",arguments)){if(this.displayInitialized){var t=this.floatCanvas,i=this.currentVectorParameters.vectorType;if(this.layout.crosshair||""!==i&&i)if(e.Drawing&&e.Drawing[i]&&(new e.Drawing[i]).dragToDraw)this.undisplayCrosshairs();else if(this.overXAxis||this.overYAxis||!this.insideChart&&!this.grabbingScreen)this.undisplayCrosshairs();else if(""!==this.openDialog)this.undisplayCrosshairs();else{var a=this.controls,r=a.crossX,s=a.crossY;r&&""!==r.style.display&&(r.style.display="",s&&(s.style.display=""),this.magnetizedPrice&&i?(e.unappendClassName(this.container,"stx-crosshair-on"),this.chart.tempCanvas.style.display="block"):e.appendClassName(this.container,"stx-crosshair-on")),a.floatDate&&!this.chart.xAxis.noDraw&&(a.floatDate.style.visibility="",this.currentPanel&&this.updateFloatHRLabel(this.currentPanel)),t&&(t.style.display="block")}else this.undisplayCrosshairs()}this.runAppend("doDisplayCrosshairs",arguments)}},e.ChartEngine.prototype.undisplayCrosshairs=function(){if(!this.runPrepend("undisplayCrosshairs",arguments)){var t=this.controls,i=t.crossX,a=t.crossY;i&&"none"!=i.style.display&&(i.style.display="none",a&&(a.style.display="none")),this.displayInitialized&&t.floatDate&&(t.floatDate.style.visibility="hidden"),e.unappendClassName(this.container,"stx-crosshair-on");var r=this.floatCanvas;if(r&&r.isDirty&&(e.clearCanvas(r,this),"none"!=r.style.display&&(r.style.display="none")),!this.activeDrawing&&!this.repositioningDrawing&&!this.editingAnnotation){var s=this.chart.tempCanvas;s&&"none"!=s.style.display&&(s.style.display="none")}this.runAppend("undisplayCrosshairs",arguments)}},e.ChartEngine.prototype.modalBegin=function(){this.openDialog="modal",this.undisplayCrosshairs()},e.ChartEngine.prototype.modalEnd=function(){this.cancelTouchSingleClick=!0,this.openDialog="",this.doDisplayCrosshairs()},e.ChartEngine.prototype.updateChartAccessories=function(){var t;if(null!==this.accessoryTimer&&clearTimeout(this.accessoryTimer),!e.ChartEngine.drawingLine&&e.touchDevice&&(new Date).getTime()-this.lastAccessoryUpdate<100)this.accessoryTimer=setTimeout((t=this,function(){t.updateChartAccessories()}),10);else if(this.chart.dataSet&&!this.runPrepend("updateChartAccessories",arguments)){this.positionCrosshairsAtPointer(),this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime();var i=this.controls.floatDate;if(i){var a=this.currentPanel;if(a||(a=this.chart.panel),a){var r=a.chart,s=!0===this.xAxisAsFooter?0:this.chart.canvasHeight-a.chart.bottom,n=i.offsetWidth/2-.5,o=this.pixelFromTick(this.crosshairTick,r)-n;o<0?o=0:o>this.width-2*n-1&&(o=this.width-2*n-1),e.efficientDOMUpdate(i.style,"left",o+"px"),e.efficientDOMUpdate(i.style,"bottom",s+"px")}}this.headsUpHR(),this.runAppend("updateChartAccessories",arguments)}},e.ChartEngine.prototype.mousemove=function(t){var i=t||event;e.ChartEngine.crosshairX=i.clientX,e.ChartEngine.crosshairY=i.clientY,i.type.toLowerCase().indexOf("enter")>-1?this.positionCrosshairsAtPointer():this.runPrepend("mousemove",arguments)||this.displayInitialized&&""===this.openDialog&&(this.grabbingScreen&&1!==i.buttons&&(this.cancelLongHold=!0,this.displayDragOK(),this.grabbingScreen=!1,this.findHighlights(!1,!0)),this.mousemoveinner(i.clientX,i.clientY),this.runAppend("mousemove",arguments))},e.ChartEngine.prototype.setResizeTimer=function(t){function i(t,i){var a=function(){t.chart.canvas&&(e.isAndroid||t.chart.canvas.height==Math.floor(t.devicePixelRatio*t.chart.container.clientHeight)&&t.chart.canvas.width==Math.floor(t.devicePixelRatio*t.chart.container.clientWidth)||t.resizeChart())};return function(){"undefined"!=typeof ResizeObserver?e.ChartEngine.useAnimation?requestAnimationFrame(a):setTimeout(a,0):a()}}this.resizeDetectMS=t,t?"undefined"!=typeof ResizeObserver?this.resizeHandle||(this.resizeHandle=new ResizeObserver(i(this)),this.resizeHandle.observe(this.chart.container)):(this.resizeHandle&&clearInterval(this.resizeHandle),this.resizeHandle=setInterval(i(this),t)):(this.resizeHandle&&("undefined"!=typeof ResizeObserver?this.resizeHandle.disconnect():clearInterval(this.resizeHandle)),this.resizeHandle=null)},e.ChartEngine.prototype.whichYAxis=function(t,e,i){void 0===e&&(e=this.cx),void 0===i&&(i=this.cy);var a=this.whichPanel(i);if(t&&t==a)for(var r=t.yaxisLHS.concat(t.yaxisRHS),s=0;s<r.length;s++){var n=r[s];if(n.left<=e&&n.left+n.width>=e)return n}return null},e.ChartEngine.prototype.yaxisMatches=function(t,i){return!!(t&&t.getYAxis&&i&&i instanceof e.ChartEngine.YAxis)&&t.getYAxis(this).name==i.name},e.ChartEngine.prototype.findHighlights=function(t,i){var a=this.preferences[t?"highlightsTapRadius":"highlightsRadius"];this.highlightViaTap=t;var r=this.cy,s=this.cx;if(this.anyHighlighted=!1,this.currentPanel){this.activeDrawing&&(i=!0);var n=!1,o=null,l=i?{}:{forceShow:!0,type:"drawing"},h=this.currentPanel.chart,c={x0:this.tickFromPixel(s-a,h),x1:this.tickFromPixel(s+a,h),y0:this.valueFromPixel(r-a,this.currentPanel),y1:this.valueFromPixel(r+a,this.currentPanel),cx0:s-a,cx1:s+a,cy0:r-a,cy1:r+a,r:a};this.repositioningDrawing&&c.x1-c.x0<2?(c.x1++,c.x0--):c.x1==c.x0&&(c.x0-=.5,c.x1+=.5);var u,p,d,m,g,f,y=this.markerHelper&&this.markerHelper.chartMap[h.name]&&this.markerHelper.chartMap[h.name].markers;if(!h.hideDrawings)for(var v=this.drawingObjects.length-1;v>=0;v--){var x=this.drawingObjects[v];if(this.panels[x.panelName]&&(!this.repositioningDrawing||this.repositioningDrawing==x)){var b=x.highlighted,S=x.panelName==this.currentPanel.name;x.repositioner=x.intersected(this.crosshairTick,this.crosshairValue,c),S=S&&x.repositioner,!i&&S?(b?(o=x,this.anyHighlighted&&this.singleDrawingHighlight&&(x.highlighted=!1)):b!=x.highlight(!0)&&(o||(o=x),this.anyHighlighted&&this.singleDrawingHighlight&&(x.highlighted=!1),n=!0),this.anyHighlighted=!0):b!=x.highlight(!1)&&(n=!0),x.highlighted&&(l.noDelete=x.permanent,l.noEdit="function"!=typeof this.callbacks.drawingEdit&&!this.callbackListeners.drawingEdit.length)}}for(u in this.layout.studies)(p=this.layout.studies[u]).prev=p.highlight,p.highlight=this.yaxisMatches(p,this.grabStartYAxis);for(u in h.seriesRenderers){var C=h.seriesRenderers[u];C.params.highlight=this.yaxisMatches(C,this.grabStartYAxis);for(var w=0;w<C.seriesParams.length;w++)(g=C.seriesParams[w]).prev=g.highlight,g.highlight=C.params.highlight}for(d=0;y&&d<y.length;d++)(m=y[d]).params.box&&(this.activeMarker=null,m.prev=y[d].highlight,m.highlight=!1);if(this.markerHelper.highlighted=[],this.highlightedDataSetField=null,this.highlightedDraggable=null,!i&&!this.anyHighlighted&&h.dataSegment){var T=this.barFromPixel(s);if(T>=0&&T<h.dataSegment.length){var k;for(u in this.overlays){if((p=this.overlays[u]).panel==this.currentPanel.name)if(!1!==p.study.isHighlighted)if("function"!=typeof p.study.isHighlighted){if(h.dataSegment[T]){for(var D in p.outputMap)if(Y.call(this,T,c,D,p.getYAxis(this))){p.name!=p.panel&&(this.anyHighlighted=!0),p.highlight=D;break}if(p.highlight){this.highlightedDataSetField=D;break}}}else p.study.isHighlighted(this,s,r)&&(p.highlight=!0,this.anyHighlighted=!0)}for(u in h.seriesRenderers){if(this.highlightedDataSetField)break;var M=h.seriesRenderers[u],A=M.params.panel;if(M!=this.mainSeriesRenderer&&((M.params.highlightable||this.currentVectorParameters.vectorType)&&A==this.currentPanel.name))for(d=0;d<M.seriesParams.length;d++){var F=(g=M.seriesParams[d]).field;F||M.highLowBars||(F=this.defaultPlotField||"Close"),g.symbol&&g.subField&&(F+="--\x3e"+g.subField);var P=M.params.yAxis;if(!P&&A&&(P=this.panels[A].yAxis),M.params.step&&T>0){if(!M.caches[g.id])continue;if(!(k=M.caches[g.id][T])&&0!==k)continue;var _=M.caches[g.id][T-1];((_||0===_)&&r+a>=k&&r-a<=_||r-a<=k&&r+a>=_)&&(g.highlight=!0,this.anyHighlighted=!0)}else Y.call(this,T,c,F,P,M,g.id)&&(g.highlight=!0,this.anyHighlighted=!0);if(g.highlight){this.highlightedDataSetField=F;break}}}}}var E,L=this.preferences.dragging;for(u in this.overlays){if((p=this.overlays[u]).highlight){this.anyHighlighted=!0;var N=p.inputs.display||p.name;l={message:N=this.translateIf(N),noDelete:p.permanent,noEdit:!p.editFunction,type:"study"},o=null,(!0===L||L&&L.study)&&(f=p),E=p.getYAxis(this)}p.prev!=p.highlight&&(n=!0)}for(u in h.seriesRenderers)for(var R=h.seriesRenderers[u],O=R.params.yAxis?R.params.yAxis.textStyle:null,I=0;I<R.seriesParams.length;I++)g=R.seriesParams[I],R.params.highlightable&&g.highlight&&(this.anyHighlighted=!0,l={message:g.display||g.symbol,backgroundColor:g.color||O,noDelete:g.permanent,type:"series"},o=null,(!0===L||L&&L.series)&&(f=R,R.params.highlight=!0),E=R.getYAxis(this)),g.prev!=g.highlight&&(n=!0);var H=this.whichPanel(r),z=this.whichYAxis(H,s);E||(E=z),E&&(E.highlight||(n=!0),E.highlight=!0);var B=[];for(var j in this.panels)B=B.concat(this.panels[j].yaxisLHS).concat(this.panels[j].yaxisRHS);for(u=0;u<B.length;u++)(E!=B[u]||i)&&(B[u].highlight&&(n=!0),B[u].highlight=!1);for(d=0;y&&d<y.length;d++){var V=(m=y[d]).params.box;if(V){var W=e.convertBoxToPixels(this,this.currentPanel.name,c);e.boxIntersects(W.x0,W.y0,W.x1,W.y1,V.x0,V.y0,V.x1,V.y1)&&(this.activeMarker=m,m.highlight=!0,this.markerHelper.highlighted.push(m)),m.prev!=m.highlight&&(n=!0)}}if(n&&(this.draw(),l.panel=H,this.anyHighlighted&&!this.grabStartYAxis?l.panel=H:l={},this.displaySticky(l),this.clearMeasure(),o&&o.measure()),(!0===L||L&&L.yaxis)&&z&&!z.noDraw&&(this.anyHighlight=!0,f=z),this.anyHighlighted||this.setMeasure(),f&&!H.noDrag){if(this.longHoldTookEffect&&!this.cancelLongHold&&(this.highlightedDraggable=f,f.getDependents)){var U=f.getDependents(this,!0);for(u in this.overlays)p=this.overlays[u],U.indexOf(p)>-1&&(p.highlight=!0)}e.appendClassName(this.container,"stx-draggable")}else e.unappendClassName(this.container,"stx-draggable");this.highlightedDataSetField=this.adjustHighlightedDataSetField(this.highlightedDataSetField),this.displayDrawOK()}function Y(t,i,a,r,s,n){var o=this.chart,l=this.currentPanel;r||(r=l.yAxis);var h=a.split("--\x3e"),c=h[0],u=h[1];function p(t){if(!t)return null;var e=t[c];return e&&(e[u]||0===e[u])&&(e=e[u]),s&&s.getBasis&&(e+=s.getBasis(t,c,u)),o.transformFunc&&r==o.yAxis?t.transform&&c in t.transform?((e=t.transform[c])&&(e[u]||0===e[u])&&(e=e[u]),e):o.transformFunc(this,o,e):e}u||(u="Close");var d,m,g,f,y,v=o.dataSegment[T],x=null,b=null,S=null,C=new Array(3),w=s&&s.caches[n];if(v&&w){var k;for(g=w[T],x=v.tick,(g||0===g)&&(C[0]=1),k=T-1;k>=0;k--)if(w[k]||0===w[k]){f=w[k],b=x-(T-k),C[1]=1;break}for(k=T+1;k<o.dataSegment.length;k++)if(w[k]||0===w[k]){y=w[k],S=x-(T-k),C[2]=1;break}}if(null===b&&(d=this.getPreviousBar.call(this,o,a,T))&&(b=d.tick,f=p(d)),null===S&&(m=this.getNextBar.call(this,o,a,T))&&(S=m.tick,y=p(m)),null===b&&null===S)return!1;w||(g=p(v),f=p(d),y=p(m),x=v.tick,d&&(b=d.tick),m&&(S=m.tick)),f||0===f||(f=0,b=0),y||0===y||(g||0===g?(y=g,C[2]=C[0]):(y=f,C[2]=C[1]),S=o.dataSet.length-1),g||0===g||(g=y,x=S,C[0]=C[2],0===f&&0===b&&(f=g,b=x,C[1]=C[0]));var D=this.pixelFromTransformedValue.bind(this),M=this.valueFromPixel.bind(this);g=M(C[0]?g:D(g,l,r),l),f=M(C[1]?f:D(f,l,r),l),y=M(C[2]?y:D(y,l,r),l);var A=e.convertBoxToPixels(this,l.name,i),F=e.convertBoxToPixels(this,l.name,{x0:b,y0:f,x1:x,y1:g}),P=e.convertBoxToPixels(this,l.name,{x0:x,y0:g,x1:S,y1:y});return!(!e.boxIntersects(A.x0,A.y0,A.x1,A.y1,F.x0,F.y0,F.x1,F.y1,"segment")&&!e.boxIntersects(A.x0,A.y0,A.x1,A.y1,P.x0,P.y0,P.x1,P.y1,"segment"))}},e.ChartEngine.prototype.getRenderedItems=function(){var t=this.chart,i=this.currentPanel;if(i){var a=["Open","High","Low","Close"],r=["Close"],s=[];for(var n in this.overlays)this.overlays[n].panel===i.name&&(s=s.concat(Object.keys(this.overlays[n].outputMap)));for(var o in t.seriesRenderers){var l=t.seriesRenderers[o];if(l.params.panel==i.name)for(var h in l.seriesParams){var c=l.seriesParams[h],u=l.highLowBars?a:r;c.subField?s=s.concat(e.createObjectChainNames(c.symbol,[c.subField])).concat(c.symbol):c.symbol?s=s.concat(e.createObjectChainNames(c.symbol,u)).concat(c.symbol):c.field?s.push(c.field):i==t.panel&&(s=s.concat(u))}}return s}},e.ChartEngine.prototype.displayDragOK=function(t){function i(t){var e=this.translateIf(t.querySelector(".field").getAttribute("text")),i=this.whichYAxis(this.whichPanel(this.cy),this.cx,this.cy);i&&"all"==i.dropzone&&(e+="--\x3e"+this.translateIf(i.name)),t.querySelector(".field").innerHTML=e}var a=this.controls.dragOk;if(a){t||this.findHighlights(this.highlightViaTap);var r=this.highlightedDraggable,s=this.cx,n=this.cy;if(!t){if(r&&this.longHoldTookEffect&&!this.cancelLongHold){var o=r.inputs&&r.inputs.display||r.params&&r.params.name||r.name;a.querySelector(".field").setAttribute("text",o),i.call(this,a),a.style.display="inline-block",this.draw(),this.displaySticky(),this.grabStartYAxis?e.swapClassName(this.container,"stx-drag-axis","stx-drag-chart"):e.swapClassName(this.container,"stx-drag-series","stx-drag-chart")}else for(var l in a.style.display="none",this.draw(),e.unappendClassName(this.container,"stx-drag-series"),e.unappendClassName(this.container,"stx-drag-axis"),this.panels){var h,c=this.panels[l].subholder.classList;for(c.remove("dropzone"),c.remove("all"),c.remove("left"),c.remove("right"),c.remove("top"),c.remove("bottom"),h=0;h<this.panels[l].yaxisLHS.length;h++)this.panels[l].yaxisLHS[h].dropzone=null;for(h=0;h<this.panels[l].yaxisRHS.length;h++)this.panels[l].yaxisRHS[h].dropzone=null}this.draw()}if(r){var u=n+a.offsetHeight,p=Math.max(0,s-a.offsetWidth);a.style.top=u+"px",a.style.left=p+"px",i.call(this,a)}}},e.ChartEngine.prototype.displayDrawOK=function(){var t=this.controls.drawOk;if(t&&e.Drawing){var i=e.Drawing[this.currentVectorParameters.vectorType];if(i&&(i=new i),this.highlightedDataSetField&&i&&i.getYValue){t.style.display="inline-block";var a=this.cy+t.offsetHeight,r=this.cx-t.offsetWidth;t.style.top=a+"px",t.style.left=r+"px",t.querySelector(".field").innerHTML=this.translateIf(this.highlightedDataSetField)}else t.style.display="none"}},e.ChartEngine.prototype.positionSticky=function(t){var e=Math.max(this.cy-t.offsetHeight-60,0),i=Math.min(this.chart.canvasWidth-(this.cx-50),this.chart.canvasWidth-t.offsetWidth);t.style.top=e+"px",t.style.right=i+"px"},e.ChartEngine.prototype.displaySticky=function(t){var i=this.controls.mSticky;if(i){var a=i.querySelector(".mStickyInterior");if(a){var r=i.querySelector(".overlayTrashCan"),s=i.querySelector(".overlayEdit"),n=i.querySelector(".mouseDeleteInstructions"),o=i.querySelector(".stickyLongPressText");e.unappendClassName(n,"no_edit"),t&&"object"==_typeof(t)||(t={message:arguments[0],backgroundColor:arguments[1],forceShow:arguments[2],noDelete:arguments[3],type:arguments[4]});var l=t.message,h=t.backgroundColor,c=t.forceShow,u=t.noDelete,p=t.noEdit,d=t.type;if(c||l){l||(l=""),c&&!l?(a.style.backgroundColor="",a.style.color="",a.style.display="none"):h?(a.style.backgroundColor=h,a.style.color=e.chooseForegroundColor(h),a.style.display="inline-block"):(a.style.backgroundColor="",a.style.color="",a.style.display="inline-block"),a.innerHTML=l;var m=i.querySelector(".mStickyRightClick");if(m.className="mStickyRightClick",d&&e.appendClassName(m,"rightclick_"+d),m.style.display="",i.style.display="inline-block",u||!0===this.bypassRightClick||this.bypassRightClick[d])m.style.display="none";else if(this.highlightViaTap||this.touches.length)r&&(r.style.display="inline-block"),s&&!p&&(s.style.display="inline-block"),n&&(n.style.display="none"),o&&(o.style.display="none"),e[(""===l?"":"un")+"appendClassName"](i,"hide");else if(p&&e.appendClassName(n,"no_edit"),n&&(n.style.display="block"),o){o.style.display="none";var g=this.preferences.dragging;g&&t.panel&&!t.panel.noDrag&&((!0!==g&&!g.study||"study"!=d)&&(!0!==g&&!g.series||"series"!=d)||(o.style.display="block"))}this.positionSticky(i)}else a.innerHTML="",i.style.display="none",r&&(r.style.display="none"),s&&(s.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none")}}},e.ChartEngine.prototype.setMeasure=function(t,i,a,r,s){if(!this.runPrepend("setMeasure",arguments)){var n=(this.drawingContainer||document).querySelector(".mMeasure"),o="";if(t||0===t){if(!1!==i){var l,h=Math.round(Math.abs(t-i)*this.chart.roundit)/this.chart.roundit;h=h.toFixed(this.chart.yAxis.printDecimalPlaces),this.internationalizer?o+=this.internationalizer.numbers.format(h):o+=h,t>0&&i>0&&(l=(i-t)/t,l=Math.abs(l)>.1?Math.round(100*l):Math.abs(l)>.01?Math.round(1e3*l)/10:Math.round(1e4*l)/100,this.internationalizer?l=this.internationalizer.percent.format(l/100):l+="%",o+=" ("+l+")")}if(!1!==r){var c=Math.abs(r-a);c=Math.round(c)+1;var u=this.translateIf("Bars");o+=" "+c+" "+u}n&&(n.innerHTML=o)}else this.anyHighlighted||""!==this.currentVectorParameters.vectorType||this.clearMeasure();if(!this.activeDrawing){if(n=this.controls.mSticky){var p=n.querySelector(".mStickyInterior");s?(n.style.display="inline-block",p.style.display="inline-block",(t||0===t)&&(p.innerHTML=o),e[(""===o?"":"un")+"appendClassName"](n,"hide"),this.positionSticky(n)):(n.style.display="none",p.innerHTML="")}this.runAppend("setMeasure",arguments)}}},e.ChartEngine.prototype.clearMeasure=function(){var t=(this.drawingContainer||document).querySelector(".mMeasure");t&&(t.innerHTML="")},e.ChartEngine.prototype.pixelFromBar=function(t,e){e||(e=this.chart);var i=0,a=this.chart.segmentImage;return i=a&&a[t]&&a[t].leftOffset?a[t].leftOffset:(t+.5)*this.layout.candleWidth,i=e.panel.left+Math.floor(i+this.micropixels)-1},e.ChartEngine.prototype.barFromPixel=function(t,e){e||(e=this.chart);var i=this.chart.segmentImage,a=this.micropixels,r=this.layout.candleWidth;if(i){var s,n,o,l=t-e.panel.left-a,h=2,c=i.length,u=Math.round(c/h),p=i[c-1].leftOffset+i[c-1].candleWidth/2;if(l>p)return c+Math.floor((t-p-e.panel.left-a)/r);for(var d=1;d<c&&(h*=2,s=i[u]);d++){var m=(n=s.leftOffset)-(o=s.candleWidth/2);if(0===u||l>=m&&l<n+o)break;l<m?u-=Math.max(1,Math.round(c/h)):u+=Math.max(1,Math.round(c/h)),u=Math.max(0,Math.min(c-1,u))}if(!i[u])for(d=0;d<c;d++)if(s=i[d]){if(l<(n=s.leftOffset)-(o=s.candleWidth/2))return Math.max(0,d-1);if(l<n+o)return d;if(l>=n+o)return d+1}return u}return Math.floor((t-e.panel.left-a)/r)},e.ChartEngine.prototype.tickFromPixel=function(t,e){e||(e=this.chart);var i=e.dataSet.length-e.scroll;return e.segmentImage?i+=this.barFromPixel(t,e):i+=Math.floor((t-e.panel.left-this.micropixels)/this.layout.candleWidth),i},e.ChartEngine.prototype.pixelFromTick=function(t,e){e||(e=this.chart);var i=e.dataSegment,a=e.dataSet,r=e.segmentImage,s=this.micropixels,n=i?i.length:0,o=e.panel,l=e.scroll,h=t-a.length+l,c=n?i[h]:null;if(r&&(c=r[h]),c&&c.leftOffset)return o.left+Math.floor(c.leftOffset+s);var u=0,p=0;return c=n?i[n-1]:null,r&&(c=r[n-1]),c&&c.leftOffset&&n<t-a.length+l&&(u=c.leftOffset-c.candleWidth/2,p=n),u+o.left+Math.floor((t-p-a.length+l+.5)*this.layout.candleWidth+s)},e.ChartEngine.prototype.pixelFromDate=function(t,e,i,a){return this.pixelFromTick(this.tickFromDate(t,e,i,a),e)},e.ChartEngine.prototype.transformedPriceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a,r=i||e.yAxis;if(t=r.bottom-t,r.semiLog){var s=t*r.logShadow/r.height;r.flipped?s=r.logHigh-s:s+=r.logLow,a=Math.pow(10,s)}else{if(!r.multiplier)return null;a=t/r.multiplier,r.flipped?a=r.high-a:a+=r.low}return a},e.ChartEngine.prototype.priceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a=this.transformedPriceFromPixel(t,e,i);return this.charts[e.name]&&e.chart.untransformFunc&&(i&&i!=e.yAxis||(a=e.chart.untransformFunc(this,e.chart,a,i))),a},e.ChartEngine.prototype.valueFromPixel=function(t,i,a){return i||(i=this.whichPanel(t)),i||(i=t<=0?this.panels[e.first(this.panels)]:this.panels[e.last(this.panels)]),this.priceFromPixel(t,i,a)},e.ChartEngine.prototype.valueFromPixelUntransform=function(t,e,i){return this.valueFromPixel(t,e,i)},e.ChartEngine.prototype.valueFromInterpolation=function(t,i,a,r,s){if(null===t||t<0||!i)return null;r||(r=this.chart.panel),s||(s=r.yAxis),a||(a=this.chart.defaultPlotField);var n,o,l=this.getPreviousBar(this.chart,i,t),h=this.getNextBar(this.chart,i,t);if(!l||!h)return null;var c=e.existsInObjectChain(l,i);if(c&&(n=c.obj[c.member]),"object"==_typeof(n)&&(n=n[a]),(c=e.existsInObjectChain(h,i))&&(o=c.obj[c.member]),"object"==_typeof(o)&&(o=o[a]),null==n||null==o)return null;var u=this.pixelFromPrice(n,r,s),p=this.pixelFromPrice(o,r,s),d=l.tick,m=(p-u)/(h.tick-d)*(this.chart.dataSegment[t].tick-d)+u;return this.priceFromPixel(m,r,s)},e.ChartEngine.prototype.pixelFromPriceTransform=function(t,e,i){return this.pixelFromPrice(t,e,i)},e.ChartEngine.prototype.pixelFromTransformedValue=function(t,e,i){e||(e=this.chart.panel);var a=i||e.yAxis,r=(a.high-t)*a.multiplier;if(a.semiLog){var s=Math.max(t,0),n=Math.log(s)/Math.LN10,o=a.height;r=o-o*(n-a.logLow)/a.logShadow}return r=a.flipped?a.bottom-r:a.top+r},e.ChartEngine.prototype.pixelFromPrice=function(t,e,i){return e||(e=this.chart.panel),this.charts[e.name]&&e.chart.transformFunc&&(i&&i!=e.yAxis||(t=e.chart.transformFunc(this,e.chart,t,i))),this.pixelFromTransformedValue(t,e,i)},e.ChartEngine.prototype.pixelFromValueAdjusted=function(t,e,i,a){if(this.layout.adj||!this.charts[t.name])return this.pixelFromPrice(i,t,a);var r,s=Math.round(e);return s>0&&s<t.chart.dataSet.length&&(r=t.chart.dataSet[s].ratio)?this.pixelFromPrice(i*r,t,a):this.pixelFromPrice(i,t,a)},e.ChartEngine.prototype.adjustIfNecessary=function(t,e,i){if(this.layout.adj)return i;if(!t||!this.charts[t.name])return i;var a,r=Math.round(e);return r>0&&r<t.chart.dataSet.length&&(a=t.chart.dataSet[r].ratio)?i/a:i},e.ChartEngine.prototype.setTransform=function(t,e,i){t.transformFunc=e,t.untransformFunc=i},e.ChartEngine.prototype.unsetTransform=function(t){delete t.transformFunc,delete t.untransformFunc;for(var e=0;t.dataSet&&e<t.dataSet.length;e++)t.dataSet[e].transform=null},e.ChartEngine.prototype.undo=function(){this.runPrepend("undo",arguments)||(this.activeDrawing&&(this.activeDrawing.abort(),this.activeDrawing.hidden=!1,this.drawingSnapshot=null,this.activateDrawing(null),e.clearCanvas(this.chart.tempCanvas,this),this.draw(),e.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),e.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing"),e.ChartEngine.drawingLine=!1),this.runAppend("undo",arguments))},e.ChartEngine.prototype.undoStamp=function(t,e){this.undoStamps.push(t),this.dispatch("undoStamp",{before:t,after:e,stx:this})},e.ChartEngine.prototype.undoLast=function(){this.activeDrawing?this.undo():this.undoStamps.length&&(this.drawingObjects=[],this.importDrawings(this.undoStamps.pop()),this.changeOccurred("vector"),this.draw())},e.ChartEngine.prototype.addDrawing=function(t){var e=this.exportDrawings();this.drawingObjects.push(t),this.undoStamp(e,this.exportDrawings())},e.ChartEngine.prototype.connectTheDots=function(t,i,a,r,s,n){if(n||(n={}),"none"!=n.pattern&&(!0===s&&(s=this.chart.panel),null==r&&(r=this.chart.context),!(t.length<4))){var o=0,l=this.chart.canvasHeight,h=this.chart.width;s&&(l=s.yAxis.bottom,o=s.yAxis.top),r.lineWidth=1.1,"object"==_typeof(i)?(r.strokeStyle=i.color,i.opacity?r.globalAlpha=i.opacity:r.globalAlpha=1,r.lineWidth=parseInt(e.stripPX(i.width),10)):!i||"auto"==i||e.isTransparent(i)?r.strokeStyle=this.defaultColor:r.strokeStyle=i,n.opacity&&(r.globalAlpha=n.opacity),n.lineWidth&&(r.lineWidth=n.lineWidth);var c=e.borderPatternToArray(r.lineWidth,n.pattern);r.beginPath();for(var u=0;u<t.length-2;u+=2){var p=t[u],d=t[u+1],m=t[u+2],g=t[u+3];if(isNaN(p)||isNaN(m)||isNaN(d)||isNaN(g))return;for(var f,y,v,x=0,b=1,S=m-p,C=g-d,w=0;w<4;w++){if(0===w&&(f=-S,y=-(0-p)),1==w&&(f=S,y=h-p),2==w&&(f=-C,y=-(o-d)),3==w&&(f=C,y=l-d),v=y/f,(g||0===g)&&0===f&&y<0)return!1;if(f<0){if(v>b)return!1;v>x&&(x=v)}else if(f>0){if(v<x)return!1;v<b&&(b=v)}}var T=p+x*S,k=d+x*C,D=p+b*S,M=d+b*C;try{c&&c.length?r.dashedLineTo(T,k,D,M,c):(r.moveTo(T,k),r.lineTo(D,M))}catch(t){}}r.stroke(),r.closePath(),r.globalAlpha=1,r.lineWidth=1}},e.ChartEngine.prototype.plotSpline=function(t,a,r,s,n,o,l){if(l||(l={}),"none"!=l.pattern){!0===o&&(o=this.chart.panel),null==n&&(n=this.chart.context),n.save(),n.lineWidth=1.1,"object"==_typeof(r)?(n.strokeStyle=r.color,r.opacity?n.globalAlpha=r.opacity:n.globalAlpha=1,n.lineWidth=parseInt(e.stripPX(r.width),10)):!r||"auto"==r||e.isTransparent(r)?n.strokeStyle=this.defaultColor:n.strokeStyle=r,l.opacity&&(n.globalAlpha=l.opacity),l.lineWidth&&(n.lineWidth=l.lineWidth);var h=e.borderPatternToArray(n.lineWidth,l.pattern);l.pattern&&n.setLineDash&&(n.setLineDash(h),n.lineDashOffset=0),n.beginPath(),i.plotSpline(t,a,n),n.stroke(),n.closePath(),n.restore()}},e.ChartEngine.prototype.repositionDrawing=function(t,i){var a=this.panels[t.panelName],r=this.adjustIfNecessary(a,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),a)),s=this.chart.tempCanvas;e.clearCanvas(s,this),i?(this.drawingSnapshot=this.exportDrawings(),t.render(s.context)):(t.reposition(s.context,t.repositioner,this.crosshairTick,r),this.drawingSnapshot&&this.undoStamp(e.shallowClone(this.drawingSnapshot),this.exportDrawings()),this.drawingSnapshot=null),t.measure&&t.measure()},e.ChartEngine.prototype.activateRepositioning=function(t){this.repositioningDrawing=t;t&&(this.draw(),this.repositionDrawing(t,!0)),this.chart.tempCanvas.style.display=t?"block":"none"},e.ChartEngine.prototype.activateDrawing=function(t,i){function a(t){if(t.layout.studies){var e=t.layout.studies[i.name];e&&!e.overlay&&delete t.overlays[e.name]}}if(i||(i=this.currentPanel),!t)return this.activeDrawing=null,this.chart.tempCanvas.style.display="none",a(this),!1;var r=e.ChartEngine.drawingTools[t];return r||e.Drawing[t]&&(r=e.Drawing[t],e.ChartEngine.registerDrawingTool(t,r)),r&&(this.activeDrawing=new r,this.activeDrawing.construct(this,i),!this.charts[i.name]&&this.activeDrawing.chartsOnly)?(this.activeDrawing=null,a(this),!1):(this.chart.tempCanvas.style.display="block",this.controls.drawOk&&(this.controls.drawOk.style.display="none"),a(this),!0)},e.ChartEngine.prototype.drawingClick=function(t,i,a){if(e.Drawing&&t&&""===this.openDialog&&(this.activeDrawing||this.activateDrawing(this.currentVectorParameters.vectorType,t))){if(this.activeDrawing){if(this.userPointerDown&&!this.activeDrawing.dragToDraw)return void(e.ChartEngine.drawingLine||this.activateDrawing(null));var r=this.tickFromPixel(i,t.chart),s=this.panels[this.activeDrawing.panelName],n=this.adjustIfNecessary(s,r,this.valueFromPixel(a,s));return this.magnetizedPrice&&(n=this.adjustIfNecessary(s,r,this.magnetizedPrice)),this.activeDrawing.click(this.chart.tempCanvas.context,r,n)?this.activeDrawing&&(e.ChartEngine.drawingLine=!1,e.clearCanvas(this.chart.tempCanvas,this),this.addDrawing(this.activeDrawing),this.activateDrawing(null),this.adjustDrawings(),this.draw(),this.changeOccurred("vector"),e.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),e.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing")):(this.changeOccurred("drawing"),e.ChartEngine.drawingLine=!0,e.swapClassName(this.controls.crossX,"stx_crosshair_drawing","stx_crosshair"),e.swapClassName(this.controls.crossY,"stx_crosshair_drawing","stx_crosshair")),!0}return!1}},e.ChartEngine.prototype.whichPanel=function(t){for(var e in this.panels){var i=this.panels[e];if(!i.hidden&&(t>=i.top&&t<i.bottom))return i}return null},e.ChartEngine.prototype.mouseup=function(t){if(!this.runPrepend("mouseup",arguments)){if(this.swipe.end=!0,this.cancelLongHold=!0,this.repositioningDrawing){if(!this.currentVectorParameters.vectorType||Date.now()-this.mouseTimer>250)return this.changeOccurred("vector"),e.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.adjustDrawings(),void this.draw();this.activateRepositioning(null)}if(this.repositioningBaseline){this.repositioningBaseline=null,e.unappendClassName(this.controls.baselineHandle,"stx-grab");var i=this.mainSeriesRenderer||{};return i.params&&i.params.baseline&&i.params.type,void this.draw()}var a=this.userPointerDown;if(this.userPointerDown=!1,this.displayInitialized){var r=this.backOutY(t.clientY),s=this.backOutX(t.clientX);if(this.grabbingScreen=!1,this.highlightedDraggable&&(this.dragPlotOrAxis(s,r),this.currentPanel=this.whichPanel(r)),this.grabStartYAxis=null,this.displayDragOK(),""===this.openDialog){if(this.grabOverrideClick)return this.overXAxis||this.overYAxis||this.swipeRelease(),e.unappendClassName(this.container,"stx-drag-chart"),this.grabOverrideClick=!1,this.doDisplayCrosshairs(),void this.updateChartAccessories();if(this.insideChart&&e.unappendClassName(this.container,"stx-drag-chart"),!e.ChartEngine.resizingPanel)return t.which&&t.which>=2||t.button&&t.button>=2||t.ctrlKey?this.anyHighlighted&&!0!==this.bypassRightClick?(this.rightClickHighlighted(),t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t.stopPropagation(),!1):(this.dispatch("rightClick",{stx:this,panel:this.currentPanel,x:s,y:r}),!0):void(t.clientX<this.left||t.clientX>this.right||t.clientY<this.top||t.clientY>this.bottom||(!a||this.currentPanel.subholder!==t.target||this.longHoldTookEffect&&!this.activeDrawing||this.drawingClick(this.currentPanel,s,r),a&&this.currentPanel.subholder===t.target&&!this.longHoldTookEffect&&this.activeMarker&&this.activeMarker&&this.activeMarker.click(s,r,this.activeMarker,this.currentPanel),this.activeDrawing||this.longHoldTookEffect||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:s,y:r}),this.runAppend("mouseup",arguments)));this.releaseHandle()}else this.insideChart&&e.unappendClassName(this.container,"stx-drag-chart")}}},e.ChartEngine.prototype.grabbingHand=function(){this.allowScroll&&this.grabbingScreen&&(e.touchDevice||e.appendClassName(this.container,"stx-drag-chart"))},e.ChartEngine.prototype.mousedown=function(t){if(!this.runPrepend("mousedown",arguments)&&(this.grabOverrideClick=!1,this.displayInitialized&&this.displayCrosshairs&&!this.repositioningDrawing&&!(this.editingAnnotation||(t||(t=event),t.which&&t.which>=2||t.button&&t.button>=2)))){var i=this.container.getBoundingClientRect();if(this.top=i.top,this.left=i.left,this.right=this.left+this.width,this.bottom=this.top+this.height,t.clientX>=this.left&&t.clientX<=this.right&&t.clientY>=this.top&&t.clientY<=this.bottom){if(this.insideChart=!0,this.currentPanel){this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.hasDragged=!1,this.userPointerDown=!0;for(var a=this.currentPanel.chart,r=0;r<this.drawingObjects.length;r++){var s=this.drawingObjects[r];if(s.highlighted&&!s.permanent){if(this.cloneDrawing){var n=e.ChartEngine.drawingTools[s.name],o=new n;return o.reconstruct(this,s.serialize()),this.drawingObjects.push(o),this.activateRepositioning(o),void(o.repositioner=s.repositioner)}var l=this.currentVectorParameters.vectorType;if(!(e.Drawing&&l&&e.Drawing[l]&&(new e.Drawing[l]).dragToDraw))return void this.activateRepositioning(s)}}var h=this.mainSeriesRenderer||{};if(h.params&&h.params.baseline&&!1!==a.baseline.userLevel&&this.controls.baselineHandle){var c=this.valueFromPixel(this.cy-5,this.currentPanel),u=this.valueFromPixel(this.cy+5,this.currentPanel),p=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10);if(a.baseline.actualLevel<Math.max(c,u)&&a.baseline.actualLevel>Math.min(c,u)&&this.cx>p)return this.repositioningBaseline={lastDraw:Date.now()},void e.appendClassName(this.controls.baselineHandle,"stx-grab")}this.currentPanel.subholder===t.target&&this.drawingClick(this.currentPanel,this.cx,this.cy),this.activeDrawing&&this.activeDrawing.dragToDraw||(this.grabbingScreen=!0,a.spanLock=!1,this.yToleranceBroken=!1,t||(t=event),this.grabStartX=t.clientX,this.grabStartY=t.clientY,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=a.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(this.currentPanel),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPanel=this.currentPanel,setTimeout(function(t){return function(){t.grabbingHand()}}(this),100),this.swipeStart(a),(this.longHoldTime||0===this.longHoldTime)&&this.startLongHoldTimer(),this.runAppend("mousedown",arguments))}}else this.insideChart=!1}},e.ChartEngine.prototype.startLongHoldTimer=function(){var t=this;this.cancelLongHold=!1,this.longHoldTimeout&&clearTimeout(this.longHoldTimeout);var e=function(){t.cancelLongHold||(t.longHoldTookEffect=!0,t.dispatch("longhold",{stx:t,panel:t.currentPanel,x:t.cx,y:t.cy}),t.displayDragOK())};this.longHoldTime?this.longHoldTimeout=setTimeout(e,this.longHoldTime):0===this.longHoldTime&&e()},e.ChartEngine.prototype.changeVectorType=function(t){this.currentVectorParameters.vectorType=t,e.Drawing.initializeSettings(this,t),e.ChartEngine.drawingLine&&this.undo(),this.setCrosshairColors(),this.insideChart&&this.doDisplayCrosshairs()},e.ChartEngine.prototype.changeVectorParameter=function(t,e){"axisLabel"==t?e="true"===e.toString()||Number(e):"lineWidth"==t?e=Number(e):"fontSize"==t&&(e=parseInt(e,10)+"px");var i=this.currentVectorParameters;return void 0!==i[t]?(i[t]=e,!0):"font"==t.substr(0,4)&&("family"==(t=t.substr(4).toLowerCase())&&"default"==e.toLowerCase()&&(e=null),void 0!==(i=i.annotation.font)[t])&&(i[t]=e,!0)},e.ChartEngine.prototype.rightClickDrawing=function(t,e){if(!this.runPrepend("rightClickDrawing",arguments)&&!t.permanent){if("function"==typeof this.callbacks.drawingEdit||this.callbackListeners.drawingEdit.length)this.dispatch("drawingEdit",{stx:this,drawing:t,forceEdit:e});else{var i=t.abort();if(!i){var a=this.exportDrawings();this.removeDrawing(t),this.undoStamp(a,this.exportDrawings())}this.changeOccurred("vector")}this.runAppend("rightClickDrawing",arguments)}},e.ChartEngine.prototype.rightClickOverlay=function(t,e){if(!this.runPrepend("rightClickOverlay",arguments)){var i=this.overlays[t];i.editFunction?i.editFunction(e):this.removeOverlay(t),this.runAppend("rightClickOverlay",arguments)}},e.ChartEngine.prototype.addOverlay=function(t){this.runPrepend("addOverlay",arguments)||(this.overlays[t.name]=t,this.runAppend("addOverlay",arguments))},e.ChartEngine.prototype.removeOverlay=function(t){if(!this.runPrepend("removeOverlay",arguments)){var i=this.overlays[t];for(var a in this.overlays){var r=this.overlays[a],s=["Field"];e.Studies&&(s=e.Studies.getFieldInputs(r));for(var n=0;n<s.length;n++)i.outputMap[r.inputs[s[n]]]&&this.removeOverlay(r.name)}if(i){this.cleanupRemovedStudy(i);this.panels[i.panel];delete this.overlays[t],this.checkForEmptyPanel(i.panel)}this.currentlyImporting||(this.displaySticky(),this.createDataSet(),this.changeOccurred("layout")),this.resetDynamicYAxis(),this.runAppend("removeOverlay",arguments)}},e.ChartEngine.prototype.addSeries=function(t,i,a){var r=this.runPrepend("addSeries",arguments);if(r)return r;var s=t||null,n=t;t||(t=e.uniqueID()),i&&!0===i.panel&&(i.panel=t);var o={parameters:i?e.clone(i):{},yValueCache:[],display:s,id:t,loading:!i||!1!==i.loadData};(i=o.parameters).symbol&&(n=i.symbol),i.isComparison&&(i.shareYAxis=!0),i.yAxis&&(i.yAxis=new e.ChartEngine.YAxis(i.yAxis)),e.ensureDefaults(i,{chartName:this.chart.name,symbolObject:{symbol:n},panel:this.chart.panel.name,fillGaps:!1,action:"add-series"}),"display"in i&&(o.display=i.display);var l=this.charts[i.chartName],h=i.symbolObject;n=i.symbol=h.symbol,o.display||(o.display=n||i.field),o.endPoints={},i.gapDisplayStyle||!1===i.gapDisplayStyle||(i.gapDisplayStyle=i.gaps),i.isComparison&&void 0===i.gapDisplayStyle&&(i.gapDisplayStyle="transparent");var c=this.getSeries({symbolObject:h,chart:l,includeMaster:!0}),u=i.panel;if(this.panels[u])i.yAxis||i.shareYAxis||(i.yAxis=new e.ChartEngine.YAxis({position:"none"}));else{var p=i.yAxis||new e.ChartEngine.YAxis;p.name=t,this.createPanel(t,u,null,null,p),this.preferences.dragging&&this.preferences.dragging.series||(i.highlightable=!1)}l.series[t]=o;var d=this,m=this.currentlyImporting;function g(a,r){var s=i.renderer||"Lines",n=i.name||t;if(i.yAxis&&!m&&(i.yAxis.name=n),i.renderer||i.name||i.color||i.chartType){var o=a.getSeriesRenderer(n);if(!o){var l={name:n,overChart:!0,useChartLegend:!0,highlightable:i.highlightable};if(i.chartType?(l=e.extend({panel:i.panel,yAxis:i.yAxis},l),o=e.Renderer.produce(i.chartType,l)):(e.ensureDefaults(i,{name:l.name,overChart:!0,useChartLegend:!0}),o=new e.Renderer[s]({params:i})),!o)return;a.setSeriesRenderer(o)}o.attachSeries(t,i),!1!==i.loadData&&o.ready(),a.layout.symbols=a.getSymbols({"include-parameters":!0,"exclude-studies":!0}),a.changeOccurred("layout")}}function f(t){return function(e){if(!e.error){var r=e.quotes,s=i.fillGaps;d.cleanupGaps||(s=!1),r=d.doCleanupGaps(r,d.chart,{cleanupGaps:s}),d.updateChartData(r,d.chart,{secondarySeries:n,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),o.loading=!1,o.moreAvailable=e.moreAvailable,g(d)}null===i.action||c.length||d.dispatch(m?"symbolImport":"symbolChange",{stx:d,symbol:t.symbol,symbolObject:t.symbolObject,action:i.action}),a&&a.call(d,e.error,o)}}!i.isComparison||!l.forcePercentComparison||i.panel!=l.panel.name||i.yAxis&&i.yAxis!=l.yAxis||this.setChartScale("percent");var y=l.masterData;y||(y=l.masterData=this.masterData=[]);var v=y.length;if(i.data&&!i.data.useDefaultQuoteFeed){var x={symbol:n,symbolObject:h,action:i.action};f(x)({quotes:i.data})}else if(c.length)o.endPoints=c[0].endPoints,g(this),a&&setTimeout(function(){a.call(d,null,o)},0);else if(this.quoteDriver&&!1!==i.loadData){var b=this.quoteDriver,S=b.makeParams(n,h,l);v&&(S.startDate=y[0].DT,S.endDate=this.isHistoricalMode()?y[y.length-1].DT:new Date),S.stx.isEquationChart(S.symbol)?e.fetchEquationChart(S,f(S)):e.ChartEngine.Driver.fetchData(e.QuoteFeed.SERIES,b.quoteFeed,S,f(S))}else g(this),a&&a.call(this,null,o);return this.runAppend("addSeries",arguments),o},e.ChartEngine.prototype.getSeries=function(t){var i=t.chart?t.chart:this.chart,a=i.series,r=t.symbolObject;r||(r={symbol:t.symbol});var s=[];for(var n in a){var o=a[n];e.symbolEqual(r,o.parameters.symbolObject)&&s.push(o)}return t.includeMaster&&e.symbolEqual(r,i.symbolObject)&&s.push({}),s},e.ChartEngine.prototype.modifySeries=function(t,i){var a,r,s;if(!this.runPrepend("modifySeries",arguments)&&(i&&("string"==typeof t?(r=t,a=(s=i.chartName?this.charts[i.chartName]:this.chart).series[r]):(r=(a=t).id,s=this.charts[a.parameters.chartName]),a))){e.extend(a.parameters,i);var n=a.parameters;for(var o in s.seriesRenderers)for(var l=s.seriesRenderers[o],h=l.params,c=l.seriesParams,u=0;u<c.length;++u){var p=c[u],d=this.panels[p.panel],m=d&&d.yAxis.name;if(p.id===a.id){if(!0===n.panel&&(n.panel=n.name),n.panel!=p.panel&&h.name==m)this.electNewPanelOwner(p.panel);else{var g=this.getYAxisByName(n.panel,h.name);g&&n.yAxis&&g!==n.yAxis&&(g.name=this.electNewYAxisOwner(g))}l.params.panel=n.panel,l.attachSeries(r,e.ensureDefaults(e.clone(n),p)),!n.isComparison||!s.forcePercentComparison||n.panel!=s.panel.name||a.parameters.yAxis&&n.yAxis.name!=s.yAxis.name||this.setChartScale("percent");break}}if(this.changeOccurred("layout"),e.Drawing){var f=a.parameters.symbol||r;e.Drawing.updateSource(this,f,null,a.parameters.panel)}return this.runAppend("modifySeries",arguments),a}},e.ChartEngine.prototype.isEquationChart=function(t){return!(!this.allowEquations||!e.computeEquationChart)&&!(!t||"="!=t[0])},e.ChartEngine.prototype.getDataFields=function(t){t||(t=this.chart);var e=t.defaultPlotField||"Close",i=["Open","High","Low"];for(var a in i.push(e),t.series){var r=t.series[a].parameters;i.push(r.symbol)}return i},e.ChartEngine.prototype.cleanMasterData=function(t,e){var i=t.symbol,a=e.masterData;if(a&&a.length){var r=this.getDataFields(e),s=0;do{var n=a[s];delete n[i],o.call(this,n,r)?a.splice(s,1):s++}while(s<a.length);a=this.doCleanupGaps(a,e,{noCleanupDates:!0}),this.setMasterData(a,e,{noCleanupDates:!0}),this.clearCurrentMarketData(e,i)}function o(t,e){for(var i=0;i<e.length;i++){if(void 0!==t[e[i]])return!1}return!0}},e.ChartEngine.prototype.deleteSeries=function(t,e,i){if(!this.runPrepend("deleteSeries",arguments)){var a,r=(i=i||{}).action?i.action:"remove-series";"object"===_typeof(t)?(a=t.id,e=e||this.charts[t.parameters.chartName]):(a=t,e=e||this.chart);var s=e.series[a];if(s){var n=s.parameters.loadData,o=s.parameters.symbolObject;delete e.series[a];var l=this.getSeries({symbolObject:o,includeMaster:!0});!1===n&&l.push(a),l.length||this.cleanMasterData(o,e);var h=this.panels[s.parameters.panel];h&&this.checkForEmptyPanel(h),this.createDataSet(),l.length||this.dispatch(this.currentlyImporting?"symbolImport":"symbolChange",{stx:this,symbol:o.symbol,symbolObject:o,action:r}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)}}},e.ChartEngine.prototype.removeSeries=function(t,e){if(!this.runPrepend("removeSeries",arguments)){var i,a=!1;for(var r in"object"===_typeof(t)?(i=t.id,e=e||this.charts[t.parameters.chartName]):(i=t,e=e||this.chart),e.seriesRenderers)for(var s=e.seriesRenderers[r],n=this.panels[s.params.panel],o=n&&n.yAxis.name,l=s.seriesParams.length-1;l>=0;l--){var h=s.seriesParams[l];if(h.id===i){if(s.removeSeries(i),s.seriesParams.length<1)if(this.removeSeriesRenderer(s),s.params.name==o)this.electNewPanelOwner(s.params.panel);else if(!this.checkForEmptyPanel(s.params.panel)){var c=this.getYAxisByName(n,s.params.name);c&&(c.name=c.studies[0]||c.renderers[1])}a=!0}}a||this.deleteSeries(i,e),this.resetDynamicYAxis(),this.draw(),this.resizeChart(),this.runAppend("removeSeries",arguments)}},e.ChartEngine.prototype.isDailyInterval=function(t){return console.warn("CIQ.ChartEngine.prototype.isDailyInterval has been deprecated. Use use static version insted"),e.ChartEngine.isDailyInterval(t)},e.ChartEngine.prototype.setPeriodicity=function(t,i){if(!this.runPrepend("setPeriodicity",arguments)){var a,r,s=null;t&&"object"==_typeof(t)?(a=t.period,r=t.interval,s=t.timeUnit):(a=t,r=i,i=arguments[arguments.length-1],arguments.length>3&&(s=arguments[2])),"function"!=typeof i&&(i=null);var n=e.cleanPeriodicity(a,r,s);a=n.period,r=n.interval,s=n.timeUnit;var o=this.layout,l=o.candleWidth;o.setSpan={},o.range={},this.chart.inflectionPoint=null;var h=!1;if(this.chart.symbol&&(h=this.needDifferentData({period:a,interval:r,timeUnit:s})),o.periodicity=a,o.interval=r,o.timeUnit=s,h){if(this.changeOccurred("layout"),this.clearCurrentMarketData(),this.quoteDriver)for(var c in this.charts){var u=this.charts[c];u.symbol&&(this.displayInitialized?this.quoteDriver.newChart({symbol:u.symbol,symbolObject:u.symbolObject,chart:u},i):this.loadChart(u.symbol,{chart:u},i))}else this.dataCallback?(this.dataCallback(),i&&i(null)):console.log("cannot change periodicity because neither dataCallback or quoteDriver are set");this.home()}else{var p,d;for(p in this.charts){var m,g=(d=this.charts[p]).dataSegment,f=d.dataSet,y=d.maxTicks,v=d.scroll,x=g?g.length:0,b=f?f.length:0,S=Math.round(d.maxTicks/2);this.setCandleWidth(l,d);var C=!0,w=!1;if(v<=y?C=!1:g&&!g[S]&&(C=!1,w=v-b),C&&x>0&&(y<(Math.round(this.chart.width/l-.499)-1)/2&&(S=x-1),S>=x?(m=g[x-1].DT,S=x-1):m=g[S].DT),this.createDataSet(),C){if(x>0)for(var T=b-1;T>=0;T--){var k=f[T].DT;if(k.getTime()<m.getTime()){d.scroll=b-1-T+S;break}}}else if(w)d.scroll=f.length+w;else{var D=Math.round(this.preferences.whitespace/l);d.scroll=y-D-1}}if(this.displayInitialized&&this.draw(),this.changeOccurred("layout"),this.quoteDriver)for(p in this.charts)(d=this.charts[p]).symbol&&d.moreAvailable&&this.quoteDriver.checkLoadMore(d);i&&i(null),this.runAppend("setPeriodicity",arguments)}}},e.ChartEngine.prototype.setPeriodicityV2=function(t,e,i,a){"function"==typeof i&&(a=i,i=null),this.runPrepend("setPeriodicityV2",arguments)||(this.setPeriodicity(t,e,i,a),this.runAppend("setPeriodicityV2",arguments))},e.ChartEngine.prototype.drawVectors=function(){if(!this.vectorsShowing&&!this.runPrepend("drawVectors",arguments)){if(this.vectorsShowing=!0,!this.chart.hideDrawings&&!this.highlightedDraggable){var t,e,i={};for(e=0;e<this.drawingObjects.length;e++){var a=this.drawingObjects[e];a.hidden||this.repositioningDrawing!==a&&(t=a.panelName,this.panels[a.panelName]&&!this.panels[a.panelName].hidden&&(i[t]||(i[t]=[]),i[t].push(a)))}for(t in i){this.startClip(t);var r=i[t];for(e=0;e<r.length;e++)r[e].render(this.chart.context);this.endClip()}}this.runAppend("drawVectors",arguments)}},e.ChartEngine.NONE=0,e.ChartEngine.CLOSEUP=1,e.ChartEngine.CLOSEDOWN=2,e.ChartEngine.CLOSEEVEN=4,e.ChartEngine.CANDLEUP=8,e.ChartEngine.CANDLEDOWN=16,e.ChartEngine.CANDLEEVEN=32,e.ChartEngine.prototype.displayChart=function(t){this.runPrepend("displayChart",arguments)||(this.rendererAction(t,"main"),this.runAppend("displayChart",arguments))},e.ChartEngine.prototype.calculateATR=function(t,e,i){i||(i=t.dataSet);var a=t.state.calculations.atr;a||(a=t.state.calculations.atr={}),e||(e=20);var r,s=[];a.accum&&(s=a.accum);for(var n=0;n<i.length;n++){var o=i[n];if(r=n?i[n-1]:a.q1){var l=Math.max(o.High-o.Low,Math.abs(o.High-r.Close),Math.abs(o.Low-r.Close));if(s.length<e){if(s.push(l)==e){for(var h=0,c=0;c<s.length;c++)h+=s[c];o.atr=h/e}}else o.atr=(r.atr*(e-1)+l)/e;o.trueRange=l}}t.state.calculations.atr={accum:s,q1:r}},e.ChartEngine.prototype.calculateMedianPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hl/2"]=(i.High+i.Low)/2},e.ChartEngine.prototype.calculateTypicalPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlc/3"]=(i.High+i.Low+i.Close)/3},e.ChartEngine.prototype.calculateWeightedClose=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlcc/4"]=(i.High+i.Low+2*i.Close)/4},e.ChartEngine.prototype.calculateOHLC4=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["ohlc/4"]=(i.Open+i.High+i.Low+i.Close)/4},e.ChartEngine.prototype.currentQuote=function(){if(!this.chart.dataSet)return null;for(var t=this.chart.dataSet.length-1;t>=0;t--)if(this.chart.dataSet[t])return this.chart.dataSet[t];return null},e.ChartEngine.prototype.mostRecentClose=function(t){if(!this.chart.dataSet)return null;for(var e=this.chart.dataSet.length-1;e>=0;e--){var i=this.chart.dataSet[e];if(i&&(!t||(i=i[t])||0===i)){var a=i.iqPrevClose;if("object"==_typeof(i)&&(i=i.Close),"number"==typeof i)return i;if("number"==typeof a)return a}}return null},e.ChartEngine.prototype.correctIfOffEdge=function(t){if(!this.runPrepend("correctIfOffEdge",arguments)){for(var e in this.charts){var i=this.charts[e],a=i.dataSet,r=i.maxTicks,s=this.layout,n=this.minimumLeftBars;this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[s.chartType]||n--;var o=Math.min(n,r);if(i.allowScrollPast){var l=r-o;o>a.length&&(l=r-a.length),i.scroll-l>=a.length&&(i.scroll=a.length+l-1,this.micropixels=0),i.scroll<=o&&(i.scroll=o,this.micropixels=0)}else i.scroll<o&&(i.scroll=o),i.scroll>a.length&&(i.scroll=a.length);if(!1===i.allowScrollFuture){var h=this.getLabelOffsetInPixels(i,s.chartType)+s.candleWidth*i.whiteSpaceFutureTicks,c=r-Math.round(h/s.candleWidth)-1,u=this.micropixels<0?i.scroll-1:i.scroll;u<c&&(i.scroll=c,this.micropixels=0)}}this.runAppend("correctIfOffEdge",arguments)}},e.ChartEngine.prototype.createDataSegment=function(t){if(!this.runPrepend("createDataSegment",arguments)){var i;for(var a in this.charts){i=this.charts[a],t&&(i=t),i.isComparison&&e.Comparison.createComparisonSegmentInner(this,i);var r=i.dataSet,s=i.baseline,n=i.scroll,o=i.maxTicks,l=this.layout,h=l.candleWidth;s.actualLevel=s.userLevel?s.userLevel:s.defaultLevel;for(var c,u=s.includeInDataSegment&&(!this.mainSeriesRenderer||!this.mainSeriesRenderer.standaloneBars)&&!this.standaloneBars[l.chartType],p=i.dataSegment=[],d=r.length-1-n-1,m=i.defaultPlotField,g=-1;g<n&&g<o;g++)if(d++,-1!=g||u)if(d<r.length&&d>=0){if((c=r[d]).candleWidth=null,p.push(c),null===s.actualLevel&&g>=0)if(m&&"Close"!=m){var f=r[d-1];f&&(f[m]||0===f[m])&&(s.actualLevel=f[m])}else(c.iqPrevClose||0===c.iqPrevClose)&&(s.actualLevel=c.iqPrevClose)}else d<0&&p.push(null);i.segmentImage=null;var y=this.mainSeriesRenderer||{};if(y.params&&y.params.volume){for(var v=0,x=i.width-(o-p.length-1)*l.candleWidth,b=0;b<p.length;b++)(c=p[b])&&(v+=c.Volume);var S=0;i.segmentImage=[];for(var C=0;C<p.length;C++){c=p[C],i.segmentImage[C]={};var w=null;c?(c.Volume?(c.candleWidth=x*c.Volume/v,w=S+c.candleWidth/2,S+=c.candleWidth):(c.candleWidth=h,w=S+h/2,S+=h),i.segmentImage[C]={tick:c.tick,candleWidth:c.candleWidth,leftOffset:w}):S+=h}}if(t)break}i&&i.isComparison&&this.clearPixelCache(),this.positionCrosshairsAtPointer(),this.runAppend("createDataSegment",arguments)}},e.ChartEngine.prototype.getDataSegment=function(t){t||(t=this.chart);var e=t.dataSegment;if(!e||!e.length)return[];var i=0,a=e.length;return this.pixelFromBar(i,t)<t.panel.left&&i++,this.pixelFromBar(a-1,t)>t.panel.right&&a--,e.slice(i,a)},e.ChartEngine.prototype.leftTick=function(){return this.chart.dataSet.length-this.chart.scroll},e.ChartEngine.prototype.getStartDateOffset=function(){for(var t=0;t<this.chart.dataSegment.length;t++)if(this.chart.dataSegment[t])return t;return 0},e.ChartEngine.prototype.setStartDate=function(t){for(var e=0;e<this.chart.dataSet.length;e++){if(this.chart.dataSet[e].DT.getTime()==t.getTime())return this.chart.scroll=this.chart.dataSet.length-e,void this.draw()}},e.ChartEngine.prototype.updateListeners=function(t){for(var e in this.plugins){var i=this.plugins[e];i.display&&i.listener&&i.listener(this,t)}},e.ChartEngine.prototype.clearPixelCache=function(){for(var t in this.panels){var e=this.panels[t];e.cacheHigh=null,e.cacheLow=null,e.cacheLeft=1e6,e.cacheRight=-1}for(var i in this.charts){var a=this.charts[i];if(a.dataSet)for(var r=0;r<a.dataSet.length;r++)a.dataSet[r].cache={}}},e.ChartEngine.prototype.createYAxisLabel=function(t,i,a,r,s,n,o){if(!1!==t.yAxis.drawPriceLabels&&!t.yAxis.noDraw){var l=o||t.yAxis;if(!l.noDraw&&l.width){var h=n||this.chart.context,c=this.getCanvasFontSize("stx_yaxis")+6;this.canvasFont("stx_yaxis",h);l.displayBorder;var u,p=this.drawBorders?3:0;try{u=h.measureText(i).width+p+6}catch(t){u=l.width}var d=l.left-3+3;l.width<0&&(d+=l.width-u);var m=d+3+p,g=3;"left"===(null===l.position?t.chart.yAxis.position:l.position)&&(d=l.left+l.width+3-3,u*=-1,l.width<0&&(d-=l.width+u),m=d-3-p,g=-3,h.textAlign="right"),a+c/2>l.bottom&&(a=l.bottom-c/2),a-c/2<l.top&&(a=l.top+c/2),void 0===e[this.yaxisLabelStyle]&&(this.yaxisLabelStyle="roundRectArrow");var f=this.yaxisLabelStyle;l.yaxisLabelStyle&&(f=l.yaxisLabelStyle);var y={ctx:h,x:d,y:a,top:a-c/2,width:u,height:c,radius:g,backgroundColor:r,fill:!0,stroke:!1,margin:{left:m-d,top:1},txt:i,color:s};e[f](y)}}},e.ChartEngine.prototype.createXAxisLabel=function(t,i,a,r,s,n){var o,l=this.chart.context,h=this.getCanvasFontSize("stx-float-date")+4;this.canvasFont("stx-float-date",l);try{o=l.measureText(i).width+4}catch(t){o=0}var c=t.top+t.height-h;if(!(a+o/2<t.left||a-o/2>t.right)){n||(a+o/2>t.right&&(a=t.right-o/2),a-o/2<t.left&&(a=t.left+o/2)),l.fillStyle=r,e.roundRect({ctx:l,x:a-o/2,top:c,width:o,height:h,radius:3,fill:!0});var u=t.bottom-t.yAxis.bottom-h;l.beginPath(),n?(l.moveTo(a-u,c),l.lineTo(a,c-u-1),l.lineTo(a+u,c),l.closePath(),l.fill()):(l.moveTo(a,c),l.lineTo(a,c-u),l.strokeStyle=r,l.stroke()),l.textBaseline="top",l.fillStyle=s||e.chooseForegroundColor(r),l.fillStyle==r&&("#FFFFFF"==r.toUpperCase()?l.fillStyle="#000000":l.fillStyle="#FFFFFF"),l.fillText(i,a-o/2+2,c+2)}},e.ChartEngine.prototype.drawCurrentHR=function(){if(!this.runPrepend("drawCurrentHR",arguments)){var t,e,i=this.mainSeriesRenderer||{};if(!i.noCurrentHR){var a=i.highLowBars||this.highLowBars[this.layout.chartType];for(var r in this.charts){var s=this.charts[r],n=s.panel,o=n.yAxis;if(!n.hidden&&(!1!==o.drawCurrentPriceLabel&&!o.noDraw&&i.params)){var l=o.whichSet;if(l||(l="dataSet"),!this.isHistoricalModeSet||"dataSegment"===l){var h=s[l].length,c=this.layout.candleWidth;if("dataSegment"==l)for(;h>(s.width-this.micropixels+c/2+1)/c;)h--;if(h&&s[l][h-1]){var u,p,d,m=s.defaultPlotField;m&&!a||(m="Close");do{if(p=u=s[l][--h][m],0===h)break}while(null==p);if("dataSet"==l&&s.currentQuote)p=s.currentQuote[m];else if(s[l].length>=2){var g=s[l][h-1];g&&(u=g[m])}p<u?(t=this.canvasStyle("stx_current_hr_down").backgroundColor,e=this.canvasStyle("stx_current_hr_down").color):(t=this.canvasStyle("stx_current_hr_up").backgroundColor,e=this.canvasStyle("stx_current_hr_up").color),s.transformFunc&&(p=s.transformFunc(this,s,p));var f=Math.max(n.yAxis.printDecimalPlaces,n.chart.decimalPlaces);(o.maxDecimalPlaces||0===o.maxDecimalPlaces)&&(f=Math.min(f,o.maxDecimalPlaces)),d=o.priceFormatter?o.priceFormatter(this,n,p,f):this.formatYAxisPrice(p,n,f);var y=this.pixelFromTransformedValue(p,n);this.createYAxisLabel(n,d,y,t,e),!0===this.preferences.currentPriceLine&&this.isHome()&&(n.chart.context.globalCompositeOperation="destination-over",this.plotLine(n.left,n.right,y,y,t,"line",n.chart.context,n,{pattern:"dashed",lineWidth:1,opacity:.8}),n.chart.context.globalCompositeOperation="source-over")}}}}this.runAppend("drawCurrentHR",arguments)}}},e.ChartEngine.prototype.getDefaultColor=function(){this.defaultColor="#000000";for(var t=null,i=this.chart.container;!t||e.isTransparent(t);){var a=getComputedStyle(i);if(!a)return;if(t=a.backgroundColor,e.isTransparent(t)&&(t="transparent"),!(i=i.parentNode)||!i.tagName)break}if(t)if("transparent"==t&&(t="#FFFFFF"),this.containerColor=t,e.isTransparent(t))this.defaultColor="#000000";else{var r=e.hsv(t)[2];this.defaultColor=r>.65?"#000000":"#FFFFFF"}else this.containerColor="#FFFFFF"},e.ChartEngine.prototype.startAsyncAction=function(){this.pendingAsyncs||(this.pendingAsyncs=[]),this.pendingAsyncs.push(!0)},e.ChartEngine.prototype.registerChartDrawnCallback=function(t){return this.asyncCallbacks||(this.asyncCallbacks=[]),this.asyncCallbacks.push(t),{fc:t}},e.ChartEngine.prototype.unregisterChartDrawnCallback=function(t){for(var e=0;e<this.asyncCallbacks.length;e++)if(this.asyncCallbacks[e]==t.fc)return void this.asyncCallbacks.splice(e,1)},e.ChartEngine.prototype.makeAsyncCallbacks=function(){if(this.asyncCallbacks&&(!this.pendingAsyncs||!this.pendingAsyncs.length))for(var t=0;t<this.asyncCallbacks.length;t++)this.asyncCallbacks[t]()},e.ChartEngine.prototype.completeAsyncAction=function(){this.pendingAsyncs.pop(),this.makeAsyncCallbacks()},e.ChartEngine.prototype.draw=function(){if(this.debug(),this.chart.canvas&&this.chart.dataSet&&this.chart.canvasHeight&&(this.offset=this.layout.candleWidth*this.candleWidthPercent/2,e.clearCanvas(this.chart.canvas,this),this.masterData&&!this.runPrepend("draw",arguments))){var t,i,a,r;for(a in this.defaultColor||this.getDefaultColor(),this.vectorsShowing=!1,this.drawPanels(),this.yAxisLabels=[],this.charts){i=this.charts[a],this.correctIfOffEdge(),this.createDataSegment();var s=this.createXAxis(i);this.initializeDisplay(i),this.drawXAxis(i,s);try{this.renderYAxis(i)}catch(t){if(t&&"reboot draw"===t.message)return this.draw();throw t}for(t in i.tmpWidth=Math.floor(this.layout.candleWidth*this.candleWidthPercent),i.tmpWidth%2==0&&(i.tmpWidth+=1,i.tmpWidth>this.layout.candleWidth&&(i.tmpWidth-=2)),i.tmpWidth<.5&&(i.tmpWidth=.5),this.plugins)(r=this.plugins[t]).display&&r.drawUnder&&r.drawUnder(this,i);this.chart.legend&&(this.chart.legend.colorMap=null),this.controls.baselineHandle&&(this.controls.baselineHandle.style.display="none"),this.rendererAction(i,"underlay"),e.Studies&&e.Studies.displayStudies(this,i,!0),this.displayChart(i),e.Studies&&e.Studies.displayStudies(this,i,!1),this.rendererAction(i,"overlay"),i.legend&&i.legend.colorMap&&i.legendRenderer&&i.legendRenderer(this,{chart:i,legendColorMap:i.legend.colorMap,coordinates:{x:i.legend.x,y:i.legend.y+i.panel.yAxis.top}})}for(a in this.charts)for(t in i=this.charts[a],this.plugins)(r=this.plugins[t]).display&&r.drawOver&&r.drawOver(this,i);for(var n in this.panels)this.panels[n].hidden||this.plotYAxisText(this.panels[n]);for(var o=0;o<this.yAxisLabels.length;o++){var l=this.yAxisLabels[o];"series"==l.src&&l.args[6]&&!1===l.args[6].drawSeriesPriceLabels||this.createYAxisLabel.apply(this,l.args)}if(this.createCrosshairs(),this.drawVectors(),this.drawCurrentHR(),this.displayInitialized=!0,this.controls){var h=this.manageTouchAndMouse&&(!this.mainSeriesRenderer||!this.mainSeriesRenderer.nonInteractive);this.controls.home&&(this.controls.home.style.display=h&&!this.isHome()?"block":"none"),this.controls.chartControls&&(this.controls.chartControls.style.display=h?"block":"none")}for(a in this.positionMarkers(),this.charts)i=this.charts[a],this.quoteDriver&&!this.animations.zoom.running&&this.quoteDriver.checkLoadMore(i);this.runAppend("draw",arguments),this.makeAsyncCallbacks()}},e.ChartEngine.prototype.adjustBackingStore=function(t,i){this.devicePixelRatio=window.devicePixelRatio||1,this.devicePixelRatio<1&&(this.devicePixelRatio=1);var a=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,r=this.devicePixelRatio/a;if(this.useBackingStore){if(!e.isAndroid||e.is_chrome||e.isFF){var s=t.width,n=t.height;t.width=s*r,t.height=n*r,t.style.width=s+"px",t.style.height=n+"px",i.scale(r,r),this.adjustedDisplayPixelRatio=r,this.backing={ratio:r,width:t.width,height:t.height,styleWidth:s,styleHeight:n}}}else this.devicePixelRatio=this.adjustedDisplayPixelRatio=1},e.ChartEngine.prototype.reconstituteBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.width&&(t.width=this.backing.width,t.height=this.backing.height,t.context.scale(this.backing.ratio,this.backing.ratio),this.adjustedDisplayPixelRatio=this.backing.ratio,this.draw())}},e.ChartEngine.prototype.disableBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.styleWidth&&(t.width=this.backing.styleWidth,t.height=this.backing.styleHeight,t.context.scale(1,1),this.adjustedDisplayPixelRatio=1,this.draw())}},e.ChartEngine.prototype.resizeCanvas=function(){var t=this.chart.canvas,e=this.chart.context;t&&e&&(this.floatCanvas.height=this.chart.tempCanvas.height=t.height=this.chart.container.clientHeight,this.floatCanvas.width=this.chart.tempCanvas.width=t.width=this.chart.container.clientWidth,this.adjustBackingStore(t,e),this.adjustBackingStore(this.chart.tempCanvas,this.chart.tempCanvas.context),this.adjustBackingStore(this.floatCanvas,this.floatCanvas.context));var i=this.container.getBoundingClientRect();this.top=i.top,this.left=i.left,this.canvasWidth=this.chart.canvasWidth=this.chart.container.clientWidth,this.right=this.left+this.canvasWidth,this.height=this.chart.container.clientHeight,this.width=this.right-this.left,0!==this.width||this.container.dimensionlessCanvas||console.log("warning: zero width chart. Check CSS for chart container."),this.bottom=this.top+this.height,this.calculateYAxisPositions(),this.chart.canvasRight=this.right,this.chart.canvasHeight=this.height;var a=this.layout.candleWidth;for(var r in void 0===a&&(a=8),this.charts){var s=this.charts[r];if(this.setCandleWidth(a,s),s.scroll<s.width/a){s.scroll=Math.floor(s.width/a);var n=Math.round(this.preferences.whitespace/this.layout.candleWidth);s.scroll-=n}var o,l=10;try{o=2*e.measureText("10:00").width}catch(t){o=100}for(;l>1&&!(this.chart.width/o>l);)l/=1.5;s.xAxis.autoComputedTickSizePixels=Math.round(this.chart.width/l),s.xAxis.autoComputedTickSizePixels<1&&(s.xAxis.autoComputedTickSizePixels=1)}},e.ChartEngine.prototype.setCandleWidth=function(t,e){e||(e=this.chart),t<this.minimumCandleWidth&&(t=this.minimumCandleWidth),this.layout.candleWidth=t,e.maxTicks=Math.round(e.width/t)+1},e.ChartEngine.prototype.resizeChart=function(t){if(!this.runPrepend("resizeChart",arguments)){!1!==t&&(t=!0),t&&this.preAdjustScroll();var e=this.chart.canvasHeight;this.resizeCanvas(),t&&this.postAdjustScroll(),this.displayInitialized?(this.adjustPanelPositions(),this.draw()):0!==this.chart.canvasHeight&&0===e&&(this.adjustPanelPositions(),this.draw()),this.doDisplayCrosshairs(),this.updateChartAccessories(),this.runAppend("resizeChart",arguments)}},e.ChartEngine.prototype.newChart=function(t,i,a,r,s){var n={masterData:i,chart:a};return e.extend(n,s,!0),this.loadChart(t,n,r)},e.ChartEngine.prototype.loadChart=function(t,i,a){a||"function"!=typeof i?Array.isArray(i)&&(i={masterData:i}):(a=i,i={}),i||(i={});var r=i.chart||this.chart,s=this.layout,n=i.periodicity;if(n){var o=e.cleanPeriodicity(n.period?n.period:n.periodicity,n.interval,n.timeUnit);s.interval=o.interval,s.periodicity=o.period,s.timeUnit=o.timeUnit}var l=r.symbol,h=e.clone(r.symbolObject),c=r.market,u=r.dataSet,p=r.moreAvailable;if(r.dataSet=[],r.moreAvailable=null,t?"object"==_typeof(t)?(r.symbol=t.symbol,r.symbolObject=t):(r.symbol=t,r.symbolObject.symbol=t):(r.symbol=null,r.symbolObject={symbol:null}),r.inflectionPoint=null,this.marketFactory){var d=this.marketFactory(r.symbolObject);this.setMarket(d,r)}this.setMainSeriesRenderer(!0);var m=i.span,g=i.range;g||m||!s?g&&m&&(m={}):(m=s.range?{}:s.setSpan,g=s.range||{}),this.clearCurrentMarketData(r);var f=this;if(!i.masterData&&this.quoteDriver){var y=function(t){t&&"orphaned"!=t&&(r.symbol=l,r.symbolObject=h,r.market=c,r.dataSet=u,r.moreAvailable=p),f.dispatch(f.currentlyImporting?"symbolImport":"symbolChange",{stx:f,symbol:f.chart.symbol,symbolObject:f.chart.symbolObject,action:"master"}),a&&a.call(f,t)};g&&Object.keys(g).length?(delete i.span,delete s.setSpan,this.chart.masterData=null,this.displayInitialized=!1,n&&(g.periodicity=n),g.forceLoad=!0,this.setRange(g,y)):m&&m.base?(m.multiplier=m.multiplier||1,this.chart.masterData=null,this.displayInitialized=!1,n&&(m.maintainPeriodicity=!0),m.forceLoad=!0,this.setSpan(m,y)):this.quoteDriver.newChart({symbol:r.symbol,symbolObject:r.symbolObject,chart:r,initializeChart:!0},function(t){t||(f.adjustPanelPositions(),f.quoteDriver.updateSubscriptions(),i.stretchToFillScreen&&f.fillScreen()),y.apply(f,arguments)})}else{i.masterData||console.log("Warning: No masterData specified and no QuoteFeed configured"),r.symbol||(r.symbol=""),this.initializeChart();var v=this.doCleanupGaps(i.masterData,r);this.setMasterData(v,r,{noCleanupDates:!0}),r.endPoints={},v&&v.length&&(r.endPoints={begin:v[0].DT,end:v[v.length-1].DT}),this.createDataSet(),g&&Object.keys(g).length?this.setRange(g):m&&m.multiplier&&m.base?this.setSpan({maintainPeriodicity:!0,multiplier:m.multiplier,base:m.base}):i.stretchToFillScreen?this.fillScreen():v&&v.length?this.home():this.clear(),this.adjustPanelPositions(),f.dispatch(f.currentlyImporting?"symbolImport":"symbolChange",{stx:f,symbol:f.chart.symbol,symbolObject:f.chart.symbolObject,action:"master"}),a&&a.call(f)}},e.ChartEngine.prototype.clear=function(){for(var t in this.displayInitialized=!1,this.layout.studies){var i=this.layout.studies[t];e.Studies.removeStudy(this,i)}this.controls.chartControls&&(this.controls.chartControls.style.display="none"),this.chart.panel.title.innerHTML="",this.chart.panel.title.appendChild(document.createTextNode(this.chart.panel.display))},e.ChartEngine.prototype.fillScreen=function(){var t=this.chart,e=this.layout.candleWidth,i=t.width-this.preferences.whitespace,a=t.dataSet.length;if(a*e>=i)this.draw();else{this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[this.layout.chartType]||a--;var r=i/a;this.setCandleWidth(r,t),this.home({maintainWhitespace:!0})}},e.ChartEngine.prototype.setMasterData=function(t,i,a){if(i||(i=this.chart),this.marketFactory){var r=this.marketFactory(i.symbolObject);this.setMarket(r,i)}var s;a||(a={}),a.noCleanupDates||this.doCleanupDates(t,this.layout.interval),i.masterData=t,"chart"==i.name&&(this.masterData=t);var n=null;for(s=0;t&&s<t.length;s++){var o=t[s];null===n&&("number"==typeof o.Close?n="Close":"number"==typeof o.Value&&(n="Value")),"Value"===n&&"number"==typeof o.Value&&(o.Close=o.Value),o.DT?("[object Date]"!=Object.prototype.toString.call(o.DT)&&(o.DT=new Date(o.DT)),o.Date&&17==o.Date.length||(o.Date=e.yyyymmddhhmmssmmm(o.DT))):o.Date?o.DT=e.strToDateTime(o.Date):console.log("setMasterData : Missing DT and Date on masterData object"),o.Volume&&"number"!=typeof o.Volume&&(o.Volume=parseInt(o.Volume,10)),t.length-s<50&&this.updateCurrentMarketData(o,i,null,{fromTrade:!0})}for(s in i.decimalPlaces=this.callbacks.calculateTradingDecimalPlaces({stx:this,chart:i,symbol:i.symbolObject.symbol,symbolObject:i.symbolObject}),this.setDisplayDates(t),i.roundit=Math.pow(10,i.decimalPlaces),this.plugins){var l=this.plugins[s];l.display&&l.setMasterData&&l.setMasterData(this,i)}},e.ChartEngine.prototype.setMasterDataRender=function(t,e,i){i||(i=this.chart),i.symbol||(i.symbol=""),this.setMasterData(e,i),e&&(i.endPoints={},e.length&&(i.endPoints={begin:e[0].DT,end:e[e.length-1].DT},i.symbol=t)),this.createDataSet(),this.initializeChart(),this.draw(),e&&e.length||(i.symbol=null,this.clear()),this.adjustPanelPositions()},e.ChartEngine.prototype.getSymbols=function(t){t||(t={});var i,a,r,s=[],n=this.layout;function o(t,e,i){return{symbol:t,symbolObject:e,periodicity:i.periodicity,interval:i.interval,timeUnit:i.timeUnit,setSpan:i.setSpan}}for(var l in this.charts){var h=this.charts[l];for(var c in h.symbolObject&&h.symbolObject.symbol&&s.push(o(h.symbol,h.symbolObject,n)),h.series){var u=h.series[c].parameters;u.data&&!u.data.useDefaultQuoteFeed||(r=u.symbolObject,(i=o(a=u.symbol,r,n)).id=c,t["include-parameters"]&&(i.parameters=u),t["exclude-studies"]&&"study"==u.bucket||s.push(i))}}if(t["breakout-equations"]){for(var p={},d=0;d<s.length;d++)if(a=s[d].symbol,this.isEquationChart(a)){var m=e.formatEquation(a);if(m)for(var g=m.symbols,f=0;f<g.length;f++)p[g[f]]=o(g[f],s[d].symbolObject,s[d])}else p[a]=o(a,s[d].symbolObject,s[d]);for(var y in s=[],p)s.push(p[y])}return s},e.ChartEngine.prototype.setDisplayDate=function(t){if(!e.ChartEngine.isDailyInterval(this.layout.interval)){var i,r=t.DT,s=1e3*r.getSeconds()+r.getMilliseconds();this.displayZone&&(i=new a.Date(r.getTime(),this.displayZone),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes()),r=new Date(r.getTime()+s)),t.displayDate=r}},e.ChartEngine.prototype.setDisplayDates=function(t){if(t&&!e.ChartEngine.isDailyInterval(this.layout.interval))for(var i=0;i<t.length;i++){var a=t[i];a.DT&&this.setDisplayDate(a)}},e.ChartEngine.prototype.streamTrade=function(t,e,i,a){var r=this.chart;a||(a={}),a.chart&&(r=a.chart),a.fillGaps=this.streamParameters.fillGaps;var s="object"==_typeof(t),n=s?t.last:arguments[0],o=s?t.volume:arguments[1],l=s?t.bid:null,h=s?t.ask:null;s||(e=arguments[2],i=arguments[3]),i&&(a.secondarySeries=i);var c={DT:e,Last:n,Volume:o,Bid:l,Ask:h};this.updateChartData(c,r,a)},e.ChartEngine.prototype.appendMasterData=function(t,e,i){this.updateChartData(t,e,i)},e.ChartEngine.prototype.updateChartData=function(t,i,a){a||(a={}),i||(i=this.chart);var r,s,n=!1,o=!1,l=i.masterData,h=this.layout,c=(this.dataZone,this),u=a.secondarySeries;function p(){var r={market_tz:i.market.market_def.market_tz||null},s=h.interval;"month"!=s&&"week"!=s||(c.dontRoll||(s="day"),r=c.chart.market.market_def);var n,o,u=new e.Market(r),p={begin:l&&l.length?l[l.length-1].DT:t.DT,interval:s,periodicity:1,timeUnit:h.timeUnit},d=u.newIterator(p),m=d.next();if(l){if(t.DT<m){n=0;var g=d.previous();for(o=t.DT,a.appending=!0;o<g&&n<1e3;)a.appending=!1,g=d.previous(),n++;t.DT=g,a.updating=!a.appending}else if(t.DT>=m){for(n=0,o=t.DT;o>m&&n<1e3;)t.DT=m,m=d.next(),n++;a.appending=!0}}else t.DT=new Date(+d.previous())}function d(){if(n=!0,a.useAsLastSale&&a.useAsLastSale.aggregatedVolume&&(o=!0),t.constructor===Array){var e=t[t.length-1];(t={}).DT=e.DT,t.Close=e.Close,t.Volume=e.Volume}else t.Last&&(t.Close=t.Last,delete t.Last);t.DT&&"[object Date]"!=Object.prototype.toString.call(t.DT)&&(t.DT=new Date(t.DT)),t.DT&&"Invalid Date"!=t.DT||(t.DT=new Date),"tick"!=h.interval&&p(),t.Open=t.Close,t.High=t.Close,t.Low=t.Close}function m(){var e=null,a=0;if(l.length&&(e=c.getFirstLastDataRecord(l,u||i.defaultPlotField,!0))){if(t[t.length-1].DT<=e.DT)return;for(;a<t.length;a++){if(+t[a].DT==+e.DT){c.getFirstLastDataRecord([t[a]],u||i.defaultPlotField)&&(e=null);break}if(t[a].DT>e.DT)break}}var r=t.slice(a);e&&r.unshift(u?e[u]:e),r=c.doCleanupGaps(r,i),e&&r.shift(),t=t.slice(0,a).concat(r)}function g(t,e){var a;if(u)delete l[t][u],c.cleanupGaps&&(a={DT:e,Close:null},"gap"!=c.cleanupGaps&&l[t-1]&&l[t-1][u]&&(a.Close=l[t-1][u].Close,a.High=a.Low=a.Open=a.Close,a.Volume=0),l[t][u]=a);else{var n=l.splice(t,1)[0];for(r in a={DT:n.DT,Close:null,needed:!1},i.series)void 0!==n[s=i.series[r].parameters.symbolObject.symbol]&&(a[s]=n[s],delete a.needed);c.cleanupGaps&&"gap"!=c.cleanupGaps&&(delete a.needed,"gap"!=c.cleanupGaps&&l[t-1]&&(a.Close=l[t-1].Close,a.High=a.Low=a.Open=a.Close,a.Volume=0)),!1!==a.needed&&(l.splice(t,0,a),c.setDisplayDate(a))}}function f(t,h){var c=l[t];if(u&&(c=c[u]||{}),null===h.Close)void 0!==c.Open&&(h.Open=null),void 0!==c.High&&(h.High=null),void 0!==c.Low&&(h.Low=null),void 0!==c.Volume&&(h.Volume=null);else for(r in n?(h.Volume&&(h.Volume=parseInt(h.Volume,10)),o||(h.Volume+=c.Volume)):!e.isValidNumber(h.Volume)&&c.Volume&&(h.Volume=c.Volume),a.allowReplaceOHL||(e.isValidNumber(c.Open)&&(h.Open=c.Open),e.isValidNumber(c.High)&&e.isValidNumber(h.High)&&c.High>h.High&&(h.High=c.High),e.isValidNumber(c.Low)&&e.isValidNumber(h.Low)&&c.Low<h.Low&&(h.Low=c.Low)),e.isValidNumber(h.Close)||(h.Close=c.Close),e.isValidNumber(h.Open)||(h.Open=c.Open),e.isValidNumber(h.High)||(h.High=c.High),e.isValidNumber(h.Low)||(h.Low=c.Low),e.isValidNumber(h.Bid)||(h.Bid=c.Bid),e.isValidNumber(h.Ask)||(h.Ask=c.Ask),i.series)void 0===h[s=i.series[r].parameters.symbolObject.symbol]&&void 0!==c[s]&&(h[s]=c[s])}if(a.noCleanupDates||this.doCleanupDates(t,h.interval),(a.useAsLastSale||t.constructor==Object&&(t.Last||0===t.Last))&&d(),t&&t.constructor==Object&&(t=[t]),t&&t.length&&!this.runPrepend("appendMasterData",[t,i,a])&&!this.runPrepend("updateChartData",[t,i,a])){l||(l=[]);var y=l.length-1,v=!1;if(a.fillGaps&&m(),t.length){for(var x=0;x<t.length;x++){var b=t[x],S=b.DT,C=b.Date;for(S&&"[object Date]"!=Object.prototype.toString.call(S)&&(b.DT=S=new Date(S)),S&&(C&&17==C.length||(b.Date=e.yyyymmddhhmmssmmm(b.DT))),S||(S=b.DT=e.strToDateTime(C)),!e.isValidNumber(b.Close)&&e.isValidNumber(b.Value)&&(b.Close=b.Value);y>=0&&y<l.length;){var w=l[y].DT;if(w||(w=e.strToDateTime(l[y].Date)),w.getTime()<=S.getTime()){v=!0;var T=0;if(w.getTime()<S.getTime()){if(y<l.length-1){var k=l[y+1].DT||e.strToDateTime(l[y+1].Date);if(k.getTime()<=S.getTime()){y++;continue}}T=1}if(a.deleteItems){T||g(y,S);break}if("tick"==h.interval&&(T=1),T||f(y,b),e.isValidNumber(b.Close)){e.isValidNumber(b.Open)||(b.Open=b.Close);var D=Math.max(b.Open,b.Close),M=Math.min(b.Open,b.Close);(!e.isValidNumber(b.High)||b.High<D)&&(b.High=D),(!e.isValidNumber(b.Low)||b.Low>M)&&(b.Low=M)}b.Volume&&!e.isValidNumber(b.Volume)&&(b.Volume=parseInt(b.Volume,10)),y+=T,u?(t.length-x<50&&this.updateCurrentMarketData(b,i,u,{fromTrade:!0}),"tick"==h.interval&&void 0===b.Close||(T&&(l.splice(y,0,{DT:b.DT}),this.setDisplayDate(l[y])),l[y][u]=b)):(t.length-x<50&&this.updateCurrentMarketData(b,i,null,{fromTrade:!0}),"tick"==h.interval&&void 0===b.Close||(l.splice(y,T?0:1,b),this.setDisplayDate(b)));break}y+=v?1:-1}y<0&&(u?(this.updateCurrentMarketData(b,i,u,{fromTrade:!0}),"tick"==h.interval&&void 0===b.Close||(l.splice(0,0,{DT:b.DT}),this.setDisplayDate(l[0]),l[0][u]=b)):(this.updateCurrentMarketData(b,i,null,{fromTrade:!0}),"tick"==h.interval&&void 0===b.Close||(l.splice(0,0,b),this.setDisplayDate(b))),v=!0,y=0)}l.length&&(this.masterData=i.masterData=l),this.maxMasterDataSize&&(l=i.masterData=this.masterData=l.slice(-this.maxMasterDataSize));for(var A=u?this.getSeries({symbol:u,chart:i}):[i],F=0;F<A.length;F++){var P=A[F];(!P.endPoints.begin||P.endPoints.begin>t[0].DT)&&(P.endPoints.begin=t[0].DT),(!P.endPoints.end||P.endPoints.end<t[t.length-1].DT)&&(P.endPoints.end=t[t.length-1].DT);var _=P.parameters&&P.parameters.field||i.defaultPlotField;P.lastQuote=this.getFirstLastDataRecord(t,_,!0)}for(var E in this.plugins){var L=this.plugins[E];L.display&&L.appendMasterData&&L.appendMasterData(this,t,i)}if(this.masterData&&this.masterData.length||(this.masterData=l),!a.noCreateDataSet){var N=this.streamParameters;++N.count>N.maxTicks||a.bypassGovernor?(clearTimeout(N.timeout),this.createDataSet(null,null,a),this.draw(),this.updateChartAccessories(),N.count=0,N.timeout=-1):-1==N.timeout&&(N.timeout=setTimeout(function(){c.createDataSet(null,null,a),c.draw(),c.updateChartAccessories(),c.streamParameters.count=0,c.streamParameters.timeout=-1},N.maxWait))}this.runAppend("appendMasterData",arguments),this.runAppend("updateChartData",arguments)}}},e.ChartEngine.prototype.updateCurrentMarketData=function(t,i,a,r){if(t&&t.DT){i||(i=this.chart);var s=r&&r.fromTrade,n=t.DT;if(!s&&"tick"!=this.layout.interval){if(i.market.market_def){if(!i.market.isMarketDate(t.DT))return;if(!e.ChartEngine.isDailyInterval(this.layout.interval)&&null===i.market.getSession(t.DT))return}var o={begin:t.DT,interval:this.layout.interval,periodicity:this.layout.periodicity,timeUnit:this.layout.timeUnit},l=new e.Market(i.market.market_def);this.extendedHours&&this.extendedHours.filter&&l.enableAllAvailableSessions();var h=l.newIterator(o);h.next(),t.DT=h.previous()}if(!this.runPrepend("updateCurrentMarketData",arguments)){var c=i.currentMarketData;if(a&&(c[a]||(c[a]={}),c=c[a]),["Last","Bid","Ask"].forEach(function(e){t[e]&&"number"==typeof t[e]&&(!c[e]||!c[e].DT||c[e].DT<=t.DT)&&(c[e]={DT:t.DT,Price:t[e],Size:t[e+"Size"],Timestamp:n})}),["BidL2","AskL2"].forEach(function(e){t[e]&&t[e]instanceof Array&&(!c[e]||!c[e].DT||c[e].DT<=t.DT)&&(c[e]={DT:t.DT,Price_Size:t[e],Timestamp:n})}),t.Close&&(!c.Last||c.Last.DT<=t.DT)){var u=t.Close,p=r&&r.finalClose;(p||0===p)&&(u=p),c.Last={DT:t.DT,Price:u,Size:void 0===t.LastSize&&"tick"==this.layout.interval?t.Volume:t.LastSize,Timestamp:t.LastTime||n}}c.touched=new Date,s||delete t.Last,this.runAppend("updateCurrentMarketData",arguments)}}},e.ChartEngine.prototype.clearCurrentMarketData=function(t,e){if(!this.runPrepend("clearCurrentMarketData",arguments)){var i,a=[];if(t)a.push(t);else for(i in this.charts)a.push(this.charts[i]);for(i=0;i<a.length;i++){var r=a[i].currentMarketData;if(e)delete r[e];else for(var s in r)r[s]=void 0}this.runAppend("clearCurrentMarketData",arguments)}},e.ChartEngine.prototype.setMaxTicks=function(t,e){e||(e={}),(t=Math.round(t))<2&&(t=2);var i=e.padding?e.padding:0;this.layout.candleWidth=(this.chart.width-i)/t,this.layout.candleWidth||(this.layout.candleWidth=8),this.chart.maxTicks=Math.round(this.chart.width/this.layout.candleWidth-.499),(e.padding||0===e.padding)&&(this.chart.scroll=t+1)},e.ChartEngine.prototype.construct=function(){this.createChartPanel&&(this.stackPanel("chart","chart",1),this.adjustPanelPositions(),this.chart.panel=this.panels[this.chart.name]),this.cx=0,this.cy=0,this.micropixels=0,this.callbackListeners={doubleTap:[],drawing:[],drawingEdit:[],layout:[],longhold:[],move:[],newChart:[],preferences:[],rightClick:[],scroll:[],studyOverlayEdit:[],studyPanelEdit:[],symbolChange:[],symbolImport:[],tap:[],theme:[],undoStamp:[]},this.longHoldTime=700},e.ChartEngine.prototype.addDomEventListener=function(t,e,i,a){t.addEventListener(e,i,a),this.eventListeners.push({element:t,event:e,function:i,options:a})},e.ChartEngine.prototype.addEventListener=function(t,e){if("*"===t)for(var i in this.callbackListeners)this.callbackListeners[i].push(e);else if(t instanceof Array)for(var a=0;a<t.length;a++)this.callbackListeners[t[a]].push(e);else{var r=this.callbackListeners[t];if(!r)throw new Error("Attempted to add an invalid listener.");r.push(e)}return{type:t,cb:e}},e.ChartEngine.prototype.removeEventListener=function(t,e){t&&"object"==_typeof(t)||(t={type:t,cb:e});var i=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return void t.splice(i,1)},a=this.callbackListeners;if("*"!==t.type){if(!a[t.type])throw new Error("Attempted to remove an invalid listener.");i(a[t.type],t.cb)}else for(var r in a)i(a[r],t.cb)},e.ChartEngine.prototype.dispatch=function(t,e){this.callbacks[t]&&this.callbacks[t].call(this,e);var i=this.callbackListeners[t];if(i)for(var a=0;a<i.length;a++)if(!0===i[a].call(this,e))return!0;if(i=this.callbackListeners["*"])for(var r=0;r<i.length;r++)if(!0===i[r].call(this,e))return!0;return!1},e.ChartEngine.prototype.getYAxisByName=function(t,e){if("string"==typeof t&&(t=this.panels[t]),t){if(e===t.yAxis.name)return t.yAxis;var i;for(i=0;t.yaxisLHS&&i<t.yaxisLHS.length;i++)if(t.yaxisLHS[i].name===e)return t.yaxisLHS[i];for(i=0;t.yaxisRHS&&i<t.yaxisRHS.length;i++)if(t.yaxisRHS[i].name===e)return t.yaxisRHS[i]}},e.ChartEngine.prototype.getYAxisByField=function(t,e){if(e){var i,a;for(i in this.layout.studies){var r=this.layout.studies[i];if(r.panel==t.name&&r.outputMap.hasOwnProperty(e))return r.getYAxis(this)}for(i in this.chart.seriesRenderers)for(var s=this.chart.seriesRenderers[i],n=0;n<s.seriesParams.length;n++)if(s.params.panel==t.name){var o=s.seriesParams[n],l=o.field;if(l||s.highLowBars||(l=this.defaultPlotField||"Close"),o.symbol&&o.subField&&(l+="--\x3e"+o.subField),e==l)return s.params.yAxis||t.yAxis;o.field&&o.field==e.split("--\x3e")[0]&&(a=s.params.yAxis||t.yAxis)}if(a)return a}},e.ChartEngine.prototype.deleteYAxisIfUnused=function(t,e){if("string"==typeof t&&(t=this.panels[t]),e&&t){for(var i=0;i<e.renderers.length;i++){var a=this.chart.seriesRenderers[e.renderers[i]];if(a&&a.params.panel==t.name)return}if(e.name!==t.yAxis.name||t.yaxisRHS.length+t.yaxisLHS.length!==1){var r,s;for(r=0;t.yaxisRHS&&r<t.yaxisRHS.length;r++)t.yaxisRHS[r]===e?t.yaxisRHS[r]=null:s||(s=t.yaxisRHS[r]);for(r=0;t.yaxisLHS&&r<t.yaxisLHS.length;r++)t.yaxisLHS[r]===e?t.yaxisLHS[r]=null:s||(s=t.yaxisLHS[r]);t.yaxisRHS=t.yaxisRHS.filter(n),t.yaxisLHS=t.yaxisLHS.filter(n),s&&e.name===t.yAxis.name&&(t.yAxis=s),this.calculateYAxisPositions()}}function n(t){return null!==t}},e.ChartEngine.prototype.addYAxis=function(t,e){if("string"==typeof t&&(t=this.panels[t]),e&&t){t.yaxisLHS||(t.yaxisLHS=[],t.yaxisRHS=[],"left"==t.yAxis.position||"right"!=t.yAxis.position&&"left"==t.chart.panel.yAxis.position?t.yaxisLHS.push(t.yAxis):t.yaxisRHS.push(t.yAxis));var i,a=[],r=t.yaxisLHS;for(i=r.length-1;i>=0;i--)if(r[i].name===e.name){if("right"!=e.position)return r[i];a=r.splice(i,1)}for(i=(r=t.yaxisRHS).length-1;i>=0;i--)if(r[i].name===e.name){if("left"!=e.position)return r[i];a=r.splice(i,1)}return"left"===e.position||"right"!=e.position&&"left"==t.chart.panel.yAxis.position?t.yaxisLHS.unshift(e):t.yaxisRHS.push(e),e.height=t.yAxis.height,e.idealTickSizePixels=null,a[0]==t.yAxis&&(t.yAxis=e),this.calculateYAxisMargins(e),e}},e.ChartEngine.prototype.calculateYAxisPositions=function(){var t=[];for(var e in this.charts)this.charts[e].hidden||this.charts[e].panel.hidden||t.push(e);for(var i in this.panels){var a=this.panels[i];a.name===a.chart.name||a.hidden||t.push(i)}this.drawBorders;var r,s,n,o,l=0,h=0;for(s=0;s<t.length;s++)if(n=this.panels[t[s]]){n.yaxisLHS||(n.yaxisLHS=[],n.yaxisRHS=[]);var c=n.yaxisLHS,u=n.yaxisRHS,p=n.yAxis.position;p&&"none"!=p||(p=n.chart.yAxis.position||"right"),c.length||u.length||("left"==p?c.push(n.yAxis):u.push(n.yAxis));var d=[],m=[];for(r=c.length-1;r>=0;r--)("right"==c[r].position||"left"!=c[r].position&&"right"==p)&&(d=d.concat(c.splice(r,1)));for(r=u.length-1;r>=0;r--)("left"==u[r].position||"right"!=u[r].position&&"left"==p)&&(m=m.concat(u.splice(r,1)));n.yaxisLHS=m.concat(c),n.yaxisRHS=u.concat(d),n.yAxis.width||0===n.yAxis.width||(n.yAxis.width=this.yaxisWidth),n.yaxisTotalWidthRight=0,n.yaxisTotalWidthLeft=0;var g=n.yaxisLHS.concat(n.yaxisRHS);for(r=0;r<g.length;r++)!(o=g[r]).noDraw&&o.width&&("left"==o.position||"left"==p&&!o.position?n.yaxisTotalWidthLeft+=o.width:n.yaxisTotalWidthRight+=o.width);n.yaxisTotalWidthLeft>l&&(l=n.yaxisTotalWidthLeft),n.yaxisTotalWidthRight>h&&(h=n.yaxisTotalWidthRight)}for(s=0;s<t.length;s++)if(n=this.panels[t[s]]){var f=n.name===n.chart.name,y=l;for(r=n.yaxisLHS.length-1;r>=0;r--)(o=n.yaxisLHS[r]).noDraw||(y-=o.width,o.left=y);for(y=this.width-h,r=0;r<n.yaxisRHS.length;r++)(o=n.yaxisRHS[r]).noDraw||(o.left=y,y+=o.width);void 0!==this.yaxisLeft&&(n.chart.yaxisPaddingRight=this.yaxisLeft),n.yaxisCalculatedPaddingRight=h,(n.chart.yaxisPaddingRight||0===n.chart.yaxisPaddingRight)&&(n.yaxisCalculatedPaddingRight=n.chart.yaxisPaddingRight),n.yaxisCalculatedPaddingLeft=l,(n.chart.yaxisPaddingLeft||0===n.chart.yaxisPaddingLeft)&&(n.yaxisCalculatedPaddingLeft=n.chart.yaxisPaddingLeft),f||n.chart.panel.hidden?(n.left=n.yaxisCalculatedPaddingLeft,n.right=this.width-n.yaxisCalculatedPaddingRight):(n.left=n.chart.panel.left,n.right=n.chart.panel.right),n.width=n.right-n.left,n.handle&&(n.handle.style.left=n.left+"px",n.handle.style.width=n.width+"px"),(f||n.chart.panel.hidden)&&(n.chart.panel.left=n.chart.left=n.left,n.chart.panel.right=n.chart.right=n.right,n.chart.panel.width=n.chart.width=Math.max(n.right-n.left,0))}this.setCandleWidth(this.layout.candleWidth),this.adjustPanelPositions()},e.ChartEngine.prototype.getYAxisCurrentPosition=function(t,e){if(!t.width)return"none";for(var i=e.yaxisLHS,a=0;a<i.length;a++)if(i[a].name==t.name)return"left";return"right"},e.ChartEngine.prototype.setYAxisPosition=function(t,i){t.position=i,t.width="none"==i?0:e.ChartEngine.YAxis.prototype.width,this.calculateYAxisPositions(),this.draw()},e.ChartEngine.prototype.initializeChart=function(t){if(!this.runPrepend("initializeChart",arguments)){this.chart.symbolObject.symbol||(this.chart.symbolObject.symbol=this.chart.symbol),this.locale&&this.setLocale(this.locale),!this.displayZone&&e.ChartEngine.defaultDisplayTimeZone&&this.setTimeZone(null,e.ChartEngine.defaultDisplayTimeZone),this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.micropixels=0,t?this.chart.container=t:t=this.chart.container,t.stx=this,t.CIQRegistered||(t.CIQRegistered=!0,e.ChartEngine.registeredContainers.push(t)),this.registerHTMLElements();var i=this.chart.canvas,a=this.chart.tempCanvas,r=this.floatCanvas;i&&document.createElement("canvas").getContext?(i.id||(t.removeChild(i),this.chart.canvas=null),a&&!a.id&&(t.removeChild(a),this.chart.tempCanvas=null),r&&!r.id&&(t.removeChild(r),this.floatCanvas=null)):(this.layout.candleWidth<this.minimumCandleWidth&&(this.layout.candleWidth=this.minimumCandleWidth),this.layout.candleWidth>200&&(this.layout.candleWidth=8)),this.chart.canvas||(i=this.chart.canvas=document.createElement("canvas")),t.appendChild(i),i.style.position="absolute",i.style.left="0px";var s=i.context=this.chart.context=i.getContext("2d");s.lineWidth=1,this.chart.tempCanvas||(a=this.chart.tempCanvas=document.createElement("canvas")),t.appendChild(a),a.style.position="absolute",a.style.left="0px",a.context=this.chart.tempCanvas.getContext("2d"),a.context.lineWidth=1,a.style.display="none",this.floatCanvas||(r=this.floatCanvas=document.createElement("canvas")),t.appendChild(r),r.style.position="absolute",r.style.left="0px",r.context=r.getContext("2d"),r.context.lineWidth=1,r.style.display="none",this.resizeCanvas(),e.isAndroid&&(this.chart.tempCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()},this.floatCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()});var n=this.chart,o=this.panels;for(var l in n.panel.display=n.symbol,n.symbolDisplay&&(n.panel.display=n.symbolDisplay),this.adjustPanelPositions(),this.chart.panel=o[n.name],o)for(var h=o[l].yaxisLHS.concat(o[l].yaxisRHS),c=0;c<h.length;c++)h[c].height=o[l].yAxis.height,this.calculateYAxisMargins(h[c]);if(this.initialWhitespace=this.preferences.whitespace,n.dataSet&&n.dataSet.length>0){n.scroll=Math.floor(n.width/this.layout.candleWidth);var u=Math.round(this.preferences.whitespace/this.layout.candleWidth);n.scroll-=u}if(e.touchDevice){var p=t.querySelector(".overlayEdit"),d=t.querySelector(".overlayTrashCan"),m=t.querySelector(".vectorTrashCan");p?(e.safeClickTouch(p,function(t){return function(e){t.deleteHighlighted(!0,!0)}}(this)),d&&e.safeClickTouch(d,function(t){return function(e){t.deleteHighlighted(!1)}}(this))):d&&e.safeClickTouch(d,function(t){return function(e){t.deleteHighlighted(!0)}}(this)),m&&e.safeClickTouch(m,function(t){return function(e){t.deleteHighlighted(!0)}}(this))}for(var g in this.manageTouchAndMouse&&this.registerTouchAndMouseEvents(),t.onmouseout=function(t){return function(e){t.handleMouseOut(e)}}(this),e.smartHover(),this.abortDrawings(),this.undoStamps=[],o){var f=o[g];f.markerHolder&&(t.removeChild(f.markerHolder),f.markerHolder=null)}for(var y in this.plugins){var v=this.plugins[y];v.display&&v.initializeChart&&v.initializeChart(this)}if(!this.resizeListenerInitialized){var x=this;this.resizeListenerInitialized=!0;var b=function(){return function(t){x.resizeChart()}};this.addDomEventListener(window,"resize",b(),!0)}n.baseline.userLevel&&(n.baseline.userLevel=null),this.setResizeTimer(this.resizeDetectMS),this.runAppend("initializeChart",arguments)}},e.ChartEngine.prototype.destroy=function(){this.setResizeTimer(0),this.quoteDriver&&this.quoteDriver.die(),this.styles={};for(var t=0;t<this.eventListeners.length;t++){var i=this.eventListeners[t];i.element.removeEventListener(i.event,i.function,i.options)}this.touchAndMouseEventsRegistered=!1,this.eventListeners=[],this.streamParameters.timeout&&clearTimeout(this.streamParameters.timeout);var a=e.ChartEngine.registeredContainers,r=a.indexOf(this.chart.container);if(r>-1&&a.splice(r,1),this.slider){var s=a.indexOf(this.slider.slider.chart.container);s>-1&&a.splice(s,1)}},e.ChartEngine.prototype.handleMouseOut=function(t){if(t=t||window.event,!e.withinElement(this.chart.container,t.pageX,t.pageY)){if(this.runPrepend("handleMouseOut",arguments))return;if(this.grabbingScreen||this.findHighlights(null,!0),this.undisplayCrosshairs(),this.touches=[],this.touching=!1,this.activeDrawing&&this.userPointerDown){this.userPointerDown=!1,this.drawingLine=!1;var i=this.backOutY(t.pageY),a=this.backOutX(t.pageX);this.drawingClick(this.currentPanel,a,i)}this.insideChart=!1,this.overYAxis=!1,this.overXAxis=!1,this.displaySticky(),this.runAppend("handleMouseOut",arguments)}},e.ChartEngine.prototype.registerTouchAndMouseEvents=function(){if(!this.touchAndMouseEventsRegistered){this.touchAndMouseEventsRegistered=!0;var t=this.controls.chartControls||document,i=t.querySelector(".stx-zoom-in"),a=t.querySelector(".stx-zoom-out"),r=this.chart.container,s=this,n=function(t,e,i){s.addDomEventListener(r,t,function(t){s.mainSeriesRenderer&&s.mainSeriesRenderer.nonInteractive||e(t)},i)};e.touchDevice?e.isSurface?(n("mousemove",function(t){s.msMouseMoveProxy(t)}),n("mouseenter",function(t){s.msMouseMoveProxy(t)}),n("mousedown",function(t){s.msMouseDownProxy(t)}),n("mouseup",function(t){s.msMouseUpProxy(t)}),n("pointerdown",function(t){return s.startProxy(t)}),n("pointermove",function(t){s.moveProxy(t)}),n("pointerenter",function(t){return s.moveProxy(t)}),n("pointerup",function(t){return s.endProxy(t)})):(e.isAndroid||e.ipad||e.iphone||(n("mousemove",function(t){s.iosMouseMoveProxy(t)}),n("mouseenter",function(t){s.iosMouseMoveProxy(t)}),n("mousedown",function(t){s.iosMouseDownProxy(t)}),n("mouseup",function(t){s.iosMouseUpProxy(t)})),n("touchstart",function(t){s.touchstart(t)}),n("touchmove",function(t){s.touchmove(t)}),n("touchend",function(t){s.touchend(t)}),n("pointerdown",function(t){s.touchPointerType=t.pointerType}),i&&(i.removeAttribute("onMouseOver"),i.removeAttribute("onMouseOut")),a&&(a.removeAttribute("onMouseOver"),a.removeAttribute("onMouseOut"))):(n("mousemove",function(t){s.mousemove(t)}),n("mouseenter",function(t){s.mousemove(t)}),n("mousedown",function(t){s.mousedown(t)}),n("mouseup",function(t){s.mouseup(t)}));var o=e.wheelEvent;this.captureMouseWheelEvents&&n(o,function(t){s.mouseWheel(t)},{passive:!1})}},e.ChartEngine.prototype.rightClickHighlighted=function(){this.runPrepend("rightClickHighlighted",arguments)||(this.deleteHighlighted(!0),this.runAppend("rightClickHighlighted",arguments))},e.ChartEngine.prototype.deleteHighlighted=function(t,i){if(!this.runPrepend("deleteHighlighted",arguments)){this.cancelTouchSingleClick=!0,e.clearCanvas(this.chart.tempCanvas,this);var a=!1===this.bypassRightClick;if(a||!this.bypassRightClick.drawing)for(var r=this.drawingObjects.length-1;r>=0;r--){var s=this.drawingObjects[r];if(s.highlighted)if(t)this.rightClickDrawing(s,i);else if(!s.permanent){var n=s.abort();if(!n){var o=this.exportDrawings();this.drawingObjects.splice(r,1),this.undoStamp(o,this.exportDrawings())}this.changeOccurred("vector")}}if(a||!this.bypassRightClick.study)for(var l in this.overlays){var h=this.overlays[l];(h.overlay||h.underlay)&&h.highlight&&!h.permanent&&(t||i?this.rightClickOverlay(l,i):this.removeOverlay(l))}var c=this.currentPanel.chart;if(a||!this.bypassRightClick.series)for(var u in c.seriesRenderers){var p=c.seriesRenderers[u];if(p.params.highlightable)for(var d=this.panels[p.params.panel],m=d&&d.yAxis.name,g=p.seriesParams.length-1;g>=0;g--){var f=p.seriesParams[g];if((p.params.highlight||f.highlight)&&!f.permanent&&(p.removeSeries(f.id),p.seriesParams.length<1))if(this.removeSeriesRenderer(p),p.params.name==m)this.electNewPanelOwner(p.params.panel);else{this.checkForEmptyPanel(p.params.panel);var y=this.getYAxisByName(d,p.params.name);y&&(y.name=y.studies[0]||y.renderers[1])}}}this.draw(),this.resizeChart(),this.clearMeasure();var v=this.controls.mSticky;v&&(v.style.display="none",v.children[0].innerHTML=""),this.runAppend("deleteHighlighted",arguments)}},e.ChartEngine.prototype.panelExists=function(t){for(var e in this.panels){if(this.panels[e].name==t)return!0}return!1},e.ChartEngine.prototype.hideCrosshairs=function(){this.displayCrosshairs=!1},e.ChartEngine.prototype.showCrosshairs=function(){this.displayCrosshairs=!0},e.ChartEngine.prototype.grabHandle=function(t){this.runPrepend("grabHandle",arguments)||t&&(e.ChartEngine.crosshairY=t.top+this.top,e.ChartEngine.resizingPanel=t,e.appendClassName(t.handle,"stx-grab"),this.runAppend("grabHandle",arguments))},e.ChartEngine.prototype.releaseHandle=function(){if(this.runPrepend("releaseHandle",arguments))return!0;e.clearCanvas(this.chart.tempCanvas,this),this.resizePanels(),e.ChartEngine.resizingPanel&&e.unappendClassName(e.ChartEngine.resizingPanel.handle,"stx-grab"),e.ChartEngine.resizingPanel=null,this.runAppend("releaseHandle",arguments)},e.ChartEngine.prototype.storePanels=function(){this.layout||(this.layout={});var t=this.layout;for(var e in t.panels={},this.panels){var i=this.panels[e];t.panels[i.name]={percent:i.percent,display:i.display,yAxis:i.yAxis}}},e.ChartEngine.prototype.savePanels=function(t){this.storePanels(),!1!==t&&this.changeOccurred("layout")},e.ChartEngine.prototype.resolveY=function(t){return this.top+t},e.ChartEngine.prototype.resolveX=function(t){return this.left+t},e.ChartEngine.prototype.backOutY=function(t){return t-this.top},e.ChartEngine.prototype.backOutX=function(t){return t-this.left},e.ChartEngine.prototype.cleanupRemovedStudy=function(t){if(t){for(var i in t.study.removeFN&&t.study.removeFN(this,t),this.plugins)i.indexOf("{"+t.id+"}")>-1&&delete this.plugins[i];this.layout.studies&&delete this.layout.studies[t.name],delete this.overlays[t.name],e.Studies&&e.Studies.removeStudySymbols(t,this),this.quoteDriver&&this.quoteDriver.updateSubscriptions()}},e.ChartEngine.prototype.privateDeletePanel=function(t){for(var e in this.layout.studies){var i=this.layout.studies[e];i.panel==t.name&&this.cleanupRemovedStudy(i)}for(var a in delete this.panels[t.name],this.overlays)this.overlays[a].panel==t.name&&(this.layout.studies&&this.cleanupRemovedStudy(this.layout.studies[a]),delete this.overlays[a]);for(var r in this.chart.series)this.chart.series[r].parameters.panel==t.name&&this.removeSeries(this.chart.series[r],this.chart);if(t.holder&&(this.chart.container.removeChild(t.holder),this.getMarkerArray))for(var s=this.getMarkerArray("panelName",t.name),n=0;n<s.length;n++)this.removeFromHolder(s[n]);t.handle&&t.handle.parentNode.removeChild(t.handle),this.currentPanel=null},e.ChartEngine.prototype.plotsInPanel=function(t){var e=[],i=t;for(var a in"object"==_typeof(t)&&(i=t.name),this.layout.studies){var r=this.layout.studies[a];i===r.panel&&e.push(r)}for(var s in this.chart.seriesRenderers){var n=this.chart.seriesRenderers[s];i===n.params.panel&&e.push(n)}return e},e.ChartEngine.prototype.checkForEmptyPanel=function(t,e,i){if(!t)return!1;var a=t;if("object"==_typeof(t)&&(a=t.name),a===this.chart.name)return!1;i?i instanceof Array||(i=[i]):i=[];for(var r=this.plotsInPanel(t),s=0;s<r.length;s++)if(-1==i.indexOf(r[s]))return!1;return e||this.panelClose(this.panels[a]),!0},e.ChartEngine.prototype.panelClose=function(t){if(t&&!this.runPrepend("panelClose",arguments)){if(this.cancelTouchSingleClick=!0,e.ChartEngine.drawingLine=!1,t.soloing&&this.panelSolo(t),this.charts[t.name]){for(var i in this.panels){var a=this.panels[i];a.chart.name==t.name&&this.privateDeletePanel(a)}delete this.charts[t.name]}else this.privateDeletePanel(t);this.currentlyImporting||(this.showCrosshairs(),this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.draw(),this.savePanels()),this.userPointerDown=this.grabbingScreen=!1,this.openDialog&&(this.openDialog=""),this.runAppend("panelClose",arguments)}},e.ChartEngine.prototype.deleteAllPanels=function(){for(var t in this.panels){var e=this.panels[t];this.privateDeletePanel(e)}this.layout.panels={},this.panels={}},e.ChartEngine.prototype.panelUp=function(t){this.cancelTouchSingleClick=!0,e.ChartEngine.drawingLine=!1,this.showCrosshairs();var i,a={},r=0;for(i in this.panels){if(i==t.name)break;r++}if(r){var s=0;for(i in this.panels)s==r-1&&(a[t.name]=t),i!=t.name&&(a[i]=this.panels[i],s++);this.panels=a,this.adjustPanelPositions(),this.draw(),this.savePanels()}},e.ChartEngine.prototype.panelDown=function(t){this.cancelTouchSingleClick=!0,e.ChartEngine.drawingLine=!1,this.showCrosshairs();var i,a={},r=0;for(i in this.panels){if(i==t.name)break;r++}var s=0;for(i in this.panels)s++;if(r!=s-1){var n=0;for(i in this.panels)i!=t.name?(a[i]=this.panels[i],n==r+1&&(a[t.name]=t),n++):n++;this.panels=a,this.adjustPanelPositions(),this.draw(),this.savePanels()}},e.ChartEngine.prototype.panelSolo=function(t){this.cancelTouchSingleClick=!0,e.ChartEngine.drawingLine=!1,this.showCrosshairs();var i,a=!0;if(t.soloing){if(a=!1,t.soloing=!1,e.unappendClassName(t.solo,"stx_solo_lit"),t.percent=t.oldPercent,"chart"!=t.name)if(this.soloPanelToFullScreen){if(1==t.percent)for(i in this.panels){var r=this.panels[i];r!=t&&(t.percent-=r.percent)}}else this.chart.panel.percent=this.chart.panel.oldPercent;this.soloPanelToFullScreen&&(this.xAxisAsFooter=this.chart.panel.oldXAxisAsFooter)}else t.soloing=!0,e.appendClassName(t.solo,"stx_solo_lit"),t.oldPercent=t.percent,this.chart.panel.oldXAxisAsFooter=this.xAxisAsFooter,"chart"!=t.name&&(this.soloPanelToFullScreen?this.xAxisAsFooter=!0:(this.chart.panel.oldPercent=this.chart.panel.percent,t.percent=1-this.chart.panel.percent));for(i in this.panels)this.panels[i].hidden=a;this.soloPanelToFullScreen||(this.chart.panel.hidden=!1),t.hidden=!1,this.resetDynamicYAxis({noRecalculate:!0}),this.calculateYAxisPositions(),this.draw(),this.savePanels()},e.ChartEngine.prototype.calculatePanelPercent=function(t){var e=t.bottom-t.top;t.percent=e/this.chart.canvasHeight},e.ChartEngine.prototype.resizePanels=function(){if(e.ChartEngine.resizingPanel){var t,i,a,r,s=e.ChartEngine.crosshairY>this.resolveY(e.ChartEngine.resizingPanel.top);for(var n in this.panels){if(this.panels[n]==e.ChartEngine.resizingPanel)break;this.panels[n].hidden||(t=this.panels[n])}var o=this.backOutY(e.ChartEngine.crosshairY);if(s)for(a=e.ChartEngine.resizingPanel.yaxisLHS.concat(e.ChartEngine.resizingPanel.yaxisRHS),r=0;r<a.length;r++)i=a[r].initialMarginTop+a[r].initialMarginBottom+10,o>a[r].bottom-i&&(o=a[r].bottom-i);else for(a=t.yaxisLHS.concat(t.yaxisRHS),r=0;r<a.length;r++)i=a[r].initialMarginTop+a[r].initialMarginBottom+10,o<a[r].top+i&&(o=a[r].top+i);e.ChartEngine.crosshairY=this.resolveY(o),t.bottom=o,e.ChartEngine.resizingPanel.top=o,this.calculatePanelPercent(t),this.calculatePanelPercent(e.ChartEngine.resizingPanel),this.adjustPanelPositions(),this.draw(),this.savePanels()}},e.ChartEngine.prototype.adjustPanelPositions=function(){if(this.chart.tempCanvas&&e.clearCanvas(this.chart.tempCanvas,this),this.chart.symbol&&!this.runPrepend("adjustPanelPositions",arguments)){var t,i,a,r=0,s=this.chart.canvasHeight,n=!1,o=0,l=0,h=!1;for(t in this.panels)i=this.panels[t],(isNaN(i.percent)||i.percent<=0)&&(i.percent=.05),i.hidden||(o+=i.percent,l++,i.soloing&&(h=!0));for(t in this.panels){var c=0;if((i=this.panels[t]).hidden)i.markerHolder&&(i.markerHolder.style.display="none");else{if(this.manageTouchAndMouse&&(i.up&&(n?this.displayIconsUpDown&&e.appendClassName(i.up,"stx-show"):(n=!0,e.unappendClassName(i.up,"stx-show"))),i.solo&&(h?i.soloing&&this.displayIconsSolo?e.appendClassName(i.solo,"stx-show"):e.unappendClassName(i.solo,"stx-show"):1==l?e.unappendClassName(i.solo,"stx-show"):2!=l||this.soloPanelToFullScreen?this.displayIconsSolo&&e.appendClassName(i.solo,"stx-show"):e.unappendClassName(i.solo,"stx-show")),i.down&&(1==l?e.unappendClassName(i.down,"stx-show"):this.displayIconsUpDown&&e.appendClassName(i.down,"stx-show")),i.edit&&(i.editFunction?e.appendClassName(i.edit,"stx-show"):e.unappendClassName(i.edit,"stx-show")),i.close&&(this.displayIconsClose?e.appendClassName(i.close,"stx-show"):e.unappendClassName(i.close,"stx-show"))),i.percent=i.percent/o,i.top=r,i.bottom=i.top+s*i.percent,i.height=i.bottom-i.top,i.chart.name==i.name&&(i.chart.top=i.top,i.chart.bottom=i.bottom,i.chart.height=i.height),r=i.bottom,i.yaxisLHS)for(var u=i.yaxisLHS.concat(i.yaxisRHS),p=0;p<u.length;p++){var d=u[p];d.zoom&&d.height>0&&(c=d.zoom/d.height),this.adjustYAxisHeightOffset(i,d),d.height=d.bottom-d.top,c&&(d.scroll*=c*d.height/d.zoom,d.zoom=c*d.height,d.zoom>d.height&&(d.zoom=0,d.scroll=0)),d.high||0===d.high||(d.high=100,d.low=0,d.shadow=100),d.multiplier=d.height/d.shadow}i.holder&&(i.holder.style.right="0px",i.holder.style.top=i.top+"px",i.holder.style.left="0px",i.holder.style.height=i.height+"px",i.subholder.style.left=i.left+"px",i.subholder.style.width=i.width+"px",i.subholder.style.top="0px",i.yAxis.height>=0&&(i.subholder.style.height=i.yAxis.height+"px"))}}if(t&&this.panels[t].down&&e.unappendClassName(this.panels[t].down,"stx-show"),this.manageTouchAndMouse&&2==l&&!h&&this.chart.panel.solo&&e.appendClassName(this.chart.panel.solo,"stx-show"),this.chart.panel)a=h&&this.soloPanelToFullScreen?this.chart.canvasHeight-i.yAxis.bottom+12:this.chart.canvasHeight-this.chart.panel.yAxis.bottom+12,this.controls.chartControls&&(this.controls.chartControls.style.bottom=a+"px"),this.controls.home&&(this.controls.home.style.bottom=a+"px",this.controls.home.style.marginRight=this.width-this.chart.panel.right+"px");this.clearPixelCache(),this.adjustDrawings(),this.runAppend("adjustPanelPositions",arguments)}},e.ChartEngine.prototype.addChart=function(t,e){e.name=t,this.charts[t]=e},e.ChartEngine.prototype.createPanel=function(t,e,i,a,r){if(!this.runPrepend("createPanel",arguments)){a||(a="chart");var s=this.chart.canvasHeight;i||(i=.2*s);var n=i/s,o=1-n,l=!1;for(var h in this.panels){var c=this.panels[h];c.percent*=o,c.soloing&&(l=!0)}return this.stackPanel(t,e,n,a,r),this.panels[e].hidden=l,this.adjustPanelPositions(),this.savePanels(!1),this.runAppend("createPanel",arguments),this.panels[e]}},e.ChartEngine.prototype.modifyPanel=function(t,i){i||(i={});var a=i.name;a||(a=e.uniqueID());var r=i.display;r||(r=a);var s=i.yAxis;s||((s=t.yAxis).name=a);var n=t.name,o={};for(var l in this.panels)if(l==t.name){var h=this.panels[l];h.name=a,h.display=r,h.yAxis=s,t=o[a]=h,this.moveMarkers&&this.moveMarkers(n,a)}else o[l]=this.panels[l];this.panels=o;var c,u=this.layout.studies,p=this.chart.series,d=!1;for(c in u){var m=u[c];m.panel==n&&(m.panel=a,m.parameters&&m.parameters.panelName&&(d=!0,m.parameters.panelName=a))}for(c in p)p[c].parameters.panel==n&&(d=!0,this.modifySeries(c,{panel:a}));d&&this.changeOccurred("layout");for(var g=!1,f=0;f<this.drawingObjects.length;f++){var y=this.drawingObjects[f];n==y.panelName&&(y.panelName=a,g=!0)}g&&this.changeOccurred("vector"),this.calculateYAxisPositions()},e.ChartEngine.prototype.electNewPanelOwner=function(t,i){var a;"string"==typeof t&&(t=this.panels[t]);var r=t.yAxis.name;if(t&&t!=this.chart.panel){var s=t.yAxis,n=s.studies[0];if(n&&n!=r||(n=s.renderers[0]),n&&n!=r||(n=s.studies[1]),n||(n=s.renderers[1]),i)s=t.yAxis=i,a=i.name;else if(n)(s=this.addYAxis(t,new e.ChartEngine.YAxis({name:n}))).renderers=t.yAxis.renderers,s.studies=t.yAxis.studies,a=n;else if(t.yaxisLHS){for(var o=t.yaxisRHS.concat(t.yaxisLHS).filter(function(t){return t.name!=r}),l=o[0],h=0;h<o.length;h++)if(!o[h].position){l=o[h];break}l&&(s=t.yAxis=l,a=l.studies[0]||l.renderers[0])}if(a){n=a,r!=t.name&&(n=t.name);var c,u=this.layout.studies;u&&u[a]&&(c=u[a].inputs.display),this.modifyPanel(t,{name:n,display:c||a,yAxis:s}),this.calculateYAxisMargins(this.panels[n].yAxis)}else this.checkForEmptyPanel(t)}return a},e.ChartEngine.prototype.electNewYAxisOwner=function(t){var e=t.studies[0];e&&e!=t.name||(e=t.renderers[0]),e&&e!=t.name||(e=t.studies[1]),e||(e=t.renderers[1]);for(var i=0;i<t.studies.length;i++){var a=this.layout.studies[t.studies[i]];a.parameters&&a.parameters.yaxisDisplayValue==t.name&&(a.parameters.yaxisDisplayValue=e)}return e},e.ChartEngine.prototype.configurePanelControls=function(t){var i=t.icons;if(i){var a=t.name==t.chart.name;if(e.appendClassName(i,"stx-show"),t.title=i.querySelector(".stx-panel-title"),t.up=i.querySelector(".stx-ico-up"),t.up&&(t.up=t.up.parentNode),t.solo=i.querySelector(".stx-ico-focus"),t.solo&&(t.solo=t.solo.parentNode),t.down=i.querySelector(".stx-ico-down"),t.down&&(t.down=t.down.parentNode),t.edit=i.querySelector(".stx-ico-edit"),t.edit&&(t.edit=t.edit.parentNode),t.close=i.querySelector(".stx-ico-close"),t.close&&(t.close=t.close.parentNode),t.title&&(t.title.innerHTML="",t.display&&t.title.appendChild(document.createTextNode(t.display)),a&&(e.appendClassName(t.title,"chart-title"),e.appendClassName(i,"stx-chart-panel"))),e.touchDevice&&!e.isSurface||this.makeModal(i),t.handle){e.touchDevice&&!e.isSurface||(t.handle.onmouseover=function(t){return function(){t.hideCrosshairs()}}(this)),e.touchDevice&&!e.isSurface||(t.handle.onmouseout=function(t){return function(){t.showCrosshairs()}}(this));var r=function(t,i){return function(a){e.ChartEngine.resizingPanel||t.grabHandle(i)}};e.isSurface?t.handle.onpointerdown=r(this,t):t.handle.onmousedown=r(this,t),e.touchDevice&&(t.handle.ontouchstart=r(this,t))}t.up&&e.safeClickTouch(t.up,function(t,e){return function(){t.panelUp(e)}}(this,t)),t.down&&e.safeClickTouch(t.down,function(t,e){return function(){t.panelDown(e)}}(this,t)),t.solo&&e.safeClickTouch(t.solo,function(t,e){return function(){t.panelSolo(e)}}(this,t)),t.close&&("chart"==t.name?t.close.style.display="none":e.safeClickTouch(t.close,function(t,e){return function(){t.panelClose(e)}}(this,t)))}},e.ChartEngine.prototype.stackPanel=function(t,i,a,r,s){if(!this.runPrepend("stackPanel",arguments)){r||(r="chart");var n=this.charts[r],o=i==r;o&&(t=n.symbol,n.symbolDisplay&&(t=n.symbolDisplay),s||(s=n.yAxis));var l=this.panels[i]=new e.ChartEngine.Panel(i,s);!o&&n.yAxis&&l.yAxis.position==n.yAxis.position&&(l.yAxis.width=n.yAxis.width),o&&!n.panel&&(n.panel=l),l.percent=a,l.chart=n,l.display=t,l.holder=e.newChild(this.container,"div","stx-holder"),l.subholder=e.newChild(l.holder,"div","stx-subholder"),l.subholder.style.zIndex=1,l.holder.panel=l;var h=o?"stx-panel-chart":"stx-panel-study";e.appendClassName(l.holder,h),this.controls.handleTemplate&&this.manageTouchAndMouse&&(l.handle=this.controls.handleTemplate.cloneNode(!0),this.container.appendChild(l.handle),l.handle.panel=l),this.controls.iconsTemplate&&(l.icons=this.controls.iconsTemplate.cloneNode(!0),l.subholder.appendChild(l.icons),this.configurePanelControls(l)),this.currentlyImporting||this.resizeCanvas(),this.runAppend("stackPanel",arguments)}},e.ChartEngine.prototype.setPanelEdit=function(t,i){t.editFunction=i,t.edit&&e.safeClickTouch(t.edit,i),this.adjustPanelPositions()},e.ChartEngine.prototype.drawPanels=function(){if(!this.runPrepend("drawPanels",arguments)){var t=!1;for(var i in this.panels){var a=this.panels[i];a.state={};var r=this.translateIf(a.display);if(a.title&&a.title.textContent!=r&&(a.title.innerHTML="",a.title.appendChild(document.createTextNode(r))),e.appendClassName(a.icons,"stx-show"),a.hidden)e.unappendClassName(a.icons,"stx-show"),a.handle&&(a.handle.style.display="none"),a.holder.style.display="none";else{if("chart"!=a.name){var s=this.manageTouchAndMouse;a.up&&(a.up.style.display=this.displayIconsUpDown&&s?"":"none"),a.down&&(a.down.style.display=this.displayIconsUpDown&&s?"":"none"),a.solo&&(a.solo.style.display=this.displayIconsSolo&&s?"":"none"),a.close&&(a.close.style.display=this.displayIconsClose&&s?"":"none"),a.edit&&(a.edit.style.display=a.editFunction&&s?"":"none")}if(a.holder.style.display="block",a.displayEdgeIfPadded){var n=Math.round(a.left)+.5,o=a.yAxis.top-.5,l=a.yAxis.bottom+.5;a.yaxisCalculatedPaddingLeft&&!a.yaxisTotalWidthLeft&&this.plotLine(n,n,o,l,this.canvasStyle("stx_grid_border"),"segment",this.chart.context,!1,{lineWidth:1}),n=Math.round(a.right)+.5,a.yaxisCalculatedPaddingRight&&!a.yaxisTotalWidthRight&&this.plotLine(n,n,o,l,this.canvasStyle("stx_grid_border"),"segment",this.chart.context,!1,{lineWidth:1})}if(t){var h=a.top;h=Math.round(h)+.5,this.plotLine(a.left-.5,a.right+.5,h,h,this.canvasStyle("stx_panel_border"),"segment",this.chart.context,!1,{}),a.handle&&(this.displayPanelResize?a.handle.style.display="":a.handle.style.display="none",a.handle.style.top=h-a.handle.offsetHeight/2+"px")}else a.handle&&(a.handle.style.display="none"),t=!0}}this.runAppend("drawPanels",arguments)}},e.ChartEngine.prototype.touchSingleClick=function(t,i,a){var r=this,s=arguments;return function(){(function(){if(!this.cancelTouchSingleClick){if(this.runPrepend("touchSingleClick",s))return;if(this.editingAnnotation)return;if(this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},!this.displayCrosshairs)return;if(!this.displayInitialized)return;if(""!==this.openDialog)return;if(i<this.left||i>this.right||a<this.top||a>this.bottom)return;var t=this.backOutY(e.ChartEngine.crosshairY),n=this.backOutX(e.ChartEngine.crosshairX);this.currentPanel=this.whichPanel(t);var o=this.currentVectorParameters.vectorType;if(!(e.Drawing&&o&&e.Drawing[o]&&(new e.Drawing[o]).dragToDraw)){if(!this.drawingClick(this.currentPanel,n,t)&&!this.layout.crosshair){e.ChartEngine.crosshairY=0,e.ChartEngine.crosshairX=0,this.cx=this.backOutX(e.ChartEngine.crosshairX),this.cy=this.backOutY(e.ChartEngine.crosshairY),this.findHighlights(null,!0),e.ChartEngine.crosshairY=a,e.ChartEngine.crosshairX=i;var l=this.container.getBoundingClientRect();this.top=l.top,this.left=l.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cx=this.backOutX(e.ChartEngine.crosshairX),this.cy=this.backOutY(e.ChartEngine.crosshairY),this.currentPanel&&this.currentPanel.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.cx,this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel))),this.headsUpHR(),this.findHighlights(!0)}this.currentVectorParameters.vectorType||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:n,y:t})}}r.cancelTouchSingleClick=!1,this.runAppend("touchSingleClick",s)}).apply(r,s)}},e.ChartEngine.prototype.touchDoubleClick=function(t,i,a){if(!this.runPrepend("touchDoubleClick",arguments)&&!this.dispatch("doubleTap",{stx:this,finger:t,x:i,y:a})&&!(i<this.left||i>this.right||a<this.chart.panel.top||a>this.chart.panel.bottom||this.editingAnnotation)){if(e.ChartEngine.drawingLine)this.undo();else if(this.anyHighlighted)this.deleteHighlighted();else{var r=this.currentPanel.yAxis;r.scroll==(r.initialMarginTop-r.initialMarginBottom)/2&&r.zoom==r.initialMarginTop+r.initialMarginBottom?this.home():this.calculateYAxisMargins(this.currentPanel.yAxis),this.draw()}this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.runAppend("touchDoubleClick",arguments)}},e.ChartEngine.prototype.startProxy=function(t){this.touchPointerType=t.pointerType,"touch"==this.touchPointerType?(this.mouseMode=!1,this.touches[this.touches.length]={pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY},this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],1==this.touches.length&&(this.gesturePointerId=t.pointerId),this.touchstart(t)):this.mouseMode=!0},e.ChartEngine.prototype.moveProxy=function(t){t.pointerType&&"touch"!=t.pointerType?this.mouseMode=!0:(this.mouseMode=!1,this.touchmove(t))},e.ChartEngine.prototype.endProxy=function(t){if("touch"==this.touchPointerType){this.mouseMode=!1;for(var e=this.touches.length,i=0;i<this.touches.length;i++)if(this.touches[i].pointerId==t.pointerId){this.touches.splice(i,1);break}if(i==e)return this.touches=[],this.grabbingScreen=!1,void(this.touching=!1);this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],this.touchend(t)}else this.mouseMode=!0},e.ChartEngine.prototype.msMouseMoveProxy=function(t){!this.touches.length&&this.mouseMode&&this.mousemove(t)},e.ChartEngine.prototype.msMouseDownProxy=function(t){this.mouseMode&&this.mousedown(t)},e.ChartEngine.prototype.msMouseUpProxy=function(t){this.mouseMode&&this.mouseup(t)},e.ChartEngine.prototype.iosMouseMoveProxy=function(t){this.touching||this.mousemove(t)},e.ChartEngine.prototype.iosMouseDownProxy=function(t){this.touching?this.mouseMode=!1:(this.mouseMode=!0,this.mousedown(t))},e.ChartEngine.prototype.iosMouseUpProxy=function(t){this.touching||this.mouseup(t)},e.ChartEngine.prototype.rawWatermark=function(t,e,i,a){this.canvasFont("stx_watermark",t),t.fillStyle=this.defaultColor,t.globalAlpha=.5,this.chart.context.textBaseline="alphabetic",t.fillText(a,e,i),t.globalAlpha=1},e.ChartEngine.prototype.watermark=function(t,e){e&&"object"!=_typeof(e)&&(e={h:arguments[1],v:arguments[2],text:arguments[3]}),e={h:e.h||"left",v:e.v||"bottom",text:e.text||"",hOffset:e.hOffset||10,vOffset:e.vOffset||20};var i=this.chart.context;if(i){var a=this.panels[t];if(a&&!a.hidden){var r=a.yAxis.bottom-e.vOffset;"top"==e.v?r=a.top+e.vOffset:"middle"==e.v&&(r=(a.top+a.yAxis.bottom)/2),i.save(),this.canvasFont("stx_watermark"),this.canvasColor("stx_watermark"),i.textBaseline="alphabetic";var s=a.left+e.hOffset;"right"==e.h?s=a.right-e.hOffset:"center"==e.h&&(s=(a.right+a.left-i.measureText(e.text).width)/2),i.globalAlpha=.5,this.highlightedDraggable&&(i.globalAlpha*=.3),i.fillText(e.text,s,r),i.restore()}}},e.ChartEngine.prototype.preAdjustScroll=function(t){t||(t=this.chart),this.previousAdjust={chart:t,scroll:t.scroll,maxTicks:t.maxTicks}},e.ChartEngine.prototype.postAdjustScroll=function(){if(this.previousAdjust){var t=this.previousAdjust.chart;t.scroll=this.previousAdjust.scroll+(t.maxTicks-this.previousAdjust.maxTicks),this.displayInitialized&&this.draw()}},e.ChartEngine.prototype.adjustDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++){var e=this.drawingObjects[t];this.panels[e.panelName]&&e.adjust()}},e.ChartEngine.prototype.getNextInterval=function(t,e,i){e||(e=1),!1!==i&&(i=!0);var a=this.standardMarketIterator(t,i?this.dataZone:this.displayZone);return e<1?a.previous(-1*e):a.next(e)},e.ChartEngine.prototype.standardMarketIterator=function(t,e,i){var a=i||this.chart,r={begin:t,interval:this.layout.interval,periodicity:"tick"==this.layout.interval?this.chart.xAxis.futureTicksInterval:this.layout.periodicity,timeUnit:this.layout.timeUnit,outZone:e};return a.market.newIterator(r)},e.ChartEngine.prototype.zoomSet=function(t,i){e.clearCanvas(this.chart.tempCanvas,this);var a=this.mainSeriesRenderer||{};if(!a.params||!a.params.volume){var r;r=this.preferences.zoomAtCurrentMousePosition&&this.zoomInitiatedByMouseWheel&&this.crosshairTick<i.dataSet.length?this.crosshairTick||this.tickFromPixel(this.cx,i):this.isHome()?i.dataSet.length-1:this.chart.scroll>this.chart.dataSet.length?0:"zoom-x"==this.grabMode?this.tickFromPixel(this.chart.width,i):this.tickFromPixel(this.chart.width/2,i),this.animations.zoom.hasCompleted&&(this.zoomInitiatedByMouseWheel=!1);var s=i.dataSet.length-1-r,n=i.scroll;i.scroll=Math.floor((this.pixelFromTick(r,i)-i.left)/t)+1+s,this.micropixels+=(n-s)*this.layout.candleWidth-(i.scroll-s)*t}this.setCandleWidth(t),i.spanLock=!1,this.draw(),this.doDisplayCrosshairs(),this.updateChartAccessories()},e.ChartEngine.prototype.zoomOut=function(t,i){if(!this.runPrepend("zoomOut",arguments)){this.preferences.zoomOutSpeed?i=this.preferences.zoomOutSpeed:i||(i=1.3),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var a=this;for(var r in this.charts){var s=this.charts[r];if(e.ipad&&s.maxTicks>e.ChartEngine.ipadMaxTicks)return;var n=Math.floor(s.maxTicks*i);!1===s.allowScrollFuture&&!1===s.allowScrollPast&&n>s.dataSet.length&&(n=s.dataSet.length);var o=this.chart.width/n;o<this.minimumCandleWidth&&(o=this.minimumCandleWidth),this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(l(s),this.layout.candleWidth,o)}}function l(t){return function(e){if(a.zoomSet(e,t),a.animations.zoom.hasCompleted){if(a.runAppend("zoomOut",arguments))return;a.changeOccurred("layout"),a.continuousZoom&&a.continuousZoom.execute(!0)}}}},e.ChartEngine.prototype.mouseWheel=function(t){if(!this.runPrepend("mouseWheel",arguments)){t||(t=event),t.preventDefault&&t.preventDefault();var i=t.deltaX,a=t.deltaY;if(Math.abs(a)>Math.abs(i)?i=0:a=0,this.lastMouseWheelEvent=Date.now(),0!==Math.abs(i)||0!==Math.abs(a)){if(this.allowSideswipe&&0!==i){this.lastMove="horizontal";var r=i;return r>50&&(r=50),r<-50&&(r=-50),this.grabbingScreen=!0,this.currentPanel||(this.currentPanel=this.chart.panel),this.grabStartX=e.ChartEngine.crosshairX,this.grabStartY=e.ChartEngine.crosshairY,this.grabStartScrollX=this.chart.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartMicropixels=this.micropixels,this.grabStartPanel=this.currentPanel,this.mousemoveinner(e.ChartEngine.crosshairX-r,e.ChartEngine.crosshairY),this.updateChartAccessories(),void(this.grabbingScreen=!1)}if(this.lastMove="vertical",this.allowZoom&&this.displayInitialized){a||("onmousewheel"==e.wheelEvent?(a=-.025*t.wheelDelta,t.wheelDeltaX&&(i=-.025*t.wheelDeltaX)):a=t.detail),void 0===t.deltaMode&&(t.deltaMode="MozMousePixelScroll"==t.type?0:1);var s=-a;1==t.deltaMode&&(s*=33);var n=null,o=null;if(this.mouseWheelAcceleration){var l=Math.max(Math.pow(Math.abs(s),.3),1);n=1-.1*l,o=1+.2*l}if(this.zoomInitiatedByMouseWheel=!0,s>0?this.reverseMouseWheel?this.zoomOut(null,o):this.zoomIn(null,n):s<0&&(this.reverseMouseWheel?this.zoomIn(null,n):this.zoomOut(null,o)),!this.runAppend("mouseWheel",arguments))return!1}}}},e.ChartEngine.prototype.zoomIn=function(t,e){if(!this.runPrepend("zoomIn",arguments)){this.preferences.zoomInSpeed?e=this.preferences.zoomInSpeed:e||(e=.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a],s=Math.floor(r.maxTicks*e);r.maxTicks-s<1&&(s=r.maxTicks-1),s<this.minimumZoomTicks&&(s=this.minimumZoomTicks);var n=this.chart.width/s;this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,n)}}function o(t){return function(e){if(i.zoomSet(e,t),i.animations.zoom.hasCompleted){if(i.runAppend("zoomIn",arguments))return;i.changeOccurred("layout"),i.continuousZoom&&i.continuousZoom.execute()}}}},e.ChartEngine.prototype.translateIf=function(t){return this.translationCallback?this.translationCallback(t):t},e.ChartEngine.prototype.setTimeZone=function(t,e){if(void 0!==a){var i=new Date,r=i.getTimezoneOffset(),s=r,n=r;for(var o in t&&(this.dataZone=t),this.dataZone&&(s=new a.Date(i,this.dataZone).getTimezoneOffset()),e&&(this.displayZone=e),this.displayZone&&(n=new a.Date(i,this.displayZone).getTimezoneOffset()),this.timeZoneOffset=s-r-(n-r),this.charts){var l=this.charts[o];this.setDisplayDates(l.masterData)}this.preferences.timeZone=e,this.changeOccurred("preferences"),this.createDataSet()}else this.timeZoneOffset=0},e.ChartEngine.prototype.setLocale=function(t,i){if("undefined"!=typeof Intl&&this.locale!=t){this.locale=t;var a,r=this.internationalizer={};for(r.hourMinute=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",hour12:!1}),r.hourMinuteSecond=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),r.mdhm=new Intl.DateTimeFormat(this.locale,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r.monthDay=new Intl.DateTimeFormat(this.locale,{month:"numeric",day:"numeric"}),r.yearMonthDay=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric",day:"numeric"}),r.yearMonth=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric"}),r.month=new Intl.DateTimeFormat(this.locale,{month:"short"}),r.numbers=new Intl.NumberFormat(this.locale),r.priceFormatters=[],i||(i=8),a=0;a<i+1;a++)r.priceFormatters.push(new Intl.NumberFormat(this.locale,{maximumFractionDigits:a,minimumFractionDigits:a}));for(a=0;a<5;a++){var s=a,n=a;a||(s="",n=2),r["percent"+s]=new Intl.NumberFormat(this.locale,{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n})}e.I18N.createMonthArrays&&e.I18N.createMonthArrays(this,r.month,this.locale)}},e.ChartEngine.prototype.importLayout=function(t,i){if(t){var a=this,r=[];"object"!==_typeof(i)&&(i={managePeriodicity:arguments[1],preserveTicksAndCandleWidth:arguments[2]});var s=this.layout,n=e.shallowClone(s),o=i.managePeriodicity,l=i.cb,h=i.seriesCB,c=i.noDataLoad,u=this.minimumCandleWidth,p=i.preserveTicksAndCandleWidth,d=this.exportDrawings();if(this.abortDrawings(),this.currentlyImporting=!0,e.Studies)for(var m in s.studies){var g=s.studies[m];e.Studies.removeStudy(this,g)}this.overlays={};var f=e.shallowClone(this.panels);this.panels={};var y=e.clone(t);e.dataBindSafeAssignment(s,e.clone(y)),s.periodicity=n.periodicity,s.interval=n.interval,s.timeUnit=n.timeUnit,s.setSpan=n.setSpan,s.range=n.range,p?s.candleWidth=n.candleWidth:s.candleWidth||(s.candleWidth=8),s.candleWidth<u&&(s.candleWidth=u),this.setCandleWidth(s.candleWidth),s.flipped&&this.flipChart(s.flipped);var v,x,b,S=y.panels,C=function(t,e){return t.index<e.index?-1:1};for(v in S)"index"in S[v]||(C=null),(x=S[v]).name=v,r.push(x);s.panels={};var w=null;if(r.length>0){C&&r.sort(C);for(var T=0;T<r.length;++T)b=(x=r[T]).yAxis?new e.ChartEngine.YAxis(x.yAxis):null,this.stackPanel(x.display,x.name,x.percent,x.chartName,b),x.soloing&&(w=this.panels[x.name])}for(var k in e.isEmpty(S)&&this.stackPanel("chart","chart",1,"chart"),this.resizeCanvas(),f){var D=f[k],M=this.panels[k];if(M){this.container.removeChild(M.holder),D.handle&&this.container.removeChild(D.handle);var A={holder:!0,subholder:!0,display:!0,icons:!0};for(var F in A)M[F]=D[F];this.configurePanelControls(M),D.chart.panel==D&&(D.chart.panel=M)}else this.privateDeletePanel(D)}if(this.chart.panel=this.panels.chart,z(this.panels),e.Studies){var P=e.clone(s.studies);for(var _ in delete s.studies,P){var E=P[_];e.Studies.addStudy(this,E.type,E.inputs,E.outputs,E.parameters,E.panel)}}if(this.extendedHours&&this.extendedHours.prepare(s.extended,s.marketSessions),void 0===s.chartType&&(s.chartType="line"),this.setMainSeriesRenderer(),w&&this.panelSolo(w),this.adjustPanelPositions(),z(this.panels),this.storePanels(),!c){if(y.symbols&&y.symbols.length){var L={chart:this.chart};!p&&o&&y.range&&Object.keys(y.range).length?L.range=y.range:!p&&o&&y.setSpan&&Object.keys(y.setSpan).length?L.span=y.setSpan:o&&y.interval?L.periodicity={interval:y.interval,period:y.periodicity,timeUnit:y.timeUnit}:L.periodicity={interval:n.interval,period:n.periodicity,timeUnit:n.timeUnit};var N=y.symbols[0].symbolObject||y.symbols[0].symbol;return void this.loadChart(N,L,function(t){if(!t){for(var i,r=1;r<y.symbols.length;++r){(i=y.symbols[r]).parameters||(i.parameters={});var s=e.clone(i.parameters);a.addSeries(i.id,s,j)}y.chartScale&&a.setChartScale(y.chartScale)}B(),l&&l.apply(null,arguments)})}if(o){if(!p){var R=y.range;if(R&&Object.keys(R).length&&this.chart.symbol)return void this.setRange(R,function(){B(),l&&l()});if(y.setSpan&&Object.keys(y.setSpan).length&&this.chart.symbol)return void this.setSpan(y.setSpan,function(){B(),l&&l()})}var O=y.interval,I=y.periodicity,H=y.timeUnit;return isNaN(I)&&(I=1),O||(O="day"),void this.setPeriodicity({period:I,interval:O,timeUnit:H},function(){B(),l&&l()})}}o&&(s.periodicity=y.periodicity,s.interval=y.interval,s.timeUnit=y.timeUnit,s.setSpan=y.setSpan),this.createDataSet(),p||this.home(),B(),l&&l()}else i.cb&&i.cb();function z(t){function e(t){return!!t}function i(i,a){if(i[a]&&i[a].length){var r=t[i.name];if(r){for(var s=r[a],n=new Array(s.length),o=0;o<s.length;o++){var l=i[a].indexOf(s[o].name);l>-1?n[l]=s[o]:n.push(s[o])}n.length&&(r[a]=n.filter(e))}}}for(var s=0;s<r.length;s++){var n=r[s];i(n,"yaxisLHS"),i(n,"yaxisRHS")}a.chart.yAxis=a.chart.panel.yAxis}function B(){var t,e;function i(){a.createDataSet(),z(a.panels),a.calculateYAxisPositions(),a.draw()}a.importDrawings(d),a.currentlyImporting=!1;var r=[];for(var s in a.chart.series)"study"==(e=a.chart.series[s]).parameters.bucket&&(t=!0,a.removeSeries(e),r.push(e));for(var n=0;n<r.length;n++)e=r[n],a.addSeries(e.id,e.parameters,i);t||a.draw(),a.updateListeners("layout")}function j(){a.calculateYAxisPositions(),z(a.panels),h&&h()}},e.ChartEngine.prototype.exportLayout=function(t){var i={};for(var a in this.layout)"studies"!=a&&"panels"!=a?i[a]=e.clone(this.layout[a]):"studies"==a?i.studies={}:"panels"==a&&(i.panels={});function r(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].name);return e}var s=0;for(var n in this.panels){var o=i.panels[n]={},l=this.panels[n];o.percent=l.percent,o.display=l.display,o.chartName=l.chart.name,o.soloing=l.soloing,o.index=s++,o.yAxis={name:l.yAxis.name,position:l.yAxis.position},l.yaxisLHS&&(o.yaxisLHS=r(l.yaxisLHS)),l.yaxisRHS&&(o.yaxisRHS=r(l.yaxisRHS))}for(var h in this.layout.studies){var c=i.studies[h]={},u=this.layout.studies[h];c.type=u.type,c.inputs=e.clone(u.inputs),c.outputs=e.clone(u.outputs),c.panel=u.panel,c.parameters=e.clone(u.parameters)}return t?i.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0}):delete i.symbols,i},e.ChartEngine.prototype.doCleanupDates=function(t,i){if(t&&t.length)for(var r=0;r<t.length;r++){var s=t[r],n=s.DT;if(n||s.Date){if(s.DT&&"[object String]"==Object.prototype.toString.call(n)&&n.length<=10)(n=new Date(n)).setMinutes(n.getMinutes()+n.getTimezoneOffset());else{var o=!0;if(s.DT||(n=e.strToDateTime(s.Date),s.Date.length<=10&&(o=!1)),"[object Date]"!=Object.prototype.toString.call(n)&&(n=new Date(n)),this.dataZone&&o){var l=new a.Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),this.dataZone),h=1e3*n.getSeconds()+n.getMilliseconds();n=new Date(l.getTime()+h)}e.ChartEngine.isDailyInterval(i)&&n.setHours(0,0,0,0)}s.DT||(s.Date=e.yyyymmddhhmmssmmm(n)),s.DT=n}}},e.ChartEngine.prototype.doCleanupGaps=function(t,i,a){if(!t||!t.length)return t;var r=this.layout.interval;a=a||{},i||(i=this.chart),a.noCleanupDates||this.doCleanupDates(t,r);var s=a.cleanupGaps;if(!1===s)return t;s&&!0!==s||(s=this.cleanupGaps||s);var n="gap"==s;if(!s)return t;if("tick"==r)return t;if("month"==r||"week"==r){if(this.dontRoll)return t;r="day"}var o=function(t){return t.DT?"[object Date]"!=Object.prototype.toString.call(t.DT)?new Date(t.DT):new Date(+t.DT):e.strToDateTime(t.Date)},l=[],h=t[0];l.push(h);var c={begin:o(h),interval:r,periodicity:1,timeUnit:this.layout.timeUnit},u=new e.Market(i.market.market_def).newIterator(c);this.extendedHours&&this.extendedHours.filter&&u.market.enableAllAvailableSessions();for(var p,d=i.defaultPlotField,m=0;m<t.length&&void 0===t[m][d];m++)if(void 0!==t[m].Value){d="Value";break}function g(t,i){var r=a.field,s=r?h[r]:h;void 0===s&&(s={});for(var o=n?null:s[d],c=n?null:s.Adj_Close;+t<+i;){var p={DT:t};r||(l.push(p),e.extend(p,{Open:o,High:o,Low:o,Close:o,Volume:0,Adj_Close:c})),t=u.next()}}function f(t,i){var r=a.field;if(r)void 0!==t[r]&&void 0===i[r]&&(i[r]=n?null:t[r]);else if(!n){var s=t[d],o=i[d];void 0!==s&&void 0===o&&e.ensureDefaults(i,{Close:s,Open:s,High:s,Low:s,Volume:0,Adj_Close:t.Adj_Close})}}for(var y=1;y<t.length;y++){var v=t[y];p=u.next();var x=o(v);for(g(p,x),p=u.begin;x<p;){if(++y==t.length)return l;f(h,v),l.push(v),h=v,x=o(v=t[y])}p<x?(y--,p=u.previous()):(f(h,v),l.push(v),h=v)}return l},e.Comparison=function(){},e.Comparison.initialPrice=100,e.Comparison.getInitialPrice=function(t){if(t.initialComparisonPrice)return t.initialComparisonPrice;t.initialComparisonPrice=100;var i=e.Comparison.initialPrice;if("number"==typeof i&&(t.initialComparisonPrice=i),"string"==typeof i&&(t.series[i]||""===i)){var a="Close";t.defaultPlotField&&(t.highLowBars||(a=t.defaultPlotField));for(var r=t.dataSet.length-t.scroll;r<t.dataSet.length;r++){var s=t.dataSet[r];if(s){if(s[i]&&s[i][a]){t.initialComparisonPrice=s[i][a];break}if(""===i&&s[a]){t.initialComparisonPrice=s[a];break}}}}return t.initialComparisonPrice},e.Comparison.priceToPercent=function(t,i,a){var r=e.Comparison.baseline||a;return Math.round((a-r)/r*100*1e4)/1e4},e.Comparison.percentToPrice=function(t,i,a){return(e.Comparison.baseline||1)*(1+a/100)},e.Comparison.priceToRelative=function(t,i,a){var r=e.Comparison.baseline||a;return e.Comparison.getInitialPrice(i)*a/r},e.Comparison.relativeToPrice=function(t,i,a){return(e.Comparison.baseline||1)*a/e.Comparison.getInitialPrice(i)},e.Comparison.createComparisonSegmentInner=function(t,i){var a,r,s,n=[];for(a in i.series){var o=i.series[a].parameters;o.isComparison&&n.push(o.symbol)}var l=["Close","Open","High","Low","iqPrevClose"],h=t.chart.highLowBars||t.highLowBars[t.layout.chartType];i.defaultPlotField&&!h&&l.unshift(i.defaultPlotField);var c=l[0],u=t.layout.studies;if(u)for(var p in u){var d=u[p];if(r=t.panels[d.panel],s=d.getYAxis(t),r&&r.yAxis==s){for(a in d.outputMap)l.push(a);for(var m=0;m<=2;m++)l.push(d.name+"_hist"+(m||""));d.referenceOutput&&l.push(d.referenceOutput+" "+d.name)}}for(var g in t.plugins){var f=t.plugins[g];if(f.transformOutputs)for(a in f.transformOutputs)l.push(a)}i.initialComparisonPrice=null,i.dataSegment=[];for(var y=null,v=i.dataSet.length-i.scroll-1,x=i.maxTicks+3,b=0;b<=x;b++){b==x&&(b=-1);var S=v+b;if(S<i.dataSet.length&&S>=0){var C,w=i.dataSet[S],T=w[c];if(!y){if(0===T||null===T){if(b<0)break;continue}y=e.clone(w)}for(w.transform||(w.transform={cache:{},DT:w.DT,Date:w.Date}),!e.Comparison.baseline&&T&&(y=e.clone(w)),e.Comparison.baseline=y[c],C=0;C<l.length;C++)(w[a=l[C]]||0===w[a])&&(w.transform[a]=i.transformFunc(t,i,w[a]));for(C=0;C<n.length;C++){a=n[C];var k=i.series[a];if(-1==b&&k&&k.parameters.isComparison)delete w.transform[a];else for(var D=w[a],M=0;D&&M<l.length;M++){var A=D[l[M]];if(A||0===A){var F=y[a]&&y[a][l[0]];if(F||0===F||(y[a]||(y[a]={}),y[a][l[M]]=F=A*e.Comparison.baseline/w[c]),0!==F){var P=A*((e.Comparison.baseline||1)/F);w.transform[a]||(w.transform[a]={}),w.transform[a][l[M]]=i.transformFunc(t,i,P)}}}}i.dataSegment.push(w)}else S<0&&i.dataSegment.push(null);if(b<0)break}},e.Comparison.priceFormat=function(t,e,i){if(null==i||isNaN(i))return"";var a=e.yAxis.priceTick,r=t.internationalizer;return i=r?a>=5?r.percent.format(i/100):a>=.5?r.percent1.format(i/100):a>=.05?r.percent2.format(i/100):a>=.005?r.percent3.format(i/100):r.percent4.format(i/100):a>=5?i.toFixed(0)+"%":a>=.5?i.toFixed(1)+"%":a>=.05?i.toFixed(2)+"%":a>=.005?i.toFixed(3)+"%":i.toFixed(4)+"%",0===parseFloat(i)&&"-"==i.charAt(0)&&(i=i.substring(1)),i},e.ChartEngine.prototype.setComparison=function(t,i,a){if(i||(i=this.chart),"string"==typeof i&&(i=this.charts[i]),(a||""===a)&&(e.Comparison.initialPrice=a),!0===t){if(i.isComparison)return;t="percent"}this.resetDynamicYAxis();var r=i.panel.yAxis,s=r.priceFormatter==e.Comparison.priceFormat;switch(t){case"relative":this.setTransform(i,e.Comparison.priceToRelative,e.Comparison.relativeToPrice),s&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSegment",i.isComparison=!0;break;case"percent":this.setTransform(i,e.Comparison.priceToPercent,e.Comparison.percentToPrice),s||(r.originalPriceFormatter={func:r.priceFormatter},r.priceFormatter=e.Comparison.priceFormat),r.whichSet="dataSegment",i.isComparison=!0;break;default:this.unsetTransform(i),s&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSet",i.isComparison=!1}},e.ChartEngine.prototype.importPreferences=function(t){e.extend(this.preferences,t),t.timeZone&&this.setTimeZone(this.dataZone,t.timeZone),t.language&&e.I18N&&e.I18N.localize(this,t.language),this.changeOccurred("preferences")},e.ChartEngine.prototype.exportPreferences=function(){return this.preferences},"undefined"!=typeof document&&document.addEventListener("contextmenu",e.ChartEngine.handleContextMenu),t},__js_core_market_=function(t){t||(t={});var e=t.CIQ,i=t.timezoneJS;e||(e=function(){},t.CIQ=e);e.Market=function(t){this.market_def=!1,this.rules=!1,this.normalHours=[],this.extraHours=[],this.class_name="Market",this.tz_lib=void 0===i?Date:i.Date,this.market_tz="",this.hour_aligned=!1,this.convertOnDaily=!1,this.enabled_by_default=!1,void 0!==t&&t&&!e.isEmpty(t)&&(t.market_definition&&(t=t.market_definition),t.rules&&(this.rules=t.rules),t.market_tz&&(this.market_tz=t.market_tz),t.convertOnDaily&&(this.convertOnDaily=t.convertOnDaily),_typeof(t.hour_aligned)&&(this.hour_aligned=t.hour_aligned),void 0!==t.enabled_by_default&&t.enabled_by_default instanceof Array&&(this.enabled_by_default=t.enabled_by_default),this.market_def=t,void 0===this.market_def.name&&(this.market_def.name="no market name specified"),e.Market._createTimeSegments(this),this.getSessionNames())},e.Market.prototype.sessions=null,e.Market.Symbology=function(){},e.Market.Symbology.isForeignSymbol=function(t){return!1},e.Market.Symbology.isFuturesSymbol=function(t){return!1},e.Market.Symbology.isForexSymbol=function(t){return!1},e.Market.Symbology.isForexMetal=function(t,e){return!1},e.Market.Symbology.isForexFuturesSymbol=function(t){return!!e.Market.Symbology.isForexSymbol(t)||!!e.Market.Symbology.isFuturesSymbol(t)},e.Market.Symbology.factory=function(t){return null},e.Market.prototype.getSessionNames=function(){if(this.rules){if(!this.sessions){var t=[],e=[];this.rules.map(function(i){i.name&&-1===t.indexOf(i.name)&&(t.push(i.name),e.push({name:i.name,enabled:!!i.enabled&&i.enabled}))}),this.sessions=e}}else this.sessions=[];return this.sessions.slice()},e.Market.prototype._find_next_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz});if(this._wasOpenIntraDay(i)){var r=this.zseg_match.close_parts.hours,s=this.zseg_match.close_parts.minutes;i.setHours(r),i.setMinutes(s),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})}return a.next()},e.Market.prototype._find_prev_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),r=this._wasOpenIntraDay(i);if(null===r?(i=new Date(i-6e4),r=this._wasOpenIntraDay(i)):(e&&i.getHours()===this.zseg_match.open_parts.hours&&i.getMinutes()===this.zseg_match.open_parts.minutes||!e&&i.getHours()===this.zseg_match.close_parts.hours&&i.getMinutes()===this.zseg_match.close_parts.minutes)&&(i=a.previous()),r){var s=this.zseg_match.open_parts.hours,n=this.zseg_match.open_parts.minutes;return i.setHours(s),i.setMinutes(n),i=(a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})).previous(),this.zseg_match.close_parts.hours===s&&this.zseg_match.close_parts.minutes===n?e?a.next():i:this.zseg_match.adjacent_child?i:e?a.next():i}return a.previous()},e.Market.prototype.disableSession=function(t,e){var i=!1;if(void 0!==e&&e&&(i=!0),t){for(var a=0;a<this.normalHours.length;a++)this.normalHours[a].name===t&&(this.normalHours[a].enabled=i);for(a=0;a<this.extraHours.length;a++)this.extraHours[a].name===t&&(this.extraHours[a].enabled=i)}},e.Market.prototype.enableSession=function(t){this.disableSession(t,"enable_instead")},e.Market.prototype.enableAllAvailableSessions=function(){for(var t=this.getSessionNames(),e=0;e<t.length;e++)this.enableSession(t[e].name)},e.Market.prototype.getClose=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name===e)return r.setHours(this.zseg_match.close_parts.hours,this.zseg_match.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var s=this.zseg_match;s.child_;)s=s.child_;for(;!s.enabled;)s=s.parent_;return r.setHours(s.close_parts.hours,s.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getNextClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;(t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),this._wasOpenIntraDay(a))||(a=this.newIterator({begin:a,interval:1,inZone:this.market_tz,outZone:this.market_tz}).next());for(var r=a.getDate(),s=this.zseg_match;s.adjacent_child;)s=s.adjacent_child,r+=1;return a.setDate(r),a.setHours(s.close_parts.hours,s.close_parts.minutes,0,0),a=this._convertFromMarketTZ(a,i)},e.Market.prototype.getNextOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_next_segment(a),this.zseg_match.adjacent_parent?(a=this.getNextOpen(a,this.market_tz,this.market_tz),a=this._convertFromMarketTZ(a,i)):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getOpen=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name==e)return r.setHours(this.zseg_match.open_parts.hours,this.zseg_match.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var s=this.zseg_match;s.parent_;)s=s.parent_;for(;!s.enabled;)s=s.child_;return r.setHours(s.open_parts.hours,s.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getPreviousClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!1),this.zseg_match.adjacent_child?this.getPreviousClose(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.close_parts.hours),a.setMinutes(this.zseg_match.close_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getPreviousOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!0),this.zseg_match.adjacent_parent?this.getPreviousOpen(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getSession=function(t,e){return t=this._convertToMarketTZ(t,e),this._wasOpenIntraDay(t)&&this.zseg_match?this.zseg_match.name:null},e.Market.prototype.marketZoneNow=function(){return this._convertToMarketTZ(new Date)},e.Market.prototype.isHourAligned=function(){return this.hour_aligned},e.Market.prototype.isOpen=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenIntraDay(t)},e.Market.prototype.isMarketDay=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenDaily(t)},e.Market.prototype.isMarketDate=function(t){return this._wasOpenDaily(t)},e.Market.prototype.newIterator=function(t){var i=!1;t.periodicity?i=t.periodicity:t.multiple&&(i=t.multiple);var a=t.interval;return a||(a="minute"),"hour"==a&&(a=60),i||(i=1),t.begin||(t.begin=new Date,t.inZone=null),a==parseInt(a,10)&&(a=parseInt(a,10),t.periodicity<1/60?(i=i*a*6e4,a="millisecond"):t.periodicity<1?(i=i*a*60,a="second"):(i*=a,a="minute")),t.timeUnit&&("millisecond"===t.timeUnit?a=t.timeUnit:"second"===t.timeUnit?a=t.timeUnit:"tick"===t.timeUnit&&(a="second")),"tick"==a&&(a="second"),t.interval=a,t.multiple=i,t.market=this,new e.Market.Iterator(t)},e.Market.prototype._wasOpenDaily=function(t){return this._was_open(t,!1)},e.Market.prototype._wasOpenIntraDay=function(t){return this._was_open(t,!0)},e.Market.prototype._was_open=function(t,e){var i=this.zseg_match;if(this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null,!this.market_def||!this.rules)return this.zclose_hour=24,!0;var a,r,s=!1,n=!1,o=t.getFullYear(),l=t.getMonth()+1,h=t.getDay(),c=t.getDate(),u=60*t.getHours()*60+60*t.getMinutes()+t.getSeconds();for(void 0===e&&(e=!0),r=0;r<this.normalHours.length;r++)if((a=this.normalHours[r]).enabled&&((s=a.dayofweek===h)&&e&&(s=u>=a.open&&u<a.close),s)){if(!e&&this.zseg_match&&(a.open_parts.hours>this.zopen_hour||a.open_parts.hours==this.zopen_hour&&a.open_parts.minutes>this.zopen_minute))continue;if(a===i||a.adjacent_parent||a.adjacent_child||(this.shouldResetToBeginningOfSegment=!0),this.zopen_hour=a.open_parts.hours,this.zopen_minute=a.open_parts.minutes,this.zclose_hour=a.close_parts.hours,this.zclose_minute=a.close_parts.minutes,this.zmatch_open=u===a.open,this.zseg_match=a,e)break}for(r=0;r<this.extraHours.length;r++)if((a=this.extraHours[r]).enabled&&("*"===a.year||o===a.year)&&l===a.month&&c===a.day&&(!(n=!e&&a.open||u>=a.open&&u<a.close)&&this.zseg_match&&(s=!1,this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null),n)){if(!e&&this.zseg_match&&(a.open_parts.hours>this.zopen_hour||a.open_parts.hours==this.zopen_hour&&a.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=a.open_parts.hours,this.zopen_minute=a.open_parts.minutes,this.zclose_hour=a.close_parts.hours,this.zclose_minute=a.close_parts.minutes,this.zmatch_open=u===a.open,this.zseg_match=a,e)break}return this.zseg_match},e.Market.prototype._wasClosed=function(t){return!this._was_open(t,!0)},e.Market.prototype._wasOpen=function(t){return this._was_open(t,!0)},e.Market.prototype._tzDifferenceMillis=function(t,e,i){var a=t;return 60*(t.getTimezoneOffset()-a.getTimezoneOffset())*1e3},e.Market._createTimeSegments=function(t){for(var e,i=function(t,i){if(24===t.close_parts.hours&&0===i.open_parts.hours&&0===i.open_parts.minutes){if(e.dayofweek===n.dayofweek-1)return!0;if(6===e.dayofweek&&0===n.dayofweek)return!0}return!1},r=0;r<t.rules.length;r++){var s=JSON.parse(JSON.stringify(t.rules[r]));void 0===s.open&&void 0===s.close&&(s.open="00:00",s.close="00:00"),s.hasOwnProperty("name")||(s.name="");try{var n;if(void 0!==s.dayofweek?(s.year="*",n=a._createDayOfWeekSegment(t,s),e&&(e.dayofweek===n.dayofweek?(e.child_=n,n.parent_=e):i(e,n)&&(e.adjacent_child=n,n.adjacent_parent=e)),e=n):void 0!==s.date?(s.isDayOfWeek=!1,s.dayofweek=-1,n=a._createDateTimeSegment(t,s)):console.log("Error, unknown rule type "+s),t.enabled_by_default)for(var o=0;o<t.enabled_by_default.length;o++){var l=t.enabled_by_default[o];if(n.name===l){n.enabled=!0;break}}}catch(t){console.log("Error, creating market rules "+t)}}},e.Market._timeSegment={};var a=e.Market._timeSegment;a.re_wild_card_iso=/^(\*)-(\d\d)-(\d\d)$/,a.re_regular_iso=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a.re_split_hours_minutes=/^(\d\d):(\d\d)$/,a.re_split_hour_minutes=/^(\d):(\d\d)$/,a._hashCode=function(t){var e,i,a=0;if(0===t.length)return a;for(e=0,i=t.length;e<i;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return a},a._splitHoursMinutes=function(t){var e=a.re_split_hour_minutes.exec(t),i={hours:NaN,minutes:NaN};return null===e&&null===(e=a.re_split_hours_minutes.exec(t))?i:(i.hours=parseInt(e[1],10),i.minutes=parseInt(e[2],10),i)},a._createDayOfWeekSegment=function(t,e){var i={name:e.name,isDayOfWeek:!0,dayofweek:e.dayofweek,date_str:"*",open_parts:a._splitHoursMinutes(e.open),close_parts:a._splitHoursMinutes(e.close),open:a._secSinceMidnight(t,e.open,!0),close:a._secSinceMidnight(t,e.close,!1),child_:!1,parent_:!1,adjacent_child:!1,adjacent_parent:!1,enabled:!1};return""===i.name&&(i.enabled=!0),i.hash_code=this._hashCode((i.open+i.close).toString()),t.normalHours.push(i),i},a._createDateTimeSegment=function(t,e){var i,r=this.re_regular_iso.exec(e.date);if(null===r){if(null===(r=this.re_wild_card_iso.exec(e.date)))return void console.log("Warning: invalid date format on rule -> "+e.date);i="*"}else i=parseInt(r[1],10);var s={name:e.name,isDayOfWeek:!1,dayofweek:-1,year:i,month:parseInt(r[2],10),day:parseInt(r[3],10),date_str:e.date,open_parts:a._splitHoursMinutes(e.open),close_parts:a._splitHoursMinutes(e.close),open:a._secSinceMidnight(t,e.open,!0),close:a._secSinceMidnight(t,e.close,!1),enabled:!1};return""===s.name&&(s.enabled=!0),s.hash_key=this._hashCode(s.date_str+s.open+s.close),t.extraHours.push(s),s},a._secSinceMidnight=function(t,e,i){var a=e.split(":"),r=parseInt(a[0],10),s=60*r*60+60*parseInt(a[1],10);return i||24===r&&(s=60*r*60+1),s},e.Market.prototype._convertToMarketTZ=function(t,e){var i;return(i=e?new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e):new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())).setTimezone&&i.setTimezone(this.market_tz),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())},e.Market.prototype._convertFromMarketTZ=function(t,e){var i=new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),this.market_tz);return e?(i.setTimezone&&i.setTimezone(e),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):new Date(i.getTime())},e.Market.Iterator=function(t){this.market=t.market,this.begin=t.begin,this.interval=t.interval,this.multiple=t.multiple,this.inZone=t.inZone,this.outZone=t.outZone,this.clock=new e.Market.Iterator._Clock(t.market,t.interval,t.multiple),this.intraDay=this.clock.intra_day,this.intraDay&&(this.begin=this.market._convertToMarketTZ(this.begin,t.inZone)),this.clock._setStart(this.begin),this.clock.minutes_aligned=!1},e.Market.Iterator.prototype.date=function(){return this.clock._date()},e.Market.Iterator.prototype.futureTick=function(t){this.clock.skip=1;var e,i=0;e=this.intraDay?this.market._convertToMarketTZ(t.end,this.inZone).getTime():t.end.getTime();var a=this.clock.ctime;if(e===a)return i;var r=2,s=0;t.sample_size&&(r=t.sample_size);var n,o=(new Date).getTime();if(e>a){for(this.clock.forward=!0;this.clock.ctime<e;)if(i+=1,s+=1,this.clock._findNext(),1e3===s&&(s=0,(new Date).getTime()-o>=r)){n=(this.clock.ctime-a)/i,i=Math.floor((e-a)/n);break}this.clock.ctime>e&&i--}else for(this.clock.forward=!1;this.clock.ctime>e;)if(i+=1,s+=1,this.clock._findPrevious(),1e3===s&&(s=0,(new Date).getTime()-o>=r)){n=(a-this.clock.ctime)/i,i=Math.floor((a-e)/n);break}return i},e.Market.Iterator.prototype.isHourAligned=function(){return!this.intraDay||this.market.isHourAligned()},e.Market.Iterator.prototype.isOpen=function(){return this.market.isOpen()},e.Market.Iterator.prototype.next=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!0;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findNext();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator.prototype.peek=function(){return this.clock._peek()},e.Market.Iterator.prototype.previous=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!1;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findPrevious();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator._Clock=function(t,e,i){i%60==0&&"second"===e&&(e="minute",i/=60),this.market=t,this.interval=e,this.multiple=i,this.intra_day=!1,this.intervals=[],this.max_iters=10080;var a=864e5,r=this._dayImpl;"millisecond"===e?(r=this._millisImpl,a=1):"second"===e?(r=this._secondImpl,a=1e3):"minute"===e?(r=this._minuteImpl,a=6e4):"hour"===e?(r=this._hourImpl,a=36e5):"day"===e?(r=this._dayImpl,a=864e5):"week"===e?(r=this._weekImpl,a=6048e5):"month"===e?(r=this._monthImpl,a=2592e6):console.log('Periodicity ERROR: "'+e+'" is not a valid interval. Please see setPeriodicity() for details.'),this.tick_time=a*i,this.intra_day=this.tick_time<864e5,this._findPrevious=this._findNext=r};var r=e.Market.Iterator._Clock.prototype;return r._total_minutes=function(t,e,i,a){return 60*(i-t)-e+a},r._alignMinutes=function(){if(!this.market.market_def||void 0===this.market.zopen_minute)return[];var t=this.market.zopen_minute,e=this.market.zseg_match;e&&e.adjacent_parent?t=e.adjacent_parent.open/60-1440:this.market.isHourAligned()&&this.multiple%60==0&&(t=0);for(var i=this._total_minutes(this.market.zopen_hour,t,this.market.zclose_hour,this.market.zclose_minute),a=[],r=0;r<i;)a.push(t+r),r+=this.multiple;return a},r._alignBaseZero=function(t){for(var e=0,i=[e];!((e+=this.multiple)>=t);)i.push(e);return i},r._date=function(){var t=Math.round(this.ctime),e=new Date(t);return this.intra_day?this.display_date=new Date(t+this.shift_millis):this.display_date=e,e},r._alignToBoundary=function(t,e){for(var i=0,a=0,r=e,s=0;s<t.length-1&&(i=t[s],a=t[s+1],e!==i&&e!==a);s++){if(e>i&&e<a){r=i;break}s+1===t.length-1&&(r=a)}return r},r._peek=function(){return this._date().toString()},r._seekHr=function(){this.forward?this.ctime-=36e5:this.ctime+=36e5},r._setStart=function(t){var e=this.market._tzDifferenceMillis(t),i=new Date(t.getTime()+e);this.shift_millis=e,this.ctime=i.getTime(),this.shift_millis=0,this.ctime=t.getTime()},r._tickTock=function(){this.forward?this.ctime+=this.tick_time:this.ctime-=this.tick_time},r._tockTick=function(){this.forward?this.ctime-=this.tick_time:this.ctime+=this.tick_time},r._tickTock24=function(){this.ctime+=864e5},r._tockTick24=function(){this.ctime-=864e5},r._windMaybe=function(t,e){for(var i=0,a=new Date(this.ctime),r=!1;!t.call(this.market,a);)if(e.call(this),r=!0,a=new Date(this.ctime),(i+=1)>this.max_iters){var s="Warning! max iterations ("+this.max_iters;s+=") reached with no rule match.",console.log(s);break}return r},r._millisImpl=function(){var t=!1;if(!this.mperiods_aligned){var e=this._alignBaseZero(1e3),i=new Date(this.ctime),a=i.getMilliseconds();a=this._alignToBoundary(e,a),i.setMilliseconds(0),this.ctime=i.getTime()+a,this.mperiods_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var s=this._date().getMinutes();if((t||r!=s)&&!this.market._wasOpenIntraDay(this._date())){var n=this._date().getSeconds(),o=this._date().getMilliseconds(),l=this.tick_time;this.tick_time=6e4;var h=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=l,this.multiple=h,this.ctime+=1e3*n+o}return this._date()},r._secondImpl=function(){var t=!1;if(!this.speriod_aligned){var e=this._alignBaseZero(60),i=new Date(this.ctime),a=i.getSeconds();a=this._alignToBoundary(e,a),i.setSeconds(a),i.setMilliseconds(0),this.ctime=i.getTime(),this.speriod_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var s=this._date().getMinutes();if((t||r!=s)&&!this.market._wasOpenIntraDay(this._date())){var n=this._date().getSeconds(),o=this.tick_time;this.tick_time=6e4;var l=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=o,this.multiple=l,this.ctime+=1e3*n}return this._date()},r._minuteImpl=function(){var t=this._windMaybe(this.market._wasOpenIntraDay,this._tockTick),e=new Date(this.ctime),i=e.getTimezoneOffset(),a=e.getMinutes(),r=e.getHours(),s=this._alignMinutes(),n=this._total_minutes(this.market.zopen_hour,this.market.zopen_minute,r,a)+this.market.zopen_minute;n=t?this.forward?s[s.length-1]:s[0]:this._alignToBoundary(s,n),r=Math.floor(n/60)+this.market.zopen_hour,e.setHours(r,n%60,0,0);var o=e.getTimezoneOffset()-i;(this.forward&&o<0||!this.forward&&o>0)&&e.setTime(e.getTime()-6e4*o),this.ctime=e.getTime(),this._tickTock();var l=this.market.hour_aligned&&this.multiple%60==0;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!l&&this.shouldResetToBeginningOfSegment){if(e=new Date(this.ctime),this.forward)e.setMinutes(this.market.zopen_minute),e.setHours(this.market.zopen_hour);else{var h=(s=this._alignMinutes())[s.length-1];e.setMinutes(h%60),e.setHours(Math.floor(h/60)+this.market.zopen_hour)}this.ctime=e.getTime()}return this._date()},r._hourImpl=function(){this._windMaybe(this.market._wasOpenIntraDay,this._tockTick);var t=new Date(this.ctime);this.market.isHourAligned()?t.setMinutes(0):t.setMinutes(this.market.zopen_minute),t.setSeconds(0),t.setMilliseconds(0),this.ctime=t.getTime(),this._tickTock();var e=this.market.zseg_match;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!this.market.hour_aligned&&e!=this.market.zseg_match){var i=new Date(this.ctime);if(this.forward)i.setMinutes(this.market.zopen_minute),i.setHours(this.market.zopen_hour);else{var a=this._alignMinutes(),r=a[a.length-1];i.setMinutes(r%60),i.setHours(Math.floor(r/60)+this.market.zopen_hour)}this.ctime=i.getTime()}return this._date()},r._dayImpl=function(){this._windMaybe(this.market._wasOpenDaily,this._seekHr);var t=new Date(this.ctime);t.setHours(12,0,0,0),this.ctime=t.getTime();for(var e=0;e<this.multiple;)this.forward?this._tickTock24():this._tockTick24(),this.market._wasOpenDaily(this._date())&&(e+=1);return(t=new Date(this.ctime)).setHours(0),this.ctime=t.getTime(),this._date()},r._weekImpl=function(){var t=new Date(this.ctime);for(t.setHours(12),this.ctime=t.getTime(),this._tickTock(),t=new Date(this.ctime);0!==t.getDay();)this._tockTick24(),t=new Date(this.ctime);return this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},r._monthImpl=function(){var t=new Date(this.ctime);return t.setDate(15),this.ctime=t.getTime(),this._tickTock(),(t=new Date(this.ctime)).setDate(1),t.setHours(12),this.ctime=t.getTime(),this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},r._findNext=null,r._findPrevious=null,t},__js_core_timezone_=function(t){var e=t.CIQ;e.timeZoneMap={"(UTC-11:00) American Samoa, Midway Island":"Pacific/Pago_Pago","(UTC-10:00) Hawaii":"Pacific/Honolulu","(UTC-09:00) Alaska":"America/Juneau","(UTC-08:00) Pacific Time (US and Canada), Tijuana":"America/Los_Angeles","(UTC-07:00) Arizona":"America/Phoenix","(UTC-07:00) Chihuahua, Mazatlan":"America/Chihuahua","(UTC-07:00) Mountain Time (US and Canada)":"America/Denver","(UTC-06:00) Central America":"America/Costa_Rica","(UTC-06:00) Central Time (US and Canada)":"America/Chicago","(UTC-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(UTC-06:00) Saskatchewan":"America/Regina","(UTC-05:00) Bogota, Lima, Quito, Rio Branco":"America/Bogota","(UTC-05:00) Eastern Time (US and Canada)":"America/New_York","(UTC-05:00) Havana":"America/Havana","(UTC-05:00) Port-au-Prince":"America/Port-au-Prince","(UTC-04:00) Asuncion":"America/Asuncion","(UTC-04:00) Santiago":"America/Santiago","(UTC-04:00) Caracas":"America/Caracas","(UTC-04:00) Atlantic Time (Canada)":"America/Halifax","(UTC-04:00) Georgetown, La Paz, Manaus, San Juan":"America/Puerto_Rico","(UTC-03:30) Newfoundland and Labrador":"America/St_Johns","(UTC-03:00) Cancun, Jamaica, Panama":"America/Panama","(UTC-03:00) Buenos Aires":"America/Argentina/Buenos_Aires","(UTC-03:00) Punta Arenas":"America/Punta_Arenas","(UTC-03:00) Montevideo":"America/Montevideo","(UTC-03:00) Sao Paulo":"America/Sao_Paulo","(UTC-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(UTC-01:00) Azores":"Atlantic/Azores","(UTC-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(UTC) Greenwich Mean Time, Reykjavik":"UTC","(UTC) Dublin":"Europe/Dublin","(UTC) Lisbon, London":"Europe/London","(UTC+01:00) Algiers, Tunis":"Africa/Tunis","(UTC+01:00) Casablanca":"Africa/Casablanca","(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(UTC+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(UTC+02:00) Kaliningrad":"Europe/Kaliningrad","(UTC+02:00) Athens, Bucharest":"Europe/Bucharest","(UTC+02:00) Cairo":"Africa/Cairo","(UTC+02:00) Harare, Johannesburg":"Africa/Johannesburg","(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(UTC+02:00) Cyprus":"Asia/Nicosia","(UTC+02:00) Beirut":"Asia/Beirut","(UTC+02:00) Damascus":"Asia/Damascus","(UTC+02:00) Jerusalem":"Asia/Jerusalem","(UTC+02:00) Amman":"Asia/Amman","(UTC+03:00) Istanbul":"Europe/Istanbul","(UTC+03:00) Baghdad, Kuwait, Qatar, Riyadh":"Asia/Riyadh","(UTC+03:00) Minsk, Moscow, Kirov, Volgograd":"Europe/Moscow","(UTC+03:00) Simferopol":"Europe/Simferopol","(UTC+03:00) Nairobi":"Africa/Nairobi","(UTC+03:30) Tehran":"Asia/Tehran","(UTC+04:00) Baku":"Asia/Baku","(UTC+04:00) Dubai, Muscat":"Asia/Dubai","(UTC+04:00) Astrakhan, Samara, Saratov, Ulyanovsk":"Europe/Samara","(UTC+04:30) Kabul":"Asia/Kabul","(UTC+05:00) Karachi, Tashkent":"Asia/Karachi","(UTC+05:00) Yekaterinburg":"Asia/Yekaterinburg","(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(UTC+05:45) Kathmandu":"Asia/Kathmandu","(UTC+06:00) Almaty":"Asia/Almaty","(UTC+06:00) Omsk":"Asia/Omsk","(UTC+06:00) Astana, Dhaka":"Asia/Dhaka","(UTC+06:30) Yangon":"Asia/Yangon","(UTC+07:00) Bangkok, Jakarta, Vietnam":"Asia/Bangkok","(UTC+07:00) Hovd":"Asia/Hovd","(UTC+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(UTC+07:00) Novokuznetsk":"Asia/Novokuznetsk","(UTC+07:00) Barnaul, Novosibirsk, Tomsk":"Asia/Novosibirsk","(UTC+08:00) Beijing, Chongqing, Hong Kong SAR":"Asia/Hong_Kong","(UTC+08:00) Brunei, Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(UTC+08:00) Irkutsk":"Asia/Irkutsk","(UTC+08:00) Choibalsan, Ulaanbaatar":"Asia/Ulaanbaatar","(UTC+08:00) Manila, Taipei":"Asia/Taipei","(UTC+08:00) Perth":"Australia/Perth","(UTC+08:45) Eucla":"Australia/Eucla","(UTC+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(UTC+09:00) Pyongyang":"Asia/Pyongyang","(UTC+09:00) Seoul":"Asia/Seoul","(UTC+09:00) Chita, Khandyga, Yakutsk":"Asia/Yakutsk","(UTC+09:30) Adelaide":"Australia/Adelaide","(UTC+09:30) Darwin":"Australia/Darwin","(UTC+10:00) Brisbane":"Australia/Brisbane","(UTC+10:00) Canberra, Melbourne, Sydney":"Australia/Sydney","(UTC+10:00) Guam, Port Moresby":"Pacific/Guam","(UTC+10:00) Ust-Nera, Vladivostok":"Asia/Vladivostok","(UTC+11:00) Noumea, Solomon Islands":"Pacific/Noumea","(UTC+11:00) Magadan":"Asia/Magadan","(UTC+11:00) Sakhalin, Srednekolymsk":"Asia/Srednekolymsk","(UTC+12:00) Anadyr, Kamchatka":"Asia/Kamchatka","(UTC+12:00) Auckland, Wellington":"Pacific/Auckland","(UTC+12:00) Fiji":"Pacific/Fiji","(UTC+12:45) Chatham":"Pacific/Chatham","(UTC+13:00) Tonga":"Pacific/Tongatapu","(UTC+13:00) Samoa":"Pacific/Apia","(UTC+14:00) Kiritimati":"Pacific/Kiritimati"},function(){"use strict";var i=("undefined"!=typeof window?window:null)||(void 0!==global?global:self),a=t.timezoneJS||{};t.timezoneJS=a,a.VERSION="0.4.11";for(var r=i.$||i.jQuery||i.Zepto,s=i.fleegix,n=a.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=a.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],l={},h={},c={},u=0;u<o.length;u++)l[o[u].substr(0,3)]=u;for(u=0;u<n.length;u++)h[n[u].substr(0,3)]=u;Array.prototype.indexOf;var p=function(t,e){if("number"!=typeof t)throw"not a number: "+t;var i=t>1e3,a=t.toString(),r=a.length;if(i&&r>e)return a.substr(r-e,r);for(a=[a];r<e;)a.unshift("0"),r++;return a.join("")},d=function(t){if(t){if(!t.url)throw new Error("URL must be specified");if("async"in t||(t.async=!0),!(s&&void 0!==s.xhr||r&&void 0!==r.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");return t.async?s&&s.xhr?s.xhr.send({url:t.url,method:"get",handleSuccess:t.success,handleErr:t.error}):r.ajax({url:t.url,dataType:"text",method:"GET",error:t.error,success:t.success}):s&&s.xhr?s.xhr.doReq({url:t.url,async:!1}):r.ajax({url:t.url,async:!1,dataType:"text"}).responseText}};a.ruleCache={},a.Date=function(){if(this===a)throw"timezoneJS.Date object must be constructed with 'new'";var t=Array.prototype.slice.apply(arguments),e=null,i=null,r=[],s=!1;"[object Array]"===Object.prototype.toString.call(t[0])&&(t=t[0]),"string"==typeof t[t.length-1]&&(s=Date.parse(t[t.length-1].replace(/GMT[+-]\d+/,"")),(isNaN(s)||null===s)&&(i=t.pop()));var n=!1;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(t[0]),"string"==typeof t[0]&&-1==t[0].search(/[+-][0-9]{4}/)&&-1==t[0].search(/Z/)&&-1==t[0].search(/T/)&&(n=!0);break;case 2:e=new Date(t[0],t[1]),n=!0;break;default:for(var o=0;o<7;o++)r[o]=t[o]||0;e=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6]),n=!0}if(isNaN(e.getTime()))throw new Error("Invalid date");this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,n?this.setFromDateObjProxy(e):this.setFromTimeProxy(e.getTime(),i)},e.extend(a.Date.prototype,{getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){return this._useCache?this._tzInfo:(t=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:a.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=t,this._useCache=!0,t);var t},getUTCDateProxy:function(){var t=new Date(this._timeProxy);return t.setUTCMinutes(t.getUTCMinutes()+this.getTimezoneOffset()),t},setDate:function(t){return this.setAttribute("date",t),this.getTime()},setFullYear:function(t,e,i){return void 0!==i&&this.setAttribute("date",1),this.setAttribute("year",t),void 0!==e&&this.setAttribute("month",e),void 0!==i&&this.setAttribute("date",i),this.getTime()},setMonth:function(t,e){return this.setAttribute("month",t),void 0!==e&&this.setAttribute("date",e),this.getTime()},setYear:function(t){return 0<=(t=Number(t))&&t<=99&&(t+=1900),this.setUTCAttribute("year",t),this.getTime()},setHours:function(t,e,i,a){return this.setAttribute("hours",t),void 0!==e&&this.setAttribute("minutes",e),void 0!==i&&this.setAttribute("seconds",i),void 0!==a&&this.setAttribute("milliseconds",a),this.getTime()},setMinutes:function(t,e,i){return this.setAttribute("minutes",t),void 0!==e&&this.setAttribute("seconds",e),void 0!==i&&this.setAttribute("milliseconds",i),this.getTime()},setSeconds:function(t,e){return this.setAttribute("seconds",t),void 0!==e&&this.setAttribute("milliseconds",e),this.getTime()},setMilliseconds:function(t){return this.setAttribute("milliseconds",t),this.getTime()},setTime:function(t){if(isNaN(t))throw new Error("Units must be a number.");return this.setFromTimeProxy(t,this.timezone),this.getTime()},setUTCFullYear:function(t,e,i){return void 0!==i&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",t),void 0!==e&&this.setUTCAttribute("month",e),void 0!==i&&this.setUTCAttribute("date",i),this.getTime()},setUTCMonth:function(t,e){return this.setUTCAttribute("month",t),void 0!==e&&this.setUTCAttribute("date",e),this.getTime()},setUTCDate:function(t){return this.setUTCAttribute("date",t),this.getTime()},setUTCHours:function(t,e,i,a){return this.setUTCAttribute("hours",t),void 0!==e&&this.setUTCAttribute("minutes",e),void 0!==i&&this.setUTCAttribute("seconds",i),void 0!==a&&this.setUTCAttribute("milliseconds",a),this.getTime()},setUTCMinutes:function(t,e,i){return this.setUTCAttribute("minutes",t),void 0!==e&&this.setUTCAttribute("seconds",e),void 0!==i&&this.setUTCAttribute("milliseconds",i),this.getTime()},setUTCSeconds:function(t,e){return this.setUTCAttribute("seconds",t),void 0!==e&&this.setUTCAttribute("milliseconds",e),this.getTime()},setUTCMilliseconds:function(t){return this.setUTCAttribute("milliseconds",t),this.getTime()},setFromDateObjProxy:function(t){this.year=t.getFullYear(),this.month=t.getMonth(),this.date=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds(),this._day=t.getDay(),this._dateProxy=t,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(t,e){var i=new Date(t),r=e?a.timezone.getTzInfo(t,e,!0).tzOffset:i.getTimezoneOffset();i.setTime(t+6e4*(i.getTimezoneOffset()-r)),this.setFromDateObjProxy(i)},setAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1))](e),this.setFromDateObjProxy(i)},setUTCAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i="year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1),a=this.getUTCDateProxy();a["setUTC"+i](e),a.setUTCMinutes(a.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(a.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(t){var e=this.getTimezoneInfo().tzOffset;this.timezone=t,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+e)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new a.Date(this.getTime(),this.timezone):new a.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleStringIntl:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toDateString:function(){return this.toString("EEE MMM dd yyyy")},toTimeString:function(){return this.toString("H:mm k")},toString:function(t,e){t||(t="yyyy-MM-ddTHH:mm:ss.SSS");var i=t,r=e?a.timezone.getTzInfo(this.getTime(),e):this.getTimezoneInfo(),s=this;e&&(s=this.clone()).setTimezone(e);var o=s.getHours();return i.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(t){return p(s.getFullYear(),t.length)}).replace(/d+/g,function(t){return p(s.getDate(),t.length)}).replace(/m+/g,function(t){return p(s.getMinutes(),t.length)}).replace(/s+/g,function(t){return p(s.getSeconds(),t.length)}).replace(/S+/g,function(t){return p(s.getMilliseconds(),t.length)}).replace(/h+/g,function(t){return p(o%12==0?12:o%12,t.length)}).replace(/M+/g,function(t){var e=s.getMonth(),i=t.length;return i>3?a.Months[e]:i>2?a.Months[e].substring(0,i):p(e+1,i)}).replace(/k+/g,function(){return o>=12?(o>12&&(o-=12),"PM"):"AM"}).replace(/H+/g,function(t){return p(o,t.length)}).replace(/E+/g,function(t){return n[s.getDay()].substring(0,t.length)}).replace(/Z+/gi,function(){return r.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(t,e,i){var a;++e>12&&(a=parseInt(e/12,10),e%=12,t+=a),e<=2&&(t-=1,e+=12);var r=2-(a=Math.floor(t/100))+Math.floor(a/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+r-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},!0),a.timezone=new function(){var t=this,e={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:["northamerica","southamerica"],Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},i={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Istanbul":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe",GMT:"etcetera","Europe/Nicosia":"asia"};function r(t){throw new Error("Timezone '"+t+"' is either incorrect, or not loaded in the timezone registry.")}function s(a){var n,o,l=i[a];if(l)return l;if(n=a.split("/")[0],o=e[n])return o;var h=t.zones[a];return"string"==typeof h?s(h):t.loadedZones.backward?void r(a):(t.loadZoneFile("backward"),s(a))}function n(t){var e=t.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);return e[1]=parseInt(e[1],10),e[2]=e[2]?parseInt(e[2],10):0,e[3]=e[3]?parseInt(e[3],10):0,e.slice(1,5)}function o(t){if(t[3]){var e=parseInt(t[3],10),i=11,a=31;t[4]&&(i=l[t[4].substr(0,3)],a=parseInt(t[5],10)||1);var r=t[6]?n(t[6]):[0,0,0];return[e,i,a,r[0],r[1],r[2]]}}function u(t){var e=n(t);return(e=("-"===t.charAt(0)?-1:1)*(1e3*(60*(60*e[0]+e[1])+e[2])))/60/1e3}function p(t,e){return-Math.ceil(e-t)}this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.getRegionForTimezone=s,this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(t){var e={async:!0},i=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica";for(var a in t)e[a]=t[a];return this.loadZoneFiles(i,e)},this.loadZoneFiles=function(t,e){var i,a=0;if("string"==typeof t)return this.loadZoneFile(t,e);i=(e=e||{}).callback,e.callback=function(){++a===t.length&&"function"==typeof i&&i()};for(var r=0;r<t.length;r++)this.loadZoneFile(t[r],e)},this.loadZoneFile=function(e,i){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");if(!this.loadedZones[e])return this.loadedZones[e]=!0,function(e,i){var a=t.zoneFileBasePath+"/"+e;return i&&i.async?t.transport({async:!0,url:a,success:function(e){return t.parseZones(e)&&"function"==typeof i.callback&&i.callback()},error:function(){throw new Error("Error retrieving '"+a+"' zoneinfo files")}}):t.parseZones(t.transport({url:a,async:!1}))}(e,i)},this.loadZoneJSONData=function(e,i){var a=function(e){for(var i in(e=JSON.parse(e)).zones)t.zones[i]=e.zones[i];for(var a in e.rules)t.rules[a]=e.rules[a]};return i?a(t.transport({url:e,async:!1})):t.transport({url:e,success:a})},this.loadZoneDataFromObject=function(e){if(e){for(var i in e.zones)t.zones[i]=e.zones[i];for(var a in e.rules)t.rules[a]=e.rules[a]}},this.getAllZones=function(){var t=[];for(var e in this.zones)t.push(e);return t.sort()},this.parseZones=function(e){if(!e)return!1;for(var i,a=e.split("\n"),r=[],s=null,l=null,h=0;h<a.length;h++)if((i=a[h]).match(/^\s/)&&(i="Zone "+s+i),(i=i.split("#")[0]).length>3)switch((r=i.split(/\s+/)).shift()){case"Zone":if(s=r.shift(),t.zones[s]||(t.zones[s]=[]),r.length<3)break;r.splice(3,r.length,o(r)),r[3]&&(r[3]=Date.UTC.apply(null,r[3])),r[0]=-u(r[0]),t.zones[s].push(r);break;case"Rule":l=r.shift(),t.rules[l]||(t.rules[l]=[]),r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10)||r[1],r[5]=n(r[5]),r[6]=u(r[6]),t.rules[l].push(r);break;case"Link":if(t.zones[r[1]])throw new Error("Error with Link "+r[1]+". Cannot create link of a preexisted zone.");isNaN(r[0])?t.zones[r[1]]=r[0]:t.zones[r[1]]=parseInt(r[0],10)}return!0},this.transport=d,this.getTzInfo=function(e,i,s){this.lazyLoadZoneFiles(i);var n=function e(i,a){for(var s="number"==typeof i?i:new Date(+i).getTime(),n=a,o=t.zones[n];"string"==typeof o;)n=o,o=t.zones[n];if(!o){if(!t.loadedZones.backward)return t.loadZoneFile("backward"),e(i,a);if(n&&n!==a)return t.lazyLoadZoneFiles(n),e(i,n);r(n)}if(0===o.length)throw new Error("No Zone found for '"+a+"' on "+i);for(var l=o.length-1;l>=0;l--){var h=o[l];if(h[3]&&s>h[3])break}return o[l+1]}(e,i),o=+n[0],u=function(e,i,r,s){var n="number"==typeof e?new Date(e):e,o=i[1],u=i[0],d=o.match(/^([0-9]):([0-9][0-9])$/);if(d)return[-1e6,"max","-","Jan",1,[0,0,0],60*parseInt(d[1],10)+parseInt(d[2],10),"-"];var m,g,f=function(t,e,i){var a=0;if("u"===e||"g"===e||"z"===e)a=0;else if("s"===e)a=u;else{if("w"!==e&&e)throw new Error("unknown type "+e);a=p(u,i[6])}return a*=6e4,new Date(t.getTime()+a)},y=function(t,e){var i,a=t[0],r=t[1],s=r[5];if(c[a]||(c[a]={}),c[a][r])i=c[a][r];else{if(isNaN(r[4])){var n,o;"last"===r[4].substr(0,4)?(i=new Date(Date.UTC(a,l[r[3]]+1,1,s[0]-24,s[1],s[2],0)),n=h[r[4].substr(4,3)],o="<="):(i=new Date(Date.UTC(a,l[r[3]],r[4].substr(5),s[0],s[1],s[2],0)),n=h[r[4].substr(0,3)],o=r[4].substr(3,2));var u=i.getUTCDay();">="===o?i.setUTCDate(i.getUTCDate()+(n-u+(n<u?7:0))):i.setUTCDate(i.getUTCDate()+(n-u-(n>u?7:0)))}else i=new Date(Date.UTC(a,l[r[3]],r[4],s[0],s[1],s[2],0));c[a][r]=i}return e&&(i=f(i,s[3],e)),i},v=function(t,e){for(var i=[],a=0;e&&a<e.length;a++)e[a][0]<=t&&(e[a][1]>=t||e[a][0]===t&&"only"===e[a][1]||"max"===e[a][1])&&i.push([t,e[a]]);return i},x=function(t,e,i){var a,s;return t instanceof Date?i&&(t=f(t,r?"u":"w",i)):(a=t[0],s=t[1],t=!i&&c[a]&&c[a][s]?c[a][s]:y(t,i)),e instanceof Date?i&&(e=f(e,r?"u":"w",i)):(a=e[0],s=e[1],e=!i&&c[a]&&c[a][s]?c[a][s]:y(e,i)),(t=Number(t))-(e=Number(e))},b=n.getUTCFullYear(),S=a.ruleCache[s];if(S||(S=a.ruleCache[s]={}),(m=S[b])||((m=(m=v(b-1,t.rules[o])).concat(v(b,t.rules[o]))).sort(x),S[b]=m),!m||!m.length)return null;for(var C=m.length-1;C>=0;C--){g=C>0?m[C-1][1]:null;var w=m[C];if(w[2]||(w[2]=y(w,g)),x(n,w,g)>=0)return w[1]}return null}(e,n,s,i);return u&&(o=p(o,u[6])),{tzOffset:o,tzAbbr:function(t,e){var i,a=t[2];return a.indexOf("%s")>-1?(i=e?"-"===e[7]?"":e[7]:"S",a.replace("%s",i)):a.indexOf("/")>-1?a.split("/",2)[e&&e[6]?1:0]:a}(n,u)}},this.lazyLoadZoneFiles=function(t){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var e=s(t);if(!e)throw new Error("Not a valid timezone ID.");this.loadZoneFiles(e)}}}}.call("undefined"!=typeof window?window:this);var i=t.timezoneJS;return i.timezone.loadingScheme=i.timezone.loadingSchemes.MANUAL_LOAD,i.timezone.loadZoneDataFromObject({zones:{"Atlantic/Cape_Verde":[[60,"-","-01",null]],"Africa/Cairo":[[-120,"Egypt","EE%sT",null]],"Africa/Nairobi":[[-180,"-","EAT",null]],"Africa/Casablanca":[[0,"Morocco","+00/+01",15406956e5],[-60,"Morocco","+01/+00",null]],"Africa/Johannesburg":[[-120,"SA","SAST",null]],"Africa/Tunis":[[-60,"Tunisia","CE%sT",null]],"Asia/Kabul":[[-270,"-","+0430",null]],"Asia/Baku":[[-240,"Azer","+04/+05",null]],"Asia/Dhaka":[[-360,"Dhaka","+06/+07",null]],"Asia/Yangon":[[-390,"-","+0630",null]],"Asia/Shanghai":[[-480,"PRC","C%sT",null]],"Asia/Hong_Kong":[[-480,"HK","HK%sT",null]],"Asia/Taipei":[[-480,"Taiwan","C%sT",null]],"Asia/Nicosia":[[-120,"EUAsia","EE%sT",null]],"Asia/Kolkata":[[-330,"-","IST",null]],"Asia/Tehran":[[-210,"Iran","+0330/+0430",null]],"Asia/Jerusalem":[[-120,"Zion","I%sT",null]],"Asia/Tokyo":[[-540,"Japan","J%sT",null]],"Asia/Amman":[[-120,"Jordan","EE%sT",null]],"Asia/Almaty":[[-360,"-","ALMT",null]],"Asia/Seoul":[[-540,"ROK","K%sT",null]],"Asia/Pyongyang":[[-540,"-","KST",14395968e5],[-510,"-","KST",15254766e5],[-540,"-","KST",null]],"Asia/Beirut":[[-120,"Lebanon","EE%sT",null]],"Asia/Kuala_Lumpur":[[-480,"-","+08",null]],"Asia/Hovd":[[-420,"Mongol","+07/+08",null]],"Asia/Ulaanbaatar":[[-480,"Mongol","+08/+09",null]],"Asia/Kathmandu":[[-345,"-","+0545",null]],"Asia/Karachi":[[-300,"Pakistan","PK%sT",null]],"Asia/Riyadh":[[-180,"-","+03",null]],"Asia/Damascus":[[-120,"Syria","EE%sT",null]],"Asia/Bangkok":[[-420,"-","+07",null]],"Asia/Dubai":[[-240,"-","+04",null]],"Australia/Darwin":[[-570,"Aus","CST",null]],"Australia/Perth":[[-480,"AW","WST",null]],"Australia/Eucla":[[-525,"AW","+0845/+0945",null]],"Australia/Brisbane":[[-600,"AQ","EST",null]],"Australia/Adelaide":[[-570,"AS","CST",null]],"Australia/Sydney":[[-600,"AN","EST",null]],"Pacific/Fiji":[[-720,"Fiji","+12/+13",null]],"Pacific/Guam":[[-600,"-","ChST",null]],"Pacific/Kiritimati":[[-840,"-","+14",null]],"Pacific/Noumea":[[-660,"NC","+11/+12",null]],"Pacific/Auckland":[[-720,"NZ","NZ%sT",null]],"Pacific/Chatham":[[-765,"Chatham","+1245/+1345",null]],"Pacific/Pago_Pago":[[660,"-","SST",null]],"Pacific/Apia":[[-780,"WS","+13/+14",null]],"Pacific/Tongatapu":[[-780,"Tonga","+13/+14",null]],"Etc/UTC":[[0,"-","UTC",null]],UTC:"Etc/UTC","Europe/London":[[0,"EU","GMT/BST",null]],"Europe/Dublin":[[0,"Eire","IST/GMT",null]],WET:[[0,"EU","WE%sT",null]],CET:[[-60,"C-Eur","CE%sT",null]],MET:[[-60,"C-Eur","ME%sT",null]],EET:[[-120,"EU","EE%sT",null]],"Europe/Brussels":[[-60,"EU","CE%sT",null]],"Europe/Helsinki":[[-120,"EU","EE%sT",null]],"Europe/Paris":[[-60,"EU","CE%sT",null]],"Europe/Berlin":[[-60,"EU","CE%sT",null]],"Europe/Amsterdam":[[-60,"EU","CE%sT",null]],"Atlantic/Azores":[[60,"EU","-01/+00",null]],"Europe/Bucharest":[[-120,"EU","EE%sT",null]],"Europe/Kaliningrad":[[-120,"-","EET",null]],"Europe/Moscow":[[-180,"-","MSK",null]],"Europe/Simferopol":[[-180,"-","MSK",null]],"Europe/Samara":[[-240,"-","+04",null]],"Asia/Yekaterinburg":[[-300,"-","+05",null]],"Asia/Omsk":[[-360,"-","+06",null]],"Asia/Novosibirsk":[[-360,"-","+06",14693256e5],[-420,"-","+07",null]],"Asia/Novokuznetsk":[[-420,"-","+07",null]],"Asia/Krasnoyarsk":[[-420,"-","+07",null]],"Asia/Irkutsk":[[-480,"-","+08",null]],"Asia/Yakutsk":[[-540,"-","+09",null]],"Asia/Vladivostok":[[-600,"-","+10",null]],"Asia/Magadan":[[-600,"-","+10",14614632e5],[-660,"-","+11",null]],"Asia/Srednekolymsk":[[-660,"-","+11",null]],"Asia/Kamchatka":[[-720,"-","+12",null]],"Europe/Belgrade":[[-60,"EU","CE%sT",null]],"Europe/Sarajevo":"Europe/Belgrade","Europe/Istanbul":[[-120,"EU","EE%sT",14457348e5],[-120,"1:00","EEST",14469444e5],[-120,"EU","EE%sT",14732064e5],[-180,"-","+03",null]],"America/New_York":[[300,"US","E%sT",null]],"America/Chicago":[[360,"US","C%sT",null]],"America/Denver":[[420,"US","M%sT",null]],"America/Los_Angeles":[[480,"US","P%sT",null]],"America/Juneau":[[540,"US","AK%sT",null]],"Pacific/Honolulu":[[600,"-","HST",null]],"America/Phoenix":[[420,"-","MST",null]],"America/St_Johns":[[210,"Canada","N%sT",null]],"America/Halifax":[[240,"Canada","A%sT",null]],"America/Regina":[[360,"-","CST",null]],"America/Mexico_City":[[360,"Mexico","C%sT",null]],"America/Chihuahua":[[420,"Mexico","M%sT",null]],"America/Costa_Rica":[[360,"CR","C%sT",null]],"America/Havana":[[300,"Cuba","C%sT",null]],"America/Port-au-Prince":[[300,"Haiti","E%sT",null]],"America/Panama":[[300,"-","EST",null]],"America/Puerto_Rico":[[240,"-","AST",null]],"America/Argentina/Buenos_Aires":[[180,"Arg","-03/-02",null]],"America/Sao_Paulo":[[180,"Brazil","-03/-02",null]],"America/Santiago":[[240,"Chile","-04/-03",null]],"America/Punta_Arenas":[[240,"Chile","-04/-03",14808096e5],[180,"-","-03",null]],"America/Bogota":[[300,"CO","-05/-04",null]],"America/Asuncion":[[240,"Para","-04/-03",null]],"Atlantic/South_Georgia":[[120,"-","-02",null]],"America/Montevideo":[[180,"Uruguay","-03/-02",null]],"America/Caracas":[[270,"-","-0430",14620698e5],[240,"-","-04",null]],"Europe/Athens":"Europe/Bucharest","Asia/Rangoon":"Asia/Yangon","Atlantic/Reykjavik":"UTC","Asia/Kuwait":"Asia/Riyadh","Asia/Muscat":"Asia/Riyadh","Asia/Istanbul":"Europe/Istanbul"},rules:{Egypt:[],Morocco:[[2013,2018,"-","Oct","lastSun",[3,0,0,null],0,"-"],[2014,2018,"-","Mar","lastSun",[2,0,0,null],60,"-"],[2015,"only","-","Jun","14",[3,0,0,null],0,"-"],[2015,"only","-","Jul","19",[2,0,0,null],60,"-"],[2016,"only","-","Jun","5",[3,0,0,null],0,"-"],[2016,"only","-","Jul","10",[2,0,0,null],60,"-"],[2017,"only","-","May","21",[3,0,0,null],0,"-"],[2017,"only","-","Jul","2",[2,0,0,null],60,"-"],[2018,"only","-","May","13",[3,0,0,null],0,"-"],[2018,"only","-","Jun","17",[2,0,0,null],60,"-"],[2019,"only","-","May","5",[3,0,0,null],-60,"-"],[2019,"only","-","Jun","9",[2,0,0,null],0,"-"],[2020,"only","-","Apr","19",[3,0,0,null],-60,"-"],[2020,"only","-","May","24",[2,0,0,null],0,"-"],[2021,"only","-","Apr","11",[3,0,0,null],-60,"-"],[2021,"only","-","May","16",[2,0,0,null],0,"-"],[2022,"only","-","Mar","27",[3,0,0,null],-60,"-"],[2022,"only","-","May","8",[2,0,0,null],0,"-"],[2023,"only","-","Mar","19",[3,0,0,null],-60,"-"],[2023,"only","-","Apr","23",[2,0,0,null],0,"-"]],SA:[],Tunisia:[],EUAsia:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],Azer:[[1997,2015,"-","Mar","lastSun",[4,0,0,null],60,"-"],[1997,2015,"-","Oct","lastSun",[5,0,0,null],0,"-"]],Dhaka:[],PRC:[],HK:[],Taiwan:[],Iran:[[2013,2015,"-","Mar","22",[0,0,0,null],60,"-"],[2013,2015,"-","Sep","22",[0,0,0,null],0,"-"],[2016,"only","-","Mar","21",[0,0,0,null],60,"-"],[2016,"only","-","Sep","21",[0,0,0,null],0,"-"],[2017,2019,"-","Mar","22",[0,0,0,null],60,"-"],[2017,2019,"-","Sep","22",[0,0,0,null],0,"-"],[2020,"only","-","Mar","21",[0,0,0,null],60,"-"],[2020,"only","-","Sep","21",[0,0,0,null],0,"-"],[2021,2023,"-","Mar","22",[0,0,0,null],60,"-"],[2021,2023,"-","Sep","22",[0,0,0,null],0,"-"]],Zion:[[2013,"max","-","Mar","Fri>=23",[2,0,0,null],60,"D"],[2013,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],Japan:[],Jordan:[[2014,"max","-","Mar","lastThu",[24,0,0,"-"],60,"S"],[2014,"max","-","Oct","lastFri",[0,0,0,"s"],0,"-"]],ROK:[],Lebanon:[[1993,"max","-","Mar","lastSun",[0,0,0,null],60,"S"],[1999,"max","-","Oct","lastSun",[0,0,0,null],0,"-"]],Mongol:[[2015,2016,"-","Mar","lastSat",[2,0,0,null],60,"-"],[2015,2016,"-","Sep","lastSat",[0,0,0,null],0,"-"]],Pakistan:[],Syria:[[2012,"max","-","Mar","lastFri",[0,0,0,null],60,"S"],[2009,"max","-","Oct","lastFri",[0,0,0,null],0,"-"]],Aus:[],AW:[],AQ:[],AS:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],AN:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],Fiji:[[2014,"max","-","Nov","Sun>=1",[2,0,0,null],60,"-"],[2015,"max","-","Jan","Sun>=13",[3,0,0,null],0,"-"]],NC:[],NZ:[[2007,"max","-","Sep","lastSun",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],Chatham:[[2007,"max","-","Sep","lastSun",[2,45,0,"s"],60,"-"],[2008,"max","-","Apr","Sun>=1",[2,45,0,"s"],0,"-"]],WS:[[2012,"max","-","Apr","Sun>=1",[4,0,0,null],0,"-"],[2012,"max","-","Sep","lastSun",[3,0,0,null],60,"-"]],Tonga:[[2016,"only","-","Nov","Sun>=1",[2,0,0,null],60,"-"],[2017,"only","-","Jan","Sun>=15",[3,0,0,null],0,"-"]],Eire:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],0,"-"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],-60,"-"]],EU:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],"C-Eur":[[1981,"max","-","Mar","lastSun",[2,0,0,"s"],60,"S"],[1996,"max","-","Oct","lastSun",[2,0,0,"s"],0,"-"]],US:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Canada:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Mexico:[[2002,"max","-","Apr","Sun>=1",[2,0,0,null],60,"D"],[2002,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],CR:[],Cuba:[[2012,"max","-","Nov","Sun>=1",[0,0,0,"s"],0,"S"],[2013,"max","-","Mar","Sun>=8",[0,0,0,"s"],60,"D"]],Haiti:[[2012,2015,"-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2012,2015,"-","Nov","Sun>=1",[2,0,0,null],0,"S"],[2017,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2017,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Arg:[],Brazil:[[2008,2017,"-","Oct","Sun>=15",[0,0,0,null],60,"-"],[2015,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"],[2016,2019,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2018,"only","-","Nov","Sun>=1",[0,0,0,null],60,"-"]],Chile:[[2016,2018,"-","May","Sun>=9",[3,0,0,"u"],0,"-"],[2016,2018,"-","Aug","Sun>=9",[4,0,0,"u"],60,"-"],[2019,"max","-","Apr","Sun>=2",[3,0,0,"u"],0,"-"],[2019,"max","-","Sep","Sun>=2",[4,0,0,"u"],60,"-"]],CO:[],Para:[[2010,"max","-","Oct","Sun>=1",[0,0,0,null],60,"-"],[2013,"max","-","Mar","Sun>=22",[0,0,0,null],0,"-"]],Uruguay:[[2006,2015,"-","Mar","Sun>=8",[2,0,0,null],0,"-"]]}}),e.convertTimeZone=function(t,e,a){var r=new i.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e);return r.setTimezone(a),r},e.convertToLocalTime=function(t,e){var a=t.getSeconds(),r=t.getMilliseconds(),s=new i.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),e);return new Date(s.getTime()+1e3*a+r)},t},__js_core_utility_=function(t){var e=t.CIQ;void 0!==global&&void 0===global.CanvasRenderingContext2D&&(global.CanvasRenderingContext2D=function(){});t.$$=function t(e,i){if(!i)return document.getElementById(e);if(i.id==e)return i;if(!i.hasChildNodes)return null;for(var a=0;a<i.childNodes.length;a++){var r=t(e,i.childNodes[a]);if(r)return r}return null};t.$$$=function(t,e){return e||(e=document),e.querySelectorAll(t)[0]},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,a,r){if(!(r instanceof Array))return r&&console.log('WARNING: Unsupported drawing pattern "'+r+'"; defaulting to "solid"'),void this.stxLine(t,e,i,a,this.strokeStyle,this.globalAlpha,this.lineWidth);if(e!==1/0&&t!==1/0&&a!==1/0&&i!==1/0){var s=function(t,e){return t-e<=1e-8},n=function(t,e){return t-e>=-1e-8},o=function(t,e){return Math.min(t,e)},l=function(t,e){return Math.max(t,e)},h={thereYet:n,cap:o},c={thereYet:n,cap:o};if(e-a>0&&(c.thereYet=s,c.cap=l),t-i>0&&(h.thereYet=s,h.cap=l),this.moveTo(t,e),!isNaN(t)&&!isNaN(e))for(var u=t,p=e,d=0,m=!0;!h.thereYet(u,i)||!c.thereYet(p,a);){var g=Math.atan2(a-e,i-t),f=r[d];u=h.cap(i,u+Math.cos(g)*f),p=c.cap(a,p+Math.sin(g)*f),m?this.lineTo(u,p):this.moveTo(u,p),d=(d+1)%r.length,m=!m}}},CanvasRenderingContext2D.prototype.stxLine=function(t,e,i,a,r,s,n,o){this.beginPath(),this.lineWidth=n,this.strokeStyle=r,this.globalAlpha=s,o&&o.length?this.dashedLineTo(t,e,i,a,o):(this.moveTo(t,e),this.lineTo(i,a)),this.stroke(),this.closePath(),this.lineWidth=1},CanvasRenderingContext2D.prototype.stxCircle=function(t,e,i,a){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),a&&this.fill(),this.stroke(),this.closePath()},Math.easeInOutQuad=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},Math.easeInOutCubic=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},Math.easeOutCubic=function(t,e,i,a){return t/=a,i*(--t*t*t+1)+e};var i="undefined"!=typeof navigator?navigator:{userAgent:""},a=i.userAgent,r="undefined"!=typeof window?window:{},s="undefined"!=typeof document?document:{};return e.ipad=-1!=a.indexOf("iPad"),e.iphone=-1!=a.indexOf("iPhone"),e.isAndroid=a.toLowerCase().indexOf("android")>-1,e.isIE=a.toLowerCase().indexOf("msie")>-1||a.indexOf("Trident/")>-1,e.isEdge=a.indexOf("Edge/")>-1,e.isIE9=a.indexOf("Trident/5")>-1||a.indexOf("MSIE 9.0")>-1,e.isIE8=r.isIE8||a.indexOf("MSIE 8.0")>-1,e.isIOS7=a.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i),e.isIOS8=a.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i),e.isIOS9=a.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i),e.isIOS10=a.match(/(iPad|iPhone);.*CPU.*OS 10_\d/i),e.isIOS7or8=e.isIOS7||e.isIOS8||e.isIOS9||e.isIOS10,e.isMobile=e.isAndroid||e.ipad||e.iphone,e.touchDevice=void 0!==s.ontouchstart||i.maxTouchPoints>1,e.isSurface=e.touchDevice&&(e.isEdge||e.isIE),e.is_chrome=a.toLowerCase().indexOf("chrome")>-1&&!e.isEdge,e.isFF=a.toLowerCase().indexOf("firefox")>-1,e.isSurfaceApp=r.MSApp,e.isWebComponentsSupported="undefined"!=typeof document&&"registerElement"in document&&"import"in document.createElement("link")&&"content"in document.createElement("template"),e.noKeyboard=e.ipad||e.iphone||e.isAndroid||e.isSurfaceApp,e.wheelEvent=function(){if("undefined"!=typeof document)return e.isIE||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"}(),e.log10=function(t){return Math.log(t)/Math.LN10},e.deleteRHS=function(t,e){var i=!1;for(var a in t)t[a]==e&&(delete t[a],i=!0);return i},e.scrub=function(t,e){for(var i in t)void 0===t[i]&&delete t[i],e&&null===t[i]&&delete t[i]},e.dataBindSafeAssignment=function(t,i){for(var a in e.extend(t,i),t)void 0===i[a]&&delete t[a]},e.clone=function(t,i){if(null===t||"object"!=_typeof(t))return t;var a=t.constructor;if(a==Date||a==RegExp||a==String||a==Number||a==Boolean)return new a(t.valueOf());if(a==Function)return function(){return t.apply(this,arguments)};if(!i)try{i=new a}catch(e){i=Object.create(Object.getPrototypeOf(t))}for(var r in t)i[r]=i[r]!==t[r]?e.clone(t[r],null):i[r];return i},e.shallowClone=function(t){if(!t)return t;var e;if(t.constructor==Array){e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=t[i];return e}for(var a in e={},t)e[a]=t[a];return e},e.ensureDefaults=function(t,e){for(var i in e)void 0===t[i]&&(t[i]=e[i]);return t},e.transferObject=function(t,e){var i;for(i in t)t.hasOwnProperty(i)&&delete t[i];for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.equals=function(t,i,a){if(!t&&i)return!1;if(t&&!i)return!1;if(_typeof(t)!==_typeof(i))return!1;for(var r in t){if(!a||!a[r])if("object"!==_typeof(t[r])){if(i[r]!=t[r])return!1}else if(!e.equals(t[r],i[r]))return!1}return!0},e.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},e.first=function(t){for(var e in t)return e;return null},e.last=function(t){var e=null;for(var i in t)e=i;return e},e.objLength=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},e.deriveFromObjectChain=function(t,e){if(-1==e.indexOf("."))return{obj:t,member:e};for(var i=e.split("."),a=0;a<i.length-1;a++){var r=i[a];t[r]||0===t[r]||(t[r]={}),t=t[r]}return{obj:t,member:i[a]}},e.createObjectChainNames=function(t,e){for(var i=[],a=0;a<e.length;a++)i.push(t+"--\x3e"+e[a]);return i},e.existsInObjectChain=function(t,e){if(-1==e.indexOf("--\x3e"))return t[e]||0===t[e]?{obj:t,member:e}:null;for(var i,a=e.split("--\x3e"),r=0;r<a.length-1;r++){if(!t[i=a[r]]&&0!==t[i])return null;t=t[i]}return t[i=a[r]]||0===t[i]?{obj:t,member:i}:null},e.derivedFrom=function(t,e){return!!e.isPrototypeOf(t)||t instanceof e},e.replaceFields=function(t,i){if(!t)return t;var a={};for(var r in t){var s=t[r],n=i[r];if(n||(n=r),s&&"object"==_typeof(s))if(s.constructor==Array)for(var o=a[n]=new Array(s.length),l=0;l<o.length;l++){var h=s[l];"object"==_typeof(h)?o[l]=e.replaceFields(h,i):o[l]=h}else a[n]=e.replaceFields(s,i);else a[n]=s}return a},e.removeNullValues=function(t){var i=e.clone(t);for(var a in i)i[a]||delete i[a];return i},e.reverseObject=function(t){var e={};for(var i in t)e[t[i]]=i;return e},e.camelCaseRegExp=/-([a-z])/g,e.makeCamelCase=function(t){return t.replace(e.camelCaseRegExp,function(t){return t[1].toUpperCase()})},e.appendClassName=function(t,e){if(t&&t.className!=e){for(var i=t.className.split(" "),a=0;a<i.length;a++)if(i[a]==e)return;t.className?t.className+=" "+e:t.className=e}},e.unappendClassName=function(t,e){if(t&&-1!=t.className.indexOf(e))if(t.className==e)t.className="";else{for(var i=t.className.split(" "),a="",r=0;r<i.length;r++)i[r]!=e&&(""!==a&&(a+=" "),a+=i[r]);t.className=a}},e.swapClassName=function(t,i,a){e.unappendClassName(t,a),e.appendClassName(t,i)},e.hasClassName=function(t,e){return!!t&&(" "+t.className+" ").indexOf(" "+e+" ")>-1},e.toggleClassName=function(t,i){e.hasClassName(t,i)?e.unappendClassName(t,i):e.appendClassName(t,i)},e.newChild=function(t,e,i,a){var r=document.createElement(e);return i&&(r.className=i),t.appendChild(r),a&&(r.innerHTML=a),r},e.innerHTML=function(t,e){window.MSApp?window.MSApp.execUnsafeLocalFunction(function(){t.innerHTML=e}):t.innerHTML=e},e.focus=function(t,i){if(e.isSurface||i){var a=0;isNaN(parseInt(i,10))||(a=i),setTimeout(function(){t.focus()},a)}else t.focus()},e.blur=function(t){t||(t=document.activeElement),t&&t.blur(),window.focus()},e.findNodesByText=function(t,i){if(t.innerHTML==i)return[t];for(var a=[],r=0;r<t.childNodes.length;r++){var s=e.findNodesByText(t.childNodes[r],i);s&&(a=a.concat(s))}return a.length?a:null},e.hideByText=function(t,i){for(var a=e.findNodesByText(t,i),r=0;r<a.length;r++)a[r].style.display="none"},e.outerWidth=function(t){var i=t.offsetWidth;return i+=e.stripPX(getComputedStyle(t).marginLeft),i+=e.stripPX(getComputedStyle(t).marginRight)},e.clearNode=function(t){if(t.hasChildNodes())for(;t.childNodes.length>=1;)t.removeChild(t.firstChild)},e.getEventDOM=function(t){return t?t.target:window.event.srcElement},e.convertClickToTouchEnd=function(t){var e=document.getElementById(t),i=e.getAttribute("onClick");i&&(e.removeAttribute("onClick"),e.setAttribute("onTouchEnd",i))},e.pageHeight=function(){var t=window.innerHeight;if(top!=self)try{t>parent.innerHeight&&(t=parent.innerHeight)}catch(t){}return t},e.pageWidth=function(){var t=window.innerWidth;if(top!=self)try{t>parent.innerWidth&&(t=parent.innerWidth)}catch(t){}return t},e.stripPX=function(t){return t?"number"==typeof t?t:parseInt(t.substr(0,t.indexOf("p")),10):0},e.colorsEqual=function(t,i){if(t==i)return!0;if(!t&&!i)return!0;if(!t||!i)return!1;"transparent"==t&&(t="rgba(0,0,0,0)"),"transparent"==i&&(i="rgba(0,0,0,0)");var a=/^rgba\(.*,(.+)\)/,r=t.match(a),s=i.match(a);if((r=r?parseFloat(r[1]):1)!=(s=s?parseFloat(s[1]):1))return!1;var n=e.colorToHex(t),o=e.colorToHex(i);return n.toLowerCase()==o.toLowerCase()},e.colorToHex=function(t){if(e.colorToHexMapping||(e.colorToHexMapping={}),t&&"transparent"!=t||(t="#000000"),e.colorToHexMapping[t])return e.colorToHexMapping[t];if("#"===t.substr(0,1))return 4==t.length&&(t=e.colorToHexMapping[t]="#"+Array(3).join(t.substr(1,1))+Array(3).join(t.substr(2,1))+Array(3).join(t.substr(3,1))),t;var i=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(t);if(i||(i=/(.*?)rgba\((\d+), ?(\d+), ?(\d+),.*\)/.exec(t)),!i){var a=function(t){if("undefined"==typeof document)return"#000000";var a,r=document.querySelector(".ciq_color_converter");return r||((r=document.createElement("textarea")).className="ciq_color_converter",r.style.display="none",document.body.appendChild(r)),r.style.color="#000000",r.style.color=t,e.isIE8?(a=(a=(255&(a=r.createTextRange().queryCommandValue("ForeColor")))<<16|65280&a|(16711680&a)>>>16).toString(16),"#000000".slice(0,7-a.length)+a):(a=getComputedStyle(r).getPropertyValue("color"),(i=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(a))?e.colorToHex(a):"#"===a.substr(0,1)?a:t)}(t);return e.colorToHexMapping[t]=a,a}for(var r=parseFloat(i[2]),s=parseFloat(i[3]),n=(parseFloat(i[4])|s<<8|r<<16).toString(16),o=n.length;o<6;o++)n="0"+n;var l=i[1]+"#"+n;return e.colorToHexMapping[t]=l,l},e.hexToRgba=function(t,i){if(t&&"transparent"!=t||(t="rgba(0,0,0,0)"),"rgba"===t.substr(0,4)){var a=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t),r=a[5];return(i||0===i)&&(r=i),r>1&&(r/=100),"rgba("+a[2]+","+a[3]+","+a[4]+","+r+")"}"rgb"===t.substr(0,3)&&(t=e.colorToHex(t)),i||0===i||(i=100),i<=1&&(i*=100),t=t.replace("#","");var s=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16);return isNaN(s)||isNaN(n)||isNaN(o)?(console.log("CIQ.hexToRgba: invalid hex :",t),null):"rgba("+s+","+n+","+o+","+i/100+")"},e.convertToNativeColor=function(t){var e=document.createElement("DIV");e.style.color=t,e.style.display="none",document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i},e.isTransparent=function(t){if(!t)return!1;if("transparent"==t)return!0;var e=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t);return null!==e&&0===parseFloat(e[5])},e.hsv=function(t){var i=e.colorToHex(t);"#"===i.substr(0,1)&&(i=i.slice(1));for(var a=i.length;a<6;a++)i="0"+i;var r=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),n=parseInt(i.slice(4,6),16);if(r=parseInt((""+r).replace(/\s/g,""),10),s=parseInt((""+s).replace(/\s/g,""),10),n=parseInt((""+n).replace(/\s/g,""),10),null===r||null===s||null===n||isNaN(r)||isNaN(s)||isNaN(n))return console.log("CIQ.hsv: invalid color :",t),null;if(r<0||s<0||n<0||r>255||s>255||n>255)return null;r/=255,s/=255,n/=255;var o=Math.min(r,Math.min(s,n)),l=Math.max(r,Math.max(s,n));return o==l?[0,0,o]:[60*((r==o?3:n==o?1:5)-(r==o?s-n:n==o?r-s:n-r)/(l-o)),(l-o)/l,l]},e.hsl=function(t){var i=e.colorToHex(t);"#"===i.substr(0,1)&&(i=i.slice(1));for(var a=i.length;a<6;a++)i="0"+i;var r=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),n=parseInt(i.slice(4,6),16);r/=255,s/=255,n/=255;var o,l,h=Math.max(r,s,n),c=Math.min(r,s,n),u=(h+c)/2;if(h==c)o=l=0;else{var p=h-c;switch(l=u>.5?p/(2-h-c):p/(h+c),h){case r:o=(s-n)/p+(s<n?6:0);break;case s:o=(n-r)/p+2;break;case n:o=(r-s)/p+4}o/=6}return[o,l,u]},e.chooseForegroundColor=function(t){var i=e.colorToHex(t);return.2126*parseInt(i.slice(1,3),16)+.7152*parseInt(i.slice(3,5),16)+.0722*parseInt(i.slice(5,7),16)<100?"#FFFFFF":"#000000"},e.borderPatternToArray=function(t,e){return e?e instanceof Array?e:"dotted"==e?[t,t]:"dashed"==e?[5*t,5*t]:("solid"!=e&&"none"!=e&&console.log('Unsupported pattern "'+e+'"; defaulting to "solid"'),[]):[]},e.getBackgroundColor=function(t){for(var i=null;!i||e.isTransparent(i);){var a=getComputedStyle(t);if(!a)return;if(i=a.backgroundColor,e.isTransparent(i)&&(i="transparent"),!(t=t.parentNode)||!t.tagName)break}return i&&"transparent"!=i||(i="#FFFFFF"),i},e.yyyymmddhhmmssmmmrx=new RegExp("\\d{17}"),e.strToDateTime=function(t){if(!t||t.getFullYear)return t;var i,a,r,s,n,o,l,h=[];if(12==t.length||14==t.length)return i=parseFloat(t.substring(0,4)),a=parseFloat(t.substring(4,6))-1,r=parseFloat(t.substring(6,8)),s=parseFloat(t.substring(8,10)),n=parseFloat(t.substring(10,12)),o=parseFloat(t.substring(12,14))||0,new Date(i,a,r,s,n,o,0);if(e.yyyymmddhhmmssmmmrx.test(t))return i=parseFloat(t.substring(0,4)),a=parseFloat(t.substring(4,6))-1,r=parseFloat(t.substring(6,8)),s=parseFloat(t.substring(8,10)),n=parseFloat(t.substring(10,12)),o=parseFloat(t.substring(12,14)),l=parseFloat(t.substring(14,17)),new Date(i,a,r,s,n,o,l);var c=[t],u=t.indexOf("T");if(-1!=u){var p=t.substring(u);if(!e.isIE8&&(-1!=p.indexOf("Z")||-1!=p.indexOf("-")||-1!=p.indexOf("+")))return new Date(t);c=t.split("T")}else-1!=t.indexOf(" ")&&(c=t.split(" "));if(-1!=c[0].indexOf("/"))h=c[0].split("/");else{if(-1==c[0].indexOf("-"))return e.strToDate(t);h=c[0].split("-")}var d=parseFloat(h[2],10);if(h[0]&&4==h[0].length&&(d=parseFloat(h[0],10),h[0]=h[1],h[1]=h[2]),c.length>1){var m=c[2];c=c[1].split(":"),m&&("12"==c[0]&&"AM"==m.toUpperCase()?c[0]=0:"12"!=c[0]&&"PM"==m.toUpperCase()&&(c[0]=parseInt(c[0],10)+12));var g=0,f=0;if(3==c.length)if(-1==c[2].indexOf("."))g=parseInt(c[2],10);else{if(3!=(g=c[2].split("."))[1].length){f=g[1].substr(0,3);var y=parseInt(g[1].substr(3),10);g=g[0];var v=new Date(d,h[0]-1,h[1],c[0],c[1],g,f);return v.setMinutes(v.getMinutes()-v.getTimezoneOffset()-y%100-60*Math.round(y/100)),v}f=g[1],g=g[0]}return new Date(d,h[0]-1,h[1],c[0],c[1],g,f)}return new Date(d,h[0]-1,h[1],0,0,0,0)},e.strToDate=function(t){var e;if(-1!=t.indexOf("/"))e=t.split("/");else{if(-1==t.indexOf("-"))return t.length>=8?new Date(parseFloat(t.substring(0,4)),parseFloat(t.substring(4,6))-1,parseFloat(t.substring(6,8))):new Date;e=t.split("-")}if(e.length<3)return new Date;-1!=e[2].indexOf(" ")?e[2]=e[2].substring(0,e[2].indexOf(" ")):-1!=e[2].indexOf("T")&&(e[2]=e[2].substring(0,e[2].indexOf("T")));var i=parseFloat(e[2],10);return i<20&&(i+=2e3),4==e[0].length&&(i=parseFloat(e[0],10),e[0]=e[1],e[1]=e[2]),new Date(i,e[0]-1,e[1])},e.mmddyyyy=function(t){"string"==typeof t&&(t=e.strToDate(t));var i=t.getMonth()+1;i<10&&(i="0"+i);var a=t.getDate();return a<10&&(a="0"+a),i+"/"+a+"/"+t.getFullYear()},e.yyyymmdd=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),t.getFullYear()+"-"+e+"-"+i},e.hhmmss=function(t){var e=t.getHours();e<10&&(e="0"+e);var i=t.getMinutes();i<10&&(i="0"+i);var a=t.getSeconds();return a<10&&(a="0"+a),e+":"+i+":"+a},e.yyyymmddhhmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),""+t.getFullYear()+e+i+a+r},e.yyyymmddhhmmssmmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();r<10&&(r="0"+r);var s=t.getSeconds();s<10&&(s="0"+s);var n=t.getMilliseconds();return n<10?n="00"+n:n<100&&(n="0"+n),""+t.getFullYear()+e+i+a+r+s+n},e.friendlyDate=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),t.getFullYear()+"/"+e+"/"+i+" "+a+":"+r},e.standardUTCDate=function(t){var e=t.getUTCMonth()+1;e<10&&(e="0"+e);var i=t.getUTCDate();i<10&&(i="0"+i);var a=t.getUTCHours();a<10&&(a="0"+a);var r=t.getUTCMinutes();r<10&&(r="0"+r);var s=t.getUTCSeconds();return s<10&&(s="0"+s),t.getUTCFullYear()+"-"+e+"-"+i+"T"+a+":"+r+":"+s+"Z"},e.mmddhhmm=function(t){var i=e.strToDateTime(t),a=i.getMonth()+1;a<10&&(a="0"+a);var r=i.getDate();r<10&&(r="0"+r);var s=i.getHours();s<10&&(s="0"+s);var n=i.getMinutes();n<10&&(n="0"+n);var o=i.getSeconds();o<10&&(o="0"+o);var l=i.getMilliseconds();return l<10?l="00"+l:l<100&&(l="0"+l),"00"==s&&"00"==n&&"00"==o&&"000"==l?a+"-"+r+"-"+i.getFullYear():"00"==o&&"000"==l?a+"-"+r+" "+s+":"+n:"000"==l?a+"-"+r+" "+s+":"+n+":"+o:a+"-"+r+" "+s+":"+n+":"+o+":"+l},e.getYearDay=function(t){var e=t;e||(e=new Date),e.setHours(0,0,0,0);var i=new Date(e.getFullYear(),0,0),a=e-i;return Math.round(a/864e5)},e.isDST=function(t){t||(t=new Date);var e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),6,1),a=Math.max(e.getTimezoneOffset(),i.getTimezoneOffset());return t.getTimezoneOffset()!=a},e.uniqueID=function(t){if(t){var e=(new Date).getTime();return void 0!==("undefined"==typeof window?"undefined":_typeof(window))&&window.performance&&"function"==typeof window.performance.now&&(e+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})}var i=(new Date).getTime().toString(36);return(i+=Math.floor(Math.random()*Math.pow(36,2)).toString(36)).toUpperCase()},e.getHostName=function(t){try{return t.match(/:\/\/(.[^\/]+)/)[1]}catch(t){return""}},e.getAjaxServer=function(t){var i=!1,a=!0;if((e.isIE9||e.isIE8)&&t&&(""===e.getHostName(t)&&(a=!1),e.getHostName(t)==e.getHostName(window.location.href)&&(a=!1)),(e.isIE9||e.isIE8)&&a)return i=new XDomainRequest;try{i=new XMLHttpRequest}catch(t){console.warn("ajax not supported in browser")}return i},e.qs=function(t){var e={};t||(t=window.location.search.substring(1));for(var i=t.split("&"),a=0;a<i.length;a++){var r=i[a].indexOf("=");r>0?e[i[a].substring(0,r)]=i[a].substring(r+1):e[i[a]]=null}return e},e.postAjax=function(t,i,a,r,s){"string"==typeof t&&(t={url:t,payload:i,cb:a,contentType:r,noEpoch:s,method:null,responseHeaders:!1});var n=t.url,o=t.cb,l=t.payload;if(o||(o=function(){}),t.ungovernable||!e.Extras||!e.Extras.RequestLimiter||!e.Extras.RequestLimiter.hitRequestLimit(n)){var h=e.getAjaxServer(n);if(!h)return!1;e.ajaxes||(e.ajaxes=[]),e.ajaxes.unshift(h);var c=new Date;t.noEpoch||(-1==n.indexOf("?")?n+="?ciqrandom="+c.getTime():n+="&ciqrandom="+c.getTime());var u=t.method,p=t.headers;if(u||(u=l?"POST":"GET"),!e.isIE9&&!e.isIE8||h.constructor==XMLHttpRequest){if(h.open(u,n,!0),t.contentType||(t.contentType="application/x-www-form-urlencoded"),l&&h.setRequestHeader("Content-Type",t.contentType),p)for(var d in p)h.setRequestHeader(d,p[d])}else n=n.replace("https:",window.location.protocol),h.open(u,n,!0);t.timeout&&(h.timeout=t.timeout),h.ontimeout=function(){m(h),o(408,null,{})},h.onload=function(){0===this.status?this.status="0":this.status||(this.status=200),m(h),o(this.status,this.responseText,function(e){var i={};if(t.responseHeaders){for(var a=e.getAllResponseHeaders().split("\n"),r=0;r<a.length;r++){for(var s=a[r].split(":");s[1]&&" "==s[1].charAt(0);)s[1]=s[1].substring(1);""!==s[0]&&(i[s.shift()]=s.join(":"))}return i}}(this))},h.onerror=function(){m(h),o("0",null,{})},h.onprogress=function(){};try{h.send(l)}catch(t){o("0",t,{})}return!0}function m(t){for(var i=0;i<e.ajaxes.length;i++)if(e.ajaxes[i]==t)return void e.ajaxes.splice(i,1)}o(429,null,{})},e.cleanPeriodicity=function(t,e,i){return isNaN(t)&&(t=1),e||(e=1),!isNaN(e)&&i?"minute"!=i&&"second"!=i&&"millisecond"!=i&&(e=i,i=null):"tick"==e?i=null:i||isNaN(e)||(i="minute"),"year"==e&&(e="month",t||(t=1),t*=12),{period:t,interval:e,timeUnit:i}},e.isValidNumber=function(t){return isFinite(t)&&+t===t},e.countDecimals=function(t){if("number"!=typeof t||isNaN(t))return 0;if(Math.floor(t)===Number(t))return 0;var i=t.toString().split("e-");return i.length>1?e.countDecimals(Number(i[0]))+Number(i[1]):i[0].indexOf(".")>-1?i[0].split(".")[1].length:0},e.round=function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)},t},__js_standard_drawing_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing=function(){this.chartsOnly=!1,this.penDown=!1},e.Drawing.getDrawingParameters=function(t,i){var a;try{a=new e.Drawing[i]}catch(t){}if(!a)return null;a.stx=t,a.copyConfig(!0);for(var r={},s=a.configs,n=0;n<s.length;n++)r[s[n]]=a[s[n]];var o=t.canvasStyle("stx_annotation");return o&&r.font&&(r.font.size=o.fontSize,r.font.family=o.fontFamily,r.font.style=o.fontStyle,r.font.weight=o.fontWeight),r},e.Drawing.saveConfig=function(t,i){if(i){var a=t.preferences;a.drawings||(a.drawings={}),a.drawings[i]={};var r=new e.Drawing[i];r.stx=t,e.Drawing.copyConfig(r),r.configs.forEach(function(t){a.drawings[i][t]=r[t]}),t.changeOccurred("preferences")}},e.Drawing.restoreDefaultConfig=function(t,i,a){a?t.preferences.drawings=null:t.preferences.drawings[i]=null,t.changeOccurred("preferences"),t.currentVectorParameters=e.clone(e.ChartEngine.currentVectorParameters),t.currentVectorParameters.vectorType=i},e.Drawing.initializeSettings=function(t,i){var a=e.Drawing[i];if(a){var r=new a;r.initializeSettings&&r.initializeSettings(t)}},e.Drawing.updateSource=function(t,e,i,a){if(e){var r=!1;for(var s in t.drawingObjects){var n=t.drawingObjects[s];n.field&&(i?n.field==e?(n.field=i,r=!0):n.field.indexOf(e)>-1&&-1==n.field.indexOf(e+"-")&&(n.field=n.field.replace(e,i),r=!0):n.field.split("--\x3e")[0]!=e&&n.panelName!=e||(n.panelName=a,r=!0))}r&&t.changeOccurred("vector")}},e.Drawing.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t)},e.Drawing.copyConfig=function(t,i){var a,r,s=t.stx.currentVectorParameters,n=t.configs;for(a=0;a<n.length;a++)"color"==(r=n[a])?t.color=s.currentColor:"parameters"==r?t.parameters=e.clone(s.fibonacci):"font"==r?t.font=e.clone(s.annotation.font):t[r]=s[r];if(i){var o=t.stx.preferences;if(o&&o.drawings)for(e.extend(t,o.drawings[s.vectorType]),a=0;a<n.length;a++)"color"==(r=n[a])?s.currentColor=t.color:"parameters"==r?s.fibonacci=e.clone(t.parameters):"font"==r?s.annotation.font=e.clone(t.font):s[r]=t[r]}},e.Drawing.prototype.dragToDraw=!1,e.Drawing.prototype.permanent=!1,e.Drawing.prototype.chartsOnly=!1,e.Drawing.prototype.abort=function(t){},e.Drawing.prototype.measure=function(){},e.Drawing.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name},e.Drawing.prototype.render=function(t){console.warn("must implement render function!")},e.Drawing.prototype.click=function(t,e,i){console.warn("must implement click function!")},e.Drawing.prototype.move=function(t,e,i){console.warn("must implement move function!")},e.Drawing.prototype.reposition=function(t,e,i,a){},e.Drawing.prototype.intersected=function(t,e,i){console.warn("must implement intersected function!")},e.Drawing.prototype.reconstruct=function(t,e){console.warn("must implement reconstruct function!")},e.Drawing.prototype.serialize=function(){console.warn("must implement serialize function!")},e.Drawing.prototype.adjust=function(){console.warn("must implement adjust function!")},e.Drawing.prototype.highlight=function(t){return t&&!this.highlighted?this.highlighted=t:!t&&this.highlighted&&(this.highlighted=t),this.highlighted},e.Drawing.prototype.littleCircleRadius=function(){return 6},e.Drawing.prototype.littleCircle=function(t,i,a,r){if(!this.permanent){var s=this.stx.defaultColor,n=e.chooseForegroundColor(s);t.beginPath(),t.lineWidth=1,t.arc(i,a,this.littleCircleRadius(),0,2*Math.PI,!1),t.fillStyle=r?s:n,t.strokeStyle=s,t.setLineDash([]),t.fill(),t.stroke(),t.closePath()}},e.Drawing.prototype.rotator=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor;t.beginPath(),t.lineWidth=2,a||(t.globalAlpha=.5);var n=4+r;t.arc(e,i,n,0,3*Math.PI/2,!1),t.moveTo(e+2+n,i+2),t.lineTo(e+n,i),t.lineTo(e-2+n,i+2),t.moveTo(e-2,i+2-n),t.lineTo(e,i-n),t.lineTo(e-2,i-2-n),t.strokeStyle=s,t.stroke(),t.closePath(),t.globalAlpha=1}},e.Drawing.prototype.mover=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor,n=r+1;t.save(),t.lineWidth=2,t.strokeStyle=s,t.translate(e,i),a||(t.globalAlpha=.5);for(var o=0;o<4;o++)t.rotate(Math.PI/2),t.beginPath(),t.moveTo(0,n),t.lineTo(0,n+5),t.moveTo(-2,n+5-2),t.lineTo(0,n+5),t.lineTo(2,n+5-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},e.Drawing.prototype.resizer=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor,n=5*Math.sqrt(2),o=r+1;t.save(),t.lineWidth=2,t.strokeStyle=s,t.translate(e,i),t.rotate(-e*i/Math.abs(e*i)*Math.PI/4),a||(t.globalAlpha=.5);for(var l=0;l<2;l++)t.rotate(Math.PI),t.beginPath(),t.moveTo(0,o),t.lineTo(0,o+n),t.moveTo(-2,o+n-2),t.lineTo(0,o+n),t.lineTo(2,o+n-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},e.Drawing.prototype.pointIntersection=function(t,e,i,a){if(!this.stx.panels[this.panelName])return!1;if(a){if(t>=i.cx0&&t<=i.cx1&&e>=i.cy0&&e<=i.cy1)return!0}else if(t>=i.x0&&t<=i.x1&&e>=Math.min(i.y0,i.y1)&&e<=Math.max(i.y0,i.y1))return!0;return!1},e.Drawing.prototype.setPoint=function(t,i,a,r){var s,n=null,o=null;if("number"==typeof i?n=i:i.length>=8?o=i:n=Number(i),(a||0===a)&&(this["v"+t]=a),null!==n)s=this.stx.dateFromTick(n,r,!0),this["tzo"+t]=s.getTimezoneOffset(),this["d"+t]=e.yyyymmddhhmmssmmm(s),this["p"+t]=[n,a];else if(null!==o){s=e.strToDateTime(o),this["tzo"+t]||0===this["tzo"+t]||(this["tzo"+t]=s.getTimezoneOffset()),this["d"+t]=o;var l=this["tzo"+t]-s.getTimezoneOffset();s.setMinutes(s.getMinutes()+l);var h=!1;"freeform"==this.name||e.ChartEngine.isDailyInterval(this.stx.layout.interval)||s.getHours()||s.getMinutes()||s.getSeconds()||s.getMilliseconds()||(h=!0),this["p"+t]=[this.stx.tickFromDate(e.yyyymmddhhmmssmmm(s),r,null,h),a]}},e.Drawing.prototype.getLineColor=function(t){t||(t=this.color);var i=this.stx,a=t;if(this.highlighted)a=i.getCanvasColor("stx_highlight_vector");else if(e.isTransparent(a))a=i.defaultColor;else if("auto"==a&&(a=i.defaultColor,this.field)){var r,s;for(r in i.layout.studies){var n=i.layout.studies[r],o=n.outputs[n.outputMap[this.field]];if(o){a=o.color||o;break}}for(r in i.chart.seriesRenderers)for(var l=i.chart.seriesRenderers[r],h=0;h<l.seriesParams.length;h++){var c=l.seriesParams[h],u=c.field;if(u||l.highLowBars||(u=this.defaultPlotField||"Close"),c.symbol&&c.subField&&(u+="--\x3e"+c.subField),this.field==u){a=c.color;break}c.field&&c.field==this.field.split("--\x3e")[0]&&(s=c.color)}s&&(a=s)}return"auto"==a&&(a=i.defaultColor),a},e.Drawing.prototype.setLineColor=e.Drawing.prototype.getLineColor,e.Drawing.BaseTwoPoint=function(){this.p0=null,this.p1=null,this.color=""},e.Drawing.BaseTwoPoint.ciqInheritsFrom(e.Drawing),e.Drawing.BaseTwoPoint.prototype.configs=[],e.Drawing.BaseTwoPoint.prototype.lineIntersection=function(t,i,a,r,s,n,o){s||(s=this.p0),n||(n=this.p1);var l=this.stx;if(!s||!n)return!1;var h=e.convertBoxToPixels(l,this.panelName,a);if(void 0===h.x0)return!1;var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]};return o||(c=e.convertBoxToPixels(l,this.panelName,c)),e.boxIntersects(h.x0,h.y0,h.x1,h.y1,c.x0,c.y0,c.x1,c.y1,r)},e.Drawing.BaseTwoPoint.prototype.boxIntersection=function(t,e,i){return!(!this.p0||!this.p1)&&(!(i.x0>Math.max(this.p0[0],this.p1[0])||i.x1<Math.min(this.p0[0],this.p1[0]))&&!(i.y1>Math.max(this.p0[1],this.p1[1])||i.y0<Math.min(this.p0[1],this.p1[1])))},e.Drawing.BaseTwoPoint.prototype.accidentalClick=function(t,e){var i=this.stx.panels[this.panelName],a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(t,i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,t,e),o=Math.abs(r-a),l=Math.abs(n-s);if(Math.sqrt(o*o+l*l)<10)return this.penDown=!1,this.dragToDraw&&this.stx.undo(),!0},e.Drawing.BaseTwoPoint.prototype.click=function(t,e,i){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.BaseTwoPoint.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart))},e.Drawing.BaseTwoPoint.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p1=[e,i],this.render(t))},e.Drawing.BaseTwoPoint.prototype.measure=function(){if(this.p0&&this.p1){this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],!0,this.name);var t=this.stx.controls.mSticky,e=t&&t.querySelector(".mStickyInterior");if(e){var i=[];i.push(this.name.capitalize()),this.getYValue&&i.push(this.field||this.stx.defaultPlotField||"Close"),i.push(e.innerHTML),e.innerHTML=i.join("<br>")}}},e.Drawing.BaseTwoPoint.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.render(t))}},e.Drawing.annotation=function(){this.name="annotation",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={}},e.Drawing.annotation.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.annotation.prototype.getFontString=function(){this.fontDef={style:null,weight:null,size:"12px",family:null};var t=this.stx.canvasStyle("stx_annotation");t&&(t.fontStyle&&(this.fontDef.style=t.fontStyle),t.fontWeight&&(this.fontDef.weight=t.fontWeight),t.fontSize&&(this.fontDef.size=t.fontSize),t.fontFamily&&(this.fontDef.family=t.fontFamily)),this.font.style&&(this.fontDef.style=this.font.style),this.font.weight&&(this.fontDef.weight=this.font.weight),this.font.size&&(this.fontDef.size=this.font.size),this.font.family&&(this.fontDef.family=this.font.family),this.fontString="";var e=!0;for(var i in this.fontDef)this.fontDef[i]&&(e?e=!1:this.fontString+=" ",this.fontString+=this.fontDef[i])},e.Drawing.annotation.prototype.configs=["color","font"],e.Drawing.annotation.prototype.measure=function(){},e.Drawing.annotation.prototype.render=function(t){if(!this.ta){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);t.font=this.fontString,t.textBaseline="middle";var r,s,n,o,l=i,h=a,c=this.w,u=this.h,p=this.getLineColor();if(this.stem)this.stem.d?(r=this.stx.pixelFromTick(this.stem.t),n=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v),s=l+c/2,o=h+u/2):this.stem.x&&(r=l,n=h,s=(l+=this.stem.x)+c/2,o=(h+=this.stem.y)+u/2),t.beginPath(),this.borderColor?t.strokeStyle=this.borderColor:t.strokeStyle=p,t.moveTo(r,n),t.lineTo(s,o),t.stroke();var d=t.lineWidth;if(this.highlighted?(this.stx.canvasColor("stx_annotation_highlight_bg",t),t.fillRect(l-d,h-u/2-d,c+2*d,u+2*d)):this.fillColor?(t.fillStyle=this.fillColor,t.fillRect(l,h-u/2,c,u)):this.stem&&(t.fillStyle=this.stx.containerColor,t.fillRect(l,h-u/2,c,u)),this.borderColor&&(t.beginPath(),t.strokeStyle=this.highlighted?this.stx.getCanvasColor("stx_highlight_vector"):this.borderColor,t.rect(l-d,h-u/2-d,c+2*d,u+2*d),t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=p,h+=this.padding/2,!this.ta)for(var m=0;m<this.arr.length;m++)t.fillText(this.arr[m],l+this.padding,h-u/2+this.fontSize/2),h+=this.fontSize+2;t.textBaseline="alphabetic"}}},e.Drawing.annotation.prototype.onChange=function(t){},e.Drawing.annotation.prototype.edit=function(t,i){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.controls.annotationSave,s=this.stx.controls.annotationCancel;if(r&&s){var n=this.stx,o=this.ta;n.editingAnnotation=!0,n.undisplayCrosshairs(),n.openDialog="annotation",o||((o=this.ta=document.createElement("TEXTAREA")).className="stx_annotation",o.onkeyup=m(this),o.onmouseup=function(t){return function(i){t.manageTouchAndMouse&&e.ChartEngine.drawingLine&&t.mouseup(i)}}(n),o.setAttribute("wrap","hard"),e.isIOS7or8&&o.setAttribute("placeholder","Enter Text"),n.chart.container.appendChild(o),o.style.position="absolute",o.style.width="100px",o.style.height="20px",o.value=this.text,(e.ipad||e.iphone)&&(o.ontouchstart=function(t){t.stopPropagation()}));var l=this;if(o.oninput=function(t){"historyUndo"!=t.inputType&&"historyRedo"!=t.inputType&&l.onChange(t)},o.style.font=this.fontString,this.color)if("transparent"==this.color||"auto"==this.color){var h=getComputedStyle(o);h&&e.isTransparent(h.backgroundColor)?o.style.color=n.defaultColor:o.style.color="#000"}else o.style.color=this.color;var c=n.pixelFromTick(this.p0[0],a.chart),u=n.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]);if(o.style.left=c+140<n.chart.canvasRight?c+"px":n.chart.canvasRight-200+"px",o.style.top=u+60<n.chart.canvasHeight?u-(isNaN(this.h)?this.defaultHeight:this.h/2)+"px":u-60+"px","callout"==this.name&&(o.style.left=e.stripPX(o.style.left)-(isNaN(this.w)?this.defaultWidth:this.w/2)+"px"),e.safeClickTouch(r,function(t){return function(i){if(""!==t.ta.value){t.text=t.ta.value;var a=t.stx;a.editingAnnotation=!1,t.adjust(),a.drawingSnapshot?a.undoStamp(e.shallowClone(a.drawingSnapshot),a.exportDrawings()):a.addDrawing(t),a.undo(),a.cancelTouchSingleClick=!0,a.changeOccurred("vector")}}}(this)),e.safeClickTouch(s,function(t){return function(e){var i=t.stx;i.editingAnnotation=!1,i.undo(),i.cancelTouchSingleClick=!0}}(this)),m(this)(),r.style.display="inline-block",s.style.display="inline-block",i&&(n.drawingSnapshot=n.exportDrawings(),this.hidden=!0,n.draw(),n.activeDrawing=this,e.ChartEngine.drawingLine=!0,t=n.chart.tempCanvas.context,n.chart.tempCanvas.style.display="block",this.w=o.clientWidth,this.h=o.clientHeight,e.clearCanvas(t.canvas,n),this.render(t),this.edit(t)),o.focus(),e.isAndroid&&!e.is_chrome&&!e.isFF){this.priorBottom=n.chart.container.style.bottom;var p=n.resolveY(u)+100;if(p>e.pageHeight()-400){var d=400-(e.pageHeight()-p);n.chart.container.style.bottom=d+"px"}}}}function m(t){return function(i){if(i)switch(window.event?event.keyCode:i.keyCode){case 27:return void t.stx.undo()}var a=t.stx,n=t.ta,o=n.value.split("\n"),l=0;a.chart.context.font=t.fontString;for(var h=0;h<o.length;h++){var c=a.chart.context.measureText(o[h]).width;c>l&&(l=c)}var u=(o.length+1)*(t.fontSize+3);l<50&&(l=50),n.style.width=l+30+"px",n.style.height=u+"px";var p=parseInt(e.stripPX(n.style.top),10),d=e.stripPX(n.style.left);l=n.clientWidth,u=n.clientHeight,d+l+100<t.stx.chart.canvasWidth?(r.style.top=p+"px",s.style.top=p+"px",r.style.left=d+l+10+"px",s.style.left=d+l+60+"px"):p+u+30<t.stx.chart.canvasHeight?(r.style.top=p+u+10+"px",s.style.top=p+u+10+"px",r.style.left=d+"px",s.style.left=d+50+"px"):(r.style.top=p-35+"px",s.style.top=p-35+"px",r.style.left=d+"px",s.style.left=d+50+"px")}}},e.Drawing.annotation.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.adjust(),this.edit(t),!1}},e.Drawing.annotation.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}},e.Drawing.annotation.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;var s=this.stx.pixelFromTick(this.p0[0],r.chart),n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1])-this.h/2,o=s+this.w,l=n+this.h;this.stem&&this.stem.x&&(s+=this.stem.x,o+=this.stem.x,n+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h+a.r>=s&&h-a.r<=o&&c+a.r>=n&&c-a.r<=l&&(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.annotation.prototype.abort=function(){var t=this.stx.controls.annotationSave,i=this.stx.controls.annotationCancel;t&&(t.style.display="none"),i&&(i.style.display="none"),this.ta&&this.stx.chart.container.removeChild(this.ta),this.ta=null,this.stx.openDialog="",this.stx.showCrosshairs(),this.stx.editingAnnotation=!1,e.clearCanvas(this.stx.chart.tempCanvas,this.stx),!e.isAndroid||e.is_chrome||e.isFF||(this.stx.chart.container.style.bottom=this.priorBottom),e.fixScreen()},e.Drawing.annotation.prototype.reconstruct=function(t,i){this.stx=t,this.color=i.col,this.panelName=i.pnl,this.d0=i.d0,this.tzo0=i.tzo0,this.v0=i.v0,this.text=t.escapeOnSerialize?decodeURIComponent(i.text):i.text,this.stem=i.stem,this.borderColor=i.bc,this.fillColor=i.bg,this.lineWidth=i.lw,this.pattern=i.ptrn,this.font=e.replaceFields(i.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.font||(this.font={}),this.adjust()},e.Drawing.annotation.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,d0:this.d0,tzo0:this.tzo0,v0:this.v0,text:this.stx.escapeOnSerialize?encodeURIComponent(this.text):this.text};if(this.font){var i=e.removeNullValues(e.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}));e.isEmpty(i)||(t.fnt=i)}return this.stem&&(t.stem={d:this.stem.d,v:this.stem.v,x:this.stem.x,y:this.stem.y}),this.borderColor&&(t.bc=this.borderColor),this.fillColor&&(t.bg=this.fillColor),this.lineWidth&&(t.lw=this.lineWidth),this.pattern&&(t.ptrn=this.pattern),t},e.Drawing.annotation.prototype.renderText=function(){this.getFontString();var t=this.stx.panels[this.panelName];if(t){this.arr=this.text.split("\n");var i=0;this.stx.chart.context.font=this.fontString;for(var a=0;a<this.arr.length;a++){var r=this.stx.chart.context.measureText(this.arr[a]).width;r>i&&(i=r)}0===i&&(i=2*this.defaultWidth),this.fontSize=e.stripPX(this.fontDef.size);var s=this.arr.length*(this.fontSize+2);e.touchDevice&&(s+=5),this.w=i+2*this.padding,this.h=s+2*this.padding;var n=this.stx.pixelFromTick(this.p0[0],t.chart)+i,o=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1])+s;this.p1=[this.stx.tickFromPixel(n,t.chart),this.stx.valueFromPixel(o,t)],this.stem&&this.stem.d&&(this.stem.t=this.stx.tickFromDate(this.stem.d,t.chart))}},e.Drawing.annotation.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.renderText())},e.Drawing.segment=function(){this.name="segment"},e.Drawing.segment.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.segment.prototype.render=function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),s=this.stx.pixelFromTick(this.p1[0],a.chart),n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(a,this.p1[0],this.p1[1]),l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l};if("none"==c.pattern&&(c.pattern="solid"),this.stx.plotLine(r,s,n,o,h,this.name,t,a,c),this.axisLabel&&!this.repositioner)if("horizontal"==this.name){this.stx.endClip();var u=this.p0[1];a.chart.transformFunc&&(u=a.chart.transformFunc(this.stx,a.chart,u)),u=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,u):this.stx.formatYAxisPrice(u,a),this.stx.createYAxisLabel(a,u,n,h),this.stx.startClip(a.name)}else if("vertical"==this.name&&this.p0[0]>=0&&!this.stx.chart.xAxis.noDraw){var p,d;if(p=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))p.setHours(0,0,0,0);else{var m=1e3*p.getSeconds()+p.getMilliseconds();this.stx.displayZone&&(d=new i.Date(p.getTime(),this.stx.displayZone),p=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()),p=new Date(p.getTime()+m))}var g=e.mmddhhmm(e.yyyymmddhhmm(p));if(a.chart.xAxis.formatter)g=a.chart.xAxis.formatter(p,this.name,null,null,g);else if(this.stx.internationalizer){var f;0!==p.getHours()||0!==p.getMinutes()?(f=this.stx.internationalizer.monthDay.format(p),f+=" "+this.stx.internationalizer.hourMinute.format(p)):f=this.stx.internationalizer.yearMonthDay.format(p),g=f}this.stx.endClip(),this.stx.createXAxisLabel(a,g,r,h,null,!0),this.stx.startClip(a.name)}if(this.highlighted&&"horizontal"!=this.name&&"vertical"!=this.name){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,r,n,y),this.littleCircle(t,s,o,v)}}},e.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,!1)},e.Drawing.segment.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r=this.name;if("horizontal"!=r&&"vertical"!=r&&"gartley"!=r){var s={0:this.p0,1:this.p1};for(var n in s)if(this.pointIntersection(s[n][0],s[n][1],a))return this.highlighted="p"+n,{action:"drag",point:"p"+n}}return"horizontal"!=r&&"vertical"!=r||(r="line"),this.lineIntersection(t,i,a,r)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.segment.prototype.configs=["color","lineWidth","pattern"],e.Drawing.segment.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t),"none"==this.pattern&&-1==this.configs.indexOf("fillColor")&&(this.pattern="solid")},e.Drawing.segment.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.continuous=function(){this.name="continuous",this.dragToDraw=!1,this.maxSegments=null},e.Drawing.continuous.ciqInheritsFrom(e.Drawing.segment),e.Drawing.continuous.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(this.copyConfig(),!this.penDown)return this.setPoint(0,i,a,r.chart),this.penDown=!0,!1;if(this.accidentalClick(i,a))return this.stx.undo(),!0;this.setPoint(1,i,a,r.chart);var s=new(0,e.Drawing.segment),n=this.serialize(this.stx);return s.reconstruct(this.stx,n),this.stx.addDrawing(s),this.stx.changeOccurred("vector"),this.stx.draw(),this.segment++,this.maxSegments&&this.segment>this.maxSegments?!0:(this.setPoint(0,i,a,r.chart),!1)}},e.Drawing.line=function(){this.name="line"},e.Drawing.line.ciqInheritsFrom(e.Drawing.segment),e.Drawing.line.prototype.dragToDraw=!1,e.Drawing.line.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]};i.x0>i.x1&&(i={x0:this.p1[0],y0:this.p1[1],x1:this.p0[0],y1:this.p0[1]});var a=i.x0-1e3,r=i.x1+1e3;this.v0B=e.yIntersection(i,a),this.v1B=e.yIntersection(i,r),this.d0B=this.stx.dateFromTick(a,t.chart),this.d1B=this.stx.dateFromTick(r,t.chart)}},e.Drawing.line.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.calculateOuterSet(a),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.line.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.v1=e.v1,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,e.d0B&&(this.d0B=e.d0B,this.d1B=e.d1B,this.v0B=e.v0B,this.v1B=e.v1B),this.adjust()},e.Drawing.line.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return this.d0B&&(t.d0B=this.d0B,t.d1B=this.d1B,t.v0B=this.v0B,t.v1B=this.v1B),t},e.Drawing.line.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&(this.setPoint(0,this.d0B,this.v0B,t.chart),this.setPoint(1,this.d1B,this.v1B,t.chart)))},e.Drawing.ray=function(){this.name="ray"},e.Drawing.ray.ciqInheritsFrom(e.Drawing.line),e.Drawing.ray.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]},a=i.x1+1e3;i.x0>i.x1&&(a=i.x1-1e3),this.v0B=this.v0,this.v1B=e.yIntersection(i,a),this.d0B=this.d0,this.d1B=this.stx.dateFromTick(a,t.chart)}},e.Drawing.ray.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&this.setPoint(1,this.d1B,this.v1B,t.chart))},e.Drawing.horizontal=function(){this.name="horizontal"},e.Drawing.horizontal.ciqInheritsFrom(e.Drawing.segment),e.Drawing.horizontal.prototype.dragToDraw=!1,e.Drawing.horizontal.prototype.measure=function(){},e.Drawing.horizontal.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.setPoint(0,e,i,a.chart),!0},e.Drawing.horizontal.prototype.intersected=function(t,e,i){if(this.lineIntersection(t,e,i,"line")){var a=this.stx.chart.dataSet.length,r=this.p0[1];return this.highlighted=!0,{action:"move",p0:[a-2,r],p1:[a-1,r],tick:t,value:e}}return null},e.Drawing.horizontal.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.d0=e.d0,this.tzo0=e.tzo0,this.axisLabel=e.al,this.adjust()},e.Drawing.horizontal.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,v0:this.v0,d0:this.d0,tzo0:this.tzo0,al:this.axisLabel}},e.Drawing.horizontal.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0]+100,this.p0[1]])},e.Drawing.horizontal.prototype.configs=["color","lineWidth","pattern","axisLabel"],e.Drawing.vertical=function(){this.name="vertical"},e.Drawing.vertical.ciqInheritsFrom(e.Drawing.horizontal),e.Drawing.vertical.prototype.measure=function(){},e.Drawing.vertical.prototype.intersected=e.Drawing.segment.prototype.intersected,e.Drawing.vertical.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0],this.p0[1]+1])},e.Drawing.measure=function(){this.name="measure"},e.Drawing.measure.ciqInheritsFrom(e.Drawing.segment),e.Drawing.measure.prototype.click=function(t,e,i){return this.copyConfig(),this.penDown?(this.stx.undo(),this.penDown=!1,!0):(this.p0=[e,i],this.penDown=!0,!1)},e.Drawing.rectangle=function(){this.name="rectangle"},e.Drawing.rectangle.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.rectangle.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=Math.round(Math.min(a,r))+.5,l=Math.min(s,n),h=Math.max(a,r)-o,c=Math.max(s,n)-l,u=this.color;this.highlighted&&(u=this.stx.getCanvasColor("stx_highlight_vector"));var p=this.fillColor;p&&!e.isTransparent(p)&&"auto"!=p&&(t.beginPath(),t.rect(o,l,h,c),t.fillStyle=p,t.globalAlpha=.2,t.fill(),t.closePath(),t.globalAlpha=1);var d={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&"none"==d.pattern&&(d.pattern="solid",.1==d.lineWidth&&(d.lineWidth=1)),this.stx.plotLine(a,r,s,s,u,"segment",t,i,d),this.stx.plotLine(r,r,s-.5,n+.5,u,"segment",t,i,d),this.stx.plotLine(r,a,n,n,u,"segment",t,i,d),this.stx.plotLine(a,a,n+.5,s-.5,u,"segment",t,i,d),this.highlighted){var m="p0"==this.highlighted,g="p1"==this.highlighted;this.littleCircle(t,a,s,m),this.littleCircle(t,r,n,g)}}},e.Drawing.rectangle.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r={0:this.p0,1:this.p1};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(t,i,a)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.rectangle.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.rectangle.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.ellipse=function(){this.name="ellipse"},e.Drawing.ellipse.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.ellipse.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=a-(r-a),l=r,h=s,c=n,u=s-(n-s),p=(c-u)/6,d=this.lineWidth;d||(d=1.1);var m=this.color;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.highlighted&&(m=this.stx.getCanvasColor("stx_highlight_vector"),.1==d&&(d=1.1));var g=this.fillColor;if(t.beginPath(),t.moveTo(o,h),t.bezierCurveTo(o,c+p,l,c+p,l,h),t.bezierCurveTo(l,u-p,o,u-p,o,h),g&&!e.isTransparent(g)&&"auto"!=g&&(t.fillStyle=g,t.globalAlpha=.2,t.fill(),t.globalAlpha=1),m&&"none"!=this.pattern&&(t.strokeStyle=m,t.lineWidth=d,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(d,this.pattern)),t.lineDashOffset=0),t.stroke()),t.closePath(),this.highlighted){var f="p1"==this.highlighted;this.littleCircle(t,r,n,f)}}},e.Drawing.ellipse.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p1[0],this.p1[1],a))return this.highlighted="p1",{action:"drag",point:"p1"};var r=this.p0[0]-(this.p1[0]-this.p0[0]),s=this.p1[0],n=this.p1[1],o=this.p0[1]-(this.p1[1]-this.p0[1]);return!(a.x0>Math.max(r,s)||a.x1<Math.min(r,s))&&(!(a.y1>Math.max(o,n)||a.y0<Math.min(o,n))&&(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}))},e.Drawing.ellipse.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.ellipse.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.ellipse.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.fibonacci=function(){this.name="fibonacci",this.configurator="fibonacci"},e.Drawing.fibonacci.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.fibonacci.mapping={trend:"t",color:"c",parameters:"p",pattern:"pt",opacity:"o",lineWidth:"lw",level:"l",extendLeft:"e",printLevels:"pl",printValues:"pv",timezone:"tz",display:"d"},e.Drawing.fibonacci.prototype.recommendedLevels=[-.618,-.382,0,.382,.5,.618,1,1.382,1.618],e.Drawing.fibonacci.prototype.configs=["color","fillColor","lineWidth","pattern","parameters"],e.Drawing.fibonacci.prototype.initializeSettings=function(t){var e=this.recommendedLevels;if(e)for(var i=t.currentVectorParameters.fibonacci.fibs,a=0;a<i.length;a++){delete i[a].display;for(var r=0;r<e.length;r++)i[a].level==e[r]&&(i[a].display=!0)}},e.Drawing.fibonacci.prototype.setOuter=function(){var t=this.stx,i=t.panels[this.panelName];if(i){var a=Math.max(this.p0[1],this.p1[1]),r=Math.min(this.p0[1],this.p1[1]),s=a-r;this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var n=t.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=t.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=t.pixelFromTick(this.p0[0],i.chart),h=t.pixelFromTick(this.p1[0],i.chart),c=0,u=1,p=0;p<this.parameters.fibs.length;p++){var d=this.parameters.fibs[p];if(!(d.level>=c&&d.level<=u)&&d.display){var m=t.pixelFromValueAdjusted(i,this.p0[0],o<n?a-s*d.level:r+s*d.level),g=e.xIntersection({x0:l,x1:h,y0:n,y1:o},m);d.level<c?(c=d.level,this.outer.p1[1]=t.valueFromPixel(m,i),this.outer.p1[0]=t.tickFromPixel(g,i.chart)):d.level>u&&(u=d.level,this.outer.p0[1]=t.valueFromPixel(m,i),this.outer.p0[0]=t.tickFromPixel(g,i.chart))}}}},e.Drawing.fibonacci.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?this.dragToDraw:(this.setPoint(1,i,a,r.chart),this.setOuter(),this.parameters=e.clone(this.parameters),this.penDown=!1,!0):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibonacci.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=Math.max(this.p0[1],this.p1[1]),s=Math.min(this.p0[1],this.p1[1]),n=a.flipped?s-r:r-s,o=this.stx.pixelFromTick(this.p0[0],i.chart),l=this.stx.pixelFromTick(this.p1[0],i.chart),h=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),c=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),u=Math.min(c,h),p=Math.max(c,h),d=p-u,m=(c-h)/(l-o)>0;this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var g=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var f=t.measureText("161.8%").width+10,y=Number.MAX_VALUE,v=Number.MAX_VALUE,x=-1*Number.MAX_VALUE,b=-1*Number.MAX_VALUE,S=this.color;("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor),this.rays=[];for(var C=0;C<this.parameters.fibs.length;C++){t.textAlign="left",t.fillStyle=S;var w=this.parameters.fibs[C];if(w.display){var T=this.stx.pixelFromValueAdjusted(i,this.p0[0],c<h?r-n*w.level:s+n*w.level),k=e.xIntersection({x0:o,x1:l,y0:h,y1:c},T),D=this.parameters.extendLeft?0:k,M=i.left+i.width;if(this.parameters.printLevels){var A=Math.round(1e3*w.level)/10+"%";M-=f,this.parameters.printValues&&(t.fillStyle=S,this.stx.canvasFont("stx_yaxis",t)),M<D&&(t.textAlign="right"),t.fillText(A,M,T),M<D?M+=5:M-=5}if(this.parameters.printValues&&k<i.width){var F=this.stx.transformedPriceFromPixel(T,i);F=a.priceFormatter?a.priceFormatter(this.stx,i,F):this.stx.formatYAxisPrice(F,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,F,T,S,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var P=w.color;("auto"==P||e.isTransparent(P))&&(P=this.color),("auto"==P||e.isTransparent(P))&&(P=this.stx.defaultColor);var _=w.color;("auto"==_||e.isTransparent(_))&&(_=this.fillColor),("auto"==_||e.isTransparent(_))&&(_=this.stx.defaultColor),t.fillStyle=_;var E=e.clone(w.parameters);this.highlighted&&(E.opacity=1),this.stx.plotLine(D,M,T,T,this.highlighted?g:P,"segment",t,i,E),this.rays.push([[D,T],[M,T]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(M,T),t.lineTo(D,T),D?t.lineTo(l,c):t.lineTo(D,c),t.lineTo(M,c),void 0!==_&&t.fill(),t.globalAlpha=1,T<v&&(y=k,v=T),T>b&&(x=k,b=T)}}for(var L=0;L<=1;L++){var N=m?p-d*L:u+d*L;(N=Math.round(N))<v&&(y=e.xIntersection({x0:o,x1:l,y0:h,y1:c},N),v=N),N>b&&(x=e.xIntersection({x0:o,x1:l,y0:h,y1:c},N),b=N)}var R=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(R.opacity=1),this.stx.plotLine(y,x,v,b,g,"segment",t,i,R),this.highlighted){var O="p0"==this.highlighted,I="p1"==this.highlighted;this.littleCircle(t,o,h,O),this.littleCircle(t,l,c,I)}}}},e.Drawing.fibonacci.prototype.reposition=function(t,i,a,r){i&&(e.Drawing.BaseTwoPoint.prototype.reposition.apply(this,arguments),this.adjust())},e.Drawing.fibonacci.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1;if(!r||!s)return null;var n={0:r,1:s};for(var o in n)if(this.pointIntersection(n[o][0],n[o][1],a))return this.highlighted="p"+o,{action:"drag",point:"p"+o};var l=this.outer,h=this.rays,c=l&&this.lineIntersection(t,i,a,"segment",l.p0,l.p1);if(!c)for(var u=0;u<h.length;u++)if(this.lineIntersection(t,i,a,"ray",h[u][0],h[u][1],!0)){c=!0;break}return c?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},e.Drawing.fibonacci.prototype.reconstruct=function(t,i){i=e.replaceFields(i,e.reverseObject(e.Drawing.fibonacci.mapping)),this.stx=t,this.parameters=i.parameters,this.parameters||(this.parameters=e.clone(this.stx.currentVectorParameters.fibonacci)),this.color=i.col,this.fillColor=i.fc,this.panelName=i.pnl,this.d0=i.d0,this.d1=i.d1,this.d2=i.d2,this.tzo0=i.tzo0,this.tzo1=i.tzo1,this.tzo2=i.tzo2,this.v0=i.v0,this.v1=i.v1,this.v2=i.v2,this.adjust()},e.Drawing.fibonacci.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setOuter())},e.Drawing.fibonacci.prototype.serialize=function(){var t={name:this.name,parameters:this.parameters,pnl:this.panelName,col:this.color,fc:this.fillColor,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2};return e.replaceFields(t,e.Drawing.fibonacci.mapping)},e.Drawing.retracement=function(){this.name="retracement"},e.Drawing.retracement.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.getDrawingToolList=function(t){var i={},a={ciqInheritsFrom:!0,stxInheritsFrom:!0,copyConfig:!0,getDrawingParameters:!0,getDrawingToolList:!0,initializeSettings:!0,restoreDefaultConfig:!0,saveConfig:!0,updateSource:!0,BaseTwoPoint:!0,shape:!0};for(var r in e.extend(a,t),e.Drawing)a[r]||(i[(new e.Drawing[r]).name]=r);return i},t},__js_standard_i18n_=function(t){var e=t.CIQ;return e.I18N=function(){},e.I18N.hereDoc=function(t){return t.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},e.I18N.language="en",e.I18N.longMonths={zh:!0},e.I18N.reverseColorsByLocale={zh:!0,ja:!0},e.I18N.findAllTextNodes=function(t){if(t||(t=document.body),t==document.body&&!document.querySelector(".ciq_stashed_texts")){var i=document.createElement("div");i.className="ciq_stashed_texts",i.style.display="none",t.appendChild(i);for(var a=document.querySelectorAll("input,textarea,.editable_content"),r=0;r<a.length;r++){var s=a[r].getAttribute("placeholder");if(s){var n=i.appendChild(document.createElement("translate"));n.setAttribute("original",s),n.placeholderFor=a[r],n.appendChild(document.createTextNode(s))}}}for(var o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),l=o.nextNode(),h=new RegExp("^\\s*$"),c=new RegExp("\n|\t|\f","g"),u={},p={SCRIPT:!0,STYLE:!0,TEXTAREA:!0};l;){var d=l.nodeValue;if(!h.test(d)){var m=l.parentNode,g=m.tagName;if(!p[g]){if("TRANSLATE"!=g){var f=m.insertBefore(document.createElement("translate"),l);f.setAttribute("original",d),f.appendChild(l)}else d=m.getAttribute("original");c.test(d)&&(d=d.replace(c,"")),u[d]||(u[d]=[]),u[d].push(l)}}l=o.nextNode()}if(t==document.body){var y=e.Studies?e.Studies.studyLibrary:null;if(y)for(var v in y){null===u[v]&&(u[v]=[]);var x=y[v];if(x.inputs)for(var b in x.inputs)u[b]||(u[b]=[]);if(x.outputs)for(var S in x.outputs)u[S]||(u[S]=[])}}return u},e.I18N.missingWordList=function(t){t||(t=e.I18N.language);var i=e.I18N.findAllTextNodes(),a={},r=e.I18N.wordLists[t];r||(r={});var s,n,o=function(t){void 0===r[t]&&(a[t]="")};for(var l in i)o(l);if(!e.Studies||!e.Studies.studyLibrary)return a;for(var h in e.Studies.studyLibrary){for(var c in o((s=e.Studies.studyLibrary[h]).name),s.inputs)switch(o(c),n=s.inputs[c],Object.prototype.toString.call(n)){case"[object String]":o(n);break;case"[object Array]":for(var u=0;u<n.length;++u)o(n[u])}for(var p in s.outputs)o(p)}return o("Show Zones"),o("OverBought"),o("OverSold"),o("Panel"),o("Show as Underlay"),o("Y-Axis"),o("Invert Y-Axis"),a},e.I18N.printableMissingWordList=function(t){var i=JSON.stringify(e.I18N.missingWordList(t));return i=i.replace(/","/g,'",\n"')},e.I18N.translateUI=function(t,i){if("pu"==t&&(t="pt"),e.I18N.wordLists){t||(t=e.I18N.language);var a=e.I18N.findAllTextNodes(i),r=e.I18N.wordLists[t];if(r)for(var s in a)for(var n=e.I18N.translateSections(s,r),o=a[s],l=0;l<o.length;l++){var h=o[l],c=h.parentNode,u=c.getAttribute("original");","!==n&&n||(n=u);var p=c.placeholderFor;p?p.placeholder=n:h.data=n}}},e.I18N.translate=function(t,i){if(i||(i=e.I18N.language),!e.I18N.wordLists)return console.log("Must include translations.js in order to use CIQ.I18N.translate()"),t;var a=e.I18N.wordLists[i],r=null;return a&&(r=e.I18N.translateSections(t,a)||t),","===r?t:r},e.I18N.translateSections=function(t,e){if("string"==typeof t&&-1!=t.indexOf("‌")){var i=(t=t.replace(/([(),])/g,"‌$1‌")).split("‌");return i.forEach(function(t,i,a){var r=t.match(/^(\s*).*\S(\s*)$/),s=e[t.trim()];s&&(r&&(s=r[1]+s+r[2]),a[i]=s)}),i.join("")}return e[t]},e.I18N.convertCSV=function(t){var i=new RegExp("[“”]|[‘’]","g"),a=new RegExp('^(")|(")$',"g"),r=e.I18N.wordLists;if(t||(t=e.I18N.csv),t){for(var s=t.split("\n"),n=s[0].split(","),o=0;o<n.length;o++){var l=n[o];r[l]||(r[l]={})}for(var h=1;h<s.length;h++){var c=s[h].match(/(".*?"|[^",]+)(?=\s*,|\s*$)|(,(?=,))/g)||[],u=c[0];a.test(u)&&(u=u.replace(a,"")),i.test(u)&&(u=u.replace(i,'"'));for(var p=1;p<c.length;p++){var d=c[p];a.test(d)&&(d=d.replace(a,"")),r[n[p]][u]=d}}}},e.I18N.setLanguage=function(t,i,a,r,s){"pu"==i&&(i="pt"),e.I18N.convertCSV(r),e.I18N.language=i,e.I18N.translateUI(i,s),a||(a=e.I18N.translate),t.translationCallback=a},e.I18N.setLocale=function(t,e,i,a,r){if("undefined"==typeof Intl||!Intl.__addLocaleData)return t.setLocale(e,r),void(i&&i(null));var s=(a=void 0===a?"locale-data/jsonp":a)+"/"+e+".js",n=document.createElement("SCRIPT");n.async=!0,n.src=s;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o.nextSibling),n.onload=function(){t.setLocale(e,r),i&&i(null)},n.onerror=function(){i&&i("cannot load script")}},e.I18N.createMonthArrays=function(t,i,a){t.monthAbv=[],t.monthLetters=[];var r=new Date,s=!0;e.I18N.longMonths&&e.I18N.longMonths[a]&&(s=!1);for(var n=0;n<12;n++){r.setDate(1),r.setMonth(n);var o=i.format(r);if(s){for(var l="",h=0;h<o.length;h++){var c=o.charAt(h);c.charCodeAt(0)<65||(l+=c)}t.monthAbv[n]=l,t.monthLetters[n]=l[0]}else t.monthAbv[n]=o,t.monthLetters[n]=o}},e.I18N.localize=function(t,e){var i=t.locale,a=this.reverseColorsByLocale[e],r=this.reverseColorsByLocale[i];this.setLocale(t,e),this.setLanguage(t,e),a&&r||(a||r)&&this.reverseCandles(t)},e.I18N.reverseCandles=function(t){var e=t.styles,i=t.cloneStyle(e.stx_candle_down),a=t.cloneStyle(e.stx_candle_up);e.stx_candle_up=i,e.stx_candle_down=a},e.I18N.wordLists={en:{}},e.I18N.languages={en:"English"},t},__js_standard_markers_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.makeMarkerHelper=function(){this.markerHelper={chartMap:{},classMap:{},domMarkers:[],highlighted:[]}},e.ChartEngine.prototype.addToHolder=function(t){var e=this.panels[t.params.panelName];if(e){this.markerHelper||this.makeMarkerHelper();var i=t.params,a=t.node,r=t.stxNodeCreator;r&&r.prepareForHolder&&(a=r.prepareForHolder(t)),i.chartContainer?this.container.appendChild(t.node):i.includeAxis?e.holder.appendChild(t.node):e.subholder.appendChild(a),t.chart=e.chart,r&&r.addToHolder&&r.addToHolder(t)}},e.ChartEngine.prototype.getMarkerArray=function(t,e){var i=[];for(var a in this.markers)for(var r=0;r<this.markers[a].length;r++){var s=this.markers[a][r];"panelName"==t?s.params.panelName==e&&i.push(s):"label"==t?a==e&&i.push(s):"all"==t&&i.push(s)}return i},e.ChartEngine.prototype.removeFromHolder=function(t){var e=this.panels[t.params.panelName];e&&(t.node.parentNode==e.holder?e.holder.removeChild(t.node):t.node.parentNode==e.subholder?e.subholder.removeChild(t.node):t.node.parentNode==this.container&&this.container.removeChild(t.node));var i=this.markers[t.params.label];if(i){var a;for(a=0;a<i.length;a++)if(i[a]===t){i.splice(a,1);break}var r=this.markerHelper.chartMap[t.chart.name];if(r)for(a=0;a<r.markers.length;a++)if(r.markers[a]===t){r.markers.splice(a,1);break}var s=this.markerHelper.classMap[t.className];if(s){var n=s[t.params.panelName];if(n)for(a=0;a<n.length;a++)if(n[a]===t){n.splice(a,1);break}}}},e.ChartEngine.prototype.moveMarkers=function(t,e){for(var i=this.getMarkerArray("panelName",t),a=0;a<i.length;a++)i[a].params.panelName=e;for(var r in this.markerHelper.classMap){var s=this.markerHelper.classMap[r][t];s&&(this.markerHelper.classMap[r][e]=s,delete this.markerHelper.classMap[r][t])}},e.ChartEngine.prototype.establishMarkerTicks=function(){this.markerHelper||this.makeMarkerHelper();var t=this.markerHelper.chartMap;for(var e in t){var i=t[e];if(i.dataSetLength!=this.charts[e].dataSet.length)for(var a=0;a<i.markers.length;a++)this.setMarkerTick(i.markers[a])}},e.ChartEngine.prototype.futureTickIfDisplayed=function(t){var e=t.chart;if(!(e.dataSet.length<1)){var i=e.xaxis[e.xaxis.length-1].DT;if(i=new Date(i.getTime()-6e4*this.timeZoneOffset),!(t.params.x>i))for(var a,r,s=e.maxTicks-e.dataSegment.length,n=e.dataSet.length+s,o=new Date(+e.dataSet[e.dataSet.length-1].DT),l=this.standardMarketIterator(o,null,e),h=t.params.x.getTime(),c=e.dataSet.length;c<n;c++){if(a=o.getTime(),(r=(o=l.next()).getTime())==h)return void(t.tick=c);if(r>h&&a<h)return void(t.tick=Math.max(c-1,0))}}},e.ChartEngine.prototype.setMarkerTick=function(t){var e=t.chart;if("master"==t.params.xPositioner&&t.params.x)t.tick=Math.floor(t.params.x/this.layout.periodicity);else if("date"==t.params.xPositioner&&t.params.x){for(var i,a,r=t.params.x.getTime(),s=0;s<e.dataSet.length;s++){if(i=a=e.dataSet[s].DT.getTime(),s>0&&(i=e.dataSet[s-1].DT.getTime()),a==r)return void(t.tick=s);if(a>r&&i<r)return void(t.tick=Math.max(s-1,0));if(r<a)return void(t.tick=null)}if(e.dataSet.length<1)return;new Date(+e.dataSet[s-1].DT).getTime()<r&&(t.params.future=!0),t.tick=null}},e.ChartEngine.prototype.positionMarkers=function(){var t=this,e=this.chart;if(t.markerHelper){this.markerDelay||0===this.markerDelay?this.markerTimeout||(this.markerTimeout=setTimeout(l,this.markerDelay)):l();for(var i=this.getMarkerArray("all"),a=0;a<i.length;a++){var r=i[a],s=r.stxNodeCreator,n=this.getFirstLastDataRecord(e.dataSegment,"tick").tick,o=this.getFirstLastDataRecord(e.dataSegment,"tick",!0).tick;n<=r.tick&&r.tick<=o?s&&s.drawMarker&&s.drawMarker(r):r.attached&&s.expand&&(s.expand.style.visibility="hidden")}}function l(){if(!t.runPrepend("positionMarkers",arguments)){for(var e in t.markerTimeout=null,t.markerHelper.classMap)for(var i in t.markerHelper.classMap[e]){var a=t.markerHelper.classMap[e][i],r=t.panels[i];if(a.length){var s={stx:t,arr:a,panel:r};s.firstTick=r.chart.dataSet.length-r.chart.scroll,s.lastTick=s.firstTick+r.chart.dataSegment.length;var n=a[0].constructor.placementFunction;n?n(s):t.defaultMarkerPlacement(s)}}t.runAppend("positionMarkers",arguments)}}},e.Marker=function(t){this.params={xPositioner:"date",yPositioner:"value",panelName:"chart",permanent:!1,label:"generic",includeAxis:!1},e.extend(this.params,t),this.params.node||(this.params.node=document.createElement("DIV"));var i=this.params.stx;if(i){this.className||(this.className="CIQ.Marker"),e.derivedFrom(this.params.node,e.Marker.NodeCreator)?(this.stxNodeCreator=this.params.node,this.node=this.stxNodeCreator.node):this.node=this.params.node,i.markerHelper||i.makeMarkerHelper();var a=this.params.label;i.markers[a]||(i.markers[a]=[]),i.markers[a].push(this);var r=i.panels[this.params.panelName];this.chart=r.chart,i.markerHelper.chartMap[this.chart.name]||(i.markerHelper.chartMap[this.chart.name]={dataSetLength:0,markers:[]}),i.markerHelper.chartMap[this.chart.name].markers.push(this);var s=i.markerHelper.classMap[this.className];s||(s=i.markerHelper.classMap[this.className]={}),s[this.params.panelName]||(s[this.params.panelName]=[]),s[this.params.panelName].push(this),this.stxNodeCreator&&this.stxNodeCreator.deferAttach||i.addToHolder(this),i.setMarkerTick(this),this.stxNodeCreator&&this.stxNodeCreator.drawMarker&&this.stxNodeCreator.drawMarker(this)}else console.log("Marker created without specifying stx")},e.Marker.prototype.remove=function(){this.params.stx.removeFromHolder(this)},e.Marker.prototype.click=function(t,e,i,a){if(this.params.stx){var r=this.params.node;r.click&&r.click(t,e,i,a)}},e.Marker.prototype.render=function(){var t=[this],e={stx:this.params.stx,arr:t,panel:this.params.stx.panels[this.params.panelName],showClass:this.showClass};this.constructor.placementFunction(e)},e.Marker.removeByLabel=function(t,e){for(var i=t.getMarkerArray("label",e),a=0;a<i.length;a++){var r=i[a];t.removeFromHolder(r),r.stxNodeCreator&&r.stxNodeCreator.remove&&r.stxNodeCreator.remove(r)}},e.Marker.positionContentVerticalAndHorizontal=function(t){var e=t.querySelectorAll(".stx-marker-expand")[0];if(e){var i=e.offsetWidth,a=e.offsetHeight;if(!i||!a)return;var r=e.style;r.left=r.right="",r.bottom=r.top="";var s=getComputedStyle(e),n=s.left,o=s.bottom,l=s.height,h=t.offsetLeft+parseInt(n,10),c=parseInt(o,10),u=parseInt(l,10),p=t.offsetTop+c-u,d=t.parentNode.offsetWidth,m=t.parentNode.offsetHeight;h+i>d&&(r.right=n,r.left="auto"),t.offsetTop<=m?p>m-a&&(r.top=m-t.offsetTop-a+"px",r.bottom="auto"):r.top=m+"px",t.offsetTop+t.offsetHeight>=0?p<0&&(r.top=-t.offsetTop+"px",r.bottom="auto"):r.bottom="0px"}},e.ChartEngine.prototype.getBarBounds=function(t){var e,i,a,r;this.layout.chartType;return e="pandf"==this.layout.aggregationType?{high:Math.max(t.pfOpen,t.pfClose),low:Math.min(t.pfOpen,t.pfClose)}:{high:t.High,low:t.Low},t.markerHigh&&(e.high=t.markerHigh),t.markerLow&&(e.low=t.markerLow),void 0===t.Open&&(i=t.Close),void 0===t.High&&(a=Math.max(t.Open||i,t.Close)),void 0===t.Low&&(r=Math.min(t.Open||i,t.Close)),e.high||0===e.high||(e.high=a),e.low||0===e.low||(e.low=r),e},e.ChartEngine.prototype.defaultMarkerPlacement=function(t){var i=t.panel,a=t.yAxis?t.yAxis:t.panel.yAxis,r=i.chart,s=t.stx,n=s.chart.highLowBars||s.highLowBars[s.layout.chartType],o=r.defaultPlotField;o&&!n||(o="Close");for(var l={},h=0;h<t.arr.length;h++){var c=t.arr[h],u=c.params;if(c.params.box)return;var p=c.node;c.clientWidth||(c.clientWidth=p.clientWidth),c.clientHeight||(c.clientHeight=p.clientHeight);var d=null,m=u.xPositioner,g=u.yPositioner,f=c.tick,y=r.dataSet,v=c.clientWidth;if("none"!=m){if("bar"==m&&u.x){if(u.x<r.xaxis.length){var x=r.xaxis[u.x];x&&(d=x.data)}p.style.left=Math.round(s.pixelFromBar(u.x,r)-v/2)+1+"px"}else{if(!f&&0!==f){if(!(u.future&&r.scroll<r.maxTicks)){p.style.left="-1000px";continue}if(s.futureTickIfDisplayed(c),!(f=c.tick)&&0!==f){p.style.left="-1000px";continue}}if(f<y.length&&(d=y[f]),c.leftpx=Math.round(s.pixelFromTick(f,r)-r.left-v/2),c.rightEdge=c.leftpx+v,p.style.left=c.leftpx+"px",f<t.firstTick&&c.rightEdge<r.left-50)continue}d||(d=y[y.length-1])}else if(g.indexOf("candle")>-1){var b=getComputedStyle(p).left;if(b){var S=s.barFromPixel(parseInt(b,10),r);S>=0&&((d=r.xaxis[S].data)||(d=y[y.length-1]))}}p.style.top="auto";var C,w=u.y,T=p.clientHeight;if("none"!=g){var k,D=g+"-"+p.style.left,M=u.chartContainer?s.height:i.yAxis.bottom,A=0;void 0===l[D]&&(l[D]=0),k=l[D],l[D]+=T,"value"!=g||!w&&0!==w?"below_candle"!=g&&"under_candle"!=g||!d?"on_candle"==g&&d?(C=d[o],n&&(C=(d.Low+d.High)/2),A=Math.round(M-s.pixelFromPrice(C,i,a)-T/2-k)+"px"):"top"==g?A=Math.round(M-T-k)+"px":"bottom"==g?A=Math.round(k)+"px":d&&(C=d[o],n&&(C=s.getBarBounds(d)[a.flipped?"low":"high"]),A=Math.round(M-s.pixelFromPrice(C,i,a)+k)+"px"):(C=d[o],n&&(C=s.getBarBounds(d)[a.flipped?"high":"low"]),A=Math.round(M-s.pixelFromPrice(C,i,a)-T-k)+"px"):A=Math.round(M-s.pixelFromPrice(w,i,a)-T/2)+"px",p.style.bottom!=A&&(p.style.bottom=A)}e.Marker.positionContentVerticalAndHorizontal(p)}},e.Marker.NodeCreator=function(){},e.Marker.NodeCreator.toNode=function(){return this.node},e.Marker.Simple=function(t){var i=this.node=document.createElement("div");i.className="stx-marker",e.appendClassName(i,t.type),t.category&&e.appendClassName(i,t.category);var a,r=e.newChild(i,"div","stx-visual");if(e.newChild(i,"div","stx-stem"),"callout"==t.type){var s=e.newChild(r,"div","stx-marker-content");e.newChild(s,"h4",null,t.headline),a=e.newChild(s,"div","stx-marker-expand"),e.newChild(a,"p",null,t.story)}else a=e.newChild(i,"div","stx-marker-expand"),e.newChild(a,"h4",null,t.headline),e.newChild(a,"p",null,t.story),e.safeClickTouch(a,function(t){e.toggleClassName(i,"highlight")});function n(){e.Marker.positionContentVerticalAndHorizontal(i)}e.safeClickTouch(r,function(t){e.toggleClassName(i,"highlight"),setTimeout(n,10)}),this.nodeType="Simple"},e.Marker.Simple.ciqInheritsFrom(e.Marker.NodeCreator,!1),t},__js_standard_quoteFeed_=function(t){t.CIQ||(t.CIQ={}),t.CIQ.ChartEngine||(t.CIQ.ChartEngine=function(){});var e=t.CIQ;function i(){}return i.fetchInitialData=function(t,e,i,a,r){},i.fetchUpdateData=function(t,e,i,a){},i.fetchPaginationData=function(t,e,i,a,r){},i.subscribe=function(t){},i.unsubscribe=function(t){},e.QuoteFeed=function(){},e.QuoteFeed.prototype.fetch=function(t,e){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},e.QuoteFeed.prototype.announceError=function(t,i){t.suppressErrors||i.suppressAlert||t.startDate||t.endDate||i.error&&e.alert("Error fetching quote:"+i.error)},e.QuoteFeed.prototype.multiFetch=function(t,i){0===t.length&&i([]);var a={counter:0,finished:t.length,results:[]};function r(t,e,i){return function(a){if(e.results.push({dataCallback:a,params:t}),e.counter++,e.counter>=e.finished){var r=e.results;e.results=[],i(r)}}}for(var s=0;s<t.length;s++){var n=t[s];n.stx.isEquationChart(n.symbol)?e.fetchEquationChart(n,r(n,a,i)):e.ChartEngine.Driver.fetchData(e.QuoteFeed.SERIES,this,n,r(n,a,i))}},e.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},e.QuoteFeed.Subscriptions.ciqInheritsFrom(e.QuoteFeed),e.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(t){for(var e,i,a=t.getSymbols({"breakout-equations":!0}),r=0;r<this.subscriptions.length;r++)this.subscriptions[r].match=!1;for(var s=0;s<a.length;s++){var n=(i=a[s]).interval;for("month"!=n&&"week"!=n||t.dontRoll||(n="day"),i.interval=n,i.period=1,i.match=!1,isNaN(i.interval)||(i.period=i.interval,i.interval=i.timeUnit,i.interval||(i.interval="minute")),delete i.periodicity,delete i.timeUnit,delete i.setSpan,r=0;r<this.subscriptions.length;r++){if((e=this.subscriptions[r]).symbol==i.symbol&&e.period==i.period&&e.interval==i.interval){i.match=!0,e.match=!0;break}e.symbol!=i.symbol?("period"!=i.reason&&(i.reason="symbol"),e.reason="symbol"):(i.reason="period",e.reason="period")}}var o=this;this.subscriptions=this.subscriptions.filter(function(e){return e.match||(e.stx||(e.stx=t),o.unsubscribe(e)),e.match}),a.forEach(function(e){e.match||(e.stx||(e.stx=t),e.reason||(e.reason="initialize"),o.subscribe(e),o.subscriptions.push(e))})},e.QuoteFeed.Subscriptions.prototype.fetch=function(t,e){var i=this;this.fetchFromSource(t,function(a){a.error||i.checkSubscriptions(t.stx),e(a)})},e.QuoteFeed.Subscriptions.prototype.subscribe=function(t){console.log("subscribe",t)},e.QuoteFeed.Subscriptions.prototype.unsubscribe=function(t){console.log("unsubscribe",t)},e.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(t,e){console.log("Please provide implementation of fetchFromSource")},e.QuoteFeed.prototype.requiresImmediateRefresh=function(t){return!1},e.ChartEngine.prototype.attachQuoteFeed=function(t,i){i||(i={}),this.quoteDriver&&this.quoteDriver.die(),"function"==typeof t.fetchInitialData||"function"==typeof t.fetchUpdateData||"function"==typeof t.fetchPaginationData?("function"!=typeof t.fetchPaginationData&&"function"!=typeof t.fetchUpdateData&&(i.noLoadMore=!0),t.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach(function(i){t[i]||!1===t[i]||(t[i]=e.QuoteFeed.prototype[i])}),"function"==typeof t.subscribe&&(t.checkSubscriptions=e.QuoteFeed.Subscriptions.prototype.checkSubscriptions,t.subscriptions=[]),this.quoteDriver=new e.ChartEngine.Driver(this,t,i)):this.quoteDriver=new e.ChartEngine.Driver(this,t,i)},e.ChartEngine.prototype.attachEngineQuoteFeed=function(t,e){console.log("CIQ.ChartEngine.attachEngineQuoteFeed is now Deprecated. Use CIQ.ChartEngine.attachQuoteFeed instead"),this.attachQuoteFeed(t,e)},e.ChartEngine.Driver=function(t,i,a){this.stx=t,this.quoteFeed=i,this.id=e.uniqueID(!0),a.maximumTicks||(a.maximumTicks=i.maxTicks?i.maxTicks:2e4),(!a.bufferSize||a.bufferSize<0)&&(a.bufferSize=0),a.bufferSize=Math.round(a.bufferSize),this.behavior=a,this.loadingNewChart=!1,this.intervalTimer=null,this.updatingChart=!1,this.updateChartLoop()},e.ChartEngine.Driver.prototype.die=function(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=-1)},e.ChartEngine.Driver.prototype.updateSubscriptions=function(){this.quoteFeed.checkSubscriptions&&this.quoteFeed.checkSubscriptions(this.stx)},e.ChartEngine.Driver.prototype.loadDependents=function(t,i,a){var r,s,n,o=t.stx,l=t.chart,h=l.series,c=(o.masterData,this),u=[],p={},d=a==e.QuoteFeed.UPDATE,m=a==e.QuoteFeed.PAGINATION;for(r in h){var g=(s=h[r]).parameters;if((t.future||d||!1!==s.moreAvailable)&&(!s.loading&&!1!==g.loadData&&(!d&&!m||s.endPoints&&Object.keys(s.endPoints).length)&&(!g.data||g.data.useDefaultQuoteFeed)&&(n=g.symbolObject).symbol)){var f=!0;d||(s.loading=!0);for(var y=0;y<u.length;y++)e.symbolEqual(u[y],n)&&(f=!1);f&&(u.push(n),p[n.symbol]=s.endPoints)}}for(var v=[],x=0;x<u.length;x++){n=u[x];var b=e.shallowClone(t.originalState);b.symbol=n.symbol,b.symbolObject=n,b.update||b.future?(b.endDate||(b.endDate=t.endDate),b.startDate=p[n.symbol].end):(b.startDate||(b.startDate=t.startDate),b.endDate=m&&!t.future?p[n.symbol].begin:t.endDate,b.ticks=t.ticks),v.push(b)}if(!v.length&&d)return o.createDataSet(null,null,{appending:t.appending||t.originalState.update}),t.nodraw||o.draw(),void(i&&i(null));this.quoteFeed.multiFetch(v,function(e){return function(r){for(var n=null,h=0;h<r.length;h++){var u=r[h],p=u.dataCallback.error;if(!p&&0!==p){for(var d=u.params.symbolObject,m=u.dataCallback,g=m.quotes,f=m.moreAvailable,y=o.getSeries({symbolObject:d}),v=!1,x=0;x<y.length;x++)s=y[x],e||(t.future?o.isHistoricalModeSet&&g.length<2&&(s.mostRecentForwardAttempt=new Date):s.moreAvailable=!1!==f&&(f||g.length>(u.params.endDate?1:0)),s.loading=!1),v=s.parameters.fillGaps||v;g=c.cleanup(o,s,g,a,t,v),o.updateChartData(g,l,{secondarySeries:d.symbol,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),g&&g.length&&(!n||n>g[0].DT)&&(n=g[0].DT)}}r.length&&(o.createDataSet(null,null,{appending:t.originalState.update||t.future,appendToDate:n}),t.nodraw||o.draw()),i&&i(null)}}(d))},e.ChartEngine.Driver.prototype.cleanup=function(t,i,a,r,s,n){if(t.doCleanupDates(a,t.layout.interval),!s.missingBarsCreated&&a&&a.length&&t.cleanupGaps&&!1!==n){var o,l,h=s.chart;if(i?(h=i,l=i.parameters.symbol||i.id):l=h.defaultPlotField,r!=e.QuoteFeed.PAGINATION||s.loadMoreReplace){if(r==e.QuoteFeed.UPDATE&&h.endPoints.end&&h.endPoints.end<a[0].DT){var c=t.getFirstLastDataRecord(t.masterData,l,!0);i&&(c=c[l]),a.unshift(c),o="shift"}}else if(h.endPoints.begin&&h.endPoints.begin>a[a.length-1].DT){var u=t.getFirstLastDataRecord(t.masterData,l,!1);i&&(u=u[l]),a.push(u),o="pop"}a=t.doCleanupGaps(a,s.chart,{cleanupGaps:n,noCleanupDates:!0}),o&&a[o]()}return a},e.ChartEngine.Driver.prototype.updateChart=function(){if(!this.updatingChart&&!this.loadingNewChart){var t=e.objLength(this.stx.charts),i=0,a=this.stx,r=a.layout.interval,s=a.layout.timeUnit;for(var n in a.charts){var o=a.charts[n];if(o.symbol){var l=this.makeParams(o.symbol,o.symbolObject,o);o.masterData&&o.masterData.length&&(l.startDate=o.endPoints.end),l.update=!0,l.originalState=e.shallowClone(l),this.updatingChart=!0;var h=c(this,l,o.symbol);a.isEquationChart(l.symbol)?e.fetchEquationChart(l,h):e.ChartEngine.Driver.fetchData(e.QuoteFeed.UPDATE,this.quoteFeed,l,h)}}}function c(n,o,l){return n.behavior.prefetchAction&&n.behavior.prefetchAction("updateChart"),function(h){i++;var c=o.chart;c.masterData;if(l!=c.symbol||r!=a.layout.interval||s!=a.layout.timeUnit||a.isHistoricalMode())n.updatingChart=!1;else{if(h.error)n.quoteFeed.announceError(o.originalState,h);else{var u=h.quotes;u=n.cleanup(a,null,u,e.QuoteFeed.UPDATE,o),a.updateChartData(u,c,{noCreateDataSet:!0,noCleanupDates:!0}),c.attribution=h.attribution}i==t&&(n.updatingChart=!1),n.behavior.callback&&n.behavior.callback(o),n.loadDependents(o,null,e.QuoteFeed.UPDATE)}}}},e.ChartEngine.Driver.prototype.updateChartLoop=function(t){-1!=this.intervalTimer&&(this.intervalTimer&&clearInterval(this.intervalTimer),this.behavior.noUpdate||(t||0===t||(t=this.behavior.refreshInterval),t&&(this.intervalTimer=setInterval(function(t){return function(){t.behavior.noUpdate||t.updateChart()}}(this),1e3*t))))},e.ChartEngine.Driver.prototype.resetRefreshInterval=function(t){this.behavior.refreshInterval=t,this.updateChartLoop()},e.ChartEngine.Driver.prototype.loadAll=function(t,e){var i=this,a=0;!function r(){return function(s){s?e(s):t.moreAvailable?++a>20?e("error, moreAvailable not implemented correctly in QuoteFeed"):(t.loadingMore=!1,i.checkLoadMore(t,!0,!0,r(),!0)):e(null)}}()()},e.ChartEngine.Driver.prototype.checkLoadMore=function(t,i,a,r,s){var n,o=this.stx,l=this;if(t.loadingMore||this.loadingNewChart)return t.initialScroll=t.scroll,void(r&&r(null));if(o.isHistoricalMode()||(o.isHistoricalModeSet=!1),o.currentlyImporting)r&&r(null);else{var h,c=t.dataSet,u=1e3*(this.behavior.forwardPaginationRetryInterval||5),p=!1,d=!1;if(t.dataSet.length)for(var m in t.series){var g=t.series[m];g.loading||!1!==g.parameters.loadData&&(h=!g.mostRecentForwardAttempt||g.mostRecentForwardAttempt.getTime()+u<Date.now(),!1!==g.moreAvailable&&D(g)&&(p=!0),h&&M(g)&&(d=!0))}h=!t.mostRecentForwardAttempt||t.mostRecentForwardAttempt.getTime()+u<Date.now();var f=(D(t)||i)&&!1!==t.moreAvailable,y=(M(t)||i)&&h,v=f||p,x=o.isHistoricalModeSet&&!v&&(y||d),b=o.layout.interval,S=o.layout.timeUnit,C=!1,w=this.behavior.findHeadOfData||t.masterData&&t.masterData.length;if(!this.behavior.noLoadMore&&w&&(x||!o.maxDataSetSize||t.dataSet.length<o.maxDataSetSize)&&(v||x)){var T;if(t.initialScroll=t.scroll,t.loadingMore=!0,(n=this.makeParams(t.symbol,t.symbolObject,t)).future=x,t.masterData&&t.masterData.length)x?n.startDate=t.endPoints.end:n.endDate=t.endPoints.begin,x&&!n.startDate?(T=o.getFirstLastDataRecord(t.masterData,"DT",!0))&&(n.startDate=T.DT):v&&!n.endDate&&(T=o.getFirstLastDataRecord(t.masterData,"DT"))&&(n.endDate=T.DT);else n.endDate=new Date;if(n.originalState=e.shallowClone(n),n.nodraw=s,!f&&p||!y&&d)return this.loadingMore=!0,this.loadDependents(n,function(e){t.loadingMore=!1,r&&r(e)},e.QuoteFeed.PAGINATION),void(r&&r(null));o.fetchMaximumBars[o.layout.aggregationType]&&(n.fetchMaximumBars=!0,!o.maxMasterDataSize||this.behavior.maximumTicks<o.maxMasterDataSize?n.ticks=this.behavior.maximumTicks:n.ticks=o.maxMasterDataSize);var k=function(t,i){return t.behavior.prefetchAction&&t.behavior.prefetchAction("checkLoadMore"),function(a){var n=t.stx,o=i.chart;if(i.symbol==o.symbol&&b==n.layout.interval&&S==n.layout.timeUnit)if(i.loadMore||(i.chart.loadingMore=!1),a.error)t.quoteFeed.announceError(i.originalState,a),i.chart.loadingMore=!1,r&&r(a.error);else{a.quotes||(a.quotes=[]);var l=a.quotes,h=o.masterData;if((l=t.cleanup(n,null,l,e.QuoteFeed.PAGINATION,i)).length&&o.masterData&&o.masterData.length)if(i.future){var c=l[0];c.DT&&c.DT==o.masterData[o.masterData.length-1].DT&&h.pop()}else{var u=l[l.length-1];u.DT&&+u.DT==+o.masterData[0].DT&&l.pop()}i.future?n.isHistoricalModeSet&&l.length<2&&(o.mostRecentForwardAttempt=new Date):a.moreAvailable?o.moreAvailable=!0:!1!==a.moreAvailable&&l.length?o.moreAvailable=!0:o.moreAvailable=!1,t.tickMultiplier=l.length?2:2*t.tickMultiplier;var p=l[0]?l[0].DT:i.startDate,d=l[0]?l[l.length-1].DT:i.endDate;(!o.endPoints.begin||o.endPoints.begin>p)&&(o.endPoints.begin=p),(!o.endPoints.end||o.endPoints.end<d)&&(o.endPoints.end=d),o.loadingMore=!1,i.loadMoreReplace?n.setMasterData(l,o,{noCleanupDates:!0}):i.future?n.updateChartData(l,o,{noCreateDataSet:!0,noCleanupDates:!0}):e.addMemberToMasterdata({stx:n,chart:o,data:l,fields:["*"],noCleanupDates:!0}),n.createDataSet(void 0,void 0,{appending:i.future}),s||n.draw(),t.behavior.callback&&t.behavior.callback(i),t.loadDependents(i,r,e.QuoteFeed.PAGINATION)}}}(this,n);o.isEquationChart(n.symbol)?e.fetchEquationChart(n,k):(x&&(n.appending=!0),e.ChartEngine.Driver.fetchData(e.QuoteFeed.PAGINATION,this.quoteFeed,n,k)),C=!0}!C&&r&&r(null)}function D(e){return!e.endPoints.begin||c.length-t.scroll<l.behavior.bufferSize||c.length-t.scroll-o.tickFromDate(e.endPoints.begin,t)<l.behavior.bufferSize}function M(e){return!e.endPoints.end||t.scroll-t.maxTicks+1<l.behavior.bufferSize||o.tickFromDate(e.endPoints.end,t,null,!0)-c.length+t.scroll-t.maxTicks+2<l.behavior.bufferSize}},e.ChartEngine.Driver.prototype.barsToFetch=function(t){if(e.isValidNumber(this.tickMultiplier)||(this.tickMultiplier=2),t.isSeries)return t.stx.masterData.length;var i=this.stx.layout.interval,a=t.stx.layout.periodicity;return"month"!=i&&"week"!=i||this.stx.dontRoll||(a*="week"==i?7:30),t.stx.chart.maxTicks*a*this.tickMultiplier},e.ChartEngine.Driver.determineStartDate=function(t,e,i){return this.determineStartOrEndDate(t,e,i,!0)},e.ChartEngine.Driver.determineStartOrEndDate=function(t,i,a,r){var s,n,o=t.interval,l=t.stx.layout.periodicity,h=e.Market.Symbology.isForexSymbol(t.symbol)?1.3:4;if(n="millisecond"===o||"second"===o?e.SECOND*l*h:"minute"===o?e.MINUTE*l*h:e.DAY*h,t.fetchMaximumBars){var c=a*n,u=i.begin.getTime();s=r?new Date(u-c):new Date(u+c)}else s=r?t.startDate||i.previous(a):t.future?i.next(a):new Date;return s},e.ChartEngine.Driver.prototype.makeParams=function(t,i,a){var r=this.stx,s=r.layout.interval,n=this.barsToFetch({stx:r});"month"!=s&&"week"!=s||r.dontRoll||(s="day");var o=e.shallowClone(this.behavior),l=!1,h=a.market.getSessionNames();r.extendedHours?r.extendedHours.filter?l=!0:(l=r.layout.extended,h=h.filter(function(t){return t.enabled||r.layout.marketSessions[t.name]})):h=h.filter(function(t){return t.enabled});for(var c=0;c<h.length;c++)h[c]=h[c].name;return e.extend(o,{stx:r,symbol:t,symbolObject:i,chart:a,interval:s,extended:l,period:1,ticks:n,additionalSessions:h,quoteDriverID:this.id},!0),o.symbolObject||(o.symbolObject={symbol:t}),isNaN(o.interval)||(o.period=parseInt(o.interval,10),o.interval=r.layout.timeUnit,o.interval||(o.interval="minute")),o},e.ChartEngine.Driver.prototype.newChart=function(t,i){var a=this.stx,r=t.symbol,s=a.layout.interval,n=a.layout.timeUnit,o=t.chart;o.moreAvailable=null,o.loadingMore=!1,o.attribution=null;var l=this.makeParams(r,t.symbolObject,o);e.extend(l,t,!0),(a.fetchMaximumBars[a.layout.aggregationType]||t.fetchMaximumBars)&&(!a.maxMasterDataSize||this.behavior.maximumTicks<a.maxMasterDataSize?l.ticks=this.behavior.maximumTicks:l.ticks=a.maxMasterDataSize,l.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,l.originalState=e.shallowClone(l);var h=function(o,l){return o.behavior.prefetchAction&&o.behavior.prefetchAction("newChart"),function(h){var c=l.chart,u=h.quotes,p=!1;if(r==c.symbol&&s==a.layout.interval&&n==a.layout.timeUnit){for(var d in o.loadingNewChart=!1,h.error?o.quoteFeed.announceError(l.originalState,h):(u=o.cleanup(a,null,u,e.QuoteFeed.INITIAL,l),a.setMasterData(u,c,{noCleanupDates:!0}),c.endPoints={},c.endPoints.begin=u[0]?u[0].DT:l.startDate,c.endPoints.end=u[0]?u[u.length-1].DT:l.endDate,c.moreAvailable=!!u&&!1!==h.moreAvailable,c.attribution=h.attribution,t.initializeChart&&a.initializeChart(),a.createDataSet(),p=!0),c.series)c.series[d].endPoints={},c.series[d].moreAvailable=null;var m=c.masterData;m&&m.length&&(l.startDate=m[0].DT,l.endDate=m[m.length-1].DT),o.behavior.callback&&o.behavior.callback(l),o.loadDependents(l,function(){p&&!l.nodraw&&o.stx.home(),i&&i(h.error),o.stx.dispatch("newChart",{stx:o.stx,symbol:o.stx.chart.symbol,symbolObject:o.stx.chart.symbolObject,moreAvailable:o.stx.chart.moreAvailable,quoteDriver:o}),o.resetRefreshInterval(o.behavior.refreshInterval)},e.QuoteFeed.INITIAL)}else i&&i("orphaned")}}(this,l);this.stx.isEquationChart(l.symbol)?e.fetchEquationChart(l,h):e.ChartEngine.Driver.fetchData(e.QuoteFeed.INITIAL,this.quoteFeed,l,h)},e.QuoteFeed.INITIAL=1,e.QuoteFeed.UPDATE=2,e.QuoteFeed.PAGINATION=3,e.QuoteFeed.SERIES=4,e.ChartEngine.Driver.fetchData=function(t,i,a,r){i.v2QuoteFeed?"function"!=typeof i.subscribe?e.ChartEngine.Driver.fetchDataInContext(t,i,a,r):e.ChartEngine.Driver.fetchDataInContext(t,i,a,function(t){t.error||i.checkSubscriptions(a.stx),r(t)}):(a.stx.convertToDataZone(a.startDate),a.stx.convertToDataZone(a.endDate),i.fetch(a,r))},e.ChartEngine.Driver.fetchDataInContext=function(t,i,a,r){var s,n,o,l,h=a.stx;t===e.QuoteFeed.SERIES&&(a.series=!0,t=e.QuoteFeed.INITIAL,a.endDate&&!a.startDate||a.future?t=e.QuoteFeed.PAGINATION:a.startDate&&!a.endDate&&(t=e.QuoteFeed.UPDATE));var c=Math.min(a.ticks,h.quoteDriver.behavior.maximumTicks);switch(i.maxTicks&&(c=Math.min(c,i.maxTicks)),t){case e.QuoteFeed.UPDATE:if(h.isHistoricalModeSet)return void(h.quoteDriver.updatingChart=!1);var u;a.startDate?u=a.startDate:(u=new Date).setHours(0,0,0,0),"function"==typeof i.fetchUpdateData&&i.fetchUpdateData(a.symbol,h.convertToDataZone(u),a,r);break;case e.QuoteFeed.INITIAL:s={begin:l=a.endDate||new Date,interval:a.interval,periodicity:"tick"==a.interval?h.chart.xAxis.futureTicksInterval:a.period,outZone:h.dataZone},n=h.chart.market.newIterator(s),o=e.ChartEngine.Driver.determineStartDate(a,n,c),a.endDate&&(l=a.endDate),"function"==typeof i.fetchInitialData&&i.fetchInitialData(a.symbol,o,h.convertToDataZone(l),a,r);break;case e.QuoteFeed.PAGINATION:s={begin:a.endDate||a.startDate,interval:a.interval,periodicity:"tick"==a.interval?h.chart.xAxis.futureTicksInterval:a.period,outZone:h.dataZone},n=h.chart.market.newIterator(s);var p=e.ChartEngine.Driver.determineStartOrEndDate(a,n,c,!a.future);if(o=a.startDate||p,l=a.endDate||p,a.startDate?a.stx.convertToDataZone(o):a.stx.convertToDataZone(l),"function"==typeof i.fetchPaginationData){if(h.maxMasterDataSize&&h.maxMasterDataSize<=h.masterData.length)return;l>=Date.now()&&(this.isHistoricalModeSet=!1),i.fetchPaginationData(a.symbol,o,l,a,r)}break;default:console.error("Illegal fetchData constant")}},t},__js_standard_span_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.setRange=function(t,i){e.isEmpty(t)&&(t={dtLeft:arguments[0],dtRight:arguments[1],padding:arguments[2],chart:arguments[3]},i=arguments[4]),this.staticRange&&(t.goIntoPast=t.goIntoFuture=!0),t.chart||(t.chart=this.chart),void 0===t.padding&&(t.padding=0);var a,r=!1,s=t.chart,n="string"==typeof t.dtLeft?new Date(t.dtLeft):t.dtLeft,o=new Date;t.dtRight&&(o="string"==typeof t.dtRight?new Date(t.dtRight):t.dtRight),n||(a=this.standardMarketIterator(o,null,s),n=a.previous(s.maxTicks),t.periodicity||(r=!0)),s.inflectionPoint=n,this.layout.range={dtLeft:n,dtRight:o};var l=this;function h(e){void 0===e&&(e=null);var a=0,r=0,h=new Date,c=t.base,u=t.periodicity,p=l.layout;if(t.goIntoFuture&&(!s.masterData.length||n>s.masterData[s.masterData.length-1].DT)){var d=s.masterData.length?s.masterData.pop():{DT:n},m=l.doCleanupGaps([d,{DT:o}],s,{cleanupGaps:"gap",noCleanupDates:!0});l.setMasterData(s.masterData.concat(m),s,{noCleanupDates:!0}),l.createDataSet(null,null,{appending:!0})}var g=s.dataSet,f=g.length;if(g&&0!==f){var y;if("day"===c&&u&&"day"===u.interval){var v=t.multiplier;a=f<v?0:f-v,r=f-1}else if("today"===c&&g[f-1].DT.getDate()!=h.getDate()){var x=new Date(g[f-1].DT.getTime());x.getTime();y=0;for(var b=f-1;b>=0;b--)if(g[b]&&g[b].DT.getDate()!=x.getDate()){x=new Date(+g[b+1].DT),y=b+1;break}a=y,r=f-1}else a="all"!=t.base&&(n.getTime()>=g[0].DT.getTime()||t.goIntoPast)?l.tickFromDate(n,s,null,!0):0,"all"!=t.base&&(o.getTime()<=g[f-1].DT.getTime()||t.goIntoFuture)?(r=l.tickFromDate(o,s))>f-1&&r--:r=f-1;var S=r-a+1;if(S<1)i&&i(e);else{var C=t.padding||0;r<f-1&&(C=0);var w=(s.width-C)/S;for(var T in l.setCandleWidth(w,s),s.scroll=S-(r-f)-1,l.micropixels=1,l.panels)l.calculateYAxisMargins(l.panels[T].yAxis);t.dontSaveRangeToLayout?delete p.range:(delete t.chart,delete p.setSpan,p.range=t),l.draw(),l.changeOccurred("layout"),i&&i(e)}}else i&&i(e)}var c=0;function u(t){return t&&0===c?(s.scroll=A,l.setCandleWidth(F),l.layout.interval=P,l.layout.periodicity=_,l.layout.timeUnit=E,void(i&&i(t))):++c>10?(console.log("CIQ.ChartEngine.setRange(): Too many loads (10) from server. Stopping. Check periodicity logic."),void h()):void h()}function p(t,i,a,r,s,n){var o=0,l=t-i;return e.ChartEngine.isDailyInterval(a)?o="month"==a?l/e.MONTH/r:"week"==a?l/e.WEEK/r:l/e.DAY/r:isNaN(a)||(o="millisecond"==s?l/(r*a):"second"==s?l/e.SECOND/(r*a):l/e.MINUTE/(r*a)),Math.round(o)}if(this.quoteDriver){var d,m,g;if(r)d=this.layout.interval,g=this.layout.timeUnit,m=this.layout.periodicity;else if(t.periodicity){var f=e.cleanPeriodicity(t.periodicity.period,t.periodicity.interval,t.periodicity.timeUnit);d=f.interval,g=f.timeUnit,m=f.period}else{var y=o.getTime()-n.getTime();if(this.autoPickCandleWidth.turnOn){var v=0;v=this.autoPickCandleWidth.candleWidth?this.autoPickCandleWidth.candleWidth:this.barsHaveWidth[this.layout.chartType]?5:2;var x,b=s.width/v,S=this.dynamicRangePeriodicityMap;d=S[0].interval,m=1;for(var C=0;C<S.length;C++){var w=y/S[C].rangeInMS;if(w<b){S[C-1]?(d=S[C-1].interval,g=S[C-1].timeUnit,m=Math.ceil(x/b)):(d=S[C].interval,g=S[C].timeUnit,m=1);break}x=w}}else{for(var T=this.staticRangePeriodicityMap,k=null,D=0;D<T.length;D++){var M=T[D];if(y/M.rangeInMS<1.001){k=M;break}}d=k.interval,m=k.periodicity,g=k.timeUnit}}var A=this.chart.scroll,F=this.layout.candleWidth,P=this.layout.interval,_=this.layout.periodicity,E=this.layout.timeUnit;this.chart.scroll=this.chart.maxTicks=p(o.getTime(),n.getTime(),d,m,g,this.dontRoll),this.layout.candleWidth=this.chart.width/this.chart.maxTicks;var L=this.needDifferentData({period:m,interval:d,timeUnit:g});if(Object.keys(this.chart.endPoints).length&&(this.chart.endPoints.begin>n||this.chart.endPoints.end<o)&&(L=!0),!this.chart.masterData||!this.chart.masterData.length||L||t.forceLoad){this.layout.interval=d,this.layout.periodicity=m,this.layout.timeUnit=g,this.layout.timeUnit||(e.ChartEngine.isDailyInterval(this.layout.interval)?this.layout.timeUnit=null:"second"==this.layout.interval?this.layout.timeUnit="second":"tick"!=this.layout.interval&&(this.layout.timeUnit="minute"));var N={symbol:s.symbol,symbolObject:s.symbolObject,chart:s,nodraw:!0};"tick"==this.layout.interval&&(N.startDate=n,N.endDate=o),this.displayInitialized||(N.initializeChart=!0);var R=Math.max(this.quoteDriver.behavior.bufferSize+50,200);a=this.standardMarketIterator(n,null,s),N.startDate=new Date(a.previous(R).getTime()),a=this.standardMarketIterator(o,null,s),N.endDate=new Date(a.next(R).getTime()),N.endDate<Date.now()?this.isHistoricalModeSet=!0:N.endDate=o,this.clearCurrentMarketData(this.chart),clearTimeout(this.streamParameters.timeout),this.quoteDriver.newChart(N,u)}else this.layout.interval==d&&this.layout.periodicity==m&&this.layout.timeUnit==g&&this.chart.dataSegment&&this.chart.dataSegment[0]&&this.chart.dataSegment[0].DT==s.inflectionPoint||(this.layout.interval=d,this.layout.periodicity=m,this.layout.timeUnit=g,this.createDataSet()),u()}else h()},e.ChartEngine.prototype.setSpan=function(t,i){var a=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];"object"==_typeof(t)?(a=t.period?t.period:t.multiplier?t.multiplier:1,r=t.interval?t.interval:t.base?t.base:t.span?t.span:t.period,s=t.padding,n=t.chart):(t={period:a,interval:r,padding:s,chart:n},i=arguments[5]),n||(n=this.chart);var o,l=n.market;if("all"==(r=r.toLowerCase()))return t.dontSaveRangeToLayout=!0,void this.displayAll(t,i);var h=r,c=1;"today"==r?h="day":"year"==r&&(h="month",c=12);var u=e.shallowClone(t),p={begin:l.marketZoneNow(),interval:h,period:c},d=p.begin;function m(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}var g=e.Market.Symbology.isForexSymbol(n.symbol);function f(t,e){if(!g)return t;return e?t.setHours(t.getHours()+7):(t.setHours(t.getHours()-7),l.isMarketDate(t)||t.setDate(t.getDate()-2)),t}if("ytd"===r)(d=m(d)).setMonth(0),d.setDate(1);else if("month"===r)(d=m(new Date)).setMonth(d.getMonth()-a);else if("year"===r)(d=m(new Date)).setFullYear(d.getFullYear()-a);else if("week"===r)(d=m(new Date)).setDate(d.getDate()-7*a);else if("day"===r&&1==a&&l.isMarketDay()){var y=d.getHours(),v=d.getMinutes(),x=d.getSeconds(),b=d.getMilliseconds();(d=(o=l.newIterator(p)).previous()).setHours(y,v,x,b),d=l._convertFromMarketTZ(d)}else"today"===r?(p.begin=f(d,!0),o=l.newIterator(p),(l.isOpen()||l.getPreviousOpen().getDate()==d.getDate())&&o.next(),f(d=o.previous()),u.goIntoFuture=!0,u.dtRight=new Date(+d),u.dtRight.setDate(d.getDate()+1),u.dtRight=l._convertFromMarketTZ(u.dtRight),g||(d.setHours(o.market.zopen_hour),d.setMinutes(o.market.zopen_minute),d.setSeconds(0)),d=l._convertFromMarketTZ(d)):("day"==r&&(p.begin=f(d,!0)),1==a&&a++,d=(o=l.newIterator(p)).previous(a-1),"day"==r&&(d=l._convertFromMarketTZ(f(d))));u.dtLeft=d,u.maintainPeriodicity&&(u.periodicity={},u.periodicity.interval=this.layout.interval,u.periodicity.period=this.layout.periodicity),n.spanLock=!1,u.dontSaveRangeToLayout=!0;var S=this;this.setRange(u,function(e){S.layout.setSpan=t,S.changeOccurred("layout"),"today"==r&&(n.spanLock=!0),i&&i(e)})},e.ChartEngine.prototype.getSpanCandleWidth=function(t){if(t&&t.base&&t.multiplier){var e=parseFloat(t.multiplier),i=t.base,a=new Date,r=new Date;"year"==i?r.setFullYear(r.getFullYear()-e):"month"==i?r.setMonth(r.getMonth()-e):"day"==i?r.setDate(r.getDate()-e):"week"==i?r.setDate(r.getDate()-7*e):"YTD"==i&&(r.setMonth(0),r.setDate(1));var s=(a.getTime()-r.getTime())/1e3/60/60/24;return s=5*s/7,this.chart.width/s}},e.ChartEngine.prototype.displayAll=function(t,i){var a=this.chart;t&&t.chart&&(a=t.chart);var r=this;function s(){if(a.masterData&&a.masterData.length){var s=e.clone(t);s.dtLeft=a.masterData[0].DT,s.dtRight=a.masterData[a.masterData.length-1].DT,s.periodicity={},s.periodicity.interval=r.layout.interval,s.periodicity.period=r.layout.periodicity,s.periodicity.timeUnit=r.layout.timeUnit,r.setRange(s,function(e){for(var a in r.layout.setSpan={base:t.base,multiplier:t.multiplier},r.changeOccurred("layout"),r.panels)r.calculateYAxisMargins(r.panels[a].yAxis);r.draw(),i&&i(e)})}}function n(t){t||r.quoteDriver.loadAll(a,s)}if(this.quoteDriver){var o=t.maintainPeriodicity?{period:this.layout.periodicity,interval:this.layout.interval}:{period:1,interval:"month"};o=t.periodicity?t.periodicity:o,o=e.cleanPeriodicity(o.period,o.interval,o.timeUnit);var l=this.needDifferentData(o);this.layout.periodicity=o.period,this.layout.interval=o.interval,this.layout.timeUnit=o.timeUnit,t.forceLoad||l?(this.clearCurrentMarketData(this.chart),this.quoteDriver.newChart({noDraw:!0,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,chart:this.chart,initializeChart:!0,fetchMaximumBars:!0},n)):a.moreAvailable?n():(this.createDataSet(),s())}else s()},t},__js_standard_studies_=function(t){t.CIQ||(t.CIQ={});var e=t.CIQ;return e.Studies=function(){},e.Studies.DEFAULT_INPUTS={Period:14},e.Studies.DEFAULT_OUTPUTS={Result:"auto"},e.Studies.StudyDescriptor=function(t,i,a,r,s,n){this.name=t,this.type=i,this.panel=a,this.inputs=r,this.outputs=s,this.parameters=n,this.outputMap={},this.min=null,this.max=null,this.startFrom=0,this.subField="Close";var o=e.Studies.studyLibrary[i];o||(o={},("chart"==a||!a&&n&&"chart"==n.chartName)&&(this.overlay=!0)),void 0===o.inputs&&(o.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===o.outputs&&(o.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS)),this.study=o,this.libraryEntry=o},e.Studies.StudyDescriptor.prototype.getYAxis=function(t){var e,i=this.yAxis;if(this.parameters&&(e=this.parameters.yaxisDisplayValue),!i){var a=t.panels[this.panel];a&&(i=t.getYAxisByName(a,e)||t.getYAxisByName(a,this.name)||a.yAxis)}return i||(i=t.getYAxisByName(t.chart.panel,e)||t.chart.panel.yAxis),i},e.Studies.StudyDescriptor.prototype.getContext=function(t){return t.chart.context},e.Studies.StudyDescriptor.prototype.getDependents=function(t,i){var a=[],r=Object.keys(this.outputMap);if(r.length)for(var s in t.layout.studies){var n=t.layout.studies[s];if(n!=this)for(var o=e.Studies.getFieldInputs(n),l=0;l<o.length;l++)if(r.indexOf(n.inputs[o[l]])>-1){if(i&&n.parameters&&n.parameters.panelName)continue;a.push(n),a=a.concat(n.getDependents(t,i));break}}return a},e.Studies.generateID=function(t,i,a,r,s){var n=e.Studies.studyLibrary[i],o="‌"+(s||i)+"‌";if(n&&n.customRemoval)return o;if(!e.isEmpty(a)){var l=!0;for(var h in a)if("id"!=h&&"display"!=h&&"Shading"!=h){var c=a[h];"field"!=c&&(c=c.toString(),void 0!==e.Studies.prettify[c]&&(c=e.Studies.prettify[c]),l?(l=!1,o+=" ("):c&&(o+=","),o+=c)}l||(o+=")")}if(r&&0===r.indexOf(o))return r;if(t.layout.studies&&t.layout.studies[o])for(var u=2;u<50;u++){var p=o+"-"+u;if(!t.layout.studies[p]){o=p;break}}return o},e.Studies.DialogHelper=function(t){var i=this.stx=t.stx,a=this.sd=t.sd;this.name=a?a.type:t.name,this.signal=1,this.inputs=[],this.outputs=[],this.parameters=[];var r=this.libraryEntry=a?a.study:e.Studies.studyLibrary[t.name];void 0===r.inputs&&(r.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===r.outputs&&(r.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS));var s=a&&i.panels[a.panel]?i.panels[a.panel]:i.chart.panel,n=s.chart;function o(t,e){this.attributes[t]||(this.attributes[t]={}),e&&(this.attributes[t].hidden=!0)}this.title=i.translateIf(r.name),this.attributes=r.attributes,this.attributes||(this.attributes={});var l=[],h=i.layout.studies,c=[];for(var u in a&&(c=Array.prototype.concat(a,a.getDependents(i))),h)if(!(c.indexOf(h[u])>-1))for(var p in h[u].outputMap)l.push(p);for(var d in r.inputs){var m={};this.inputs.push(m),m.name=d,m.heading=i.translateIf(d);var g=r.inputs[d];if(a&&a.inputs&&void 0!==a.inputs[d]&&null!==a.inputs[d]?m.value=a.inputs[d]:m.value=r.inputs[d],m.defaultInput=r.inputs[d],this.attributes[d]||(this.attributes[d]=e.Studies.inputAttributeDefaultGenerator(m.defaultInput)),g.constructor==Number)m.type="number";else if(g.constructor==String){var f=e.Studies.movingAverageHelper(i,m.defaultInput);if(f){m.type="select",m.defaultInput=f;var y=e.Studies.movingAverageHelper(i,m.value);y||(y=m.value),m.value=y,m.options=e.Studies.movingAverageHelper(i,"options")}else if("field"==g){m.type="select",m.options={};var v,x={};for(v in n.dataSet[n.dataSet.length-1])if(-1==["Open","High","Low","Close","Adj_Close","hl/2","hlc/3","hlcc/4","ohlc/4",n.defaultPlotField].indexOf(v)){if(-1==l.indexOf(v))continue;x[v]=i.translateIf(v)}else m.options[v]=i.translateIf(v);for(v in x)m.options[v]=x[v];"field"==m.value&&(m.value="Close"),"field"==m.defaultInput&&(m.defaultInput="Close")}else m.type="text","yyyy-mm-dd"==this.attributes[d].placeholder?m.type="date":"hh:mm:ss"==this.attributes[d].placeholder&&(m.type="time")}else if(g.constructor==Boolean)m.type="checkbox",!0!==m.value&&"true"!=m.value&&"on"!=m.value||(m.value=!0);else if(g.constructor==Array){m.type="select",m.options={};for(var b=0;b<g.length;b++)m.options[g[b]]=i.translateIf(g[b]);m.value.constructor==Array&&(m.value=m.value[0]),m.defaultInput=g[0]}}this.dateTimeInputs=[];for(var S=0;S<this.inputs.length;S++){var C=this.inputs[S];if("date"==C.type)for(var w=C.name.substring(0,C.name.indexOf(" Date")),T=0;T<this.inputs.length;T++){var k=this.inputs[T];if("time"==k.type&&k.name==w+" Time"){this.dateTimeInputs.push(w);break}}}for(d in this.adjustInputTimesForDisplayZone(),r.outputs){var D={name:d,heading:i.translateIf(d)};D.color=D.defaultOutput=r.outputs[d],a&&a.outputs&&a.outputs[d]&&(D.color=a.outputs[d]),"auto"==D.color&&(D.color=i.defaultColor),this.outputs.push(D)}var M=a?a.parameters:null;if(r.parameters){var A,F=r.parameters.init;if(F)void 0!==F.studyOverZonesEnabled&&(A={name:"studyOverZones",heading:i.translateIf("Show Zones"),defaultValue:F.studyOverZonesEnabled,value:F.studyOverZonesEnabled},M&&(M.studyOverZonesEnabled||!1===M.studyOverZonesEnabled)&&(A.value=M.studyOverZonesEnabled),A.type="checkbox",this.parameters.push(A)),void 0!==F.studyOverBoughtValue&&(A={name:"studyOverBought",heading:i.translateIf("OverBought"),defaultValue:F.studyOverBoughtValue,value:F.studyOverBoughtValue,defaultColor:F.studyOverBoughtColor,color:F.studyOverBoughtColor},M&&M.studyOverBoughtValue&&(A.value=M.studyOverBoughtValue),M&&M.studyOverBoughtColor&&(A.color=M.studyOverBoughtColor),"auto"==A.color&&(A.color=i.defaultColor),A.type="text",this.parameters.push(A)),void 0!==F.studyOverSoldValue&&(A={name:"studyOverSold",heading:i.translateIf("OverSold"),defaultValue:F.studyOverSoldValue,value:F.studyOverSoldValue,defaultColor:F.studyOverSoldColor,color:F.studyOverSoldColor},M&&M.studyOverSoldValue&&(A.value=M.studyOverSoldValue),M&&M.studyOverSoldColor&&(A.color=M.studyOverSoldColor),"auto"==A.color&&(A.color=i.defaultColor),A.type="text",this.parameters.push(A)),this.attributes.studyOverBoughtValue||(this.attributes.studyOverBoughtValue={}),this.attributes.studyOverSoldValue||(this.attributes.studyOverSoldValue={})}function P(t){for(var e={},a=t.defaults,r={name:t.name,heading:i.translateIf(t.label),defaultValue:a[0],value:t.value,options:e,type:"select"},s=0;s<a.length;s++)e[a[s]]=i.translateIf(a[s]);return void 0!==t.color&&(r.defaultColor=i.defaultColor,r.color=t.color),r}function _(t){return{name:t.name,heading:i.translateIf(t.label),defaultValue:t.defaults,value:t.value,type:"checkbox"}}var E=this.panelSelect=t.panelSelect,L=this.axisSelect=t.axisSelect;function N(t){function e(t,e){return"Panel "+e.toString()}if("alias"==E){var a=1;for(var r in i.panels){if(r==t)return e(0,a);a++}}return t}if(L||E){a||(a=e.Studies.addStudy(i,t.name,null,null,{calculateOnly:!0}),e.Studies.removeStudy(i,a)),E&&this.parameters.push(P({label:"Panel",name:"panelName",defaults:function(){var t=[];for(var e in t.push("Auto"),i.panels)e==a.panel&&M&&M.panelName||t.push(N(e));return i.checkForEmptyPanel(a.panel,!0,a)||t.push("New panel"),t}(),value:M&&M.panelName?N(M.panelName):"Auto"}),_({label:"Show as Underlay",name:"underlay",defaults:!1,value:a.underlay||a.parameters&&a.parameters.underlayEnabled}));var R=i.getYAxisByName(s,a.name);L&&this.parameters.push(P({label:"Y-Axis",name:"yaxisDisplay",defaults:function(){var t=s.yaxisLHS.concat(s.yaxisRHS),e=[];e.push("default","right","left","none","shared");for(var i=0;i<t.length;i++)t[i]!=R&&e.push(t[i].name);return e}(),value:M&&M.yaxisDisplayValue||R&&R.position||(a.panel!=a.name?"shared":s.yAxis.position||"default"),color:R&&R.textStyle?R.textStyle:"auto"}),_({label:"Invert Y-Axis",name:"flipped",defaults:!1,value:M?M.flippedEnabled:!!R&&R.flipped})),o.call(this,"flippedEnabled",!R&&a.panel!=a.name),o.call(this,"underlayEnabled",r.underlay),o.call(this,"panelName",null===r.seriesFN),o.call(this,"yaxisDisplayValue",null===r.seriesFN||r.yAxis&&r.yAxis.noDraw)}},e.Studies.DialogHelper.prototype.updateStudy=function(t){var i={},a=this.sd,r=this.libraryEntry;r||(r={}),a||(a=r),i.inputs=e.clone(a.inputs),i.outputs=e.clone(a.outputs),i.parameters=e.clone(a.parameters),this.adjustInputTimesForDisplayZone(t),t.parameters&&t.parameters.panelName&&(t.parameters.panelName=function(t){if("alias"==this.panelSelect){var e=function(t){var e=t.match(/.* (\d)/);return e&&e[1]}(t);if(e)for(var i in this.stx.panels)if(!--e)return i}return t}.call(this,t.parameters.panelName)),e.extend(i,t),i.parameters||(i.parameters={}),a=i.inputs&&i.inputs.id?e.Studies.replaceStudy(this.stx,i.inputs.id,this.name,i.inputs,i.outputs,i.parameters,null,a.study):e.Studies.addStudy(this.stx,this.name,i.inputs,i.outputs,i.parameters,null,a.study);var s=new e.Studies.DialogHelper({stx:this.stx,sd:a,axisSelect:this.axisSelect,panelSelect:this.panelSelect});for(var n in s)"signal"!=n&&(this[n]=s[n]);this.signal*=-1},e.Studies.DialogHelper.prototype.adjustInputTimesForDisplayZone=function(t){if(this.stx.displayZone)for(var i=0;i<this.dateTimeInputs.length;i++){var a,r,s,n,o=this.dateTimeInputs[i],l="";for(t&&t.inputs&&((r=t.inputs[o+" Date"])&&(l=r),(s=t.inputs[o+" Time"])&&(l+=s)),a=0;a<this.inputs.length;a++)n=this.inputs[a],r||""===r||n.name!=o+" Date"?s||""===s||n.name!=o+" Time"||(l+=n.value):l=n.value+l;if((l=l.replace(/\D/g,"")).length<12)return;var h,c=e.strToDateTime(l);if(!isNaN(c.valueOf()))if(t)t.inputs||(t.inputs={}),h=e.convertTimeZone(c,this.stx.displayZone),t.inputs[o+" Date"]=e.yyyymmdd(h),t.inputs[o+" Time"]=e.hhmmss(h);else for(h=e.convertTimeZone(c,null,this.stx.displayZone),a=0;a<this.inputs.length;a++)(n=this.inputs[a]).name==o+" Date"&&(n.value=e.yyyymmdd(h)),n.name==o+" Time"&&(n.value=e.hhmmss(h))}},e.Studies.prepareStudy=function(t,i,a){if(void 0===i.calculateFN&&(i.useRawValues=!0),e.isEmpty(a.outputMap))for(var r in a.outputs)i.useRawValues?a.outputMap[r]=r:a.outputMap[r+" "+a.name]=r},e.Studies.rejiggerDerivedStudies=function(t,i,a){var r=i.name,s=(i.panel,i.getDependents(t));for(var n in s){var o=s[n],l=e.clone(o.inputs),h=l.id;if(h){for(var c=e.Studies.getFieldInputs(o),u=0;u<c.length;u++)l[c[u]]=l[c[u]].replace(r,a);delete e.Studies.replaceStudy(t,h,o.type,l,o.outputs,e.extend(o.parameters,{rejiggering:!0}),null,o.study).parameters.rejiggering}}},e.Studies.removeStudySymbols=function(t,e){if(t.series)for(var i in t.series)e.deleteSeries(t.series[i],null,{action:"remove-study"})},e.Studies.replaceStudy=function(t,i,a,r,s,n,o,l){n||(n={}),i&&(n.replaceID=i),i=n.replaceID;var h,c=t.layout.studies[i];e.Studies.removeStudySymbols(c,t),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),r&&(r.id==r.display&&delete r.display,delete r.id),(h=e.Studies.addStudy(t,a,r,s,n,o,l)).highlight=c.highlight;var u,p={};for(u in t.layout.studies)u==i?p[h.name]=h:p[u]=t.layout.studies[u];for(u in t.layout.studies=p,p={},t.overlays)u==i?(h.overlay||h.underlay)&&(p[h.name]=h):p[u]=t.overlays[u];return t.overlays=p,t.overlays[h.name]||!h.overlay&&!h.underlay||t.addOverlay(h),t.checkForEmptyPanel(c.panel),n.rejiggering||(t.initializeDisplay(t.chart),e.Studies.rejiggerDerivedStudies(t,c,h.inputs.id,h.panel),t.changeOccurred("layout"),t.currentlyImporting||n.calculateOnly||!h.chart.dataSet||t.createDataSet(null,h.chart),t.draw()),e.transferObject(c,h),t.layout.studies[h.name]=c,t.overlays[h.name]=c,c},e.Studies.addStudy=function(t,i,a,r,s,n,o){var l=o||e.Studies.studyLibrary[i];if(s||(s={}),l){if(l.inputs){var h=e.clone(l.inputs);for(var c in h)h[c]instanceof Array&&(h[c]=h[c][0]);a=e.extend(h,a)}l.outputs&&(r=e.extend(e.clone(l.outputs),r));var u=l.parameters;u&&u.init&&(s=e.extend(e.clone(u.init),s)),u&&!s.display&&(s.display=u.display)}a||(a=e.clone(e.Studies.DEFAULT_INPUTS)),r||(r=e.clone(e.Studies.DEFAULT_OUTPUTS)),s.chartName||(s.chartName="chart"),"Auto"!=s.panelName&&"Default panel"!=s.panelName||(s.panelName=""),a.Period<1&&(a.Period=1),a.id||(a.id=e.Studies.generateID(t,i,a,s.replaceID,s.display));var p=null;if(t.layout.studies||(t.layout.studies={}),p=l&&l.initializeFN?l.initializeFN(t,i,a,r,s,n,o):e.Studies.initializeFN(t,i,a,r,s,n,o)){var d;if(o=p.study,p.chart=t.charts[s.chartName],p.type=i,p.permanent=o.permanent,p.customLegend=o.customLegend,e.Studies.prepareStudy(t,o,p),s.replaceID?(d=!0,delete s.replaceID):(t.layout.studies[p.inputs.id]=p,(p.overlay||p.underlay)&&t.addOverlay(p),t.currentlyImporting||s.calculateOnly||!p.chart.dataSet||t.createDataSet(null,p.chart)),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),t.changeOccurred("layout"),s.calculateOnly)return p;var m=t.panels[p.panel],g=!1,f=!(p.overlay||p.underlay);if(f&&o.horizontalCrosshairFieldFN&&(m.horizontalCrosshairField=o.horizontalCrosshairFieldFN(t,p)),t.editCallback?g=!0:f?(t.callbacks.studyPanelEdit||t.callbackListeners.studyPanelEdit&&t.callbackListeners.studyPanelEdit.length)&&(g=!0):(t.callbacks.studyOverlayEdit||t.callbackListeners.studyOverlayEdit&&t.callbackListeners.studyOverlayEdit.length)&&(g=!0),g){s.editMode=!0;var y,v=!1;for(var x in p.inputs)if("id"!=x&&"display"!=x){v=!0;break}if(!v)for(var b in p.outputs){v=!0;break}if(v)void 0!==p.study.edit?p.study.edit&&(y=function(t,i,a,r){return function(){e.clearCanvas(t.chart.tempCanvas,t),i.study.edit(i,{stx:t,inputs:a,outputs:r,parameters:s})}}(t,p,a,r),t.setPanelEdit(m,y),p.editFunction=y):f?t.editCallback?(y=function(t,a,r,n){return function(){var o=t.editCallback(t,a);e.clearCanvas(t.chart.tempCanvas,t),e.Studies.studyDialog(t,i,o,{inputs:r,outputs:n,parameters:s})}}(t,p,a,r),"chart"!=m.name&&t.setPanelEdit(m,y)):(y=function(t,i,a,r,s){return function(){e.clearCanvas(t.chart.tempCanvas,t),t.dispatch("studyPanelEdit",{stx:t,sd:i,inputs:a,outputs:r,parameters:s})}}(t,p,a,r,s),"chart"!=m.name&&(t.setPanelEdit(m,y),p.editFunction=y)):(y=function(t,i,a,r,s){return function(n){e.clearCanvas(t.chart.tempCanvas,t),t.dispatch("studyOverlayEdit",{stx:t,sd:i,inputs:a,outputs:r,parameters:s,forceEdit:n})}}(t,p,a,r,s),p.editFunction=y)}return d||t.draw(),p}console.log("CIQ.Studies.addStudy: initializeFN() returned null for "+i)},e.Studies.quickAddStudy=e.Studies.addStudy,e.Studies.removeStudy=function(t,e){var i=t.panels[e.panel],a=i&&i.yAxis.name;(e.overlay||e.underlay)&&t.removeOverlay(e.name);var r=t.panels[e.panel];if(delete t.layout.studies[e.name],r&&!t.checkForEmptyPanel(r)){a==e.name&&t.electNewPanelOwner(r);var s=t.getYAxisByName(e.panel,e.name);s&&(s.name=s.studies[1]||s.renderers[0])}t.draw(),t.resizeChart()},e.Studies.getPanelFromFieldName=function(t,i){var a=e.Studies.getFieldInputs(i);if(!a.length)return null;var r=t.layout.studies;if(!r)return null;var s={};for(var n in r)for(var o in r[n].outputMap)s[o]=r[n].panel;for(var l=0;l<a.length;l++){var h=i.inputs[a[l]];if(h){var c=s[h];if(c)return c}}return null},e.Studies.createLibraryHash=function(){return Object.keys(e.Studies.studyLibrary).join("|")},e.Studies.displayStudies=function(t,i,a){a&&(i.studyLibraryHash=e.Studies.createLibraryHash());var r=t.layout.studies;if(r){var s={};for(var n in s[i.name]=!0,r){var o=r[n],l=o.study;if(l){var h=o.underlay||o.parameters&&o.parameters.underlayEnabled;if(!(a&&!h||!a&&h)){var c=e.clone(l.renderer);!c||c instanceof Array||(c=[c]);var u=t.panels[o.panel];if(u){if(u.chart==i&&!u.hidden){if(!s[u.name]){var p=o.permanent||!t.manageTouchAndMouse;u.closeX?p&&(u.closeX.style.display="none"):u.close&&p&&(u.close.style.display="none"),u.edit&&p&&(u.edit.style.display="none"),s[u.name]=p}var d=o.chart.dataSegment;if(!(o.panel!=o.parameters.chartName||o.parameters&&o.parameters.panelName)){var m=e.Studies.getPanelFromFieldName(t,o);m&&o.panel!=m&&(o.panel=m)}if(void 0===l.seriesFN){if(c){o.overlay||e.Studies.createYAxis(t,o,d,u);for(var g=0;g<c.length;g++){var f=c[g];for(var y in o.outputMap)o.outputMap[y]==f.field&&(f.field=y);if(f.field){f.panel=o.panel;var v=f.binding;if(v)for(var x in v){var b=e.Studies.determineColor(o.outputs[v[x]]);b&&"auto"!=b&&(f[x]=b)}f.yAxis=null;var S=e.Renderer.produce(f.type,f);S.stx=t,S.attachSeries(null,f).draw()}}}else e.Studies.displaySeriesAsLine(t,o,d);u&&e.Studies.displayError(t,o)}else l.seriesFN&&u&&(l.seriesFN(t,o,d),e.Studies.displayError(t,o))}}else t.currentlyImporting&&delete r[n]}}}}},e.Studies.displayError=function(t,e,i){var a=i&&i.panel?i.panel:e.panel,r=t.panels[a].state;!r.studyError&&e.error&&((i=i||{h:"center",v:"bottom"}).text=r.studyError=!0===e.error?t.translateIf("Not enough data to compute ")+t.translateIf(e.study.name):t.translateIf(e.error),t.watermark(a,i))},e.Studies.calculateMinMaxForDataPoint=function(t,e,i){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,s=0;s<i.length;s++){var n=i[s][e];null!=n&&(isNaN(n)||(a=Math.min(n,a),r=Math.max(n,r)))}return{min:a,max:r}},e.Studies.determineMinMax=function(t,e,i){},e.Studies.getYAxisParameters=function(t,e){var i={},a=t.layout.studies&&t.layout.studies[e.name];if(a){var r=a.study;r.yaxis||r.yAxisFN?i.noDraw=!0:(r.parameters&&r.parameters.excludeYAxis&&(i.noDraw=!0),i.ground=r.yAxis&&r.yAxis.ground,e&&("bypass"!=r.range&&("0 to 100"==r.range?i.range=[0,100]:"-1 to 1"==r.range?i.range=[-1,1]:"0 to max"==r.range?i.range=[0,Math.max(0,e.high)]:(r.centerline||0===r.centerline)&&(i.range=[Math.min(r.centerline,e.low),Math.max(r.centerline,e.high)])),i.range&&(e.low=i.range[0],e.high=i.range[1]),a.min&&(e.min=a.min),a.max&&(e.max=a.max),a.parameters&&a.parameters.studyOverZonesEnabled&&(i.noDraw=!0)))}return i},e.Studies.doPostDrawYAxis=function(t,i){for(var a in t.layout.studies){var r=t.layout.studies[a],s=t.panels[r.panel];if(s&&!s.hidden)if(r.getYAxis(t)==i){var n=r.study;if(i.name==r.name&&(n.yaxis&&n.yaxis(t,r),n.yAxisFN&&n.yAxisFN(t,r)),e.Studies.drawZones(t,r),!r.error){var o=n.centerline;(o||0===o||null!==o&&i.highValue>0&&i.lowValue<0)&&e.Studies.drawHorizontal(t,r,null,o||0,i)}}}},e.Studies.createYAxis=function(t,e,i,a){},e.Studies.displaySeriesAsLine=function(t,i,a){if(a.length){var r=t.panels[i.panel];if(r&&!r.hidden)for(var s in i.outputMap)e.Studies.displayIndividualSeriesAsLine(t,i,r,s,a)}},e.Studies.displaySeriesAsHistogram=function(t,e,i){if(i.length){var a=t.panels[e.panel];if(a&&!a.hidden){var r=[];for(var s in e.outputMap){var n=e.outputs[e.outputMap[s]];if(n){var o=.3;"object"==_typeof(n)&&(o=n.opacity,n=n.color);var l={field:s,fill_color_up:n,border_color_up:n,fill_color_down:n,border_color_down:n};e.underlay&&(l.opacity_up=l.opacity_down=o||.3),r.push(l)}}var h=e.getYAxis(t),c=e.inputs,u=c.WidthFactor;if(e.study&&e.study.parameters){var p=e.study.parameters;void 0!==p.widthFactor&&(u=p.widthFactor)}var d={name:e.name,type:c.HistogramType?c.HistogramType:"overlaid",panel:e.panel,yAxis:h,widthFactor:u||.5,bindToYAxis:!0,highlight:e.highlight};t.drawHistogram(d,r)}}},e.Studies.displayIndividualSeriesAsLine=function(t,i,a,r,s){a.height||(a.height=a.bottom-a.top);var n=i.getContext(t),o=i.outputs[i.outputMap[r]];if(o){n.save(),"string"==typeof o&&(o={color:o,width:1}),n.lineWidth=o.width||1;var l=o.color;"auto"==l&&(l=t.defaultColor),n.strokeStyle=l;var h=o.pattern;n.setLineDash(e.borderPatternToArray(n.lineWidth,h)),n.lineDashOffset=0;var c=0,u=i.study,p=i.getYAxis(t);c=t.decimalPlacesFromPriceTick(p.priceTick),(i.overlay||i.underlay)&&(c=null),(p.decimalPlaces||0===p.decimalPlaces)&&(c=p.decimalPlaces);var d=null;i.parameters&&(d=i.parameters.label);var m=u.parameters;m||(m={});var g="step"==m.plotType;if(i.series)for(var f in i.series){var y=i.series[f].parameters.type;y&&(g="step"==y)}m.noLabels&&(d=!1),i.noSlopes||!1===i.noSlopes||(i.noSlopes=m.noSlopes),i.extendToEnd||!1===i.extendToEnd||(i.extendToEnd=m.extendToEnd);var v=d||t.preferences.labels&&!1!==d,x=i.gaplines;!1===x&&(x="transparent");var b=i.inputs.Symbol,S=x?t.getGapColorFunction(b,r,o,x):null;t.plotDataSegmentAsLine(r,a,{yAxis:p,skipTransform:t.panels[i.panel].name!=i.chart.name,label:v,labelDecimalPlaces:c,noSlopes:i.noSlopes,step:g,extendToEndOfDataSet:i.extendToEnd,gapDisplayStyle:x,highlight:i.highlight},S),u.appendDisplaySeriesAsLine&&u.appendDisplaySeriesAsLine(t,i,s,r,a),n.restore()}},e.Studies.drawHorizontal=function(t,e,i,a,r,s){var n=t.panels[e.panel],o=e.getContext(t);if(n){s||(s=r.textStyle);var l=t.pixelFromPrice(a,n,r);l>r.top&&l<r.bottom&&t.plotLine(n.left,n.right,l,l,s,"segment",o,!1,{opacity:s&&s.opacity?s.opacity:.5})}},e.Studies.displayHistogramWithSeries=function(t,i,a){t.panels[i.panel];var r=.5;i.underlay&&(r=.3),e.Studies.createHistogram(t,i,a,!1,r),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.drawZones=function(t,i,a){if(i.parameters&&i.parameters.studyOverZonesEnabled){var r=parseFloat(i.parameters.studyOverSoldValue),s=parseFloat(i.parameters.studyOverBoughtValue),n=i.parameters.studyOverSoldColor,o=i.parameters.studyOverBoughtColor,l=i.zoneOutput;l||(l="Result");var h=e.Studies.determineColor(i.outputs[l]);h&&"auto"!=h&&!e.isTransparent(h)||(h=t.defaultColor),n||(n=h),n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor),o||(o=h),o&&"auto"!=o&&!e.isTransparent(o)||(o=t.defaultColor);var c=t.panels[i.panel],u=i.getYAxis(t),p=u.displayBorder;!1===t.axisBorders&&(p=!1),!0===t.axisBorders&&(p=!0),0===u.width&&(p=!1);var d="left"==t.getYAxisCurrentPosition(u,c),m=u.justifyRight;m||!1===m||(m=t.chart.yAxis.justifyRight||!1===t.chart.yAxis.justifyRight?t.chart.yAxis.justifyRight:d);var g=Math.round(u.left+(d?u.width:0))+.5,f=p?3:0,y=i.getContext(t),v=y.fillStyle;y.globalAlpha=.2,t.startClip(c.name,!0),y.beginPath();var x=Math.round(t.pixelFromPrice(s,c,u))+.5;y.strokeStyle=o,y.moveTo(c.left,x),y.lineTo(c.right,x),y.stroke(),y.closePath(),y.beginPath();var b=Math.round(t.pixelFromPrice(r,c,u))+.5;y.strokeStyle=n,y.moveTo(c.left,b),y.lineTo(c.right,b),y.stroke(),y.closePath();var S=new e.Plotter;if(S.newSeries("border","stroke",t.canvasStyle("stx_grid_border")),p){var C=d?g-f:g-.5,w=d?g+.5:g+f;S.moveTo("border",C,x),S.lineTo("border",w,x),S.moveTo("border",C,b),S.lineTo("border",w,b)}y.fillStyle=v;var T={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:l+" "+i.name,yAxis:u,opacity:.3};if(!i.highlight&&t.highlightedDraggable&&(T.opacity*=.3),e.preparePeakValleyFill(t,e.extend(T,{threshold:s,direction:u.flipped?-1:1,color:o})),e.preparePeakValleyFill(t,e.extend(T,{threshold:r,direction:u.flipped?1:-1,color:n})),y.globalAlpha=1,!i.study||!i.study.yaxis){if(p){var k=Math.round(u.bottom)+.5;S.moveTo("border",g,u.top),S.lineTo("border",g,k),S.draw(y,"border")}var D;if(0!==u.width)t.canvasFont("stx_yaxis"),t.canvasColor("stx_yaxis"),y.textAlign=m?"right":"left",d?(D=u.left+3,m&&(D=u.left+u.width-f-3)):(D=u.left+f+3,m&&(D=u.left+u.width)),y.fillStyle=o,y.fillText(s,D,x),y.fillStyle=n,y.fillText(r,D,b),y.fillStyle=v}t.endClip(),y.globalAlpha=1,u.name==i.name&&(u.yAxisPlotter=new e.Plotter)}},e.Studies.createHistogram=function(t,i,a,r,s){var n=t.panels[i.panel],o=i.getContext(t),l=i.getYAxis(t);t.startClip(n.name);var h=t.layout.candleWidth-2;h<2&&(h=1);var c=t.pixelFromPrice(0,n,l);l.min>0&&(c=t.pixelFromPrice(l.min,n,l)),r&&(c=Math.floor(n.top+n.height/2));var u=i.name+"_hist";i.outputs["Decreasing Bar"]||i.outputs["Negative Bar"]?o.globalAlpha=s||1:t.canvasColor("stx_histogram"),!i.highlight&&t.highlightedDraggable&&(o.globalAlpha*=.3);for(var p=null,d=null,m=i.outputs,g=0;g<a.length;g++){var f=a[g];if(f){f.candleWidth&&(h=Math.floor(Math.max(1,f.candleWidth-2)));var y=Math.floor(t.pixelFromBar(g,n.chart)-h/2),v=Math.floor(h);if(null===p){var x=t.tickFromPixel(y,n.chart)-1;p=x<0?d:t.pixelFromPrice(t.chart.dataSet[x][u],n,l)-c}else p=d;d=t.pixelFromPrice(f[u],n,l)-c;var b=e.Studies.determineColor(m["Decreasing Bar"]),S=e.Studies.determineColor(m["Increasing Bar"]),C=e.Studies.determineColor(m["Positive Bar"]),w=e.Studies.determineColor(m["Negative Bar"]),T=l.flipped;b&&(T?d<p:d>p)?o.fillStyle=b:S&&(T?d>p:d<p)?o.fillStyle=S:C&&(T?d>0:d<0)?o.fillStyle=C:w&&(T?d<0:d>0)&&(o.fillStyle=w),o.fillRect(y,c,v,Math.floor(d))}}o.globalAlpha=1,t.endClip()},e.Studies.volumeChart=function(t,e,i,a){var r,s,n=-1*Number.MAX_VALUE;for(r in i)for(var o=0;o<i[r].length;o++)(s=i[r][o])&&s>n&&(n=s);var l=t.panels[e.panel],h=Math.floor(l.yAxis.bottom)+.5,c=h-(Math.floor(l.yAxis.top)+.5),u=t.layout.candleWidth,p=null;e.parameters&&e.parameters.displayBorder||(a=null);var d=0;a||(d=(u-t.chart.tmpWidth)/2);var m=e.getContext(t);for(r in m.lineWidth=1,t.startClip(e.panel),i){a&&(p=a[r]),m.fillStyle=r,p&&(m.strokeStyle=p),m.beginPath();for(var g,f=h+.5,y=Math.floor(t.pixelFromBar(0,l.chart)),v=0;v<i[r].length;v++)if(t.chart.dataSegment[v]&&t.chart.dataSegment[v].candleWidth?(u=t.chart.dataSegment[v].candleWidth,a||(d=u/4)):(u=t.layout.candleWidth,a||(d=(u-t.chart.tmpWidth)/2)),0===v&&(g=y-=u/2),s=i[r][v]){var x,b,S=s*(c/n),C=Math.min(Math.floor(h-c+(c-S))+.5,h);x=Math.floor(g+d),b=Math.floor(g+u-d),x=Math.max(x,y),m.moveTo(x,h),m.lineTo(b,h),m.lineTo(b,C),m.lineTo(x,C),a?(f>C||0===v)&&m.lineTo(x,f):m.lineTo(x,h),f=C,g+=u}else f=h,g+=u;m.fill(),m.strokeStyle=p,a&&t.layout.candleWidth>=2&&m.stroke(),m.closePath()}t.endClip()},e.Studies.prettify={Close:"C",Open:"O",High:"H",Low:"L",simple:"ma",exponential:"ema","time series":"tsma",triangular:"tma",variable:"vma",VIDYA:"vdma",weighted:"wma","welles wilder":"smma",true:"y",false:"n"},e.Studies.prettyRE=/^.*\((.*?)\).*$/,e.Studies.prettyDisplay=function(t){var i=e.Studies.prettyRE.exec(t);if(!i)return t;var a=i[1];if(a){for(var r in e.Studies.prettify)a=a.replace(r,e.Studies.prettify[r]);t=t.replace(i[1],a)}return t},e.Studies.getFieldInputs=function(t){var e=[],i=t.study.inputs;for(var a in i)"field"==i[a]&&e.push(a);return e},e.Studies.initializeFN=function(t,i,a,r,s,n,o){a||(a={id:i}),s||(s={}),a.display||(a.display=a.id);var l=new e.Studies.StudyDescriptor(a.id,i,a.id,a,r,s);a.Period&&(l.days=Math.max(1,parseInt(l.inputs.Period,10))),o?(o.inputs||(o.inputs=l.study.inputs),o.outputs||(o.outputs=l.study.outputs),l.study=o):o=l.study,o.display&&(a.display=o.display),"string"==typeof s.panelName&&(n=s.panelName),(n==a.id||n&&!t.panelExists(n))&&(l.underlay=l.overlay=!1),"Own panel"!=n&&"New panel"!=n||(n=null);var h=l.overlay||a.Overlay||!1!==l.overlay&&o.overlay,c=l.underlay||a.Underlay||!1!==l.underlay&&o.underlay;h&&s.underlayEnabled&&(c=!0),c&&(l.underlay=!0),!c&&t.chart.panel&&n==t.chart.panel.name&&(h=!0),h&&(l.overlay=!0);var u=t.preferences.dragging;if((!0===u||u&&u.study)&&(l.overlay=!0),n?s.panelName=n:h||c||(n=a.id),s.calculateOnly)return(h||c)&&(t.panels[s.panelName]?l.panel=s.panelName:l.panel=e.Studies.getPanelFromFieldName(t,l)||s.chartName),l;var p={},d=t.layout.studies[s.replaceID];if(d&&(p={outputMap:e.clone(d.outputMap),panel:d.panel}),l.panel="",n){var m=e.Studies.smartMovePanel(t,l.inputs,n,s.replaceID,"New panel"==s.panelName);m&&(l.panel=m.name)}else(h||c)&&(l.panel=e.Studies.getPanelFromFieldName(t,l)||s.chartName);if(!l.panel){var g=o.panelHeight||null,f=o.yAxis||{};f.name=l.inputs.id,l.panel=l.inputs.id,t.createPanel(l.inputs.display,l.panel,g,s.chartName,new e.ChartEngine.YAxis(f))}l.parameters&&l.parameters.panelName&&(l.parameters.panelName=l.panel);var y=t.panels[l.panel],v=e.Studies.smartCreateYAxis(t,y,l.inputs.id,s.yaxisDisplayValue,s.yAxis||o.yAxis),x=o?e.clone(o.yAxis):null,b=x||v;if(b&&(b.ground&&(b.initialMarginBottom=0),(b.initialMarginTop||0===b.initialMarginTop||b.initialMarginBottom||0===b.initialMarginBottom)&&t.calculateYAxisMargins(b),b.name==s.replaceID&&(b.name=l.inputs.id)),v&&(v.width="none"==v.position?0:e.ChartEngine.YAxis.prototype.width,"shared"==s.yaxisDisplayValue||"default"==s.yaxisDisplayValue?delete s.yaxisDisplayValue:x?e.ensureDefaults(v,x):v.name==l.name&&(s.yaxisDisplayColor&&"auto"!=s.yaxisDisplayColor?v.textStyle=e.colorToHex(s.yaxisDisplayColor):delete v.textStyle,v.justifyRight=null,v.flipped=s.flippedEnabled),v!=y.yAxis?v.displayGridLines=!1:v!=t.chart.yAxis&&(v.displayGridLines=t.displayGridLinesInStudies)),t.calculateYAxisPositions(),d){var S=!1;for(var C in t.drawingObjects){var w=t.drawingObjects[C];p.outputMap&&p.outputMap.hasOwnProperty(w.field)?(w.field=w.field.replace(s.replaceID,l.inputs.id),l.parameters&&l.parameters.panelName?w.panelName=l.parameters.panelName:w.panelName=l.panel,S=!0):p.panel&&p.panel==w.panelName&&(w.panelName=w.panelName.replace(s.replaceID,l.inputs.id),S=!0)}S&&t.changeOccurred("vector")}return l},e.Studies.smartMovePanel=function(t,e,i,a,r){var s,n=e.id;if(a&&(s=t.layout.studies[a]),s){var o=t.panels[s.panel];if(o&&o.yAxis.name==a)if(!r&&i==a||t.checkForEmptyPanel(o.name,!0,s))i!=a&&t.panels[i]||(n!=o.name&&t.modifyPanel(o,{name:n,display:e.display}),i=n);else{t.electNewPanelOwner(o);var l=s.getYAxis(t);l.name==a&&t.electNewYAxisOwner(l)}}return t.panels[i]},e.Studies.smartCreateYAxis=function(t,i,a,r,s){var n=t.getYAxisByName(i,a);if(!r&&s&&(r=s.position),"default"!=r&&"shared"!=r&&r!=i.yAxis.name||(r=""),["left","right","none"].indexOf(r)>-1){if(!n||n.isShared()){var o=s||{};if(e.extend(o,{name:a,position:r}),n||t.currentlyImporting||i.yAxis.studies.length||i.yAxis.renderers.length){var l=n==i.yAxis;n&&(n.name=t.electNewYAxisOwner(n)),n=t.addYAxis(i,new e.ChartEngine.YAxis(o)),l&&(i.yAxis=n)}else n=i.yAxis,e.extend(n,o)}else n.position=r;return n}if(r){var h=t.getYAxisByName(i,r);return h&&n==i.yAxis&&!n.isShared()&&(i.yAxis=h),n&&n.isShared()?n.name=t.electNewYAxisOwner(n):n!==i.yAxis&&t.deleteYAxisIfUnused(i,n),h}return n&&(n.isShared()?n.name=t.electNewYAxisOwner(n):(delete n.position,n!==i.yAxis&&t.deleteYAxisIfUnused(i,n))),t.resizeChart(),i.yAxis},e.Studies.overZones=e.Studies.drawZones,e.Studies.displayPSAR2=function(t,i,a){var r=t.panels[i.panel],s=i.getYAxis(t),n=s==t.chart.panel.yAxis;t.startClip(r.name);var o=i.getContext(t),l="squarewave"==i.inputs["Plot Type"];for(var h in i.outputs){var c=h+" "+i.name;o.beginPath();for(var u=t.layout.candleWidth,p=Math.max(3,Math.floor(t.chart.tmpWidth/2)),d=0;d<a.length;d++){var m=a[d];if(m&&(m[c]||0===m[c])){m.candleWidth&&(u=m.candleWidth),n&&m.transform&&(m=m.transform);var g=t.pixelFromBar(d,r.chart);l&&(g-=u/2);var f=t.pixelFromTransformedValue(m[i.referenceOutput?i.referenceOutput+" "+i.name:c],r,s);if(0!==d&&a[d-1]&&(a[d-1][c]||0===a[d-1][c])||o.moveTo(g,f),l){if(o.lineTo(g,f),o.lineTo(g+u,f),a[d+1]){var y=a[d+1];n&&y.transform&&(y=y.transform),y[c]||0===y[c]||o.lineTo(g+u,t.pixelFromTransformedValue(y[i.referenceOutput?i.referenceOutput+" "+i.name:c],t.panels[i.panel],s))}}else o.moveTo(g-p/2,f),o.lineTo(g+p/2,f)}}o.lineWidth=1,i.highlight&&(o.lineWidth=3);var v=e.Studies.determineColor(i.outputs[h]);"auto"==v&&(v=t.defaultColor),o.strokeStyle=v,!i.highlight&&t.highlightedDraggable&&(o.globalAlpha*=.3),o.stroke(),o.closePath(),o.lineWidth=1}t.endClip()},e.Studies.calculateVolume=function(t,i){if("vol undr"==i.type){if(!t||!t.chart.dataSet)return;var a=t.layout,r=i.parameters.removeStudy,s=a.volumeUnderlay;a.volumeUnderlay=!r,s!=a.volumeUnderlay&&t.changeOccurred("layout"),r&&e.Studies.removeStudy(t,i)}i.outputMap={},i.outputMap.Volume=""},e.Studies.MA=function(t,i,a,r,s,n,o,l){var h=new e.Studies.StudyDescriptor(s+" "+o.name,"ma",o.panel);h.chart=o.chart,h.days=parseInt(i,10),h.startFrom=o.startFrom,l&&(h.subField=l),h.inputs={},t&&(h.inputs.Type=t),a&&(h.inputs.Field=a),r&&(h.inputs.Offset=parseInt(r,10)),e.Studies.calculateMovingAverage(n,h)},e.Studies.movingAverage={conversions:{ma:"simple",sma:"simple",ema:"exponential",tsma:"time series",tma:"triangular",vma:"variable",vdma:"vidya",wma:"weighted",smma:"welles wilder"},translations:{simple:"Simple",exponential:"Exponential","time series":"Time Series",triangular:"Triangular",variable:"Variable",vidya:"VIDYA",weighted:"Weighted","welles wilder":"Welles Wilder"},typeMap:{ema:"Exponential",exponential:"Exponential",tsma:"TimeSeries","time series":"TimeSeries",tma:"Triangular",triangular:"Triangular",vma:"Variable",variable:"Variable",vdma:"VIDYA",vidya:"VIDYA",wma:"Weighted",weighted:"Weighted",smma:"Exponential","welles wilder":"Exponential"}},e.Studies.movingAverageHelper=function(t,i){if("options"==i){var a={};for(var r in e.Studies.movingAverage.translations)a[r]=t.translateIf(e.Studies.movingAverage.translations[r]);return a}return e.Studies.movingAverage.conversions[i]},e.Studies.volUnderlay=function(t,i,a){e.Studies.createVolumeChart(t,i,a)},e.Studies.createVolumeChart=function(t,i,a){var r=i.panel,s=(i.inputs,i.underlay),n=(i.overlay,e.Studies.determineColor(i.outputs["Up Volume"])),o=e.Studies.determineColor(i.outputs["Down Volume"]),l=s?"stx_volume_underlay":"stx_volume";t.setStyle(l+"_up","color",n),t.setStyle(l+"_down","color",o);var h=[{field:"Volume",fill_color_up:t.canvasStyle(l+"_up").color,border_color_up:t.canvasStyle(l+"_up").borderLeftColor,opacity_up:t.canvasStyle(l+"_up").opacity,fill_color_down:t.canvasStyle(l+"_down").color,border_color_down:t.canvasStyle(l+"_down").borderLeftColor,opacity_down:t.canvasStyle(l+"_down").opacity}],c=h[0];s||"rgb(184, 44, 12)"!==c.border_color_down||(c.border_color_down="#000000",c.border_color_up="#000000");var u={name:"Volume",panel:r,yAxis:i.getYAxis(t),widthFactor:1,bindToYAxis:!0,highlight:i.highlight};e.extend(u,i.study.parameters),e.extend(u,i.parameters),t.colorByCandleDirection&&(c.color_function=function(t){var e=t.Open,i=t.Close;return{fill_color:e>i?c.fill_color_down:c.fill_color_up,border_color:e>i?c.border_color_down:c.border_color_up,opacity:e>i?c.opacity_down:c.opacity_up}}),t.drawHistogram(u,h)},e.Studies.calculateRSI=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;function r(t,e){return 0===e?100:100-100/(1+t/e)}if(a&&"field"!=a||(a="Close"),i.length<e.days+1)e.error=!0;else{for(var s=e.startFrom;s<i.length;s++)if(s){var n=i[s],o=i[s-1],l=n[a]-o[a],h=Math.min(s,e.days),c=o["_avgG "+e.name];c||(c=0),c-=c/h;var u=o["_avgL "+e.name];u||(u=0),u-=u/h,l>0?c+=l/h:u-=l/h,s>=e.days&&(n["RSI "+e.name]=r(c,u)),n["_avgG "+e.name]=c,n["_avgL "+e.name]=u}e.zoneOutput="RSI"}},e.Studies.calculateMACD=function(t,i){var a=i.chart.scrubbed,r=i.inputs,s=i.name;if(i.macd1Days||(i.macd1Days=parseFloat(r["Fast MA Period"])),i.macd2Days||(i.macd2Days=parseFloat(r["Slow MA Period"])),i.signalDays||(i.signalDays=parseFloat(r["Signal Period"])),i.days||(i.days=Math.max(i.macd1Days,i.macd2Days,i.signalDays)),a.length<i.days+1)i.error=!0;else{var n=i.inputs.Field;n&&"field"!=n||(n="Close");var o=r["Moving Average Type"];o||(o="exponential"),e.Studies.MA(o,i.macd1Days,n,0,"_MACD1",t,i),e.Studies.MA(o,i.macd2Days,n,0,"_MACD2",t,i);var l,h,c=Math.max(i.startFrom,i.days-1);for(l=c;l<a.length;l++)(h=a[l])["MACD "+s]=h["_MACD1 "+s]-h["_MACD2 "+s];var u=r["Signal MA Type"];u||(u="exponential"),e.Studies.MA(u,i.signalDays,"MACD "+s,0,"Signal",t,i);var p=s+"_hist";for(l=c;l<a.length;l++){var d=(h=a[l])["Signal "+s];(d||0===d)&&(h[p]=h["MACD "+s]-h["Signal "+s])}i.outputMap[p]=""}},e.Studies.calculateStandardDeviation=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs["Moving Average Type"];s||(s=i.inputs.Type),e.Studies.MA(s,i.days,r,i.inputs.Offset,"_MA",t,i);var n=0,o=0,l=0,h=Number(i.inputs["Standard Deviations"]);h<0&&(h=2);var c,u,p,d=i.name;for(var m in i.outputs)d=m+" "+d;for(c=i.startFrom-1,p=0;c>=0&&p<i.days;c--,p++)(u=a[c][r])&&"object"==_typeof(u)&&(u=u[i.subField]),isNaN(u)&&(u=0),n+=Math.pow(u,2),o+=u;for(c=i.startFrom;c<a.length;c++){var g=a[c];if((u=g[r])&&"object"==_typeof(u)&&(u=u[i.subField]),isNaN(u)&&(u=0),n+=Math.pow(u,2),o+=u,!(c<i.days-1)){if(c>=i.days){var f=a[c-i.days][r];f&&"object"==_typeof(f)&&(f=f[i.subField]),isNaN(f)&&(f=0),n-=Math.pow(f,2),o-=f}l=g["_MA "+i.name],g[d]=Math.sqrt((n+i.days*Math.pow(l,2)-2*l*o)/i.days)*h}}}},e.Studies.calculateMovingAverage=function(t,i){if(i.chart.scrubbed){var a=i.inputs.Type;"ma"!=a&&"sma"!=a&&a||(a="simple");var r=e.Studies.movingAverage.typeMap;if(a in r)return e.Studies["calculateMovingAverage"+r[a]](t,i);if("simple"===a){var s=i.chart.scrubbed,n=0,o=[],l=i.name;for(var h in i.outputs)l=h+" "+l;var c=i.inputs.Field;c&&"field"!=c||(c="Close");var u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p,d,m=i.startFrom,g=u;for(p=i.startFrom-1;p>=0;p--)if((d=s[p][c])&&"object"==_typeof(d)&&(d=d[i.subField]),d||0===d)if(g>0)g--,m=p;else{if(o.length==i.days-1)break;n+=d,o.unshift(d)}for(o.length<i.days-1&&(o=[],m=0),p=m;p<s.length;p++){(d=s[p][c])&&"object"==_typeof(d)&&(d=d[i.subField]);var f=p+u>=0&&p+u<s.length?s[p+u]:null;d||0===d?(n+=d,o.push(d),o.length>i.days&&(n-=o.shift()),f&&(f[l]=o.length==i.days?n/i.days:null)):f&&(f[l]=null)}}}},e.Studies.calculateMovingAverageExponential=function(t,e){var i=e.inputs.Type,a=e.chart.scrubbed,r=0,s=0,n=0,o=2/(e.days+1);"welles wilder"!==i&&"smma"!==i||(o=1/e.days);var l=null,h=e.name;for(var c in e.outputs)h=c+" "+h;var u=e.inputs.Field;u&&"field"!=u||(u="Close");var p,d,m=parseInt(e.inputs.Offset,10);isNaN(m)&&(m=0);var g=e.startFrom,f=m;for(p=e.startFrom-1;p>=0;p--)if((d=a[p][h])||0===d){if(null===l&&(l=d),n=e.days,f<=0)break;f--,g=p}for(null===l&&(l=g=0),p=g;p<a.length;p++){(d=a[p][u])&&"object"==_typeof(d)&&(d=d[e.subField]);var y=p+m>=0&&p+m<a.length?a[p+m]:null;d||0===d?(n==e.days-1?(s=(r+=d)/e.days,y&&(y[h]=s)):n<e.days-1?(s=(r+=d)/(n+1),y&&(y[h]=null)):0===n?(s=r+=d,y&&(y[h]=null)):(l||0===l)&&(s=(d-l)*o+l,y&&(y[h]=s)),l=s,n++):y&&(y[h]=null)}},e.Studies.calculateMovingAverageVariable=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),s=null,n=i.name;for(var o in i.outputs)n=o+" "+n;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.cmo=new e.Studies.StudyDescriptor(i.name,"cmo",i.panel),i.cmo.chart=i.chart,i.cmo.days=9,i.cmo.inputs={Field:l},i.cmo.startFrom=i.startFrom,i.cmo.outputs={_CMO:null},e.Studies.calculateChandeMomentum(t,i.cmo);var h,c,u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p=i.startFrom,d=u;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][n])||0===c){if(null===s&&(s=c),d<=0)break;d--,p=h}for(null===s&&(s=p=0),h=p;h<a.length;h++){var m=a[h];(c=m[l])&&"object"==_typeof(c)&&(c=c[i.subField]);var g=h+u>=0&&h+u<a.length?a[h+u]:null;if(c||0===c){if(m["_CMO "+i.name]||0===m["_CMO "+i.name]){var f=Math.abs(m["_CMO "+i.name])/100,y=r*f*c+(1-r*f)*s;s=y,h<i.days&&(y=null),g&&(g[n]=y)}}else g&&(g[n]=null)}},e.Studies.calculateMovingAverageVIDYA=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),s=null,n=i.name;for(var o in i.outputs)n=o+" "+n;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=5,i.std.startFrom=i.startFrom,i.std.inputs={Field:l,"Standard Deviations":1,Type:"ma"},i.std.outputs={_STD:null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.MA("ma",20,"_STD "+i.name,0,"_MASTD",t,i);var h,c,u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p=i.startFrom,d=u;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][n])||0===c){if(null===s&&(s=c),d<=0)break;d--,p=h}for(null===s&&(s=p=0),h=p;h<a.length;h++){var m=a[h];(c=m[l])&&"object"==_typeof(c)&&(c=c[i.subField]);var g=h+u>=0&&h+u<a.length?a[h+u]:null;if(c||0===c){if(m["_MASTD "+i.name]||0===m["_MASTD "+i.name]){var f=m["_STD "+i.name]/m["_MASTD "+i.name],y=r*f*c+(1-r*f)*s;s=y,h<i.days&&(y=null),g&&(g[n]=y)}}else g&&(g[n]=null)}},e.Studies.calculateMovingAverageTimeSeries=function(t,i){i.ma=new e.Studies.StudyDescriptor(i.name,"ma",i.panel),i.ma.chart=i.chart,i.ma.days=i.days,i.ma.startFrom=i.startFrom,i.ma.inputs=i.inputs,e.Studies.calculateLinearRegressionIndicator(t,i.ma);var a=i.name;for(var r in i.outputs)a=r+" "+a;var s=parseInt(i.inputs.Offset,10);isNaN(s)&&(s=0);for(var n=i.chart.scrubbed,o=s,l=i.startFrom-1;l>=0;l--){var h=n[l][a];if(h||0===h){if(!(o>0))break;o--}}for(l++;l<n.length;l++){var c=n[l];l+s>=0&&l+s<n.length&&(n[l+s][a]=c["Forecast "+i.name])}},e.Studies.calculateMovingAverageTriangular=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=Math.ceil(i.days/2);e.Studies.MA("simple",s,r,0,"TRI1",t,i),i.days%2==0&&s++,e.Studies.MA("simple",s,"TRI1 "+i.name,0,"TRI2",t,i);var n=i.name;for(var o in i.outputs)n=o+" "+n;var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);for(var h=l,c=i.startFrom-1;c>=0;c--){var u=a[c][n];if(u||0===u){if(!(h>0))break;h--}}for(c++;c<a.length;c++)c+l>=0&&c+l<a.length&&(a[c+l][n]=a[c]["TRI2 "+i.name])},e.Studies.calculateMovingAverageWeighted=function(t,e){var i=e.chart.scrubbed,a=0,r=0,s=e.inputs.Field;s&&"field"!=s||(s="Close");var n=e.days*(e.days+1)/2,o=e.name;for(var l in e.outputs)o=l+" "+o;var h,c,u=parseInt(e.inputs.Offset,10);isNaN(u)&&(u=0);var p=[],d=e.startFrom,m=u;for(h=e.startFrom-1;h>=0;h--)if((c=i[h][s])&&"object"==_typeof(c)&&(c=c[e.subField]),c||0===c)if(m>0)m--,d=h;else{if(p.length==e.days-1)break;p.unshift(c)}for(p.length<e.days-1&&(p=[],d=0),h=0;h<p.length;h++)a+=(h+1)*p[h],r+=p[h];for(h=d;h<i.length;h++){(c=i[h][s])&&"object"==_typeof(c)&&(c=c[e.subField]);var g=h+u>=0&&h+u<i.length?i[h+u]:null;c||0===c?(p.push(c),p.length>e.days&&(a-=r,r-=p.shift()),a+=p.length*c,r+=c,h<e.days-1?g&&(g[o]=null):g&&(g[o]=a/n)):g&&(g[o]=null)}},e.Studies.calculateKlinger=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),s=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s)+1)i.error=!0;else{var n,o=i.name+"_hist",l="Klinger "+i.name,h="KlingerSignal "+i.name,c="_SV "+i.name,u="_EMA-S "+i.name,p="_EMA-L "+i.name;for(n=Math.max(1,i.startFrom);n<a.length;n++){var d=a[n].Volume;a[n]["hlc/3"]<a[n-1]["hlc/3"]&&(d*=-1),a[n][c]=d}for(e.Studies.MA("exponential",r,c,0,"_EMA-S",t,i),e.Studies.MA("exponential",s,c,0,"_EMA-L",t,i),n=Math.max(s,i.startFrom);n<a.length;n++)a[n][l]=a[n][u]-a[n][p];for(e.Studies.MA("exponential",Number(i.inputs["Signal Periods"]),l,0,"KlingerSignal",t,i),n=i.startFrom;n<a.length;n++)a[n][o]=a[n][l]-a[n][h];i.outputMap[o]=""}},e.Studies.calculateStochastics=function(t,i){i.smooth||(i.smooth=i.inputs.Smooth);var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.inputs["%K Periods"];r||(r=i.days);var s=i.chart.scrubbed;if(s.length<Math.max(r,i.days)+1)i.error=!0;else{var n=i.inputs["%K Smoothing Periods"];n?i.smooth=!0:i.smooth&&(n=3);var o=i.inputs["%D Periods"];o||(o=3),i.outputMap={},i.outputMap["%K "+i.name]="Fast",i.outputMap["%D "+i.name]="Slow";for(var l=Math.max(r,i.startFrom);l<s.length;l++)s[l][i.name]=h(l,a,r);e.Studies.MA("simple",i.smooth?n:1,i.name,0,"%K",t,i),e.Studies.MA("simple",o,"%K "+i.name,0,"%D",t,i)}function h(t,e,i){for(var a=t-i+1,r=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,o=a;o<=t;o++)n=Math.min(n,"Close"==e?s[o].Low:s[o][e]),r=Math.max(r,"Close"==e?s[o].High:s[o][e]);return r==n?0:(s[t][e]-n)/(r-n)*100}},e.Studies.calculateStudyATR=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else for(var r=0,s=e.name,n=Math.max(e.startFrom,1);n<i.length;n++){var o=i[n],l=i[n-1],h=o.trueRange;l["Sum True Range "+s]&&(r=l["Sum True Range "+s]),r+=h,n>a&&(r-=i[n-a]["True Range "+s]),o["True Range "+s]=h,o["Sum True Range "+s]=r,n==a?o["ATR "+s]=r/a:n>a&&(o["ATR "+s]=(l["ATR "+s]*(a-1)+h)/a)}},e.Studies.calculatePSAR=function(t,e){var i=e.chart.scrubbed,a=0,r=null,s=!1,n=0,o=parseFloat(e.inputs["Minimum AF"]),l=parseFloat(e.inputs["Maximum AF"]);function h(){a=0,r=null,s=!s}if(e.startFrom>0){n=i[e.startFrom-1]["Result "+e.name];var c=i[e.startFrom-1]["_state "+e.name];c&&3==c.length&&(a=c[0],r=c[1],s=c[2])}for(var u=e.startFrom-1;u<i.length-1;u++)if(!(u<0)){var p=n;if(s){(!r||r<i[u].High)&&(r=i[u].High,a=Math.min(a+o,l)),n=p+a*(r-p);var d=Math.min(i[Math.max(1,u)-1].Low,i[u].Low);n>i[u+1].Low?(n=r,h()):n>d&&(n=d)}else{(!r||r>i[u].Low)&&(r=i[u].Low,a=Math.min(a+o,l)),n=p+a*(r-p);var m=Math.max(i[Math.max(1,u)-1].High,i[u].High);n<i[u+1].High?(n=r,h()):n<m&&(n=m)}i[u+1]["Result "+e.name]=n,i[u+1]["_state "+e.name]=[a,r,s]}},e.Studies.calculateTRIX=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.name,s=["Close","_MA1 "+r,"_MA2 "+r,"_MA3 "+r],n=0;n<s.length-1;n++)e.Studies.MA("exponential",i.days,s[n],0,"_MA"+(n+1).toString(),t,i);for(var o=s[3],l=Math.max(1,i.startFrom);l<a.length;l++){var h=a[l-1][o];h&&(a[l]["Result "+r]=100*(a[l][o]/h-1))}}},e.Studies.calculateIntradayMomentum=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{var r=0,s=0;e.startFrom>1&&(r=i[e.startFrom-1]["_totUp "+e.name],s=i[e.startFrom-1]["_totDn "+e.name]);for(var n=e.startFrom;n<i.length;n++){var o=i[n].Close-i[n].Open;if(o>0?r+=o:s-=o,n>=a){var l=i[n-a].Close-i[n-a].Open;l>0?r-=l:s+=l}i[n]["Result "+e.name]=100*r/(r+s),i[n]["_totUp "+e.name]=r,i[n]["_totDn "+e.name]=s}}},e.Studies.calculateQStick=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_Close-Open "+i.name]=a[r].Close-a[r].Open;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Close-Open "+i.name,0,"Result",t,i)}},e.Studies.calculateSchaff=function(t,i){var a=i.chart.scrubbed,r=i.days,s=Number(i.inputs["Short Cycle"]),n=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s,n)+1)i.error=!0;else{var o=i.inputs.Field;o&&"field"!=o||(o="Close");e.Studies.MA(i.inputs["Moving Average Type"],s,o,0,"_MACD1",t,i),e.Studies.MA(i.inputs["Moving Average Type"],n,o,0,"_MACD2",t,i);for(var l=0,h=0,c=i.startFrom;c<a.length;c++){var u=a[c];if(u["Result "+i.name]=h,!(c<n-1||(u["_MACD "+i.name]=u["_MACD1 "+i.name]-u["_MACD2 "+i.name],c<n+(r-1)))){var p=d(r,c,"_MACD");l=p[1]>p[0]?100*(u["_MACD "+i.name]-p[0])/(p[1]-p[0]):l,u["_PF "+i.name]=a[c-1]["_PF "+i.name]?a[c-1]["_PF "+i.name]+.5*(l-a[c-1]["_PF "+i.name]):l,c<n+2*(r-1)||(h=(p=d(r,c,"_PF"))[1]>p[0]?100*(u["_PF "+i.name]-p[0])/(p[1]-p[0]):h,u["Result "+i.name]=a[c-1]["Result "+i.name]?a[c-1]["Result "+i.name]+.5*(h-a[c-1]["Result "+i.name]):h)}}}function d(t,e,r){for(var s=null,n=null,o=e-t+1;o<=e;o++){var l=a[o][r+" "+i.name];l&&(s=null===s?l:Math.min(s,l),n=null===n?l:Math.max(n,l))}return[s,n]}},e.Studies.calculateStochMomentum=function(t,i){var a=Number(i.inputs["%K Periods"]),r=Number(i.inputs["%K Smoothing Periods"]),s=Number(i.inputs["%K Double Smoothing Periods"]),n=Number(i.inputs["%D Periods"]),o=i.chart.scrubbed;if(o.length<a+r+s-1||o.length<n)i.error=!0;else{var l;for(l=Math.max(a,i.startFrom)-1;l<o.length;l++){var h=o[l],c=u(a,l);h["_H "+i.name]=h.Close-(c[0]+c[1])/2,h["_DHL "+i.name]=c[1]-c[0]}for(e.Studies.MA("exponential",r,"_H "+i.name,0,"_HS1",t,i),e.Studies.MA("exponential",s,"_HS1 "+i.name,0,"_HS2",t,i),e.Studies.MA("exponential",r,"_DHL "+i.name,0,"_DHL1",t,i),e.Studies.MA("exponential",s,"_DHL1 "+i.name,0,"_DHL2",t,i),l=a-1;l<o.length;l++)o[l]["%K "+i.name]=o[l]["_HS2 "+i.name]/(.5*o[l]["_DHL2 "+i.name])*100;e.Studies.MA(i.inputs["%D Moving Average Type"],n,"%K "+i.name,0,"%D",t,i),i.zoneOutput="%K"}function u(t,e){for(var i=null,a=null,r=e-t+1;r<=e;r++)i=null===i?o[r].Low:Math.min(i,o[r].Low),a=null===a?o[r].High:Math.max(a,o[r].High);return[i,a]}},e.Studies.calculateEhlerFisher=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0;e.startFrom>1&&(a=i[e.startFrom-1]["_n "+e.name]);for(var r=e.startFrom;r<i.length;r++){var s=i[r];if(r<e.days-1)s["EF "+e.name]=s["EF Trigger "+e.name]=a;else{var n=l(e.days,r);(a=.66*(((i[r].High+i[r].Low)/2-n[0])/Math.max(1e-6,n[1]-n[0])-.5)+.67*a)>0?a=Math.min(a,.9999):a<0&&(a=Math.max(a,-.9999));var o=r?i[r-1]["EF "+e.name]:0;s["EF "+e.name]=.5*Math.log((1+a)/(1-a))+.5*o,s["EF Trigger "+e.name]=o,s["_n "+e.name]=a}}}function l(t,e){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,s=e-t+1;s<=e;s++){var n=(i[s].High+i[s].Low)/2;a=Math.min(a,n),r=Math.max(r,n)}return[a,r]}},e.Studies.calculatePrettyGoodOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("exponential",i.days,"trueRange",0,"_EMA",t,i),e.Studies.MA("simple",i.days,"Close",0,"_SMA",t,i);for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_SMA "+i.name]&&a[r]["_EMA "+i.name]&&(a[r]["Result "+i.name]=(a[r].Close-a[r]["_SMA "+i.name])/a[r]["_EMA "+i.name])}},e.Studies.calculateUltimateOscillator=function(t,e){var i=e.chart.scrubbed,a=[e.inputs["Cycle 1"],e.inputs["Cycle 2"],e.inputs["Cycle 3"]],r=Math.max(a[0],a[1],a[2]);if(i.length<r+1)e.error=!0;else{var s=a[0]*a[1],n=a[0]*a[2],o=a[1]*a[2],l=[0,0,0],h=[0,0,0];e.startFrom&&(i[e.startFrom-1]["_accbp "+e.name]&&(l=i[e.startFrom-1]["_accbp "+e.name].slice()),i[e.startFrom-1]["_acctr "+e.name]&&(h=i[e.startFrom-1]["_acctr "+e.name].slice()));for(var c=Math.max(1,e.startFrom);c<i.length;c++){for(var u=Math.min(i[c].Low,i[c-1].Close),p=i[c].Close-u,d=Math.max(i[c].High,i[c-1].Close)-u,m=0;m<a.length;m++)if(l[m]+=p,h[m]+=d,c>a[m]){var g=Math.min(i[c-a[m]].Low,i[c-a[m]-1].Close),f=i[c-a[m]].Close-g,y=Math.max(i[c-a[m]].High,i[c-a[m]-1].Close)-g;l[m]-=f,h[m]-=y}if(i[c]["_accbp "+e.name]=l.slice(),i[c]["_acctr "+e.name]=h.slice(),!(c<r)){var v=o*l[0]/h[0]+n*l[1]/h[1]+s*l[2]/h[2],x=o+n+s;i[c]["Result "+e.name]=100*v/x}}}},e.Studies.calculatePriceVolumeTrend=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var s=Math.max(1,e.startFrom);s<a.length;s++)a[s][i]&&a[s-1][i]&&(r+=a[s].Volume*(a[s][i]-a[s-1][i])/a[s-1][i],a[s]["Result "+e.name]=r)},e.Studies.calculateOnBalanceVolume=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.inputs["Min Tick Value"],r=!1;a||0===a||(r=!0,a=0);for(var s,n,o=e.chart.scrubbed,l=0,h=e.startFrom;h<o.length;h++)if(s=o[h],h&&s[i]&&(o[h-1][i]&&(n=o[h-1]),n)){s[i]-n[i]>a?l=1:n[i]-s[i]>a?l=-1:r&&(l=0);var c=n["Result "+e.name];c||(c=0),c+=s.Volume*l,s["Result "+e.name]=c}},e.Studies.calculateVolumeIndex=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.chart.scrubbed;if(r.length<i.days+1)i.error=!0;else{var s=100;i.startFrom>1&&(s=r[i.startFrom-1]["Index "+i.name]);for(var n=Math.max(1,i.startFrom);n<r.length;n++){var o=r[n][a],l=r[n].Volume;o&&"object"==_typeof(o)&&(l=o.Volume,o=o[i.subField]);var h=r[n-1][a],c=r[n-1].Volume;h&&"object"==_typeof(h)&&(c=h.Volume,h=h[i.subField]),o&&(h&&(("Pos Vol"==i.type&&l>c||"Neg Vol"==i.type&&l<c)&&(s*=o/h),r[n]["Index "+i.name]=s))}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Index "+i.name,0,"MA",t,i)}},e.Studies.calculateHistoricalVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Standard Deviations"];r<0&&(r=1);var s,n=100*Math.sqrt((s=e.inputs["Days Per Year"],isNaN(s)&&(s=365),"day"==t.layout.interval?s:"week"==t.layout.interval?52:"month"==t.layout.interval?12:s))*r,o=[],l=0;e.startFrom>1&&(l=i[e.startFrom-1]["_state "+e.name][0],o=i[e.startFrom-1]["_state "+e.name][1].slice());for(var h=Math.max(1,e.startFrom);h<i.length;h++){var c=i[h-1][a];if(c){var u=Math.log(i[h][a]/c);if(o.push(u),l+=u,h>=e.days){var p=0;l/=e.days;for(var d=0;d<o.length;d++)p+=Math.pow(o[d]-l,2);l*=e.days,l-=o.shift(),i[h]["Result "+e.name]=Math.sqrt(p/e.days)*n}}i[h]["_state "+e.name]=[l,o.slice()]}}},e.Studies.calculateSwingIndex=function(t,e){var i=e.inputs["Limit Move Value"];(null===i||isNaN(i))&&(i=99999);var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var s=Math.max(1,e.startFrom);s<a.length;s++){var n=Math.abs(a[s].High-a[s-1].Close),o=Math.abs(a[s].Low-a[s-1].Close),l=Math.abs(a[s].High-a[s].Low),h=Math.abs(a[s-1].Close-a[s-1].Open),c=Math.max(n,o),u=Math.max(l,c),p=u+.25*h;u==n?p-=.5*o:u==o&&(p-=.5*n);var d=50*(a[s].Close-a[s-1].Close+.5*(a[s].Close-a[s].Open)+.25*(a[s-1].Close-a[s-1].Open))/p*(c/i);0!==p&&0!==i||(d=0),"Swing"==e.type&&(r=0),r+=d,a[s]["Result "+e.name]=r}},e.Studies.calculateADX=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed,r=i.days,s=parseInt(i.inputs["Smoothing Period"],10);if(s||0===s||(s=r),a.length<i.days+1)i.error=!0;else for(var n,o=0,l=0,h=0,c=0,u=Math.max(1,i.startFrom);u<a.length;u++){n=a[u];var p=Math.max(0,n.High-a[u-1].High),d=Math.max(0,a[u-1].Low-n.Low);if(p>d?d=0:p=d>p?0:d=0,u<=r?(l+=p,h+=d,o+=n["True Range "+i.name]):(l=a[u-1]["_sm+DM "+i.name]*(r-1)/r+p,h=a[u-1]["_sm-DM "+i.name]*(r-1)/r+d,o=a[u-1]["_smTR "+i.name]*(r-1)/r+n["True Range "+i.name]),n["_sm+DM "+i.name]=l,n["_sm-DM "+i.name]=h,n["_smTR "+i.name]=o,!(u<r)){var m=100*l/o,g=100*h/o,f=100*Math.abs(m-g)/(m+g);if(n["+DI "+i.name]=m,n["-DI "+i.name]=g,!1!==i.inputs.Series&&s)if(u<r+s-1){if(u==i.startFrom)for(var y=r;y<i.startFrom;y++)c+=100*Math.abs(a[y]["+DI "+i.name]-a[y]["-DI "+i.name])/(a[y]["+DI "+i.name]+a[y]["-DI "+i.name]);c+=f}else n["ADX "+i.name]=u==r+s-1?c/s:(a[u-1]["ADX "+i.name]*(s-1)+f)/s;if(i.inputs.Histogram){var v=i.name+"_hist";if(!n["+DI "+i.name]&&0!==n["+DI "+i.name])continue;if(!n["-DI "+i.name]&&0!==n["-DI "+i.name])continue;n[v]=n["+DI "+i.name]-n["-DI "+i.name],!1===i.inputs.Series&&(n["+DI "+i.name]=null,n["-DI "+i.name]=null),i.outputMap[v]=""}}}},e.Studies.calculateRandomWalk=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=Math.max(2,e.startFrom);a<i.length;a++){for(var r=0,s=i[a].High,n=i[a].Low,o=0,l=0,h=1;h<=e.days;h++){if(a<=h){o=l=0;break}var c=(r+=i[a-h].trueRange)/h*Math.sqrt(h);if(c){var u=(s-i[a-h].Low)/c,p=(i[a-h].High-n)/c;o=Math.max(o,u),l=Math.max(l,p)}}i[a]["Random Walk High "+e.name]=o,i[a]["Random Walk Low "+e.name]=l}},e.Studies.calculateRateOfChange=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),e.parameters.isVolume&&(a="Volume");var r=e.name;for(var s in e.outputs)r=s+" "+r;var n=e.inputs["Center Line"];n=n?parseInt(n,10):0;for(var o=Math.max(e.startFrom,e.days);o<i.length;o++){var l=i[o][a];l&&"object"==_typeof(l)&&(l=l[e.subField]);var h=i[o-e.days][a];if(h&&"object"==_typeof(h)&&(h=h[e.subField]),"Momentum"==e.type)i[o][r]=l-h+n;else{var c=h;c&&(i[o][r]=100*(l/c-1)+n)}}}},e.Studies.calculateTypicalPrice=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.overlay||(e.error=!0);else{var r=e.name;for(var s in e.outputs)r=s+" "+r;var n="hlc/3";"Med Price"==e.type?n="hl/2":"Weighted Close"==e.type&&(n="hlcc/4");var o=0;e.startFrom<=a&&(e.startFrom=0);for(var l=e.startFrom;l<i.length;l++)l&&i[l-1][r]&&(o=i[l-1][r]*a),o+=i[l][n],l>=a&&(o-=i[l-a][n],i[l][r]=o/a)}},e.Studies.calculateElderRay=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{e.Studies.MA("exponential",i.days,"Close",0,"_EMA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r][i.name+"_hist1"]=a[r].High-a[r]["_EMA "+i.name],a[r][i.name+"_hist2"]=a[r].Low-a[r]["_EMA "+i.name];i.outputMap={},i.outputMap[i.name+"_hist1"]="",i.outputMap[i.name+"_hist2"]=""}},e.Studies.calculateElderForce=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_EF1 "+i.name]=a[r].Volume*(a[r].Close-a[r-1].Close);e.Studies.MA("exponential",i.days,"_EF1 "+i.name,0,"Result",t,i)}},e.Studies.calculateCenterOfGravity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");for(var r=Math.max(e.startFrom,e.days-1);r<i.length;r++){for(var s=0,n=0,o=0;o<e.days;o++)s-=(o+1)*i[r-o][a],n+=i[r-o][a];n&&(i[r]["Result "+e.name]=s/n)}}},e.Studies.calculateEaseOfMovement=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++){var s=((a[r].High+a[r].Low)/2-(a[r-1].High+a[r-1].Low)/2)/(a[r].Volume/1e8/(a[r].High-a[r].Low));isFinite(s)?a[r]["_EOM1 "+i.name]=s:a[r]["_EOM1 "+i.name]=NaN}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_EOM1 "+i.name,0,"Result",t,i)}},e.Studies.calculateChaikinVolatility=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{var r;for(r=i.startFrom;r<a.length;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_High-Low "+i.name,0,"_MA",t,i);var s=i.inputs["Rate Of Change"];for(s||(s=i.days),r=Math.max(i.startFrom,s);r<a.length;r++)a[r-s]["_MA "+i.name]&&(a[r]["Result "+i.name]=100*(a[r]["_MA "+i.name]/a[r-s]["_MA "+i.name]-1))}},e.Studies.calculateChaikinMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1];s&&(s["_sumMF "+e.name]&&(a=s["_sumMF "+e.name]),s["_sumV "+e.name]&&(r=s["_sumV "+e.name]));for(var n=e.startFrom;n<i.length;n++)i[n].High==i[n].Low?i[n]["_MFV "+e.name]=0:i[n]["_MFV "+e.name]=i[n].Volume*(2*i[n].Close-i[n].High-i[n].Low)/(i[n].High-i[n].Low),a+=i[n]["_MFV "+e.name],r+=i[n].Volume,n>e.days-1&&(a-=i[n-e.days]["_MFV "+e.name],(r-=i[n-e.days].Volume)&&(i[n]["Result "+e.name]=a/r)),i[n]["_sumMF "+e.name]=a,i[n]["_sumV "+e.name]=r}},e.Studies.calculateTwiggsMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1];s&&(s["_sumMF "+e.name]&&(a=s["_sumMF "+e.name]),s["_sumV "+e.name]&&(r=s["_sumV "+e.name]));for(var n=Math.max(1,e.startFrom);n<i.length;n++){var o=Math.max(i[n-1].Close,i[n].High),l=Math.min(i[n-1].Close,i[n].Low);i[n]["_MFV "+e.name]=i[n].Volume*(2*i[n].Close-o-l)/(o-l==0?999999:o-l),n>e.days-1&&(a*=(e.days-1)/e.days,r*=(e.days-1)/e.days),a+=i[n]["_MFV "+e.name],r+=i[n].Volume,n>e.days-1&&r&&(i[n]["Result "+e.name]=a/(r>0?r:999999)),i[n]["_sumMF "+e.name]=a,i[n]["_sumV "+e.name]=r}}},e.Studies.calculateMassIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<Math.max(9,i.days+1))i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA("exponential",9,"_High-Low "+i.name,0,"_EMA",t,i),e.Studies.MA("exponential",9,"_EMA "+i.name,0,"_EMA2",t,i);var s=0;a[i.startFrom-1]&&a[i.startFrom-1]["_total "+i.name]&&(s=a[i.startFrom-1]["_total "+i.name]);for(var n=Math.max(17,i.startFrom);n<a.length;n++)s+=a[n]["_EMA "+i.name]/a[n]["_EMA2 "+i.name],n>=17+i.days-1&&(a[n]["Result "+i.name]=s,s-=a[n-i.days+1]["_EMA "+i.name]/a[n-i.days+1]["_EMA2 "+i.name]),a[n]["_total "+i.name]=s}},e.Studies.calculateMoneyFlowIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1],n="_rawMF "+e.name,o="_cumMF "+e.name,l="Result "+e.name;s&&s[o]&&(a=s[o][0],r=s[o][1]);for(var h=e.startFrom;h<i.length;h++){var c=i[h]["hlc/3"];if(h>0){var u=i[h-1]["hlc/3"],p=c*i[h].Volume;if(c>u?a+=p:c<u?r-=p*=-1:p=0,h>e.days){var d=i[h-e.days][n];d>0?a-=d:r+=d,i[h][l]=0===r?100:100-100/(1+a/r)}i[h][n]=p,i[h][o]=[a,r]}}}},e.Studies.calculateChandeMomentum=function(t,e){var i=e.name;for(var a in e.outputs)i=a+" "+i;var r=e.chart.scrubbed;if(r.length<e.days+1)e.error=!0;else{var s=e.inputs.Field;s&&"field"!=s||(s="Close");for(var n=0,o=0,l=[],h=e.startFrom-e.days+1;h<r.length;h++)if(!(h<1)){var c=r[h][s],u=r[h-1][s];if(c&&"object"==_typeof(c)&&(c=c.Close),u&&"object"==_typeof(u)&&(u=u.Close),void 0!==u){var p=c-u;if(l.push(p),n+=p,o+=Math.abs(p),l.length==e.days){r[h][i]=100*n/o;var d=l.shift();n-=d,o-=Math.abs(d)}}}}},e.Studies.calculateChandeForecast=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("time series",i.days,r,0,"MA",t,i);for(var s=Math.max(1,i.startFrom);s<a.length;s++){var n=a[s][r];n&&"object"==_typeof(n)&&(n=n[i.subField]),a[s]["Result "+i.name]=100*(1-a[s]["MA "+i.name]/n)}}},e.Studies.calculateDetrendedPrice=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=Math.floor(i.days/2+1);e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,-s,"MA",t,i);for(var n=Math.max(i.days-s-1,i.startFrom-s);n<a.length-s;n++){var o=a[n][r];o&&"object"==_typeof(o)&&(o=o[i.subField]),a[n]["Result "+i.name]=o-a[n]["MA "+i.name]}}},e.Studies.calculateAroon=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a,r=0,s=0,n=null,o=null;if(e.startFrom>0){var l=i[e.startFrom-1]["_state "+e.name];l&&(r=l[0],s=l[1],n=l[2],o=l[3])}for(var h=e.startFrom;h<i.length;h++){if(null===n&&(n=i[h].High),null===o&&(o=i[h].Low),(n=Math.max(n,i[h].High))==i[h].High)r=0;else if(++r>e.days)for(n=i[h].High,r=0,a=1;a<=e.days;a++)(n=Math.max(n,i[h-a].High))==i[h-a].High&&(r=a);if((o=Math.min(o,i[h].Low))==i[h].Low)s=0;else if(++s>e.days)for(o=i[h].Low,s=0,a=1;a<=e.days;a++)(o=Math.min(o,i[h-a].Low))==i[h-a].Low&&(s=a);i[h]["Aroon Up "+e.name]=100*(1-r/e.days),i[h]["Aroon Down "+e.name]=100*(1-s/e.days),i[h]["Aroon Oscillator "+e.name]=i[h]["Aroon Up "+e.name]-i[h]["Aroon Down "+e.name],i[h]["_state "+e.name]=[r,s,n,o]}}},e.Studies.calculatePrimeNumber=function(t,e){var i=[];function a(t){if(t<=0)return!1;if(t!=Math.floor(t))return!1;if(!0===i[t]||!1===i[t])return i[t];for(var e=parseInt(Math.sqrt(t),10),a=2;a<=e;a++)if(t%a==0)return i[t]=!1,!1;return i[t]=!0,!0}for(var r=e.chart.scrubbed,s=e.startFrom;s<r.length;s++){var n=r[s];if(n){for(var o=n.High,l=0;o>0&&o<=10;l++)o*=10;for(a(o)&&(o+=2),(o=Math.ceil(o))%2==0&&o++;!a(o);)o+=2;o/=Math.pow(10,l);for(var h=n.Low,c=0;h>0&&h<=10;c++)h*=10;if(a(h)&&(h-=2),(h=Math.floor(h))%2==0&&h--,h>0){for(;!a(h);)h-=2;h/=Math.pow(10,c)}if("Prime Number Bands"==e.type)n["Prime Bands Top "+e.name]=o,n["Prime Bands Bottom "+e.name]=Math.max(0,h);else{var u=0,p=e.inputs["Tolerance Percentage"]*(o-h)/100,d=o+h-2*n.Close;d<p?u=1:d>p&&(u=-1),u&&(n["Result "+e.name]=u)}}}},e.Studies.calculateVerticalHorizontalFilter=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{i.mhml=new e.Studies.StudyDescriptor(i.name,i.type,i.panel),i.mhml.chart=i.chart,i.mhml.days=i.days,i.mhml.startFrom=i.startFrom,i.mhml.inputs={},i.mhml.outputs={_MHML:null},e.Studies.calculateMaxHighMinLow(t,i.mhml);for(var r=0,s=[],n=Math.max(1,i.startFrom-i.days);n<a.length;n++){var o=Math.abs(a[n].Close-a[n-1].Close);s.push(o),r+=o,s.length==i.days&&(a[n]["Result "+i.name]=a[n]["_MHML "+i.name]/r,r-=s.shift())}}},e.Studies.calculatePriceOscillator=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),s=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s)+1)i.error=!0;else{var n=i.inputs.Field,o=i.inputs["Moving Average Type"];o||(o="simple"),n&&"field"!=n||(n="Close"),i.parameters.isVolume&&(n="Volume",o="exponential");var l=i.inputs["Points Or Percent"];l||(l="Percent"),e.Studies.MA(o,r,n,0,"_Short MA",t,i),e.Studies.MA(o,s,n,0,"_Long MA",t,i);for(var h=Math.max(s,i.startFrom);h<a.length;h++){var c=a[h];c&&(c["Result "+i.name]="Points"==l?c["_Short MA "+i.name]-c["_Long MA "+i.name]:100*(c["_Short MA "+i.name]/c["_Long MA "+i.name]-1),i.outputs["Increasing Bar"]&&(c[i.name+"_hist"]=c["Result "+i.name],i.outputMap={},i.outputMap[i.name+"_hist"]=""))}}},e.Studies.calculateKeltner=function(t,i){e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Close",0,"MA",t,i),e.Studies.calculateStudyATR(t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,"MA "+i.name,"ATR "+i.name)},e.Studies.calculateCoppock=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=parseInt(i.inputs["Long RoC"],10);s||(s=14);var n=parseInt(i.inputs["Short RoC"],10);n||(n=11);var o=i.days;if(o||(o=10),!(s<n))if(a.length<Math.max(n,s,o)+1)i.error=!0;else{for(var l=Math.max(i.startFrom,s);l<a.length;l++){var h=a[l-n][r],c=a[l-s][r];h&&c&&(a[l]["_Sum "+i.name]=100*(a[l][r]/h+a[l][r]/c-2))}e.Studies.MA("weighted",o,"_Sum "+i.name,0,"Result",t,i)}},e.Studies.calculateLinearRegressionIndicator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.days*(e.days+1)/2,s=Math.pow(r,2),n=r*(2*e.days+1)/3,o=0,l=0,h=0;if(e.startFrom){var c=i[e.startFrom-1]["_sums "+e.name];c&&(l=c[0],o=c[1],h=c[2])}for(var u=e.startFrom;u<i.length;u++){var p=i[u][a];if(p&&"object"==_typeof(p)&&(p=p[e.subField]),(p||0===p)&&(l+=e.days*p-o,o+=p,h+=Math.pow(p,2),!(u<e.days-1))){if(u>e.days-1){var d=i[u-e.days][a];if(d&&"object"==_typeof(d)&&(d=d[e.subField]),!d&&0!==d)continue;o-=d,h-=Math.pow(d,2)}var m=(e.days*l-r*o)/(e.days*n-s);i[u]["Slope "+e.name]=m;var g=(o-m*r)/e.days;i[u]["Intercept "+e.name]=g,i[u]["Forecast "+e.name]=g+m*e.days;var f=(e.days*n-s)/(e.days*h-Math.pow(o,2));i[u]["RSquared "+e.name]=m*m*f,i[u]["_sums "+e.name]=[l,o,h]}}}},e.Studies.calculateBollinger=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"_MA",t,i),i.std=new e.Studies.StudyDescriptor(i.name,"STD Dev",i.panel),i.std.chart=i.chart,i.std.startFrom=i.startFrom,i.std.days=i.days,i.std.inputs={Field:a,"Standard Deviations":1,Type:i.inputs["Moving Average Type"]},i.std.outputs={"_STD Dev":null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.calculateGenericEnvelope(t,i,i.inputs["Standard Deviations"],"_MA "+i.name,"_STD Dev "+i.name),"Boll %b"==i.type&&(i.zoneOutput="%b")},e.Studies.calculateMAEnvelope=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"MA",t,i);var r=i.inputs["Shift Type"],s=i.inputs.Shift;r||(r="percent",s=i.inputs["Shift Percentage"]),"percent"==r?e.Studies.calculateGenericEnvelope(t,i,s/100,"MA "+i.name):"points"==r&&e.Studies.calculateGenericEnvelope(t,i,null,"MA "+i.name,null,Number(s))},e.Studies.calculateGenericEnvelope=function(t,e,i,a,r,s){i||(i=0),s||(s=0),a&&"field"!=a||(a="Close"),r||(r=a);var n=e.chart.scrubbed,o=e.inputs.Field;o&&"field"!==o||(o="Close");for(var l=e.startFrom;n&&l<n.length;l++){var h=n[l];if(h&&h[a]){var c=h[o];c&&"object"==_typeof(c)&&(c=c.Close);var u=h[a];u&&"object"==_typeof(u)&&(u=u[e.subField]);var p=h[r];p&&"object"==_typeof(p)&&(p=p[e.subField]);var d=i*p+s;h[e.type+" Top "+e.name]=u+d,h[e.type+" Bottom "+e.name]=u-d,h[e.type+" Median "+e.name]=u,h["Bandwidth "+e.name]=u?200*d/u:0,h["%b "+e.name]=50*((c-u)/d+1)}}},e.Studies.calculateMaxHighMinLow=function(t,e){var i=e.chart.scrubbed,a=e.days,r=e.days;if(e.inputs["High Period"]&&(a=e.inputs["High Period"]),e.inputs["Low Period"]&&(r=e.inputs["Low Period"]),i.length<Math.max(a,r)+1)e.error=!0;else{var s,n=Number.MAX_VALUE,o=-1*Number.MAX_VALUE;if(e.startFrom>1){for(s=1;s<a;s++)o=Math.max(o,i[e.startFrom-s].High);for(s=1;s<r;s++)n=Math.min(n,i[e.startFrom-s].Low)}for(var l=Math.max(0,e.startFrom-1);l<i.length;l++){if(o=Math.max(o,i[l].High),n=Math.min(n,i[l].Low),l>=a&&i[l-a].High==o)for(o=i[l].High,s=1;s<a;s++)o=Math.max(o,i[l-s].High);if(l>=r&&i[l-r].Low==n)for(n=i[l].Low,s=1;s<r;s++)n=Math.min(n,i[l-s].Low);var h=0;if("HHV"==e.type)h=o;else if("LLV"==e.type)h=n;else if("Donchian Width"==e.type)h=o-n;else if("GAPO"==e.type||"Gopala"==e.type)h=Math.log(o-n)/Math.log(r);else{if("VT HZ Filter"==e.type){h=o-n,i[l]["_MHML "+e.name]=h;continue}if("Williams %R"==e.type){h=-100*(o-i[l].Close)/(o-n),i[l]["Result "+e.name]=h;continue}}if(l==i.length-1)break;"Donchian Channel"==e.type?(i[l+1]["Donchian High "+e.name]=o,i[l+1]["Donchian Low "+e.name]=n,i[l+1]["Donchian Median "+e.name]=(o+n)/2):i[l+1]["Result "+e.name]=h}}},e.Studies.calculateAccumulationDistribution=function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)if(a){var r=i[a],s=i[a-1],n=0;r.Close>s.Close?n=r.Close-Math.min(r.Low,s.Close):r.Close<s.Close&&(n=r.Close-Math.max(r.High,s.Close)),e.inputs["Use Volume"]&&(n*=r.Volume);var o=s["Result "+e.name];o||(o=0),o+=n,r["Result "+e.name]=o}},e.Studies.calculateCCI=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("simple",i.days,"hlc/3",0,"MA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++){var s=a[r];if(s){for(var n=0,o=0;o<i.days;o++)n+=Math.abs(a[r-o]["hlc/3"]-s["MA "+i.name]);n/=i.days,Math.abs(n)<1e-8?s["Result "+i.name]=0:s["Result "+i.name]=(s["hlc/3"]-s["MA "+i.name])/(.015*n)}}}},e.Studies.calculateFractalChaos=function(t,e){var i=e.chart.scrubbed,a=0,r=0,s=0;e.startFrom&&"Fractal Chaos Bands"==e.type&&(a=i[e.startFrom-1]["Fractal High "+e.name],r=i[e.startFrom-1]["Fractal Low "+e.name]);for(var n=Math.max(4,e.startFrom);n<i.length;n++){var o;for(i[n]["Result "+e.name]=0,s=0,o=0;o<=n&&i[n-o]&&!(i[n-o].High>i[n-2].High)&&!(o<2&&i[n-o].High==i[n-2].High);o++)if(i[n-o].High<i[n-2].High&&s++,4==s){a=i[n-2].High;break}for("Fractal Chaos Bands"==e.type?i[n]["Fractal High "+e.name]=a>0?a:null:4==s&&(i[n]["Result "+e.name]=1),s=0,o=0;o<=n&&i[n-o]&&!(i[n-o].Low<i[n-2].Low)&&!(o<2&&i[n-o].Low==i[n-2].Low);o++)if(i[n-o].Low>i[n-2].Low&&s++,4==s){r=i[n-2].Low;break}"Fractal Chaos Bands"==e.type?i[n]["Fractal Low "+e.name]=r>0?r:null:4==s&&(i[n]["Result "+e.name]=-1)}},e.Studies.displayRAVI=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.startClip(i.panel),t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var p=a[u],d=a[u-1];if(d||(d=t.getPreviousBar(t.chart,i.name+"_hist",u)),p){var m=0,g=0;i.parameters&&i.parameters.studyOverZonesEnabled&&(m=parseFloat(i.parameters.studyOverBoughtValue),g=parseFloat(i.parameters.studyOverSoldValue)),d?p[i.name+"_hist"]>m&&d[i.name+"_hist"]<p[i.name+"_hist"]?s.fillStyle=h:p[i.name+"_hist"]<g&&d[i.name+"_hist"]>p[i.name+"_hist"]?s.fillStyle=c:s.fillStyle="#CCCCCC":s.fillStyle="#CCCCCC",p.candleWidth&&(l=Math.floor(Math.max(1,p.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(p[i.name+"_hist"],r,n)-o))}}t.endClip()},e.Studies.displayElderForce=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=e.Studies.determineColor(i.outputs.Result),s=t.panels[i.panel],n=i.getYAxis(t),o={skipTransform:s.name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:0,color:r,yAxis:n};!i.highlight&&t.highlightedDraggable&&(o.opacity=.3),o.direction=1,e.preparePeakValleyFill(t,o),o.direction=-1,e.preparePeakValleyFill(t,o)},e.Studies.displayElderRay=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;function h(a,h,c,u){s.fillStyle=e.Studies.determineColor(i.outputs[c]),s.fillRect(Math.floor(t.pixelFromBar(a,r.chart)-l/2+l*h),Math.floor(o),Math.floor(l*(1-2*h)),Math.floor(t.pixelFromPrice(p[i.name+u],r,n)-o))}l<2&&(l=1),t.canvasColor("stx_histogram");var c=s.fillStyle;i.underlay||(s.globalAlpha=1),t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var p=a[u];p&&(p.candleWidth&&(l=Math.floor(Math.max(1,p.candleWidth-2))),p[i.name+"_hist1"]>0&&h(u,0,"Elder Bull Power","_hist1"),p[i.name+"_hist2"]<0&&h(u,0,"Elder Bear Power","_hist2"),p[i.name+"_hist1"]<0&&h(u,.1,"Elder Bull Power","_hist1"),p[i.name+"_hist2"]>0&&h(u,.1,"Elder Bear Power","_hist2"))}t.endClip(),s.fillStyle=c},e.Studies.displayADX=function(t,i,a){var r=i.underlay?.3:i.inputs.Series?.4:1;if(i.inputs.Series&&i.inputs.Shading){var s="+DI "+i.name,n="-DI "+i.name,o=e.Studies.determineColor(i.outputs[i.outputMap[s]]),l=e.Studies.determineColor(i.outputs[i.outputMap[n]]),h=i.getYAxis(t),c={topBand:s,bottomBand:n,topColor:o,bottomColor:l,skipTransform:t.panels[i.panel].name!=i.chart.name,topAxis:h,bottomAxis:h,opacity:.3};!i.highlight&&t.highlightedDraggable&&(c.opacity*=.3),e.fillIntersecting(t,i.panel,c)}i.inputs.Histogram&&e.Studies.createHistogram(t,i,a,!1,r),!1!==i.inputs.Series?e.Studies.displaySeriesAsLine(t,i,a):i.inputs.Series||i.inputs.Histogram||t.watermark(i.panel,"center","bottom",t.translateIf(i.name)+": "+t.translateIf("Nothing to display"))},e.Studies.displayMassIndex=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=i.inputs["Bulge Threshold"],s=(t.panels[i.panel],i.getYAxis(t)),n=e.Studies.determineColor(i.outputs.Result),o={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:r,direction:1,color:n,yAxis:s,opacity:.3};!i.highlight&&t.highlightedDraggable&&(o.opacity*=.3),e.preparePeakValleyFill(t,o),e.Studies.drawHorizontal(t,i,null,r,s,n)},e.Studies.displayChannel=function(t,i,a){if(i.inputs["Channel Fill"]){var r={panelName:i.panel};for(var s in i.outputs){var n=s.split(" ").pop();"Top"==n||"High"==n?r.topBand=s+" "+i.name:"Bottom"==n||"Low"==n?r.bottomBand=s+" "+i.name:"Median"!=n&&"Channel"!=n||(r.color=e.Studies.determineColor(i.outputs[s]))}i.parameters&&i.parameters.opacity?r.opacity=i.parameters.opacity:r.opacity=.2;var o=t.panels[i.panel];r.skipTransform=o.name!=i.chart.name,r.yAxis=i.getYAxis(t),!i.highlight&&t.highlightedDraggable&&(r.opacity*=.3),e.prepareChannelFill(t,r)}e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.inputAttributeDefaultGenerator=function(t){return(t||0===t)&&t.constructor==Number?Math.floor(t)==t?t>0?{min:1,step:1}:{step:1}:t>0?{min:0,step:.01}:{step:.01}:{}},e.Studies.getStudyList=function(t){var i={},a={Directional:!0,Gopala:!0,vchart:!0};for(var r in e.extend(a,t),e.Studies.studyLibrary)a[r]||(i[e.Studies.studyLibrary[r].name]=r);return i},e.Studies.determineColor=function(t){return t?"object"===_typeof(t)?t.color:t:null},e.Studies.studyScriptLibrary={},e.Studies.studyLibrary={rsi:{name:"RSI",inputs:{Period:14,Field:"field"},calculateFN:e.Studies.calculateRSI,range:"0 to 100",outputs:{RSI:"auto"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},ma:{name:"Moving Average",overlay:!0,calculateFN:e.Studies.calculateMovingAverage,inputs:{Period:50,Field:"field",Type:"ma",Offset:0},outputs:{MA:"#FF0000"}},macd:{name:"MACD",calculateFN:e.Studies.calculateMACD,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},outputs:{MACD:"auto",Signal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},stochastics:{name:"Stochastics",range:"0 to 100",calculateFN:e.Studies.calculateStochastics,inputs:{Period:14,Field:"field",Smooth:!0},outputs:{Fast:"auto",Slow:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Aroon:{name:"Aroon",range:"0 to 100",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{name:"Aroon Oscillator",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Oscillator":"auto"}},"Lin R2":{name:"Linear Reg R2",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{RSquared:"auto"}},"Lin Fcst":{name:"Linear Reg Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"Lin Incpt":{name:"Linear Reg Intercept",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Intercept:"auto"}},"Time Fcst":{name:"Time Series Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"VT HZ Filter":{name:"Vertical Horizontal Filter",calculateFN:e.Studies.calculateVerticalHorizontalFilter,inputs:{Period:28}},TRIX:{name:"TRIX",calculateFN:e.Studies.calculateTRIX},"STD Dev":{name:"Standard Deviation",calculateFN:e.Studies.calculateStandardDeviation,inputs:{Period:14,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Trade Vol":{name:"Trade Volume Index",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{"Min Tick Value":.5}},Swing:{name:"Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Acc Swing":{name:"Accumulative Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Price ROC":{name:"Price Rate of Change",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14,Field:"field"}},"Vol ROC":{name:"Volume Rate of Change",calculateFN:e.Studies.calculateRateOfChange,parameters:{init:{isVolume:!0}}},Momentum:{name:"Momentum Indicator",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14},centerline:0},"Price Vol":{name:"Price Volume Trend",calculateFN:e.Studies.calculatePriceVolumeTrend,inputs:{Field:"field"}},"Pos Vol":{name:"Positive Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"Neg Vol":{name:"Negative Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"On Bal Vol":{name:"On Balance Volume",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{}},"Stch Mtm":{name:"Stochastic Momentum Index",calculateFN:e.Studies.calculateStochMomentum,inputs:{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},"Hist Vol":{name:"Historical Volatility",calculateFN:e.Studies.calculateHistoricalVolatility,inputs:{Period:10,Field:"field","Days Per Year":[252,365],"Standard Deviations":1},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Pretty Good":{name:"Pretty Good Oscillator",calculateFN:e.Studies.calculatePrettyGoodOscillator,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}}},Ultimate:{name:"Ultimate Oscillator",calculateFN:e.Studies.calculateUltimateOscillator,inputs:{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"Vol Osc":{name:"Volume Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]},parameters:{init:{isVolume:!0}}},Twiggs:{name:"Twiggs Money Flow",calculateFN:e.Studies.calculateTwiggsMoneyFlow,inputs:{Period:21}},"Chaikin MF":{name:"Chaikin Money Flow",calculateFN:e.Studies.calculateChaikinMoneyFlow,inputs:{Period:20}},"Chaikin Vol":{name:"Chaikin Volatility",calculateFN:e.Studies.calculateChaikinVolatility,inputs:{Period:14,"Rate Of Change":2,"Moving Average Type":"ma"}},"Price Osc":{name:"Price Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Short Cycle":12,"Long Cycle":26,"Moving Average Type":"ema","Points Or Percent":["Points","Percent"]}},EOM:{name:"Ease of Movement",calculateFN:e.Studies.calculateEaseOfMovement,inputs:{Period:14,"Moving Average Type":"ma"}},CCI:{name:"Commodity Channel Index",calculateFN:e.Studies.calculateCCI,inputs:{Period:20},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}},attributes:{Period:{min:2}}},Detrended:{name:"Detrended Price Oscillator",calculateFN:e.Studies.calculateDetrendedPrice,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}},"True Range":{name:"True Range",calculateFN:e.Studies.calculateStudyATR,inputs:{},outputs:{"True Range":"auto"}},ATR:{name:"Average True Range",calculateFN:e.Studies.calculateStudyATR,outputs:{ATR:"auto"}},"Ehler Fisher":{name:"Ehler Fisher Transform",calculateFN:e.Studies.calculateEhlerFisher,inputs:{Period:10},outputs:{EF:"auto","EF Trigger":"#FF0000"}},Schaff:{name:"Schaff Trend Cycle",range:"0 to 100",calculateFN:e.Studies.calculateSchaff,inputs:{Period:10,Field:"field","Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}},QStick:{name:"QStick",calculateFN:e.Studies.calculateQStick,inputs:{Period:8,"Moving Average Type":"ma"}},Coppock:{name:"Coppock Curve",calculateFN:e.Studies.calculateCoppock,inputs:{Period:10,Field:"field","Short RoC":11,"Long RoC":14}},"Chande Mtm":{name:"Chande Momentum Oscillator",calculateFN:e.Studies.calculateChandeMomentum,inputs:{Period:9},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}},"Chande Fcst":{name:"Chande Forecast Oscillator",calculateFN:e.Studies.calculateChandeForecast,inputs:{Period:14,Field:"field"}},"Intraday Mtm":{name:"Intraday Momentum Index",calculateFN:e.Studies.calculateIntradayMomentum,inputs:{Period:20},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},RAVI:{name:"RAVI",seriesFN:e.Studies.displayRAVI,calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Moving Average Type":"vdma","Short Cycle":7,"Long Cycle":65},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.1"},studyOverSoldValue:{max:0,step:"0.1"}}},"Random Walk":{name:"Random Walk Index",calculateFN:e.Studies.calculateRandomWalk,outputs:{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}},ADX:{name:"ADX/DMS",calculateFN:e.Studies.calculateADX,seriesFN:e.Studies.displayADX,inputs:{Period:14,"Smoothing Period":14,Series:!0,Shading:!1,Histogram:!1},outputs:{"+DI":"#00FF00","-DI":"#FF0000",ADX:"auto","Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"High Low":{name:"High Low Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:function(t,i){i.inputs["Moving Average Type"]="triangular",e.Studies.calculateMAEnvelope(t,i)},inputs:{Period:10,Field:"field","Shift Percentage":5,"Channel Fill":!0},outputs:{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"},attributes:{"Shift Percentage":{min:.1,step:.1}}},"High-Low":{name:"High Minus Low",calculateFN:function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)i[a]["Result "+e.name]=i[a].High-i[a].Low},inputs:{}},"Med Price":{name:"Median Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"MA Env":{name:"Moving Average Envelope",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateMAEnvelope,inputs:{Period:50,Field:"field","Shift Type":["percent","points"],Shift:5,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},"Fractal Chaos Bands":{name:"Fractal Chaos Bands",overlay:!0,calculateFN:e.Studies.calculateFractalChaos,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}},"Fractal Chaos":{name:"Fractal Chaos Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculateFractalChaos,inputs:{},centerline:null},GAPO:{name:"Gopalakrishnan Range Index",calculateFN:e.Studies.calculateMaxHighMinLow},"Prime Number Bands":{name:"Prime Number Bands",overlay:!0,calculateFN:e.Studies.calculatePrimeNumber,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}},"Prime Number":{name:"Prime Number Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculatePrimeNumber,centerline:0,inputs:{"Tolerance Percentage":5},attributes:{"Tolerance Percentage":{min:.1,step:.1}}},"Bollinger Bands":{name:"Bollinger Bands",overlay:!0,calculateFN:e.Studies.calculateBollinger,seriesFN:e.Studies.displayChannel,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Channel":{name:"Donchian Channel",overlay:!0,calculateFN:e.Studies.calculateMaxHighMinLow,seriesFN:e.Studies.displayChannel,inputs:{"High Period":20,"Low Period":20,"Channel Fill":!0},outputs:{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},HHV:{name:"Highest High Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},LLV:{name:"Lowest Low Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},"Mass Idx":{name:"Mass Index",seriesFN:e.Studies.displayMassIndex,calculateFN:e.Studies.calculateMassIndex,inputs:{Period:25,"Bulge Threshold":27},attributes:{"Bulge Threshold":{min:20,max:35,step:.1}}},Keltner:{name:"Keltner Channel",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateKeltner,inputs:{Period:50,Shift:5,"Moving Average Type":"ema","Channel Fill":!0},outputs:{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},PSAR:{name:"Parabolic SAR",overlay:!0,calculateFN:e.Studies.calculatePSAR,seriesFN:e.Studies.displayPSAR2,inputs:{"Minimum AF":.02,"Maximum AF":.2}},Klinger:{name:"Klinger Volume Oscillator",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateKlinger,inputs:{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},outputs:{Klinger:"auto",KlingerSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Ray":{name:"Elder Ray Index",seriesFN:e.Studies.displayElderRay,calculateFN:e.Studies.calculateElderRay,centerline:0,inputs:{Period:13},outputs:{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Force":{name:"Elder Force Index",calculateFN:e.Studies.calculateElderForce,seriesFN:e.Studies.displayElderForce,inputs:{Period:13}},"LR Slope":{name:"Linear Reg Slope",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Slope:"auto"}},COG:{name:"Center Of Gravity",calculateFN:e.Studies.calculateCenterOfGravity,inputs:{Period:10,Field:"field"}},"Typical Price":{name:"Typical Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"Weighted Close":{name:"Weighted Close",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"M Flow":{name:"Money Flow Index",range:"0 to 100",calculateFN:e.Studies.calculateMoneyFlowIndex,inputs:{Period:14},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"Williams %R":{name:"Williams %R",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"W Acc Dist":{name:"Accumulation/Distribution",calculateFN:e.Studies.calculateAccumulationDistribution,inputs:{"Use Volume":!1}},volume:{name:"Volume Chart",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,zoom:0},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"}},"vol undr":{name:"Volume Underlay",underlay:!0,range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,position:"none",zoom:0,heightFactor:.25},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},customRemoval:!0,removeFN:function(t,e){t.layout.volumeUnderlay=!1,t.changeOccurred("layout")},attributes:{panelName:{hidden:!0}}}},t},__js_standard_symbolLookupBase_=function(t){var e=t.CIQ;return e.ChartEngine.Driver.Lookup=function(){},e.ChartEngine.Driver.Lookup.prototype.acceptText=function(t,e,i,a){this.cb},t},__js_advanced_drawingAdvanced_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing.channel=function(){this.name="channel",this.dragToDraw=!1,this.p2=null},e.Drawing.channel.ciqInheritsFrom(e.Drawing.segment),e.Drawing.channel.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.channel.prototype.move=function(t,e,i){if(this.penDown){if(this.copyConfig(),null===this.p2)this.p1=[e,i];else{var a=i-(this.p1[1]-this.p0[1])/(this.p1[0]-this.p0[0])*(e-this.p1[0]);this.p2=[this.p1[0],a]}this.render(t)}},e.Drawing.channel.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],a.chart),this.penDown=!1,!0):(this.setPoint(1,e,i,a.chart),this.p0[0]==this.p1[0]?(this.p1=null,!1):(this.p2=[this.p1[0],this.p1[1]],!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.channel.prototype.boxIntersection=function(t,e,i){var a=this.p0,r=this.p1,s=this.p2;return!!(a&&r&&s)&&(!(i.x0>Math.max(a[0],r[0])||i.x1<Math.min(a[0],r[0]))&&((r[0]-a[0])*((s[1]<a[1]?i.y1:i.y0)-a[1])-(r[1]-a[1])*(t-a[0]))*((s[0]-a[0])*((s[1]>a[1]?i.y1:i.y0)-(a[1]+s[1]-r[1]))-(r[1]-a[1])*(t-a[0]))<0)},e.Drawing.channel.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1||!this.p2)return null;var r={0:this.p0,1:this.p1,2:this.p2};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(t,i,a)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null},e.Drawing.channel.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=null;this.p2&&(o=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));var l=this.lineWidth,h=this.getLineColor(),c=this.fillColor;this.p2&&c&&!e.isTransparent(c)&&"auto"!=c&&(t.beginPath(),t.moveTo(a,s),t.lineTo(r,n),t.lineTo(r,o),t.lineTo(a,s+(o-n)),t.closePath(),t.globalAlpha=.2,t.fillStyle=c,t.fill(),t.globalAlpha=1);var u={pattern:this.pattern,lineWidth:l};if((this.penDown||this.highlighted)&&"none"==this.pattern&&(u.pattern="dotted"),this.stx.plotLine(a,r,s,n,h,"segment",t,i,u),this.p2&&this.stx.plotLine(a,r,s+(o-n),o,h,"segment",t,i,u),this.highlighted){var p="p0"==this.highlighted,d="p1"==this.highlighted,m="p2"==this.highlighted;this.littleCircle(t,a,s,p),this.littleCircle(t,r,n,d),this.littleCircle(t,r,o,m)}}},e.Drawing.channel.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.setPoint(2,e.p2[0]-s,e.p2[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.channel.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d1,this.v2,t.chart))},e.Drawing.channel.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.channel.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.pitchfork=function(){this.name="pitchfork",this.dragToDraw=!1,this.p2=null},e.Drawing.pitchfork.ciqInheritsFrom(e.Drawing.channel),e.Drawing.pitchfork.prototype.configs=["color","lineWidth","pattern"],e.Drawing.pitchfork.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.pitchfork.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1||!this.p2)return null;var r={0:this.p0,1:this.p1,2:this.p2};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};for(var n=this.rays,o=0;o<n.length;o++)if(this.lineIntersection(t,i,a,o?"ray":"segment",n[o][0],n[o][1],!0))return this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i};return null},e.Drawing.pitchfork.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx,a=this.p2;a||(a=this.p1);var r=i.pixelFromTick(this.p0[0],e.chart),s=i.pixelFromTick(this.p1[0],e.chart),n=i.pixelFromTick(a[0],e.chart),o=i.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),l=i.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),h=i.pixelFromValueAdjusted(e,a[0],a[1]),c=this.lineWidth,u=this.getLineColor(),p={pattern:this.pattern,lineWidth:c},d=50,m=2*o-l-h,g=2*r-s-n;g<0&&(d*=-1),m*=d/g,this.rays=[[[s,l],[n,h]],[[r,o],[(s+n)/2,(l+h)/2]]],s==n&&l==h||this.rays.push([[s,l],[s-d,l-m]],[[n,h],[n-d,h-m]]);for(var f=0;f<this.rays.length;f++){var y=this.rays[f],v=f?"ray":"segment";i.plotLine(y[0][0],y[1][0],y[0][1],y[1][1],u,v,t,e,p)}if(this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted,S="p2"==this.highlighted;this.littleCircle(t,r,o,x),this.littleCircle(t,s,l,b),this.littleCircle(t,n,h,S)}}},e.Drawing.pitchfork.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.pitchfork.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.pitchfork.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.gartley=function(){this.name="gartley",this.dragToDraw=!1,this.maxSegments=4,this.shape=null,this.points=[]},e.Drawing.gartley.ciqInheritsFrom(e.Drawing.continuous),e.Drawing.gartley.prototype.check=function(t,e){if(!e)return!0;if(t[0]>=e[0]||t[1]==e[1])return!1;if(1==this.segment)t[1]<e[1]?this.shape="M":this.shape="W";else if(2==this.segment){if("M"==this.shape&&t[1]<e[1])return!1;if("W"==this.shape&&t[1]>e[1])return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])>=.786)return!1}else if(3==this.segment){if("M"==this.shape&&t[1]>e[1])return!1;if("W"==this.shape&&t[1]<e[1])return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])>=.786)return!1}else if(4==this.segment){if("M"==this.shape&&(t[1]<e[1]||e[1]<this.points[0][1]))return!1;if("W"==this.shape&&(t[1]>e[1]||e[1]>this.points[0][1]))return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])<1.27)return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])>=1.618)return!1}return!0},e.Drawing.gartley.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,a.chart),this.pts=[],this.penDown=!0,this.segment=1,!1;if(this.accidentalClick(e,i))return this.penDown=!0,!1;if(this.check(this.p0,this.p1)){if(1==this.segment&&this.points.push(this.p0),this.points.push(this.p1),this.drawDropZones=!0,this.setPoint(1,e,i,a.chart),this.segment++,this.segment>this.maxSegments)return this.setPoint(0,this.points[0][0],this.points[0][1],a.chart),this.penDown=!1,!0;this.pts.push(this.d1,this.tzo1,this.v1),this.setPoint(0,e,i,a.chart)}return!1}},e.Drawing.gartley.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(2==this.segment)this.drawDropZone(t,.618*this.points[0][1]+.382*this.p0[1],.786*this.points[0][1]+.214*this.p0[1],this.p0[0]);else if(3==this.segment)this.drawDropZone(t,.618*this.points[1][1]+.382*this.p0[1],.786*this.points[1][1]+.214*this.p0[1],this.p0[0]);else if(4==this.segment){var o=1.618*this.points[2][1]-.618*this.points[1][1];o="M"==this.shape?Math.max(o,this.points[0][1]):Math.min(o,this.points[0][1]),this.drawDropZone(t,o,1.27*this.points[2][1]-.27*this.points[1][1],this.p0[0])}var l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l};(this.penDown||this.highlighted)&&"none"==this.pattern&&(c.pattern="dotted"),this.segment<=this.maxSegments&&this.stx.plotLine(a,r,s,n,h,this.name,t,i,c);var u=this.fillColor,p=[];if(this.points.length){t.beginPath();for(var d=1;d<this.points.length&&d<=4;d++){var m=this.stx.pixelFromTick(this.points[d-1][0],i.chart),g=this.stx.pixelFromTick(this.points[d][0],i.chart),f=this.stx.pixelFromValueAdjusted(i,this.points[d-1][0],this.points[d-1][1]),y=this.stx.pixelFromValueAdjusted(i,this.points[d][0],this.points[d][1]);1==d&&p.push(m,f),p.push(g,y),this.stx.plotLine(m,g,f,y,h,this.name,t,i,c)}if(2!=this.points.length&&4!=this.points.length||p.push(r,n),this.points[2]&&p.push(this.stx.pixelFromTick(this.points[2][0],i.chart),this.stx.pixelFromValueAdjusted(i,this.points[2][0],this.points[2][1])),u&&"auto"!=u&&!e.isTransparent(u)){for(var v=0;v<p.length;v+=2)0===v&&t.moveTo(p[0],p[1]),t.lineTo(p[v],p[v+1]);t.fillStyle=u,t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}}}},e.Drawing.gartley.prototype.lineIntersection=function(t,i,a,r){var s=this.points,n=this.stx.panels[this.panelName];if(s.length!=this.maxSegments+1||!n)return!1;for(var o=0;o<s.length-1;o++)if(e.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,i,a,"segment",s[o],s[o+1]))return!0;return!1},e.Drawing.gartley.prototype.boxIntersection=function(t,e,i){if(!this.p0||!this.p1)return!1;if(i.x0>Math.max(this.p0[0],this.p1[0])||i.x1<Math.min(this.p0[0],this.p1[0]))return!1;for(var a=Math.min(this.p0[1],this.p1[1]),r=Math.max(this.p0[1],this.p1[1]),s=0;s<this.points.length;s++)a=Math.min(a,this.points[s][1]),r=Math.max(r,this.points[s][1]);return!(i.y1>r||i.y0<a)},e.Drawing.gartley.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i;e.tick=i;var n=e.value-a;if(e.value=a,"move"==e.action){this.pts=[];for(var o=0;o<this.points.length;o++)this.points[o][0]-=s,this.points[o][1]-=n,this.setPoint(1,this.points[o][0],this.points[o][1],r.chart),o&&o<this.points.length-1&&this.pts.push(this.d1,this.tzo1,this.v1),this.points[o]=this.p1;this.setPoint(0,this.points[0][0],this.points[0][1],r.chart),this.render(t)}}},e.Drawing.gartley.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.gartley.prototype.drawDropZone=function(t,e,i,a){var r=this.stx.panels[this.panelName];if(r){var s=this.stx.pixelFromPrice(e,r),n=this.stx.pixelFromPrice(i,r)-s,o=this.stx.pixelFromTick(a,r.chart),l=r.width-o;t.fillStyle="#008000",t.globalAlpha=.2,t.fillRect(o,s,l,n),t.globalAlpha=1}},e.Drawing.gartley.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.reconstructPoints(),this.setPoint(0,this.d0,this.v0,t.chart),this.points.unshift(this.p0),this.setPoint(1,this.d1,this.v1,t.chart),this.points.push(this.p1))},e.Drawing.gartley.prototype.reconstructPoints=function(){var t=this.stx.panels[this.panelName];if(t){this.points=[];for(var i=0;i<this.pts.length;i+=3){var a=e.strToDateTime(this.pts[i]);a.setMinutes(a.getMinutes()+Number(this.pts[i+1])-a.getTimezoneOffset()),this.points.push([this.stx.tickFromDate(e.yyyymmddhhmmssmmm(a),t.chart),this.pts[i+2]])}}},e.Drawing.gartley.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.pts=e.pts.split(","),this.adjust()},e.Drawing.gartley.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,pts:this.pts.join(",")}},e.Drawing.freeform=function(){this.name="freeform",this.splineTension=.3,this.dragToDraw=!0},e.Drawing.freeform.ciqInheritsFrom(e.Drawing.segment),e.Drawing.freeform.prototype.measure=function(){},e.Drawing.freeform.prototype.intersected=function(t,i,a){return a.x0>this.hiX||a.x1<this.lowX?null:a.y1>this.hiY||a.y0<this.lowY?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.freeform.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action&&(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.adjust(),this.render(t))}},e.Drawing.freeform.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(!1===this.penDown){this.copyConfig(),this.startX=Math.round(this.stx.resolveX(this.stx.pixelFromTick(i,r.chart))),this.startY=Math.round(this.stx.resolveY(this.stx.pixelFromValueAdjusted(r,i,a)));var s=this.stx.dateFromTick(i,r.chart,!0);return this.d0=e.yyyymmddhhmmssmmm(s),this.tzo0=s.getTimezoneOffset(),this.v0=a,this.p0=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.nodes=[this.p0[0],this.p0[1]],this.pNodes=[this.p0],this.candleWidth=this.stx.layout.candleWidth,this.multiplier=r.yAxis.multiplier,this.interval=this.stx.layout.interval,this.periodicity=this.stx.layout.periodicity,this.tempSplineTension=this.splineTension,this.splineTension=-1,document.body.style.cursor="pointer",this.penDown=!0,!1}return this.penDown=!1,this.splineTension=this.tempSplineTension,document.body.style.cursor="auto",!0}},e.Drawing.freeform.prototype.move=function(t,i,a){if(this.penDown){var r=this.stx.panels[this.panelName],s=this.stx.dateFromTick(i,r.chart,!0);return this.d1=e.yyyymmddhhmmssmmm(s),this.tzo1=s.getTimezoneOffset(),this.v1=a,this.p1=[e.ChartEngine.crosshairX-this.startX,r.yAxis.flipped?this.startY-e.ChartEngine.crosshairY:e.ChartEngine.crosshairY-this.startY],this.pNodes.length>2&&(this.p1[0]==this.pNodes[this.pNodes.length-2][0]&&this.p1[0]==this.pNodes[this.pNodes.length-1][0]?(this.pNodes.length--,this.nodes.length-=2):this.p1[1]==this.pNodes[this.pNodes.length-2][1]&&this.p1[1]==this.pNodes[this.pNodes.length-1][1]&&(this.pNodes.length--,this.nodes.length-=2)),this.nodes.push(this.p1[0],this.p1[1]),this.pNodes.push(this.p1),this.render(t),!1}},e.Drawing.freeform.prototype.intervalRatio=function(t,i,a,r,s,n){function o(t,i){return e.Market.Symbology.isForexSymbol(i)?1440:390}var l=0;return t==i?l=1:isNaN(t)||isNaN(i)?isNaN(t)?"month"==t?"week"==i?l=5:"day"==i?l=30:isNaN(i)||(l=30*o(0,n)/i):"week"==t?("month"==i&&(l=.2),"day"==i?l=5:isNaN(i)||(l=5*o(0,n)/i)):"day"==t&&("week"==i?l=.2:"month"==i?l=1/30:isNaN(i)||(l=o(0,n)/i)):isNaN(t)||("month"==i?l=t/(30*o(0,n)):"week"==i?l=t/(5*o(0,n)):"day"==i&&(l=t/o(0,n))):l=t/i,l*=a/r},e.Drawing.freeform.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,e.chart.symbol);if(0!==i){var a=this.stx.layout.candleWidth/this.candleWidth,r=e.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,e.chart);for(var s=this.stx.pixelFromTick(this.p0[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=[],l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l},u=0;u<this.pNodes.length;u++){var p=i*a*this.pNodes[u][0]+s,d=r*this.pNodes[u][1];e.yAxis.flipped?d=n-d:d+=n,o.push(p,d)}o.length&&(this.splineTension<0?this.stx.connectTheDots(o,h,this.name,t,e,c):this.stx.plotSpline(o,this.splineTension,h,this.name,t,!0,c))}}},e.Drawing.freeform.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var e=[this.nodes[0],this.nodes[1]];this.pNodes=[e],this.lowX=this.nodes[0],this.hiX=this.nodes[0],this.lowY=this.nodes[1],this.hiY=this.nodes[1];for(var i=2;i<this.nodes.length;i+=2){var a=[this.nodes[i],this.nodes[i+1]];this.pNodes.push(a),this.lowX=Math.min(this.lowX,a[0]),this.hiX=Math.max(this.hiX,a[0]),this.lowY=Math.max(this.lowY,a[1]),this.hiY=Math.min(this.hiY,a[1])}var r=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,t.chart.symbol);if(0!==r){var s=this.stx.layout.candleWidth/this.candleWidth,n=t.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,t.chart);var o=this.stx.pixelFromTick(this.p0[0],t.chart),l=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]);this.lowX=this.stx.tickFromPixel(Math.floor(r*s*this.lowX)+o,t.chart),this.hiX=this.stx.tickFromPixel(Math.ceil(r*s*this.hiX)+o,t.chart),t.yAxis.flipped?(this.lowY=this.stx.valueFromPixel(l-Math.floor(n*this.lowY),t),this.hiY=this.stx.valueFromPixel(l-Math.ceil(n*this.hiY),t)):(this.lowY=this.stx.valueFromPixel(Math.floor(n*this.lowY)+l,t),this.hiY=this.stx.valueFromPixel(Math.ceil(n*this.hiY)+l,t))}}},e.Drawing.freeform.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,cw:Number(this.candleWidth.toFixed(4)),mlt:Number(this.multiplier.toFixed(4)),d0:this.d0,tzo0:this.tzo0,v0:this.v0,inter:this.interval,pd:this.periodicity,nodes:this.nodes}},e.Drawing.freeform.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.candleWidth=e.cw,this.multiplier=e.mlt,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.interval=e.inter,this.periodicity=e.pd,this.nodes=e.nodes,this.adjust()},e.Drawing.callout=function(){this.name="callout",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={},this.stemEntry="",this.defaultWidth=50,this.defaultHeight=10},e.Drawing.callout.ciqInheritsFrom(e.Drawing.annotation),e.Drawing.callout.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.callout.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t),this.borderColor=this.color},e.Drawing.callout.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p0=[e,i],this.render(t))},e.Drawing.callout.prototype.onChange=function(t){if(this.stx.panels[this.panelName]){var i=t.target;this.w=i.clientWidth,this.h=i.clientHeight;var a=this.context||this.stx.chart.tempCanvas.context;e.clearCanvas(a.canvas,this.stx),this.render(a),this.edit(a)}},e.Drawing.callout.prototype.render=function(t){this.context=t;var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(!isNaN(r)){t.font=this.fontString,t.textBaseline="top";var s=a,n=r,o=this.w/2,l=this.h/2;this.penDown&&(o=this.defaultWidth,(l=this.defaultHeight)||(l=this.fontSize));var h=this.lineWidth;h||(h=1.1);var c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor);var u,p,d,m,g=this.borderColor;("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor),this.highlighted&&(g=this.stx.getCanvasColor("stx_highlight_vector"));var f=Math.min(Math.min(o,l)/2,8);if(this.stem){this.stem.t?(u=this.stx.pixelFromTick(this.stem.t),d=this.stx.pixelFromValueAdjusted(i,this.stem.t,this.stem.v)):this.stem.x&&(u=s,d=n,s+=this.stem.x,n+=this.stem.y);var y="";u>=s+o?(p=s+o,y="r"):u>s-o&&u<s+o?(p=s,y="c"):u<=s-o&&(p=s-o,y="l"),d>=n+l?(m=n+l,y+="b"):d>n-l&&d<n+l?(m=n,y+="m"):d<=n-l&&(m=n-l,y+="t"),this.stemEntry=y,"cm"!=y&&(u=Math.round(u),p=Math.round(p),d=Math.round(d),m=Math.round(m))}if(this.highlighted?this.stx.canvasColor("stx_annotation_highlight_bg",t):this.fillColor?(t.fillStyle=this.fillColor,t.globalAlpha=.4):this.stem&&(t.fillStyle=this.stx.containerColor),t.strokeStyle=g,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(h,this.pattern)),t.lineDashOffset=0),g&&(t.beginPath(),t.lineWidth=h,t.moveTo(s+o-f,n-l),"rt"!=this.stemEntry?t.quadraticCurveTo(s+o,n-l,s+o,n-l+f):(t.lineTo(u,d),t.lineTo(s+o,n-l+f)),t.lineTo(s+o,n-f/2),"rm"==this.stemEntry&&t.lineTo(u,d),t.lineTo(s+o,n+f/2),t.lineTo(s+o,n+l-f),"rb"!=this.stemEntry?t.quadraticCurveTo(s+o,n+l,s+o-f,n+l):(t.lineTo(u,d),t.lineTo(s+o-f,n+l)),t.lineTo(s+f/2,n+l),"cb"==this.stemEntry&&t.lineTo(u,d),t.lineTo(s-f/2,n+l),t.lineTo(s-o+f,n+l),"lb"!=this.stemEntry?t.quadraticCurveTo(s-o,n+l,s-o,n+l-f):(t.lineTo(u,d),t.lineTo(s-o,n+l-f)),t.lineTo(s-o,n+f/2),"lm"==this.stemEntry&&t.lineTo(u,d),t.lineTo(s-o,n-f/2),t.lineTo(s-o,n-l+f),"lt"!=this.stemEntry?t.quadraticCurveTo(s-o,n-l,s-o+f,n-l):(t.lineTo(u,d),t.lineTo(s-o+f,n-l)),t.lineTo(s-f/2,n-l),"ct"==this.stemEntry&&t.lineTo(u,d),t.lineTo(s+f/2,n-l),t.lineTo(s+o-f,n-l),t.fill(),t.globalAlpha=1,"none"!=this.pattern&&t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=c,n+=this.padding,!this.ta)for(var v=0;v<this.arr.length;v++)t.fillText(this.arr[v],s-o+this.padding,n-l),n+=this.fontSize;if(t.textBaseline="alphabetic",this.highlighted&&!this.noHandles){var x="p0"==this.highlighted;this.littleCircle(t,u,d,x)}}}},e.Drawing.callout.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.penDown?(this.adjust(),this.edit(t),this.penDown=!1,!1):(this.stem={d:this.d0,v:this.v0},this.penDown=!0,this.adjust(),!1)}},e.Drawing.callout.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;e.stem?("drag"==e.action?this.stem={d:this.stx.dateFromTick(i,r.chart,!0),v:a}:"move"==e.action&&(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.stem={d:this.stx.dateFromTick(this.stx.tickFromDate(e.stem.d,r.chart)-s),v:e.stem.v-n}),this.adjust()):this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}},e.Drawing.callout.prototype.lineIntersection=function(t,i,a,r){var s=this.stx.panels[this.panelName],n=this.stem,o=this.p0,l=this.stx;if(!o||!n||!s)return!1;var h=n.t||this.stx.tickFromDate(n.d,s.chart),c={x0:o[0],x1:h,y0:o[1],y1:n.v},u=e.convertBoxToPixels(l,this.panelName,c),p=u.x0,d=u.y0,m=u.x1,g=u.y1;"string"==typeof this.stemEntry&&(this.stemEntry.indexOf("l")>-1?p-=this.w/2:this.stemEntry.indexOf("r")>-1&&(p+=this.w/2),this.stemEntry.indexOf("t")>-1?d-=this.h/2:this.stemEntry.indexOf("b")>-1&&(d+=this.h/2));var f=e.convertBoxToPixels(l,this.panelName,a);return e.boxIntersects(f.x0,f.y0,f.x1,f.y1,p,d,m,g,r)},e.Drawing.callout.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;if(this.pointIntersection(this.stem.t,this.stem.v,a))return this.highlighted="p0",{action:"drag",stem:!0};var s=this.stx.pixelFromTick(this.p0[0],r.chart)-this.w/2,n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1])-this.h/2,o=s+this.w,l=n+this.h;this.stem&&this.stem.x&&(s+=this.stem.x,o+=this.stem.x,n+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h+a.r>=s&&h-a.r<=o&&c+a.r>=n&&c-a.r<=l?(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i}):this.lineIntersection(t,i,a,"segment")?(this.highlighted=!0,{action:"move",stem:e.clone(this.stem),p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.fibprojection=function(){this.name="fibprojection",this.dragToDraw=!1,this.p2=null},e.Drawing.fibprojection.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibprojection.prototype.recommendedLevels=[0,.618,1,1.272,1.618,2.618,4.236],e.Drawing.fibprojection.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.parameters=e.clone(this.parameters),!0):(this.setPoint(1,i,a,r.chart),this.p2=[this.p1[0],this.p1[1]],!1):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibprojection.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.p1[1]-this.p0[1],s=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),o=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),l=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),h=null,c=null;this.p2&&(h=this.stx.pixelFromTick(this.p2[0],i.chart),c=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var u=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var p=t.measureText("161.8%").width+10,d=this.color;if(("auto"==d||e.isTransparent(d))&&(d=this.stx.defaultColor),this.p2){this.rays=[];for(var m=0;m<this.parameters.fibs.length;m++){t.textAlign="left",t.fillStyle=d;var g=this.parameters.fibs[m];if(g.display){var f=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]+r*g.level),y=e.xIntersection({x0:s,x1:n,y0:o,y1:l},f),v=this.parameters.extendLeft?0:s,x=i.left+i.width;if(this.parameters.printLevels){var b=Math.round(1e3*g.level)/10+"%";x-=p,this.parameters.printValues&&(t.fillStyle=d,this.stx.canvasFont("stx_yaxis",t)),x<v&&(t.textAlign="right"),t.fillText(b,x,f),x<v?x+=5:x-=5}if(this.parameters.printValues&&y<i.width){var S=this.stx.transformedPriceFromPixel(f,i);S=a.priceFormatter?a.priceFormatter(this.stx,i,S):this.stx.formatYAxisPrice(S,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,S,f,d,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var C=g.color;("auto"==C||e.isTransparent(C))&&(C=this.color),("auto"==C||e.isTransparent(C))&&(C=this.stx.defaultColor);var w=g.color;("auto"==w||e.isTransparent(w))&&(w=this.fillColor),("auto"==w||e.isTransparent(w))&&(w=this.stx.defaultColor),t.fillStyle=w;var T=e.clone(g.parameters);this.highlighted&&(T.opacity=1),this.stx.plotLine(v,x,f,f,this.highlighted?u:C,"segment",t,i,T),this.rays.push([[v,f],[x,f]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(x,f),t.lineTo(v,f),v?t.lineTo(s,c):t.lineTo(v,c),t.lineTo(x,c),void 0!==w&&t.fill(),t.globalAlpha=1}}}var k=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(k.opacity=1),this.stx.plotLine(s,n,o,l,u,"segment",t,i,k),this.p2&&this.stx.plotLine(n,h,l,c,u,"segment",t,i,k),this.highlighted){var D="p0"==this.highlighted,M="p1"==this.highlighted,A="p2"==this.highlighted;this.littleCircle(t,s,o,D),this.littleCircle(t,n,l,M),this.littleCircle(t,h,c,A)}}}},e.Drawing.fibprojection.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.fibprojection.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.setPoint(2,e.p2[0]-s,e.p2[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.fibprojection.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1,n=this.p2;if(!r||!s||!n)return null;var o={0:r,1:s,2:n};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};var h=this.rays,c=this.lineIntersection(t,i,a,"segment",r,s)||this.lineIntersection(t,i,a,"segment",s,n);if(!c)for(var u=0;u<h.length;u++)if(this.lineIntersection(t,i,a,"ray",h[u][0],h[u][1],!0)){c=!0;break}return c?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),p2:e.clone(n),tick:t,value:i}):null},e.Drawing.fibprojection.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.fibarc=function(){this.name="fibarc"},e.Drawing.fibarc.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibarc.prototype.recommendedLevels=[.382,.5,.618,1],e.Drawing.fibarc.prototype.setOuter=function(){var t=this.stx.panels[this.panelName];if(t){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};var i=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]),a=this.stx.pixelFromValueAdjusted(t,this.p1[0],this.p1[1]),r=this.stx.pixelFromTick(this.p0[0],t.chart),s=this.stx.pixelFromTick(this.p1[0],t.chart),n=2*i-a,o=e.xIntersection({x0:r,x1:s,y0:i,y1:a},n);this.outer.p0[1]=this.stx.valueFromPixel(n,t),this.outer.p0[0]=this.stx.tickFromPixel(o,t.chart)}},e.Drawing.fibarc.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){var s=this.p0,n=this.p1,o=this.outer;if(!s||!n)return null;var l={0:s,1:n};for(var h in l)if(this.pointIntersection(l[h][0],l[h][1],a))return this.highlighted="p"+h,{action:"drag",point:"p"+h};if(this.lineIntersection(t,i,a,"segment",o.p0,o.p1))return this.highlighted=!0,{action:"move",p0:e.clone(s),p1:e.clone(n),tick:t,value:i};var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]},u=e.convertBoxToPixels(this.stx,this.panelName,c),p=Math.abs(Math.sqrt(2)*(u.x1-u.x0)),d=Math.abs(Math.sqrt(2)*(u.y1-u.y0)),m=this.stx.pixelFromTick(t,r.chart),g=this.stx.pixelFromValueAdjusted(r,t,i);return m+a.r<u.x1-p||m-a.r>u.x1+p?null:g+a.r<u.y1-d||g-a.r>u.y1+d?null:u.y0<u.y1&&g-a.r>u.y1?null:u.y0>u.y1&&g+a.r<u.y1?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i})}},e.Drawing.fibarc.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=o<n,h=Math.abs((o-n)/(s-r)),c=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var u=this.color;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor);for(var p=0;p<this.parameters.fibs.length;p++){t.fillStyle=u;var d=this.parameters.fibs[p];if(!(d.level<0)&&d.display){var m=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*d.level,g=this.p1[1]+m*(l?-1:1)*(a.flipped?-1:1),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],g),y=e.xIntersection({x0:r,x1:s,y0:n,y1:o},f);if(this.parameters.printLevels){t.textAlign="center";var v=Math.round(1e3*d.level)/10+"%";this.parameters.printValues&&(t.fillStyle=u,this.stx.canvasFont("stx_yaxis",t)),t.fillText(v,s,Math.round(f-5))}if(t.textAlign="left",this.parameters.printValues&&y<i.width){var x=g;x=a.priceFormatter?a.priceFormatter(this.stx,i,x):this.stx.formatYAxisPrice(x,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,x,f,u,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var b=d.color;("auto"==b||e.isTransparent(b))&&(b=this.color),("auto"==b||e.isTransparent(b))&&(b=this.stx.defaultColor),t.strokeStyle=this.highlight?c:b;var S=d.color;("auto"==S||e.isTransparent(S))&&(S=this.fillColor),("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor),t.fillStyle=S,t.globalAlpha=this.highlighted?1:d.parameters.opacity,t.lineWidth=d.parameters.lineWidth,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(t.lineWidth,d.parameters.pattern)),t.lineDashOffset=0),t.save(),t.beginPath(),t.scale(1/h,1),t.arc(s*h,o,Math.abs(f-o),0,Math.PI,!l),"none"!=this.pattern&&t.stroke(),t.globalAlpha=.05,t.fill(),t.restore(),t.setLineDash&&t.setLineDash([]),t.globalAlpha=1}}t.textAlign="left";var C=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(C.opacity=1),this.stx.plotLine(s,2*r-s,o,2*n-o,c,"segment",t,i,C),this.highlighted){var w="p0"==this.highlighted,T="p1"==this.highlighted;this.littleCircle(t,r,n,w),this.littleCircle(t,s,o,T)}}}},e.Drawing.fibfan=function(){this.name="fibfan"},e.Drawing.fibfan.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibfan.prototype.recommendedLevels=[0,.382,.5,.618,1],e.Drawing.fibfan.prototype.setOuter=function(){},e.Drawing.fibfan.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=Math.min(o,n),h=Math.max(o,n),c=h-l,u=(o-n)/(s-r)>0,p=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var d=t.measureText("161.8%").width+10,m=Number.MAX_VALUE,g=-1*Number.MAX_VALUE,f=this.color;("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.rays=[];for(var y=0;y<this.parameters.fibs.length;y++){t.fillStyle=f;var v=this.parameters.fibs[y];if(v.display){var x=this.stx.pixelFromValueAdjusted(i,this.p0[0],(this.p0[1]-this.p1[1])*v.level+this.p1[1]),b=e.xIntersection({x0:s,x1:s,y0:n,y1:o},x),S=i.left;s>r&&(S+=i.width);var C=(S-r)*(x-n)/(b-r)+n;if(!(r>S-(this.parameters.printLevels?d+5:0)&&s>r||r<S+(this.parameters.printLevels?d+5:0)&&s<r)){if(this.parameters.printLevels){var w=Math.round(1e3*v.level)/10+"%";s>r?(S-=d,t.textAlign="left"):(S+=d,t.textAlign="right"),this.parameters.printValues&&(t.fillStyle=f,this.stx.canvasFont("stx_yaxis",t)),C=(S-r)*(x-n)/(b-r)+n,t.fillText(w,S,C),s>r?S-=5:S+=5}if(t.textAlign="left",this.parameters.printValues&&b<i.width){var T=this.stx.transformedPriceFromPixel(x,i);T=a.priceFormatter?a.priceFormatter(this.stx,i,T):this.stx.formatYAxisPrice(T,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,T,x,f,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var k=v.color;("auto"==k||e.isTransparent(k))&&(k=this.color),("auto"==k||e.isTransparent(k))&&(k=this.stx.defaultColor);var D=v.color;("auto"==D||e.isTransparent(D))&&(D=this.fillColor),("auto"==D||e.isTransparent(D))&&(D=this.stx.defaultColor),t.fillStyle=D,this.parameters.printLevels&&(C=(S-r)*(x-n)/(b-r)+n);var M=e.clone(v.parameters);this.highlighted&&(M.opacity=1),this.stx.plotLine(r,S,n,C,this.highlighted?p:k,"segment",t,i,M),this.rays.push([[r,n],[S,C]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(S,C),t.lineTo(r,n),t.lineTo(S,n),t.fill(),t.globalAlpha=1,x<m&&(m=x),x>g&&(g=x)}}}for(var A=0;A<=1;A++){var F=u?h-c*A:l+c*A;(F=Math.round(F))<m&&(m=F),F>g&&(g=F)}if(this.highlighted){var P="p0"==this.highlighted,_="p1"==this.highlighted;this.littleCircle(t,r,n,P),this.littleCircle(t,s,o,_)}}}},e.Drawing.fibtimezone=function(){this.name="fibtimezone"},e.Drawing.fibtimezone.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibtimezone.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=[1,0],l=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0],c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.textAlign="center";var u=a,p=i.yAxis.top,d=i.yAxis.bottom,m=0,g=this.parameters.timezone.color;("auto"==g||e.isTransparent(g))&&(g=this.color),("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor);var f=this.parameters.timezone.color;("auto"==f||e.isTransparent(f))&&(f=this.fillColor),("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.parameters.printLevels&&(d-=13);var y=e.clone(this.parameters.timezone.parameters);this.highlighted&&(y.opacity=1);do{if(u=this.stx.pixelFromTick(this.p0[0]+m*h,i.chart),a<r&&u>i.left+i.width)break;if(a>r&&u<i.left)break;this.parameters.printLevels&&(t.fillStyle=c,t.fillText(r>a?m:-1*m,u,d+7)),t.fillStyle=f,this.stx.plotLine(u,u,0,d,this.highlighted?l:g,"segment",t,i,y),t.globalAlpha=.05,t.beginPath(),t.moveTo(a,p),t.lineTo(u,p),t.lineTo(u,d),t.lineTo(a,d),t.fill(),t.globalAlpha=1,m=o[0]+o[1],o.unshift(m)}while(h);if(t.textAlign="left",this.stx.plotLine(a,r,s,n,l,"segment",t,i,y),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,a,s,v),this.littleCircle(t,r,n,x)}else{var b=this.stx.valueFromPixel(i.height/2,i);this.setPoint(0,this.p0[0],b,i.chart),this.setPoint(1,this.p1[0],b,i.chart)}}},e.Drawing.fibtimezone.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1,n=this.stx.panels[this.panelName];if(!r||!s||!n)return null;var o={0:r,1:s};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};return this.lineIntersection(t,i,a,"segment")||a.x0<=this.p0[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},e.Drawing.shape=function(){this.name="shape",this.radians=0,this.a=0,this.rotating=!1,this.textMeasure=!1,this.configurator="shape",this.dimension=[0,0],this.points=[]},e.Drawing.shape.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.shape.prototype.measure=function(){},e.Drawing.shape.prototype.render=function(t){if(this.points.length){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(this.p1){var s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);t.globalAlpha=.5,t.fillStyle="#000000",this.rotating?(this.radians=Math.atan((n-r)/(s-a)),s<a?this.radians+=Math.PI:n<r&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.a%=360,this.radians=this.a*Math.PI/180,this.textMeasure&&t.fillText(this.a+"°",s+10,n+10)):this.penDown&&(this.sx=Math.max(1,parseFloat(Math.abs(2*(s-a)/this.dimension[0]).toFixed(1))),s<a&&(this.sx*=-1),this.sy=Math.max(1,parseFloat(Math.abs(2*(n-r)/this.dimension[1]).toFixed(1))),n<r&&(this.sy*=-1),this.textMeasure&&t.fillText(this.sx+"x,"+this.sy+"x",s+this.sx+5,n+this.sy+5)),t.globalAlpha=1}var o=this.lineWidth;o||(o=1.1);var l={pattern:this.pattern,lineWidth:o};this.highlighted&&"none"==l.pattern&&(l.pattern="solid",.1==l.lineWidth&&(l.lineWidth=1));var h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),this.highlighted&&(h=this.stx.getCanvasColor("stx_highlight_vector"),.1==o&&(o=1.1));var c,u,p=this.fillColor;for(o/=2*Math.abs(this.sx*this.sy)/(Math.abs(this.sx)+Math.abs(this.sy)),t.save(),t.translate(a,r),t.rotate(this.radians),t.scale(this.sx,i.yAxis.flipped?-this.sy:this.sy),c=0;c<this.points.length;c++){for(t.beginPath(),u=0;u<this.points[c].length;u++){var d,m,g,f,y,v;"M"==this.points[c][u]?(d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.moveTo(d,m)):"L"==this.points[c][u]?(d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.lineTo(d,m)):"Q"==this.points[c][u]?(g=this.points[c][++u]-(this.dimension[0]-1)/2,y=this.points[c][++u]-(this.dimension[1]-1)/2,d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.quadraticCurveTo(g,y,d,m)):"B"==this.points[c][u]&&(g=this.points[c][++u]-(this.dimension[0]-1)/2,y=this.points[c][++u]-(this.dimension[1]-1)/2,f=this.points[c][++u]-(this.dimension[0]-1)/2,v=this.points[c][++u]-(this.dimension[1]-1)/2,d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.bezierCurveTo(g,y,f,v,d,m))}t.closePath(),p&&!e.isTransparent(p)&&"auto"!=p&&(t.fillStyle=p,t.fill()),h&&"none"!=this.pattern&&(t.strokeStyle=h,t.lineWidth=o,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(o,this.pattern)),t.lineDashOffset=0),t.stroke())}if(t.restore(),t.save(),t.translate(a,r),t.rotate(this.radians),this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted,S="p2"==this.highlighted;this.littleCircle(t,0,0,x),this.mover(t,0,0,x),this.littleCircle(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,b),this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,b),this.littleCircle(t,this.sx*this.dimension[0]/2,0,S),this.rotator(t,this.sx*this.dimension[0]/2,0,S),t.globalAlpha=.5,t.fillStyle="#000000",this.textMeasure&&(t.fillText(this.sx+"x,"+this.sy+"x",this.sx*this.dimension[0]/2+12,this.sy*this.dimension[1]/2+5),t.fillText(this.a+"°",this.sx*this.dimension[0]/2+12,5)),t.globalAlpha=1}else this.penDown&&(this.rotating?this.rotator(t,this.sx*this.dimension[0]/2,0,!0):this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,!0));t.restore()}}},e.Drawing.shape.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName];if("move"==e.action){var s=e.tick-i,n=e.value-a;this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}else{var o=this.stx.pixelFromTick(this.p0[0],r.chart),l=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),h=this.stx.pixelFromTick(i,r.chart),c=this.stx.pixelFromValueAdjusted(r,i,a);"scale"==e.action?(this[e.point]=[i,a],this.sx=parseFloat((((h-o)*Math.cos(this.radians)+(c-l)*Math.sin(this.radians))/(this.dimension[0]/2)).toFixed(1)),Math.abs(this.sx)<1&&(this.sx/=Math.abs(this.sy)),this.sy=parseFloat((((c-l)*Math.cos(this.radians)-(h-o)*Math.sin(this.radians))/(this.dimension[1]/2)).toFixed(1)),Math.abs(this.sy)<1&&(this.sy/=Math.abs(this.sy)),this.render(t)):"rotate"==e.action&&(this[e.point]=[i,a],this.radians=Math.atan((c-l)/(h-o)),h<o?this.radians+=Math.PI:c<l&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.sx<0&&(this.a=this.a+180),this.a%=360,this.radians=this.a*Math.PI/180,this.render(t))}}},e.Drawing.shape.prototype.intersected=function(t,i,a){if(!this.p0)return null;if(this.stx.repositioningDrawing==this&&this.stx.repositioningDrawing.repositioner)return this.stx.repositioningDrawing.repositioner;var r=this.stx.panels[this.panelName],s=this.stx.pixelFromTick(this.p0[0],r.chart),n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),o=this.stx.pixelFromTick(t,r.chart),l=this.stx.pixelFromValueAdjusted(r,t,i),h=l-=n,c=o-=s;o=Math.cos(this.radians)*c+Math.sin(this.radians)*h,l=Math.cos(this.radians)*h-Math.sin(this.radians)*c,o/=this.sx,l/=this.sy;var u=Math.pow(e.touchDevice?25:5+this.littleCircleRadius(),2),p=Math.abs(u/(this.sx*this.sy)),d=Math.pow(this.dimension[0]/2,2)+Math.pow(this.dimension[1]/2,2)>Math.pow(o,2)+Math.pow(l,2),m=(u-(Math.pow(o*this.sx,2)+Math.pow(l*this.sy,2)))/Math.abs(this.sx*this.sy),g=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l-this.dimension[1]/2,2)),f=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l,2));return d?g>=f&&g>=m?(this.highlighted="p1",{action:"scale"}):f>=g&&f>=m?(this.highlighted="p2",{action:"rotate"}):(this.highlighted="p0",{action:"move",p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.shape.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.shape.prototype.littleCircleRadius=function(){return 3},e.Drawing.shape.prototype.click=function(t,e,i){if(!this.points.length)return!1;this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?(this.setPoint(1,e,i,a.chart),this.rotating?(this.penDown=!1,this.rotating=!1,!0):(this.rotating=!0,!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.shape.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.radians=Math.round(this.a/5)*Math.PI/36)},e.Drawing.shape.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.v0=e.v0,this.tzo0=e.tzo0,this.a=e.a,this.sx=e.sx,this.sy=e.sy,this.adjust()},e.Drawing.shape.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,v0:this.v0,tzo0:this.tzo0,a:this.a,sx:this.sx,sy:this.sy}},e.Drawing.xcross=function(){this.name="xcross",this.dimension=[7,7],this.points=[["M",1,0,"L",3,2,"L",5,0,"L",6,1,"L",4,3,"L",6,5,"L",5,6,"L",3,4,"L",1,6,"L",0,5,"L",2,3,"L",0,1,"L",1,0]]},e.Drawing.xcross.ciqInheritsFrom(e.Drawing.shape),e.Drawing.arrow=function(){this.name="arrow",this.dimension=[11,11],this.points=[["M",3,0,"L",7,0,"L",7,5,"L",10,5,"L",5,10,"L",0,5,"L",3,5,"L",3,0]]},e.Drawing.arrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.check=function(){this.name="check",this.dimension=[8,9],this.points=[["M",1,5,"L",0,6,"L",2,8,"L",7,1,"L",6,0,"L",2,6,"L",1,5]]},e.Drawing.check.ciqInheritsFrom(e.Drawing.shape),e.Drawing.star=function(){this.name="star",this.dimension=[12,12],this.points=[["M",0,4,"L",4,4,"L",5.5,0,"L",7,4,"L",11,4,"L",8,7,"L",9,11,"L",5.5,9,"L",2,11,"L",3,7,"L",0,4]]},e.Drawing.star.ciqInheritsFrom(e.Drawing.shape),e.Drawing.heart=function(){this.name="heart",this.dimension=[23,20],this.points=[["M",11,3,"B",11,2.4,10,0,6,0,"B",0,0,0,7.5,0,7.5,"B",0,11,4,15.4,11,19,"B",18,15.4,22,11,22,7.5,"B",22,7.5,22,0,16,0,"B",13,0,11,2.4,11,3]]},e.Drawing.heart.ciqInheritsFrom(e.Drawing.shape),e.Drawing.focusarrow=function(){this.name="focusarrow",this.dimension=[7,5],this.points=[["M",0,0,"L",2,2,"L",0,4,"L",0,0],["M",6,0,"L",4,2,"L",6,4,"L",6,0]]},e.Drawing.focusarrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.crossline=function(){this.name="crossline"},e.Drawing.crossline.ciqInheritsFrom(e.Drawing.horizontal),e.extend(e.Drawing.crossline.prototype,{measure:function(){},accidentalClick:function(t,e){return!1},adjust:function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=e.clone(this.p0))},intersected:function(t,i,a){if(!this.p0||!this.p1)return null;this.p1[0]+=1;var r=this.lineIntersection(t,i,a,"line");return this.p1=e.clone(this.p0),r||(this.p1[1]+=1,r=this.lineIntersection(t,i,a,"line"),this.p1=e.clone(this.p0),r)?(this.highlighted=!0,this.pointIntersection(this.p0[0],this.p0[1],a)&&(this.highlighted="p0"),{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},render:function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),s=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),n=this.getLineColor(),o={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(r,r+100,s,s,n,"horizontal",t,a,o),this.stx.plotLine(r,r,s,s+100,n,"vertical",t,a,o),this.axisLabel&&!this.repositioner){this.stx.endClip();var l=this.p0[1];if(a.chart.transformFunc&&(l=a.chart.transformFunc(this.stx,a.chart,l)),l=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,l):this.stx.formatYAxisPrice(l,a),this.stx.createYAxisLabel(a,l,s,n),this.stx.startClip(a.name),this.p0[0]>=0&&!this.stx.chart.xAxis.noDraw){var h,c;if(h=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))h.setHours(0,0,0,0);else{var u=1e3*h.getSeconds()+h.getMilliseconds();this.stx.displayZone&&(c=new i.Date(h.getTime(),this.stx.displayZone),h=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes()),h=new Date(h.getTime()+u))}var p=e.mmddhhmm(e.yyyymmddhhmm(h));if(a.chart.xAxis.formatter)p=a.chart.xAxis.formatter(h,this.name,null,null,p);else if(this.stx.internationalizer){var d;0!==h.getHours()||0!==h.getMinutes()?(d=this.stx.internationalizer.monthDay.format(h),d+=" "+this.stx.internationalizer.hourMinute.format(h)):d=this.stx.internationalizer.yearMonthDay.format(h),p=d}this.stx.endClip(),this.stx.createXAxisLabel(a,p,r,n,null,!0),this.stx.startClip(a.name)}}if(this.highlighted){var m="p0"==this.highlighted;this.littleCircle(t,r,s,m)}}}},!0),e.Drawing.speedarc=function(){this.name="speedarc",this.printLevels=!0},e.Drawing.speedarc.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.speedarc.prototype,{defaultOpacity:.25,configs:["color","fillColor","lineWidth","pattern"],copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},intersected:function(t,i,a){if(!this.p0||!this.p1)return null;var r={0:this.p0,1:this.p1};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};if(this.lineIntersection(t,i,a,this.name))return this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i};var n=this.p1[0]-(this.p0[0]-this.p1[0]),o=this.p0[0],l=this.p1[1],h=this.p0[1];return t>Math.max(n,o)||t<Math.min(n,o)?null:i>Math.max(h,l)||i<Math.min(h,l)?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i})},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=n<s,l=Math.abs((n-s)/(r-a)),h=this.getLineColor();t.strokeStyle=h;var c=this.fillColor;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.fillStyle=c,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(this.lineWidth,this.pattern)),t.lineDashOffset=0),this.stx.canvasFont("stx_yaxis",t);for(var u=1;u<3;u++){var p=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*u/3,d=this.p1[1]+p*(o?-1:1)*(i.yAxis.flipped?-1:1),m=this.stx.pixelFromValueAdjusted(i,this.p0[0],d);if(t.save(),t.beginPath(),t.scale(1/l,1),t.arc(r*l,n,Math.abs(m-n),0,Math.PI,!o),t.globalAlpha=this.highlighted?1:this.defaultOpacity,"none"!=this.pattern&&t.stroke(),t.globalAlpha=.1,t.fill(),t.restore(),t.globalAlpha=1,this.printLevels){t.fillStyle=h,t.textAlign="center";var g=u+"/3";t.fillText(g,r,Math.round(m-5)),t.fillStyle=c}}t.textAlign="left";var f={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity};if(this.stx.plotLine(a,r,s,n,h,"segment",t,i,f),t.setLineDash&&t.setLineDash([]),this.highlighted){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,a,s,y),this.littleCircle(t,r,n,v)}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}}},!0),e.Drawing.speedline=function(){this.name="speedline",this.printLevels=!0},e.Drawing.speedline.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.speedline.prototype,{intersected:function(t,i,a){var r=this.p0,s=this.p1;if(!r||!s)return null;var n={0:r,1:s};for(var o in n)if(this.pointIntersection(n[o][0],n[o][1],a))return this.highlighted="p"+o,{action:"drag",point:"p"+o};for(var l=this.rays,h=0;h<l.length;h++)if(this.lineIntersection(t,i,a,"ray",l[h][0],l[h][1],!0))return this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i};return null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.getLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;var c,u,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},d=["1","2/3","1/3","3/2","3"],m=[1,2/3,1/3,1.5,3],g=[];this.rays=[];for(var f=0;f<m.length;f++){var y=m[f];if(!(y>1)||this.extension){var v,x=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]-(this.p0[1]-this.p1[1])*y);y>1?(v=e.xIntersection({x0:a,x1:r,y0:s,y1:x},n),g.push(v)):(v=e.xIntersection({x0:r,x1:r,y0:s,y1:n},x),g.push(x));var b=y>1?v:r,S=y>1?n:x;if(this.confineToGrid||(b=i.left,r>a&&(b+=i.width),S=(b-a)*(x-s)/(r-a)+s),this.printLevels&&(1!=y||this.extension)){t.fillStyle=l;var C=0,w=0;s>n?(w=-5,t.textBaseline="bottom"):(w=5,t.textBaseline="top"),a>r?(C=5,t.textAlign="right"):(C=-5,t.textAlign="left"),y>1?t.fillText(d[f],v+(this.confineToGrid?0:C),n):t.fillText(d[f],r,x+(this.confineToGrid?0:w)),t.fillStyle=h}this.stx.plotLine(a,b,s,S,this.highlighted?o:l,"segment",t,i,p),1==y&&(c=b,u=S),this.rays.push([[a,s],[b,S]]),t.globalAlpha=.1,t.beginPath(),t.moveTo(b,S),t.lineTo(a,s),t.lineTo(c,u),t.fill(),t.globalAlpha=1}}if(t.textAlign="left",t.textBaseline="middle",this.confineToGrid&&(t.globalAlpha=.3,t.beginPath(),t.strokeRect(a,s,r-a,n-s),t.moveTo(a,g[1]),t.lineTo(r,g[1]),t.moveTo(a,g[2]),t.lineTo(r,g[2]),this.extension&&(t.moveTo(g[3],s),t.lineTo(g[3],n),t.moveTo(g[4],s),t.lineTo(g[4],n)),t.stroke(),t.globalAlpha=1),this.highlighted){var T="p0"==this.highlighted,k="p1"==this.highlighted;this.littleCircle(t,a,s,T),this.littleCircle(t,r,n,k)}}}},!0),e.Drawing.gannfan=function(){this.name="gannfan",this.printLevels=!0},e.Drawing.gannfan.ciqInheritsFrom(e.Drawing.speedline),e.extend(e.Drawing.gannfan.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.getLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;var c,u,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},d=[1,2,3,4,8,.5,1/3,.25,1/8];this.rays=[];for(var m=0;m<d.length;m++){var g=d[m],f=a+(r-a)/g,y=s-g*(s-n),v=i.left;r>a&&(v+=i.width);var x=(v-a)*(y-s)/(r-a)+s;if(this.printLevels){t.fillStyle=l;var b=0,S=0;s>n?(S=5,t.textBaseline="top"):(S=-5,t.textBaseline="bottom"),a>r?(b=5,t.textAlign="left"):(b=-5,t.textAlign="right"),g>1?t.fillText(g+"x1",f+b,n):t.fillText("1x"+1/g,r,y+S),t.fillStyle=h}this.stx.plotLine(a,v,s,x,this.highlighted?o:l,"segment",t,i,p),this.rays.push([[a,s],[v,x]]),1==g&&(c=v,u=x),t.globalAlpha=.1,t.beginPath(),t.moveTo(v,x),t.lineTo(a,s),t.lineTo(c,u),t.fill(),t.globalAlpha=1}if(t.textAlign="left",t.textBaseline="middle",this.highlighted){var C="p0"==this.highlighted,w="p1"==this.highlighted;this.littleCircle(t,a,s,C),this.littleCircle(t,r,n,w)}}}},!0),e.Drawing.timecycle=function(){this.name="timecycle",this.printLevels=!0},e.Drawing.timecycle.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.timecycle.prototype,{intersected:function(t,i,a){var r=this.p0,s=this.p1,n=this.stx.panels[this.panelName];if(!r||!s||!n)return null;var o={0:r,1:s};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};return this.lineIntersection(t,i,a,"segment")||a.x0<=this.p0[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=0,l=this.getLineColor();t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0];t.textAlign="center";var c=a,u=i.yAxis.top,p=i.yAxis.bottom,d=this.color;("auto"==d||e.isTransparent(d))&&(d=this.stx.defaultColor);var m=this.fillColor;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.printLevels&&(p-=13);var g={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},f=[];t.save(),t.fillStyle=m,t.globalAlpha=.05;do{if(c=this.stx.pixelFromTick(this.p0[0]+o*h,i.chart),o++,a<r&&c>i.left+i.width)break;if(a>r&&c<i.left)break;c<i.left||c>i.left+i.width||(t.beginPath(),t.moveTo(a,u),t.lineTo(c,u),t.lineTo(c,p),t.lineTo(a,p),t.fill(),f.push({c:o,x:c}))}while(h);t.globalAlpha=1;for(var y=0,v=0;v<f.length;v++){if(this.stx.plotLine(f[v].x,f[v].x,0,p,this.highlighted?l:d,"segment",t,i,g),this.printLevels)t.fillStyle=d,this.stx.chart.context.measureText(f[v].c).width+3<this.stx.layout.candleWidth+y?(t.fillText(f[v].c,f[v].x,p+7),y=0):y+=this.stx.layout.candleWidth}if(t.restore(),t.textAlign="left",this.stx.plotLine(a,r,s,n,l,"segment",t,i,g),this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted;this.littleCircle(t,a,s,x),this.littleCircle(t,r,n,b)}else{var S=this.stx.valueFromPixel(i.height/2,i);this.setPoint(0,this.p0[0],S,i.chart),this.setPoint(1,this.p1[0],S,i.chart)}}}},!0),e.Drawing.regression=function(){this.name="regression"},e.Drawing.regression.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.regression.prototype,{configs:["color","lineWidth","pattern","active1","color1","lineWidth1","pattern1","active2","color2","lineWidth2","pattern2","active3","color3","lineWidth3","pattern3"],copyConfig:function(t){e.Drawing.copyConfig(this,t);var i=this.stx.currentVectorParameters;this.active1=!!i.active1,this.active2=!!i.active2,this.active3=!!i.active3,this.color1=i.color1||"auto",this.color2=i.color2||"auto",this.color3=i.color3||"auto",this.lineWidth1=i.lineWidth1,this.lineWidth2=i.lineWidth2,this.lineWidth3=i.lineWidth3,this.pattern1=i.pattern1,this.pattern2=i.pattern2,this.pattern3=i.pattern3},$controls:['cq-cvp-controller[cq-cvp-header="1"]','cq-cvp-controller[cq-cvp-header="2"]','cq-cvp-controller[cq-cvp-header="3"]'],click:function(t,e,i){if(!(e<0)){this.copyConfig();var a=this.stx.panels[this.panelName];if(!this.penDown){this.setPoint(0,e,i,a.chart),this.penDown=!0;var r=this.stx;if(this.field=r.highlightedDataSetField,!this.field&&a!=r.chart.panel){for(var s in r.chart.seriesRenderers){var n=r.chart.seriesRenderers[s];if(n.params.panel==a.name){this.field=n.seriesParams[0].field;break}}for(var o in r.layout.studies){var l=r.layout.studies[o];if(l.panel==a.name){this.field=Object.keys(l.outputMap)[0];break}}}return!1}return this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0)}},getYValue:function(t){var i=this.stx.chart.dataSet[t],a=this.stx.chart.dataSet[t];if(!i)return null;var r=this.stx.panels[this.panelName],s=this.stx.getYAxisByField(r,this.field)||r.yAxis;if(this.stx.charts[r.name]&&r.chart.transformFunc&&s==r.yAxis&&(a=i.transform),!a)return null;var n=null,o=null,l=this.stx.defaultPlotField||"Close";if(this.field){if(!(o=e.existsInObjectChain(a,this.field)))return null;n=o=o.obj[o.member],i!=a&&(n=(n=e.existsInObjectChain(i,this.field)).obj[n.member]),"object"==_typeof(o)&&(o=o[l],n=n[l])}else o=a[l],n=i[l];return{transformed:o,untransformed:n}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=this.stx.getYAxisByField(e,this.field),s=[],n=[],o=0,l=0,h=0,c=0,u=Math.min(this.p1[0],this.p0[0]),p=Math.max(this.p1[0],this.p0[0])+1,d=p-u,m=u;m<p;m++){var g=this.getYValue(m);g&&(s.push(g.transformed),n.push(g.untransformed))}var f=s.length,y=f*(f+1)/2,v=Math.pow(y,2),x=y*(2*f+1)/3;for(m=0;m<f;m++)h+=f*s[m]-o,o+=s[m],c+=f*n[m]-l,l+=n[m];var b,S,C=(f*h-y*o)/(f*x-v),w=(o-C*y)/f,T=(f*c-y*l)/(f*x-v),k=(l-C*y)/f;this.p0[0]<this.p1[0]?(b=w,S=C*d+w,this.p0[1]=k,this.p1[1]=T*d+k):(b=C*d+w,S=w,this.p0[1]=T*d+k,this.p1[1]=k);var D=this.stx.pixelFromTransformedValue(b,e,r),M=this.stx.pixelFromTransformedValue(S,e,r),A=this.getLineColor(),F={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,D,M,A,"segment",t,e,F),this.stx.plotLine(i,i,D-20,D+20,A,"segment",t,e,F),this.stx.plotLine(a,a,M-20,M+20,A,"segment",t,e,F),this.active1||this.active2||this.active3){var P=o/f,_=0;for(m=0;m<f;m++)_+=Math.pow(s[m]-P,2);var E={context:t,panel:e,points:{0:{x:i,v:b},1:{x:a,v:S}},stddev:Math.sqrt(_/f),yAxis:r};this.lines={},this.active1&&(this.renderStddev("1","p",E),this.renderStddev("1","n",E)),this.active2&&(this.renderStddev("2","p",E),this.renderStddev("2","n",E)),this.active3&&(this.renderStddev("3","p",E),this.renderStddev("3","n",E))}if(this.highlighted){var L="p0"==this.highlighted,N="p1"==this.highlighted;this.littleCircle(t,i,D,L),this.littleCircle(t,a,M,N)}else this.pixelX=[i,a],this.pixelY=[D,M]}}},renderStddev:function(t,e,i){var a="stddev"+t+e,r="color"+t,s="pattern"+t,n="lineWidth"+t,o=i.points,l=o[0].v,h=o[1].v,c=i.stddev,u="n"===e?-1*t:1*t,p=this.stx,d=i.panel,m=i.yAxis,g={name:a,color:this.getLineColor(this[r]),type:"segment",y0:p.pixelFromTransformedValue(l+c*u,d,m),y1:p.pixelFromTransformedValue(h+c*u,d,m),params:{pattern:this[s],lineWidth:this[n]}};this.lines&&(this.lines[a]=g);var f=i.context,y=o[0].x,v=o[1].x;p.plotLine(y,v,g.y0,g.y1,g.color,g.type,f,d,g.params),p.plotLine(y,y,g.y0-10,g.y0+10,g.color,g.type,f,d,g.params),p.plotLine(v,v,g.y1-10,g.y1+10,g.color,g.type,f,d,g.params);var x=t+"σ",b=Math.max(y,v)+5,S=y<v?g.y1:g.y0;if(f.fillStyle=g.color,f.save(),f.textBaseline="middle",f.fillText(x,b,S),f.restore(),i.formatPrice&&this.axisLabel&&!this.highlighted&&!this.penDown&&(y>=d.chart.left&&y<=d.chart.right||v>=d.chart.left&&v<=d.chart.right)){var C=(y<v?h:l)+c*u;p.endClip(),p.createYAxisLabel(d,i.formatPrice(C,m),S,g.color,null,f,m),p.startClip(d.name)}},intersected:function(t,i,a){if(!this.pixelX||!this.pixelY)return null;var r=this.repositionIntersection(t,i);if(r)return r;for(var s={0:this.pixelX,1:this.pixelY},n=0;n<2;n++)if(this.pointIntersection(s[0][n],s[1][n],a,!0))return this.highlighted="p"+n,{action:"drag",point:"p"+n};var o=this,l=this.pixelX[0],h=this.pixelX[1],c=function(e){var r=[l,e.y0],s=[h,e.y1];return o.lineIntersection(t,i,a,o.name,r,s,!0)},u=c({y0:this.pixelY[0],y1:this.pixelY[1]});if(!u&&this.lines)for(var p in this.lines)if(c(this.lines[p])){u=!0;break}return u?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},repositionIntersection:function(t,i){return!(!this.p0||!this.p1)&&(!(this!=this.stx.repositioningDrawing||!this.highlighted)&&(!0===this.highlighted?{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}:{action:"drag",point:this.highlighted}))},lineIntersection:function(t,i,a,r,s,n,o){if(!o)return console.log(r+" lineIntersection must accept p0 and p1 in pixels.  Please verify and set isPixels=true."),!1;if(s||(s=this.p0),n||(n=this.p1),!s||!n)return!1;var l=this.stx,h=e.convertBoxToPixels(l,this.panelName,a);if(void 0===h.x0)return!1;var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]};return e.boxIntersects(h.x0,h.y0,h.x1,h.y1,c.x0,c.y0,c.x1,c.y1)},boxIntersection:function(t,e,i){return!(i.cx0>Math.max(this.pixelX[0],this.pixelX[1])||i.cx1<Math.min(this.pixelX[0],this.pixelX[1]))&&!(!this.stx.repositioningDrawing&&(i.cy1<this.pixelY[0]||i.cy0>this.pixelY[1]))},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.color1=e.col1,this.color2=e.col2,this.color3=e.col3,this.active1=e.dev1,this.active2=e.dev2,this.active3=e.dev3,this.panelName=e.pnl,this.pattern=e.ptrn,this.pattern1=e.ptrn1,this.pattern2=e.ptrn2,this.pattern3=e.ptrn3,this.lineWidth=e.lw,this.lineWidth1=e.lw1,this.lineWidth2=e.lw2,this.lineWidth3=e.lw3,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.field=e.fld,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,dev1:this.active1,dev2:this.active2,dev3:this.active3,col:this.color,col1:this.color1,col2:this.color2,col3:this.color3,ptrn:this.pattern,ptrn1:this.pattern1,ptrn2:this.pattern2,ptrn3:this.pattern3,lw:this.lineWidth,lw1:this.lineWidth1,lw2:this.lineWidth2,lw3:this.lineWidth3,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,fld:this.field}}},!0),e.Drawing.trendline=function(){this.name="trendline"},e.Drawing.trendline.ciqInheritsFrom(e.Drawing.segment),e.Drawing.trendline.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.trendline.prototype.measure=function(){},e.Drawing.trendline.prototype.reconstruct=function(t,i){e.Drawing.segment.prototype.reconstruct.call(this,t,i),this.callout=new e.Drawing.callout,this.callout.reconstruct(t,i.callout)},e.Drawing.trendline.prototype.serialize=function(){var t=e.Drawing.segment.prototype.serialize.call(this);return t.callout=this.callout.serialize(),t},e.Drawing.trendline.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){if(e.Drawing.segment.prototype.render.call(this,t),!this.callout){this.callout=new e.Drawing.callout;var a=e.Drawing.segment.prototype.serialize.call(this);this.callout.reconstruct(this.stx,a)}this.callout.p0=e.clone(this.p0);var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(isFinite(n)&&isFinite(o)){var l=(r+s)/2,h=(n+o)/2;this.fontSize=e.stripPX(this.font&&this.font.size||13);var c=1.2*this.callout.w+("c"==this.callout.stemEntry[0]?0:50),u=c/(Math.sqrt(Math.pow(s-r,2)+Math.pow(o-n,2))||c)*(this.p1[1]<this.p0[1]?1:-1),p=-(o-h)*u+l,d=(s-l)*u+h;this.callout.p0[0]=this.stx.tickFromPixel(p,i.chart),this.callout.p0[1]=this.stx.priceFromPixel(d,i),this.callout.v0=this.callout.p0[1],this.callout.p1=e.clone(this.p0),this.callout.stx=this.stx,this.callout.fillColor=this.fillColor||this.callout.fillColor,this.callout.borderColor=this.color,this.callout.font=this.font||this.callout.font,this.callout.noHandles=!0;var m=this.p1[1]-this.p0[1];this.callout.text=Number(m).toFixed(2)+(0===this.p0[1]?"":" ("+Number(100*m/this.p0[1]).toFixed(2)+"%) ")+Math.abs(this.p1[0]-this.p0[0])+" Bars";var g,f=Math.floor((this.p0[0]+this.p1[0])/2);if(Math.abs(this.p0[0]-this.p1[0])>1&&Math.abs(this.p0[0]-this.p1[0])<20){var y=n+(o-n)/(s-r)*(this.stx.pixelFromTick(f,i.chart)-r);g=this.stx.priceFromPixel(y,i)||h}else g=this.stx.priceFromPixel(h,i);if(this.callout.stem={t:f,v:g},this.callout.renderText(),this.callout.render(t),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,r,n,v),this.littleCircle(t,s,o,x)}}}},e.Drawing.trendline.prototype.lineIntersection=function(t,i,a,r){return e.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,i,a,"segment")},e.Drawing.trendline.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r=this.callout.intersected(t,i,a),s=e.Drawing.segment.prototype.intersected.call(this,t,i,a);return this.callout.highlighted=!(!r&&!s),s||(r?{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}:null)},e.Drawing.average=function(){this.name="average"},e.Drawing.average.ciqInheritsFrom(e.Drawing.regression),e.extend(e.Drawing.average.prototype,{configs:e.Drawing.regression.prototype.configs.concat("axisLabel"),measure:function(){if(this.p0&&this.p1){this.stx.setMeasure(0,!1,this.p0[0],this.p1[0],!0,this.name);var t=[],e="";this.active1&&t.push("1"),this.active2&&t.push("2"),this.active3&&t.push("3"),t.length&&(e="&ensp;"+t.join(", ")+" &sigma;");var i=(this.stx.drawingContainer||document).querySelector(".mMeasure"),a=this.stx.controls.mSticky,r=a&&a.querySelector(".mStickyInterior");if(i&&(i.innerHTML+=e),r){var s=[];s.push(this.name.capitalize()),s.push(this.field||this.stx.defaultPlotField||"Close"),s.push(r.innerHTML+e),r.innerHTML=s.join("<br>")}}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){var r,s,n=this.stx.getYAxisByField(e,this.field),o=this.stx,l=Math.min(this.p1[0],this.p0[0]),h=Math.max(this.p1[0],this.p0[0])+1,c=0,u=[];for(r=l;r<h;r++)null!==(s=this.getYValue(r))&&(c+=s.transformed,u.push(s));var p=u.length;if(p){var d=c/p,m=o.pixelFromTransformedValue(d,e,n),g=this.getLineColor(),f={pattern:this.pattern,lineWidth:this.lineWidth};if(o.plotLine(i,a,m,m,g,"segment",t,e,f),o.plotLine(i,i,m-20,m+20,g,"segment",t,e,f),o.plotLine(a,a,m-20,m+20,g,"segment",t,e,f),!this.axisLabel||this.highlighted||this.penDown||(i>=e.chart.left&&i<=e.chart.right||a>=e.chart.left&&a<=e.chart.right)&&(o.endClip(),o.createYAxisLabel(e,C(d,n),m,g,null,t,n),o.startClip(e.name)),this.active1||this.active2||this.active3){var y=0;for(r=0;r<p;r++)s=u[r],y+=Math.pow(s.transformed-d,2);var v=Math.sqrt(y/p),x={context:t,formatPrice:C,panel:e,points:{0:{x:i,v:d},1:{x:a,v:d}},stddev:v,yAxis:n};this.lines={},this.active1&&(this.renderStddev("1","p",x),this.renderStddev("1","n",x)),this.active2&&(this.renderStddev("2","p",x),this.renderStddev("2","n",x)),this.active3&&(this.renderStddev("3","p",x),this.renderStddev("3","n",x))}if(this.highlighted){var b="p0"==this.highlighted,S="p1"==this.highlighted;this.littleCircle(t,i,m,b),this.littleCircle(t,a,m,S)}else this.pixelX=[i,a],this.pixelY=[m,m]}}}function C(t,i){return t=i&&i.priceFormatter?i.priceFormatter(o,e,t):o.formatYAxisPrice(t,e,null,i)}},reconstruct:function(t,i){this.axisLabel=i.al,e.Drawing.regression.prototype.reconstruct.call(this,t,i)},serialize:function(){var t=e.Drawing.regression.prototype.serialize.call(this);return t.al=this.axisLabel,t}},!0),e.Drawing.quadrant=function(){this.name="quadrant"},e.Drawing.quadrant.ciqInheritsFrom(e.Drawing.regression),e.extend(e.Drawing.quadrant.prototype,{configs:["color","fillColor","lineWidth","pattern"],copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},$controls:[],render:function(t){var i=this.stx,a=i.panels[this.panelName];if(a&&this.p1){var r=i.pixelFromTick(this.p0[0],a.chart),s=i.pixelFromTick(this.p1[0],a.chart);if(!(r<a.left&&s<a.left||r>a.right&&s>a.right)){for(var n=this.stx.getYAxisByField(a,this.field),o=null,l=null,h=Math.min(this.p1[0],this.p0[0]);h<=Math.max(this.p1[0],this.p0[0]);h++){var c=this.getYValue(h);null!==c&&((null===o||c.transformed>o)&&(o=c.transformed),(null===l||c.transformed<l)&&(l=c.transformed))}var u=i.pixelFromTransformedValue(o,a,n),p=i.pixelFromTransformedValue((3*o+l)/4,a,n),d=i.pixelFromTransformedValue((2*o+l)/3,a,n),m=i.pixelFromTransformedValue((o+l)/2,a,n),g=i.pixelFromTransformedValue((o+2*l)/3,a,n),f=i.pixelFromTransformedValue((o+3*l)/4,a,n),y=i.pixelFromTransformedValue(l,a,n);this.p0[1]=0,this.p1[1]=!1;var v=this.getLineColor(),x=this.fillColor;("auto"==x||e.isTransparent(x))&&(x=i.defaultColor),t.fillStyle=x;var b={pattern:this.pattern,lineWidth:this.lineWidth};if(i.plotLine(r,s,u,u,v,"segment",t,a,b),i.plotLine(r,s,y,y,v,"segment",t,a,b),"quadrant"==this.name?(i.plotLine(r,s,p,p,v,"segment",t,a,b),i.plotLine(r,s,f,f,v,"segment",t,a,b)):"tirone"==this.name&&(i.plotLine(r,s,d,d,v,"segment",t,a,b),i.plotLine(r,s,g,g,v,"segment",t,a,b)),i.plotLine(r,r,u,y,v,"segment",t,a,b),i.plotLine(s,s,u,y,v,"segment",t,a,b),i.plotLine(r,s,m,m,v,"segment",t,a,e.extend(b,{opacity:"tirone"==this.name?.2:1})),t.globalAlpha=.1,t.beginPath(),t.fillRect(r,u,s-r,y-u),"quadrant"==this.name?t.fillRect(r,p,s-r,f-p):"tirone"==this.name&&t.fillRect(r,d,s-r,g-d),t.globalAlpha=1,this.highlighted){var S="p0"==this.highlighted,C="p1"==this.highlighted;this.littleCircle(t,r,m,S),this.littleCircle(t,s,m,C)}else this.pixelX=[r,s],this.pixelY=[u,y],a.yAxis.flipped&&this.pixelY.reverse(),this.pixelY.push(m)}}},intersected:function(t,i,a){if(!this.pixelX||!this.pixelY)return null;var r=this.repositionIntersection(t,i);if(r)return r;for(var s=0;s<2;s++)if(this.pointIntersection(this.pixelX[s],this.pixelY[2],a,!0))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(null,null,a)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.field=e.fld,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,fld:this.field}}},!0),e.Drawing.tirone=function(){this.name="tirone"},e.Drawing.tirone.ciqInheritsFrom(e.Drawing.quadrant),t},__js_advanced_equations_=function(t){var e=t.CIQ;
/*!
	 Based on ndef.parser, by Raphael Graf(r@undefined.ch)
	 http://www.undefined.ch/mparser/index.html
	 Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)
	 You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
	 to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
	 but don't feel like you have to let me know or ask permission.
	*/return e.formatEquation=function(t){for(var e="",i=[],a="",r=!1,s=1;s<t.length;s++){var n=t[s].toUpperCase();"["!=n||r?"]"==n&&r?(r=!1,""!==a&&(i.push(a),e+="["+a+"]"),a=""):r?a+=n:"+"==n||"-"==n||"*"==n||"/"==n||":"==n||"%"==n||"("==n||")"==n?(""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,":"==n&&(n="/"),e+=n,a=""):" "!=n&&(a+=n):r=!0}return""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,{equation:e,symbols:i}},e.fetchEquationChart=function(t,i){var a=e.formatEquation(t.symbol),r=a.symbols,s=[],n=t.stx;t.stx=null;for(var o=0;o<r.length;o++){var l=e.shallowClone(t);l.stx=n,l.symbol=r[o],s.push(l)}t.stx=n,n.quoteDriver.quoteFeed.multiFetch(s,function(r){var n={};t.loadMoreReplace=!0;for(var o={charge:0},l=0;l<r.length;l++){var h=r[l];if(h.dataCallback.error)return void i({error:h.dataCallback.error});n[h.params.symbol]=h.dataCallback.quotes,t.loadMoreReplace=t.loadMoreReplace&&h.params.loadMoreReplace,t.moreToLoad=t.moreToLoad||h.dataCallback.moreAvailable;var c=h.dataCallback.attribution;c.charge&&(o.charge+=c.charge),o.source=c.source,void 0===o.exchange?o.exchange=c.exchange:o.exchange!=c.exchange&&(o.exchange="")}if(s.length||!t.loadMore&&!t.update)try{var u=e.computeEquationChart(a.equation,n);i({quotes:u,moreAvailable:t.moreToLoad,attribution:o})}catch(t){var p={error:"Invalid equation: "+a.equation};t.name&&"NoException"==t.name&&(p.suppressAlert=!0),i(p)}})},e.computeEquationChart=function(t,i){t=t.replace(/[:]/,"/").toUpperCase();var a=0;for(var r in i){var s=new RegExp("\\["+r.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/[+\-*\/%()]/g,"\\$&")+"\\]","g");t=t.replace(s,"symbol"+a),a++}var n,o=function(){function t(t){function e(){}return e.prototype=t,new e}var i=0,a=1,r=2,s=3,n=4;function o(t,e,o,l){this.type_=t,this.index_=e||0,this.prio_=o||0,this.number_=null!=l?l:0,this.toString=function(){switch(this.type_){case i:return this.number_;case a:case r:case s:return this.index_;case n:return"CALL";default:return"Invalid Token"}}}function l(t,e,i,a){this.tokens=t,this.ops1=e,this.ops2=i,this.functions=a}var h=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function u(t,e){return Number(t)+Number(e)}function p(t,e){return t-e}function d(t,e){return t*e}function m(t,e){return t/e}function g(t,e){return t%e}function f(t,e){return""+t+e}function y(t,e){return t==e}function v(t,e){return t!=e}function x(t,e){return t>e}function b(t,e){return t<e}function S(t,e){return t>=e}function C(t,e){return t<=e}function w(t,e){return Boolean(t&&e)}function T(t,e){return Boolean(t||e)}function k(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function D(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function M(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function A(t){return Math.asinh?Math.asinh(t):t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function F(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function P(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function _(t){return Math.log(t)*Math.LOG10E}function E(t){return-t}function L(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function N(t){return Math.random()*(t||1)}function R(t){for(var e=t=Math.floor(t);t>1;)e*=--t;return e}function O(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)}function I(t,e,i){return t?e:i}function H(t,e){return"[object Array]"!=Object.prototype.toString.call(t)?[t,e]:((t=t.slice()).push(e),t)}function z(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:k,cosh:D,tanh:M,asinh:A,acosh:F,atanh:P,sqrt:Math.sqrt,log:Math.log,lg:_,log10:_,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,"-":E,exp:Math.exp},this.ops2={"+":u,"-":p,"*":d,"/":m,"%":g,"^":Math.pow,",":H,"||":f,"==":y,"!=":v,">":x,"<":b,">=":S,"<=":C,and:w,or:T},this.functions={random:N,fac:R,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:I},this.consts={E:Math.E,PI:Math.PI}}e.extend(l.prototype,{simplify:function(e){e=e||{};var n,h,c,u,p=[],d=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)p.push(u);else if(f===s&&u.index_ in e)u=new o(i,0,0,e[u.index_]),p.push(u);else if(f===r&&p.length>1)h=p.pop(),n=p.pop(),c=this.ops2[u.index_],u=new o(i,0,0,c(n.number_,h.number_)),p.push(u);else if(f===a&&p.length>0)n=p.pop(),c=this.ops1[u.index_],u=new o(i,0,0,c(n.number_)),p.push(u);else{for(;p.length>0;)d.push(p.shift());d.push(u)}}for(;p.length>0;)d.push(p.shift());return new l(d,t(this.ops1),t(this.ops2),t(this.functions))},substitute:function(e,i){i instanceof l||(i=(new z).parse(String(i)));var a,r=[],n=this.tokens.length,h=0;for(h=0;h<n;h++){if((a=this.tokens[h]).type_===s&&a.index_===e)for(var c=0;c<i.tokens.length;c++){var u=i.tokens[c],p=new o(u.type_,u.index_,u.prio_,u.number_);r.push(p)}else r.push(a)}return new l(r,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t){t=t||{};var e,o,l,h,c=[],u=this.tokens.length,p=0;for(p=0;p<u;p++){var d=(h=this.tokens[p]).type_;if(d===i)c.push(h.number_);else if(d===r)o=c.pop(),e=c.pop(),l=this.ops2[h.index_],c.push(l(e,o));else if(d===s)if(h.index_ in t)c.push(t[h.index_]);else{if(!(h.index_ in this.functions))throw new Error("undefined variable: "+h.index_);c.push(this.functions[h.index_])}else if(d===a)e=c.pop(),l=this.ops1[h.index_],c.push(l(e));else{if(d!==n)throw new Error("invalid Expression");if(e=c.pop(),!(l=c.pop()).apply||!l.call)throw new Error(l+" is not a function");"[object Array]"==Object.prototype.toString.call(e)?c.push(l.apply(void 0,e)):c.push(l.call(void 0,e))}}if(c.length>1)throw new Error("invalid Expression (parity)");return c[0]},toString:function(t){var e,o,l,u,p,d=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)d.push("string"==typeof(p=u.number_)?(h.lastIndex=0,h.test(p)?"'"+p.replace(h,function(t){var e=c[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+p+"'"):p);else if(f===r)o=d.pop(),e=d.pop(),l=u.index_,t&&"^"==l?d.push("Math.pow("+e+","+o+")"):d.push("("+e+l+o+")");else if(f===s)d.push(u.index_);else if(f===a)e=d.pop(),"-"===(l=u.index_)?d.push("("+l+e+")"):d.push(l+"("+e+")");else{if(f!==n)throw new Error("invalid Expression");e=d.pop(),l=d.pop(),d.push(l+"("+e+")")}}if(d.length>1)throw new Error("invalid Expression (parity)");return d[0]},variables:function(){for(var t=this.tokens.length,e=[],i=0;i<t;i++){var a=this.tokens[i];a.type_===s&&-1==e.indexOf(a.index_)&&e.push(a.index_)}return e}},!0),z.parse=function(t){return(new z).parse(t)},z.evaluate=function(t,e){return z.parse(t).evaluate(e)},z.Expression=l,z.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:k,cosh:D,tanh:M,asinh:A,acosh:F,atanh:P,sqrt:Math.sqrt,log:Math.log,lg:_,log10:_,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,random:N,fac:R,exp:Math.exp,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:I,E:Math.E,PI:Math.PI};return e.extend(z.prototype,{parse:function(e){this.errormsg="",this.success=!0;var h=[],c=[];this.tmpprio=0;var u=77,p=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;){var d;if(this.isOperator())this.isSign()&&64&u?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",p++,this.addfunc(c,h,a)),u=77):this.isComment()||(0==(2&u)&&this.error_parsing(this.pos,"unexpected operator"),p+=2,this.addfunc(c,h,r),u=77);else if(this.isNumber())0==(1&u)&&this.error_parsing(this.pos,"unexpected number"),d=new o(i,0,0,this.tokennumber),c.push(d),u=50;else if(this.isString())0==(1&u)&&this.error_parsing(this.pos,"unexpected string"),d=new o(i,0,0,this.tokennumber),c.push(d),u=50;else if(this.isLeftParenth())0==(8&u)&&this.error_parsing(this.pos,'unexpected "("'),128&u&&(p+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(c,h,n)),u=333;else if(this.isRightParenth())256&u?(d=new o(i,0,0,[]),c.push(d)):0==(16&u)&&this.error_parsing(this.pos,'unexpected ")"'),u=186;else if(this.isComma())0==(32&u)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(c,h,r),p+=2,u=77;else if(this.isConst()){0==(1&u)&&this.error_parsing(this.pos,"unexpected constant");var m=new o(i,0,0,this.tokennumber);c.push(m),u=50}else if(this.isOp2())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,r),p+=2,u=8;else if(this.isOp1())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,a),p++,u=8;else if(this.isVar()){0==(1&u)&&this.error_parsing(this.pos,"unexpected variable");var g=new o(s,this.tokenindex,0,0);c.push(g),u=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');h.length>0;){var f=h.pop();c.push(f)}return p+1!==c.length&&this.error_parsing(this.pos,"parity"),new l(c,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t,e){return this.parse(t).evaluate(e)},error_parsing:function(t,e){throw this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,this.column=t,new Error(this.errormsg)},addfunc:function(t,e,i){for(var a=new o(i,this.tokenindex,this.tokenprio+this.tmpprio,0);e.length>0&&a.prio_<=e[e.length-1].prio_;)t.push(e.pop());e.push(a)},isNumber:function(){for(var t=!1,e="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(i>=48&&i<=57||46===i))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},unescape:function(t,e){for(var i=[],a=!1,r=0;r<t.length;r++){var s=t.charAt(r);if(a){switch(s){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var n=parseInt(t.substring(r+1,r+5),16);i.push(String.fromCharCode(n)),r+=4;break;default:throw this.error_parsing(e+r,"Illegal escape sequence: '\\"+s+"'")}a=!1}else"\\"==s?a=!0:i.push(s)}return i.join("")},isString:function(){var t=!1,e="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=e.slice(-1)){this.pos++,this.tokennumber=this.unescape(e,i),t=!0;break}e+=this.expression.charAt(this.pos),this.pos++}return t},isConst:function(){for(var t in this.consts){var e=t.length;if(t===this.expression.substr(this.pos,e))return this.tokennumber=this.consts[t],this.pos+=e,!0}return!1},isOperator:function(){var t=this.expression.charCodeAt(this.pos);if(43===t)this.tokenprio=2,this.tokenindex="+";else if(45===t)this.tokenprio=2,this.tokenindex="-";else if(62===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex=">="):(this.tokenprio=1,this.tokenindex=">");else if(60===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex="<="):(this.tokenprio=1,this.tokenindex="<");else if(124===t){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="||"}else if(61===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="=="}else if(33===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="!="}else if(97===t){if(110!==this.expression.charCodeAt(this.pos+1)||100!==this.expression.charCodeAt(this.pos+2))return!1;this.pos++,this.pos++,this.tokenprio=0,this.tokenindex="and"}else if(111===t){if(114!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="or"}else if(42===t||8729===t||8226===t)this.tokenprio=3,this.tokenindex="*";else if(47===t)this.tokenprio=4,this.tokenindex="/";else if(37===t)this.tokenprio=4,this.tokenindex="%";else{if(94!==t)return!1;this.tokenprio=5,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var t=this.expression.charCodeAt(this.pos-1);return 45===t||43===t},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var t=this.expression.charCodeAt(this.pos);return(32===t||9===t||10===t||13===t)&&(this.pos++,!0)},isOp1:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops1&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isOp2:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops2&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isVar:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},!0),z}().parse(t),l=[],h={},c=0,u=null,p=!1,d=[];for(r in i){var m={sym:r,map:i[r]};i[r]?d.unshift(m):d.push(m)}for(var g=0;g<d.length;g++){var f=d[g];h[f.sym]={i:0,s:f.sym},f.map?(c++,n=f.map[0]):1==c&&(p=f.sym),n.DT||(n.DT=e.strToDateTime(n.Date)),h[f.sym].d=n.DT,u||(u=h[f.sym])}var y=0===c,v=1==c&&-1==t.indexOf("%");function x(t){if(t.i++,i[t.s]){if(t.i>=i[t.s].length)return 0;n=i[t.s][t.i]}return n.DT||(n.DT=e.strToDateTime(n.Date)),t.d=n.DT,1}function b(){var t=null,e=null;for(var i in h)e?h[i].d.getTime()<e.d.getTime()?t=e=h[i]:h[i].d.getTime()>e.d.getTime()&&(t=e):e=h[i];return t?x(t)?-1:0:1}t:for(;;){var S=b();if(!S)break;if(1==S){var C;if(p){var w=i[u.s][u.i][p];w&&(w.Close||0===w.Close)&&(w=w.Close);var T=o.evaluate({symbol0:i[u.s][u.i].Close,symbol1:w});T=Number(T.toFixed(8)),(C={DT:u.d,Close:T,Adj_Close:T})[u.s]=i[u.s][u.i].Close,isNaN(T)||T==1/0||l.push(C)}else{if(y){var k=o.evaluate({});throw e.alert(t+"="+k),{name:"NoException",message:""}}a=0;var D={Adj_Close:{},Close:{},Open:{},High:{},Low:{},Volume:{}};for(r in i){for(var M in D)D[M]["symbol"+a]=i[r][h[r].i][M];a++}(C={DT:u.d}).Adj_Close=o.evaluate(D.Adj_Close),C.Close=o.evaluate(D.Close),C.Open=o.evaluate(D.Open),C.Volume=o.evaluate(D.Volume),isNaN(C.Volume)&&(C.Volume=0),v?(C.High=o.evaluate(D.High),C.Low=o.evaluate(D.Low)):(C.High=Math.max(C.Open,C.Close),C.Low=Math.min(C.Open,C.Close)),isNaN(C.Close)||C.Close==1/0||l.push(C),isNaN(C.High)||(C.High=Number(C.High.toFixed(8))),isNaN(C.Low)||(C.Low=Number(C.Low.toFixed(8))),isNaN(C.Open)||(C.Open=Number(C.Open.toFixed(8))),isNaN(C.Close)||(C.Close=Number(C.Close.toFixed(8))),isNaN(C.Adj_Close)?C.Adj_Close=C.Close:C.Adj_Close=Number(C.Adj_Close.toFixed(8))}for(r in i)if(!x(h[r]))break t}}return l},t},__js_advanced_highPerformanceMarkers_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.removeDOMMarker=function(t){console.warn("CIQ.ChartEngine#removeDOMMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance#remove instead."),e.Marker.Performance.prototype.removeDOMMarker.call(t.params.node,t)},e.ChartEngine.prototype.drawMarkers=function(){console.warn("CIQ.ChartEngine#drawMarkers is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkers instead."),e.Marker.Performance.drawMarkers(this)},e.ChartEngine.prototype.calculateMarkerStyles=function(t,i){console.warn("CIQ.ChartEngine#calculateMarkerStyles is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.calculateStyles instead."),e.Marker.Performance.calculateMarkerStyles(this,t,i)},e.ChartEngine.prototype.drawCircleMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawCircleMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawCircleMarker instead."),e.Marker.Performance.drawCircleMarker(t,i,a)},e.ChartEngine.prototype.drawSquareMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawSquareMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawSquareMarker instead."),e.Marker.Performance.drawSquareMarker(t,i,a)},e.ChartEngine.prototype.drawCalloutMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawCalloutMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawCalloutMarker instead."),e.Marker.Performance.drawCalloutMarker(t,i,a)},e.ChartEngine.prototype.drawMarkerStem=function(t,i,a){console.warn("CIQ.ChartEngine#drawMarkerStem is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkerStem instead."),e.Marker.Performance.drawMarkerStem(t,i,a)},e.ChartEngine.prototype.positionDOMMarkers=function(){console.warn("CIQ.ChartEngine#positionDOMMarkers is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkers instead."),e.Marker.Performance.drawMarkers(this)},e.Marker.Performance=function(t){this.params={displayCategory:!0,displayStem:!0,story:"",headline:""},e.extend(this.params,t);var i=this.template=document.createElement("TEMPLATE");i.innerHTML='<div class="stx-marker highlight"><div class="stx-visual"><div class="stx-marker-content"><div class="stx-marker stx-performance-marker stx-marker-expand"><h4></h4><p></p></div></div></div><div class="stx-stem"></div></div>';var a=this.template.content.cloneNode(!0),r=a.querySelector(".stx-marker",i);r.classList.add(t.type),r.classList.add(t.category);var s=a.querySelector(".stx-visual",i),n=a.querySelector(".stx-marker-expand"),o=a.querySelector("h4",i),l=a.querySelector("p",i);if(o.innerText=this.params.headline,l.innerText=this.params.story,this.hasText=!!t.headline||!!t.story,this.deferAttach=!0,this.node=a.firstChild,this.node.params=this.params,this.visual=s,this.expand=n,"callout"===t.type){var h=n.removeChild(o);a.querySelector(".stx-marker-content",i).insertBefore(h,n)}},e.Marker.Performance.ciqInheritsFrom(e.Marker.NodeCreator,!1),e.Marker.Performance.consolidateExpanded=function(t){var e=t.markerHelper.highlighted;if(e.length){var i,a,r=e[e.length-1],s=r.params.node;r.consolidated||(r.consolidated=[]);for(var n=e.length-2;n>=0;n--){var o=(i=e[n],a=void 0,"none"!==(a=i.params.node.expand).style.display?a.innerHTML:""),l="<consolidated>"+o+"</consolidated>";o.length&&(s.expand.innerHTML+=l)}r.stxNodeCreator.quickCache(r)}},e.Marker.Performance.reconstituteExpanded=function(t){var e=t.markerHelper.highlighted;if(e.length&&t.activeMarker)for(var i=(e=[t.activeMarker]).length-1;i>=0;i--)for(var a=e[i].params.node.expand;"CONSOLIDATED"===a.lastElementChild.nodeName;)a.removeChild(a.lastElementChild)},e.Marker.Performance.drawMarkers=function(t){for(var e=t.getMarkerArray("all"),i=t.chart,a=0;a<e.length;a++){var r=e[a],s=r.stxNodeCreator,n=i.dataSegment[0].tick,o=i.dataSegment[i.dataSegment.length-1].tick;n<=r.tick<=o&&s&&s.drawMarker&&s.drawMarker(r)}},e.Marker.Performance.calculateMarkerStyles=function(t,e,i){var a=document.querySelector(".stx-marker-templates");a||((a=document.createElement("DIV")).style.visibility="hidden",a.style.left="-1000px",document.body.append(a)),a.appendChild(e.node);var r=getComputedStyle(e.stxNodeCreator.visual);if(!t.styles.stx_marker_stem){var s=getComputedStyle(document.querySelector(".stx-stem",e.node));t.styles.stx_marker_stem=t.cloneStyle(s)}t.styles[i]=t.cloneStyle(r),a.removeChild(e.node)},e.Marker.Performance.drawCircleMarker=function(t,i,a){var r=t.params.stx.chart.context,s=a.x,n=a.y,o=a.radius,l=a.label,h=a.color?a.color:i.backgroundColor;r.beginPath(),r.setLineDash([]),r.lineWidth=1,r.fillStyle=h,r.strokeStyle=h,r.font="normal bold 12px Roboto, Helvetica, sans-serif",r.arc(s,n,o,0,2*Math.PI,!1),r.fill(),r.stroke(),r.closePath(),l&&(r.fillStyle=e.colorsEqual("white",r.fillStyle)?"black":"white",r.fillText(l.charAt(0).toUpperCase(),s-4,n+1)),(t.highlight||t.active)&&(r.beginPath(),r.arc(s,n,o+4,0,2*Math.PI,!1),r.stroke(),r.closePath())},e.Marker.Performance.drawSquareMarker=function(t,i,a){var r=t.params.stx.chart.context,s=a.x,n=a.y,o=a.half,l=a.label,h=a.color?a.color:i.backgroundColor,c=2*o;r.beginPath(),r.setLineDash([]),r.lineWidth=1,r.fillStyle=h,r.strokeStyle=h,r.font="normal bold 12px Roboto, Helvetica, sans-serif",r.rect(s-o,n-o,c,c),r.fill(),(t.highlight||t.active)&&r.rect(s-o-4,n-o-4,c+8,c+8),r.stroke(),r.closePath(),l&&(r.fillStyle=e.colorsEqual("white",r.fillStyle)?"black":"white",r.fillText(l.charAt(0).toUpperCase(),s-4,n+1))},e.Marker.Performance.drawCalloutMarker=function(t,e,i){var a=t.params.stx.chart.context,r=t.params,s=(i.x,i.y),n=i.half,o=i.midWidth,l=i.headline,h=i.color?i.color:e.backgroundColor,c=2*n||25,u=Math.round(a.measureText(l).width),p=o?2*o:u+8;a.beginPath(),a.setLineDash([]),a.lineWidth=1,a.fillStyle=h,a.strokeStyle=h,a.font="normal bold 12px Roboto, Helvetica, sans-serif",a.rect(r.box.x0,r.box.y0,p,c),a.fill(),a.stroke(),a.closePath(),a.beginPath(),a.fillStyle=t.highlight||t.active?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.65)";var d=(p-(u+20))/2;a.rect(r.box.x0+d,s-n,u+40,22),a.fill(),a.stroke(),a.closePath(),a.fillStyle="black",a.fillText(l,r.box.x0+d+10,s)},e.Marker.Performance.drawMarkerStem=function(t,i,a){var r=t.params.stx.chart.context,s=a.x;a.y;r.beginPath(),r.strokeStyle=i.borderLeftColor,r.setLineDash([1,1]),r.moveTo(s,t.params.box.y1),r.lineTo(s,t.params.box.y1+e.stripPX(i.height)),r.stroke(),r.closePath()},e.Marker.Performance.prototype.drawMarker=function(t){var i=t.params,a=t.params.stx;if(a&&a.chart.dataSegment.length){var r=a.panels[t.params.panelName],s=t.stxNodeCreator.params,n=s.type,o=s.category,l=s.headline,h=s.displayCategory,c=s.color,u="stx_marker_"+n+"_"+o;a.styles[u]||e.Marker.Performance.calculateMarkerStyles(a,t,u);var p=t.style=a.styles[u],d=a.styles.stx_marker_stem,m=parseInt(p.height,10)/2,g=parseInt(p.width,10)/2,f=s.displayStem?parseInt(d.height,10)+parseInt(d.marginBottom,10):0,y=f+parseInt(p.height,10),v=f?f+m:0,x=a.pixelFromDate(i.x),b=i.node.calculateYPosition({marker:t,panel:r,height:y,half:m,offset:v});i.box={x0:x-(g||m),y0:b-m,x1:x+(g||m),y1:b+m,midY:m,midX:g||m,stemHeight:f},h||(o=h),a.startClip(r.name),"circle"===n?e.Marker.Performance.drawCircleMarker(t,p,{x:x,y:b,radius:m,label:o,color:c}):"square"===n?e.Marker.Performance.drawSquareMarker(t,p,{x:x,y:b,half:m,label:o,color:c}):"callout"===n?e.Marker.Performance.drawCalloutMarker(t,p,{x:x,y:b,half:m,midWidth:g,headline:l,color:c}):console.warn("Marker type: "+n+" is unsupported with canvas markers!\nSupported Styles are Square, Circle, and Callout."),s.displayStem&&e.Marker.Performance.drawMarkerStem(t,d,{x:x,y:b}),a.endClip(),t.attached&&this.positionPopUpNode(t)}},e.Marker.Performance.prototype.positionPopUpNode=function(t){if(t.attached){var e=t.params,i=e.stx,a=e.box,r=t.params.node.expand,s=i.chart.dataSet,n=i.chart.dataSegment,o=[s[n[0]&&n[0].tick-1],s[n[0]&&n[0].tick-2]],l=i.getFirstLastDataRecord(o.concat(n),"Date"),h=[s[n[n.length-1].tick+1],s[n[n.length-1].tick+2]],c=i.getFirstLastDataRecord(n.concat(h),"Date",!0),u=l.DT<=s[t.tick].DT&&s[t.tick].DT<=c.DT;if(t.highlight||t.active||(u=!1),r.style.visibility=u?"":"hidden",u){var p=i.panels[e.panelName],d=r.rects,m=d.height/2,g=a.x0+d.width>p.width?a.x0-d.width:a.x1,f=a.y0-m>=p.top?a.y0+a.midY-m:a.y0;a.y1+a.stemHeight===p.yAxis.bottom&&d.height>a.y1-a.y0+a.stemHeight&&(f=a.y1-d.height+a.stemHeight);var y="translateX("+Math.floor(g)+"px) translateY("+Math.floor(f)+"px) translateZ(0)";r.style.transform=y,r.transform={translateX:g,translateY:f}}}},e.Marker.Performance.prototype.quickCache=function(t){var i=t.params.node.expand,a=t.style,r=e.stripPX(a.marginLeft)+e.stripPX(a.marginRight)+e.stripPX(a.borderRight)+e.stripPX(a.borderLeft);i.rects=i.getBoundingClientRect(),i.scrollBarWidth=i.rects.width-i.clientWidth-r},e.Marker.Performance.prototype.calculateYPosition=function(t){var e,i=t.marker,a=t.panel,r=t.height,s=t.half,n=t.offset,o=i.params.stx,l=o.chart,h=o.highLowBars[o.layout.chartType],c=l.dataSet[i.tick],u=h?c.High:c.Close;switch(i.params.yPositioner){case"value":e=i.params.y||0===i.params.y?o.pixelFromPrice(i.params.y,a)-.5*r+s:o.pixelFromPrice(u,a)-n;break;case"above_candle":e=o.pixelFromPrice(u,a)-n;break;case"below_candle":e=o.pixelFromPrice(c.Low||u,a)+s;break;case"on_candle":var p=c.High||c.Close,d=c.Low||0===c.Low||c.Close;e=o.pixelFromPrice((p+d)/2,a)-.5*r+s;break;case"top":e=s;break;case"bottom":e=o.pixelFromPrice(a.yAxis.low,a)-(n||s)}return e},e.Marker.Performance.prototype.prepareForHolder=function(t){var e=this.expand,i=t.params.stx;return e.classList.add(this.params.type),i.markerHelper.domMarkers.push(t),e},e.Marker.Performance.prototype.addToHolder=function(t){var i=this.expand,a=t.params.stx;function r(e){a.activeMarker=t,a.activeMarker.click(e.clientX,e.clientY,a.activeMarker,a.currentPanel),e.stopPropagation()}i.addEventListener("mousedown",r),i.addEventListener("touchstart",r),i.clickClosure=r,e.Marker.Performance.reconstituteExpanded(a),e.Marker.Performance.consolidateExpanded(a),this.quickCache(t)},e.Marker.Performance.prototype.remove=function(t){var e=t.params.stx;if(e&&e.markerHelper.domMarkers){var i=e.markerHelper.domMarkers.indexOf(t);if(-1!=i&&e.markerHelper.domMarkers.splice(i,1),t.attached){var a=e.panels[t.params.panelName],r=t.params.node.expand;r.parentNode===a.subholder&&a.subholder.removeChild(r),r.removeEventListener("click",r.clickClosure)}}},e.Marker.Performance.prototype.click=function(t,e,i,a){if(this.hasText){var r,s=i.params.stx;if(i.attached){var n=this.expand;if(n.rects.width-n.scrollBarWidth+n.transform.translateX<s.backOutX(t)&&s.backOutX(t)<n.rects.width+n.transform.translateX)return;this.remove(i)}else s.addToHolder(i),r=!0;i.attached=!i.attached,i.active=!i.active,r&&i.stxNodeCreator.positionPopUpNode(i)}},t},__js_advanced_renderersAdvanced_=function(t){var e=t.CIQ;return e.Renderer.Shading=function(t){this.construct(t),this.beenSetup=!1,this.errTimeout=null,this.params.useChartLegend=!1,this.shading=[],"rangechannel"==this.params.type&&(this.highLowBars=!0)},e.Renderer.Shading.ciqInheritsFrom(e.Renderer.Lines,!1),e.Renderer.Shading.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"rangechannel"==t[r]&&(a="rangechannel")}return null===a?null:new e.Renderer.Shading({params:e.extend(i,{type:a})})},e.Renderer.Shading.prototype.setShading=function(t){t.constructor!=Array&&(t=[t]),this.shading=t},e.Renderer.Shading.prototype.draw=function(){var t=this.stx,i=t.panels[this.params.panel].chart;if("rangechannel"==this.params.type)if(this.beenSetup)this.seriesParams.length>2&&this.removeSeries(this.seriesParams[2].id);else{this.beenSetup=!0,this.params.display=this.seriesParams[0].display,this.params.yAxis=this.seriesParams[0].yAxis;var a=this.seriesParams[0].color||"auto",r=this.seriesParams[0].symbol;r&&r+".",this.removeAllSeries(!0);var s=this.params.name;t.addSeries(null,{symbol:r,loadData:!!r,field:"High",renderer:"Shading",name:s,style:"stx_line_up",display:this.params.display}),t.addSeries(null,{symbol:r,loadData:!!r,field:"Low",renderer:"Shading",name:s,style:"stx_line_down",display:this.params.display}),this.setShading({primary:this.seriesParams[0].id,secondary:this.seriesParams[1].id,color:a})}if(!this.shading&&!this.errTimeout){console.log("Warning: no shading scheme set.  Use myRenderer.setShading(scheme) to set.");var n=this;this.errTimeout=setTimeout(function(){n.errTimeout=null},1e4)}var o,l={};for(o=0;o<this.seriesParams.length;o++){var h={};i.series[this.seriesParams[o].id]&&(h=e.clone(i.series[this.seriesParams[o].id].parameters)),l[this.seriesParams[o].id]={parameters:e.extend(e.extend(h,this.params),this.seriesParams[o]),yValueCache:this.caches[this.seriesParams[o].id]}}if(t.drawSeries(i,l,this.params.yAxis,this),i.legend&&"rangechannel"==this.params.type){i.legend.colorMap||(i.legend.colorMap={});var c=this.params.display,u=[t.getCanvasColor("stx_line_up"),t.getCanvasColor("stx_line_down")];i.legend.colorMap[c]={color:u,display:c,isBase:this==t.mainSeriesRenderer}}for(o in l)this.caches[o]=l[o].yValueCache;function p(t){var e=l[t];if(e){var i=e.parameters.field,a=e.parameters.subField;return i+(a?"."+a:"")}return t}for(o=0;o<this.shading.length;o++){var d=this.shading[o],m=d.color;if("auto"==d.color&&(m=t.defaultColor),d.primary||(d.primary="Close"),!d.secondary&&this.seriesParams[0]&&(d.secondary=this.seriesParams[0].field),d.secondary&&(l[d.primary]||"Close"==d.primary)&&l[d.secondary]&&("Close"!=d.primary||!this.params.yAxis||this.params.yAxis==i.yAxis)){var g=p(d.primary).split("."),f=p(d.secondary).split("."),y={topBand:g[0],topSubBand:g[1],topColor:d.greater||m||t.containerColor,topAxis:this.params.yAxis,bottomBand:f[0],bottomSubBand:f[1],bottomColor:d.lesser||m||t.containerColor,bottomAxis:"Close"==d.primary?null:this.params.yAxis,tension:this.params.tension||i.tension,opacity:.1};(y.topColor||y.bottomColor)&&(!this.params.highlight&&t.highlightedDraggable&&(y.opacity*=.3),e.fillIntersecting(t,this.params.panel,y))}}},e.Renderer.Histogram=function(t){this.construct(t),this.params.type="histogram",this.barsHaveWidth=this.standaloneBars=!0,this.params.yAxis&&(this.params.bindToYAxis=!0)},e.Renderer.Histogram.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Histogram.prototype.adjustYAxis=function(){this.params.yAxis&&(this.params.yAxis.min=0,this.params.yAxis.highValue/=this.params.heightPercentage||1)},e.Renderer.Histogram.prototype.draw=function(){var t=e.clone(this.params);t.type=t.subtype,this.useSum="stacked"==t.subtype,this.stx.drawHistogram(t,this.seriesParams)},e.Renderer.Histogram.prototype.getBasis=function(t,e,i){var a=0;if(t&&this.useSum)for(var r=0;r<this.seriesParams.length;r++){var s=this.seriesParams[r].field;if(s===e)break;var n=t[s];n&&"object"===_typeof(n)&&(n=n[i||this.seriesParams[r].subField||this.stx.chart.defaultPlotField||"Close"]),n&&(a+=n)}return a},e.Renderer.Heatmap=function(t){this.construct(t),this.params.type="heatmap",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0},e.Renderer.Heatmap.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Heatmap.prototype.draw=function(){this.stx.drawHeatmap(e.clone(this.params),this.seriesParams)},e.Renderer.Scatter=function(t){this.construct(t),this.standaloneBars=this.barsHaveWidth=!0},e.Renderer.Scatter.ciqInheritsFrom(e.Renderer.Lines,!1),e.Renderer.Scatter.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"scatterplot"==t[r]&&(a="scatter")}return null===a?null:new e.Renderer.Scatter({params:e.extend(i,{type:a})})},e.Renderer.Scatter.prototype.drawIndividualSeries=function(t,e){var i=this.stx.panels[e.panel]||t.panel,a={colors:[]};return this.stx.scatter?a=this.stx.scatter(i,e):console.warn("Error, Scatter renderer requires customChart.js"),a},t},__js_advanced_share_=function(t){var e,i=t.CIQ;function a(t,a,r){a||(a={});var s=document.querySelector("body");if(a.hide&&a.hide instanceof Array)for(var n=a.hide.join(", "),o=document.querySelectorAll(n),l=0;l<o.length;l++)i.appendClassName(o[l],"ciq-no-share");i.appendClassName(s,"sharing"),e(t.chart.container,{allowTaint:!1,logging:!1,width:a.width||null,height:a.height||null,backgroundColor:a.background||null,useCORS:!0}).then(function(t){r&&r(null,a.data?t.toDataURL("image/png"):t),i.unappendClassName(s,"sharing")}).catch(function(t){r&&r(t),i.unappendClassName(s,"sharing")})}return i.Share=function(){},t.STXSocial=i.Share,i.Share.FullChart2PNG=function(t,r,s){if(t&&t.chart){if("undefined"==typeof html2canvas)return function(t){if("undefined"!=typeof html2canvas)return e=html2canvas,t();if("undefined"!=typeof requirejs)try{return requirejs(["html2canvas"],function(i){return e=i,t()})}catch(t){console.warn("Require loading has failed, attempting to load html2canvas manually.")}i.loadScript(function(){if(i.Share.html2canvasLocation)return i.Share.html2canvasLocation;for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var a=t[e];if(a.src&&a.src.indexOf("share.js")>-1)return a.src.replace(/advanced\/share\.js/,"")+"thirdparty/"}return"js/thirdparty/"}()+"/html2canvas.js",function(){return e=html2canvas,t()})}(function(){return a(t,r,s)});e=html2canvas,a(t,r,s)}},i.Share.createImage=function(t,e,a){var r=[].slice.call(arguments);a=r.pop(),null!==e&&"object"==_typeof(e)||(e={widthPX:r[1],heightPX:r[2],imageType:r[3]});var s=e.widthPX,n=e.heightPX,o=e.imageType,l=t.chart.canvas.height,h=t.chart.canvas.width;t.chart.canvas.style.height&&(l=i.stripPX(t.chart.canvas.style.height),h=i.stripPX(t.chart.canvas.style.width)),s&&n?(l=n,h=s):n?h=t.chart.canvas.width*(l/t.chart.canvas.height):s&&(h=s,l=t.chart.canvas.height*(s/t.chart.canvas.width));var c=o?"image/"+o:"image/png",u=document.createElement("img");u.onload=function(){i.Share.FullChart2PNG(t,{image:this,width:h,height:l,hide:e.hide},function(t,e){try{a(e.toDataURL(c))}catch(t){console.warn("Safari devices do not handle CORS enabled images. Using the charts' canvas as a fallback."),a(u.src)}})},u.src=t.chart.canvas.toDataURL(c)},i.Share.uploadImage=function(t,e,a,r){a||(a={}),a.image=t,i.postAjax(e,JSON.stringify(a),function(t,e){200==t?r(null,e):r(t,null)})||r(0,null)},i.Share.shareChart=function(t,e,a){i.Share.createImage(t,{},function(r){var s=i.uniqueID(),n="https://share.chartiq.com",o=n+"/upload/"+s;e&&(e.host&&(n=e.host),e.path&&(o=n+e.path+"/"+s));var l=t.getStartDateOffset(),h={id:s,image:r,config:{layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:l,startDate:t.chart.dataSegment[l].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:s,symbol:t.chart.symbol}};i.Share.uploadImage(r,o,h,function(t,e){null!==t?i.alert("error sharing chart: ",t):a(n+e)})})},t},__js_advanced_studiesAdvanced_=function(t){var e=t.CIQ;return e.Studies.calculateValuationLines=function(t,e,i){for(var a="field"==e.inputs.Field?"Close":e.inputs.Field,r=e.inputs["Average Type"],s=e.inputs["Display Average"],n=e.inputs["Display 1 Standard Deviation (1σ)"],o=e.inputs["Display 2 Standard Deviation (2σ)"],l=e.inputs["Display 3 Standard Deviation (3σ)"],h=[],c=0;c<i.length;++c)i[c]&&h.push(i[c][a]);var u=function(t,e){var i=t.length,a=0,r=0,s=0;switch(e){case"mean":for(r=i;s<i;++s)a+=t[s];break;case"harmonic":for(a=i;s<i;++s)r+=1/t[s];break;case"median":var n=Math.floor(i/2),o=t.slice().sort(function(t,e){return t>e?1:t<e?-1:0});i%2==0?(a=o[n]+o[n-1],r=2):(a=o[n],r=1)}return a/r}(h,r),p=!(n||o||l)||function(t,e){for(var i=t.length,a=0,r=0;r<i;++r)a+=Math.pow(t[r]-e,2);return Math.sqrt(a/i)}(h,u);e.data={Average:s?[u]:null,"1 Standard Deviation (1σ)":n?[u+p,u-p]:null,"2 Standard Deviation (2σ)":o?[u+2*p,u-2*p]:null,"3 Standard Deviation (3σ)":l?[u+3*p,u-3*p]:null};var d=p;if(e.parameters||(e.parameters={}),l?e.parameters.range=[u-3*p-d,u+3*p+d]:o?e.parameters.range=[u-2*p-d,u+2*p+d]:n?e.parameters.range=[u-p-d,u+p+d]:s&&(e.parameters.range=[u-d,u+d]),e.panel){var m=t.panels[e.panel],g=t.getYAxisByName(m,e.name);if(g){g.decimalPlaces=m.chart.yAxis.printDecimalPlaces;var f={yAxis:g};t.calculateYAxisRange(m,g,e.parameters.range[0],e.parameters.range[1]),t.createYAxis(m,f),t.drawYAxis(m,f)}}},e.Studies.displayValuationLines=function(t,i){var a,r,s,n,o,l,h,c,u,p=t.panels[i.panel],d=i.getYAxis(t),m=i.getContext(t),g=i.data,f=i.parameters.labels,y=i.inputs["Average Type"],v={mean:"AVG",median:"MED",harmonic:"HAVG"},x=t.canvasStyle("ciq-valuation-average-line"),b=t.canvasStyle("ciq-valuation-deviation-line"),S=t.getCanvasFontSize("stx_yaxis")+6;for(var C in g)if(g[C])for(a="Average"==C,r=e.Studies.determineColor(i.outputs[C]),s=g[C],n=0;n<s.length;++n)if(o=s[n],!((l=t.pixelFromPrice(o,p,d))<=p.top||l>=p.yAxis.bottom))if(u=a?{pattern:"none"!=x.borderStyle&&x.borderStyle||"solid",lineWidth:parseFloat(x.borderWidth)||1,opacity:parseFloat(x.opacity)||1,yAxis:d}:{pattern:"none"!=b.borderStyle&&b.borderStyle||"dashed",lineWidth:parseFloat(b.borderWidth)||1,opacity:parseFloat(b.opacity)||1,yAxis:d},t.plotLine(p.left,p.right,l,l,r,"line",m,p,u),"yaxis"!==f){if(!((l+=Math.floor(u.lineWidth/2))+S>=p.yAxis.bottom)){h=(a?v[y]+": ":C[0]+"σ: ")+t.formatYAxisPrice(o,p),c=m.measureText(h).width;var w=p.right-c-3;d&&"left"==d.position&&(w=p.left+3),m.strokeText(h,w,l+S/2+.5)}}else t.createYAxisLabel(p,t.formatYAxisPrice(o,p),l,r,null,m,d)},e.Studies.calculateCorrelationCoefficient=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{if(e.compare=e.inputs["Compare To"],e.compare)e.compare=[e.compare];else for(var r in e.compare=[],e.outputs={},e.outputMap={},t.chart.series){var s=t.chart.series[r];s.parameters.color&&(e.compare.push(s.display),e.outputs["Result "+s.display]=s.parameters.color,e.outputMap["Result "+s.display+" "+e.name]="Result "+s.display)}if(e.compare.length){for(var n=0;n<e.compare.length;n++)for(var o=0,l=0,h=0,c=0,u=0,p=e.compare[n],d=0,m=e.startFrom-a;m<i.length;m++)if(i[m]){var g=i[m][p];if(g&&"object"==_typeof(g)&&(g=g.Close),g||0===g||(g=m>0&&i[m-1]&&i[m-1]["_temps "+e.name].c?i[m-1]["_temps "+e.name].c:0),g&&"object"==_typeof(g)&&(g=g.Close),i[m]["_temps "+e.name]={},o+=i[m]["_temps "+e.name].b=i[m].Close,l+=i[m]["_temps "+e.name].c=g,h+=i[m]["_temps "+e.name].b2=Math.pow(i[m].Close,2),c+=i[m]["_temps "+e.name].c2=Math.pow(g,2),u+=i[m]["_temps "+e.name].bc=i[m].Close*g,d>=a){o-=i[m-a]["_temps "+e.name].b,l-=i[m-a]["_temps "+e.name].c,h-=i[m-a]["_temps "+e.name].b2,c-=i[m-a]["_temps "+e.name].c2,u-=i[m-a]["_temps "+e.name].bc;var f=h/a-Math.pow(o/a,2),y=c/a-Math.pow(l/a,2),v=(u/a-o*l/Math.pow(a,2))/Math.sqrt(f*y);i[m]["Result "+p+" "+e.name]=v}d++}}else e.error="Correlation Coefficient requires at least one comparison symbol"}},e.Studies.prettify=e.extend({"2-exponential":"dema","3-exponential":"tema",hull:"hma"},e.Studies.prettify),e.extend(e.Studies.movingAverage,{conversions:{hma:"hull",dema:"2-exponential",tema:"3-exponential"},translations:{hull:"Hull","2-exponential":"Double Exponential","3-exponential":"Triple Exponential"},typeMap:{hma:"Hull",hull:"Hull",dema:"DoubleExponential","2-exponential":"DoubleExponential",tema:"TripleExponential","3-exponential":"TripleExponential"}}),e.Studies.calculateMovingAverageHull=function(t,i){var a,r,s=i.chart.scrubbed,n=i.inputs.Field;for(n&&"field"!=n||(n="Close"),e.Studies.MA("wma",i.days,n,0,"_WMA1",t,i),e.Studies.MA("wma",Math.ceil(i.days/2),n,0,"_WMA2",t,i),a=i.startFrom-1;a>=0&&((r=s[a][n])&&"object"==_typeof(r)&&(r=r[i.subField]),!r&&0!==r);a--);for(a++;a<s.length;a++){var o=s[a];o["_MMA "+i.name]=2*o["_WMA2 "+i.name]-o["_WMA1 "+i.name]}var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);var h=Math.floor(Math.sqrt(i.days));e.Studies.MA("wma",h,"_MMA "+i.name,l,"_HMA",t,i);var c=i.name;for(var u in i.outputs)c=u+" "+c;for(a=Math.max(i.days+h-1,i.startFrom);a<s.length;a++)s[a][c]=s[a]["_HMA "+i.name]},e.Studies.calculateMovingAverageDoubleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i);var s,n,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(s=i.startFrom-1;s>=0;s--)if((n=a[s][r])&&"object"==_typeof(n)&&(n=n[i.subField]),n||0===n){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;for(s++;s<a.length;s++)if(!(s<2*(i.days-1))){var u=a[s];a[s+o]&&(a[s+o][h]=2*u["_EMA1 "+i.name]-u["_EMA2 "+i.name])}},e.Studies.calculateMovingAverageTripleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i),e.Studies.MA("ema",i.days,"_EMA2 "+i.name,0,"_EMA3",t,i);var s,n,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(s=i.startFrom-1;s>=0;s--)if((n=a[s][r])&&"object"==_typeof(n)&&(n=n[i.subField]),n||0===n){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;for(s++;s<a.length;s++)if(!(s<3*(i.days-1))){var u=a[s];a[s+o]&&(a[s+o][h]=3*u["_EMA1 "+i.name]-3*u["_EMA2 "+i.name]+u["_EMA3 "+i.name])}},e.Studies.calculateATRBands=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,a,"ATR "+i.name)},e.Studies.calculateSTARCBands=function(t,i){e.Studies.calculateStudyATR(t,i),e.Studies.MA("simple",i.inputs["MA Period"],"Close",0,"_MA",t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Multiplier,"_MA "+i.name,"ATR "+i.name)},e.Studies.calculateATRStops=function(t,i){var a=i.chart.scrubbed;if(a){e.Studies.calculateStudyATR(t,i);for(var r=i.inputs.HighLow,s=Math.max(i.startFrom-1,1);s<a.length-1;s++){var n=a[s],o=a[s-1],l=n["Buy Stops "+i.name];if(l||(l=n["Sell Stops "+i.name]),l||(l=0),n&&o){var h=n.Close,c=h,u=n["ATR "+i.name]*i.inputs.Multiplier;n.Close>l&&o.Close>l?(r&&(h=n.High),c=Math.max(l,h-u)):n.Close<=l&&o.Close<=l?(r&&(h=n.Low),c=Math.min(l,h+u)):n.Close>l?(r&&(h=n.High),c=h-u):n.Close<=l&&(r&&(h=n.Low),c=h+u),h<=c?(a[s+1]["Buy Stops "+i.name]=c,delete a[s+1]["Sell Stops "+i.name]):h>c&&(a[s+1]["Sell Stops "+i.name]=c,delete a[s+1]["Buy Stops "+i.name]),a[s+1]["All Stops "+i.name]=c}}i.referenceOutput="All Stops",i.outputMap={},i.outputMap["All Stops "+i.name]=""}},e.Studies.calculateAwesomeOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<33)i.error=!0;else{e.Studies.MA("simple",5,"hl/2",0,"_MA5",t,i),e.Studies.MA("simple",34,"hl/2",0,"_MA34",t,i);for(var r=Math.max(i.startFrom,33);r<a.length;r++)a[r]&&(a[r][i.name+"_hist"]=a[r]["_MA5 "+i.name]-a[r]["_MA34 "+i.name]);i.outputMap={},i.outputMap[i.name+"_hist"]=""}},e.Studies.calculateRelativeVolatility=function(t,i){i.days=Number(i.inputs["Smoothing Period"]);var a=Number(i.inputs["STD Period"]),r=i.chart.scrubbed;if(r.length<i.days+a)i.error=!0;else{var s=i.inputs.Field;s&&"field"!=s||(s="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=a,i.std.startFrom=i.startFrom,i.std.inputs={Field:s,"Standard Deviations":1,Type:"ma"},i.std.outputs={STD:null},e.Studies.calculateStandardDeviation(t,i.std);var n=0,o=0;i.startFrom>1&&(n=r[i.startFrom-1]["_avgG "+i.name],o=r[i.startFrom-1]["_avgL "+i.name]);for(var l=Math.max(i.startFrom,i.days);l<r.length;l++){var h=r[l];h[s]>r[l-1][s]?(n=(n*(i.days-1)+h["STD "+i.name])/i.days,o=o*(i.days-1)/i.days):(o=(o*(i.days-1)+h["STD "+i.name])/i.days,n=n*(i.days-1)/i.days),h["Rel Vol "+i.name]=c(n,o),h["_avgG "+i.name]=n,h["_avgL "+i.name]=o}i.zoneOutput="Rel Vol"}function c(t,e){return t+e===0?100:100*t/(t+e)}},e.Studies.calculatePMO=function(t,i){var a={Smooth:Number(i.inputs["Smoothing Period"])-1,Double:Number(i.inputs["Double Smoothing Period"])-1,Signal:Number(i.inputs["Signal Period"])},r=i.chart.scrubbed;if(r.length<a.Smooth+a.Double)i.error=!0;else{var s,n=i.inputs.Field;for(n&&"field"!=n||(n="Close"),s=i.startFrom;s<r.length;s++)if(r[s]&&r[s-1]){var o=r[s-1][n];o&&(r[s]["_ROCx10 "+i.name]=1e3*(r[s][n]/o-1))}e.Studies.MA("exponential",a.Smooth,"_ROCx10 "+i.name,0,"_EMAx10",t,i),e.Studies.MA("exponential",a.Double,"_EMAx10 "+i.name,0,"PMO",t,i),e.Studies.MA("exponential",a.Signal,"PMO "+i.name,0,"PMOSignal",t,i),i.zoneOutput="PMO"}},e.Studies.calculateElderImpulse=function(t,i){var a,r=i.chart.scrubbed,s=i.outputs.Bullish,n=i.outputs.Bearish,o=i.outputs.Neutral;e.Studies.MA("exponential",13,"Close",0,"_MA",t,i),i.macd=new e.Studies.StudyDescriptor("_"+i.name,"macd",i.panel),i.macd.chart=i.chart,i.macd.days=i.days,i.macd.startFrom=i.startFrom,i.macd.inputs={"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},i.macd.outputs={_MACD:null,_Signal:null},e.Studies.calculateMACD(t,i.macd);for(var l=i.startFrom;l<r.length;l++)a=0===l?o:r[l]["_MA "+i.name]>r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]>r[l-1]["_"+i.name+"_hist"]?s:r[l]["_MA "+i.name]<r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]<r[l-1]["_"+i.name+"_hist"]?n:o,r[l]["Result "+i.name]=a},e.Studies.calculatePivotPoints=function(t,i){var a=i.chart.scrubbed,r="day";if("day"==t.layout.interval)r="month";else if(e.ChartEngine.isDailyInterval(t.layout.interval))r="year";else if("second"==t.layout.interval||"millisecond"==t.layout.interval||"second"==t.layout.timeUnit||"millisecond"==t.layout.timeUnit)r="15min";else{var s=t.layout.periodicity;"minute"!=t.layout.interval&&(s*=t.layout.interval),s>=30&&(r="week")}var n=e.Market.Symbology.isForexSymbol(t.chart.symbol),o=e.Market.Symbology.isForexMetal(t.chart.symbol),l=null;var h,c,u,p={pivotPoint:NaN,high:0,low:0,prevHigh:0,prevLow:0,hlSpread:0};function d(){p.pivotPoint=(p.high+p.low+a[m-1].Close)/3,p.prevHigh=p.high,p.prevLow=p.low,p.hlSpread=p.high-p.low,p.high=p.low=0}i.startFrom>1&&(p=e.clone(a[i.startFrom-1]["_pointers "+i.name]));for(var m=Math.max(1,i.startFrom);m<a.length;m++)if(a[m-1]){if(p.high=Math.max(p.high,a[m-1].High),p.low=Math.min(p.low>0?p.low:a[m-1].Low,a[m-1].Low),i.inputs.Continuous)d();else if("year"==r&&a[m].DT.getYear()!=a[m-1].DT.getYear())d();else if("month"==r&&a[m].DT.getMonth()!=a[m-1].DT.getMonth())d();else if("week"==r&&a[m].DT.getDay()<a[m-1].DT.getDay())d();else if("day"==r){null===l&&(h=a[m].DT,c=void 0,u=void 0,c=n?"America/New_York":t.chart.market.market_tz,u=new Date(h.getTime()+6e4*h.getTimezoneOffset()),c&&-1!=c.indexOf("UTC")||(u=e.convertTimeZone(u,"UTC",c)),l=new Date(u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds()).getTime()-h.getTime(),n&&(l+=60*(o?6:7)*60*1e3));var g=new Date(new Date(+a[m].DT).setMilliseconds(a[m].DT.getMilliseconds()+l)),f=new Date(new Date(+a[m-1].DT).setMilliseconds(a[m-1].DT.getMilliseconds()+l));f.getDate()!==g.getDate()&&0!==f.getDay()&&t.chart.market.isMarketDate(g)&&(l=null,d())}else"15min"!=r||a[m].DT.getHours()==a[m-1].DT.getHours()&&Math.floor(a[m].DT.getMinutes()/15)==Math.floor(a[m-1].DT.getMinutes()/15)||d();a[m]["Pivot "+i.name]=p.pivotPoint,"fibonacci"==i.inputs.Type.toLowerCase()?(a[m]["Resistance 1 "+i.name]=p.pivotPoint+.382*p.hlSpread,a[m]["Resistance 2 "+i.name]=p.pivotPoint+.618*p.hlSpread,a[m]["Resistance 3 "+i.name]=p.pivotPoint+p.hlSpread,a[m]["Support 1 "+i.name]=p.pivotPoint-.382*p.hlSpread,a[m]["Support 2 "+i.name]=p.pivotPoint-.618*p.hlSpread,a[m]["Support 3 "+i.name]=p.pivotPoint-p.hlSpread):(a[m]["Resistance 1 "+i.name]=2*p.pivotPoint-p.prevLow,a[m]["Resistance 2 "+i.name]=p.pivotPoint+p.hlSpread,a[m]["Resistance 3 "+i.name]=p.prevHigh+2*(p.pivotPoint-p.prevLow),a[m]["Support 1 "+i.name]=2*p.pivotPoint-p.prevHigh,a[m]["Support 2 "+i.name]=p.pivotPoint-p.hlSpread,a[m]["Support 3 "+i.name]=p.prevLow-2*(p.prevHigh-p.pivotPoint)),a[m]["_pointers "+i.name]=e.clone(p)}},e.Studies.calculateVWAP=function(t,i){var a="AVWAP"==i.type,r=i.chart.scrubbed;if(a||!e.ChartEngine.isDailyInterval(t.layout.interval)){var s="hlc/3";a&&((s=i.inputs.Field)&&"field"!=s||(s=i.inputs.Field="hlc/3",t.changeOccurred("layout")));var n,o,l,h=e.Market.Symbology.isForexSymbol(t.chart.symbol),c=e.Market.Symbology.isForexMetal(t.chart.symbol),u=null,p=0,d=0,m=0,g=!1;if(i.startFrom>1&&(p=r[i.startFrom-1]["_V "+i.name]||0,d=r[i.startFrom-1]["_VxP "+i.name]||0,m=r[i.startFrom-1]["_VxP2 "+i.name]||0),a){var f=i.inputs["Anchor Date"].replace(/-/g,"");if(f.search(/^\d{8}$/))return void(i.error="Invalid Anchor Date");var y=i.inputs["Anchor Time"].replace(/:/g,"");y.search(/^\d{4,6}$/)||(f+=y),f=e.strToDateTime(f.replace(/\D/g,"")),!i.startFrom&&f>=r[0].DT&&(i.startFrom=t.tickFromDate(f,t.chart,null,!0))}for(var v=i.startFrom;v<r.length;v++){if(!a&&(null===u&&(n=r[v].DT,o=void 0,l=void 0,o=h?"America/New_York":t.chart.market.market_tz,l=new Date(n.getTime()+6e4*n.getTimezoneOffset()),o&&-1!=o.indexOf("UTC")||(l=e.convertTimeZone(l,"UTC",o)),u=new Date(l.getFullYear(),l.getMonth(),l.getDate(),l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()).getTime()-n.getTime(),h&&(u+=60*(c?6:7)*60*1e3)),r[v-1]&&r[v-1].DT)){var x=new Date(new Date(+r[v].DT).setMilliseconds(r[v].DT.getMilliseconds()+u));new Date(new Date(+r[v-1].DT).setMilliseconds(r[v-1].DT.getMilliseconds()+u)).getDate()!=x.getDate()&&t.chart.market.isMarketDate(x)&&(u=null,p=d=m=0)}var b=r[v][s],S=r[v].Volume;if(a&&!S&&(S=1),p+=S,d+=S*b,m+=S*b*b,a||p){r[v]["_V "+i.name]=p,r[v]["_VxP "+i.name]=d,r[v]["_VxP2 "+i.name]=m;for(var C=r[v]["_SDVWAP "+i.name]=Math.sqrt(Math.max(0,m/p-Math.pow(d/p,2))),w=r[v]["VWAP "+i.name]=d/p,T=1;T<=3;T++)r[v]["SDVWAP"+T+"+ "+i.name]=w+T*C,r[v]["SDVWAP"+T+"- "+i.name]=w-T*C;g=!0}}for(var k=1;k<=3;k++)i.inputs["Display "+k+" Standard Deviation ("+k+"σ)"]&&(i.outputMap["SDVWAP"+k+"+ "+i.name]=k+" Standard Deviation ("+k+"σ)",i.outputMap["SDVWAP"+k+"- "+i.name]=k+" Standard Deviation ("+k+"σ)");a||g||(i.error="VWAP Requires Volume")}else i.error="VWAP is Intraday Only"},e.Studies.initAnchoredVWAP=function(t,i,a,r,s,n){if(!a["Anchor Date"]&&!a["Anchor Time"])for(var o=t.chart.dataSegment,l=0;o&&l<o.length;l++)if(o[l]){var h=e.yyyymmddhhmmssmmm(o[l].DT);a["Anchor Date"]=h.substr(0,8),a["Anchor Time"]=h.substr(8,6);break}return e.Studies.initializeFN(t,i,a,r,s,n)},e.Studies.calculateMFI=function(t,e){var i,a=e.chart.scrubbed,r=0,s=e.inputs["Scale Factor"];s||(s=e.study.inputs["Scale Factor"]);var n,o=Math.pow(10,Number(s));for(e.startFrom>1&&(r=a[e.startFrom-1]["_high "+e.name]),n=e.startFrom;n<a.length;n++)a[n]&&a[n].Volume&&(a[n][e.name+"_hist"]=i=o*(a[n].High-a[n].Low)/a[n].Volume,a[n]["_high "+e.name]=r=Math.max(r,i));e.outputMap={},e.outputMap[e.name+"_hist"]=""},e.Studies.calculateAlligator=function(t,i){var a={J:Number(i.inputs["Jaw Period"]),T:Number(i.inputs["Teeth Period"]),L:Number(i.inputs["Lips Period"])},r=i.chart.scrubbed;if(r.length<Math.max(a.J,a.T,a.L)+1)i.error=!0;else{e.Studies.MA("welles wilder",a.J,"hl/2",i.inputs["Jaw Offset"],"Jaw",t,i),e.Studies.MA("welles wilder",a.T,"hl/2",i.inputs["Teeth Offset"],"Teeth",t,i),e.Studies.MA("welles wilder",a.L,"hl/2",i.inputs["Lips Offset"],"Lips",t,i);for(var s=i.startFrom;s<r.length;s++)if(r[s]&&("Gator"==i.type&&(r[s][i.name+"_hist1"]=Math.abs(r[s]["Jaw "+i.name]-r[s]["Teeth "+i.name]),r[s][i.name+"_hist2"]=-Math.abs(r[s]["Teeth "+i.name]-r[s]["Lips "+i.name]),i.outputMap={},i.outputMap[i.name+"_hist1"]="",i.outputMap[i.name+"_hist2"]=""),i.inputs["Show Fractals"])){if(!(r[s-2]&&r[s-1]&&r[s]&&r[s+1]&&r[s+2]))continue;r[s-2].High&&r[s-1].High&&r[s].High&&r[s+1].High&&r[s+2].High&&r[s].High>r[s-1].High&&r[s].High>r[s-2].High&&r[s].High>r[s+1].High&&r[s].High>r[s+2].High&&(r[s]["Fractal High "+i.name]=1),r[s-2].Low&&r[s-1].Low&&r[s].Low&&r[s+1].Low&&r[s+2].Low&&r[s].Low<r[s-1].Low&&r[s].Low<r[s-2].Low&&r[s].Low<r[s+1].Low&&r[s].Low<r[s+2].Low&&(r[s]["Fractal Low "+i.name]=1)}}},e.Studies.calculateRelativeVigor=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r;for(r=i.startFrom;r<a.length;r++)a[r]["_Change "+i.name]=a[r].Close-a[r].Open,a[r]["_Range "+i.name]=a[r].High-a[r].Low;e.Studies.MA("triangular",4,"_Change "+i.name,0,"_Numer",t,i),e.Studies.MA("triangular",4,"_Range "+i.name,0,"_Denom",t,i);var s=[],n=[];for(r=Math.max(i.startFrom-i.days,0);r<a.length;r++){s.push(a[r]["_Numer "+i.name]),n.push(a[r]["_Denom "+i.name]),s.length>i.days&&(s.shift(),n.shift());var o,l=0,h=0;for(o=0;o<s.length;o++)l+=s[o];for(o=0;o<n.length;o++)h+=n[o];0===h&&(h=1e-8),r<i.startFrom||(a[r]["Rel Vig "+i.name]=l/h)}for(e.Studies.MA("triangular",4,"Rel Vig "+i.name,0,"RelVigSignal",t,i),r=i.startFrom;r<a.length;r++)a[r][i.name+"_hist"]=a[r]["Rel Vig "+i.name]-a[r]["RelVigSignal "+i.name];i.outputMap[i.name+"_hist"]=""}},e.Studies.calculateUlcerIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<2*i.days-1)i.error=!0;else{var r,s=i.inputs.Field;for(s&&"field"!=s||(s="Close"),r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r]["_PD2 "+i.name]=Math.pow(100*(a[r][s]/n(i.days,r,s)-1),2);for(e.Studies.MA("simple",i.days,"_PD2 "+i.name,0,"_MA",t,i),r=Math.max(i.startFrom,2*(i.days-1));r<a.length;r++)a[r]["Result "+i.name]=Math.sqrt(a[r]["_MA "+i.name])}function n(t,e,i){for(var r=null,s=e-t+1;s<=e;s++)s<0||(r=null===r?a[s][i]:Math.max(r,a[s][i]));return r}},e.Studies.calculateChoppiness=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else for(var r=Math.max(i.startFrom,i.days);r<a.length;r++)if(a[r]){var s=n(i.days,r);a[r]["Sum True Range "+i.name]?a[r]["Result "+i.name]=100*Math.log(a[r]["Sum True Range "+i.name]/Math.max(1e-6,s[1]-s[0]))/Math.log(i.days):a[r]["Result "+i.name]=0}function n(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.max(i,a[s].High),r=Math.min(r,a[s].Low));return[r,i]}},e.Studies.calculateDisparity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"_MA",t,i);for(var s=Math.max(i.startFrom,i.days-1);s<a.length;s++)a[s]&&(a[s]["Result "+i.name]=100*(a[s][r]/a[s]["_MA "+i.name]-1))}},e.Studies.calculateRainbow=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");for(var s=r,n=1;n<=10;n++)e.Studies.MA("simple",i.days,s,0,"SMA"+n,t,i),s="SMA"+n+" "+i.name;for(var o=Math.max(i.startFrom,10);o<a.length;o++)if(a[o]){var l=0,h=-1*Number.MAX_VALUE,c=Number.MAX_VALUE;for(n=1;n<=10;n++){var u=a[o]["SMA"+n+" "+i.name];l+=u,h=Math.max(h,u),c=Math.min(c,u)}if(i.name.indexOf("Osc")>-1){var p=d(i.inputs["HHV/LLV Lookback"],o);a[o][i.name+"_hist"]=100*(a[o][r]-l/10)/Math.max(1e-6,p[1]-p[0]),a[o]["Over "+i.name]=100*(h-c)/Math.max(1e-6,p[1]-p[0]),a[o]["Under "+i.name]=-a[o]["Over "+i.name],a[o]["Zero "+i.name]=0}}i.name.indexOf("Osc")>-1&&(i.outputMap={},i.outputMap["Over "+i.name]="Positive Bar",i.outputMap["Under "+i.name]="Negative Bar",i.outputMap["Zero "+i.name]="",i.outputMap[i.name+"_hist"]="")}function d(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.max(i,a[s].Close),r=Math.min(r,a[s].Close));return[r,i]}},e.Studies.calculateKST=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s={},n={};s[1]=Number(i.inputs["Lightest Rate of Change Period"]),s[2]=Number(i.inputs["Light Rate of Change Period"]),s[3]=Number(i.inputs["Heavy Rate of Change Period"]),s[4]=Number(i.inputs["Heaviest Rate of Change Period"]),n[1]=Number(i.inputs["Lightest SMA Period"]),n[2]=Number(i.inputs["Light SMA Period"]),n[3]=Number(i.inputs["Heavy SMA Period"]),n[4]=Number(i.inputs["Heaviest SMA Period"]);var o,l,h=Number(i.inputs["Signal Period"]);for(o=i.startFrom;o<a.length;o++)if(a[o])for(l=1;l<=4;l++)o>=s[l]&&a[o-s[l]]&&a[o-s[l]][r]&&(a[o]["_ROC"+l+" "+i.name]=100*(a[o][r]/a[o-s[l]][r]-1));for(l=1;l<=4;l++)e.Studies.MA("simple",n[l],"_ROC"+l+" "+i.name,0,"_SMA"+l,t,i);for(o=i.startFrom;o<a.length;o++)for(a[o]["KST "+i.name]=0,l=1;l<=4;l++)a[o]["KST "+i.name]+=l*a[o]["_SMA"+l+" "+i.name];e.Studies.MA("simple",h,"KST "+i.name,0,"KSTSignal",t,i)},e.Studies.calculateSpecialK=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs.Interval;s||(s="daily");var n,o,l={daily:[10,15,20,30,50,65,75,100,195,265,390,530],weekly:[4,5,6,8,10,13,15,20,39,52,78,104]},h={daily:[10,10,10,15,50,65,75,100,130,130,130,195],weekly:[4,5,6,8,10,13,15,20,26,26,26,39]};for(n=i.startFrom;n<a.length;n++)if(a[n])for(o=0;o<l[s].length;o++)n>=l[s][o]&&a[n-l[s][o]]&&a[n-l[s][o]][r]&&(a[n]["_ROC"+o+" "+i.name]=100*(a[n][r]/a[n-l[s][o]][r]-1));for(o=0;o<h[s].length;o++)e.Studies.MA("daily"==s?"simple":"exponential",h[s][o],"_ROC"+o+" "+i.name,0,"_MA"+o,t,i);for(n=i.startFrom;n<a.length;n++)for(a[n]["Result "+i.name]=0,o=0;o<h[s].length;o++)a[n]["Result "+i.name]+=(o%4+1)*a[n]["_MA"+o+" "+i.name]},e.Studies.calculateDarvas=function(t,i){var a=i.chart.scrubbed,r=0,s=parseInt(i.inputs["ATH Lookback Period"],10);i.inputs["Volume Spike"]&&e.Studies.MA("simple",s,"Volume",0,"ADV",t,i);var n,o=parseFloat(i.inputs["Volume % of Avg"])/100,l="none",h={},c=null,u=null,p=null,d=parseFloat(i.inputs["Level Offset"]);var m={};for(["Darvas","Ghost","Profit","Loss","ATH","ADV","Spike"].forEach(function(t){m[t]=t+" "+i.name}),n=i.startFrom-1;n>0;n--){var g=a[n];if(!g[m.Darvas]&&!g[m.Ghost]){r=g[m.ATH]||0,u=g[m.Profit],p=g[m.Loss];break}for(var f in m)g[f]=null}for(;n<a.length;n++){var y=a[n];if(y){if(parseFloat(i.inputs["Price Minimum"])<=a[r].Close){if(!c||c.End&&n!=c.End+1||(a[n-1].Close>h.High?h={State:1,High:2*h.High-h.Low,Low:h.High,Start:n,End:2*h.End-h.Start+1}:c=null,c&&(y[m.Ghost]=e.clone(h),h.State=0,a[h.End]&&(a[h.End][m.Ghost]=e.clone(h)),c={Start:h.Start,End:h.End},u=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),y[m.Profit]=u,y[m.Loss]=p,y.Close>=u?u=null:"high/low"==i.inputs["Exit Field"]&&y.High>=u&&(u=null),"none"==l&&n==r+3&&!a[r+2][m.Darvas]&&!a[r+1][m.Darvas]&&!a[r][m.Darvas]&&a[r].High>y.High&&(l="high"),"high"==l&&(y.High>a[r].High?l="none":a[n-3].Low<a[n-2].Low&&a[n-3].Low<a[n-1].Low&&a[n-3].Low<y.Low&&(h={State:1,High:a[r].High,Low:a[n-3].Low,Start:r},a[r][m.Darvas]=e.clone(h),l="darvas",c&&(c.End>n&&a[c.Start]&&(y[m.Ghost]=e.clone(a[c.Start][m.Ghost]),y[m.Ghost].End=n,a[c.End]&&delete a[c.End][m.Ghost]),y[m.Ghost].State=0,a[c.Start][m.Ghost].End=n,c=null),u=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),"darvas"==l&&(y.Close>h.High?c={}:"high/low"==i.inputs["Exit Field"]&&y.High>h.High?c={}:y.Close<h.Low?l="none":"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low&&(l="none"),c?l="none":"none"==l&&(u=null,p=null),i.inputs["Ghost Boxes"]||(c=null),"none"==l)){for(var v=h.Start+1;v<n;v++)a[v][m.Darvas]=e.clone(h);h.State=0,h.End=n,y[m.Darvas]=e.clone(h),y[m.ATH]=r;continue}p&&(y.Close<h.Low||"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low)&&("darvas"==l&&(l="none"),(y.Close<p||"high/low"==i.inputs["Exit Field"]&&y.Low<p)&&(u=null,p=null),c&&(c.End>n&&a[c.Start]&&(y[m.Ghost]=e.clone(a[c.Start][m.Ghost]),y[m.Ghost].End=n,a[c.End]&&delete a[c.End][m.Ghost]),y[m.Ghost].State=0,a[c.Start][m.Ghost].End=n,c=null))}if(y.High>=a[r].High&&(r=n),(n<3||y.High>=a[n-1].High&&y.High>=a[n-2].High&&y.High>=a[n-3].High)&&n-r>=s){r=n;for(var x=0;x<s&&!(n-x<0);x++)a[n-x].High>a[r].High&&(r=n-x);0}i.inputs["Volume Spike"]&&n>s&&n==r&&y[m.ADV]*o<y.Volume&&(y[m.Spike]=1),y[m.ATH]=r}}},e.Studies.calculateSupertrend=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.calculateStudyATR(t,i);for(var r=i.startFrom;r<a.length;r++){var s=a[r];if(s){var n=(s.High+s.Low)/2,o=i.inputs.Multiplier*s["ATR "+i.name],l=n-o,h=n+o;r&&(a[r-1]&&a[r-1].Close&&a[r-1].Close>a[r-1]["_Uptrend "+i.name]&&a[r-1]["_Uptrend "+i.name]>l&&(l=a[r-1]["_Uptrend "+i.name]),a[r-1]&&a[r-1].Close&&a[r-1].Close<a[r-1]["_Downtrend "+i.name]&&a[r-1]["_Downtrend "+i.name]<h&&(h=a[r-1]["_Downtrend "+i.name])),s["_Direction "+i.name]=1,r&&(s["_Direction "+i.name]=a[r-1]["_Direction "+i.name],s.Close>a[r-1]["_Downtrend "+i.name]?s["_Direction "+i.name]=1:s.Close<a[r-1]["_Uptrend "+i.name]&&(s["_Direction "+i.name]=-1)),s["_Uptrend "+i.name]=l,s["_Downtrend "+i.name]=h,s["Trend "+i.name]=s["_Direction "+i.name]>0?l:h}}i.outputMap={},i.outputMap["Trend "+i.name]=""}},e.Studies.fetchAdditionalInstruments=function(t,i,a,r){if(t.quoteDriver){var s,n,o,l=t.panels[i.panel].chart;for(i.symbols=a,s=0;s<a.length;s++){n=o=a[s],"object"==_typeof(o)?n=o.symbol:o={symbol:n};var h={symbol:n,symbolObject:o,bucket:"study",studyName:i.name,chartName:l.name,action:"add-study"};e.extend(h,r);var c=h.loadData;t.currentlyImporting&&(h.loadData=!1),i.series||(i.series={}),i.series[n]=t.addSeries(null,h,u),i.series[n].parameters.loadData=c}}else console.log("CIQ.Studies.fetchAdditionalInstruments: No quotefeed to fetch symbol");function u(){t.createDataSet(),t.draw()}},e.Studies.initPriceRelative=function(t,i,a,r,s,n){var o=e.Studies.initializeFN(t,i,a,r,s,n),l=[o.inputs["Comparison Symbol"].toUpperCase()];return e.Studies.fetchAdditionalInstruments(t,o,l),o},e.Studies.calculatePriceRelative=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();r||(r=i.study.inputs["Comparison Symbol"]);var s={},n=t.chart.symbol||"";if(s[n=n.replace(/[=+\-*\\%]/g,"")]=a.slice(i.startFrom),s[n].length){n!=r&&(s[r]=null);for(var o=e.computeEquationChart("["+n+"]/["+r+"]",s),l=0,h=i.startFrom;h<a.length&&l<o.length;h++){for(;l<o.length&&a[h].DT.getTime()>o[l].DT.getTime();)l++;a[h].DT.getTime()<o[l].DT.getTime()||(a[h]["Result "+i.name]=o[l].Close,l++)}}},e.Studies.calculatePerformance=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{e.Studies.MA("ma",i.days,"Close",0,"_MA Base",t,i),e.Studies.MA("ma",i.days,r,0,"_MA Comp",t,i);for(var s=i.startFrom;s<a.length;s++){var n=a[s][r];n&&(n.Close||0===n.Close)&&(n=n.Close),a[s]["Result "+i.name]=a[s].Close/n*(a[s]["_MA Comp "+i.name]/a[s]["_MA Base "+i.name])}}},e.Studies.calculateBeta=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{for(var s=Math.max(i.startFrom,1);s<a.length;s++){a[s]["_BaseChange "+i.name]=a[s].Close/a[s-1].Close-1;var n=a[s][r];n&&(n.Close||0===n.Close)&&(n=n.Close);var o=a[s-1][r];o&&(o.Close||0===o.Close)&&(o=o.Close),a[s]["_CompChange "+i.name]=n/o-1}for(e.Studies.MA("ma",i.days,"_BaseChange "+i.name,0,"_MA Base",t,i),e.Studies.MA("ma",i.days,"_CompChange "+i.name,0,"_MA Comp",t,i),s=Math.max(i.startFrom,i.days);s<a.length;s++)a[s]["_COVARn "+i.name]=(a[s]["_BaseChange "+i.name]-a[s]["_MA Base "+i.name])*(a[s]["_CompChange "+i.name]-a[s]["_MA Comp "+i.name]),a[s]["_VARn "+i.name]=Math.pow(a[s]["_CompChange "+i.name]-a[s]["_MA Comp "+i.name],2);for(e.Studies.MA("ma",i.days,"_COVARn "+i.name,0,"_COVAR",t,i),e.Studies.MA("ma",i.days,"_VARn "+i.name,0,"_VAR",t,i),s=Math.max(i.startFrom,2*i.days-1);s<a.length;s++)a[s]["Result "+i.name]=a[s]["_COVAR "+i.name]/a[s]["_VAR "+i.name]}},e.Studies.calculateVortex=function(t,i){var a=i.chart.scrubbed,r=i.days;if(a.length<r+1)i.error=!0;else{var s={tr:0,vmPlus:0,vmMinus:0};i.startFrom>1&&(s=e.clone(a[i.startFrom-1]["_totals "+i.name]));for(var n=Math.max(i.startFrom,1);n<a.length;n++){var o=a[n],l=a[n-1],h=Math.abs(o.High-l.Low),c=Math.abs(o.Low-l.High),u=Math.max(o.High,l.Close)-Math.min(o.Low,l.Close);s.tr+=u,s.vmPlus+=h,s.vmMinus+=c,n>r&&(s.tr-=a[n-r]["_True Range "+i.name],s.vmPlus-=a[n-r]["_VMPlus "+i.name],s.vmMinus-=a[n-r]["_VMMinus "+i.name]),o["_True Range "+i.name]=u,o["_VMPlus "+i.name]=h,o["_VMMinus "+i.name]=c,n>=r&&(o["+VI "+i.name]=s.vmPlus/s.tr,o["-VI "+i.name]=s.vmMinus/s.tr),o["_totals "+i.name]=e.clone(s)}}},e.Studies.calculateBalanceOfPower=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++){var s=a[r];s["_Ratio "+i.name]=s.Close-s.Open,s.High-s.Low!=0&&(s["_Ratio "+i.name]/=s.High-s.Low)}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Ratio "+i.name,0,"Result",t,i)}},e.Studies.calculateTrendIntensity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ma",i.days,r,0,"_SMA",t,i);var s,n,o=0,l=0,h=[],c=Math.ceil(i.days/2);for(s=Math.max(0,i.startFrom-c);s<a.length;s++)(a[s]["_SMA "+i.name]||0===a[s]["_SMA "+i.name])&&((n=a[s][r]-a[s]["_SMA "+i.name])<0?l+=-1*n:o+=n,h.push(n),h.length>c&&((n=h.shift())<0?l-=-1*n:o-=n),s<i.startFrom||(a[s]["TII "+i.name]=u(o,l)));e.Studies.MA("ema",i.inputs["Signal Period"],"TII "+i.name,0,"Signal",t,i)}function u(t,e){return Math.abs(e)<1e-8?100:100-100/(1+t/e)}},e.Studies.calculateZigZag=function(t,e){var i=e.chart.scrubbed;if(i&&i.length){for(var a=e.highLowChart,r=null,s=null,n=e.inputs["Distance(%)"],o=0,l=0,h=0,c=null,u=null,p=0,d=Math.min(i.length-1,e.startFrom);d>=0;d--)if(p=d,i[d]["_state "+e.name]){var m=i[d]["_state "+e.name];r=m[0],s=m[1],o=m[2],l=m[3],h=m[4],c=m[5],u=m[6];break}for(var g=p;g<i.length;g++){var f=i[g][a?"High":"Close"],y=i[g][a?"Low":"Close"];if(null===s||s<f)if(o<0&&(r=y),c=(1-n/100)*(s=f),o>-1){if(null!==u&&s>u){i[l]["Result "+e.name]=i[l][a?"Low":"Close"],v(h,l),o=-1,r=y,h=l,l=g;continue}}else l=g;if(null===r||r>y)if(o>0&&(s=f),u=(1+n/100)*(r=y),o<1){if(null!==c&&r<c){i[l]["Result "+e.name]=i[l][a?"High":"Close"],v(h,l),o=1,s=f,h=l,l=g;continue}}else l=g}i[l]["Result "+e.name]=i[l][a?1==o?"Low":"High":"Close"],i[l]["_state "+e.name]=[r,s,o,l,h,c,u],v(h,l),i[i.length-1]["Result "+e.name]=i[i.length-1][a?1==o?"High":"Low":"Close"],v(l,i.length-1)}function v(t,a){for(var r=t+1;r<a;r++)i[r]["ShadowResult "+e.name]=(i[a]["Result "+e.name]-i[t]["Result "+e.name])*(r-t)/(a-t)+i[t]["Result "+e.name],delete i[r]["Result "+e.name]}},e.Studies.calculatePsychologicalLine=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=[],r=100/e.days,s=0,n=Math.max(e.startFrom-e.days,1);n<i.length;n++){var o=Number(i[n].Close>i[n-1].Close);o&&(s+=r),a.push(o),a.length>e.days&&(s-=a.shift()*r),n<e.startFrom||(i[n]["Result "+e.name]=s)}},e.Studies.calculateMADev=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs["Points Or Percent"];s||(s="Points");var n=i.inputs["Moving Average Type"];n||(n="exponential"),e.Studies.MA(n,i.days,r,0,"_MA",t,i);for(var o=i.name+"_hist",l=Math.max(i.startFrom,i.days-1);l<a.length;l++){var h=a[l],c=h[r];c&&"object"==_typeof(c)&&(c=c[i.subField]),h[o]="Points"==s?c-h["_MA "+i.name]:100*(c/h["_MA "+i.name]-1)}i.outputMap={},i.outputMap[i.name+"_hist"]=""}},e.Studies.calculateShinohara=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r={weakNum:0,weakDen:0,strongNum:0,strongDen:0};i.startFrom>1&&(r=e.clone(a[i.startFrom-1]["_accums "+i.name]));for(var s=i.startFrom;s<a.length;s++)r.weakNum+=a[s].High-a[s].Close,r.weakDen+=a[s].Close-a[s].Low,s>0&&(r.strongNum+=a[s].High-a[s-1].Close,r.strongDen+=a[s-1].Close-a[s].Low),s>=i.days&&(r.weakNum-=a[s-i.days].High-a[s-i.days].Close,r.weakDen-=a[s-i.days].Close-a[s-i.days].Low,a[s]["Weak Ratio "+i.name]=100*r.weakNum/r.weakDen,s>i.days&&(r.strongNum-=a[s-i.days].High-a[s-i.days-1].Close,r.strongDen-=a[s-i.days-1].Close-a[s-i.days].Low,a[s]["Strong Ratio "+i.name]=100*r.strongNum/r.strongDen)),a[s]["_accums "+i.name]=e.clone(r)}},e.Studies.calculateIchimoku=function(t,e){var i,a,r=e.chart.scrubbed,s={Base:Number(e.inputs["Base Line Period"]),Conv:Number(e.inputs["Conversion Line Period"]),LeadB:Number(e.inputs["Leading Span B Period"]),Lag:Number(e.inputs["Lagging Span Period"])};function n(t,e){for(var i=Number.MAX_VALUE,a=-1*Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.min(i,r[s].Low),a=Math.max(a,r[s].High));return[i,a]}for(i=e.startFrom;i<r.length;i++)r[i]&&(a=n(s.Conv,i),r[i]["Conversion Line "+e.name]=(a[1]+a[0])/2,a=n(s.Base,i),r[i]["Base Line "+e.name]=(a[1]+a[0])/2,i<s.Lag||(r[i-s.Lag]["Lagging Span "+e.name]=r[i].Close));for(e.futureA=[],e.futureB=[],i=Math.max(0,e.startFrom-s.Base);i<r.length;i++){a=n(s.LeadB,i);var o=(r[i]["Conversion Line "+e.name]+r[i]["Base Line "+e.name])/2,l=(a[1]+a[0])/2;r[i+s.Base]?(r[i+s.Base]["Leading Span A "+e.name]=o,r[i+s.Base]["Leading Span B "+e.name]=l):(e.futureA.push(o),e.futureB.push(l))}e.chart.whiteSpaceFutureTicks=Math.max(e.chart.whiteSpaceFutureTicks,e.futureA.length-1)},e.Studies.displayIchimoku=function(t,i,a){var r="Leading Span A "+i.name,s="Leading Span B "+i.name,n=e.Studies.determineColor(i.outputs[i.outputMap[r]]),o=e.Studies.determineColor(i.outputs[i.outputMap[s]]),l=t.panels[i.panel],h=i.getYAxis(t),c={topBand:r,bottomBand:s,topColor:n,bottomColor:o,skipTransform:l.name!=i.chart.name,topAxis:h,bottomAxis:h,opacity:.3};function u(a,r){h.flipped&&(r?r=!1:!1===r&&(r=!0));var s={color:!1===r?o:r?n:"transparent",opacity:c.opacity,panelName:i.panel,yAxis:h};e.fillArea(t,a,s)}!i.highlight&&t.highlightedDraggable&&(c.opacity*=.3),e.fillIntersecting(t,i.panel,c);var p=t.pixelFromBar(a.length-1,l.chart)+1,d=t.pixelFromPrice(a[a.length-1][r],l,h),m=[[p,t.pixelFromPrice(a[a.length-1][s],l,h)],[p,d]],g=null,f=i.futureA,y=i.futureB;if(i.chart.dataSegment.length>=i.chart.scroll){for(var v=0;f&&v<f.length-1;v++)if(null!==f[v]&&!isNaN(f[v])&&null!==y[v]&&!isNaN(y[v])){var x=t.pixelFromBar(a.length+v,l.chart)+1,b=t.pixelFromBar(a.length+v+1,l.chart)+1,S=t.pixelFromPrice(f[v],l,h),C=t.pixelFromPrice(f[v+1],l,h),w=t.pixelFromPrice(y[v],l,h),T=t.pixelFromPrice(y[v+1],l,h);if(m.push([x,S]),m.unshift([x,w]),(g=S<w)&&C>T||!g&&C<T){var k=e.intersectLineLineX(x,b,S,C,x,b,w,T),D=e.intersectLineLineY(x,b,S,C,x,b,w,T);m.push([k,D]),u(m,g),m=[[k,D]],g=null}}m.length>2&&u(m,g)}e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.displayDarvas=function(t,i,a){var r=e.Studies.determineColor(i.outputs.Levels);r&&"auto"!=r&&!e.isTransparent(r)||(r=t.defaultColor);var s=e.Studies.determineColor(i.outputs.Darvas);s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor);var n=e.Studies.determineColor(i.outputs.Ghost);n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor);var o,l,h,c=t.panels[i.panel],u=i.getContext(t),p=t.layout.candleWidth-2;if(p<2&&(p=1),t.startClip(i.panel),i.inputs["Stop Levels"]){for(u.setLineDash&&u.setLineDash([2,2]),u.lineWidth=2,u.strokeStyle=r,u.beginPath(),o=0;o<a.length;o++){l=a[o];var d=a[o-1];if(l){h=l["Loss "+i.name]?Math.floor(t.pixelFromPrice(l["Loss "+i.name],c)):null;var m=d&&d["Loss "+i.name]?Math.floor(t.pixelFromPrice(d["Loss "+i.name],c)):null;if(h){l.candleWidth&&(p=Math.floor(Math.max(1,l.candleWidth)));var g=Math.floor(t.pixelFromBar(o,c.chart)+p/2),f=Math.floor(t.pixelFromBar(o,c.chart)-p/2);m&&m>=h?u.lineTo(f,h):0===o?u.moveTo(t.chart.left,h):u.moveTo(f,h),u.lineTo(g,h)}}}u.stroke(),u.setLineDash&&u.setLineDash([]),u.lineWidth=1}var y,v,x,b,S=-10,C=0,w=-10,T=0,k=!1,D=!1,M=u.measureText("▲").width/2;for(o=0;o<a.length;o++)if(a[o]){if(a[o]["Spike "+i.name]){u.fillStyle=s,u.textBaseline="bottom";var A=t.pixelFromPrice(a[o].High,t.chart.panel);u.fillText("▼",t.pixelFromBar(o)-M,A-5)}a[o].candleWidth&&(p=Math.floor(Math.max(1,a[o].candleWidth))),a[o]["Darvas "+i.name]&&(1!=(l=a[o]["Darvas "+i.name]).State||k?0===l.State&&(C=Math.floor(t.pixelFromBar(o,c.chart)+p/2)-S,y=Math.floor(t.pixelFromPrice(l.High,c)),v=Math.floor(t.pixelFromPrice(l.Low,c))-y,u.strokeStyle=s,u.fillStyle=s,i.inputs["Stop Levels"]?u.globalAlpha=.3:(u.strokeRect(S,y,C,v),u.globalAlpha=.2),u.fillRect(S,y,C,v),u.globalAlpha=1,k=!1):(S=Math.floor(t.pixelFromBar(o,c.chart)-p/2),y=Math.floor(t.pixelFromPrice(l.High,c)),v=Math.floor(t.pixelFromPrice(l.Low,c))-y,k=!0)),a[o]["Ghost "+i.name]&&i.inputs["Ghost Boxes"]&&(1!=(l=a[o]["Ghost "+i.name]).State||D?0===l.State&&(l.Start==l.End&&(w=Math.floor(t.pixelFromBar(o,c.chart)-p/2)),T=Math.floor(t.pixelFromBar(o,c.chart)+p/2)-w,x=Math.floor(t.pixelFromPrice(l.High,c)),b=Math.floor(t.pixelFromPrice(l.Low,c))-x,u.strokeStyle=n,u.fillStyle=n,i.inputs["Stop Levels"]?u.globalAlpha=.3:(u.strokeRect(w,x,T,b),u.globalAlpha=.2),u.fillRect(w,x,T,b),u.globalAlpha=1,D=!1):(w=Math.floor(t.pixelFromBar(o,c.chart)-p/2),x=Math.floor(t.pixelFromPrice(l.High,c)),T=Math.floor((l.End-l.Start+1)*t.layout.candleWidth+p/2),b=Math.floor(t.pixelFromPrice(l.Low,c))-x,D=!0))}if(k&&(C=Math.floor(t.pixelFromBar(o,c.chart)+p/2)-S,u.strokeStyle=s,u.fillStyle=s,i.inputs["Stop Levels"]?u.globalAlpha=.3:(u.beginPath(),u.moveTo(S+2*C,y),u.lineTo(S,y),u.lineTo(S,y+v),u.lineTo(S+2*C,y+v),u.stroke(),u.globalAlpha=.2),u.fillRect(S,y,2*C,v),u.globalAlpha=1),D&&(u.strokeStyle=n,u.fillStyle=n,i.inputs["Stop Levels"]?u.globalAlpha=.3:(u.strokeRect(w,x,T,b),u.globalAlpha=.2),u.fillRect(w,x,T,b),u.globalAlpha=1),k||D){if(i.inputs["Stop Levels"]){u.setLineDash&&u.setLineDash([2,2]),u.lineWidth=2,u.strokeStyle=r;var F=Math.floor(t.pixelFromBar(o-1,c.chart)+p/2);void 0,h&&(u.beginPath(),u.moveTo(F,h),u.lineTo(k?S+2*C:w+T,h),u.stroke()),u.setLineDash&&u.setLineDash([]),u.lineWidth=1}k=!1,D=!1}t.endClip()},e.Studies.displaySupertrend=function(t,e,i){var a=t.panels[e.panel],r=e.getContext(t),s=e.getYAxis(t);function n(t,i,a){return i&&i["_Direction "+e.name]<0?e.outputs.Downtrend:e.outputs.Uptrend}var o={skipTransform:a.name!=e.chart.name,skipProjections:!0,label:t.preferences.labels,yAxis:s,highlight:e.highlight};r.strokeStyle=n(0,i[i.length-1]),r.lineWidth=2,e.highlight&&(r.lineWidth=1.5);for(var l="Trend "+e.name,h=0;a.chart.transformFunc&&s!=a.chart.yAxis&&h<i.length;h++){var c=i[h];c&&c.transform&&(c.transform[l]=a.chart.transformFunc(t,a.chart,c[l]))}t.plotDataSegmentAsLine(l,a,o,n),r.lineWidth=1,r.globalAlpha=1,t.startClip(e.panel),!e.highlight&&t.highlightedDraggable&&(r.globalAlpha*=.3);var u,p=r.measureText("▲").width/2;for(u=0;u<i.length;u++)if(i[u]&&i[u-1])if(i[u-1]["_Direction "+e.name]>i[u]["_Direction "+e.name]){r.fillStyle=e.outputs.Downtrend,r.textBaseline="bottom";for(var d=t.pixelFromPrice(i[u].High,a,s),m=5;m<=45;m+=10)s.flipped?r.fillText("▲",t.pixelFromBar(u)-p,d+m):r.fillText("▼",t.pixelFromBar(u)-p,d-m)}else if(i[u-1]["_Direction "+e.name]<i[u]["_Direction "+e.name]){r.fillStyle=e.outputs.Uptrend,r.textBaseline="top";for(var g=t.pixelFromPrice(i[u].Low,a,s),f=5;f<=45;f+=10)s.flipped?r.fillText("▼",t.pixelFromBar(u)-p,g-f):r.fillText("▲",t.pixelFromBar(u)-p,g+f)}t.endClip()},e.Studies.displayVsComparisonSymbol=function(t,i,a){var r=i.inputs["Comparison Symbol"].toUpperCase();if(t.getSeries({symbol:r,chart:i.chart}).length){var s={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:i.study.centerline,yAxis:i.getYAxis(t),gapDisplayStyle:!0},n=s.yAxis?s.yAxis.flipped:t.panels[i.panel].yAxis.flipped,o=.3;!i.highlight&&t.highlightedDraggable&&(o*=.3);for(var l=a.length-1;l>=0;l--)if(a[l]&&a[l][r])return e.Studies.displaySeriesAsLine(t,i,a),void((i.study.centerline||0===i.study.centerline)&&(i.outputs.Gain&&e.preparePeakValleyFill(t,e.extend(s,{direction:n?-1:1,color:e.Studies.determineColor(i.outputs.Gain),opacity:o})),i.outputs.Loss&&e.preparePeakValleyFill(t,e.extend(s,{direction:n?1:-1,color:e.Studies.determineColor(i.outputs.Loss),opacity:o}))))}else t.watermark(i.panel,"center","bottom",t.translateIf(i.study.name)+": "+t.translateIf("Not Available"))},e.Studies.displayMFI=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=n.flipped?n.top:n.bottom,l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs.Green),c=e.Studies.determineColor(i.outputs.Fade),u=e.Studies.determineColor(i.outputs.Fake),p=e.Studies.determineColor(i.outputs.Squat);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var d=0;d<a.length;d++){var m=a[d],g=a[d-1];g||(g=t.getPreviousBar(t.chart,i.name+"_hist",d)),m&&(g&&(g[i.name+"_hist"]<m[i.name+"_hist"]?g.Volume<m.Volume?s.fillStyle=h:g.Volume>m.Volume&&(s.fillStyle=u):g[i.name+"_hist"]>m[i.name+"_hist"]&&(g.Volume<m.Volume?s.fillStyle=p:g.Volume>m.Volume&&(s.fillStyle=c))),m.candleWidth&&(l=Math.floor(Math.max(1,m.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(d,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(m[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.displayAwesomeOscillator=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var p=a[u],d=a[u-1];d||(d=t.getPreviousBar(t.chart,i.name+"_hist",u)),p&&(d&&(d[i.name+"_hist"]<p[i.name+"_hist"]?s.fillStyle=h:d[i.name+"_hist"]>p[i.name+"_hist"]&&(s.fillStyle=c)),p.candleWidth&&(l=Math.floor(Math.max(1,p.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(p[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.displayGator=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var p=a[u],d=a[u-1];if(p)for(var m=1;m<=2;m++)d||(d=t.getPreviousBar(t.chart,i.name+"_hist"+m,u)),d?Math.abs(d[i.name+"_hist"+m])<Math.abs(p[i.name+"_hist"+m])?s.fillStyle=h:Math.abs(d[i.name+"_hist"+m])>Math.abs(p[i.name+"_hist"+m])&&(s.fillStyle=c):s.fillStyle="#CCCCCC",p.candleWidth&&(l=Math.floor(Math.max(1,p.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(p[i.name+"_hist"+m],r,n)-o))}t.endClip()},e.Studies.initElderImpulse=function(t,i,a,r,s,n){var o=e.Studies.initializeFN(t,i,a,r,s,n);return s.calculateOnly?o:(t.chart.customChart={chartType:"colored_bar",colorFunction:function(t,e,i){var a=e["Result "+o.name];return a&&"object"==_typeof(a)&&(a=a.color),a}},t.setMainSeriesRenderer(),o)},e.Studies.displayPivotPoints=function(t,i,a){if(i.noSlopes=!i.inputs.Continuous,e.Studies.displaySeriesAsLine(t,i,a),i.inputs.Shading){var r=t.panels[i.panel],s={noSlopes:i.noSlopes,opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:r.name!=i.chart.name,yAxis:i.getYAxis(t)};!i.highlight&&t.highlightedDraggable&&(s.opacity*=.3),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 3 "+i.name,bottomBand:"Resistance 2 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 3"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 2 "+i.name,bottomBand:"Resistance 1 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 2"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 1"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Support 1"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 2 "+i.name,bottomBand:"Support 1 "+i.name,color:e.Studies.determineColor(i.outputs["Support 2"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 3 "+i.name,bottomBand:"Support 2 "+i.name,color:e.Studies.determineColor(i.outputs["Support 3"])},s))}},e.Studies.displayVWAP=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=i.inputs["Display 1 Standard Deviation (1σ)"],s=i.inputs["Display 2 Standard Deviation (2σ)"],n=i.inputs["Display 3 Standard Deviation (3σ)"];if((r||s||n)&&i.inputs.Shading){var o=t.panels[i.panel],l={opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:o.name!=i.chart.name,yAxis:i.getYAxis(t)};!i.highlight&&t.highlightedDraggable&&(l.opacity*=.3);var h="VWAP "+i.name,c="VWAP "+i.name;r&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP1+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP1+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP1- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP1- "+i.name]])},l)),h="SDVWAP1+ "+i.name,c="SDVWAP1- "+i.name),s&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP2+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP2+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP2- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP2- "+i.name]])},l)),h="SDVWAP2+ "+i.name,c="SDVWAP2- "+i.name),n&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP3+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP3+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP3- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP3- "+i.name]])},l)))}},e.Studies.displayAlligator=function(t,i,a){function r(e,i){var r,o=t.chart.panel.yAxis.flipped;"high"==e?(s.fillStyle=t.defaultColor,s.textBaseline=o?"top":"bottom",r=t.pixelFromPrice(a[i].High),s.fillText(o?"▼":"▲",t.pixelFromBar(n,t.chart)-s.measureText("▲").width/2+1,o?r+5:r-5)):"low"==e&&(s.fillStyle=t.defaultColor,s.textBaseline=o?"bottom":"top",r=t.pixelFromPrice(a[i].Low),s.fillText(o?"▲":"▼",t.pixelFromBar(n,t.chart)-s.measureText("▼").width/2+1,o?r-5:r+5))}var s=i.getContext(t);if(e.Studies.displaySeriesAsLine(t,i,a),i.inputs["Show Fractals"]){t.startClip(),s.globalAlpha=i.underlay?.3:1,!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var n=2;n<a.length-2;n++)a[n]&&(a[n]["Fractal High "+i.name]&&r("high",n),a[n]["Fractal Low "+i.name]&&r("low",n));t.endClip()}},e.Studies.displayRainbowMA=function(t,i,a){for(var r=t.panels[i.panel],s=10;s>0;s--)e.Studies.displayIndividualSeriesAsLine(t,i,r,"SMA"+s+" "+i.name,a)},e.Studies.displayRainbowOsc=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t);t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);var o=t.pixelFromPrice(0,r,n),l=r.name!=i.chart.name,h=e.Studies.determineColor(i.outputs["Positive Bar"]);s.strokeStyle=h,t.plotDataSegmentAsLine("Over "+i.name,r,{skipTransform:l,label:!1,yAxis:n});var c=s.createLinearGradient(0,o,0,n.flipped?n.bottom:n.top);c.addColorStop(0,t.containerColor),c.addColorStop(1,h),e.prepareChannelFill(t,{skipTransform:l,color:c,opacity:!i.highlight&&t.highlightedDraggable?.3:1,panelName:i.panel,topBand:"Over "+i.name,bottomBand:"Zero "+i.name,yAxis:n});var u=e.Studies.determineColor(i.outputs["Negative Bar"]);s.strokeStyle=u,t.plotDataSegmentAsLine("Under "+i.name,r,{skipTransform:l,label:!1,yAxis:n});var p=s.createLinearGradient(0,o,0,n.flipped?n.top:n.bottom);p.addColorStop(0,t.containerColor),p.addColorStop(1,u),e.prepareChannelFill(t,{skipTransform:l,color:p,opacity:!i.highlight&&t.highlightedDraggable?.3:1,panelName:i.panel,topBand:"Zero "+i.name,bottomBand:"Under "+i.name,yAxis:n});var d=t.layout.candleWidth-2;d<2&&(d=1),t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3),s.fillStyle="#CCCCCC";for(var m=0;m<a.length;m++){var g=a[m];g&&(g[i.name+"_hist"]>0?s.fillStyle=h:g[i.name+"_hist"]<0&&(s.fillStyle=u),g.candleWidth&&(d=Math.floor(Math.max(1,g.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(m,r.chart)-d/2),Math.floor(o),Math.floor(d),Math.floor(t.pixelFromPrice(g[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.displayZigZag=function(t,i,a){var r=t.chart.highLowBars||t.highLowBars[t.layout.chartType];i.highLowChart!=r&&(i.highLowChart=r,i.startFrom=0,i.study.calculateFN(t,i));for(var s=t.chart,n=0;n<a.length;n++){var o=a[n];o&&(o["_shadowCopy "+i.name]&&(delete o["Result "+i.name],delete o["_shadowCopy "+i.name]),o["Result "+i.name]||o.transform&&delete o.transform["Result "+i.name])}var l=a[0],h=a[a.length-1];l&&l["ShadowResult "+i.name]&&(l["Result "+i.name]=l["ShadowResult "+i.name],l.transform&&(l.transform["Result "+i.name]=s.transformFunc(t,s,l["ShadowResult "+i.name])),l["_shadowCopy "+i.name]=1),h&&h["ShadowResult "+i.name]&&(h["Result "+i.name]=h["ShadowResult "+i.name],h.transform&&(h.transform["Result "+i.name]=s.transformFunc(t,s,h["ShadowResult "+i.name])),h["_shadowCopy "+i.name]=1),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.displayVolumeProfile=function(t,i,a){if(t&&t.chart.dataSet){var r=t.chart,s=i.parameters.numberOfBars,n=i.parameters.widthPercentage,o=i.parameters.displayBorder,l=i.parameters.displayVolume;(!s||s<0)&&(s=30),s=Math.ceil(s),(!n||n<0)&&(n=.25),!1!==o&&(o=!0),!0!==l&&(l=!1);var h=(r.highValue-r.lowValue)/s;if(0!==h){for(var c=[],u=r.lowValue;u<r.highValue+.1;u+=h)c.push([u,0]);if(c.length<2)t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"));else{for(var p=0,d=0;d<a.length;d++){var m=a[d];if(m){var g=m.Volume;i.panel==r.name&&m.transform&&(m=m.transform);for(var f=c[0][0],y=0,v=1;v<c.length;v++)y=c[v][0],(m.Low>=f&&m.Low<=y||m.Low<f&&m.High>y||m.High>=f&&m.High<=y)&&(c[v][1]+=g,c[v][1]>p&&(p=c[v][1])),f=y}}if(0!==p){t.setStyle("stx_volume_profile","color",e.Studies.determineColor(i.outputs["Bars Color"]));var x=i.getContext(t);t.canvasFont("stx-float-date",x);var b=t.getCanvasFontSize("stx-float-date"),S=r.panel,C=S.yAxis.bottom,w=Math.round(r.right)-.5,T=r.width*n,k=t.canvasStyle("stx_volume_profile").borderTopColor,D=!e.isTransparent(t.canvasStyle("stx_volume_profile").borderTopColor)&&o,M=t;A("stx_volume_profile",!1),D&&A("stx_volume_profile",!0),x.globalAlpha=1}else t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"))}}}function A(a,r){r||(w-=2),M.canvasColor(a),x.beginPath();for(var s=c[0][0],n=w,o=1;o<c.length;o++){if(c[o][1]){var h=Math.round(w-c[o][1]*T/p)-.5,u=Math.round(M.pixelFromTransformedValue(s,S))+.5,d=Math.round(M.pixelFromTransformedValue(c[o][0],S))+.5;if(r||(u-=.5,d+=.5,h+=.5),u>C&&(u=C),d<C)if(x.moveTo(w,u),x.lineTo(w,d),x.lineTo(h,d),x.lineTo(h,u),r)(n>h||1==o)&&x.lineTo(n,u);else if(x.lineTo(w,u),l){var m=e.condenseInt(c[o][1]),g=u-d;if(b<=g-2){var f;try{f=x.measureText(m).width}catch(t){f=0}x.textBaseline="top";var y=x.fillStyle;x.fillStyle=k,x.fillText(m,h-f-3,d+(g/2-b/2)),x.fillStyle=y}}n=h}else n=w;s=c[o][0]}!i.highlight&&t.highlightedDraggable&&(x.globalAlpha*=.3),r||x.fill(),x.strokeStyle=k,r&&x.stroke(),x.closePath()}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"val lines":{name:"Valuation Lines",calculateFN:function(){},seriesFN:function(t,i,a){e.Studies.calculateValuationLines(t,i,a),e.Studies.displayValuationLines(t,i)},overlay:!0,yAxisFN:function(){},inputs:{Field:"field","Average Type":["mean","median","harmonic"],"Display Average":!0,"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1},outputs:{Average:"#00afed","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"}},correl:{name:"Correlation Coefficient",range:"-1 to 1",calculateFN:e.Studies.calculateCorrelationCoefficient,outputs:{}},PMO:{name:"Price Momentum Oscillator",calculateFN:e.Studies.calculatePMO,inputs:{Field:"field","Smoothing Period":35,"Double Smoothing Period":20,"Signal Period":10},outputs:{PMO:"auto",PMOSignal:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:2.5,studyOverBoughtColor:"auto",studyOverSoldValue:-2.5,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.05"},studyOverSoldValue:{max:0,step:"0.05"}}},"Rel Vol":{name:"Relative Volatility",range:"0 to 100",calculateFN:e.Studies.calculateRelativeVolatility,inputs:{Field:"field","STD Period":10,"Smoothing Period":14},outputs:{"Rel Vol":"auto"},centerline:50,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},Awesome:{name:"Awesome Oscillator",seriesFN:e.Studies.displayAwesomeOscillator,calculateFN:e.Studies.calculateAwesomeOscillator,inputs:{},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"W MFI":{name:"Market Facilitation Index",seriesFN:e.Studies.displayMFI,calculateFN:e.Studies.calculateMFI,yAxis:{ground:!0},range:"0 to max",inputs:{"Scale Factor":6},outputs:{Green:"#8bc176",Fade:"#ab611f",Fake:"#5f7cb8",Squat:"#ffd0cf"}},"ATR Bands":{name:"ATR Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateATRBands,inputs:{Period:5,Field:"field",Shift:3,"Channel Fill":!0},outputs:{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"},attributes:{Shift:{min:.1,step:.1}}},"STARC Bands":{name:"STARC Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateSTARCBands,inputs:{Period:15,"MA Period":5,Multiplier:1.3,"Channel Fill":!0},outputs:{"STARC Bands Top":"auto","STARC Bands Median":"auto","STARC Bands Bottom":"auto"},attributes:{Multiplier:{min:.1,step:.1}}},"ATR Trailing Stop":{name:"ATR Trailing Stops",overlay:!0,seriesFN:e.Studies.displayPSAR2,calculateFN:e.Studies.calculateATRStops,inputs:{Period:21,Multiplier:3,"Plot Type":["points","squarewave"],HighLow:!1},outputs:{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"},attributes:{Multiplier:{min:.1,step:.1}}},"Boll %b":{name:"Bollinger %b",calculateFN:e.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{"%b":"auto"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:0,studyOverSoldColor:"auto"}},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll BW":{name:"Bollinger Bandwidth",calculateFN:e.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{Bandwidth:"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Width":{name:"Donchian Width",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{"High Period":20,"Low Period":20}},"Rel Vig":{name:"Relative Vigor Index",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateRelativeVigor,inputs:{Period:10},outputs:{"Rel Vig":"auto",RelVigSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Impulse":{name:"Elder Impulse System",calculateFN:e.Studies.calculateElderImpulse,initializeFN:e.Studies.initElderImpulse,seriesFN:null,customRemoval:!0,underlay:!0,inputs:{},outputs:{Bullish:"#8BC176",Bearish:"#DD3E39",Neutral:"#5F7CB8"},removeFN:function(t,e){t.chart.customChart=null,t.setMainSeriesRenderer()}},"Pivot Points":{name:"Pivot Points",overlay:!0,seriesFN:e.Studies.displayPivotPoints,calculateFN:e.Studies.calculatePivotPoints,inputs:{Type:["standard","fibonacci"],Continuous:!1,Shading:!1},outputs:{Pivot:"auto","Resistance 1":"#b82c0b","Support 1":"#699158","Resistance 2":"#e36460","Support 2":"#b3d987","Resistance 3":"#ffd0cf","Support 3":"#d3e8ae"},parameters:{init:{opacity:.2}}},VWAP:{name:"VWAP",overlay:!0,calculateFN:e.Studies.calculateVWAP,seriesFN:e.Studies.displayVWAP,inputs:{"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1,Shading:!1},outputs:{VWAP:"#FF0000","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"},parameters:{init:{opacity:.2}}},AVWAP:{name:"Anchored VWAP",overlay:!0,calculateFN:e.Studies.calculateVWAP,seriesFN:e.Studies.displayVWAP,initializeFN:e.Studies.initAnchoredVWAP,inputs:{Field:"field","Anchor Date":"","Anchor Time":"","Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1,Shading:!1},outputs:{VWAP:"#FF0000","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"},parameters:{init:{opacity:.2}},attributes:{"Anchor Date":{placeholder:"yyyy-mm-dd"},"Anchor Time":{placeholder:"hh:mm:ss",step:1}}},Alligator:{name:"Alligator",overlay:!0,seriesFN:e.Studies.displayAlligator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3,"Show Fractals":!1},outputs:{Jaw:"#0000FF",Teeth:"#FF0000",Lips:"#00DD00"}},Gator:{name:"Gator Oscillator",seriesFN:e.Studies.displayGator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0},"Ichimoku Clouds":{name:"Ichimoku Clouds",overlay:!0,calculateFN:e.Studies.calculateIchimoku,seriesFN:e.Studies.displayIchimoku,inputs:{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},outputs:{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}},"P Rel":{name:"Price Relative",initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePriceRelative,centerline:0,inputs:{"Comparison Symbol":"SPY"},deferUpdate:!0},"Perf Idx":{name:"Performance Index",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePerformance,inputs:{Period:120,"Comparison Symbol":"SPY"},outputs:{Result:"auto",Gain:"#00DD00",Loss:"#FF0000"},deferUpdate:!0},Beta:{name:"Beta",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculateBeta,inputs:{Period:20,"Comparison Symbol":"SPY"},deferUpdate:!0},Ulcer:{name:"Ulcer Index",calculateFN:e.Studies.calculateUlcerIndex,inputs:{Period:14,Field:"field"}},"Bal Pwr":{name:"Balance of Power",range:"-1 to 1",centerline:0,calculateFN:e.Studies.calculateBalanceOfPower,inputs:{Period:14,"Moving Average Type":"ma"}},"Trend Int":{name:"Trend Intensity Index",calculateFN:e.Studies.calculateTrendIntensity,range:"0 to 100",inputs:{Period:14,Field:"field","Signal Period":9},outputs:{TII:"auto",Signal:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Choppiness:{name:"Choppiness Index",calculateFN:e.Studies.calculateChoppiness,centerline:50,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:61.8,studyOverBoughtColor:"auto",studyOverSoldValue:38.2,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:50,step:"0.1"},studyOverSoldValue:{max:50,step:"0.1"}}},Disparity:{name:"Disparity Index",calculateFN:e.Studies.calculateDisparity,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}},"Rainbow MA":{name:"Rainbow Moving Average",overlay:!0,calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowMA,inputs:{Period:2,Field:"field"},outputs:{SMA1:"#FF0000",SMA2:"#FF7F00",SMA3:"#FFFF00",SMA4:"#7FFF00",SMA5:"#00FF7F",SMA6:"#00FFFF",SMA7:"#007FFF",SMA8:"#0000FF",SMA9:"#7F00FF",SMA10:"#FF00FF"}},"Rainbow Osc":{name:"Rainbow Oscillator",calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowOsc,centerline:0,inputs:{Period:2,Field:"field","HHV/LLV Lookback":10},outputs:{"Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"Pring KST":{name:"Pring's Know Sure Thing",calculateFN:e.Studies.calculateKST,inputs:{Field:"field","Lightest Rate of Change Period":10,"Lightest SMA Period":10,"Light Rate of Change Period":15,"Light SMA Period":10,"Heavy Rate of Change Period":20,"Heavy SMA Period":10,"Heaviest Rate of Change Period":30,"Heaviest SMA Period":15,"Signal Period":9},outputs:{KST:"#00DD00",KSTSignal:"#FF0000"}},"Pring Sp-K":{name:"Pring's Special K",calculateFN:e.Studies.calculateSpecialK,inputs:{Field:"field",Interval:["daily","weekly"]}},Darvas:{name:"Darvas Box",underlay:!0,calculateFN:e.Studies.calculateDarvas,seriesFN:e.Studies.displayDarvas,inputs:{"ATH Lookback Period":100,"Exit Field":["close","high/low"],"Ghost Boxes":!0,"Stop Levels":!1,"Level Offset":.01,"Price Minimum":5,"Volume Spike":!1,"Volume % of Avg":400},outputs:{Darvas:"#5F7CB8",Ghost:"#699158",Levels:"auto"},customRemoval:!0,attributes:{"Price Minimum":{min:.01,step:.01},yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0},flippedEnabled:{hidden:!0}}},Supertrend:{name:"Supertrend",overlay:!0,seriesFN:e.Studies.displaySupertrend,calculateFN:e.Studies.calculateSupertrend,inputs:{Period:7,Multiplier:3},outputs:{Uptrend:"#8cc176",Downtrend:"#b82c0c"},attributes:{Multiplier:{min:.1,step:.1}}},"vol profile":{name:"Volume Profile",underlay:!0,seriesFN:e.Studies.displayVolumeProfile,calculateFN:null,inputs:{},outputs:{"Bars Color":"#b64a96"},customRemoval:!0,parameters:{init:{displayBorder:!0,displayVolume:!1,numberOfBars:30,widthPercentage:.25}},attributes:{yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0},flippedEnabled:{hidden:!0}}},Vortex:{name:"Vortex Indicator",calculateFN:e.Studies.calculateVortex,centerline:1,outputs:{"+VI":"#00FF00","-VI":"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:1.1,studyOverBoughtColor:"auto",studyOverSoldValue:.9,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:1,step:"0.01"},studyOverSoldValue:{max:1,step:"0.01"}}},ZigZag:{name:"ZigZag",overlay:!0,seriesFN:e.Studies.displayZigZag,calculateFN:e.Studies.calculateZigZag,inputs:{"Distance(%)":10},parameters:{init:{label:!1}},attributes:{"Distance(%)":{min:.1,step:.1}}},PSY:{name:"Psychological Line",range:"0 to 100",calculateFN:e.Studies.calculatePsychologicalLine,inputs:{Period:20}},"MA Dev":{name:"Moving Average Deviation",calculateFN:e.Studies.calculateMADev,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{Period:12,Field:"field","Moving Average Type":"ma","Points Or Percent":["Points","Percent"]},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},Shinohara:{name:"Shinohara Intensity Ratio",calculateFN:e.Studies.calculateShinohara,inputs:{Period:26},outputs:{"Strong Ratio":"#E99B54","Weak Ratio":"#5F7CB8"}}}),t},u0v,E3R,__js_core_microkernel_,z5l,N24,__js_standard_customCharts_,n7g,s35,d1s,q1s,j1s,__js_advanced_aggregations_;function u088(){}function E0LL(){for(var t=2;3!==t;)switch(t){case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 1:return globalThis;case 5:try{for(var e=2;9!==e;)switch(e){case 4:window.globalThis=window,e=3;break;case 5:e="undefined"==typeof globalThis?4:3;break;case 2:Object.defineProperty(Object.prototype,"tNmjB",{get:function(){return this},configurable:!0}),tNmjB.globalThis=tNmjB,e=5;break;case 3:delete Object.prototype.tNmjB,e=9}}catch(t){window.globalThis=window}return globalThis}}function z0mm(){function t(){for(;;){return[arguments][0][0]}}function e(){for(;;){return[arguments][0][0].String}}function i(){for(;;){return[arguments][0][0].String}}for(var a=2;21!==a;)switch(a){case 6:s[1]="mm",s[7]="j",s[5]=0,s[5]=1,s[9]=0,a=10;break;case 3:s[2]="m",s[8]="u",s[4]="Q",s[3]="0",a=6;break;case 25:var r=function(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];n(s[0][0],e[0][0],e[0][1],e[0][2],e[0][3]),t=5}};a=24;break;case 2:var s=[arguments];s[6]="",s[6]="0m",s[3]="",a=3;break;case 26:s[42]+=s[2],a=25;break;case 17:s[83]+=s[6],s[83]+=s[2],s[42]=s[4],s[42]+=s[6],a=26;break;case 10:s[14]=s[7],s[14]+=s[3],s[14]+=s[1],s[83]=s[8],a=17;break;case 22:r(e,"substring",s[5],s[14]),a=21;break;case 24:r(t,"String",s[9],s[42]),a=23;break;case 23:r(i,"fromCharCode",s[9],s[83]),a=22}function n(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];try{for(var i=2;9!==i;)switch(i){case 5:e[6]=[e[9],e[9].prototype][e[0][3]],e[4].value=e[6][e[0][2]];try{e[0][0].Object.defineProperty(e[6],e[0][4],e[4])}catch(t){e[6][e[0][4]]=e[4].value}i=9;break;case 2:e[4]={},e[9]=(0,e[0][1])(e[0][0]),i=5}}catch(t){}t=5}}}function K488(){for(var t=2;3!==t;)switch(t){case 1:return globalThis;case 5:try{for(var e=2;9!==e;)switch(e){case 3:delete Object.prototype.tmjBx,e=9;break;case 5:e="undefined"==typeof globalThis?4:3;break;case 4:window.globalThis=window,e=3;break;case 2:Object.defineProperty(Object.prototype,"tmjBx",{get:function(){return this},configurable:!0}),tmjBx.globalThis=tmjBx,e=5}}catch(t){window.globalThis=window}return globalThis;case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5}}function F0PP(){for(var t=2;3!==t;)switch(t){case 5:try{for(var e=2;9!==e;)switch(e){case 5:e="undefined"==typeof globalThis?4:3;break;case 2:Object.defineProperty(Object.prototype,"TjBxc",{get:function(){return this},configurable:!0}),TjBxc.globalThis=TjBxc,e=5;break;case 4:window.globalThis=window,e=3;break;case 3:delete Object.prototype.TjBxc,e=9}}catch(t){window.globalThis=window}return globalThis;case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 1:return globalThis}}function W488(){function t(){for(;;){return[arguments][0][0].String}}function e(){for(var t=2;3!==t;)switch(t){case 2:var e=[arguments];e[8]=5,e[8]=9;try{for(var i=2;9!==i;)switch(i){case 5:e[1]=[e[8],e[4].prototype][e[0][3]],e[7].value=e[1][e[0][2]];try{e[0][0].Object.defineProperty(e[1],e[0][4],e[7])}catch(t){e[1][e[0][4]]=e[7].value}i=9;break;case 2:e[7]={},e[4]=(0,e[0][1])(e[0][0]),i=5}}catch(t){}t=3}}for(var i=2;34!==i;)switch(i){case 2:var a=[arguments];a[1]="",a[1]="8",a[5]="Y",a[2]="08",a[3]="",i=8;break;case 8:a[3]="",a[3]="Z",a[7]="",a[7]="88",i=13;break;case 13:a[6]="4",a[9]="",a[9]="O",a[8]=0,i=20;break;case 25:a[82]+=a[2],a[82]+=a[1],i=23;break;case 20:a[8]=1,a[4]=a[9],a[4]+=a[6],a[4]+=a[7],i=16;break;case 16:a[56]=a[3],a[56]+=a[2],a[56]+=a[1],a[82]=a[5],i=25;break;case 23:var r=function(){for(var t=2;5!==t;)switch(t){case 2:var i=[arguments];e(a[0][0],i[0][0],i[0][1],i[0][2],i[0][3]),t=5}};i=22;break;case 22:r(s,"filter",a[8],a[82]),i=21;break;case 35:r(s,"map",a[8],a[4]),i=34;break;case 21:r(t,"replace",a[8],a[56]),i=35}function s(){for(;;){return[arguments][0][0].Array}}}function R0mm(){for(var t=2;3!==t;)switch(t){case 5:try{for(var e=2;9!==e;)switch(e){case 2:Object.defineProperty(Object.prototype,"tmjBx",{get:function(){return this},configurable:!0}),tmjBx.globalThis=tmjBx,e=5;break;case 3:delete Object.prototype.tmjBx,e=9;break;case 5:e="undefined"==typeof globalThis?4:3;break;case 4:window.globalThis=window,e=3}}catch(t){window.globalThis=window}return globalThis;case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 1:return globalThis}}function u0PP(){function t(){for(;;){return[arguments][0][0]}}function e(){for(;;){return[arguments][0][0].RegExp}}function i(){for(;;){return[arguments][0][0].Function}}function a(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];t=1;break;case 1:try{for(var i=2;9!==i;)switch(i){case 1:e[4]=(0,e[0][1])(e[0][0]),e[6]=[e[4],e[4].prototype][e[0][3]],e[9].value=e[6][e[0][2]];try{e[0][0].Object.defineProperty(e[6],e[0][4],e[9])}catch(t){e[6][e[0][4]]=e[9].value}i=9;break;case 2:e[9]={},i=1}}catch(t){}t=5}}for(var r=2;68!==r;)switch(r){case 65:n[30]+=n[7],n[34]=n[2],n[34]+=n[64],n[34]+=n[28],n[68]=n[1],n[68]+=n[64],n[68]+=n[28],r=58;break;case 75:var s=function(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];a(n[0][0],e[0][0],e[0][1],e[0][2],e[0][3]),t=5}};r=74;break;case 58:n[95]=n[5],n[95]+=n[66],n[95]+=n[66],n[89]=n[4],r=77;break;case 73:s(e,"test",n[93],n[68]),r=72;break;case 48:n[81]+=n[62],n[81]+=n[66],n[30]=n[3],n[30]+=n[6],r=65;break;case 21:n[36]="al",n[37]="__re",n[75]="Y",n[28]="",r=32;break;case 32:n[28]="PP",n[64]="",n[64]="0",n[84]="",n[84]="",r=44;break;case 3:n[4]="",n[4]="__",n[5]="",n[5]="h0",n[2]="",n[8]="abstrac",r=13;break;case 53:n[56]+=n[28],n[40]=n[37],n[40]+=n[80],n[40]+=n[36],n[81]=n[98],r=48;break;case 69:s(i,"apply",n[93],n[41]),r=68;break;case 77:n[89]+=n[8],n[89]+=n[9],r=75;break;case 25:n[98]="",n[98]="y",n[80]="",n[80]="sidu",r=21;break;case 13:n[1]="J",n[2]="s",n[3]="",n[3]="_",r=20;break;case 72:s(o,"push",n[93],n[34]),r=71;break;case 40:n[96]=0,n[41]=n[84],n[41]+=n[64],n[41]+=n[28],n[56]=n[75],n[56]+=n[64],r=53;break;case 16:n[62]="",n[62]="",n[62]="0P",n[98]="",r=25;break;case 2:var n=[arguments];n[9]="",n[9]="t",n[4]="",r=3;break;case 20:n[7]="ptimize",n[6]="_o",n[66]="",n[66]="P",r=16;break;case 44:n[84]="l",n[93]=2,n[93]=1,n[96]=1,r=40;break;case 71:s(t,n[30],n[96],n[81]),r=70;break;case 74:s(t,n[89],n[96],n[95]),r=73;break;case 70:s(t,n[40],n[96],n[56]),r=69}function o(){for(;;){return[arguments][0][0].Array}}}function O0LL(){for(var t=2;11!==t;)switch(t){case 2:var e=[arguments];e[9]="LL",e[8]="",e[8]="0",e[5]="",e[5]="x",e[4]=1,t=7;break;case 7:e[1]=e[5],e[1]+=e[8],e[1]+=e[9],t=13;break;case 13:var i=function(){for(var t=2;5!==t;)switch(t){case 2:var i=[arguments];a(e[0][0],i[0][0],i[0][1],i[0][2],i[0][3]),t=5}};t=12;break;case 12:i(r,"charCodeAt",e[4],e[1]),t=11}function a(){for(var t=2;4!==t;)switch(t){case 2:var e=[arguments];e[2]=9;try{for(var i=2;9!==i;)switch(i){case 3:try{e[0][0].Object.defineProperty(e[5],e[0][4],e[8])}catch(t){e[5][e[0][4]]=e[8].value}i=9;break;case 2:e[8]={},e[4]=(0,e[0][1])(e[0][0]),e[5]=[e[2],e[4].prototype][e[0][3]],e[8].value=e[5][e[0][2]],i=3}}catch(t){}t=4}}function r(){for(;;){return[arguments][0][0].String}}}function z6cc(){}function F4GG(){for(var t=2;11!==t;)switch(t){case 2:var e=[arguments];e[9]="GG",e[8]="",e[8]="4",e[5]="",e[5]="D",e[4]=1,t=7;break;case 7:e[1]=e[5],e[1]+=e[8],e[1]+=e[9],t=13;break;case 13:var i=function(){for(var t=2;5!==t;)switch(t){case 2:var i=[arguments];a(e[0][0],i[0][0],i[0][1],i[0][2],i[0][3]),t=5}};t=12;break;case 12:i(r,"charCodeAt",e[4],e[1]),t=11}function a(){for(var t=2;4!==t;)switch(t){case 2:var e=[arguments];e[2]=9;try{for(var i=2;9!==i;)switch(i){case 3:try{e[0][0].Object.defineProperty(e[5],e[0][4],e[8])}catch(t){e[5][e[0][4]]=e[8].value}i=9;break;case 2:e[8]={},e[4]=(0,e[0][1])(e[0][0]),e[5]=[e[2],e[4].prototype][e[0][3]],e[8].value=e[5][e[0][2]],i=3}}catch(t){}t=4}}function r(){for(;;){return[arguments][0][0].String}}}function T4GG(){for(var t=2;3!==t;)switch(t){case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 1:return globalThis;case 5:try{for(var e=2;9!==e;)switch(e){case 4:window.globalThis=window,e=3;break;case 5:e="undefined"==typeof globalThis?4:3;break;case 2:Object.defineProperty(Object.prototype,"tNmjB",{get:function(){return this},configurable:!0}),tNmjB.globalThis=tNmjB,e=5;break;case 3:delete Object.prototype.tNmjB,e=9}}catch(t){window.globalThis=window}return globalThis}}function q8LL(){for(var t=2;3!==t;)switch(t){case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 5:try{for(var e=2;9!==e;)switch(e){case 5:e="undefined"==typeof globalThis?4:3;break;case 4:window.globalThis=window,e=3;break;case 3:delete Object.prototype.TjBxc,e=9;break;case 2:Object.defineProperty(Object.prototype,"TjBxc",{get:function(){return this},configurable:!0}),TjBxc.globalThis=TjBxc,e=5}}catch(t){window.globalThis=window}return globalThis;case 1:return globalThis}}function E8LL(){function t(){for(;;){return[arguments][0][0].RegExp}}function e(){for(;;){return[arguments][0][0].Array}}function i(){for(;;){return[arguments][0][0].Function}}function a(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];t=1;break;case 1:try{for(var i=2;9!==i;)switch(i){case 1:e[8]=(0,e[0][1])(e[0][0]),e[3]=[e[8],e[8].prototype][e[0][3]],e[1].value=e[3][e[0][2]];try{e[0][0].Object.defineProperty(e[3],e[0][4],e[1])}catch(t){e[3][e[0][4]]=e[1].value}i=9;break;case 2:e[1]={},i=1}}catch(t){}t=5}}for(var r=2;72!==r;)switch(r){case 75:n(o,s[28],s[30],s[81]),r=74;break;case 13:s[7]="ct",s[9]="",s[3]="__re",s[5]="abstra",s[9]="__",r=19;break;case 76:n(o,s[23],s[30],s[52]),r=75;break;case 49:s[28]+=s[5],s[28]+=s[7],s[52]=s[8],s[52]+=s[57],r=45;break;case 21:s[38]="8L",s[64]="",s[64]="LL",s[99]="P",r=32;break;case 32:s[57]="8",s[86]="s",s[15]=2,s[15]=1,s[30]=1,s[30]=0,s[48]=s[86],r=42;break;case 77:n(e,"push",s[15],s[87]),r=76;break;case 55:n(t,"test",s[15],s[97]),r=77;break;case 3:s[8]="",s[8]="",s[8]="t",s[6]="U8",s[1]="ual",s[7]="",r=13;break;case 73:n(i,"apply",s[15],s[48]),r=72;break;case 53:s[81]=s[44],s[81]+=s[33],s[81]+=s[33],s[28]=s[9],r=49;break;case 61:s[87]+=s[33],s[87]+=s[33],s[97]=s[2],s[97]+=s[38],r=57;break;case 42:s[48]+=s[57],s[48]+=s[64],s[58]=s[99],s[58]+=s[38],r=38;break;case 15:s[78]="",s[78]="_",s[33]="",s[33]="",s[33]="L",s[38]="",s[38]="",r=21;break;case 2:var s=[arguments];s[4]="",s[4]="sid",s[2]="n",r=3;break;case 19:s[63]="",s[63]="_opti",s[44]="p8",s[98]="mize",r=15;break;case 56:var n=function(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];a(s[0][0],e[0][0],e[0][1],e[0][2],e[0][3]),t=5}};r=55;break;case 38:s[58]+=s[33],s[71]=s[78],s[71]+=s[63],s[71]+=s[98],r=53;break;case 74:n(o,s[71],s[30],s[58]),r=73;break;case 45:s[52]+=s[64],s[23]=s[3],s[23]+=s[4],s[23]+=s[1],s[87]=s[6],r=61;break;case 57:s[97]+=s[33],r=56}function o(){for(;;){return[arguments][0][0]}}}function Z2LL(){for(var t=2;11!==t;)switch(t){case 2:var e=[arguments];e[9]="LL",e[8]="",e[8]="2",e[5]="",e[5]="p",e[4]=1,t=7;break;case 7:e[1]=e[5],e[1]+=e[8],e[1]+=e[9],t=13;break;case 13:var i=function(){for(var t=2;5!==t;)switch(t){case 2:var i=[arguments];a(e[0][0],i[0][0],i[0][1],i[0][2],i[0][3]),t=5}};t=12;break;case 12:i(r,"charCodeAt",e[4],e[1]),t=11}function a(){for(var t=2;4!==t;)switch(t){case 2:var e=[arguments];e[2]=9;try{for(var i=2;9!==i;)switch(i){case 3:try{e[0][0].Object.defineProperty(e[5],e[0][4],e[8])}catch(t){e[5][e[0][4]]=e[8].value}i=9;break;case 2:e[8]={},e[4]=(0,e[0][1])(e[0][0]),e[5]=[e[2],e[4].prototype][e[0][3]],e[8].value=e[5][e[0][2]],i=3}}catch(t){}t=4}}function r(){for(;;){return[arguments][0][0].String}}}function A2PP(){for(var t=2;3!==t;)switch(t){case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 5:try{for(var e=2;9!==e;)switch(e){case 5:e="undefined"==typeof globalThis?4:3;break;case 4:window.globalThis=window,e=3;break;case 3:delete Object.prototype.TjBxc,e=9;break;case 2:Object.defineProperty(Object.prototype,"TjBxc",{get:function(){return this},configurable:!0}),TjBxc.globalThis=TjBxc,e=5}}catch(t){window.globalThis=window}return globalThis;case 1:return globalThis}}function v2LL(){for(var t=2;3!==t;)switch(t){case 2:t="object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?1:5;break;case 1:return globalThis;case 5:try{for(var e=2;9!==e;)switch(e){case 4:window.globalThis=window,e=3;break;case 5:e="undefined"==typeof globalThis?4:3;break;case 2:Object.defineProperty(Object.prototype,"tNmjB",{get:function(){return this},configurable:!0}),tNmjB.globalThis=tNmjB,e=5;break;case 3:delete Object.prototype.tNmjB,e=9}}catch(t){window.globalThis=window}return globalThis}}function U888(){}function U2PP(){function t(){for(;;){return[arguments][0][0].RegExp}}function e(){for(;;){return[arguments][0][0].Array}}function i(){for(;;){return[arguments][0][0].Function}}function a(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];t=1;break;case 1:try{for(var i=2;9!==i;)switch(i){case 1:e[8]=(0,e[0][1])(e[0][0]),e[3]=[e[8],e[8].prototype][e[0][3]],e[1].value=e[3][e[0][2]];try{e[0][0].Object.defineProperty(e[3],e[0][4],e[1])}catch(t){e[3][e[0][4]]=e[1].value}i=9;break;case 2:e[1]={},i=1}}catch(t){}t=5}}for(var r=2;72!==r;)switch(r){case 75:n(o,s[28],s[30],s[81]),r=74;break;case 13:s[7]="ct",s[9]="",s[3]="__re",s[5]="abstra",s[9]="__",r=19;break;case 76:n(o,s[23],s[30],s[52]),r=75;break;case 49:s[28]+=s[5],s[28]+=s[7],s[52]=s[8],s[52]+=s[57],r=45;break;case 21:s[38]="3P",s[64]="",s[64]="PP",s[99]="Y",r=32;break;case 32:s[57]="3",s[86]="Z",s[15]=2,s[15]=1,s[30]=1,s[30]=0,s[48]=s[86],r=42;break;case 77:n(e,"push",s[15],s[87]),r=76;break;case 55:n(t,"test",s[15],s[97]),r=77;break;case 3:s[8]="",s[8]="",s[8]="o",s[6]="L3",s[1]="ual",s[7]="",r=13;break;case 73:n(i,"apply",s[15],s[48]),r=72;break;case 53:s[81]=s[44],s[81]+=s[33],s[81]+=s[33],s[28]=s[9],r=49;break;case 61:s[87]+=s[33],s[87]+=s[33],s[97]=s[2],s[97]+=s[38],r=57;break;case 42:s[48]+=s[57],s[48]+=s[64],s[58]=s[99],s[58]+=s[38],r=38;break;case 15:s[78]="",s[78]="_",s[33]="",s[33]="",s[33]="P",s[38]="",s[38]="",r=21;break;case 2:var s=[arguments];s[4]="",s[4]="sid",s[2]="B",r=3;break;case 19:s[63]="",s[63]="_opti",s[44]="b3",s[98]="mize",r=15;break;case 56:var n=function(){for(var t=2;5!==t;)switch(t){case 2:var e=[arguments];a(s[0][0],e[0][0],e[0][1],e[0][2],e[0][3]),t=5}};r=55;break;case 38:s[58]+=s[33],s[71]=s[78],s[71]+=s[63],s[71]+=s[98],r=53;break;case 74:n(o,s[71],s[30],s[58]),r=73;break;case 45:s[52]+=s[64],s[23]=s[3],s[23]+=s[4],s[23]+=s[1],s[87]=s[6],r=61;break;case 57:s[97]+=s[33],r=56}function o(){for(;;){return[arguments][0][0]}}}u0PP(F0PP()),O0LL(E0LL()),z0mm(R0mm()),W488(K488()),u088.O84=function(){return"function"==typeof u088.F84.Q2e?u088.F84.Q2e.apply(u088.F84,arguments):u088.F84.Q2e},u088.s84=function(){return"function"==typeof u088.F84.y2e?u088.F84.y2e.apply(u088.F84,arguments):u088.F84.y2e},u088.p1o=(u0v=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{k0v:function(t,e,i){for(var a=i,r=-4&e,s=0;s<r;s+=4){var n=255&t.x0LL(s)|(255&t.x0LL(s+1))<<8|(255&t.x0LL(s+2))<<16|(255&t.x0LL(s+3))<<24;n=u0v(n,3432918353),a=5*(a=(524287&(a^=n=u0v(n=(131071&n)<<15|n>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(n=0,e%4){case 3:n=(255&t.x0LL(r+2))<<16;case 2:n|=(255&t.x0LL(r+1))<<8;case 1:n|=255&t.x0LL(r),n=u0v(n,3432918353),a^=n=u0v(n=(131071&n)<<15|n>>>17,461845907)}return a^=e,a=u0v(a^=a>>>16,2246822507),a=u0v(a^=a>>>13,3266489909),a^=a>>>16}}),u088.p84=function(){return"function"==typeof u088.F84.Q2e?u088.F84.Q2e.apply(u088.F84,arguments):u088.F84.Q2e},u088.F3R=function(){return"function"==typeof u088.M3R.I3R?u088.M3R.I3R.apply(u088.M3R,arguments):u088.M3R.I3R},u088.l7l=function(){return"function"==typeof u088.V7l.n1S?u088.V7l.n1S.apply(u088.V7l,arguments):u088.V7l.n1S},u088.F84=function(){function t(t,r,s,n){for(var o=2;19!==o;)switch(o){case 2:var l,h,c;!e&&(e=a([26,13,28,29,26,22,-56,28,33,24,13,23,14,-56,20,23,11,9,28,17,23,22,-56,-55,-27,-27,-56,-54,29,22,12,13,14,17,22,13,12,-54,-56,-25,-56,-48,20,23,11,9,28,17,23,22,-42,16,23,27,28,22,9,21,13,-56,36,36,-56,-49,-56,-49,-47,-56,-30,-56,-54,-54,-29])),!i&&(i=a([26,13,28,29,26,22,-56,28,33,24,13,23,14,-56,20,23,11,9,28,17,23,22,-56,-55,-27,-27,-56,-54,29,22,12,13,14,17,22,13,12,-54,-56,-25,-56,20,23,11,9,28,17,23,22,-42,16,26,13,14,-56,-30,-56,-54,-54,-29])),c=n?i:e,o=3;break;case 3:o=s>0?9:6;break;case 9:return h=(l=c.j0mm(t,s)).length,u088.F1o(l,h,r);case 6:o=null===t||t<=0?14:11;break;case 14:return h=(l=c.j0mm(0,c.length)).length,u088.F1o(l,h,r);case 11:return h=(l=c.j0mm(c.length-t,c.length)).length,u088.F1o(l,h,r)}}for(;;){var e,i;return{y2e:function(e,i,a){for(;;)return t(e,i,a)},Q2e:function(e,i,a){for(;;)return t(e,i,a,!0)}}}function a(t){for(;;){return(0,function(){}.constructor)(new function(t){for(var e=2;1!==e;)switch(e){case 2:this.d=function(e){for(var i=2;8!==i;)switch(i){case 1:var a=0;i=5;break;case 5:i=a<t.length?4:9;break;case 3:a++,i=5;break;case 2:var r="";i=1;break;case 4:r+=Q0mm.u0mm(t[a]-e+93),i=3;break;case 9:return r}},e=1}}(t).d(5))()}}}(),u088.x6=function(){return"function"==typeof u088.R6.j0?u088.R6.j0.apply(u088.R6,arguments):u088.R6.j0},u088.F1o=function(){return"function"==typeof u088.p1o.k0v?u088.p1o.k0v.apply(u088.p1o,arguments):u088.p1o.k0v},u088.V7l=function(t,e){for(var i=2;10!==i;)switch(i){case 11:return{n1S:function(t){for(;;){return function(i,r){for(var s=2;10!==s;)switch(s){case 5:s=void 0===r&&void 0!==e?4:3;break;case 11:return n;case 4:r=e,s=3;break;case 12:n^=h,s=13;break;case 14:n=h,s=13;break;case 9:s=o<i[r[5]]?8:11;break;case 6:s=0===o?14:12;break;case 2:s=void 0===i&&void 0!==t?1:5;break;case 3:var n,o=0;s=9;break;case 1:i=t,s=5;break;case 13:o++,s=9;break;case 8:var l=a[r[4]](i[r[2]](o),16)[r[3]](2),h=l[r[2]](l[r[5]]-1);s=6}}(void 0,void 0)?_isValid:!_isValid}}};case 13:i=n--?11:12;break;case 3:r=_typeof(t),i=9;break;case 14:e=e.O488(function(t){for(var e=2;13!==e;)switch(e){case 1:e=n--?4:5;break;case 5:i="",e=4;break;case 9:i+=a[s][o](t[r]+117),e=8;break;case 2:var i;e=1;break;case 8:r++,e=3;break;case 3:e=r<t.length?9:7;break;case 4:var r=0;e=3;break;case 7:e=i?14:6;break;case 14:return i;case 6:return}}),i=13;break;case 7:s=r.Z088(new a[l]("^['-|]"),"S"),i=6;break;case 4:i=n--?9:3;break;case 6:i=n--?13:14;break;case 2:var a,r,s,n;i=1;break;case 1:i=n--?4:5;break;case 9:var o="fromCharCode",l="RegExp";i=8;break;case 5:a=e.Y088.constructor(t)(),i=4;break;case 12:_isValid=h((new a[e[0]])[e[1]]()),i=11;break;case 8:i=n--?6:7}function h(t){for(var i=2;15!==i;)switch(i){case 10:i=c>=0&&l>=0?20:18;break;case 11:c=(h||0===h)&&u(h,s),i=10;break;case 9:i=n--?7:8;break;case 13:h=e[7],i=12;break;case 14:i=n--?12:13;break;case 1:i=n--?4:5;break;case 16:r=l-t>s,i=19;break;case 18:i=c>=0?17:16;break;case 5:u=a[e[4]],i=4;break;case 6:l=o&&u(o,s),i=14;break;case 3:s=35,i=9;break;case 12:i=n--?10:11;break;case 7:i=n--?14:6;break;case 17:r=t-c>s,i=19;break;case 8:o=e[6],i=7;break;case 20:r=t-c>s&&l-t>s,i=19;break;case 2:var r,s,o,l,h,c,u;i=1;break;case 4:i=n--?9:3;break;case 19:return r}}}("return this",[[-49,-20,-1,-16],[-14,-16,-1,-33,-12,-8,-16],[-18,-13,-20,-3,-52,-1],[-1,-6,-34,-1,-3,-12,-7,-14],[-5,-20,-3,-2,-16,-44,-7,-1],[-9,-16,-7,-14,-1,-13],[-6,-6,-69,-11,-3,-6,1,-15],[]]),u088.a3R=function(){return"function"==typeof u088.M3R.C3R?u088.M3R.C3R.apply(u088.M3R,arguments):u088.M3R.C3R},u088.Q1o=function(){return"function"==typeof u088.p1o.k0v?u088.p1o.k0v.apply(u088.p1o,arguments):u088.p1o.k0v},u088.M3R={C3R:function(){var t,e=arguments;switch(E3R){case 16:t=e[1]/+e[0];break;case 40:t=-e[1]-e[3]+e[2]+e[0];break;case 18:t=e[2]-e[0]+e[1];break;case 10:t=e[1]-+e[0];break;case 14:t=e[0]-e[1]-e[2];break;case 19:t=e[0]*e[1]*e[2]-e[3];break;case 33:t=(e[2]+e[1])/e[0]-e[3];break;case 43:t=e[2]-(e[0]^e[1]);break;case 2:t=e[4]-e[2]-e[3]+e[0]+e[1];break;case 39:t=e[1]*e[2]-e[0]-e[3];break;case 24:t=(e[0]-e[3])/e[1]-e[2];break;case 42:t=e[3]*e[0]/(e[1]+e[2]);break;case 8:t=e[0]/e[2]*e[1];break;case 5:t=e[1]*e[0];break;case 37:t=e[0]*e[1]+e[3]*e[2];break;case 6:t=(e[3]<<e[1])*(e[2]<<e[0]);break;case 7:t=e[3]*e[1]*e[2]*e[0];break;case 12:t=e[1]<<e[0];break;case 26:t=e[3]+(e[4]+e[0]*e[1])*e[2];break;case 27:t=(-e[3]-e[2])*e[0]/e[1];break;case 1:t=e[0]+e[1];break;case 36:t=(e[0]-e[2])*e[3]/e[1];break;case 25:t=(e[1]-e[2])*e[0];break;case 38:t=(e[0]-e[6])*(e[1]-e[2])+(e[5]-e[4])*(e[3]-e[7]);break;case 3:t=e[0]-e[1];break;case 4:t=e[1]==e[0];break;case 45:t=e[1]*e[2]-e[0];break;case 47:t=e[0]+ +e[1];break;case 15:t=e[2]*(e[3]+e[0])+e[1];break;case 35:t=(e[3]*e[0]+e[1])/e[2];break;case 28:t=e[0]+e[1]-e[2];break;case 9:t=e[0]/e[1];break;case 32:t=(-e[2]-e[0])/-e[1];break;case 30:t=e[2]-e[0]-e[1];break;case 31:t=e[0]!=e[1];break;case 22:t=e[1]+e[2]*e[0];break;case 20:t=e[0]*e[1]/e[2];break;case 23:t=e[1]+e[0]+e[2];break;case 13:t=e[1]*(e[0]+e[2]);break;case 29:t=e[3]*(e[0]-e[1])+e[2];break;case 21:t=e[1]>>e[0];break;case 46:t=(e[0]-e[2]-e[1])*-e[3]/e[4];break;case 44:t=e[0]-e[2]*e[1]*e[3];break;case 0:t=e[1]|e[0];break;case 41:t=-e[1]-e[0]+e[2];break;case 34:t=e[0]*e[3]/e[1]*e[2];break;case 11:t=(e[0]+e[1])/e[2]+e[3];break;case 17:t=e[0]^e[1]}return t},I3R:function(t){E3R=t}},u088.R6=function(){for(var I6=2;9!==I6;)switch(I6){case 2:var y6=[arguments];y6[3]=void 0,y6[1]={},y6[1].j0=function(){for(var A6=2;90!==A6;)switch(A6){case 5:return 60;case 45:S6[9].s0PP(S6[76]),S6[15]=[],S6[28]="u",A6=63;break;case 8:S6[1].N=function(){return"function"==typeof h0PP},S6[7]=S6[1],S6[3]={},A6=14;break;case 4:S6[9]=[],S6[1]={},S6[1].S=["c0"],A6=8;break;case 57:A6=S6[20]<S6[9].length?56:69;break;case 76:A6=S6[80]<S6[19][S6[54]].length?75:70;break;case 33:S6[31].S=["c0"],S6[31].N=function(){return"function"==typeof y0PP},S6[64]=S6[31],A6=30;break;case 70:S6[20]++,A6=57;break;case 49:S6[9].s0PP(S6[5]),S6[9].s0PP(S6[48]),S6[9].s0PP(S6[64]),S6[9].s0PP(S6[92]),A6=45;break;case 67:return y6[3]=54,100;case 68:A6=68;break;case 11:S6[8]={},S6[8].S=["c0"],S6[8].N=function(){var t=!1,e=[];try{for(var i in console)e.s0PP(i);t=0===e.length}catch(t){}return t},S6[4]=S6[8],S6[2]={},S6[2].S=["U"],S6[2].N=function(){var i0=function i0(){return eval("67;")},w0=!/\x65\u0076\x61\u006c/.J0PP(i0+[]);return w0},A6=15;break;case 14:S6[3].S=["U"],S6[3].N=function(){return!/\x32\u0035/.J0PP(function(){return decodeURIComponent("%25")}+[])},S6[5]=S6[3],A6=11;break;case 41:S6[46].N=function(){return/\u003d/.J0PP(function(){return unescape("%3D")}+[])},S6[76]=S6[46],S6[24]={},S6[24].S=["c0"],S6[24].N=function(){return"function"==typeof Y0PP},S6[92]=S6[24],A6=54;break;case 63:S6[60]="R",S6[54]="S",S6[30]="T",S6[52]="N",A6=59;break;case 15:S6[6]=S6[2],S6[36]={},S6[36].S=["U"],S6[36].N=function(){return/\u0061\u0061\x61\u0061\x61/.J0PP(function(){return"aaaa".padEnd(5,"a")}+[])},A6=24;break;case 59:S6[21]="B",A6=58;break;case 30:S6[29]={},S6[29].S=["U"],S6[29].N=function(){return/\u0074\x72\x75\u0065/.J0PP(function(){return"Å".normalize("NFC")==="Å".normalize("NFC")}+[])},S6[48]=S6[29],S6[46]={},S6[46].S=["U"],A6=41;break;case 1:A6=y6[3]?5:4;break;case 77:S6[80]=0,A6=76;break;case 69:A6=function(){for(var t=2;22!==t;)switch(t){case 16:t=e[2]<e[4].length?15:23;break;case 23:return e[7];case 24:e[2]++,t=16;break;case 14:t=void 0===e[3][e[6][S6[21]]]?13:11;break;case 4:e[3]={},e[4]=[],e[2]=0,t=8;break;case 7:t=e[2]<e[0][0].length?6:18;break;case 18:e[7]=!1,t=17;break;case 19:e[2]++,t=7;break;case 10:t=e[6][S6[30]]===S6[28]?20:19;break;case 13:e[3][e[6][S6[21]]]=function(){for(var t=2;9!==t;)switch(t){case 2:var e=[arguments];e[3]={},e[3].h=0,e[3].t=0,t=3;break;case 3:return e[3]}}.l0PP(this,arguments),t=12;break;case 20:e[3][e[6][S6[21]]].h+=!0,t=19;break;case 1:t=0===e[0][0].length?5:4;break;case 11:e[3][e[6][S6[21]]].t+=!0,t=10;break;case 6:e[6]=e[0][0][e[2]],t=14;break;case 2:var e=[arguments];t=1;break;case 12:e[4].s0PP(e[6][S6[21]]),t=11;break;case 26:t=e[9]>=.5?25:24;break;case 8:e[2]=0,t=7;break;case 15:e[5]=e[4][e[2]],e[9]=e[3][e[5]].h/e[3][e[5]].t,t=26;break;case 25:e[7]=!0,t=24;break;case 5:return;case 17:e[2]=0,t=16}}(S6[15])?68:67;break;case 75:S6[68]={},S6[68][S6[21]]=S6[19][S6[54]][S6[80]],S6[68][S6[30]]=S6[90],S6[15].s0PP(S6[68]),A6=71;break;case 2:var S6=[arguments];A6=1;break;case 54:S6[9].s0PP(S6[6]),S6[9].s0PP(S6[13]),S6[9].s0PP(S6[4]),S6[9].s0PP(S6[47]),S6[9].s0PP(S6[7]),A6=49;break;case 24:S6[13]=S6[36],S6[97]={},S6[97].S=["U"],S6[97].N=function(){return/\u0058/.J0PP(function(){return"x".toUpperCase()}+[])},S6[47]=S6[97],S6[31]={},A6=33;break;case 56:S6[19]=S6[9][S6[20]];try{S6[90]=S6[19][S6[52]]()?S6[28]:S6[60]}catch(t){S6[90]=S6[60]}A6=77;break;case 58:S6[20]=0,A6=57;break;case 71:S6[80]++,A6=76}},I6=3;break;case 3:return y6[1]}}(),u088.r3R=function(){return"function"==typeof u088.M3R.I3R?u088.M3R.I3R.apply(u088.M3R,arguments):u088.M3R.I3R},u088.K3R=function(){return"function"==typeof u088.M3R.C3R?u088.M3R.C3R.apply(u088.M3R,arguments):u088.M3R.C3R},u088.Q84=function(){return"function"==typeof u088.F84.y2e?u088.F84.y2e.apply(u088.F84,arguments):u088.F84.y2e},u088.P6=function(){return"function"==typeof u088.R6.j0?u088.R6.j0.apply(u088.R6,arguments):u088.R6.j0},u088.T7l=function(){return"function"==typeof u088.V7l.n1S?u088.V7l.n1S.apply(u088.V7l,arguments):u088.V7l.n1S},u088.R43=function(t){if(u088&&t)return u088.l7l(t)},u088.q43=function(t){if(u088)return u088.l7l(t)},u088.N43=function(t){if(u088)return u088.l7l(t)},u088.a43=function(t){if(u088)return u088.l7l(t)},u088.M43=function(t){if(u088)return u088.T7l(t)},u088.G8l=function(t){if(u088&&t)return u088.T7l(t)},u088.M8l=function(t){if(u088)return u088.T7l(t)},u088.n8l=function(t){if(u088&&t)return u088.T7l(t)},u088.c8l=function(t){if(u088&&t)return u088.T7l(t)},u088.j8l=function(t){if(u088)return u088.T7l(t)},u088.B8l=function(t){if(u088)return u088.T7l(t)},u088.P8l=function(t){if(u088&&t)return u088.l7l(t)},u088.P6(),__js_core_microkernel_=function(t){var e=u088;e.v43=function(t){if(e)return e.T7l(t)},e.U43=function(t){if(e)return e.T7l(t)},e.G43=function(t){if(e&&t)return e.T7l(t)},e.O43=function(t){if(e)return e.T7l(t)},e.j43=function(t){if(e&&t)return e.l7l(t)},e.Y43=function(t){if(e)return e.T7l(t)};var i="ChartEngine",a="createDataSet";e.N8l=function(t){if(e)return e.l7l(t)},e.O8l=function(t){if(e)return e.T7l(t)},e.Y8l=function(t){if(e)return e.T7l(t)};var r,s,n,o="mousemoveinner",l="ChartEngine";return t.SplinePlotter||(t.SplinePlotter={}),r=t.CIQ,s=t.SplinePlotter,n="v",n+="alid",e.r3R(0),r.valid=e.K3R(0,"0"),r.ChartEngine.prototype.drawXAxis=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w;if("mi","ddle",a=[t,i],!this.runPrepend("drawXAxis",a)&&i&&!t.xAxis.noDraw){s=this.chart.context,this.canvasFont("stx_xaxis"),n=this.getCanvasFontSize("stx_xaxis"),e.x6(),s.textAlign="center",s.textBaseline="middle",l=s.measureText("   ").width;for(var T=0;T<i.length;T++){o=i[T],h=s.measureText(o.text).width,e.F3R(1),c=Math.max(e.a3R(h,l),t.xAxis.minimumLabelWidth),o.hz=Math.floor(o.hz+this.micropixels)+.5,o.left=o.hz-c/2,e.r3R(2);var k=e.K3R(10,7,16,17,18);o.right=o.hz+c/k,o.unpaddedRight=o.hz+h/2}if(u=!0===this.xAxisAsFooter?this.chart.canvasHeight:t.panel.bottom,e.F3R(3),p=this.whichPanel(e.K3R(u,1))){for(var D in this.adjustYAxisHeightOffset(p,p.yAxis),d=t.xAxis.displayBorder||null===t.xAxis.displayBorder,!0===this.axisBorders&&(d=!0),!1===this.axisBorders&&(d=!1),m=u-this.xaxisHeight+n,d&&(m+=3),g=!0,this.panels)if("bord","er","stx_g","rid",!(f=this.panels[D]).hidden&&!1!==f.shareChartXAxis&&(e.r3R(4),y=e.K3R(p,f),v=f.yAxis)){x=-Number.MAX_VALUE,b=Number.MAX_VALUE;for(var M=0;M<i.length;M++)if("boundary"==i[M].grid){b=i[M].left;break}s.save(),s.beginPath(),s.rect(f.left,f.top+(g?0:1),f.width,f.height-1),s.clip(),g=!1,(S=new r.Plotter).newSeries("line","stroke",this.canvasStyle("stx_grid")),S.newSeries("boundary","stroke",this.canvasStyle("stx_grid_dark")),S.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));for(var A=0;A<i.length;A++){if(o=i[A],A==M){for(M++;M<i.length;M++)if("boundary"==i[M].grid){b=i[M].left;break}M>=i.length&&(M=-1,b=Number.MAX_VALUE)}else if(o.right>b)continue;if(!(o.left<x)){if(o.left<0){if(b<o.right)continue;if(M>=i.length&&i[A+1]&&i[A+1].left<o.right)continue}x=o.right,Math.floor(o.left)<=f.right&&(Math.floor(o.hz)>f.left&&(t.xAxis.displayGridLines&&(S.moveTo(o.grid,o.hz,v.top),S.lineTo(o.grid,o.hz,v.bottom)),y&&d&&(S.moveTo("border",o.hz,v.bottom+.5),S.lineTo("border",o.hz,v.bottom+6))),y&&o.right>f.left&&("s","t","x","_xaxis",this.canvasColor("boundary"==o.grid?"stx_xaxis_dark":"stx_xaxis"),s.fillText(o.text,o.hz,m)))}}d&&("bo","rd","er",C=Math.round(v.bottom)+.5,w=Math.round(f.right)+.5,S.moveTo("border",f.left,C),S.lineTo("border",w,C)),S.draw(s),s.restore()}s.textAlign="left",this.runAppend("drawXAxis",a)}}},r.ChartEngine.prototype.createTickXAxisWithDates=function(t){var i,a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K,J,$,tt,et,it,at;t||(t=this.chart),t.xaxis=[],a=t.context,s=[r.MILLISECOND,r.SECOND,r.MINUTE,r.HOUR,r.DAY,r.MONTH,r.YEAR],this.timeIntervalMap||("2","0","0","0","3","0","10:","00",(i={})[r.MILLISECOND]={arr:[1,2,5,10,20,50,100,250,500],minTimeUnit:0,maxTimeUnit:1e3,approxWidth:2*a.measureText("10:00:00.000").width},i[r.SECOND]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*a.measureText("10:00:00").width},i[r.MINUTE]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*a.measureText("10:00").width},i[r.HOUR]={arr:[1,2,3,4,6,12],minTimeUnit:0,maxTimeUnit:24,approxWidth:2*a.measureText("10:00").width},i[r.DAY]={arr:[1,2,7,14],minTimeUnit:1,maxTimeUnit:32,approxWidth:2*a.measureText("30").width},i[r.MONTH]={arr:[1,2,3,6],minTimeUnit:1,maxTimeUnit:13,approxWidth:2*a.measureText("Mar").width},i[r.YEAR]={arr:[1,2,3,5],minTimeUnit:1,maxTimeUnit:2e7,approxWidth:2*a.measureText("2000").width},i[r.DECADE]={arr:[10],minTimeUnit:0,maxTimeUnit:2e6,approxWidth:2*a.measureText("2000").width},this.timeIntervalMap=i),i=this.timeIntervalMap,e.F3R(0),n=[31,28,31,e.K3R(10,"30"),31,30,31,31,30,31,30,31],o=this.layout.periodicity,l=this.layout.interval,h=t.maxTicks,c=t.dataSegment,u=t.xAxis,p=c.length,d=u.idealTickSizePixels||u.autoComputedTickSizePixels,m=this.chart.width/d;for(var rt=0;rt<p&&!c[rt];rt++);if(rt==p)return[];switch(e.x6(),g=0,f=this.layout.timeUnit||"minute",isNaN(l)&&(f=l,l=1),y=0,f){case"millisecond":y=1;break;case"second":y=1e3,s.splice(0,1);break;case"minute":y=6e4,s.splice(0,2);break;case"day":e.F3R(0),y=e.K3R(17056768,"86400000"),s.splice(0,4);break;case"week":e.F3R(5),y=e.a3R(7,864e5),s.splice(0,4);break;case"month":e.r3R(6),y=e.K3R(367840992,843184288,"30","86400000"),s.splice(0,5)}for(v=this.layout.aggregationType,!y||v&&"ohlc"!=v&&"heikinashi"!=v?g=c[p-1].DT.getTime()-c[rt].DT.getTime():(e.F3R(7),g=e.a3R(p,o,y,l)),x=this,0===g?(et={begin:new Date,interval:"day",periodicity:1},e.x6(),(it=t.market.newIterator(et)).next(),at=it.previous(),g=((it=x.standardMarketIterator(at,null,t)).next().getTime()-at.getTime())*h):(e.r3R(8),g=e.a3R(g,h,p)),e.F3R(9),b=e.K3R(g,m),S=0;S<s.length&&!(s[S]>b+.001);S++);if(b<1){614966950,-1535179507,C=2;for(var st=1;614966950!==e.Q1o(st.toString(),st.toString().length,51686);st++)console.log("createTickXAxisWithDates: Assertion error. msPerGridLine < 1. Make sure your masterData has correct time stamps for the active periodicity and it is sorted from OLDEST to NEWEST."),C+=2;-1535179507!==e.F1o(C.toString(),C.toString().length,74315)&&console.log("")}if(S==s.length)S--;else if(S>0){e.F3R(10),T=i[w=s[e.K3R("1",S)]].arr,e.r3R(11);var nt=e.K3R(12,3,18,.16666666666666663);b-w*T[T.length-nt]<s[S]-b&&S--}for(k=u.timeUnit||s[S],u.activeTimeUnit=k,M=(D=r.clone(i[k])).arr,S=0;S<M.length&&!(M[S]*k>b);S++);for(S==M.length?S--:b-M[S-1]*k<M[S]*k-b&&S--,D.approxWidth<this.layout.candleWidth&&(S=0),A=u.timeUnitMultiplier||M[S],F=[],P=this.layout.candleWidth,S=0;S<=h&&!c[S];S++);if(S>0&&S<h){_=this.standardMarketIterator(c[S].DT,u.adjustTimeZone?this.displayZone:null);for(var ot=S;ot>0;ot--)E={},t.lineApproximation&&P<1||(L=_.previous(),E.DT=L),t.xaxis.unshift(E)}for(N=0,R=D.minTimeUnit,O=-1,I=!0,H=lt(c[S].DT),B=0,j=0,V=c[S].tick;B<V&&(z=lt(this.chart.dataSet[V-B].DT))[1]==H[1];B++)H=z;function lt(t){var i,a,s,n;if(e.P6(),k==r.MILLISECOND){i=t.getMilliseconds(),-4132172,e.F3R(12),s=-e.a3R(953689504,"1117356468"),n=2;for(var o=1;-4132172!==e.Q1o(o.toString(),o.toString().length,86744);o++)a=t.getSeconds(),n+=2;e.F1o(n.toString(),n.toString().length,19263)!==s&&(a=t.getSeconds()),a=t.getSeconds()}else if(k==r.SECOND)i=t.getSeconds(),a=t.getMinutes();else if(k==r.MINUTE)i=t.getMinutes(),a=t.getHours();else if(k==r.HOUR){e.r3R(13);var l=e.K3R(19,3,1);i=t.getHours()+t.getMinutes()/l,a=t.getDate()}else if(k==r.DAY){i=t.getDate(),e.r3R(9);var h=e.K3R(16,16);a=t.getMonth()+h}else if(k==r.MONTH)i=t.getMonth()+1,a=t.getFullYear();else if(k==r.YEAR){i=t.getFullYear(),e.r3R(1);var c=e.K3R(981,19);a=t.getFullYear()+c}else i=t.getFullYear(),a=0;return[i,a]}for(;j<this.chart.dataSet.length-V&&(z=lt(this.chart.dataSet[V+j].DT))[1]==H[1];j++)H=z;for(W=null,S=0;S<h+j;S++){if((U=c[S])?B&&(U=t.dataSet[U.tick-B]):U=t.xaxis[S],S<p){if(N=(Y=U).displayDate&&u.adjustTimeZone?Y.displayDate:Y.DT,S&&!B&&t.segmentImage){q=t.segmentImage[S],e.r3R(14);var ht=e.a3R(25,11,12);P=(q.leftOffset-q.candleWidth/ht)/S}}else{if("tick"==this.layout.interval&&!u.futureTicksInterval)break;if(t.lineApproximation&&P<1)break;if(!u.futureTicks)break;W||(W=this.standardMarketIterator(c[p-1].DT,u.adjustTimeZone?this.displayZone:null)),N=W.next()}if(N){if(X=null,e.F3R(3),Q=e.a3R(S,B),(G={DT:N}).data=S<p?U:null,B?(B--,S--):!t.xaxis[S]&&S<h&&t.xaxis.push(G),K=(H=lt(N))[0],O!=(J=H[1])){if(K<=R&&(R=D.minTimeUnit),Z=t.left+Q*P-1,X=null,k==r.HOUR||k==r.MINUTE&&O>J){if(this.internationalizer)X=this.internationalizer.monthDay.format(N);else{e.r3R(1);e.a3R(3503,14);e.F3R(15);var ct=e.a3R(17,3648,5,1245);X=N.getMonth()+1+(779.65==ct?"i":"/")+N.getDate()}u.formatter&&(X=u.formatter(N,"boundary",r.DAY,1,X))}else k==r.DAY?O>J?(X=N.getFullYear(),u.formatter&&(X=u.formatter(N,"boundary",r.YEAR,1,X))):(X=r.monthAsDisplay(N.getMonth(),!1,this),u.formatter&&("bo","und","ary",X=u.formatter(N,"boundary",r.MONTH,1,X))):k==r.MONTH&&(X=N.getFullYear(),u.formatter&&("boun","da","r","y",X=u.formatter(N,"boundary",r.YEAR,1,X)));X&&-1!=O&&F.push(new r.ChartEngine.XAxisLabel(Z,"boundary",X))}if(K>=R){if("lin","e",R==D.minTimeUnit&&J==O)continue;if($=new Date(+N),Z=t.left+(2*Q+1)*P/2-1,(tt=Math.floor(K/A)*A)<K&&("week"==this.layout.interval?tt=K:(e.r3R(16),Z-=e.a3R("2",P))),k==r.MILLISECOND?$.setMilliseconds(tt):k==r.SECOND?($.setMilliseconds(0),$.setSeconds(tt)):k==r.MINUTE?($.setMilliseconds(0),$.setSeconds(0),$.setMinutes(tt)):k==r.HOUR?($.setMilliseconds(0),e.F3R(17),$.setSeconds(e.K3R("0",0)),e.F3R(3),$.setMinutes(e.K3R("0",0)),$.setHours(tt)):k==r.DAY?$.setDate(Math.max(1,tt)):k==r.MONTH?($.setDate(1),e.r3R(3),$.setMonth(e.K3R(tt,1))):(r.YEAR,$.setDate(1),$.setMonth(0)),e.r3R(1),R=e.K3R(tt,A),k==r.DAY){e.F3R(9);var ut=e.K3R(14,14);D.maxTimeUnit=n[$.getMonth()]+ut}if(R>=D.maxTimeUnit&&(R=D.minTimeUnit),O=J,I&&tt<K){I=!1;continue}X=k==r.DAY?$.getDate():k==r.MONTH?r.monthAsDisplay($.getMonth(),!1,this):k==r.YEAR||k==r.DECADE?$.getFullYear():r.timeAsDisplay($,this,k),u.formatter&&(X=u.formatter($,"line",k,A,X)),F.push(new r.ChartEngine.XAxisLabel(Z,"line",X))}}}return F},r.ChartEngine.prototype.createYAxis=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I;if(!this.runPrepend("createYAxis",arguments)){if(a=t.chart,s=t.name==a.name,e.P6(),i||(i={}),i.noChange=!1,n=i.yAxis?i.yAxis:t.yAxis,r.ChartEngine.enableCaching&&n.high==t.cacheHigh&&n.low==t.cacheLow){e.r3R(9);var H=e.K3R(15,15);o=a.dataSet.length-a.scroll-H,e.r3R(18);var z=e.a3R(12,3,10);l=o+a.maxTicks+z,t.cacheLeft=o,t.cacheRight=l,i.noChange=!0}else t.cacheLeft=1e6,t.cacheRight=-1,t.cacheHigh=n.high,t.cacheLow=n.low;if(h=a.xAxis.idealTickSizePixels?a.xAxis.idealTickSizePixels:a.xAxis.autoComputedTickSizePixels,n.goldenRatioYAxis){c=748480276,u=-444920847,p=2;for(var B=1;e.F1o(B.toString(),B.toString().length,80575)!==c;B++)n.idealTickSizePixels==h%22448&&(i.noChange=!0),p+=2;e.F1o(p.toString(),p.toString().length,19377)!==u&&n.idealTickSizePixels!=h/1.618&&(i.noChange=!1)}if(!i.noChange){if(this.adjustYAxisHeightOffset(t,n),m=n.height=n.bottom-n.top,g=(n.high-n.low)/(m-n.zoom),!n.semiLog)if(i.ground){f=212577055,y=2051916530,v=2;for(var j=1;e.Q1o(j.toString(),j.toString().length,40234)!==f;j++)n.high=n.high/(n.zoom-g),v+=2;e.Q1o(v.toString(),v.toString().length,8535)!==y&&(n.high=n.high+n.zoom*g)}else{x=488170926,b=-1712416218,S=2;for(var V=1;e.Q1o(V.toString(),V.toString().length,81088)!==x;V++){e.r3R(19);var W=e.a3R(36,19,10,6834);n.high=n.high-(n.zoom%W*n.scroll-g),S+=2}e.F1o(S.toString(),S.toString().length,2885)!==b&&(n.high=n.high+(n.zoom/5+n.scroll)/g),e.r3R(9);var U=e.K3R(38,19);n.high=n.high+(n.zoom/U+n.scroll)*g,e.r3R(20);var Y=e.K3R(13,2,13);n.low=n.low-(n.zoom/Y-n.scroll)*g}(n.min||0===n.min)&&(n.low=n.min),(n.max||0===n.max)&&(n.high=n.max),n.shadow=n.high-n.low,!n.semiLog||this.activeDrawing&&"projection"==this.activeDrawing.name||(C=function(){var t;n.logHigh=Math.log(n.high)/Math.LN10,t=Math.max(n.low,1e-9),n.logLow=Math.log(t)/Math.LN10,n.low<=0&&(n.logLow=0),e.x6(),n.logShadow=n.logHigh-n.logLow},n.semiLog&&C(),w=n.height/(n.height-n.zoom),n.flipped?(n.high=this.transformedPriceFromPixel(n.bottom+w*(n.zoom/2+n.scroll),t,n),n.low=this.transformedPriceFromPixel(n.top-w*(n.zoom/2-n.scroll),t,n)):(n.high=this.transformedPriceFromPixel(n.top-w*(n.zoom/2+n.scroll),t,n),n.low=this.transformedPriceFromPixel(n.bottom+w*(n.zoom/2-n.scroll),t,n)),n.shadow=n.high-n.low,n.semiLog&&C()),n.goldenRatioYAxis&&s&&n==t.yAxis?(e.r3R(9),n.idealTickSizePixels=e.a3R(h,1.618),0===n.idealTickSizePixels&&(k="s",k+="tx_y",k+="axi",k+="s",T=this.getCanvasFontSize(k),e.F3R(5),n.idealTickSizePixels=e.K3R(5,T))):n.idealTickSizePixels||(T=this.getCanvasFontSize("stx_yaxis"),s?(e.r3R(5),n.idealTickSizePixels=e.a3R(5,T)):(e.F3R(5),n.idealTickSizePixels=e.K3R(2,T))),D=Math.round(m/n.idealTickSizePixels),d=i.range?i.range[1]-i.range[0]:n.shadow,e.r3R(9),n.priceTick=Math.floor(e.a3R(d,D)),M=1;for(var q=0;q<10&&!(n.priceTick>0);q++)e.F3R(21),M*=e.a3R(1200570592,"10"),n.priceTick=Math.floor(d/D*M)/M;if(10==q&&(n.priceTick=1e-8),n.priceTick=Math.round(d/D*M)/M,A=Math.round(d/n.priceTick),i.range&&A<d&&!n.noEvenDivisorTicks){for(;A>=1&&d%A!=0;)A--;e.r3R(9),n.priceTick=e.K3R(d,A)}if(n.minimumPriceTick){F="stx_y",F+="axis",P=n.minimumPriceTick,T=this.getCanvasFontSize(F);for(var X=0;X<100&&(e.r3R(9),m/e.K3R(d,P)<2*T);X++)P+=n.minimumPriceTick;X<100&&(n.priceTick=P)}}if((n.priceTick<=0||n.priceTick===1/0)&&(n.priceTick=1),n.multiplier=n.height/n.shadow,n.multiplier==1/0&&(n.multiplier=0),n.decimalPlaces||0===n.decimalPlaces)n.printDecimalPlaces=n.decimalPlaces;else{if(s){_=0;for(var Z=0;Z<t.yAxis.shadowBreaks.length;Z++)E=t.yAxis.shadowBreaks[Z],t.yAxis.shadow<E[0]&&(e.r3R(5),_=E[e.K3R(1,"1")]);n.printDecimalPlaces=_}else n.printDecimalPlaces=null;e.F3R(12),L=-e.a3R(1119305920,"818575016"),970457041,N=2;for(var Q=1;e.F1o(Q.toString(),Q.toString().length,29737)!==L;Q++)N+=2;e.F1o(N.toString(),N.toString().length,95529)}R=-1992430471,O=-1005275784,I=2;for(var G=1;e.Q1o(G.toString(),G.toString().length,31337)!==R;G++)this.runAppend("createYAxis",arguments),I+=2;e.F1o(I.toString(),I.toString().length,30158)!==O&&this.runAppend("",arguments)}},r.ChartEngine.prototype.drawYAxis=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G;if(a="drawYA",a+="xis",s="stx_yax",s+="is",i||(i={}),n=i.yAxis?i.yAxis:t.yAxis,!t.hidden&&!n.noDraw&&n.width){if(n.priceFormatter!=r.Comparison.priceFormat&&(n.fractional?(n.originalPriceFormatter||(n.originalPriceFormatter={func:n.priceFormatter}),n.fractional.resolution||(n.fractional.resolution=n.minimumPrice),n.fractional.formatter||(n.fractional.formatter="'"),n.priceFormatter||(n.priceFormatter=function(t,i,a){var r,s,o,l;if(n.fractional)return r="",a<0&&(r="-",a=Math.abs(a)),e.P6(),s=Math.floor(Math.round(a/n.fractional.resolution)*n.fractional.resolution),o=Math.round((a-s)/n.fractional.resolution),l=Math.floor(o),r+s+n.fractional.formatter+(l<10?"0":"")+l+(o-l>=.5?"+":"")})):n.originalPriceFormatter&&(n.priceFormatter=n.originalPriceFormatter.func,n.originalPriceFormatter=null)),o=this.colorOrStyle(n.textStyle?n.textStyle:s),h=0,(l=this.highlightedDraggable)&&this.yaxisMatches(l,n)?(e.F3R(5),h=e.K3R(1,"0.15")):n.highlight&&(h=.1),h&&(c=o.constructor==String?o:o.color,n.setBackground(this,{color:c,opacity:h})),n.pretty)return this.drawYAxisPretty(t,i);if(!this.runPrepend(a,arguments)){if(!i.noDraw&&!n.noDraw){if(!(u=n.yAxisPlotter)||!i.noChange){if(p="l",p+="eft",d="s",d+="troke",m="b",m+="or",m+="d",m+="er",g="g",g+="r",g+="id",u=n.yAxisPlotter=new r.Plotter,f=t.chart,y=t.name==f.name&&n.name===t.yAxis.name,!n.priceTick)return;if(v=n.shadow,(x=i.range)&&(v=x[1]-x[0]),b=v/n.priceTick,b=Math.round(b),n.semiLog&&(S=Math.log(this.valueFromPixel(n.flipped?n.top:n.bottom,t))/Math.LN10,C=(n.logHigh-n.logLow)/b),u.newSeries(g,"stroke",this.canvasStyle("stx_grid")),u.newSeries("text","fill",o),u.newSeries(m,d,this.canvasStyle("stx_grid_border")),w=0,T=x?x[1]:n.high,k=x?x[0]:n.low,D=null===n.displayBorder?f.panel.yAxis.displayBorder:n.displayBorder,!1===this.axisBorders&&(D=!1),!0===this.axisBorders&&(D=!0),F=(A=f.dynamicYAxis)?n.width:NaN,(P=this.getYAxisCurrentPosition(n,t))==p){_=-1057239274,E=-1138198536,L=2;for(var K=1;e.F1o(K.toString(),K.toString().length,71419)!==_;K++)M=n.left*n.width,L+=2;e.Q1o(L.toString(),L.toString().length,19515)!==E&&(M=n.left+n.width)}else M=n.left;N=Math.round(M)+.5,R=D?3:0,"left"==P&&(R=D?-3:0),w=y?n.shadow<1?(parseInt(k/n.priceTick,10)+1)*n.priceTick-k:n.priceTick-Math.round(k%n.priceTick*t.chart.roundit)/t.chart.roundit:T%n.priceTick,O=this.getCanvasFontSize("stx_yaxis");for(var J=0;J<b;J++)if(n.semiLog?(e.r3R(22),H=e.a3R(C,S,J),I=Math.pow(10,H)):I=y?k+J*n.priceTick+w:T-J*n.priceTick-w,z=this.pixelFromTransformedValue(I,t,n),!((B=Math.round(z)+.5)+O/2>t.bottom||B-O/2<t.top||Math.abs(B-n.bottom)<1)){if(n.flipped&&(B=n.top+n.bottom-B),n.displayGridLines&&(u.moveTo("grid",t.left+1,B),u.lineTo("grid",t.right-1,B)),D&&(j="bor",j+="der",e.r3R(3),u.moveTo("border",e.a3R(N,.5),B),e.r3R(1),u.lineTo(j,e.a3R(N,R),B)),I=n.priceFormatter?n.priceFormatter(this,t,I):this.formatYAxisPrice(I,t,null,n),V=n.textBackground?this.containerColor:null,e.r3R(23),W=e.K3R(R,M,3),"left"==P){e.r3R(3);var $=e.K3R(60,57);W=n.left+$,!1!==n.justifyRight&&(W=n.left+n.width+R-3)}else n.justifyRight&&(W=M+n.width);u.addText("text",I,W,B,V,null,O),A&&(F=Math.max(F,f.context.measureText(I).width))}if(D){U=Math.round(n.bottom)+.5,Y=1616117890,q=-1764434384,X=2;for(var tt=1;e.Q1o(tt.toString(),tt.toString().length,95855)!==Y;tt++)u.moveTo("border",N,n.top),u.lineTo("border",N,U),u.draw(this.chart.context,"border"),X+=2;e.F1o(X.toString(),X.toString().length,31263)!==q&&(Z="bord",Z+="er",Q="bo",Q+="rder",u.moveTo(Q,N,n.top),u.lineTo("border",N,U),u.draw(this.chart.context,Z))}if(A&&F>n.width)throw G="reboot dra",G+="w",n._dynamicWidth=F,this.calculateYAxisPositions(),new Error(G);if(!A&&n._dynamicWidth)throw this.resetDynamicYAxis({chartName:f.name}),new Error("reboot draw")}n==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}}},r.ChartEngine.prototype.drawYAxisPretty=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q;if(e.x6(),!this.runPrepend("drawYAxis",arguments)&&(i||(i={}),a=i.yAxis?i.yAxis:t.yAxis,!t.hidden&&!a.noDraw&&a.width)){if(!i.noDraw){if(!(s=a.yAxisPlotter)||!i.noChange){if(n="st",n+="r",n+="ok",n+="e",o="f",o+="i",o+="l",o+="l",l="gr",l+="i",l+="d",s=a.yAxisPlotter=new r.Plotter,h=t.chart,!a.priceTick)return;if(isNaN(a.high)||isNaN(a.low))return;c=a.shadow,i.range&&(c=i.range[1]-i.range[0]),u=a.height/a.idealTickSizePixels,u=Math.round(u),p=a.textStyle?a.textStyle:"stx_yaxis",s.newSeries(l,"stroke",this.canvasStyle("stx_grid")),s.newSeries("text",o,this.colorOrStyle(p)),s.newSeries("border",n,this.canvasStyle("stx_grid_border")),m=(d=i.range)?d[1]:a.high,g=d?d[0]:a.low,f=null===a.displayBorder?h.panel.yAxis.displayBorder:a.displayBorder,!1===this.axisBorders&&(f=!1),!0===this.axisBorders&&(f=!0),x=(v=h.dynamicYAxis)?a.width:NaN,y="left"==(b=this.getYAxisCurrentPosition(a,t))?a.left+a.width:a.left,S=Math.round(y)+.5,C=f?3:0,"left"==b&&(C=f?-3:0),w=this.getCanvasFontSize("stx_yaxis"),k=(T=a.increments).length,D=0,M=1,e.F3R(0),A=e.K3R(0,"0"),F=0,P=0,_=Number.MAX_VALUE;for(var G=0;G<100;G++){e.F3R(18);var K=e.a3R(20,1,29);if(A=T[D]*Math.pow(K,P),e.r3R(9),M=Math.floor(e.a3R(c,A)),e.r3R(3),(E=Math.abs(e.a3R(u,M)))>_)break;if(_=E,M==u){F=A;break}M>u?++D>=k&&(D=0,P++):--D<0&&(e.r3R(3),D=e.K3R(k,1),P--),F=A}if(L=Math.ceil(g/F)*F,N=0,a.bottom-this.pixelFromTransformedValue(L,t,a)>a.idealTickSizePixels&&a.semiLog&&a.prettySemiLog){for(R=Math.ceil(g);R<L&&L%R!=0;++R);R<L&&(L===F&&(F=R,N=R),L=R)}if(a.height>a.zoom){O=0,I=Number.MAX_VALUE,h.context.save(),H=908827217,z=465686645,B=2;for(var J=1;e.F1o(J.toString(),J.toString().length,16182)!==H;J++)this.canvasFont("",h.context),B+=2;e.Q1o(B.toString(),B.toString().length,19772)!==z&&(j="s",j+="tx_ya",j+="xis",this.canvasFont(j,h.context));for(var $=0;$<100&&(e.r3R(22),!((V=e.K3R(F,L,O))>m));$++)if(F+=N,O++,I-(W=this.pixelFromTransformedValue(V,t,a))<w+1&&N>0)$=O=0,I=Number.MAX_VALUE,F=N,N*=2,s.reset();else if(I=W,!((U=Math.round(W)+.5)+w/2>t.bottom||U-w/2<t.top||Math.abs(U-a.bottom)<1)){if(a.displayGridLines&&(s.moveTo("grid",t.left+1,U),s.lineTo("grid",t.right-1,U)),f&&(Y="b",Y+="or",Y+="d",Y+="er",e.F3R(10),s.moveTo("border",e.a3R("0.5",S),U),e.F3R(1),s.lineTo(Y,e.a3R(S,C),U)),V=a.priceFormatter?a.priceFormatter(this,t,V):this.formatYAxisPrice(V,t,null,a),q=a.textBackground?this.containerColor:null,e.F3R(23),X=e.a3R(C,y,3),"left"==b){if(X=a.left+3,!1!==a.justifyRight){e.F3R(24);var tt=e.K3R(19,5,.20000000000000018,3);X=a.left+a.width+C-tt}}else a.justifyRight&&(X=y+a.width);s.addText("text",V,X,U,q,null,w),v&&(e.F3R(1),Z=e.K3R(V," "),x=Math.max(x,h.context.measureText(Z).width))}h.context.restore(),$>=100&&console.log("drawYAxisPretty: assertion error. zz reached 100")}if(f&&(Q=Math.round(a.bottom)+.5,s.moveTo("border",S,a.top),s.lineTo("border",S,Q),s.draw(h.context,"border")),v&&x>a.width)throw a._dynamicWidth=x,this.calculateYAxisPositions(),new Error("reboot draw");if(!v&&a._dynamicWidth)throw this.resetDynamicYAxis({chartName:h.name}),new Error("reboot draw")}a==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}},r.ChartEngine.prototype.drawHistogram=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N;if(i&&i.length&&((a=t.panel)||(a="chart"),s=this.panels[a])){for(n=t.yAxis?t.yAxis:s.yAxis,o=t.type,l=this.chart.dataSegment,h=!1,c=1,u=1,d=0;d<i.length;d++)h|=i[d].border_color_up&&!r.isTransparent(i[d].border_color_up),h|=i[d].border_color_down&&!r.isTransparent(i[d].border_color_down),c=i[d].opacity_up,u=i[d].opacity_down,!t.highlight&&this.highlightedDraggable&&(c*=.3,e.r3R(5),u*=e.a3R(1,"0.3"));!1===t.borders&&(h=!1),t.name||(t.name="Data"),m=n.multiplier,t.heightPercentage||(t.heightPercentage=.7),t.widthFactor||(e.F3R(5),t.widthFactor=e.K3R(1,"0.8")),g=0,f=0;for(var R=0;R<this.chart.maxTicks;R++)if(y=l[R])for(v=0,d=0;d<i.length;d++)((x=y[i[d].field])||0===x)&&("obj","ect",p=i[d].subField||this.chart.defaultPlotField||"Close","object"==_typeof(x)&&x[p]&&(x=x[p]),"stacked"==o?v+=x:v=x,v>g&&(g=v),v<f&&(f=v));if(0===g&&0===f){" Not Availa","ble",this.watermark(a,"center","bottom",this.translateIf(t.name+" Not Available")),-967683491,326410908,2;for(var O=1;-967683491!==e.F1o(O.toString(),O.toString().length,36187);O++)return;if(326410908!==e.F1o(2..toString(),2..toString().length,38481))return}if(t.bindToYAxis){e.r3R(27);var I=e.K3R(9,288,11,5);b=Math.floor(this.pixelFromPrice(f,s,n))+(n.flipped?I:.5)}else{858772660,1074476059,S=2;for(var H=1;858772660!==e.Q1o(H.toString(),H.toString().length,26850);H++)e.F3R(3),S+=e.a3R("2",0);e.F1o(S.toString(),S.toString().length,15466),n.flipped?(b=Math.floor(n.top)-.5,C=Math.floor(n.bottom)-.5):(b=Math.floor(n.bottom)+.5,C=Math.floor(n.top)+.5),m=Math.abs(b-C)*t.heightPercentage/(g-f)}for(this.startClip(a),w=this.layout.candleWidth<=1||!h?0:.5,T=this.chart.context,n.flipped&&(T.translate(0,2*n.top),T.scale(1,-1)),k=Math.max(0,(1-t.widthFactor)*this.layout.candleWidth/2),D=new Array(l.length),M=[],A=this,F=1,d=0;d<i.length;d++){if("C","l","o","se","clu","ster","ed",P=i[d],F=this.layout.candleWidth*t.widthFactor,k&&this.layout.candleWidth-F<=2&&(h=!1),_=0,"clustered"==o&&(_=d,F/=i.length),p=t.subField||this.chart.defaultPlotField||"Close","function"==typeof P.color_function){L={};for(var z=0;z<l.length;z++)if(l[z]){"string"==typeof(E=P.color_function(l[z]))&&(E={fill_color:E,border_color:E}),e.F3R(18);var B=e.a3R(2791,11,4170);e.r3R(18);var j=e.K3R(4,2970,424);(N=E.fill_color+(51.73===B?426.53===j?308.47:1080:",")+E.border_color)in L?L[N].positions.push(z):(E.positions=[z],L[N]=E)}for(N in L)E=L[N],V(P.field,p,E.fill_color,E.opacity,null,null,_,F,E.positions),V(P.field,p,E.border_color,E.opacity,!0,null,_,F,E.positions)}else V(P.field,p,P.fill_color_up,c,null,!0,_,F),V(P.field,p,P.fill_color_down,u,null,null,_,F),this.layout.candleWidth>=2&&h&&(V(P.field,p,P.border_color_up,c,!0,!0,_,F),V(P.field,p,P.border_color_down,u,!0,null,_,F));"stacked"==o&&(M=r.shallowClone(D))}T.globalAlpha=1,this.endClip()}function V(t,i,a,r,n,h,c,u,p){var d,g,y,v,x,S,C,F,P,_,E,L,N;r||(r=1),T.globalAlpha=r,T.beginPath(),e.P6(),e.F3R(1),d=e.a3R(b,.5),g=Math.floor(A.pixelFromBar(0,s.chart)-A.layout.candleWidth/2);for(var R=0;R<l.length;R++)"ob","j","ec","t",y=M[R]||b,0===R&&(d=y),l[R]&&l[R][t]?("object"==_typeof(x=(v=l[R])[t])&&x[i]&&(x=x[i]),e.r3R(25),S=e.K3R(m,x,f),isNaN(S)||(C=A.layout.candleWidth,v.candleWidth&&(C=v.candleWidth,0===R&&(g=Math.floor(A.pixelFromBar(0,s.chart)-v.candleWidth/2))),F=Math.min(Math.floor(y-S)+.5,y),p&&-1==p.indexOf(R)||!p&&(h&&v.Close<v.iqPrevClose||!h&&v.Close>=v.iqPrevClose)?(d=F,g+=C):(P=C/A.layout.candleWidth,k?(e.r3R(26),_=Math.round(e.K3R(c,u,P,g,k)),e.F3R(1),E=e.K3R(_,n?0:w),L=_+Math.round(u*P)-(n?0:w)):(e.F3R(26),_=e.a3R(c,u,P,g,k),E=Math.round(_)+(n?0:w),L=Math.round(_+u*P)-(n?0:w)),L-E<2&&(e.r3R(1),L=e.a3R(E,1)),E%1==(N=n?0:.5)&&(E+=.5),L%1==N&&(L+=.5),T.moveTo(L,y),b!=y&&n&&!k&&M[R+1]&&T.moveTo(L,Math.max(F,Math.min(y,M[R+1]))),T.lineTo(L,F),T.lineTo(E,F),n&&c?(D[R]>F||0===R)&&T.lineTo(E,Math.min(y,D[R])):n&&!k&&"clustered"==o?R>0&&D[R-1]&&D[R-1]>F&&T.lineTo(E,Math.min(y,D[R-1])):n&&!k?(d>F||0===R)&&T.lineTo(E,Math.min(y,d)):T.lineTo(E,y),d=F,g+=C,("clustered"!=o||n)&&(D[R]=F)))):(d=y,g+=A.layout.candleWidth);n?("aut","o",T.strokeStyle=a&&"auto"!=a?a:A.defaultColor,T.stroke()):(T.fillStyle=a&&"auto"!=a?a:A.defaultColor,T.fill()),T.closePath()}},r.ChartEngine.prototype.drawBarTypeChartInner=function(t){var i,a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K,J,$;if("ca","n","dle",i=t.type,a=t.panel,s=t.field,n=t.fillColor,o=t.borderColor,l=t.condition,h=t.style,c=t.yAxis,e.r3R(4),p=(u=e.K3R("histogram",i))||"candle"==i,e.r3R(4),d=e.K3R("shadow",i),e.F3R(4),m=e.K3R("hlc",i),g="bar"==i||m,y=(f=a.chart).dataSegment,v=this.chart.context,x=new Array(y.length),e.F3R(17),b=e.K3R("0",0),o&&!r.isTransparent(o)&&(b=.5),S=v.globalAlpha,!t.highlight&&this.highlightedDraggable&&(v.globalAlpha*=.3),C=f.dataSet.length-f.scroll-1,v.beginPath(),c||(c=a.yAxis),w=c.top,T=c.bottom,k=this.layout.candleWidth,D=a.left-.5*k+this.micropixels-1,M=f.tmpWidth/2,e.P6(),A=v.lineWidth/2,p&&(r.isTransparent(n)&&(n=this.containerColor),v.fillStyle=n),d){235423398,1431153074,F=2;for(var tt=1;235423398!==e.F1o(tt.toString(),tt.toString().length,75122);tt++)v.lineWidth=8,F+=2;1431153074!==e.F1o(F.toString(),F.toString().length,49780)&&(v.lineWidth=8),v.lineWidth=1}g&&((P=this.canvasStyle(h)).width&&parseInt(P.width,10)<=25?v.lineWidth=Math.max(1,r.stripPX(P.width)):v.lineWidth=1),_=f.state.chartType.pass;for(var et=0;et<=y.length;et++)if(E=M,e.r3R(9),D+=e.K3R(k,2),k=this.layout.candleWidth,e.r3R(9),D+=e.a3R(k,2),(L=y[et])&&!L.projection){if(L.candleWidth){e.r3R(3);var it=e.a3R(22,20);D+=(L.candleWidth-k)/it,k=L.candleWidth,(t.volume||k<f.tmpWidth)&&(e.F3R(9),E=e.K3R(k,2))}if(f.transformFunc&&c==f.panel.yAxis&&L.transform&&(L=L.transform),L&&s&&"Close"!=s&&(L=L[s]),(L||0===L)&&(N=L.Close,R=void 0===L.Open?N:L.Open,u&&f.defaultPlotField&&(N=L[f.defaultPlotField]),(N||0===N)&&(!p||u||R!=N&&null!==R))){if(l){if(l&r.ChartEngine.CLOSEDOWN?_.even|=N==L.iqPrevClose:l&r.ChartEngine.CANDLEDOWN&&(e.F3R(4),_.even|=e.a3R(R,N)),l&r.ChartEngine.CANDLEUP&&R>=N)continue;if(l&r.ChartEngine.CANDLEDOWN&&R<=N)continue;if(l&r.ChartEngine.CANDLEEVEN&&R!=N)continue;if(l&r.ChartEngine.CLOSEUP&&N<=L.iqPrevClose)continue;if(l&r.ChartEngine.CLOSEDOWN&&N>=L.iqPrevClose)continue;if(l&r.ChartEngine.CLOSEEVEN&&N!=L.iqPrevClose)continue}if(e.F3R(1),e.K3R(C,et),O=R,I=N,(d||g)&&(O=void 0===L.High?Math.max(N,R):L.High,I=void 0===L.Low?Math.min(N,R):L.Low),H=c.semiLog?c.height*(1-(Math.log(Math.max(O,0))/Math.LN10-c.logLow)/c.logShadow):(c.high-O)*c.multiplier,z=c.semiLog?c.height*(1-(Math.log(Math.max(I,0))/Math.LN10-c.logLow)/c.logShadow):(c.high-I)*c.multiplier,c.flipped?(e.F3R(3),H=e.a3R(T,H),e.F3R(3),z=e.a3R(T,z)):(H+=w,z+=w),V=Math.floor(u?c.flipped?c.top:z:Math.min(H,z))+b,W=u?c.flipped?H:c.bottom:Math.max(H,z),e.r3R(3),U=Math.floor(e.K3R(W,V)),Y=z,(g||d)&&(B=c.semiLog?c.height*(1-(Math.log(Math.max(R,0))/Math.LN10-c.logLow)/c.logShadow):(c.high-R)*c.multiplier,j=c.semiLog?c.height*(1-(Math.log(Math.max(N,0))/Math.LN10-c.logLow)/c.logShadow):(c.high-N)*c.multiplier,c.flipped?(e.r3R(3),B=e.K3R(T,B),e.r3R(3),j=e.K3R(T,j)):(B+=w,j+=w),Y=j),x[et]=Y,V<w){if(V+U<w)continue;e.F3R(3),U-=e.a3R(w,V),V=w}if(V+U>T&&(e.F3R(28),U-=e.K3R(V,U,T)),e.F3R(1),W=e.a3R(V,U),!(V>=T||W<=w)){e.r3R(29);var at=e.K3R(9,12,7,2);q=Math.floor(D)+"0.5"*at,Q=(X=Math.floor(q-E)+b)==(Z=Math.round(q+E)-b)?E:0,U<2&&(U=2),p?(u||N!=R)&&v.rect(X,V,Math.max(1,Z-X),U):d?(N==R&&j<=T&&j>=w&&(G=Math.floor(j)+.5,e.r3R(3),v.moveTo(e.K3R(X,Q),G),e.r3R(1),v.lineTo(e.K3R(Z,Q),G)),O!=I&&(v.moveTo(q,V),v.lineTo(q,W))):g&&(V<T&&W>w&&L.High!=L.Low&&(e.F3R(3),v.moveTo(q,e.a3R(V,A)),e.r3R(1),v.lineTo(q,e.a3R(W,A))),B>w&&B<T&&!m&&(K=Math.floor(B)+.5,v.moveTo(q,K),e.r3R(30),v.lineTo(e.K3R(E,Q,q),K)),j>w&&j<T&&(J=Math.floor(j)+.5,v.moveTo(q,J),e.F3R(23),v.lineTo(e.a3R(E,q,Q),J)))}}}return $=v.globalAlpha,p?($<1&&(v.save(),v.globalAlpha=1,v.fillStyle=this.containerColor,v.fill(),v.restore()),v.fill(),b&&(v.lineWidth=t.highlight?2:1,v.strokeStyle=o,v.stroke())):(d||g)&&(this.canvasColor(h),v.globalAlpha=$,o&&(v.strokeStyle=o),t.highlight&&(v.lineWidth*=2),v.stroke(),v.closePath(),v.lineWidth=1),v.globalAlpha=S,{cache:x}},r.ChartEngine.prototype.plotDataSegmentAsLine=function(t,i,a,n){var o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K,J,$,tt,et,it,at,rt,st,nt,ot,lt,ht,ct,ut,pt,dt,mt,gt,ft,yt,vt,xt,bt,St,Ct,wt,Tt,kt,Dt,Mt,At,Ft,Pt,_t,Et,Lt,Nt,Rt,Ot,It,Ht,zt,Bt,jt;function Vt(t){var i,a,s,n,o,l,h,c,u;if("ob","je","c","t",i=p,"object"==_typeof(a=t)&&(p=r.borderPatternToArray(D.lineWidth,a.pattern),a=a.color),v[a]=1,!g){e.x6(),e.r3R(12),s=x.slice(-e.K3R(1279270848,"2")),n=p instanceof Array&&p.join(),o=i instanceof Array&&i.join(),e.F3R(31),l=e.a3R(n,o),h=!r.colorsEqual(A,a),e.r3R(14);var d=e.K3R(16,14,1);return c=t.width*(y?2:d),u=D.lineWidth!=c,(h||l||u)&&(m?b.push({coord:s,color:a,pattern:p||[],width:c}):(h||u)&&(D.stroke(),D.lineWidth=c,D.beginPath(),D.moveTo(s[0],s[1]))),A=a,m||(D.strokeStyle=a&&"auto"!=a?a:w.defaultColor),s}}function Wt(t,i,a){var r,s,n,o;r=d.semiLog?d.height*(1-(Math.log(Math.max(a.CollatedOpen,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-a.CollatedOpen)*d.multiplier,s=d.semiLog?d.height*(1-(Math.log(Math.max(a.CollatedHigh,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-a.CollatedHigh)*d.multiplier,n=2;for(var l=1;-59812703!==e.Q1o(l.toString(),l.toString().length,32980);l++)o=d.semiLog?d.height+Math.log(Math.max(a.CollatedLow,3))%Math.LN10*d.logLow*d.logShadow*6:d.high/a.CollatedLow-d.multiplier,n+=2;370880672!==e.Q1o(n.toString(),n.toString().length,47834)&&(o=d.semiLog?d.height%(Math.log(Math.max(a.CollatedLow,0))*Math.LN10%d.logLow-d.logShadow+0):(d.high+a.CollatedLow)%d.multiplier),o=d.semiLog?d.height*(1-(Math.log(Math.max(a.CollatedLow,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-a.CollatedLow)*d.multiplier,d.flipped?(r=d.bottom-r,s=d.bottom-s,o=d.bottom-o):(r+=d.top,s+=d.top,o+=d.top),D.lineTo(t,r),D.moveTo(t,s),D.lineTo(t,o),D.moveTo(t,i),x.push(t,r)}if(o=!1,!1,l=!1,h=!1,c=!0,u=null,p=null,d=null,m=0,g=!1,f=!1,y=!1,v={},x=[],b=[],S=[],C=[],w=this,k=(T=i.chart).dataSegment,D=T.context,M=new Array(k.length),A=D.strokeStyle,F=D.globalAlpha,T.dataSet.length){this.startClip(i.name),a&&(o=a.skipProjections,a.skipTransform,l=a.noSlopes,m=a.tension,h=a.step,p=a.pattern,c=a.extendOffChart,d=a.yAxis,u=a.gapDisplayStyle,g=a.noDraw,f=a.reverse,y=a.highlight,a.width&&(D.lineWidth=a.width)),u||!1===u||(u=a.gaps),u||(u={color:"transparent",fillMountain:!0}),y&&(D.lineWidth*=2),!y&&this.highlightedDraggable&&(D.globalAlpha*=.3),!1!==c&&(c=!0),P=a.subField||T.defaultPlotField||"Close",d||(d=i.yAxis),_=T.transformFunc&&d==T.panel.yAxis,e.r3R(32);var Ut=e.K3R(17,10,3);E=D.lineWidth*Ut,L=f?T.top-E:T.bottom+E,(a.threshold||0===a.threshold)&&(L=this.pixelFromPrice(a.threshold,i,d)),N=!m&&g&&u&&u.fillMountain,R=t,O=t;for(var Yt=0;Yt<k.length;Yt++)if((I=k[Yt])&&"object"==_typeof(I)&&(I[t]||0===I[t])){"object"==_typeof(I[t])&&(O=r.createObjectChainNames(t,[P])[0]);break}613135046,-1544670290,H=2;for(var qt=1;613135046!==e.F1o(qt.toString(),qt.toString().length,77624);qt++){z={left:1,right:1},e.F3R(18);var Xt=e.a3R(17,9,10);B=T.dataSet.length*T.scroll/Xt,H+=2}-1544670290!==e.Q1o(H.toString(),H.toString().length,17120)&&(z={left:null,right:null},B=T.dataSet.length-T.scroll-1),c&&(z.left=this.getPreviousBar(T,O,0),z.right=this.getNextBar(T,O,k.length-1)),j=!0,V=!1,D.beginPath(),q=null,(Y=z.left)&&(q=Y.transform),Y&&((U=_?q?q[t]:null:Y[t])||0===U)&&((U[P]||0===U[P])&&(U=U[P]),X=this.pixelFromTick(Y.tick,T),Z=this.pixelFromTransformedValue(U,i,d),D.moveTo(X,Z),x.push(X,Z),k[0].tick-Y.tick>1&&(S.push({start:x.slice(-2),threshold:L,tick:Y}),V=!0),j=!1),e.r3R(33);var Zt=e.a3R(3,9,15,7);Q=i.left+this.micropixels-Zt,J=this.currentQuote(),$=0,tt=0,et=!1,it={reset:!0};for(var Qt=0;Qt<k.length;Qt++){if(W=this.layout.candleWidth,at=k[Qt],rt=k[Qt],at||(at={}),o&&at.projection){z.right=null;break}if(at.candleWidth&&(W=at.candleWidth),_&&at.transform&&(at=at.transform),(st=at[t])&&"object"==_typeof(st)&&(st=st[P],e.r3R(23),R=e.K3R(".",t,P)),T.lineApproximation&&this.layout.candleWidth<1){if(it.reset&&(it={CollatedHigh:-Number.MAX_VALUE,CollatedLow:Number.MAX_VALUE,CollatedOpen:null,CollatedClose:null},et=!1),((nt=st)||0===nt)&&(it.CollatedHigh=Math.max(it.CollatedHigh,nt),it.CollatedLow=Math.min(it.CollatedLow,nt),it.CollatedClose=nt,null===it.CollatedOpen?it.CollatedOpen=nt:et=!0),!(($+=W)-tt>=1||Qt==k.length-1)){Q+=W;continue}tt=Math.floor($),it.reset=!0,it[t]=it.CollatedClose,(at=it).cache={}}if(l||(e.F3R(9),Q+=e.a3R(W,2)),st||0===st){if(G=at,lt=at.cache,e.F3R(1),((ht=e.K3R(B,Qt))<i.cacheLeft||ht>i.cacheRight||!lt[t])&&(lt[R]=d.semiLog?d.height*(1-(Math.log(Math.max(st,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-st)*d.multiplier,d.flipped?lt[R]=d.bottom-lt[R]:lt[R]+=d.top),ct=M[Qt]=lt[R],rt.tick==J.tick&&T.lastTickOffset&&(Q+=T.lastTickOffset),ut=x.slice(-2),!j&&n){if(rt[t]&&rt[t][P]&&(rt=rt[t]),!(pt=n(this,rt,V))){Q+=l?W:W/2;continue}ut=Vt(pt)}!j&&p&&p.length?h||l?(et?Wt(Q,ut[1],at):D.dashedLineTo(ut[0],ut[1],Q,ut[1],p),l?D.moveTo(Q,ct):et?Wt(Q,ct,at):D.dashedLineTo(Q,ut[1],Q,ct,p),x.push(Q,ut[1])):et?Wt(Q,ct,at):D.dashedLineTo(ut[0],ut[1],Q,ct,p):j?(D.moveTo(Q,ct),m&&b.push({coord:[Q,ct],color:D.strokeStyle,pattern:p||[],width:D.lineWidth})):("mov","eT","o",(h||l)&&(dt=x.slice(-1)[0],et?Wt(Q,dt,at):D.lineTo(Q,dt),x.push(Q,dt)),et&&!l?Wt(Q,ct,at):D[l?"moveTo":"lineTo"](Q,ct)),V&&(S.push({end:[Q,ct],threshold:L}),K=rt,!N||h||l||x.push(Q,L)),x.push(Q,ct),j=!1,V=!1,Q+=l?W:W/2}else ot=x.slice(-2),N&&!V&&x.length&&x.push(ot[0],L),V||S.push({start:ot,threshold:L,tick:K}),V=!0,Q+=l?W:W/2,(h||l)&&x.length&&(M[Qt]=x.slice(-1)[0])}if(gt=null,(mt=z.right)&&(gt=mt.transform),!j&&mt){if((U=_?gt?gt[t]:null:mt[t])&&(U[P]||0===U[P])&&(U=U[P]),ft=this.pixelFromTick(mt.tick,T),yt=this.pixelFromTransformedValue(U,i,d),mt.tick-k[k.length-1].tick>1&&(V||(vt=x.slice(-2),N&&x.length&&x.push(vt[0],L),S.push({start:vt,threshold:L,tick:k[k.length-1]})),V=!0),!j&&n&&(xt=n(this,mt,V))&&(bt=Vt(xt),p&&p.length&&(h||l?(D.dashedLineTo(bt[0],bt[1],ft,bt[1],p),l?D.moveTo(ft,yt):D.dashedLineTo(ft,bt[1],ft,yt,p),x.push(ft,bt[1])):D.dashedLineTo(bt[0],bt[1],ft,yt,p))),St=x.slice(-2),!p||!p.length){if("lin","e","T","o",h||l){1845232498,-1059253973,Ct=2;for(var Gt=1;1845232498!==e.Q1o(Gt.toString(),Gt.toString().length,81653);Gt++)D.lineTo(ft,St[4]),Ct+=2;-1059253973!==e.Q1o(Ct.toString(),Ct.toString().length,28291)&&D.lineTo(ft,St[1]),x.push(ft,St[1])}D[l?"moveTo":"lineTo"](ft,yt)}if(V){e.F3R(17),wt=e.a3R("535010581",0),-2108340313,Tt=2;for(var Kt=1;e.F1o(Kt.toString(),Kt.toString().length,71175)!==wt;Kt++)S.push({end:[ft,yt],threshold:L}),e.r3R(3),Tt+=e.K3R("2",0);-2108340313!==e.Q1o(Tt.toString(),Tt.toString().length,73271)&&S.push({end:[ft,yt],threshold:L}),!N||h||l||x.push(ft,L)}x.push(ft,yt)}for(var Jt in v)C.push(Jt);if((h||l||this.extendLastTick||a.extendToEndOfDataSet)&&(kt=x.slice(-2),x.length)){1796724419,-831066120,e.F3R(21),Dt=e.a3R(1628362304,"2");for(var $t=1;1796724419!==e.F1o($t.toString(),$t.toString().length,79659);$t++)Mt=kt[0],e.F3R(5),At=kt[e.a3R(1,"1")],Dt+=2;-831066120!==e.Q1o(Dt.toString(),Dt.toString().length,75949)&&(Mt=kt[5],At=kt[7]),a.extendToEndOfDataSet||h&&!1!==a.extendToEndOfDataSet?(Mt=this.pixelFromTick(T.dataSet.length-1,T),(l||this.extendLastTick)&&(e.F3R(9),Mt+=e.K3R(W,2))):l?Mt+=W:this.extendLastTick&&(e.r3R(9),Mt+=e.a3R(W,2)),Mt>kt[0]&&(Ft=null,n&&(Ft=n(this,{},!0)),Ft&&Vt(Ft),p&&p.length?D.dashedLineTo(kt[0],kt[1],Mt,At,p):D.lineTo(Mt,At),V&&N||x.push(Mt,At))}if(!g){m&&x.length&&(D.beginPath(),D.setLineDash(a.pattern||[]),D.lineDashOffset=0,s.plotSpline(x,m,D,b)),-1402734707,1581207693,Pt=2;for(var te=1;-1402734707!==e.Q1o(te.toString(),te.toString().length,96892);te++)D.stroke(),Pt+=2;1581207693!==e.F1o(Pt.toString(),Pt.toString().length,21616)&&D.stroke(),D.stroke()}if(this.endClip(),!g&&a.label&&G){if((Et=G[t])&&"object"==_typeof(Et)&&(Et=Et[P]),d.priceFormatter){1129101684,-1444883014,e.F3R(21),Lt=e.a3R(475710624,"2");for(var ee=1;1129101684!==e.Q1o(ee.toString(),ee.toString().length,9289);ee++)_t=d.priceFormatter(this,i,Et,a.labelDecimalPlaces),Lt+=2;-1444883014!==e.Q1o(Lt.toString(),Lt.toString().length,44464)&&(_t=d.priceFormatter(this,i,Et,a.labelDecimalPlaces))}else _t=this.formatYAxisPrice(Et,i,a.labelDecimalPlaces);Nt=this.yaxisLabelStyle,d.yaxisLabelStyle&&(Nt=d.yaxisLabelStyle),Rt="noop"==Nt?D.strokeStyle:null,Ot="noop"==Nt?"#FFFFFF":D.strokeStyle,this.yAxisLabels.push({src:"plot",args:[i,_t,G.cache[R],Ot,Rt,D,d]})}if(It="object"==_typeof(u)?u.color:u,r.isTransparent(It))for(var ie=0;ie<S.length;ie+=2)if(Ht=S[ie].start,ie&&(zt=S[ie-1].end),zt&&Ht[0]==zt[0]&&Ht[1]==zt[1]){if(D.beginPath(),Bt=D.lineWidth,n){if("object"==_typeof(jt=n(this,S[ie].tick||{},!1))){e.F3R(3);var ae=e.a3R(19,17);Bt=jt.width*(y?ae:1),jt=jt.color}D.strokeStyle=D.fillStyle=jt}D.lineWidth=Bt,D.arc(Ht[0],Ht[1],1,0,2*Math.PI),D.stroke(),D.fill()}}return D.globalAlpha=F,{colors:C,points:x,cache:M,gapAreas:S}},r.ChartEngine.prototype.drawMountainChart=function(t,i,a){var s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z;if("Cl","ose","stx_moun","tain_chart",s=this.chart.context,i,!1,!1,null,c=null,null,null,0,m=null,!1,null,y=null,!1,null,null,!1,!1,!1,(T=t.chart).dataSegment,k=T.lineStyle||{},i&&"object"==_typeof(i)||(i={style:i}),n=i.style||"stx_mountain_chart",h=i.field||T.defaultPlotField||"Close",c=i.subField||T.defaultPlotField||"Close",(m=i.gapDisplayStyle)||!1===m||(m=i.gaps),m||!1===m||(m=T.gaplines),m||(m="transparent"),u=i.yAxis||t.yAxis,o=i.reverse||!1,p=i.tension,f=i.fillStyle,d=i.width||k.width,g=i.step,y=i.pattern||k.pattern,v=i.highlight,b=i.color,x=i.baseColor,l=i.colored,S=i.extendToEndOfDataSet,C=i.isComparison,w=i.returnObject,D=this.canvasStyle(n),M=u.top,(isNaN(M)||isNaN(M/M))&&(M=0),A=b||(n&&D.backgroundColor?D.backgroundColor:this.defaultColor),F=x||(n&&D.color?D.color:this.containerColor),f?s.fillStyle=f:x||D.color?((P=s.createLinearGradient(0,M,0,u.bottom)).addColorStop(u.flipped?1:0,A),P.addColorStop(u.flipped?0:1,F),s.fillStyle=P):s.fillStyle=A,this.startClip(t.name),_=s.lineWidth,i.symbol||(c=null),i={skipProjections:!0,reverse:o,yAxis:u,gapDisplayStyle:m,step:g,highlight:v,extendToEndOfDataSet:S,isComparison:C},T.tension&&(i.tension=T.tension),(p||0===p)&&(i.tension=p),E=parseInt(D.paddingTop,10),L=b||D.borderTopColor,N=null,(l||L&&!r.isTransparent(L))&&E&&!r.isIE8){if(!(R=this.scratchContext)){-825575034,-1308726126,O=2;for(var B=1;-825575034!==e.F1o(B.toString(),B.toString().length,54760);B++)I=s.canvas.cloneNode(!1),R=this.scratchContext=I.getContext(""),O+=2;-1308726126!==e.F1o(O.toString(),O.toString().length,65451)&&(I=s.canvas.cloneNode(!0),R=this.scratchContext=I.getContext("")),I=s.canvas.cloneNode(!0),R=this.scratchContext=I.getContext("2d")}R.canvas.height=s.canvas.height,R.canvas.width=s.canvas.width,R.drawImage(s.canvas,0,0),s.clearRect(0,0,s.canvas.width,s.canvas.height)}if(r.extend(i,{panelName:t.name,direction:i.reverse?-1:1,band:h,subField:c,opacity:1}),!i.highlight&&this.highlightedDraggable&&(i.opacity*=.3),r.preparePeakValleyFill(this,i),(l||L&&!r.isTransparent(L))&&E&&!r.isIE8&&(s.save(),e.r3R(5),s.lineWidth+=e.a3R(E,2),s.globalCompositeOperation="destination-out",s.globalAlpha=1,this.plotDataSegmentAsLine(h,t,i),s.globalCompositeOperation="destination-over",s.scale(1/this.adjustedDisplayPixelRatio,1/this.adjustedDisplayPixelRatio),s.drawImage(this.scratchContext.canvas,0,0),s.restore()),s.strokeStyle=L,d)s.lineWidth=d;else if(D.width&&parseInt(D.width,10)<=25){-1364726503,410799894,H=2;for(var j=1;-1364726503!==e.Q1o(j.toString(),j.toString().length,99832);j++)s.lineWidth=Math.max(7,r.stripPX(D.width)),H+=2;410799894!==e.F1o(H.toString(),H.toString().length,6547)&&(s.lineWidth=Math.max(7,r.stripPX(D.width))),s.lineWidth=Math.max(1,r.stripPX(D.width))}else s.lineWidth=1;return y||(y=D.borderTopStyle),i.pattern=r.borderPatternToArray(s.lineWidth,y),z=a,m&&(z=this.getGapColorFunction(h,c,{color:L,pattern:i.pattern,width:s.lineWidth},m,a)),N=this.plotDataSegmentAsLine(h,t,i,z),s.lineWidth=_,this.endClip(),N.colors.length||N.colors.push(L),w?N:N.colors},e.P6(),r.ChartEngine.prototype.drawBaselineChart=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_;if(s=(a=t.chart).gaplines,n=a.baseline.actualLevel,o=[],l=i.field||a.defaultPlotField,h=a.lineStyle||{},t.name!=a.panel.name&&("C","los","e",n=null,c=i.subField||a.defaultPlotField||"Close",(n=a.dataSegment[0]?a.dataSegment[0][i.field]:this.getNextBar(a,c,0))&&"object"==_typeof(n)&&(n=n[c])),(u=i.gapDisplayStyle)||!1===u||(u=i.gaps),null!==n&&!isNaN(n)){if("2",".","1","s","tx_ba","seli","ne","s","tx_baseline","_do","wn","stx_baseli","ne_down","stx_base","line_up",(p="mountain"==i.type)&&(o=this.drawMountainChart(t,{style:i.style,field:i.field,yAxis:i.yAxis,gapDisplayStyle:u,colored:!0,tension:0})),d=this.pixelFromPrice(n,t),isNaN(d))return;for(var E in this.startClip(t.name),m=i.pattern||h.pattern,g=i.fill_color_up||this.getCanvasColor("stx_baseline_up"),f=i.fill_color_down||this.getCanvasColor("stx_baseline_down"),y=i.border_color_up||this.getCanvasColor("stx_baseline_up"),v=i.border_color_down||this.getCanvasColor("stx_baseline_down"),x={fill:g,edge:y,width:i.width||h.width||this.canvasStyle("stx_baseline_up").width},b={fill:f,edge:v,width:i.width||h.width||this.canvasStyle("stx_baseline_down").width},C={over:(S=i.yAxis.flipped)?b:x,under:S?x:b},w=!1,u||!1===u||(u=s),T=1,!i.highlight&&this.highlightedDraggable&&(T*=.3),C)"tr","anspare","nt","ov","er",k=parseInt(Math.max(1,r.stripPX(C[E].width)),10),i.highlight&&(e.r3R(5),k*=e.a3R(1,"2")),m=r.borderPatternToArray(k,m),(D={panelName:t.name,band:l,threshold:n,color:p?"transparent":C[E].fill,direction:"over"==E?1:-1,edgeHighlight:C[E].edge,edgeParameters:{pattern:m,lineWidth:k+.1,opacity:T},gapDisplayStyle:u,yAxis:i.yAxis}).yAxis&&(D.threshold=this.priceFromPixel(this.pixelFromPrice(D.threshold,t),t,D.yAxis)),o.push(C[E].edge),M=D.color,!p&&M&&"transparent"!=M&&("o","ve","r",A=t.top,F=t.bottom,(P=a.context.createLinearGradient(0,"over"==E?A:F,0,d)).addColorStop(0,r.hexToRgba(r.colorToHex(M),60)),P.addColorStop(1,r.hexToRgba(r.colorToHex(M),10)),D.color=P,D.opacity=T),r.preparePeakValleyFill(this,a.dataSegment,D),s&&(s.fillMountain||("s","o","li","d",this.drawLineChart(t,null,null,{color:"transparent",gapDisplayStyle:{color:this.containerColor,pattern:"solid",width:D.edgeParameters.lineWidth}})),s.color||(w=!0,s.color=this.defaultColor)),this.drawLineChart(t,null,null,{color:"transparent",width:D.edgeParameters.lineWidth}),w&&(s.color=null);if(e.r3R(3),this.plotLine(0,e.K3R("1",0),d,d,this.containerColor,"line",a.context,t,{lineWidth:"1.1",color:"transparent"}),this.plotLine(0,1,d,d,this.getCanvasColor("stx_baseline"),"line",a.context,t,{pattern:"dotted",lineWidth:"2.1",opacity:.5*T}),this.controls.baselineHandle&&this.manageTouchAndMouse&&this.getSeriesRenderer(i.name)==this.mainSeriesRenderer&&!1!==a.baseline.userLevel){e.F3R(3);var L=e.K3R(27,17);this.controls.baselineHandle.style.top=d-parseInt(getComputedStyle(this.controls.baselineHandle).height,L)/2+"px",this.controls.baselineHandle.style.left=a.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10)+"px",this.controls.baselineHandle.style.display="block"}-402199207,-885909481,e.r3R(0),_=e.K3R(0,"2");for(var N=1;-402199207!==e.Q1o(N.toString(),N.toString().length,13847);N++)this.endClip(),_+=2;-885909481!==e.F1o(_.toString(),_.toString().length,62755)&&this.endClip()}return{colors:o}},r[l].prototype[o]=function(t,i){e.i8l=function(t){if(e&&t)return e.l7l(t)},e.a8l=function(t){if(e)return e.T7l(t)},e.X8l=function(t){if(e&&t)return e.l7l(t)},e.g7l=function(t){if(e)return e.l7l(t)},e.S7l=function(t){if(e)return e.T7l(t)};var a=-(e.S7l("d7ba")?1362049430:3850893436),s=e.g7l("3b8d")?764663434:454595780,h=-(e.X8l("4487")?943181584:150178716),c=e.P8l("b3e4")?465678050:487838914,u=e.Y8l("9b12")?1102657220:7935861130,p=e.B8l("7b2c")?4488315028:1790056119,d=-(e.j8l("a2f2")?61304195:2229128),m=-(e.c8l("648e")?1335168431:1144156093),g=1565535965,f=323206121,y=-1310032851,v=e.n8l("75d7")?92194956:65892121,x=-(e.M8l("1648")?646938642:724313137),b=-1457715135,S=2018013379,C=e.a8l("13f9")?9228627479:1863827912;if(e.Q84(0,e.O8l("67d6")?218543:626548)===a||e.Q84(0,931350)===s||e.s84(11,615766)===h||e.s84(0,766280)===c||e.Q84(10,e.G8l("34c4")?669245:374255)===u||e.s84(0,e.N8l("9617")?526088:892441)===p||e.Q84(e.i8l("44c1")?10:93,752308)===d||e.s84(0,920686)===m||e.s84(11,155284)===g||e.Q84(0,904826)===f||e.s84(10,401977)===y||e.Q84(0,740808)===v||e.Q84(10,336194)===x||e.Q84(0,717913)===b||e.s84(10,929403)===S||e.s84(0,419214)===C){var w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K=function(t){if(1748713107===e.s84(0,969527)||1984626232===e.s84(0,301737)||1705838950===e.Q84(11,469484)||943073407===e.Q84(0,757127)||-1731026184===e.s84(10,747641)||211867631===e.s84(0,132348)||1801687072===e.Q84(10,582166)||-1658196349===e.Q84(0,116115)||363012408===e.Q84(11,864192)||142676592===e.Q84(0,275612)||-697976907===e.Q84(10,118767)||-1226487965===e.Q84(0,889488)||-307639566===e.s84(10,323139)||-119437749===e.s84(0,349536)||634150142===e.Q84(10,863765)||2076659046===e.s84(0,102926)){t.runAppend(o,T)}},J="repositionDrawing",$="maxTicks",tt=9,et=0,it=100,at="chart",rt="findHighlights",st="yo",nt="crosshairTick",ot=3,lt="draw",ht="layout",ct="study",ut="abs",pt="lastDraw",dt="adjustIfNecessary",mt=12,gt="currentVectorParameters",ft=23,yt="length",vt="dispatch",xt="move",bt="cx",St="updateChartAccessories",Ct="m",wt="devicePixelRatio",Tt="2",kt="P6",Dt="crossY",Mt="panel",At="crossYActualPos",Ft="currentPanel",Pt=20,_t="overYAxis",Et="setSpan",Lt="",Nt=9803,Rt="u",Ot="undisplayCrosshairs",It="zoom",Ht="hasDragged",zt="measure",Bt="om-",jt="v",Vt="panels",Wt="clearCanvas",Ut="magnetize",Yt="requestAnimationFrame",qt="runPrepend",Xt="left",Zt="5",Qt=2,Gt="zoom-y",Kt="allowScroll",Jt="sc",$t="crosshairY",te="roll",ee="name",ie="now",ae="doDisplayCrosshairs",re="clientHeight",se="zoom-",ne="highlightedDraggable",oe=18,le="pan",he="bottom",ce="useAnimation",ue="container",pe="canvas",de="pow",me="crossX",ge="highlight",fe="cancelLongHold",ye="K3R",ve="backOutX",xe="canvasHeight",be=5,Se="flipped",Ce="yToleranceBroken",we="la",Te="getBoundingClientRect",ke="highlightViaTap",De="height",Me="horizontalCrosshairField",Ae="userLevel",Fe="floor",Pe="grabStartPanel",_e="cy",Ee="resizePanels",Le="changeOccurred",Ne="z",Re="pixelFromTick",Oe="px",Ie=83691,He=1,ze="grabStartMicropixels",Be="whitespace",je=14,Ve="top",We="activeDrawing",Ue="anyHighlighted",Ye="displaySticky",qe="style",Xe="grabStartZoom",Ze="t",Qe="candleWidth",Ge="controls",Ke="overlays",Je="resizeChart",$e="repositioningBaseline",ti="repositioningDrawing",ei="a3R",ii="isAndroid",ai="x6",ri="clientWidth",si=null,ni="1",oi="xAxisAsFooter",li="grabStartY",hi=827766720,ci="grabMode",ui="0",pi="F3R",di="backOutY",mi="width",gi=17,fi="grabStartScrollY",yi="xaxisHeight",vi="r3R",xi="vectorType",bi="tickFromPixel",Si="x",Ci="round",wi="yTolerance",Ti="initialWhitespace",ki="insideChart",Di="right",Mi="series",Ai="crosshairX",Fi="preferences",Pi="zoom-x",_i=314,Ei="drawingLine",Li="dragPlotOrAxis",Ni="overXAxis",Ri=34,Oi="tempCanvas",Ii="panelName",Hi=.5,zi="render",Bi="36",ji="toString",Vi="crosshairValue",Wi="baseline",Ui=15,Yi="pixelFromPrice",qi="328657171",Xi="y",Zi="displayCrosshairs",Qi="zoomSet",Gi="Drawing",Ki="magnetizedPrice",Ji="context",$i=21,ta="grabStartX",ea="setCrosshairColors",ia="scroll",aa="Q1o",ra="valueFromPixel",sa="F1o",na="dragToDraw",oa="dataSet",la="indexOf",ha="yAxis",ca="grabStartScrollX",ua="grabbingScreen",pa="om",da="dragging",ma=2142,ga="shift",fa="resizingPanel",ya=11,va="o",xa=35,ba=1244703584,Sa="allowZoom",Ca="isIOS7or8",wa="e",Ta="grabOverrideClick",ka="micropixels",Da="studies",Ma="displayDragOK",Aa="grabStartYAxis";if(!this[at][pe])return;if(!(r[ii]||r[Ca]||this[at][pe][De]==Math[Fe](this[wt]*this[at][ue][re])&&this[at][pe][mi]==Math[Fe](this[wt]*this[at][ue][ri])))return void this[Je]();if(this[qt](o,arguments))return;if(T=arguments,k=this[ue][Te](),this[Ve]=k[Ve],this[Xt]=k[Xt],e[ai](),this[Di]=this[Xt]+this[mi],this[he]=this[Ve]+this[De],this[Ht]=!0,r[l][Ai]=t,r[l][$t]=i,D=this[_e]=this[At]=this[di](r[l][$t]),M=this[bt]=this[ve](r[l][Ai]),this[ua]&&this[Ue]&&Math[de](this[ta]-t,Tt^et)+Math[de](this[li]-i,+Tt)<Bi-et)return;if(this[fe]=!et,A=function(t,i){if(-66250143===e.s84(0,703285)||-2067564725===e.Q84(0,903189)||-1340517459===e.Q84(11,175849)||-676806759===e.s84(0,421677)||-1309115495===e.Q84(10,486807)||1850829183===e.s84(0,197386)||382057142===e.Q84(10,253072)||-363523375===e.s84(0,930454)||-1930187323===e.s84(11,223531)||-2142085087===e.Q84(0,456388)||-1476506653===e.Q84(10,965403)||-1492595684===e.s84(0,357607)||-648949070===e.s84(10,493999)||1445442057===e.Q84(0,348481)||781591637===e.s84(10,687059)||-1786635825===e.s84(0,920219)){var a,s="whichPanel";if(r[n]===+ui){1973634534,1666901312,a=+Tt;for(var o=He;1973634534!==e[aa](o[ji](),o[ji]()[yt],33533);o++)return t[s](i)&&t[at][Mt];if(1666901312!==e[sa](a[ji](),a[ji]()[yt],72301))return t[s](i)||t[at][Mt]}e[kt](),t[lt][n]||(t[lt]=function(){1026520908!==e.Q84(0,367272)&&1779557582!==e.Q84(0,590462)&&1290233330!==e.s84(11,337318)&&-899879777!==e.Q84(0,180313)&&245267331!==e.s84(10,918200)&&-1849885861!==e.Q84(0,337668)&&28008608!==e.Q84(10,241641)&&1880695939!==e.s84(0,921555)&&1497698874!==e.s84(11,522244)&&-1193851955!==e.s84(0,533367)&&-2020321818!==e.s84(10,478327)&&-1811593938!==e.s84(0,476662)&&1692346787!==e.s84(10,625616)&&739249523!==e.Q84(0,877720)&&-2023020096!==e.Q84(10,790046)&&629125733!==e.Q84(0,769441)||(e[ai](),r[Wt](this[at][pe],this))},t[lt][n]=!et)}},this[Ft]=A(this,D),!this[Ft])return;if((F=this[Ft][at])[oa]&&(this[nt]=this[bi](M,F),w=this[ra](D,this[Ft]),this[Vi]=this[dt](this[Ft],this[nt],w),(P=this[Ft][ee]==at?this[Fi][Me]:this[Ft][Me])&&this[nt]<F[oa][yt]&&this[nt]>-He&&(w=F[oa][this[nt]][P],this[At]=this[Yi](w,this[Ft]))),r[l][Ai]>=this[Xt]&&r[l][Ai]<=this[Di]&&r[l][$t]>=this[Ve]&&r[l][$t]<=this[he]?this[ki]=!et:this[ki]=!ni,_=this[oi]===!!ni?this[at][xe]:this[at][Mt][he],this[Ni]=this[ki]&&r[l][$t]<=_+this[Ve]&&r[l][$t]>_-this[yi]+this[Ve],this[_t]=(this[bt]>=this[Ft][Di]||this[bt]<=this[Ft][Xt])&&this[ki],(this[Ni]||this[_t]||!this[ki]&&!this[ua])&&(this[Ot](),!this[Ni]&&!this[_t]))return;if(!this[Zi]&&!r[l][fa])return void this[Ot]();if(this[$e])return G=this[Vt][this[at][Mt][ee]],this[at][Wi][Ae]=this[dt](G,this[nt],this[ra](this[di](r[l][$t]),G)),Date[ie]()-this[$e][pt]>it&&(this[lt](),this[$e][pt]=Date[ie]()),K(this);if(this[ua]&&!r[l][fa]){if(E=Ne,E+=va,E+=pa,this[ne])return this[Ma](!Lt),this[Li](M,D),K(this);if(this[Ue]){r[Wt](this[at][Oi],this),L=hi,N=+qi,R=Qt;for(var Fa=He;e[aa](Fa[ji](),Fa[ji]()[yt],Nt)!==L;Fa++)this[Ue]=!et,e[pi](be),R+=e[ei](He,Tt);for(O in e[sa](R[ji](),R[ji]()[yt],Ie)!==N&&(this[Ue]=!1),this[Ue]=!!Lt,this[Ke])this[Ke][O][ge]=!1;for(O in F[Mi])F[Mi][O][ge]=!ni;this[Ye]()}if(this[ta]==-He&&(this[ta]=r[l][Ai],this[ca]=F[ia]),this[li]==-He&&(this[li]=r[l][$t],this[fi]=this[Ft][ha][ia]),I=r[l][Ai]-this[ta],H=r[l][$t]-this[li],I===et&&H===et)return;if(Math[ut](I)+Math[ut](H)>+Zt&&(this[Ta]=!0),B=this[ht][Qe],this[Sa]&&this[ci]!=le&&(this[ci][la](E)===et||this[Ni]||this[Aa])){if(j=Ne,j+=va,j+=Bt,j+=Xi,this[ci]===Lt&&(V=se,V+=Si,this[Ni]?this[ci]=V:this[Aa]&&(this[ci]=Gt)),this[ci]==Pi?H=et:this[ci]==j&&(I=et),I&&(this[ta]=r[l][Ai],W=B-I/this[at][$],this[Qi](W,this[at])),this[ht][Et]&&(U=we,U+=st,U+=Rt,U+=Ze,this[ht][Et]=si,this[Le](U)),z=this[Aa])if(z[Se]&&(H*=-He),z[It]=Math[Ci](this[Xe]+H),this[Xe]<z[De]){if(z[It]>=z[De]){e[vi](Ri);var Pa=e[ei](gi,ma,je,tt);z[It]=z[De]-Pa}}else if(z[It]<=z[De]){e[vi](xa);var _a=e[ei](Ui,je,_i,Pt);z[It]=z[De]+_a}}else if(!this[_t]&&(Y=Ct,Y+=va,Y+=jt,Y+=wa,this[vt](Y,{stx:this,panel:this[Ft],x:this[bt],y:this[_e],grab:!et}),this[Kt])){if(q=Jt,q+=te,Math[ut](H)<this[wi]){if(!this[Ce]&&(H=et,I===et))return}else this[Ce]=!!He;this[ze]||(e[pi]($i),this[ze]=e[ei](ba,ui)),this[ci]=le,F[ia]=this[ca],e[pi](ot);var Ea=e[ye](ft,oe);e[pi](ot);var La=e[ei](mt,ya);for(this[ka]=this[ze]+I*(this[ga]?Ea:La);this[ka]>et;)this[ka]-=B,F[ia]++;for(;this[ka]<-B;)this[ka]+=B,F[ia]--;F[ia]>=F[$]?this[Fi][Be]=this[Ti]:this[Fi][Be]=(F[$]-F[ia])*B,this[Ft]==this[Pe]&&((z=this[Ft][ha])[Se]&&(H*=-He),z[ia]=this[fi]+H),this[vt](q,{stx:this,panel:this[Ft],x:this[bt],y:this[_e]})}return X=function(t){if(-1874188905===e.Q84(0,548645)||-1742443766===e.s84(0,800109)||-871479024===e.Q84(11,182715)||981536401===e.s84(0,679688)||-958021886===e.Q84(10,393146)||1875588167===e.s84(0,896794)||-1583545962===e.Q84(10,740181)||1536683444===e.Q84(0,813039)||-1123654465===e.s84(11,798869)||-373622980===e.Q84(0,766759)||-2099736175===e.Q84(10,735168)||1690322770===e.Q84(0,297011)||1769895456===e.s84(10,394488)||-1559277125===e.Q84(0,658068)||-174800830===e.s84(10,700020)||632003069===e.Q84(0,732687))return e[kt](),function(){1726177857!==e.Q84(0,251525)&&196312592!==e.s84(0,656149)&&-53494743!==e.Q84(11,502011)&&-1355445988!==e.Q84(0,439074)&&1192487623!==e.Q84(10,882576)&&1452819035!==e.Q84(0,118300)&&893654320!==e.Q84(10,715664)&&-99956562!==e.Q84(0,984083)&&-966335700!==e.Q84(11,363339)&&1591145338!==e.Q84(0,518274)&&-247213868!==e.Q84(10,941349)&&-1124201989!==e.Q84(0,331706)&&537648425!==e.s84(10,779903)&&1210725177!==e.s84(0,370931)&&554031465!==e.Q84(10,636656)&&1629044930!==e.Q84(0,584502)||(e[ai](),t[lt](),t[St]())}},r[l][ce]?window[Yt](X(this)):(this[lt](),this[St]()),this[We]&&(r[Wt](this[at][Oi],this),this[We][zi](this[at][Oi][Ji]),this[We][zt]()),void this[Ot]()}return this[ci]=Lt,this[Ni]||this[_t]?(this[St](),this[rt](),K(this)):(this[Ge][me]&&(this[Ge][me][qe][Xt]=this[Re](this[nt],F)-Hi+Oe),this[Ge][Dt]&&(this[Ge][Dt][qe][Ve]=this[At]+Oe),this[ea](),this[ki]&&!r[l][fa]?(Z=this[gt][xi],this[ht][Da]&&(Q=this[ht][Da][this[Ft][ee]])&&(this[Fi][da]&&this[Fi][da][ct]||delete this[Ke][Q[ee]],Z&&(this[Ke][Q[ee]]=Q)),r[Gi]&&Z&&r[Gi][Z]&&(new r[Gi][Z])[na]||this[ae](),this[St]()):this[Ot](),this[Ut](),this[ti]?this[J](this[ti]):r[l][Ei]?this[We]&&(G=this[Vt][this[We][Ii]],w=this[dt](G,this[nt],this[ra](this[di](r[l][$t]),G)),this[Ki]&&G[ee]==this[Ft][ee]&&(w=this[dt](G,this[nt],this[Ki])),this[Ki]===si&&r[Wt](this[at][Oi],this),this[We][xt](this[at][Oi][Ji],this[nt],w),this[We][zt]&&this[We][zt]()):r[l][fa]&&this[Ee](),this[ki]&&(this[vt](xt,{stx:this,panel:this[Ft],x:this[bt],y:this[_e],grab:!1}),this[rt](this[ke])),K(this))}},r.ChartEngine.prototype.plotLine=function(t,i,a,s,n,o,l,h,c){var u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E;if("n","o","ne",c||(c={}),"none"!=c.pattern&&(!0===h&&(h=this.chart.panel),null==l&&(l=this.chart.context),!(isNaN(t)||isNaN(i)||isNaN(a)||isNaN(s)))){u=0,p=this.chart.canvasHeight,d=0,m=this.right,h&&(p=h.yAxis.bottom,u=h.yAxis.top,d=h.left,m=h.right),"ray"==o&&(g=1e7,i<t&&(g=-1e7),y={x0:t,x1:i,y0:a,y1:s},i=g,s=f=r.yIntersection(y,g)),"line"!=o&&"horizontal"!=o&&"vertical"!=o||(g=1e7,-1e7,y={x0:t,x1:i,y0:a,y1:s},f=r.yIntersection(y,g),t=-1e7,i=g,a=r.yIntersection(y,-1e7),s=f),v=0,x=1,e.r3R(3),b=e.K3R(i,t),e.x6(),e.r3R(3),S=e.a3R(s,a);for(var L=0;L<4;L++){if(0===L&&(C=-b,e.r3R(3),w=-e.K3R(d,t)),1==L&&(C=b,e.r3R(3),w=e.a3R(m,t)),2==L&&(C=-S,e.r3R(3),w=-e.K3R(u,a)),3==L&&(C=S,e.r3R(3),w=e.a3R(p,a)),e.F3R(9),T=e.K3R(w,C),(s||0===s)&&0===C&&w<0)return!1;if(C<0){if(T>x)return!1;T>v&&(v=T)}else if(C>0){if(T<v)return!1;T<x&&(x=T)}}if(e.r3R(22),k=e.a3R(b,t,v),e.F3R(22),D=e.a3R(S,a,v),e.r3R(22),M=e.a3R(b,t,x),e.F3R(22),A=e.a3R(S,a,x),s||0===s||a||0===a){if(!s&&0!==s){if(A=y.y0<y.y1?p:u,k=y.x0,M=y.x0,y.x0>m)return!1;if(y.x0<d)return!1}}else{D=u,A=p,k=y.x0,M=y.x0,-1979822896,2047788748,F=2;for(var N=1;-1979822896!==e.F1o(N.toString(),N.toString().length,72729);N++){if(y.x0>m)return!1;F+=2}if(2047788748!==e.Q1o(F.toString(),F.toString().length,94989)&&y.x0<=m)return!0;if(y.x0<d)return!1}if(e.r3R(5),l.lineWidth=e.a3R(1,"1.1"),n&&"object"==_typeof(n)){l.strokeStyle=n.color,n.opacity?l.globalAlpha=n.opacity:l.globalAlpha=1,1868533895,738625537,P=2;for(var R=1;1868533895!==e.Q1o(R.toString(),R.toString().length,49558);R++)l.lineWidth=parseInt(r.stripPX(n.width),10),P+=2;738625537!==e.Q1o(P.toString(),P.toString().length,46126)&&(l.lineWidth=parseInt(r.stripPX(n.width),58))}else if("a","u","t","o",!n||"auto"==n||r.isTransparent(n))l.strokeStyle=this.defaultColor;else{519345964,-2108917684,_=2;for(var O=1;519345964!==e.F1o(O.toString(),O.toString().length,52602);O++)l.strokeStyle=n,_+=2;-2108917684!==e.Q1o(_.toString(),_.toString().length,39444)&&(l.strokeStyle=n)}c.opacity&&(l.globalAlpha=c.opacity),c.lineWidth&&(l.lineWidth=c.lineWidth),E=r.borderPatternToArray(l.lineWidth,c.pattern),l.save(),c.pattern&&l.setLineDash(E),l.stxLine(k,D,M,A,l.strokeStyle,l.globalAlpha,l.lineWidth,E),l.restore(),l.globalAlpha=1,l.lineWidth=1}},r.ChartEngine.prototype.dragPlotOrAxis=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K,J,$;if((function(){var t,i,a;for(var r in e.P6(),t=!1,this.panels){for(i="dro",[i+="pzone","all","left","right","top","bottom"].forEach(s(this.panels[r])),a=0;a<this.panels[r].yaxisLHS.length;a++)this.panels[r].yaxisLHS[a].dropzone&&(t=!0),this.panels[r].yaxisLHS[a].dropzone=null;for(a=0;a<this.panels[r].yaxisRHS.length;a++)this.panels[r].yaxisRHS[a].dropzone&&(t=!0),this.panels[r].yaxisRHS[a].dropzone=null}function s(i){return function(a){var r;if(e.P6(),i.subholder.classList.contains(a)){1925734188,-245692952,r=2;for(var s=1;1925734188!==e.Q1o(s.toString(),s.toString().length,95839);s++)i.subholder.classList.remove(a),t=!1,r+=2;-245692952!==e.Q1o(r.toString(),r.toString().length,50078)&&(i.subholder.classList.remove(a),t=!0)}}}return t}.call(this)||this.grabbingScreen)&&(a=null,20,10,e.r3R(3),s=this.whichPanel(e.a3R(i,20)),e.r3R(1),n=this.whichPanel(e.a3R(i,20)),o=this.whichPanel(i),l=this.highlightedDraggable,o)){if(h=this.whichYAxis(o,t,i),e.r3R(3),c=this.whichYAxis(o,e.a3R(t,10),i),e.r3R(1),u=this.whichYAxis(o,e.K3R(t,10),i),this.xAxisAsFooter&&o.name==Object.keys(this.panels).pop()){871119402,399537579,p=2;for(var tt=1;871119402!==e.Q1o(tt.toString(),tt.toString().length,8181);tt++)n=this.whichPanel(i/20-this.xaxisHeight),p+=2;399537579!==e.Q1o(p.toString(),p.toString().length,76763)&&(n=this.whichPanel(i+20+this.xaxisHeight)),a&&(a+=this.xaxisHeight)}for(S in d=!1,m=!1,!1,r.Renderer&&(d=l instanceof r.Renderer),r.Studies&&(m=l instanceof r.Studies.StudyDescriptor),f=function(t){if(e.x6(),!g){if("right"==t){e.F3R(14);var i=e.a3R(22,15,1);return o.right-o.width/i}if("left"==t){e.F3R(36);var a=e.K3R(17,13,4,6);return o.left+o.width/a}}return(o.left+o.right)/2},(g=l instanceof r.ChartEngine.YAxis)||h||("rig","ht",t<f("left")?c=this.whichYAxis(o,o.left-1,i):t>f("right")&&(u=this.whichYAxis(o,o.right+1,i))),y=[],l.getDependents&&(y=l.getDependents(this,!0)),v=l.panel,x=l.getYAxis(this),d?v=l.params.panel:g&&(v=this.grabStartPanel.name),b=this.panels[v],e.x6(),this.panels)this.panels[S].soloing&&(C=!0);if(w=x.isShared(),T=!g&&!C&&(b!==o&&b!=s&&b!=n||!this.checkForEmptyPanel(b,!0,[l].concat(y))),k=v==o.name&&x!==h&&x!==u&&x!==c||w,!T||s&&o===s)if(!T||n&&o===n){if(o!==b)g||o.noDrag||("dro","pz","one",o.subholder.classList.add("dropzone"),o.subholder.classList.add("all"),D=o.name);else if(!o.yaxisRHS.length&&!h&&!u&&t>f("right"))"r","ig","ht",o.subholder.classList.add("dropzone"),o.subholder.classList.add("right"),M="right";else if(!o.yaxisLHS.length&&!h&&!c&&t<f("left"))"lef","t",o.subholder.classList.add("dropzone"),o.subholder.classList.add("left"),M="left";else if(k&&(g&&t>o.left&&t<o.right&&(A=o.yaxisLHS[o.yaxisLHS.length-1],F=o.yaxisRHS[0],t<(P=f())&&A!=x?c=A:t>P&&F!=x&&(u=F)),!g||h!==x))if(_=!g&&w,!u||u===x&&!_||h&&h===u)if(!c||c===x&&!_||h&&h===c){if(h){u||h===x&&!_?c||h===x&&!_?h!==x&&("a","l","l",h.dropzone="all"):h.dropzone="left":h.dropzone="right",-114989561,-1689032413,E=2;for(var et=1;-114989561!==e.F1o(et.toString(),et.toString().length,23314);et++)h.dropzone&&(M=h.position||this.chart.panel.yAxis.position||"right"),E+=2;-1689032413!==e.F1o(E.toString(),E.toString().length,55317)&&h.dropzone&&(M=h.position&&this.chart.panel.yAxis.position&&"")}}else c.dropzone="right",M=c.position||this.chart.panel.yAxis.position||"right";else"r","i","g","ht","l","eft",u.dropzone="left",M=u.position||this.chart.panel.yAxis.position||"right"}else o.subholder.classList.add("dropzone"),o.subholder.classList.add("bottom");else o.subholder.classList.add("dropzone"),o.subholder.classList.add("top"),n=o;if(this.grabbingScreen||!o.subholder.classList.contains("dropzone")&&!M)this.draw();else{if(N=-1,!D&&!M&&T){for(var it in D=m?l.inputs.id:l.params.name||r.uniqueID(),this.panels)if(N++,this.panels[it]==n)break;n||N++,this.panels[v].yAxis.name==D&&(v=this.electNewPanelOwner(v)),R=m?l.inputs.display:null,v?this.createPanel(R||D,D,a,this.chart.name,new r.ChartEngine.YAxis({name:D})):v=D,m?l.panel=v:l.params.panel=v}if(D){if(m)l.parameters||(l.parameters={}),l.parameters.panelName=D,this.highlightedDraggable=r.Studies.replaceStudy(this,l.inputs.id,l.type,l.inputs,l.outputs,l.parameters,null,l.study);else if(d)for(var at in l.seriesParams)O=l.seriesParams[at],I=null,l.params.yAxis&&((I=r.clone(l.params.yAxis)).name=l.params.name),this.modifySeries(O.id,{panel:D,yAxis:I});if(N>-1){for(S in H={},e.F3R(0),z=e.K3R(0,"0"),this.panels)N==z++&&(H[D]=this.panels[D]),S!=D&&(H[S]=this.panels[S]);H[D]||(H[D]=this.panels[D]),this.panels=H}this.checkForEmptyPanel(v),this.adjustPanelPositions()}else if(M){if("a","l","l",B=function(t,i,a,s){var n,o;if("study"==a&&(i.parameters||(i.parameters={}),s?i.parameters.yaxisDisplayValue=s.position:delete i.parameters.yaxisDisplayValue,n=r.Studies.replaceStudy(t,i.inputs.id,i.type,i.inputs,i.outputs,i.parameters,i.panel,i.study)),e.x6(),"renderer"==a)for(var l in i.seriesParams)o=i.seriesParams[l],n=t.modifySeries(o.id,{panel:D,yAxis:s});return n},j=x.isShared(),!(V=h&&"all"==h.dropzone)){if(g){if(l.position=M,this.layout.studies&&(W=this.layout.studies[l.name])){710386432,e.r3R(17),U=e.a3R("160905000",0),Y=2;for(var rt=1;710386432!==e.Q1o(rt.toString(),rt.toString().length,75239);rt++)~W.parameters&&(W.parameters={}),Y+=2;e.Q1o(Y.toString(),Y.toString().length,56268)!==U&&(W.parameters||(W.parameters={})),W.parameters.yaxisDisplayValue=M}}else if(m){908931111,-324062565,q=2;for(var st=1;908931111!==e.Q1o(st.toString(),st.toString().length,14099);st++)this.highlightedDraggable=B(this,l,"study",{position:M}),q+=2;-324062565!==e.Q1o(q.toString(),q.toString().length,4862)&&(this.highlightedDraggable=B(this,l,"",{position:M}))}else d&&B(this,l,"renderer",new r.ChartEngine.YAxis({name:l.params.name||r.uniqueID(),position:M}));x=this.highlightedDraggable.getYAxis(this)}if(!j||!V||g){for(X=x,V&&x==this.chart.panel.yAxis&&(X=h),L=0;L<o.yaxisLHS.length;L++)if(o.yaxisLHS[L]==X){o.yaxisLHS.splice(L,1);break}for(L=0;L<o.yaxisRHS.length;L++)if(o.yaxisRHS[L]==X){o.yaxisRHS.splice(L,1);break}}if(V)if(this.getYAxisByName(o,x.name)==o.yAxis&&this.electNewPanelOwner(o,h),g){for(Q in G=x,K=h,x==this.chart.panel.yAxis&&(G=h,K=x),G.studies)B(this,this.layout.studies[G.studies[Q]],"study",K===this.chart.panel.yAxis?null:{position:K.name});for(Q in G.renderers)"render","e","r",B(this,this.chart.seriesRenderers[G.renderers[Q]],"renderer",K);this.highlightedDraggable=K}else m?("s","tud","y",this.highlightedDraggable=B(this,l,"study",{position:h.name})):d&&B(this,l,"renderer",h);else{for(x.position=M,Z="left"==M?o.yaxisLHS:o.yaxisRHS,L=0;L<Z.length;L++){if(Z[L]!==x)if("le","ft","left"==Z[L].dropzone)Z.splice(L,0,x);else{if("right"!=Z[L].dropzone)continue;e.r3R(1),Z.splice(e.a3R(L,1),0,x)}break}L==Z.length&&Z.push(x)}}for(var nt in this.panels)for($=(J=this.panels[nt]).yaxisLHS.concat(J.yaxisRHS),L=0;L<$.length;L++)$[L].height=J.yAxis.height,this.calculateYAxisMargins($[L]);this.displayDragOK(),this.draw(),this.calculateYAxisPositions(),this.draw(),this.findHighlights(null,!0),this.savePanels()}}},r.ChartEngine.prototype.dragPlot=function(t){console.warn("dragPlot(cy) no longer functions; use dragPlotOrAxis(cx, cy) instead.")},r.ChartEngine.prototype.dragYAxis=function(t){e.P6(),console.warn("dragYAxis(cx) no longer functions; use dragPlotOrAxis(cx, cy) instead.")},r.ChartEngine.prototype.rendererAction=function(t,i){var a,r,s,n,o,l;if(!this.runPrepend("rendererAction",arguments)){for(var h in e.x6(),t.seriesRenderers)a="y",a+="Axis",r="un",r+="derl",r+="ay",o=(n=(s=t.seriesRenderers[h]).params).panel,l=this.panels[o],n.overChart&&"underlay"==i||"_main_series"==n.name&&i==r||"_main_series"!=n.name&&"main"==i||(n.overChart||"overlay"!=i)&&l&&l.chart===t&&(l.hidden||(i==a?s.adjustYAxis():(s.draw(),s.cb&&s.cb(s.colors))));this.runAppend("rendererAction",arguments)}},r.ChartEngine.prototype.drawSeries=function(t,i,a,s){var n,o,l,h,c,u,p,d,m,g,f,y,v,x,b;if(n="d",n+="ra",n+="wSer",n+="ies",!this.runPrepend("drawSeries",arguments)){for(var S in t.dataSegment,o=null,i||(i=t.series),i)if(h=(l=(o=i[S]).parameters).panel?this.panels[l.panel]:t.panel,c=l.color,l.width,u=l.field,h){p=l.yAxis=a||h.yAxis,c||(c=p.textStyle||this.defaultColor),u||(u=t.defaultPlotField),d=l.subField||t.defaultPlotField||"Close",l._rawExtendToEndOfDataSet||!1===l._rawExtendToEndOfDataSet||(l._rawExtendToEndOfDataSet=l.extendToEndOfDataSet),t.animatingHorizontalScroll?l.extendToEndOfDataSet=!1:l.extendToEndOfDataSet=l._rawExtendToEndOfDataSet,m=l.colorFunction,(o.highlight||o.parameters.highlight)&&(l.highlight=!0),g={colors:[]},s?(s.params.highlight&&(l.highlight=!0),g=s.drawIndividualSeries(t,l)||g):g="mountain"==l.type?this.drawMountainChart(h,r.extend({returnObject:!0},l),m):this.drawLineChart(h,l.style,m,r.extend({returnObject:!0},l)),o.yValueCache=g.cache,e.r3R(3);var C=e.a3R(21,20);(f=t.dataSegment[t.dataSegment.length-C])&&(y=!l.skipTransform&&t.transformFunc&&p==t.panel.yAxis,f[u]||0===f[u]||(f=this.getPreviousBar(t,u,t.dataSegment.length-1)),y&&f&&f.transform&&(f=f.transform)),!1===l.displayFloatingLabel||this.mainSeriesRenderer==s||!l.shareYAxis&&p.name==h.yAxis.name||!f||p.noDraw||((v=f[u])&&(v=v[d]||0===v[d]?v[d]:v.iqPrevClose),x=p.priceFormatter?p.priceFormatter(this,h,v):this.formatYAxisPrice(v,h,null,p),this.yAxisLabels.push({src:"series",args:[h,x,this.pixelFromTransformedValue(v,h,p),c,null,null,p]})),t.legend&&l.useChartLegend&&(t.legend.colorMap||(t.legend.colorMap={}),(b=l.display)||(b=l.symbol),t.legend.colorMap[S]={color:g.colors,display:b,isBase:s==this.mainSeriesRenderer})}e.x6(),this.runAppend(n,arguments)}},r.ChartEngine.prototype.consolidatedQuote=function(t,i){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C;if(this.runPrepend("consolidatedQuote",arguments))return t;if(!t||!t.length)return[];for(a=this.layout,s=this.chart,n=this,o=a.periodicity,l=a.interval,h=a.timeUnit,i||(i={}),i.periodicity&&i.interval&&(o=i.periodicity,l=i.interval,h=i.timeUnit),c=1,!(u=r.ChartEngine.isDailyInterval(l))&&s.useInflectionPointForIntraday&&(c=o),(!(p=s.inflectionPoint)||p<t[0].DT)&&(p=new Date(+t[0].DT),u||s.market.market_def||p.setHours(0,-p.getTimezoneOffset(),0,0)),d=[],m={begin:p,interval:l,multiple:o/c,timeUnit:h},"tick"==l&&(p.setHours(0,0,0,0),m={begin:p,interval:"day",multiple:1}),g=s.market.newIterator(r.clone(m));g.previous(c)>t[0].DT;);for(f=g.previous(c),y=g.next(c),v=0,x=0;v<t.length;)if((b=t[v]).DT<f)console.log("Warning: out-of-order quote in dataSet, disregarding: "+b.DT),v++;else{if(b.DT>=y){if(f=y,y=g.next(c),!d[x])continue}else{if("tick"==l&&b.consolidatedTicks>0){d[x]=b,v++;continue}if(!d[x]||"tick"!=l||d[x].consolidatedTicks<o){S="ti",S+="ck",(C=w(b,d[x],l==S?b.DT:f))&&(d[x]=C),v++;continue}}x++}function w(t,i,s){var o,l,h,c,u;for(var p in i||(i={DT:s,Date:r.yyyymmddhhmmssmmm(s),consolidatedTicks:0}),i.displayDate||n.setDisplayDate(i),o=1,a.adj&&t.Adj_Close&&(o=t.Adj_Close/t.Close),void 0!==(l=t.High||t.Close)&&l*o>(i.High||-Number.MAX_VALUE)&&(e.r3R(5),i.High=e.a3R(o,l)),void 0!==(h=t.Low||t.Close)&&h*o<(i.Low||Number.MAX_VALUE)&&(e.r3R(5),i.Low=e.a3R(o,h)),void 0!==(c=t.Open||t.Close)&&(i.Open||0===i.Open||(e.F3R(5),i.Open=e.a3R(o,c))),void 0!==t.Volume&&(i.Volume=(i.Volume||0)+t.Volume),void 0!==t.Close&&null!==t.Close&&(i.Close=t.Close*o),void 0!==t.Adj_Close&&(i.Adj_Close=t.Adj_Close),i.ratio=o,t)u="Bid",u+="L2",t[p]&&void 0!==t[p].Close?i[p]=w(t[p],i[p],s):i[p]?["Bid",u,"Ask","AskL2"].indexOf(p)>-1&&(i[p]=t[p]):i[p]=t[p];return i.consolidatedTicks++,i}return this.runAppend("consolidatedQuote",arguments),d},r.ChartEngine.prototype.touchmove=function(t){var i,a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X;if(i="n",i+="o",i+="n",i+="e",this.displayInitialized&&""===this.openDialog&&!0!==r.ChartEngine.ignoreTouch){if(a=[],(!this.overYAxis||this.controls&&this.controls.crossX&&this.controls.crossX.style.display!=i)&&(t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t&&t.stopPropagation()),s=(new Date).getTime(),-1==this.clicks.s2MS){if(this.clicks.e1MS=s,this.clicks.e1MS-this.clicks.s1MS<25)return}else if(this.clicks.e2MS=s,this.clicks.e2MS-this.clicks.s2MS<25)return;if(t.pointerType||(t.pointerType=this.touchPointerType),r.isSurface){if(this.mouseMode)return;t.pointerId||(t.pointerId=this.gesturePointerId);for(var Z=0;Z<this.touches.length;Z++)if(this.touches[Z].pointerId==t.pointerId){if(n=Math.abs(this.touches[Z].pageX-t.clientX),o=Math.abs(this.touches[Z].pageY-t.clientY),e.F3R(37),!Math.sqrt(e.K3R(n,n,o,o)))return;if(this.clicks.e1MS=(new Date).getTime(),this.clicks.e1MS-this.clicks.s1MS<50)return;if(this.touches[Z].pageX==t.clientX&&this.touches[Z].pageY==t.clientY)return;this.touches[Z].pageX=this.touches[Z].clientX=t.clientX,this.touches[Z].pageY=this.touches[Z].clientY=t.clientY;break}if(0===Z?this.movedPrimary=!0:this.movedSecondary=!0,Z==this.touches.length)return;this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],a=this.touches.length?this.touches:this.changedTouches}else{a=t.touches,l=-1020300993,h=329117303,c=2;for(var Q=1;e.F1o(Q.toString(),Q.toString().length,77158)!==l;Q++)this.changedTouches=t.changedTouches,c+=2;e.Q1o(c.toString(),c.toString().length,15984)!==h&&(this.changedTouches=t.changedTouches)}if(!(1==a.length&&Math.pow(this.clicks.x-a[0].clientX,2)+Math.pow(this.clicks.y-a[0].clientY,2)<=16||(u=this.crosshairXOffset,p=this.crosshairYOffset,d=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,m=!this.layout.crosshair&&!d&&!this.touchNoPan,("pen"==t.pointerType||m||this.activeDrawing&&"freeform"==this.activeDrawing.name)&&(u=p=0),this.runPrepend("touchmove",arguments)))){if(r.ChartEngine.resizingPanel)return g=(y=a[0]).clientX,f=y.clientY,e.F3R(1),void this.mousemoveinner(e.K3R(g,u),e.K3R(f,p));if(-1!=this.moveB&&(this.touchMoveTime=new Date),this.moveA=this.moveB,e.P6(),this.moveB=a[0].pageX,1!=a.length||this.twoFingerStart){if(2==a.length&&this.allowZoom){if(!this.displayCrosshairs)return;w=(C=a[0]).clientX,T=C.clientY,D=(k=a[1]).clientX,M=k.clientY,e.r3R(38),v=Math.sqrt(e.a3R(D,D,w,M,T,M,w,T)),e.r3R(3);var G=e.a3R(20,18);if(this.pinchingCenter=(Math.min(w,D)-Math.max(w,D))/G,A=Math.round(this.gestureStartDistance-v),m&&(this.pinchingScreen=5),this.clearPixelCache(),this.pinchingScreen<2){if(r.isSurface&&(!this.movedPrimary||!this.movedSecondary))return;if(w<this.pt.x1&&D<this.pt.x2||w>this.pt.x1&&D>this.pt.x2||T<this.pt.y1&&M<this.pt.y2||T>this.pt.y1&&M>this.pt.y2)this.pinchingScreen=0;else if(this.pinchingScreen++,this.pinchingScreen<2)return}if(this.pt={x1:w,x2:D,y1:T,y2:M},0===this.pinchingScreen)e.r3R(1),this.mousemoveinner(e.a3R(w,u),e.K3R(T,p)),this.gestureStartDistance=v;else{if(F=Math.asin((Math.max(M,T)-Math.min(M,T))/v),Math.abs(A)<12&&!m){if(this.moveCount++,4==this.moveCount)return this.pinchingScreen=0,void(this.moveCount=0)}else this.moveCount=0;if(F<1||!this.goneVertical&&F<1.37){if(!this.currentPanel)return;if(P=this.currentPanel.chart,this.goneVertical=!1,v=this.pt.x2-this.pt.x1,_=this.grabStartValues.t2-this.grabStartValues.t1,E=this.grabStartValues.t1+_/2,e.F3R(9),(L=e.a3R(v,_))<this.minimumCandleWidth&&(L=this.minimumCandleWidth),!1===P.allowScrollFuture&&!1===P.allowScrollPast&&(L=Math.max(L,P.width/P.dataSet.length)),N=this.layout.candleWidth,this.setCandleWidth(L,P),P.maxTicks<this.minimumZoomTicks)return void this.setCandleWidth(N,P);e.r3R(0),this.micropixels=e.a3R(0,"0"),R=this.pixelFromTick(Math.round(E),P),e.r3R(39);var K=e.a3R(3,214049664,19,2354546301);O=this.pt.x1-this.left+Math.round(v/("2">>K)),e.r3R(3),I=e.a3R(R,O),e.r3R(9),H=e.a3R(I,L),z=Math.round(H),P.scroll-=z,e.F3R(3),this.microscroll=e.a3R(z,H),this.micropixels=L*this.microscroll,this.draw()}else if(B=this.grabStartYAxis,this.goneVertical=!0,B){j=-985176594,V=1124438489,W=2;for(var J=1;e.F1o(J.toString(),J.toString().length,27416)!==j;J++)B.zoom=this.grabStartZoom*(this.gestureStartDistance%v),W+=2;if(e.Q1o(W.toString(),W.toString().length,93918)!==V&&(B.zoom=this.grabStartZoom+(this.gestureStartDistance-v)),this.grabStartZoom<B.height)B.zoom>=B.height&&(B.zoom=B.height-1);else if(B.zoom<=B.height){e.r3R(3);var $=e.K3R(11,10);B.zoom=B.height+$}this.draw()}this.updateChartAccessories()}}else if(3==a.length&&r.ChartEngine.allowThreeFingerTouch){if(!this.displayCrosshairs)return;U=a[0].clientX,Y=-1476116256,e.r3R(12),q=-e.K3R(992918208,"1283051079"),X=2;for(var tt=1;e.F1o(tt.toString(),tt.toString().length,20373)!==Y;tt++){v=this.grabStartX-U,e.F3R(3);var et=e.a3R(23,13);this.grabEndPeriodicity=this.grabStartPeriodicity+Math.round(v/et),e.r3R(3),X+=e.a3R("2",0)}if(e.F1o(X.toString(),X.toString().length,72123)!==q){v=this.grabStartX%U,e.F3R(3);var it=e.a3R(10,6);this.grabEndPeriodicity=this.grabStartPeriodicity%Math.round(v-it)}this.grabEndPeriodicity<1&&(this.grabEndPeriodicity=1)}}else g=(x=a[0]).clientX,f=x.clientY,this.pinchingScreen=0,e.r3R(1),this.mousemoveinner(e.K3R(g,u),e.a3R(f,p)),b=this.whichPanel(f),S=!0===this.xAxisAsFooter?this.chart.canvasHeight:this.chart.panel.bottom,this.overXAxis=f<=this.top+S&&f>=S-this.xaxisHeight+this.top&&this.insideChart,this.overYAxis=!!b&&((g>=b.right||g<=b.left)&&this.insideChart);this.runAppend("touchmove",arguments)}}},r.ChartEngine.prototype.touchstart=function(t){var i,a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L;if(i="touchs",i+="t",i+="a",i+="rt",!r.ChartEngine.ignoreTouch&&(r.isSurface?(this.movedPrimary=!1,this.movedSecondary=!1):(this.touchingEvent&&clearTimeout(this.touchingEvent),this.touching=!0,this.touches=t.touches,this.changedTouches=t.changedTouches),!r.ChartEngine.resizingPanel&&(a=this.crosshairXOffset,s=this.crosshairYOffset,"pen"==this.touchPointerType&&(a=s=0),!this.runPrepend(i,arguments)))){if(this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.hasDragged=!1,this.doubleFingerMoves=0,this.moveCount=0,this.twoFingerStart=!1,1==this.touches.length||2==this.touches.length){if(1==this.changedTouches.length){if(p=!1,(u=Date.now())-this.clicks.e1MS<250){this.cancelTouchSingleClick=!0,this.clicks.s2MS=u,e.F3R(40);var N=e.K3R(17,12,13,16);p=Math.pow(this.clicks.x-this.changedTouches[0].pageX,2)+Math.pow(this.clicks.y-this.changedTouches[0].pageY,N)<=400}p||(this.cancelTouchSingleClick=!1,this.clicks.s1MS=u,this.clicks.e1MS=-1,this.clicks.s2MS=-1,this.clicks.e2MS=-1),this.clicks.x=this.changedTouches[0].pageX,this.clicks.y=this.changedTouches[0].pageY}if(this.touchMoveTime=Date.now(),this.moveA=this.touches[0].clientX,this.moveB=-1,l=(d=this.touches[0]).clientX,h=d.clientY,m=this.container.getBoundingClientRect(),this.top=m.top,this.left=m.left,this.right=this.left+this.width,this.bottom=this.top+this.height,1==this.touches.length&&(g=this.backOutY(h),this.currentPanel=this.whichPanel(g)),this.currentPanel||(this.currentPanel=this.chart.panel),c=this.currentPanel,l>=this.left&&l<=this.right&&h>=this.top&&h<=this.bottom){this.insideChart=!0,f=!0===this.xAxisAsFooter?this.chart.canvasHeight:this.chart.panel.bottom,this.overXAxis=h<=this.top+f&&h>=this.top+f-this.xaxisHeight,this.overYAxis=l>=this.left+c.right||l<=this.left+c.left,y=-1,r.ChartEngine.crosshairY=h,r.ChartEngine.crosshairX=l,this.cy=this.backOutY(h),this.cx=this.backOutX(l),this.crosshairTick=this.tickFromPixel(this.cx,c.chart),this.crosshairValue=this.adjustIfNecessary(c,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel));for(var R=0;R<this.drawingObjects.length;R++)if((v=this.drawingObjects[R]).highlighted){if(y<0&&(y=R),x=v.highlighted,this.findHighlights(!0),R==y&&v.highlighted&&!v.permanent)return void(-1==this.clicks.s2MS?this.activateRepositioning(v):this.findHighlights(!1,!0));this.anyHighlighted=!0,v.highlighted=x}}else this.insideChart=!1;if(b=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,this.layout.crosshair||b||!this.insideChart||this.touchNoPan){if(this.grabbingScreen=!1,this.insideChart&&c.subholder===t.target&&(F=this.currentVectorParameters.vectorType,r.Drawing&&F&&r.Drawing[F]&&(new r.Drawing[F]).dragToDraw))return this.userPointerDown=!0,r.ChartEngine.crosshairX=l,r.ChartEngine.crosshairY=h,c&&c.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.backOutX(r.ChartEngine.crosshairX),this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(c,this.crosshairTick,this.valueFromPixel(this.backOutY(r.ChartEngine.crosshairY),this.currentPanel))),this.drawingClick(c,this.backOutX(l),this.backOutY(h)),void this.headsUpHR()}else{if(a=s=0,(S=this.mainSeriesRenderer||{}).params&&S.params.baseline&&!1!==this.chart.baseline.userLevel&&this.controls.baselineHandle){e.F3R(10),C=this.valueFromPixel(e.K3R("5",g),c),e.r3R(1),w=this.valueFromPixel(e.a3R(g,5),c),e.F3R(41);var O=e.K3R(12,5,27);if(T=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,O),this.chart.baseline.actualLevel<Math.max(C,w)&&this.chart.baseline.actualLevel>Math.min(C,w)&&this.backOutX(d.clientX)>T)return k="st",k+="x-",k+="gra",k+="b",this.repositioningBaseline={lastDraw:Date.now()},void r.appendClassName(this.controls.baselineHandle,k)}for(n in this.panels)if((o=this.panels[n]).highlighted)return void this.grabHandle(o);this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),c.chart.spanLock=!1,this.yToleranceBroken=!1,e.F3R(1),this.grabStartX=e.K3R(l,a),e.F3R(1),this.grabStartY=e.a3R(h,s),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=c.chart.scroll,this.grabStartScrollY=c.yAxis.scroll,D=-2026316628,M=-1448753415,A=2;for(var I=1;e.F1o(I.toString(),I.toString().length,41198)!==D;I++)this.grabStartPanel=this.currentPanel,this.swipeStart(c.chart),A+=2;e.F1o(A.toString(),A.toString().length,77064)!==M&&(this.grabStartPanel=this.currentPanel,this.swipeStart(c.chart)),this.grabStartYAxis=this.whichYAxis(c,this.backOutX(l)),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,setTimeout((H=this,function(){H.grabbingHand()}),100)}1===this.touches.length&&this.layout.crosshair&&(e.F3R(1),this.mousemoveinner(e.K3R(l,a),e.a3R(h,s)))}var H,z;if(2==this.touches.length){if(this.cancelLongHold=!0,this.swipe.end=!0,!this.displayCrosshairs&&!this.touchNoPan||!this.insideChart)return;for(n in _=(P=this.touches[1]).clientX,E=P.clientY,this.panels)if((o=this.panels[n]).highlighted)return void this.grabHandle(o);c=this.currentPanel,e.F3R(38),this.gestureStartDistance=Math.sqrt(e.a3R(_,_,l,E,h,E,l,h)),this.pt={x1:l,x2:_,y1:h,y2:E},this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),c.chart.spanLock=!1,e.F3R(1),this.grabStartX=e.a3R(l,a),e.F3R(1),this.grabStartY=e.a3R(h,s),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=c.chart.scroll,this.grabStartScrollY=c.yAxis.scroll,this.grabStartPanel=c,this.swipeStart(c.chart),this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(c,this.backOutX((l+_)/2))||c.yAxis,this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPt=this.pt,this.grabStartValues={x1:this.pt.x1,x2:this.pt.x2,y1:this.valueFromPixel(this.pt.y1-this.top,c),y2:this.valueFromPixel(this.pt.y2-this.top,c),t1:this.tickFromPixel(this.pt.x1-this.left,c.chart),t2:this.tickFromPixel(this.pt.x2-this.left,c.chart)},this.twoFingerStart=!0,setTimeout((z=this,e.P6(),function(){e.x6(),z.grabbingHand()}),100)}else if(3==this.touches.length){if(!this.displayCrosshairs)return;L=this.touches[0].clientX,this.grabStartX=L,this.grabStartPeriodicity=this.layout.periodicity}1!=this.touches.length||this.layout.crosshair||(this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,(this.longHoldTime||0===this.longHoldTime)&&this.startLongHoldTimer()),this.runAppend("touchstart",arguments)}},r.ChartEngine.prototype.swipeStart=function(t){var i;this.swipe&&this.swipe.interval&&clearInterval(this.swipe.interval),e.F3R(3),this.swipe.velocity=e.a3R("0",0),this.swipe.amplitude=0,this.swipe.frame=t.scroll,this.swipe.micropixels=this.micropixels,this.swipe.timestamp=Date.now(),this.swipe.chart=t,this.swipe.end=!1,e.F3R(12),this.swipe.timeConstant=e.K3R(1847417664,"325"),this.swipe.cb=null,i=this,requestAnimationFrame(function(){i.swipeSample()})},r.ChartEngine.prototype.swipeSample=function(){var t,i,a,s,n,o,l;(t=this.swipe).end||(i=this,20,(s=(a=Date.now())-t.timestamp)<20?requestAnimationFrame(function(){i.swipeSample()}):(o=r.touchDevice?.4:.8,e.x6(),t.timestamp=a,n=(t.chart.scroll-t.frame)*this.layout.candleWidth+this.micropixels-t.micropixels,t.frame=t.chart.scroll,t.micropixels=this.micropixels,e.r3R(42),l=o*e.a3R(n,1,s,1e3)+.2*t.velocity,Math.abs(l)>Math.abs(t.velocity)&&(t.velocity=l),Math.abs(n)<6&&(t.velocity=0),requestAnimationFrame(function(){i.swipeSample()})))},r.ChartEngine.prototype.swipeRelease=function(){var t,i;(t=this.swipe).velocity>3e3&&(t.velocity=3e3),t.velocity<-3e3&&(e.F3R(3),t.velocity=-e.K3R("3000",0)),(t.velocity>10||t.velocity<-10)&&(t.amplitude=.8*t.velocity,t.scroll=t.chart.scroll,t.target=t.amplitude,t.timestamp=Date.now(),i=this,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),requestAnimationFrame(function(){e.P6(),i.autoscroll()}))},r.ChartEngine.prototype.scrollTo=function(t,i,a){var r,s;(r=this.swipe).end=!0,r.amplitude=r.target=(i-t.scroll)*this.layout.candleWidth,r.timeConstant=100,r.timestamp=Date.now(),e.x6(),r.scroll=t.scroll,r.chart=t,r.cb=a,s=this,requestAnimationFrame(function(){s.autoscroll()})},r.ChartEngine.prototype.autoscroll=function(){var t,i,a,r;t=this,(i=this.swipe).amplitude&&(i.elapsed=Date.now()-i.timestamp,(a=-i.amplitude*Math.exp(-i.elapsed/i.timeConstant))>.5||a<-.5?(r=(i.target+a)/this.layout.candleWidth,i.chart.scroll=i.scroll+Math.round(r),this.draw(),this.updateChartAccessories(),requestAnimationFrame(function(){e.x6(),t.autoscroll()})):(this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),i.cb&&i.cb()))},r.ChartEngine.prototype.touchend=function(t){var i,a,s,n,o,l,h,c;if(i="touch",i+="end",!r.ChartEngine.ignoreTouch&&(this.swipe.end=!0,r.isSurface||(this.touches=t.touches,this.changedTouches=t.changedTouches),!this.runPrepend(i,arguments))){if(this.cancelLongHold=!0,this.touches.length<=1&&(this.layout.crosshair||this.currentVectorParameters.vectorType)&&(this.touches.length&&this.twoFingerStart||(this.grabbingScreen=!1)),this.touches.length&&(this.grabStartX=-1,this.grabStartY=-1),a=this.pinchingScreen,this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),this.touches.length){if(r.ChartEngine.resizingPanel)return}else{if(this.touchingEvent=setTimeout((u=this,function(){e.P6(),u.touching=!1}),500),r.ChartEngine.resizingPanel)return void this.releaseHandle();this.pinchingScreen=null,this.pinchingCenter=null,this.goneVertical=!1,this.grabbingScreen=!1,this.grabMode="",this.highlightedDraggable&&(this.dragPlotOrAxis(this.cx,this.cy),this.currentPanel=this.whichPanel(this.cy)),this.grabStartYAxis=null,this.displayDragOK(),this.doDisplayCrosshairs(),this.updateChartAccessories()}var u;if(s=this.touches.length+1,e.P6(),1==this.changedTouches.length){if(this.repositioningDrawing)return this.changeOccurred("vector"),r.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.draw(),void(this.layout.crosshair||this.currentVectorParameters.vectorType||this.findHighlights(!1,!0));if(this.repositioningBaseline)return"mo","un","tain",this.repositioningBaseline=null,r.unappendClassName(this.controls.baselineHandle,"stx-grab"),(n=this.mainSeriesRenderer||{}).params&&n.params.baseline&&n.params.type,void this.draw();if(o=Date.now(),-1==this.clicks.s2MS){if(this.clicks.e1MS=o,l=this.currentVectorParameters.vectorType,r.Drawing&&l&&r.Drawing[l]&&(new r.Drawing[l]).dragToDraw||(this.clicks.e1MS-this.clicks.s1MS<750&&!this.longHoldTookEffect&&(!this.hasDragged||this.layout.crosshair)?setTimeout(this.touchSingleClick(s,this.clicks.x,this.clicks.y),200):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}),this.userPointerDown=!1,h=this.backOutY(this.changedTouches[0].pageY)+this.crosshairYOffset,c=this.backOutX(this.changedTouches[0].pageX)+this.crosshairXOffset,this.activeDrawing&&this.activeDrawing.dragToDraw&&this.currentPanel.subholder===t.target)return void this.drawingClick(this.currentPanel,c,h);this.activeMarker&&this.currentPanel.subholder===t.target&&this.activeMarker.click(c,h,this.activeMarker,this.currentPanel)}else this.clicks.e2MS=o,this.clicks.e2MS-this.clicks.s2MS<250?this.touchDoubleClick(s,this.clicks.x,this.clicks.y):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}else this.displayCrosshairs&&(-1==this.grabEndPeriodicity||isNaN(this.grabEndPeriodicity)||((r.ChartEngine.isDailyInterval(this.layout.interval)||this.allowIntradayNMinute)&&this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),this.grabEndPeriodicity=-1));this.changedTouches.length&&((!this.layout.crosshair&&!this.currentVectorParameters.vectorType&&1==s||this.twoFingerStart&&!a&&!this.touches.length)&&this.swipeRelease(),a&&this.continuousZoom&&(this.continuousZoom.execute(),this.continuousZoom.execute(!0))),this.touches.length||(this.twoFingerStart=!1),this.runAppend("touchend",arguments)}},r[i].prototype[a]=function(t,s,o){e.i43=function(t){if(e)return e.T7l(t)},e.n43=function(t){if(e)return e.T7l(t)},e.c43=function(t){if(e)return e.T7l(t)},e.B43=function(t){if(e)return e.T7l(t)};var l=-(e.Y43("41da")?6947362155:2098076756),h=e.B43("4186")?24408947:21558131,c=e.j43("72ce")?703738868:145844021,u=-(e.c43("7fd7")?376310456:285569202),p=-(e.n43("faef")?7512739172:1014756150),d=e.M43("5ab1")?1201551884:3884395444,m=-(e.a43("7ec1")?5631264986:1254135654),g=e.O43("d22c")?341629208:774380664,f=e.G43("2653")?6008642627:1639748006,y=-(e.N43("988c")?929992430:745441109),v=e.i43("24b9")?117470610:583647879,x=-(e.U43("b8ec")?2046969812:5806096696),b=e.q43("8947")?522732399:1165758668,S=e.R43("b116")?611106385:798336181;if(e.s84(0,e.v43("b8fb")?726686:546987)===l||e.s84(0,594793)===h||e.Q84(11,778468)===c||e.Q84(0,999586)===u||e.Q84(10,209899)===p||e.s84(0,792387)===d||e.s84(10,196435)===m||-663437247===e.s84(0,358869)||e.s84(11,884694)===g||e.Q84(0,515751)===f||150680018===e.s84(10,444377)||e.Q84(0,296096)===y||e.s84(10,818614)===v||e.Q84(0,884823)===x||e.s84(10,531128)===b||e.Q84(0,557656)===S){var C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U,Y,q,X,Z,Q,G,K,J,$,tt,et,it,at,rt,st,nt,ot,lt,ht,ct,ut,pt,dt,mt=function(t,i){if(-1995546460===e.Q84(0,522034)||-1985050388===e.Q84(0,620456)||981890297===e.Q84(11,330705)||-1385398236===e.Q84(0,387579)||1372679504===e.Q84(10,180321)||1031173029===e.Q84(0,908199)||-1182070793===e.s84(10,917196)||112314098===e.Q84(0,866068)||-557174680===e.s84(11,553321)||-1239480703===e.Q84(0,152428)||698539912===e.s84(10,995964)||-1698809660===e.s84(0,920355)||1359081238===e.Q84(10,108593)||1919546965===e.s84(0,210021)||-1492053456===e.Q84(10,947517)||189722861===e.Q84(0,983116)){var a,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x="standardMarketIterator",b="strToDateTime",S="getTime";if(a=i.arr,e[jt](),a[he]>Yt){s=a[Xt][Xt];for(var C=Yt;C<a[he];C++){for(e[kt](43),n=a[e[ie](ft,Xt,C)][+Nt],o=a[C][Xt],l=r[b](n),h=r[b](o)[S](),c=t[x](l),u=Xt;l[S]()<h;)l=c.next(),u+=Yt;if((p=r[b](n)[S]())>r[b](k[k[he]-Yt].Date)[S]()){e[kt](44);var w=e[Gt](1801,pe,9,20);d=k[he]-w,u+=Yt}else for(d=k[he]-Yt;d>=Xt&&!(p<=r[b](k[d].Date)[S]());d--);m={x0:Xt,x1:u,y0:k[d][$t],y1:a[C][Yt]},s=r[b](n),c=t[x](s),g=!1;for(var T=Xt;T<=u;T++)if(g?s=c.next():g=!0,!(s[S]()<=k[k[he]-(ft<<186002976)][Wt][S]())){(f=r.yIntersection(m,T))||(f=+Nt),e[kt](18);var D=e[Gt](11,4,10007);e[kt](45);var M=e[Gt](Lt,7,1429);if((y=Math[wt](f*D)/M)===Xt&&(e[kt](12),y=a[C][e[Gt](2076779488,ft)]),v={Date:r.yyyymmddhhmmssmmm(s),DT:s,Open:y,Close:y,High:y,Low:y,Volume:Xt,Adj_Close:y,Split_Close:y,projection:!0},"minute"==t[qt][ne]&&R--<Nt<<254842272)break;k[k[he]]=v}}}}},gt=function(){if(-1899738929===e.Q84(0,921850)||-458285476===e.Q84(0,216886)||1410555969===e.s84(11,657387)||779496251===e.Q84(0,929669)||1588005500===e.s84(10,693153)||2014913392===e.Q84(0,763539)||-675217598===e.s84(10,969608)||-1339085844===e.s84(0,941821)||613311355===e.Q84(11,630337)||1479111836===e.Q84(0,435714)||-91959829===e.Q84(10,520122)||-1670280694===e.Q84(0,601543)||-479350608===e.s84(10,849287)||1778085633===e.s84(0,674791)||1852397989===e.s84(10,730715)||-1570734557===e.Q84(0,120580)){var t,i,a,s,o,l,h;if("deri","v.bo","t","bina","ry",".b","ot","bina","ry",".com","loca","lhost",e[jt](),t="les",i=1090==("5210"&re)?3890:"t",a=Jt,i+=de,a+=2275>=("8497"^Xt)?236.34:Ot,s=["127.0.0.1","localhost","binary.com","binary.sx","binary.me","binary.bot","deriv.com","deriv.bot","deriv.app"],a+=(t+=se).charAt(+Nt),i+=Qt,a+=t.charAt(Lt),window[i]==window[a])return r[n]===Xt;if(s[he]){o=r.getHostName(document.referrer),l=!1;for(var c=Xt;c<s[he];c++)h=s[c],o.indexOf(h)!=-Yt&&(l=!0);if(!l)return!Yt}return r[n]===Xt}},ft="1",yt="startFrom",vt="appendToDate",xt="establishMarkerTicks",bt="market",St="concat",Ct="spanLock",wt="round",Tt="Adj_Close",kt="F3R",Dt="Low",Mt="charts",At="dataSet",Ft="defaultChartStyleConfig",Pt="ratio",_t="toFixed",Et="studies",Lt=3,Nt="0",Rt="scrubbed",Ot="e",It="extendedHours",Ht="calculations",zt="aggregation",Bt="aggregationType",jt="x6",Vt="calculateFN",Wt="DT",Ut="state",Yt=1,qt="layout",Xt=0,Zt="activeDrawing",Qt="p",Gt="a3R",Kt="marketSessions",Jt="s",$t="Close",te="drawingObjects",ee="High",ie="K3R",ae="transformDataSetPost",re=2147483647,se="f",ne="interval",oe="iqPrevClose",le="scroll",he="length",ce="maxTicks",ue="transformDataSetPre",pe=10,de="o",me="masterData";if("creat","eDataSet","cr","eateData","Set",e[jt](),o||(o={}),C=[t,s,{appending:o.appending,appendToDate:o[vt]}],this.runPrepend("createDataSet",C))return;for(w in D=[],M=[],A=o.appending,this[Mt])if(F=de,F+="hlc",!s||s.name==w){if((T=this[Mt][w])[At]||(T[At]=[]),P=T[At][he],A&&(D=T[At]),T.currentQuote=null,T[At]=[],A||(T.tickCache={}),(_=T[me])||(_=this[me]),!_||!_[he])return void this.runAppend(a,C);if(D[he]){for(E=D.pop(),(!(L=o[vt])||L>E[Wt])&&(L=E[Wt]);D[he]&&!(D[D[he]-Yt][Wt]<L);)D.pop();e.r3R(46);var ge=e[ie](15,pe,13,Yt,8);for(N=_[he]-ge;N>=Xt&&_[N][Wt]>=L;)N--;e[kt](47),k=_.slice(e[Gt](N,ft))}else k=[][St](_);if(!gt())return;if(this[ue]&&this[ue](this,k),R=Math[wt](.75*T[ce]),!this.chart.hideDrawings){for(O=Xt;O<this[te][he];O++)I=Qt,I+="roj",I+="ectio",I+="n",this[te][O].name==I&&mt(this,this[te][O]);this[Zt]&&"projection"==this[Zt].name&&mt(this,this[Zt])}for(O=Xt,H=-Number.MAX_VALUE,z=Number.MAX_VALUE,e[kt](21),j=e[ie](477586016,Nt),V=t||this.dontRoll,W=this[qt],U=r[i].isDailyInterval(W[ne]);Yt&&("wee","k",!(j>=k[he]));)if((!this.dontRoll||"week"!=W[ne]&&"month"!=W[ne])&&this[It]&&this[It].filter&&T[bt].market_def&&(X=k[j],U?q=!T[bt].isMarketDate(X[Wt]):(!Y||Y<=X[Wt])&&(Z="ge",Z+="tNextC",Z+="los",Z+=Ot,q=!(""===(Q=T[bt].getSession(X[Wt]))||W[Kt]&&W[Kt][Q]),Y=T[bt][q?"getNextOpen":Z](X[Wt])),q))j++;else{for(var fe in B={},k[j])B[fe]=k[j][fe];k[j]=B,B[Pt]=Yt,W.adj&&B[Tt]&&(B[Pt]=B[Tt]/B[$t]),B[Pt]!=Yt&&(B.Open&&(B.Open=Number((B.Open*B[Pt])[_t](8))),B[$t]&&(B[$t]=Number((B[$t]*B[Pt])[_t](8))),B.High&&(B.High=Number((B.High*B[Pt])[_t](8))),B.Low&&(B.Low=Number((B.Low*B[Pt])[_t](8)))),M[O++]=k[j++]}for((W.periodicity>Yt||!V&&("week"==W[ne]||"month"==W[ne]))&&(D[he]&&M.unshift(D.pop()),M=this.consolidatedQuote(M)),G={},O=Nt<<1384609792;O<M[he];O++)for(var ye in B=M[O],O>(Nt&re)?(B[oe]=M[O-Yt][$t],B[oe]||B[oe]===Xt||(B[oe]=M[O-Yt][oe])):D[he]?(B[oe]=D[D[he]-Yt][$t],B[oe]||B[oe]===Xt||(B[oe]=D[D[he]-+ft][oe])):B[oe]=B[$t],ee in B&&B.High>H&&(H=B.High),Dt in B&&B.Low<z&&(z=B.Low),T.series)if((J=B[K=T.series[ye].parameters.symbol])&&"object"==_typeof(J)){if(O>Xt)J[oe]=G[ye];else if(D[he]){for(var ve=D[he]-Yt;ve>=Xt;ve--)if(($=D[ve][K])&&($[$t]||$[$t]===Xt)){J[oe]=$[$t];break}}else J[oe]=J[$t];(J[$t]||J[$t]===Xt)&&(G[ye]=J[$t]),J[Pt]=Yt,W.adj&&J[Tt]&&(J[Pt]=J[Tt]/J[$t]),J[Pt]!=Yt&&(J.Open&&(J.Open=Number((J.Open*J[Pt])[_t](8))),J[$t]&&(J[$t]=Number((J[$t]*J[Pt])[_t](8))),J.High&&(J.High=Number((J.High*J[Pt])[_t](8))),J.Low&&(J.Low=Number((J.Low*J[Pt])[_t](8))))}if((tt=T[le]>=T[ce])&&(T[Ct]=!ft),et=tt||T.lockScroll||T[Ct]||this.isHistoricalModeSet,it=W[Bt],T[Ft]={type:W.chartType},it&&it!=F&&(T[Ft].type=it,r[i].prototype.drawKagiSquareWave?("h","eikinashi",A&&T[Ut][zt]||(T[Ut][zt]={}),"heikenashi"==it||"heikinashi"==W[Bt]?M=r.calculateHeikinAshi(this,M,D):(at="pand",at+=se,"k","a","g","i",rt="rangeb",rt+="a",rt+="r",it==(rt+=Jt)?M=r.calculateRangeBars(this,M,W.rangebars,D):"kagi"==it?M=r.calculateKagi(this,M,W.kagi,D):"linebreak"==it?M=r.calculateLineBreak(this,M,W.priceLines,D):"renko"==it?M=r.calculateRenkoBars(this,M,W.renko,D):it==at&&(M=r.calculatePointFigure(this,M,W.pandf,D)))):console.log("advanced/aggregation.js not loaded!")),st=M[he]-(P-D[he]),A||(st=Xt),et&&st&&(T[Ct]&&T[le]>=T[ce]?T[Ct]=!1:(T[le]+=st,this.grabStartScrollX+=st,this.swipe&&(this.swipe[le]+=st))),this[ae]&&this[ae](this,M,z,H),(nt=this.maxDataSetSize)&&D[he]+M[he]>nt&&(D=M[he]<nt?D.slice(M[he]-nt):[],M=M.slice(-nt)),T[Rt]||(T[Rt]=[]),D[he])for(ot=D[D[he]-Yt][Wt];T[Rt][he]&&T[Rt][T[Rt][he]-+ft][Wt]>ot;)T[Rt].pop();else T[Rt]=[];for(T[Ut][Et]={},T[Ut][Et][yt]=T[Rt][he],lt=[],O=Xt;O<M[he];O++)((ht=M[O])[$t]||ht[$t]===Xt)&&lt.push(ht);T[Rt]=T[Rt][St](lt),A&&T[Ut][Ht]||(T[Ut][Ht]={}),this.calculateATR(T,20,lt),this.calculateMedianPrice(T,lt),this.calculateTypicalPrice(T,lt),this.calculateWeightedClose(T,lt),this.calculateOHLC4(T,lt)}for(ct in this.plugins)(ut=this.plugins[ct])[a]&&ut[a](this,s,M,D[he]);for(w in this[Mt])if(!s||s.name==w)for((T=this[Mt][w])[At]=D[St](M),ct=Xt;ct<T[At][he];ct++)T[At][ct].cache={},T[At][ct].tick=ct;for(var xe in T.whiteSpaceFutureTicks=Xt,pt=this[qt][Et])"function"!=_typeof(dt=pt[xe])&&(s&&this.panels[dt.panel].chart.name!=s.name||(dt[yt]=T[Ut][Et][yt],dt.error=null,dt.study[Vt]&&dt.study[Vt](this,dt)));this.adjustDrawings(),this[xt]&&this[xt](),this.runAppend("createDataSet",C)}},t},E8LL(q8LL()),F4GG(T4GG()),z6cc.b5l=function(){return"function"==typeof z6cc.Z5l.T5l?z6cc.Z5l.T5l.apply(z6cc.Z5l,arguments):z6cc.Z5l.T5l},z6cc.l5l=function(){return"function"==typeof z6cc.Z5l.v1l?z6cc.Z5l.v1l.apply(z6cc.Z5l,arguments):z6cc.Z5l.v1l},z6cc.Z16=function(){for(var a16=2;9!==a16;)switch(a16){case 2:var m16=[arguments];return m16[8]=void 0,m16[1]={},m16[1].C5J=function(){for(var k16=2;90!==k16;)switch(k16){case 7:h16[7]=h16[9],h16[5]={},h16[5].o5Z=["u5Z"],h16[5].N5Z=function(){var L3J=function L3J(){return eval("67;")},e3J=!/\x65\u0076\u0061\u006c/.n8LL(L3J+[]);return e3J},k16=12;break;case 51:h16[8].U8LL(h16[47]),h16[8].U8LL(h16[14]),h16[8].U8LL(h16[69]),h16[8].U8LL(h16[6]),k16=47;break;case 76:k16=h16[72]<h16[16][h16[56]].length?75:70;break;case 57:k16=h16[59]<h16[8].length?56:69;break;case 62:h16[56]="o5Z",h16[58]="F5Z",h16[29]="N5Z",k16=59;break;case 4:h16[8]=[],h16[9]={},h16[9].o5Z=["u5Z"],h16[9].N5Z=function(){return!/\x61\u0074\x6f\u0062/.n8LL(function(){return atob("PQ==")}+[])},k16=7;break;case 39:h16[54]={},h16[54].o5Z=["u5Z"],h16[54].N5Z=function(){return/\u0078/.n8LL(function(){return"X".toLowerCase()}+[])},h16[93]=h16[54],h16[8].U8LL(h16[96]),h16[8].U8LL(h16[7]),h16[8].U8LL(h16[3]),k16=51;break;case 2:var h16=[arguments];k16=1;break;case 47:h16[8].U8LL(h16[77]),h16[8].U8LL(h16[2]),h16[8].U8LL(h16[93]),h16[85]=[],h16[95]="M1Z",h16[90]="m1Z",k16=62;break;case 56:h16[16]=h16[8][h16[59]];try{h16[73]=h16[16][h16[29]]()?h16[95]:h16[90]}catch(t){h16[73]=h16[90]}k16=77;break;case 70:h16[59]++,k16=57;break;case 34:h16[19]={},h16[19].o5Z=["u5Z"],h16[19].N5Z=function(){return!/['"]/.n8LL(function(){return"c".indexOf("c")}+[])},k16=31;break;case 71:h16[72]++,k16=76;break;case 68:k16=68;break;case 5:return 49;case 67:return m16[8]=91,75;case 1:k16=m16[8]?5:4;break;case 26:h16[32].o5Z=["u5Z"],h16[32].N5Z=function(){return/\x3d/.n8LL(function(){return unescape("%3D")}+[])},h16[14]=h16[32],h16[31]={},k16=22;break;case 75:h16[68]={},h16[68][h16[10]]=h16[16][h16[56]][h16[72]],h16[68][h16[58]]=h16[73],h16[85].U8LL(h16[68]),k16=71;break;case 12:h16[2]=h16[5],h16[4]={},h16[4].o5Z=["u5Z"],h16[4].N5Z=function(){return/(\x3c|\u003e)/.n8LL(function(){return"a".anchor("b")}+[])},h16[6]=h16[4],h16[1]={},k16=17;break;case 28:h16[17].N5Z=function(){return"function"==typeof p8LL},h16[47]=h16[17],h16[74]={},k16=42;break;case 58:h16[59]=0,k16=57;break;case 22:h16[31].o5Z=["U5Z"],h16[31].N5Z=function(){return"function"==typeof t8LL},h16[69]=h16[31],k16=34;break;case 77:h16[72]=0,k16=76;break;case 59:h16[10]="f1Z",k16=58;break;case 17:h16[1].o5Z=["U5Z"],h16[1].N5Z=function(){var t=!1,e=[];try{for(var i in console)e.U8LL(i);t=0===e.length}catch(t){}return t},h16[3]=h16[1],h16[32]={},k16=26;break;case 42:h16[74].o5Z=["U5Z"],h16[74].N5Z=function(){return"function"==typeof P8LL},h16[77]=h16[74],k16=39;break;case 69:k16=function(){for(var t=2;22!==t;)switch(t){case 5:return;case 17:e[4]=0,t=16;break;case 25:e[6]=!0,t=24;break;case 19:e[4]++,t=7;break;case 2:var e=[arguments];t=1;break;case 8:e[4]=0,t=7;break;case 6:e[2]=e[0][0][e[4]],t=14;break;case 20:e[5][e[2][h16[10]]].h+=!0,t=19;break;case 13:e[5][e[2][h16[10]]]=function(){for(var t=2;9!==t;)switch(t){case 2:var e=[arguments];return e[2]={},e[2].h=0,e[2].t=0,e[2]}}.s8LL(this,arguments),t=12;break;case 10:t=e[2][h16[58]]===h16[95]?20:19;break;case 18:e[6]=!1,t=17;break;case 14:t=void 0===e[5][e[2][h16[10]]]?13:11;break;case 12:e[3].U8LL(e[2][h16[10]]),t=11;break;case 11:e[5][e[2][h16[10]]].t+=!0,t=10;break;case 23:return e[6];case 15:e[7]=e[3][e[4]],e[8]=e[5][e[7]].h/e[5][e[7]].t,t=26;break;case 7:t=e[4]<e[0][0].length?6:18;break;case 1:t=0===e[0][0].length?5:4;break;case 24:e[4]++,t=16;break;case 26:t=e[8]>=.5?25:24;break;case 4:e[5]={},e[3]=[],e[4]=0,t=8;break;case 16:t=e[4]<e[3].length?15:23}}(h16[85])?68:67;break;case 31:h16[96]=h16[19],h16[17]={},h16[17].o5Z=["U5Z"],k16=28}},m16[1]}}(),z6cc.G16=function(){return"function"==typeof z6cc.Z16.C5J?z6cc.Z16.C5J.apply(z6cc.Z16,arguments):z6cc.Z16.C5J},z6cc.b3S=function(){return"function"==typeof z6cc.U3S.g24?z6cc.U3S.g24.apply(z6cc.U3S,arguments):z6cc.U3S.g24},z6cc.Z5l={v1l:function(){var t,e=arguments;switch(z5l){case 12:t=(e[0]-e[2]+e[4])/e[3]-e[1];break;case 15:t=e[0]^e[1];break;case 17:t=e[2]/(e[0]*e[1]);break;case 18:t=e[1]/e[2]-e[0];break;case 10:t=e[0]/(e[2]<<e[1]);break;case 16:t=e[1]*e[0]/e[2];break;case 3:t=e[1]+e[0];break;case 1:t=e[0]-e[1]/+e[2]+e[3];break;case 19:t=e[1]|e[0];break;case 6:t=e[1]-e[0];break;case 20:t=e[3]*(e[2]-e[1])/-e[0];break;case 4:t=e[1]-e[2]+e[0];break;case 0:t=e[1]*e[0];break;case 9:t=e[0]&e[1];break;case 7:t=e[0]/e[1];break;case 22:t=e[2]/(e[0]^e[1]);break;case 11:t=e[1]+e[2]-e[0];break;case 14:t=e[0]/(e[2]&e[1]);break;case 2:t=e[2]+e[1]/+e[0]-e[3];break;case 8:t=(e[0]+e[1])/(e[2]|e[3]);break;case 5:t=e[1]*e[2]*e[3]-e[0];break;case 21:t=e[1]/+e[0];break;case 13:t=e[2]*e[0]-e[1]+e[3]}return t},T5l:function(t){z5l=t}},z6cc.G5l=function(){return"function"==typeof z6cc.Z5l.v1l?z6cc.Z5l.v1l.apply(z6cc.Z5l,arguments):z6cc.Z5l.v1l},z6cc.U3S=(N24=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{g24:function(t,e,i){for(var a=i,r=-4&e,s=0;s<r;s+=4){var n=255&t.D4GG(s)|(255&t.D4GG(s+1))<<8|(255&t.D4GG(s+2))<<16|(255&t.D4GG(s+3))<<24;n=N24(n,3432918353),a=5*(a=(524287&(a^=n=N24(n=(131071&n)<<15|n>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(n=0,e%4){case 3:n=(255&t.D4GG(r+2))<<16;case 2:n|=(255&t.D4GG(r+1))<<8;case 1:n|=255&t.D4GG(r),n=N24(n,3432918353),a^=n=N24(n=(131071&n)<<15|n>>>17,461845907)}return a^=e,a=N24(a^=a>>>16,2246822507),a=N24(a^=a>>>13,3266489909),a^=a>>>16}}),z6cc.E3S=function(){return"function"==typeof z6cc.U3S.g24?z6cc.U3S.g24.apply(z6cc.U3S,arguments):z6cc.U3S.g24},z6cc.j5l=function(){return"function"==typeof z6cc.Z5l.T5l?z6cc.Z5l.T5l.apply(z6cc.Z5l,arguments):z6cc.Z5l.T5l},z6cc.s16=function(){return"function"==typeof z6cc.Z16.C5J?z6cc.Z16.C5J.apply(z6cc.Z16,arguments):z6cc.Z16.C5J},z6cc.G16(),__js_standard_customCharts_=function(t){var e,i;e=2;for(var a=1;-1702544104!==z6cc.E3S(a.toString(),a.toString().length,74863);a++)i=t.CIQ,e+=2;return-1764424825!==z6cc.b3S(e.toString(),e.toString().length,75630)&&(i=t.CIQ),i.ChartEngine.prototype.drawHeatmap=function(t,e){var i,a,r,s,n,o,l,h,c,u,p,d,m,g,f,y=z6cc;if(e&&e.length&&((i=t.panel)||(i="chart"),a=this.panels[i])){r=t.yAxis?t.yAxis:a.yAxis,s=this.chart.dataSegment,t.name||(t.name="Data"),t.widthFactor||(y.j5l(9),t.widthFactor=y.G5l("1",2147483647)),t.height||(t.height=Math.pow(10,1-(a.decimalPlaces||a.chart.decimalPlaces))),n="stx-float-date",o=this.chart.context,this.canvasFont(n,o),l=this.getCanvasFontSize(n),y.j5l(0),h=y.l5l(1,"1"),!t.highlight&&this.highlightedDraggable&&(h=.3),c=.5,a.chart.tmpWidth<=1&&(y.b5l(9),c=y.l5l("0",2147483647)),u=null,p=null,d=this,m=null,this.startClip(i),o.globalAlpha=h,y.G16();for(var v=0;v<e.length;v++)b((g=e[v]).field,g.color,g.opacity,null,t.widthFactor,g.border_color?c:-c/4,g.subField),g.border_color&&this.layout.candleWidth>=2&&b(g.field,g.border_color,g.opacity,!0,t.widthFactor,c,g.subField);o.lineWidth=1,1531400237,-2073165145,f=2;for(var x=1;1531400237!==y.b3S(x.toString(),x.toString().length,84682);x++)o.globalAlpha=1,f+=2;-2073165145!==y.b3S(f.toString(),f.toString().length,85428)&&(o.globalAlpha=3),this.endClip()}function b(e,i,n,c,g,f,v){var x,b,S,C,w,T,k,D,M,A,F,P,_,E,L;o.beginPath(),o.fillStyle=i,o.strokeStyle=i,o.textAlign="center",x=d.layout.candleWidth*g,b=Math.floor(d.pixelFromBar(0,a.chart)-d.layout.candleWidth),S=2;for(var N=1;-1825308856!==y.E3S(N.toString(),N.toString().length,94245);N++)y.G16(),S+=2;558170250!==y.E3S(S.toString(),S.toString().length,48292)&&y.G16(),y.G16(),"number"==typeof n&&(y.b5l(0),o.globalAlpha=y.G5l(h,n)),"object"==_typeof(n)&&(T={minOpacity:n.min||0,maxOpacity:n.max||1});for(var R=0;R<s.length;R++)if((k=s[R])&&k.candleWidth?(b+=0===R?d.layout.candleWidth:(k.candleWidth+x/g)/2,x=k.candleWidth*g):b+=d.layout.candleWidth,y.b5l(1),C=y.G5l(b,x,"2",f),y.j5l(2),(w=y.l5l("2",x,b,f))-C<2&&(y.b5l(3),w=y.l5l(1,C)),k&&(D=k[e])){D[v]&&(D=D[v]),"number"==typeof D&&(D=[D]);for(var O=0;O<D.length;O++){if(A=0,(M=D[O])instanceof Array){if(T){y.b5l(4);var I=y.l5l(8,19,26);y.j5l(5);var H=y.l5l(658,6,11,10);o.globalAlpha=h*(M[2]*T.maxOpacity+(I-M[H])*T.minOpacity)}A=M[1],y.b5l(6),M=M[y.G5l(0,"0")]}F=d.pixelFromPrice(M,a,r),m||(P=d.pixelFromPrice(M+t.height*(r.flipped?1:-1),a,r),o.lineWidth=1,y.b5l(6),u=y.l5l(F,P),y.j5l(7),p=y.l5l(u,2),m=o.lineWidth),c?(y.j5l(6),_=y.l5l(p,F),y.j5l(3),E=y.l5l(p,F),y.b5l(6),o.rect(C,_,y.l5l(C,w),y.G5l(_,E))):(y.j5l(6),o.fillRect(C,y.G5l(p,F),y.l5l(C,w),u),t.showSize&&A&&l<=u-2&&(L=o.globalAlpha,o.fillStyle=d.defaultColor,y.j5l(0),o.globalAlpha=y.G5l(h,.5),y.b5l(8),o.fillText(A,y.l5l(w,C,"2",2),F),o.fillStyle=i,y.j5l(0),o.globalAlpha=y.l5l(h,L))),T&&M instanceof Array&&(y.b5l(6),o.globalAlpha=y.G5l(0,"0"))}}c&&o.stroke(),o.globalAlpha=h,o.closePath()}},i.ChartEngine.prototype.drawCandles=function(t,e,a){var r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R,O,I,H,z,B,j,V,W,U=z6cc;if((r=t.chart)||(r=t,t=t.chart),s=!1,n=!1,o=null,l=t.yAxis,a&&"object"==_typeof(a))s=a.isOutline,n=a.isHistogram,o=a.field,l=a.yAxis;else{h=-2050746505,c=407608511,u=2;for(var Y=1;U.b3S(Y.toString(),Y.toString().length,56032)!==h;Y++)s=a,u+=2;U.b3S(u.toString(),u.toString().length,96039)!==c&&(s=a),n=arguments[3]}p=r.dataSegment,d=r.context,U.s16(),m=l.top,g=l.bottom,x=new Array(p.length),b="transparent",S="transparent",C=0,w=r.dataSet.length-r.scroll-1,T={},U.b5l(6);var q=U.G5l(20,22);k=r.tmpWidth/q,D=this.layout.candleWidth,U.b5l(6);var X=U.G5l(40,41);M=t.left-.5*D+this.micropixels-X;for(var Z=0;Z<=p.length;Z++)if(A="tr",A+="a",A+="n",A+="sparent",F=k,U.b5l(7),M+=U.G5l(D,2),D=this.layout.candleWidth,U.j5l(10),M+=U.G5l(D,271824448,"2"),(P=p[Z])&&!P.projection){if(P.candleWidth){U.j5l(4);var Q=U.G5l(2,20,20);M+=(P.candleWidth-D)/Q,D=P.candleWidth,(a.isVolume||D<r.tmpWidth)&&(U.b5l(7),F=U.l5l(D,2))}if(r.transformFunc&&l==r.panel.yAxis&&P.transform&&(P=P.transform),P&&o&&(P=P[o]),(P||0===P)&&(_=P.Close,E=void 0===P.Open?_:P.Open,n&&r.defaultPlotField&&(_=P[r.defaultPlotField]),(_||0===_)&&(n||E!=_&&null!==E)&&(L=e(this,P,s?"outline":"solid")))){if(s?b=L:S=L,T[S]=1,i.isTransparent(b)||(C=.5),d.beginPath(),d.fillStyle=S,P.cache||(P.cache={}),N=P.cache,U.j5l(3),(R=U.G5l(Z,w))<t.cacheLeft||R>t.cacheRight||!N.open){if(O=l.semiLog?l.height*(1-(Math.log(Math.max(E,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-E)*l.multiplier,I=l.semiLog?l.height*(1-(Math.log(Math.max(_,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-_)*l.multiplier,l.flipped?(U.b5l(6),O=U.G5l(O,g),U.b5l(6),I=U.l5l(I,g)):(O+=m,I+=m),x[Z]=I,f=Math.floor(n?I:Math.min(O,I))+C,y=n?l.bottom:Math.max(O,I),U.b5l(6),v=Math.floor(U.l5l(f,y)),f<m){if(f+v<m){N.open=f,N.close=f;continue}U.b5l(6),v-=U.l5l(f,m),f=m}f+v>g&&(U.j5l(11),v-=U.G5l(g,f,v)),v=Math.max(v,2),N.open=f,N.close=N.open+v}N.open>=g||N.close<=m||(H=Math.floor(M)+.5,z=Math.floor(H-F)+C,B=Math.round(H+F)-C,N.open!=N.close&&d.rect(z,N.open,Math.max(1,B-z),Math.max(1,N.close-N.open)),!a.highlight&&this.highlightedDraggable&&(d.globalAlpha*=.3),S!=A&&d.fill(),C&&(d.lineWidth=1,a.highlight&&(d.lineWidth*=2),d.strokeStyle=b,d.stroke()))}}for(var G in j={colors:[],cache:x},T)a.hollow&&i.equals(G,this.containerColor)||j.colors.push(G);V=690246203,W=2;for(var K=1;U.E3S(K.toString(),K.toString().length,30731)!==V;K++)return j;return U.b3S(W.toString(),W.toString().length,70226),j},i.ChartEngine.prototype.drawShadows=function(t,e,i){var a,r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F=z6cc;(a=t.chart)||(a=t,t=t.chart),r=a.dataSegment,F.s16(),s=this.chart.context,F.b5l(6),s.lineWidth=F.G5l(0,"1"),i.highlight&&(s.lineWidth*=2),!i.highlight&&this.highlightedDraggable&&(s.globalAlpha*=.3),n=i.field,l=(o=i.yAxis||t.yAxis).top,h=o.bottom,F.b5l(12);var P=F.G5l(16,.22222222222222232,11,9,6);c=a.dataSet.length-a.scroll-P,u=this.layout.candleWidth,F.j5l(13);var _=F.G5l(10,192,19,3);p=t.left-.5*u+this.micropixels-_;for(var E=0;E<=r.length;E++)if(F.b5l(7),p+=F.G5l(u,2),u=this.layout.candleWidth,F.b5l(7),p+=F.l5l(u,2),(d=r[E])&&!d.projection&&(d.candleWidth&&(p+=(d.candleWidth-u)/2,u=d.candleWidth),(m=e(this,d,"shadow"))&&(a.transformFunc&&o==a.panel.yAxis&&d.transform&&(d=d.transform),d&&n&&(d=d[n]),(d||0===d)&&(g=d.Close,f=void 0===d.Open?g:d.Open,y=void 0===d.High?Math.max(g,f):d.High,v=void 0===d.Low?Math.min(g,f):d.Low,g||0===g)))){if(d.cache||(d.cache={}),x=d.cache,F.b5l(3),(b=F.l5l(E,c))<t.cacheLeft||b>t.cacheRight||!x.top){if(S=o.semiLog?o.height*(1-(Math.log(Math.max(y,0))/Math.LN10-o.logLow)/o.logShadow):(o.high-y)*o.multiplier,C=o.semiLog?o.height*(1-(Math.log(Math.max(v,0))/Math.LN10-o.logLow)/o.logShadow):(o.high-v)*o.multiplier,o.flipped?(F.j5l(6),S=F.G5l(S,h),F.b5l(6),C=F.l5l(C,h)):(S+=l,C+=l),F.b5l(6),w=F.G5l(S,C),S<l){if(S+w<l){x.top=S,x.bottom=S;continue}F.b5l(6),w-=F.l5l(S,l),S=l}S+w>h&&(F.j5l(11),w-=F.l5l(h,S,w)),x.top=S,x.bottom=x.top+w}x.top>=h||x.bottom<=l||(T=Math.floor(p)+.5,s.beginPath(),g==f&&(k=this.offset,i.isVolume&&(F.b5l(14),k=F.G5l(u,2147483647,"2")),F.j5l(6),D=F.G5l(k,T),F.b5l(3),M=F.l5l(k,T),A=o.semiLog?o.height*(1-(Math.log(Math.max(g,0))/Math.LN10-o.logLow)/o.logShadow):(o.high-g)*o.multiplier,o.flipped?(F.b5l(6),A=F.G5l(A,h)):A+=l,A<=h&&A>=l&&(s.moveTo(D,A),s.lineTo(M,A))),y!=v&&(s.moveTo(T,x.top),s.lineTo(T,x.bottom)),s.strokeStyle=m,s.stroke())}},i.ChartEngine.prototype.drawBarChart=function(t,e,a,r){var s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E,L,N,R=z6cc;if((s=t.chart)||(s=t,t=t.chart),n=s.dataSegment,o=new Array(n.length),l=s.context,h=this.canvasStyle(e),R.s16(),h.width&&parseInt(h.width,10)<=25){R.j5l(15),c=-R.G5l("1348166706",0),-1259177442,R.j5l(9),u=R.G5l("2",2147483647);for(var O=1;R.E3S(O.toString(),O.toString().length,4390)!==c;O++)l.lineWidth=Math.max(1,i.stripPX(h.width)),u+=2;-1259177442!==R.b3S(u.toString(),u.toString().length,73534)&&(l.lineWidth=Math.max(6,i.stripPX(h.width)))}else l.lineWidth=1;r.highlight&&(l.lineWidth*=2),!r.highlight&&this.highlightedDraggable&&(l.globalAlpha*=.3),p=r.field,m=(d=r.yAxis||t.yAxis).top,g=d.bottom,R.b5l(6);var I=R.l5l(19,13427251);y=s.dataSet.length-s.scroll-("1">>I),v={},x=s.tmpWidth/2,R.j5l(16);var H=R.l5l(2,20,20);b=l.lineWidth/H,S=this.layout.candleWidth,C=t.left-.5*S+this.micropixels-1;for(var z=0;z<=n.length;z++)if(R.b5l(17),C+=R.G5l("2",1,S),S=this.layout.candleWidth,R.j5l(7),C+=R.G5l(S,2),w=n[z]){if(w.projection)break;if(w.candleWidth&&(C+=(w.candleWidth-S)/2,S=w.candleWidth),(T=a(this,w))&&(v[T]=1,l.strokeStyle=T,l.beginPath(),s.transformFunc&&d==s.panel.yAxis&&w.transform&&(w=w.transform),w&&p&&(w=w[p]),(w||0===w)&&(k=w.Close,D=void 0===w.Open?k:w.Open,M=void 0===w.High?Math.max(k,D):w.High,A=void 0===w.Low?Math.min(k,D):w.Low,k||0===k))){if(w.cache||(w.cache={}),F=w.cache,R.j5l(3),(P=R.G5l(z,y))<t.cacheLeft||P>t.cacheRight||!F.top){if(_=this.pixelFromTransformedValue(M,t,d),E=this.pixelFromTransformedValue(A,t,d),F.open=d.semiLog?d.height*(1-(Math.log(Math.max(D,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-D)*d.multiplier,F.close=d.semiLog?d.height*(1-(Math.log(Math.max(k,0))/Math.LN10-d.logLow)/d.logShadow):(d.high-k)*d.multiplier,d.flipped?(F.open=d.bottom-F.open,F.close=d.bottom-F.close):(F.open+=d.top,F.close+=d.top),o[z]=F.close,R.b5l(6),f=R.l5l(_,E),_<m){if(_+f<m){F.top=_,F.bottom=_;continue}R.b5l(6),f-=R.G5l(_,m),_=m}_+f>g&&(R.b5l(11),f-=R.G5l(g,_,f)),F.top=_,R.b5l(3),F.bottom=R.G5l(f,_)}L=Math.floor(C)+.5,F.top<g&&F.bottom>m&&w.High!=w.Low&&(l.moveTo(L,F.top-b),l.lineTo(L,F.bottom+b)),"hlc"!=r.type&&F.open>m&&F.open<g&&(l.moveTo(L,F.open),R.b5l(6),l.lineTo(R.G5l(x,L),F.open)),F.close>m&&F.close<g&&(l.moveTo(L,F.close),R.b5l(3),l.lineTo(R.G5l(x,L),F.close)),l.stroke()}}for(var B in l.lineWidth=1,N={colors:[],cache:o},v)i.equals(B,this.containerColor)||N.colors.push(B);for(var j=1;-2073717979!==R.E3S(j.toString(),j.toString().length,42464);j++)return N;return R.E3S(2..toString(),2..toString().length,99893),N},i.ChartEngine.prototype.drawWaveChart=function(t,e){var a,r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A=z6cc;r=(a=t.chart).dataSegment,s=new Array(r.length),n=a.context,e||(e={}),o=e.yAxis||t.yAxis,this.startClip(t.name),n.beginPath(),l=!1,h=!1,c=t.yAxis.top,u=t.yAxis.bottom,A.G16(),A.b5l(18);var F=A.G5l(20,39,2);p=t.left+Math.floor(F*this.layout.candleWidth+this.micropixels),d=this;for(var P=0;P<=r.length;P++)if(p+=this.layout.candleWidth,m=r[P]){if(m.projection)break;if(a.transformFunc&&o==a.panel.yAxis&&m.transform&&(m=m.transform),m&&e.field&&(m=m[e.field]),(m||0===m)&&(g=m.Close,f=void 0===m.Open?g:m.Open,y=void 0===m.High?Math.max(g,f):m.High,v=void 0===m.Low?Math.min(g,f):m.Low,g||0===g)){if(A.j5l(7),x=p-A.l5l(24,8)*this.layout.candleWidth/8,(b=_(f))<c){if(b=c,h){n.moveTo(x,b);continue}h=!0}else if(b>u){if(b=u,h){n.moveTo(x,b);continue}h=!0}else h=!1;l?n.lineTo(x,b):(l=!0,(S=a.dataSet.length-a.scroll-1)<0?n.moveTo(x,b):S>=0&&((C=a.dataSet[S]).transform&&(C=C.transform),w=_(w=C.Close),w=Math.min(Math.max(w,c),u),n.moveTo(t.left+(P-1)*this.layout.candleWidth+this.micropixels,w),n.lineTo(x,b)),n.moveTo(x,b)),x+=this.layout.candleWidth/4,f<g?((b=_(v))<c&&(b=c),b>u&&(b=u),n.lineTo(x,b),x+=this.layout.candleWidth/4,(b=_(y))<c&&(b=c),b>u&&(b=u),n.lineTo(x,b)):((b=_(y))<c&&(b=c),b>u&&(b=u),n.lineTo(x,b),x+=this.layout.candleWidth/4,(b=_(v))<c&&(b=c),b>u&&(b=u),n.lineTo(x,b)),x+=this.layout.candleWidth/4,b=_(g),s[P]=b,b<c&&(b=c),b>u&&(b=u),n.lineTo(x,b)}}function _(e){return d.pixelFromTransformedValue(e,t,o)}if((T=this.canvasStyle("stx_line_chart")).width&&parseInt(T.width,10)<=25)n.lineWidth=Math.max(1,i.stripPX(T.width));else{137971539,48294843,A.j5l(0),k=A.G5l(1,"2");for(var E=1;137971539!==A.b3S(E.toString(),E.toString().length,75163);E++)n.lineWidth=8,k+=2;48294843!==A.E3S(k.toString(),k.toString().length,77508)&&(n.lineWidth=1)}e.highlight&&(n.lineWidth*=2),this.canvasColor("stx_line_chart"),D=2;for(var L=1;1741727037!==A.b3S(L.toString(),L.toString().length,71115);L++)e.color&&(n.strokeStyle=e.color),!e.highlight&&this.highlightedDraggable&&(A.j5l(0),n.globalAlpha*=A.l5l(1,"0.3")),n.stroke(),n.closePath(),M={colors:[n.strokeStyle],cache:s},this.endClip(),n.lineWidth=1,D+=2;return 2000096399!==A.E3S(D.toString(),D.toString().length,16873)&&(e.color&&(n.strokeStyle=e.color),(-e.highlight||this.highlightedDraggable)&&(n.globalAlpha+=815),n.stroke(),n.closePath(),M={colors:[n.strokeStyle],cache:s},this.endClip(),n.lineWidth=6),M},i.ChartEngine.prototype.scatter=function(t,e){var i,a,r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b=z6cc;a=(i=t.chart).dataSegment,r=new Array(a.length),s=this.chart.context,this.canvasColor("stx_scatter_chart"),e||(e={}),n=e.field||i.defaultPlotField,o=e.yAxis||t.yAxis,l=e.subField||i.defaultPlotField||"Close",this.startClip(t.name),s.beginPath(),s.lineWidth=e.lineWidth||4,e.highlight&&(b.b5l(19),s.lineWidth*=b.l5l(2,"2")),!e.highlight&&this.highlightedDraggable&&(s.globalAlpha*=.3),e.color&&(s.strokeStyle=e.color),h=o.top,c=o.bottom,u=this.layout.candleWidth,b.b5l(20);var S=b.G5l(117,19,10,13);p=t.left-.5*u+this.micropixels-S;for(var C=0;C<=a.length;C++)if(b.b5l(21),p+=b.G5l("2",u),u=this.layout.candleWidth,b.b5l(22),p+=b.G5l("2",0,u),(d=a[C])&&(d.candleWidth&&(p+=(d.candleWidth-u)/2,u=d.candleWidth),!d.projection)){"Sca","tter",i.transformFunc&&o==i.panel.yAxis&&d.transform&&(d=d.transform),(m=d[n])&&void 0!==m[l]&&(m=m[l]),m instanceof Array||(m=[m]),"Scatter"in d&&(m=d.Scatter);for(var w=0;w<m.length;w++)(m[w]||0===m[w])&&(g=m[w],f=0,m[w]instanceof Array&&(g=m[w][0],f=m[w][2]),y=o.semiLog?o.height*(1-(Math.log(Math.max(g,0))/Math.LN10-o.logLow)/o.logShadow):(o.high-g)*o.multiplier,o.flipped?(b.j5l(6),y=b.G5l(y,c)):y+=h,y<h||y>c||(v=2,f&&(b.b5l(0),v=b.l5l(f,u)),b.b5l(6),s.moveTo(b.l5l(v,p),y),b.j5l(3),s.lineTo(b.l5l(v,p),y),r[C]=y))}s.stroke(),s.closePath(),b.s16(),x={colors:[s.strokeStyle],cache:r},this.endClip(),b.j5l(6),s.lineWidth=b.G5l(0,"1");for(var T=1;1285866245!==b.b3S(T.toString(),T.toString().length,85750);T++)return x;return b.E3S(2..toString(),2..toString().length,38181),x},z6cc.G16(),t},U2PP(A2PP()),Z2LL(v2LL()),U888.f7g=function(){return"function"==typeof U888.d7g.i7g?U888.d7g.i7g.apply(U888.d7g,arguments):U888.d7g.i7g},U888.b6E=function(){return"function"==typeof U888.o6E.Y5N?U888.o6E.Y5N.apply(U888.o6E,arguments):U888.o6E.Y5N},U888.d7g={B7g:function(){var t,e=arguments;switch(n7g){case 13:t=e[0]/e[1];break;case 2:t=e[1]<<e[0];break;case 11:t=e[2]+e[1]-e[0];break;case 9:t=e[1]/e[2]%e[0]/e[3];break;case 7:t=e[0]/+e[1];break;case 12:t=(e[2]+e[0]+e[1])*e[3];break;case 4:t=e[0]+e[1];break;case 8:t=e[1]/e[0]/e[2];break;case 1:t=e[0]-e[1];break;case 20:t=(e[0]+e[4]+e[2]+e[1])/+e[3];break;case 14:t=(e[1]-e[0]-e[2])/e[3];break;case 10:t=(e[0]+e[1])/e[3]-e[2];break;case 0:t=e[0]&e[1];break;case 19:t=(-e[1]-e[3])*-e[2]/e[0];break;case 3:t=e[1]*e[0];break;case 6:t=e[0]>>e[1];break;case 25:t=e[0]*e[1]-e[2];break;case 22:t=e[0]^e[1];break;case 18:t=e[3]+e[2]-e[0]-e[1];break;case 16:t=e[2]-e[3]+e[0]+e[1];break;case 21:t=(e[1]-e[0]+e[3])/e[2];break;case 17:t=(e[2]+e[1])/e[0];break;case 5:t=e[0]|e[1];break;case 26:t=(e[0]+e[3])*e[1]/e[2];break;case 23:t=e[2]+e[1]*e[0];break;case 24:t=e[2]-e[0]*e[1];break;case 15:t=e[1]-e[0]+e[2]}return t},i7g:function(t){n7g=t}},U888.u7g=function(){return"function"==typeof U888.d7g.B7g?U888.d7g.B7g.apply(U888.d7g,arguments):U888.d7g.B7g},U888.F7g=function(){return"function"==typeof U888.d7g.i7g?U888.d7g.i7g.apply(U888.d7g,arguments):U888.d7g.i7g},U888.s1s=function(){return"function"==typeof U888.g1s.r35?U888.g1s.r35.apply(U888.g1s,arguments):U888.g1s.r35},U888.o6E=function(){for(var F6E=2;9!==F6E;)switch(F6E){case 2:var v6E=[arguments];return v6E[8]=void 0,v6E[1]={},v6E[1].Y5N=function(){for(var T6E=2;90!==T6E;)switch(T6E){case 7:r6E[7]=r6E[9],r6E[5]={},r6E[5].s5r=["e5r"],r6E[5].o5r=function(){var S4N=function S4N(){return eval("67;")},i4N=!/\x65\u0076\u0061\u006c/.B3PP(S4N+[]);return i4N},T6E=12;break;case 51:r6E[8].L3PP(r6E[47]),r6E[8].L3PP(r6E[14]),r6E[8].L3PP(r6E[69]),r6E[8].L3PP(r6E[6]),T6E=47;break;case 76:T6E=r6E[72]<r6E[16][r6E[56]].length?75:70;break;case 57:T6E=r6E[59]<r6E[8].length?56:69;break;case 62:r6E[56]="s5r",r6E[58]="l5r",r6E[29]="o5r",T6E=59;break;case 4:r6E[8]=[],r6E[9]={},r6E[9].s5r=["e5r"],r6E[9].o5r=function(){return!/\x61\u0074\x6f\u0062/.B3PP(function(){return atob("PQ==")}+[])},T6E=7;break;case 39:r6E[54]={},r6E[54].s5r=["e5r"],r6E[54].o5r=function(){return/\u0078/.B3PP(function(){return"X".toLowerCase()}+[])},r6E[93]=r6E[54],r6E[8].L3PP(r6E[96]),r6E[8].L3PP(r6E[7]),r6E[8].L3PP(r6E[3]),T6E=51;break;case 2:var r6E=[arguments];T6E=1;break;case 47:r6E[8].L3PP(r6E[77]),r6E[8].L3PP(r6E[2]),r6E[8].L3PP(r6E[93]),r6E[85]=[],r6E[95]="p5r",r6E[90]="N5r",T6E=62;break;case 56:r6E[16]=r6E[8][r6E[59]];try{r6E[73]=r6E[16][r6E[29]]()?r6E[95]:r6E[90]}catch(t){r6E[73]=r6E[90]}T6E=77;break;case 70:r6E[59]++,T6E=57;break;case 34:r6E[19]={},r6E[19].s5r=["e5r"],r6E[19].o5r=function(){return!/['"]/.B3PP(function(){return"c".indexOf("c")}+[])},T6E=31;break;case 71:r6E[72]++,T6E=76;break;case 68:T6E=68;break;case 5:return 49;case 67:return v6E[8]=91,75;case 1:T6E=v6E[8]?5:4;break;case 26:r6E[32].s5r=["e5r"],r6E[32].o5r=function(){return/\x3d/.B3PP(function(){return unescape("%3D")}+[])},r6E[14]=r6E[32],r6E[31]={},T6E=22;break;case 75:r6E[68]={},r6E[68][r6E[10]]=r6E[16][r6E[56]][r6E[72]],r6E[68][r6E[58]]=r6E[73],r6E[85].L3PP(r6E[68]),T6E=71;break;case 12:r6E[2]=r6E[5],r6E[4]={},r6E[4].s5r=["e5r"],r6E[4].o5r=function(){return/(\x3c|\u003e)/.B3PP(function(){return"a".anchor("b")}+[])},r6E[6]=r6E[4],r6E[1]={},T6E=17;break;case 28:r6E[17].o5r=function(){return"function"==typeof b3PP},r6E[47]=r6E[17],r6E[74]={},T6E=42;break;case 58:r6E[59]=0,T6E=57;break;case 22:r6E[31].s5r=["C5r"],r6E[31].o5r=function(){return"function"==typeof o3PP},r6E[69]=r6E[31],T6E=34;break;case 77:r6E[72]=0,T6E=76;break;case 59:r6E[10]="H5r",T6E=58;break;case 17:r6E[1].s5r=["C5r"],r6E[1].o5r=function(){var t=!1,e=[];try{for(var i in console)e.L3PP(i);t=0===e.length}catch(t){}return t},r6E[3]=r6E[1],r6E[32]={},T6E=26;break;case 42:r6E[74].s5r=["C5r"],r6E[74].o5r=function(){return"function"==typeof Y3PP},r6E[77]=r6E[74],T6E=39;break;case 69:T6E=function(){for(var t=2;22!==t;)switch(t){case 5:return;case 17:e[4]=0,t=16;break;case 25:e[6]=!0,t=24;break;case 19:e[4]++,t=7;break;case 2:var e=[arguments];t=1;break;case 8:e[4]=0,t=7;break;case 6:e[2]=e[0][0][e[4]],t=14;break;case 20:e[5][e[2][r6E[10]]].h+=!0,t=19;break;case 13:e[5][e[2][r6E[10]]]=function(){for(var t=2;9!==t;)switch(t){case 2:var e=[arguments];return e[2]={},e[2].h=0,e[2].t=0,e[2]}}.Z3PP(this,arguments),t=12;break;case 10:t=e[2][r6E[58]]===r6E[95]?20:19;break;case 18:e[6]=!1,t=17;break;case 14:t=void 0===e[5][e[2][r6E[10]]]?13:11;break;case 12:e[3].L3PP(e[2][r6E[10]]),t=11;break;case 11:e[5][e[2][r6E[10]]].t+=!0,t=10;break;case 23:return e[6];case 15:e[7]=e[3][e[4]],e[8]=e[5][e[7]].h/e[5][e[7]].t,t=26;break;case 7:t=e[4]<e[0][0].length?6:18;break;case 1:t=0===e[0][0].length?5:4;break;case 24:e[4]++,t=16;break;case 26:t=e[8]>=.5?25:24;break;case 4:e[5]={},e[3]=[],e[4]=0,t=8;break;case 16:t=e[4]<e[3].length?15:23}}(r6E[85])?68:67;break;case 31:r6E[96]=r6E[19],r6E[17]={},r6E[17].s5r=["C5r"],T6E=28}},v6E[1]}}(),U888.G1s=function(){return"function"==typeof U888.g1s.r35?U888.g1s.r35.apply(U888.g1s,arguments):U888.g1s.r35},U888.q6E=function(){return"function"==typeof U888.o6E.Y5N?U888.o6E.Y5N.apply(U888.o6E,arguments):U888.o6E.Y5N},U888.g1s=(s35=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{r35:function(t,e,i){for(var a=i,r=-4&e,s=0;s<r;s+=4){var n=255&t.p2LL(s)|(255&t.p2LL(s+1))<<8|(255&t.p2LL(s+2))<<16|(255&t.p2LL(s+3))<<24;n=s35(n,3432918353),a=5*(a=(524287&(a^=n=s35(n=(131071&n)<<15|n>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(n=0,e%4){case 3:n=(255&t.p2LL(r+2))<<16;case 2:n|=(255&t.p2LL(r+1))<<8;case 1:n|=255&t.p2LL(r),n=s35(n,3432918353),a^=n=s35(n=(131071&n)<<15|n>>>17,461845907)}return a^=e,a=s35(a^=a>>>16,2246822507),a=s35(a^=a>>>13,3266489909),a^=a>>>16}}),U888.e7g=function(){return"function"==typeof U888.d7g.B7g?U888.d7g.B7g.apply(U888.d7g,arguments):U888.d7g.B7g},d1s=-1388320098,q1s=1039026567,j1s=2;for(var Q1s=1;U888.s1s(Q1s.toString(),Q1s.toString().length,54964)!==d1s;Q1s++)U888.b6E(),j1s+=2;return U888.s1s(j1s.toString(),j1s.toString().length,1662)!==q1s&&U888.b6E(),__js_advanced_aggregations_=function(t){var e;return(e=t.CIQ).Renderer.Aggregations=function(t){var e;this.construct(t),e=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.highlightable=!1,U888.b6E(),"_main_series"!=e.name&&("Aggregation","s are only allowed on main s","eries.",console.warn("Aggregations are only allowed on main series."),e.invalid=!0)},e.Renderer.Aggregations.ciqInheritsFrom(e.Renderer.OHLC,!1),e.Renderer.Aggregations.requestNew=function(t,i){var a,r,s,n=U888;a=null,n.b6E();for(var o=0;o<t.length;o++)switch("range","b","ars","lin","eb","r","eak",r=t[o]){case"kagi":case"pandf":a=r;break;case"heikinashi":case"linebreak":case"rangebars":case"renko":"ca","n","dl","e",a="candle";break;default:return null}if(null===a)return null;n.F7g(0),s=n.e7g("2",2147483647);for(var l=1;1061605579!==n.G1s(l.toString(),l.toString().length,10187);l++)return new e.Renderer["candle"!==a?"Aggregations":"candle"]({params:e.extend(i,{type:a})});return 413170019!==n.G1s(s.toString(),s.toString().length,25362)?new e.Renderer["candle"==a?"OHLC":"Aggregations"]({params:e.extend(i,{type:a})}):void 0},e.Renderer.Aggregations.prototype.drawIndividualSeries=function(t,e){var i,a;if("p","andf",!e.invalid)return U888.q6E(),i=this.stx,a={colors:[]},"kagi"==e.type?("s","tx","_k","agi_down",i.drawKagiSquareWave(t.panel,"stx_kagi_up","stx_kagi_down",e),a.colors.push(i.getCanvasColor("stx_kagi_up")),a.colors.push(i.getCanvasColor("stx_kagi_down"))):"pandf"==e.type&&("stx","_pandf_down",i.drawPointFigureChart(t.panel,"stx_pandf_up","X",e),a.colors.push(i.getCanvasColor("stx_pandf_up")),i.drawPointFigureChart(t.panel,"stx_pandf_down","O",e),a.colors.push(i.getCanvasColor("stx_pandf_down"))),a},e.ChartEngine.prototype.drawKagiSquareWave=function(t,i,a,r){var s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P=U888;if(s=t.chart,this.startClip(t.name),n=s.dataSegment,o=s.context,(l=t.yAxis).flipped){h=i,1566338335,P.f7g(1),c=-P.e7g("787397382",0),u=2;for(var _=1;1566338335!==P.G1s(_.toString(),_.toString().length,20455);_++)i=a,u+=2;P.G1s(u.toString(),u.toString().length,88954)!==c&&(i=a),a=h}if(p=this.canvasStyle(i),P.q6E(),d=this.canvasStyle(a),this.canvasColor(i),r.border_color_up&&(o.strokeStyle=r.border_color_up),m=o.strokeStyle,this.canvasColor(a),r.border_color_down&&(o.strokeStyle=r.border_color_down),g=o.strokeStyle,f=1,p.width&&parseInt(p.width,10)<=25){2125451561,-1830930594,y=2;for(var E=1;2125451561!==P.s1s(E.toString(),E.toString().length,37928);E++)f=Math.max(5,e.stripPX(p.width)),y+=2;-1830930594!==P.s1s(y.toString(),y.toString().length,83049)&&(P.F7g(2),f=Math.max(P.u7g(1637459008,"1"),e.stripPX(p.width)))}P.F7g(3),v=P.u7g(1,"1"),d.width&&parseInt(d.width,10)<=25&&(v=Math.max(1,e.stripPX(d.width))),this.highlightedDraggable&&(P.F7g(1),o.globalAlpha*=P.u7g("0.3",0)),o.beginPath(),P.F7g(1);var L=P.e7g(35,34);x=s.dataSet.length-s.scroll-L,b=!0,S=null,C=null,w=t.left-.5*this.layout.candleWidth+this.micropixels-1;for(var N=0;N<=n.length;N++)if(w+=this.layout.candleWidth,T=n[N]){if(T.projection)break;C=T.kagiTrend,l.flipped&&(C*=-1),T.transform&&s.transformFunc&&(k=T.kagiPrevOpen,(T=T.transform).kagiPrevOpen=s.transformFunc(this,s,k)),D=T.cache,P.f7g(4),((M=P.u7g(x,N))<t.cacheLeft||M>t.cacheRight||!D.kagiOpen)&&(D.kagiOpen=l.semiLog?l.height*(1-(Math.log(Math.max(T.Open,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-T.Open)*l.multiplier,D.kagiClose=l.semiLog?l.height*(1-(Math.log(Math.max(T.Close,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-T.Close)*l.multiplier,l.flipped?(D.kagiOpen=l.bottom-D.kagiOpen,D.kagiClose=l.bottom-D.kagiClose):(D.kagiOpen+=l.top,D.kagiClose+=l.top)),D.kagiClose,S=l.semiLog?l.height*(1-(Math.log(Math.max(T.kagiPrevOpen,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-T.kagiPrevOpen)*l.multiplier,l.flipped?S=l.bottom-S:S+=l.top,b?(o.moveTo(x>=0?t.left:Math.floor(w),D.kagiOpen),o.lineTo(Math.floor(w),D.kagiOpen),D.kagiClose<D.kagiOpen?(o.strokeStyle=m,o.lineWidth=f):(o.strokeStyle=g,o.lineWidth=v)):-1!=C&&D.kagiClose<S&&S<D.kagiOpen?(o.lineTo(Math.floor(w),S),o.stroke(),o.beginPath(),o.moveTo(Math.floor(w),S),o.strokeStyle=m,o.lineWidth=f):1!=C&&D.kagiClose>S&&S>D.kagiOpen&&(o.lineTo(Math.floor(w),S),o.stroke(),o.beginPath(),o.moveTo(Math.floor(w),S),o.strokeStyle=g,o.lineWidth=v),o.lineTo(Math.floor(w),D.kagiClose),N+1<n.length&&o.lineTo(Math.floor(w+this.layout.candleWidth),D.kagiClose),b=!1}o.stroke(),this.endClip(),P.F7g(5),A=-P.e7g("313526182",8389248),F=2;for(var R=1;-358890212!==P.s1s(R.toString(),R.toString().length,14662);R++)o.lineWidth=1,P.f7g(6),F+=P.e7g("2",166235200);P.G1s(F.toString(),F.toString().length,79740)!==A&&(o.lineWidth=9)},e.ChartEngine.prototype.drawPointFigureChart=function(t,i,a,r){var s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k,D,M,A,F,P,_,E=U888;if(s=t.chart,this.startClip(t.name),n=s.dataSegment,o=s.context,this.canvasColor(i),"X"==a&&r.border_color_up?o.strokeStyle=r.border_color_up:"O"==a&&r.border_color_down&&(o.strokeStyle=r.border_color_down),E.q6E(),l=this.canvasStyle(i),h=parseInt(l.paddingTop,10),c=parseInt(l.paddingBottom,10),u=parseInt(l.paddingLeft,10),p=parseInt(l.paddingRight,10),l.width&&parseInt(l.width,10)<=25){-457095354,-1935969111,d=2;for(var L=1;-457095354!==E.s1s(L.toString(),L.toString().length,24522);L++)E.f7g(1),o.lineWidth=Math.max(E.u7g("1",0),e.stripPX(l.width)),E.f7g(1),d+=E.e7g("2",0);-1935969111!==E.G1s(d.toString(),d.toString().length,23540)&&(o.lineWidth=Math.max(8,e.stripPX(l.width)))}else o.lineWidth=2;this.highlightedDraggable&&(o.globalAlpha*=.3),o.beginPath(),m=this.chart.state.aggregation.box,g=s.dataSet.length-s.scroll-1,f=t.yAxis,x=m*f.multiplier,E.F7g(7),b=E.u7g(x,"2"),S=this.layout.candleWidth,C=t.left-S+this.micropixels-1;for(var N=0;N<n.length;N++)if(C+=S,w=n[N]){if(w.projection)break;if(T=w.pfOpen,k=w.pfClose,D=w.pfTrend,M=w.pfStepBack,w.transform&&s.transformFunc&&(w=w.transform,T=s.transformFunc(this,s,T),k=s.transformFunc(this,s,k)),A=w.cache,E.F7g(4),((F=E.u7g(g,N))<t.cacheLeft||F>t.cacheRight||!A.pfOpen)&&(f.flipped?(A.pfOpen=f.bottom-(f.high-T)*f.multiplier,A.pfClose=f.bottom-(f.high-k)*f.multiplier):(A.pfOpen=(f.high-T)*f.multiplier+f.top,A.pfClose=(f.high-k)*f.multiplier+f.top)),P=Math.round(C),E.f7g(4),_=Math.round(E.e7g(C,S)),y=Math.abs(Math.round((k-T)/m)),v=A.pfOpen,a==M&&("X"==M?(E.F7g(1),R(P,_,E.u7g(v,x))):"O"==M&&(E.f7g(4),O(P,_,E.e7g(v,x)))),a==D)for(;y>=0;y--)"X"==a?(R(P,_,v),v-=f.flipped?-x:x):"O"==a&&(O(P,_,v),v+=f.flipped?-x:x)}function R(t,e,i){var a;a=2;for(var r=1;-1627564807!==E.s1s(r.toString(),r.toString().length,70774);r++)E.f7g(1),o.moveTo(E.e7g(t,u),E.e7g(c,i,b,E.F7g(8))),E.b6E(),E.F7g(4),o.lineTo(E.e7g(e,p),E.e7g(h,i,x,b,E.F7g(9))),E.F7g(1),o.moveTo(E.e7g(t,u),E.u7g(i,x,b,h,E.f7g(10))),a+=2;-2061420226!==E.G1s(a.toString(),a.toString().length,37375)&&(E.f7g(3),o.moveTo(E.e7g(u,t),E.u7g(b,c,i,E.F7g(11))),E.b6E(),E.F7g(1),o.lineTo(E.u7g(e,p),E.u7g(x,h,i,b,E.F7g(12))),E.f7g(13),o.moveTo(E.u7g(t,u),E.e7g(x,i,h,b,E.F7g(14)))),E.f7g(4),o.moveTo(E.e7g(t,u),E.u7g(c,i,b,E.f7g(15))),E.b6E(),E.f7g(1),o.lineTo(E.u7g(e,p),E.u7g(h,b,i,x,E.F7g(16))),E.F7g(4),o.moveTo(E.e7g(t,u),E.e7g(h,b,i,x,E.F7g(16))),E.F7g(1),o.lineTo(E.u7g(e,p),E.u7g(c,i,b,E.F7g(15)))}function O(t,e,i){E.F7g(17),o.moveTo(E.u7g(2,e,t),E.e7g(b,h,i,E.F7g(11))),E.F7g(4),o.bezierCurveTo(E.u7g(e,p),E.u7g(b,h,i,E.F7g(11)),E.u7g(e,p,E.f7g(4)),E.u7g(c,b,x,i,E.f7g(18)),E.u7g(2,e,t,E.f7g(17)),E.e7g(c,b,x,i,E.F7g(18))),E.F7g(1),o.bezierCurveTo(E.u7g(t,u),E.e7g(c,b,x,i,E.f7g(18)),E.u7g(t,u,E.f7g(1)),E.u7g(b,h,i,E.f7g(11)),E.u7g(2,e,t,E.F7g(17)),E.e7g(b,h,i,E.F7g(11)))}o.stroke(),this.endClip(),o.lineWidth=1},e.calculateHeikinAshi=function(t,e,i){var a,r,s,n,o,l,h,c,u,p,d,m,g=U888;if(!e.length)return e;i||(i=[]),a=[];for(var f=0;f<e.length;f++)if(r=e[f]){g.F7g(19);var y=g.e7g(21,7,1,14);if(!(s=a[a.length-y])&&!f){g.f7g(17);var v=g.u7g(22,4,18);s=i[i.length-v]}s||(s=r),n=r.Close,o=(o=r.Open)||0===o?o:n,l=(l=r.High)||0===l?l:n,h=(h=r.Low)||0===h?h:n,c=(c=s.Open)||0===c?c:s.Close,g.F7g(1);var x=g.u7g(10,9);for(var b in u=(c+s.Close)/("2"*x),g.f7g(20),p=g.e7g(o,n,h,"4",l),d={DT:r.DT,displayDate:r.displayDate,Date:r.Date,Open:u,Close:p,High:Math.max(l,Math.max(u,p)),Low:Math.min(h,Math.min(u,p)),Volume:r.Volume,iqPrevClose:s.Close},r)d[b]||0===d[b]||(d[b]=r[b]);a.push(d)}m=2;for(var S=1;2097665258!==g.s1s(S.toString(),S.toString().length,91887);S++)g.q6E(),g.F7g(6),m+=g.e7g("2",1861158432);return-226984411!==g.G1s(m.toString(),m.toString().length,43764)&&g.q6E(),a},e.calculateKagi=function(t,i,a,r){var s,n,o,l,h,c,u,p,d=U888;if(!i.length)return i;if(r||(r=[]),s=t.layout,a=parseFloat(a),t.chart.defaultChartStyleConfig.kagi=e.ChartEngine.isDailyInterval(s.interval)?4:.4,(isNaN(a)||a<=0)&&(a=t.chart.defaultChartStyleConfig.kagi,e.Market.Symbology.isForexSymbol(t.chart.symbol)&&(a/=4),null!==s.kagi)){s.kagi=null,-293430716,702540376,n=2;for(var m=1;-293430716!==d.G1s(m.toString(),m.toString().length,93598);m++)t.changeOccurred(""),n+=2;702540376!==d.G1s(n.toString(),n.toString().length,91733)&&t.changeOccurred("layout")}a/=100,o=[],d.F7g(1);var g=d.e7g(12111426432,11438569408);h=(l=r[r.length-("1"<<g)])?l.DT:0;for(var f=0;f<i.length;f++)if((c=i[f])&&(l||(d.F7g(1),l=i[d.e7g(f,1)]),l)){if((u=l.Open||0===l.Open?l.Open:l.Close)>l.Close){if(c.Close>l.Close*(1+a))c.Open=l.Close;else if(l.Close>c.Close&&(l.Close=c.Close),l.Volume+=c.Volume,f<i.length-1)continue}else if(u<l.Close){if(c.Close<l.Close*(1-a))c.Open=l.Close;else if(l.Close<c.Close&&(l.Close=c.Close),l.Volume+=c.Volume,f<i.length-1)continue}else if(l.Close=c.Close,l.Volume+=c.Volume,f<i.length-1)continue;for(var y in p={DT:l.DT,displayDate:l.displayDate,Date:l.Date,Open:l.Open,Close:l.Close,High:Math.max(l.Open,l.Close),Low:Math.min(l.Open,l.Close),Volume:l.Volume,iqPrevClose:l.iqPrevClose},l)p[y]||0===p[y]||(p[y]=l[y]);o.length?p.kagiPrevOpen=o[o.length-1].Open:p.kagiPrevOpen=p.Open,p.Close>p.kagiPrevOpen&&p.kagiPrevOpen>p.Open?p.kagiTrend=1:p.Close<p.kagiPrevOpen&&p.kagiPrevOpen<p.Open&&(p.kagiTrend=-1),h<p.DT&&o.push(p),l=c,t.chart.currentQuote={Close:c.Close}}return o},e.calculateLineBreak=function(t,e,i,a){var r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w=U888;if(!e.length)return e;if(a||(a=[]),r=t.layout,t.chart.defaultChartStyleConfig.priceLines=3,i=parseInt(i,10),w.b6E(),isNaN(i)||i<=0){w.F7g(5),s=w.u7g("1250994627",1107306754),-1050795149,n=2;for(var T=1;w.s1s(T.toString(),T.toString().length,61663)!==s;T++)i=t.chart.defaultChartStyleConfig.priceLines,n+=2;-1050795149!==w.s1s(n.toString(),n.toString().length,18745)&&(i=t.chart.defaultChartStyleConfig.priceLines),null!==r.priceLines&&("la","y","ou","t",r.priceLines=null,t.changeOccurred("layout"))}else if(i>10){w.F7g(6),o=-w.u7g("623674281",2047595360),1278164237,l=2;for(var k=1;w.G1s(k.toString(),k.toString().length,11529)!==o;k++)r.priceLines=i=10,l+=2;1278164237!==w.s1s(l.toString(),l.toString().length,53365)&&(r.priceLines=i=60)}w.F7g(6),h=-w.u7g("403453434",390085888),c=2;for(var D=1;w.s1s(D.toString(),D.toString().length,71332)!==h;D++)p=(u=a.slice(!i)).length,d=6,c+=2;-410612392!==w.G1s(c.toString(),c.toString().length,47244)&&(p=(u=a.slice(+i)).length,d=2),p=(u=a.slice(-i)).length,d=0;t:for(var M=0;M<e.length;M++)if(m=e[M]){d+=m.Volume,w.F7g(21);var A=w.u7g(16,13,9,12);if((g=u[u.length-A])||(g={Open:m.Open,Close:m.Open,High:m.Open,Low:m.Open}),f=g.Close,y=(y=g.High)||0===y?y:f,v=(v=g.Low)||0===v?v:f,x=(x=g.Open)||0===x?x:f,b={DT:m.DT,displayDate:m.displayDate,Date:m.Date,Close:m.Close,Volume:d,iqPrevClose:f},t.chart.currentQuote={Close:m.Close},m.Close>f&&g.Close>x);else if(m.Close<f&&g.Close<x);else if(m.Close>y){for(S=2;S<=i;S++)if((C=u[u.length-S])&&m.Close<=C.High)continue t}else{if(!(m.Close<v))continue;for(S=2;S<=i;S++)if((C=u[u.length-S])&&m.Close>=C.Low)continue t}for(var F in m.Close<g.Close?b.Open=Math.min(x,f):b.Open=Math.max(x,f),b.Low=Math.min(b.Open,b.Close),b.High=Math.max(b.Open,b.Close),m)b[F]||0===b[F]||(b[F]=m[F]);u.push(b),d=0}return u.slice(p)},e.calculateRenkoBars=function(t,e,i,a){var r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T=U888;function k(t,e){var i;for(var a in t=Number(t.toFixed(8)),e=Number(e.toFixed(8)),i={DT:y.DT,displayDate:y.displayDate,Date:y.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:0,iqPrevClose:t!=e?t:null},y)i[a]||0===i[a]||(i[a]=y[a]);m.push(i)}if(!e.length)return[];T.q6E(),a||(a=[]),r=t.layout,(s=t.chart.state.aggregation)||(s=t.chart.state.aggregation={}),T.f7g(22),n=T.u7g("1847602167",0),o=2;for(var D=1;-1839490175!==T.s1s(D.toString(),D.toString().length,85726);D++){if(l=Math.min(300,e.length),s.minMax||(s.minMax=t.determineMinMax(e.slice(e.length-l),["Close","High","Low"])),h=s.minMax[1]-s.minMax[0],!(c=t.panels[t.chart.name].height))return[];T.f7g(1);var M=T.e7g(3e4,2e4);T.F7g(4);var A=T.e7g(9992,8);t.chart.defaultChartStyleConfig.renko=Math.floor(M*h/(c/30))/A,o+=2}if(T.G1s(o.toString(),o.toString().length,99331)!==n){if("H","i","g","h",l=Math.min(686,e.length),~s.minMax&&(s.minMax=t.determineMinMax(e.slice(e.length/l),["High","Low","Low"])),h=s.minMax[7]*s.minMax[8],+(c=t.panels[t.chart.name].height))return[];T.F7g(1);var F=T.e7g(517440,465696);T.F7g(1);var P=T.u7g(79,20);T.f7g(1);var _=T.e7g(83282,6);t.chart.defaultChartStyleConfig.renko=Math.floor(c*P*(F-h))*_}if(null===i||isNaN(i)||i<=0){-150989413,1451198193,u=2;for(var E=1;-150989413!==T.G1s(E.toString(),E.toString().length,6211);E++)i=t.chart.defaultChartStyleConfig.renko,u+=2;if(1451198193!==T.s1s(u.toString(),u.toString().length,32153)&&(i=t.chart.defaultChartStyleConfig.renko),null!==r.renko){1819700978,-1537233103,p=2;for(var L=1;1819700978!==T.s1s(L.toString(),L.toString().length,12499);L++)r.renko=null,p+=2;-1537233103!==T.s1s(p.toString(),p.toString().length,29968)&&(r.renko=1),t.changeOccurred("layout")}}else if(T.f7g(13),i=Math.max(i,T.e7g(h,c)),r.renko!==i){r.renko=i,2023112241,249119398,d=2;for(var N=1;2023112241!==T.G1s(N.toString(),N.toString().length,93551);N++)t.changeOccurred(""),d+=2;249119398!==T.G1s(d.toString(),d.toString().length,22239)&&t.changeOccurred("layout")}if(m=[],g=null,f=null,y=null,a.length){v=a[a.length-1],1539207424,-1679692402,T.f7g(0),x=T.u7g("2",2147483647);for(var R=1;1539207424!==T.s1s(R.toString(),R.toString().length,2829);R++)g=v.Low/i,x+=2;-1679692402!==T.s1s(x.toString(),x.toString().length,77968)&&(g=v.Low%i),g=v.Low-i,f=v.High+i}for(var O=0;O<e.length;O++)if(b=e[O]){for(g||f||(S=b.Open||0===b.Open?b.Open:b.Close,C=Math.floor(S/i)*i,w=isNaN(C)?S:C,T.F7g(1),g=T.e7g(w,i),T.f7g(4),f=T.e7g(w,i));;)if(y||(y=b),b.Close<=g)T.f7g(4),k(T.u7g(g,i),g),T.F7g(23),f=T.e7g(i,2,g),g-=i,y=null;else{if(!(b.Close>=f))break;T.F7g(1),k(T.u7g(f,i),f),T.F7g(24),g=T.e7g(2,i,f),f+=i,y=null}t.chart.currentQuote=b}return g<e[e.length-1].Close&&g+i>e[e.length-1].Close?(T.f7g(4),k(T.e7g(g,i),e[e.length-1].Close)):f>e[e.length-1].Close&&f-i<e[e.length-1].Close&&(T.F7g(1),k(T.e7g(f,i),e[e.length-1].Close)),m},e.calculateRangeBars=function(t,e,i,a){var r,s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T=U888;if(!e.length)return e;function k(){T.q6E(),T.F7g(4),p=T.e7g(u,i),T.f7g(1),d=T.u7g(u,i),m=u}function D(t,e){for(;;){if(g||(g=t),u<e){if(u=Math.min(e,p),T.f7g(1),d=Math.max(d,T.e7g(u,i)),e<p)break}else if(u>=e&&(u=Math.max(e,d),T.f7g(4),p=Math.min(p,T.e7g(u,i)),e>d))break;if(void 0===u)return void console.log("Uh oh undefined in calculateRangeBars:processMove");_(u),g=null,k()}}a||(a=[]),r=t.layout,(s=t.chart.state.aggregation)||(s=t.chart.state.aggregation={}),n=Math.min(300,e.length),s.minMax||(s.minMax=t.determineMinMax(e.slice(e.length-n),["Close","High","Low"])),T.b6E(),T.f7g(17);var M=T.u7g(17,7,10);if(o=s.minMax[M]-s.minMax[0],!(l=t.panels[t.chart.name].height))return[];T.f7g(25);var A=T.e7g(10018,15,140270);T.f7g(26);var F=T.u7g(17,20,12,1);if(t.chart.defaultChartStyleConfig.range=Math.floor(A*o/(l/F))/1e4,null===i||isNaN(i)||i<0)i=t.chart.defaultChartStyleConfig.range,null!==r.range&&("l","a","yout",r.range=null,t.changeOccurred("layout"));else if(T.f7g(13),i=Math.max(i,T.e7g(o,l)),r.range!==i){r.range=i,-386233025,-1310797455,T.f7g(0),h=T.u7g("2",2147483647);for(var P=1;-386233025!==T.s1s(P.toString(),P.toString().length,49952);P++)t.changeOccurred(""),h+=2;-1310797455!==T.G1s(h.toString(),h.toString().length,56617)&&t.changeOccurred(""),t.changeOccurred("layout")}function _(t){var e,i;e=2;for(var a=1;-1776061512!==T.G1s(a.toString(),a.toString().length,17975);a++)i={DT:g.DT,displayDate:g.displayDate,Date:g.Date,Open:Number(m.toFixed(9)),Close:Number(t.toFixed(0)),High:Number(p.toFixed(3)),Low:Number(d.toFixed(0)),Volume:1},e+=2;for(var r in-661033193!==T.s1s(e.toString(),e.toString().length,41262)&&(i={DT:g.DT,displayDate:g.displayDate,Date:g.Date,Open:Number(m.toFixed(8)),Close:Number(t.toFixed(8)),High:Number(p.toFixed(8)),Low:Number(d.toFixed(8)),Volume:0}),i.iqPrevClose=i.Open,T.b6E(),g)i[r]||0===i[r]||(i[r]=g[r]);c.push(i)}c=[],u=null,p=null,d=null,m=null,g=null;for(var E=0;E<e.length;E++)(f=e[E])&&(T.f7g(1),y=e[T.e7g(E,1)],E||(y||(y=a[a.length-1]),y&&((u=y.Close)||0===u)&&k()),y&&(v=f.Close,x=f.Open,b=f.High,S=f.Low,(v||0===v)&&(x=x||0===x?x:v,b=b||0===b?b:v,S=S||0===S?S:v,u||0===u||(C=Math.floor(x/i)*i,u=isNaN(C)?x:C,k(),D(y,x)),E&&D(f,x),b-x<x-S?(b&&D(f,b),S&&D(f,S)):(S&&D(f,S),b&&D(f,b)),D(f,v),E==e.length-1&&v!=m&&(w=p,T.F7g(4),p=T.e7g(d,i),T.F7g(1),d=T.u7g(w,i),_(v)))));return c},e.calculatePointFigure=function(t,i,a,r){var s,n,o,l,h,c,u,p,d,m,g,f,y,v,x,b,S,C,w,T,k=U888;if(!i.length)return i;function D(t,e,i,a,r,s,n,o,l){return k.q6E(),{DT:t.DT,Date:t.Date,pfOpen:o,pfClose:l,Open:e,Close:r,High:i,Low:a,Volume:s,iqPrevClose:n}}if(r||(r=[]),(s=t.chart.state.aggregation)||(s=t.chart.state.aggregation={}),n=t.layout,t.chart.defaultChartStyleConfig.box=1,t.chart.defaultChartStyleConfig.reversal=3,a||(a={}),!(o=a.box)){if(n.pandf&&null!==n.pandf.box&&(n.pandf.box=null,t.changeOccurred("layout")),o=t.chart.defaultChartStyleConfig.box,l=i[i.length-1].Close){1428491284,-1185956117,h=2;for(var M=1;1428491284!==k.s1s(M.toString(),M.toString().length,53494);M++)o=l<=6196?220361:l>2?16450:l<=6?8155:l>86?845:l>497?2:l<=414?3:l>=901?6:l>=368?4:l<=69839?88:818,h+=2;-1185956117!==k.G1s(h.toString(),h.toString().length,31981)&&(o=l<=6196?220361:l>2?16450:l<=6?8155:l>86?845:l>497?2:l<=414?3:l>=901?6:l>=368?4:l<=69839?88:818),l<.25?(k.f7g(1),o=k.e7g("0.0625",0)):o=l<1?.125:l<5?.25:l<20?.5:l<100?1:l<200?2:l<500?4:l<1e3?5:l<25e3?50:500}e.ChartEngine.isDailyInterval(n.interval)||(o/=10),e.Market.Symbology.isForexSymbol(t.chart.symbol)&&(l&&(l<1?(k.f7g(1),o=k.e7g("0.001",0)):l<2?(k.f7g(3),o=k.e7g(1,"0.002")):l<50?o=.02:l<200&&(o=.2)),e.ChartEngine.isDailyInterval(n.interval)&&(o*=10)),t.chart.defaultChartStyleConfig.box=o}if(o=parseFloat(o),isNaN(o)||o<=0){n.pandf&&null!==n.pandf.box&&(n.pandf.box=null,t.changeOccurred("layout")),-2104589579,-939542807,c=2;for(var A=1;-2104589579!==k.G1s(A.toString(),A.toString().length,78934);A++)t.chart.defaultChartStyleConfig.box=o=7,c+=2;-939542807!==k.G1s(c.toString(),c.toString().length,67522)&&(t.chart.defaultChartStyleConfig.box=o=7),t.chart.defaultChartStyleConfig.box=o=1}if((u=Math.ceil(parseFloat(a.reversal)))>0&&u>a.reversal){"layo","ut",-838827407,-661764786,p=2;for(var F=1;-838827407!==k.s1s(F.toString(),F.toString().length,32337);F++)n.pandf.reversal=u,p+=2;-661764786!==k.G1s(p.toString(),p.toString().length,82539)&&(n.pandf.reversal=u),t.changeOccurred("layout")}else(isNaN(u)||u<=0)&&(n.pandf&&null!==n.pandf.reversal&&(n.pandf.reversal=null,t.changeOccurred("layout")),u=t.chart.defaultChartStyleConfig.reversal);function P(t,e,i,a,r){t.High=Math.max(e,t.High),t.Low=Math.min(i,t.Low),t.Close=a,t.Volume+=r}function _(t,e){for(var i in t)e[i]||0===e[i]||(e[i]=t[i]);return e}s.box=o,u*=o,d=(o.toString()+".").split(".")[1].length,m=[],k.F7g(3),g=k.e7g(1,"0");for(var E=0;E<i.length;E++)if(y=i[E])if(g+=y.Volume,x=y.Close,b=(b=y.Open)||0===b?b:x,S=(S=y.High)||0===S?S:x,C=(C=y.Low)||0===C?C:x,m.length||r.length){k.F7g(13);var L=k.u7g(10,10);(v=m[m.length-L])||(v=e.clone(r[r.length-1])),"O"==v.pfTrend?(C<=v.pfClose-o?(v.pfClose=Number((Math.ceil(C/o-1e-8)*o).toFixed(d)),"O"==v.pfStepBack&&(v.pfStepBack=null),P(v,S,C,x,g)):S>=v.pfClose+u?(w=v.pfClose+o,T=Number((Math.floor(S/o+1e-8)*o).toFixed(d)),f=D(y,b,S,C,x,g,v.pfClose,w,T),w==T&&(f.pfStepBack="X"),"O"==v.pfStepBack?(v.pfOpen=w,v.pfClose=T,v.pfTrend="X",P(v,S,C,x,g)):((f=_(y,f)).pfTrend="X",m.push(f))):P(v,S,C,x,g),g=0):"X"==v.pfTrend&&(S>=v.pfClose+o?(v.pfClose=Number((Math.floor(S/o+1e-8)*o).toFixed(d)),"X"!=v.pfStepBack&&"-"!=v.pfStepBack||(v.pfStepBack=null),P(v,S,C,x,g)):C<=v.pfClose-u?(w=v.pfClose-o,T=Number((Math.ceil(C/o-1e-8)*o).toFixed(d)),f=D(y,b,S,C,x,g,v.pfClose,w,T),w==T&&(f.pfStepBack="O"),"X"==v.pfStepBack||"-"==v.pfStepBack?(v.pfOpen=w,v.pfClose=T,v.pfTrend="O",P(v,S,C,x,g),w!=T&&"-"==v.pfStepBack&&(v.pfStepBack=null)):((f=_(y,f)).pfTrend="O",m.push(f))):P(v,S,C,x,g),g=0)}else(f=_(y,D(y,b,S,C,x,g,S+o,Number((Math.ceil(C/o-1e-8)*o).toFixed(d)),Number((Math.floor(S/o+1e-8)*o).toFixed(d))))).pfTrend="X",f.pfOpen==f.pfClose&&(f.pfStepBack="-"),m.push(f),g=0;return m},U888.b6E(),t},_exports=_exports||{},__js_core__init_(_exports),__js_core__polyfills_(_exports),__js_core_core_(_exports,_exports),__js_core_engine_(_exports,_exports,_exports,_exports),__js_core_market_(_exports),__js_core_microkernel_(_exports),__js_core_timezone_(_exports),__js_core_utility_(_exports),__js_standard_customCharts_(_exports),__js_standard_drawing_(_exports),__js_standard_i18n_(_exports),__js_standard_markers_(_exports),__js_standard_quoteFeed_(_exports),__js_standard_span_(_exports),__js_standard_studies_(_exports),__js_standard_symbolLookupBase_(_exports),__js_advanced_aggregations_(_exports),__js_advanced_drawingAdvanced_(_exports),__js_advanced_equations_(_exports),__js_advanced_highPerformanceMarkers_(_exports),__js_advanced_renderersAdvanced_(_exports),__js_advanced_share_(_exports),__js_advanced_studiesAdvanced_(_exports),_exports},"function"==typeof define&&define.amd?define([],factory):"object"===_typeof(exports)?module.exports=factory():factory(root)}).call(this,__webpack_require__(32))}}]);
//# sourceMappingURL=chartiq-7386a1.smartcharts.js.map